# Comparing `tmp/stix_shifter_modules_gcp_chronicle-5.1.0.dev786-py2.py3-none-any.whl.zip` & `tmp/stix_shifter_modules_gcp_chronicle-5.1.1-py2.py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,33 +1,33 @@
-Zip file size: 67842 bytes, number of entries: 31
--rw-rw-r--  2.0 unx        0 b- defN 23-Mar-16 20:42 stix_shifter_modules/gcp_chronicle/__init__.py
--rw-rw-r--  2.0 unx      426 b- defN 23-Mar-16 20:42 stix_shifter_modules/gcp_chronicle/entry_point.py
--rw-rw-r--  2.0 unx   170696 b- defN 23-Mar-16 20:46 stix_shifter_modules/gcp_chronicle/configuration/config.json
--rw-rw-r--  2.0 unx       78 b- defN 23-Mar-16 20:46 stix_shifter_modules/gcp_chronicle/configuration/dialects.json
--rw-rw-r--  2.0 unx     2656 b- defN 23-Mar-16 20:46 stix_shifter_modules/gcp_chronicle/configuration/lang_en.json
--rw-rw-r--  2.0 unx        0 b- defN 23-Mar-16 20:42 stix_shifter_modules/gcp_chronicle/stix_translation/__init__.py
--rw-rw-r--  2.0 unx    21567 b- defN 23-Mar-16 20:46 stix_shifter_modules/gcp_chronicle/stix_translation/json_to_stix_translator.py
--rw-rw-r--  2.0 unx    27474 b- defN 23-Mar-16 20:42 stix_shifter_modules/gcp_chronicle/stix_translation/query_constructor.py
--rw-rw-r--  2.0 unx      804 b- defN 23-Mar-16 20:42 stix_shifter_modules/gcp_chronicle/stix_translation/query_translator.py
--rw-rw-r--  2.0 unx      137 b- defN 23-Mar-16 20:42 stix_shifter_modules/gcp_chronicle/stix_translation/results_translator.py
--rw-rw-r--  2.0 unx     2273 b- defN 23-Mar-16 20:42 stix_shifter_modules/gcp_chronicle/stix_translation/transformers.py
--rw-rw-r--  2.0 unx    11972 b- defN 23-Mar-16 20:42 stix_shifter_modules/gcp_chronicle/stix_translation/json/config_map.json
--rw-rw-r--  2.0 unx    19126 b- defN 23-Mar-16 20:42 stix_shifter_modules/gcp_chronicle/stix_translation/json/from_stix_map.json
--rw-rw-r--  2.0 unx      619 b- defN 23-Mar-16 20:42 stix_shifter_modules/gcp_chronicle/stix_translation/json/operators.json
--rw-rw-r--  2.0 unx    47935 b- defN 23-Mar-16 20:42 stix_shifter_modules/gcp_chronicle/stix_translation/json/to_stix_map.json
--rw-rw-r--  2.0 unx    18763 b- defN 23-Mar-16 20:42 stix_shifter_modules/gcp_chronicle/stix_translation/json/stix_2_1/from_stix_map.json
--rw-rw-r--  2.0 unx    46863 b- defN 23-Mar-16 20:42 stix_shifter_modules/gcp_chronicle/stix_translation/json/stix_2_1/to_stix_map.json
--rw-rw-r--  2.0 unx        0 b- defN 23-Mar-16 20:42 stix_shifter_modules/gcp_chronicle/stix_transmission/__init__.py
--rw-rw-r--  2.0 unx     7568 b- defN 23-Mar-16 20:42 stix_shifter_modules/gcp_chronicle/stix_transmission/api_client.py
--rw-rw-r--  2.0 unx     3006 b- defN 23-Mar-16 20:42 stix_shifter_modules/gcp_chronicle/stix_transmission/delete_connector.py
--rw-rw-r--  2.0 unx     1405 b- defN 23-Mar-16 20:42 stix_shifter_modules/gcp_chronicle/stix_transmission/error_mapper.py
--rw-rw-r--  2.0 unx     2725 b- defN 23-Mar-16 20:42 stix_shifter_modules/gcp_chronicle/stix_transmission/ping_connector.py
--rw-rw-r--  2.0 unx     2711 b- defN 23-Mar-16 20:42 stix_shifter_modules/gcp_chronicle/stix_transmission/query_connector.py
--rw-rw-r--  2.0 unx    18413 b- defN 23-Mar-16 20:42 stix_shifter_modules/gcp_chronicle/stix_transmission/results_connector.py
--rw-rw-r--  2.0 unx     5479 b- defN 23-Mar-16 20:42 stix_shifter_modules/gcp_chronicle/stix_transmission/status_connector.py
--rw-rw-r--  2.0 unx    12786 b- defN 23-Mar-16 20:46 stix_shifter_modules_gcp_chronicle-5.1.0.dev786.dist-info/LICENSE.md
--rw-rw-r--  2.0 unx     7319 b- defN 23-Mar-16 20:46 stix_shifter_modules_gcp_chronicle-5.1.0.dev786.dist-info/METADATA
--rw-rw-r--  2.0 unx     1418 b- defN 23-Mar-16 20:46 stix_shifter_modules_gcp_chronicle-5.1.0.dev786.dist-info/NOTICE
--rw-rw-r--  2.0 unx      110 b- defN 23-Mar-16 20:46 stix_shifter_modules_gcp_chronicle-5.1.0.dev786.dist-info/WHEEL
--rw-rw-r--  2.0 unx       21 b- defN 23-Mar-16 20:46 stix_shifter_modules_gcp_chronicle-5.1.0.dev786.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx     3817 b- defN 23-Mar-16 20:46 stix_shifter_modules_gcp_chronicle-5.1.0.dev786.dist-info/RECORD
-31 files, 438167 bytes uncompressed, 61242 bytes compressed:  86.0%
+Zip file size: 67877 bytes, number of entries: 31
+-rw-rw-r--  2.0 unx        0 b- defN 23-Mar-21 13:47 stix_shifter_modules/gcp_chronicle/__init__.py
+-rw-rw-r--  2.0 unx      426 b- defN 23-Mar-21 13:47 stix_shifter_modules/gcp_chronicle/entry_point.py
+-rw-rw-r--  2.0 unx   170696 b- defN 23-Mar-21 13:51 stix_shifter_modules/gcp_chronicle/configuration/config.json
+-rw-rw-r--  2.0 unx       78 b- defN 23-Mar-21 13:51 stix_shifter_modules/gcp_chronicle/configuration/dialects.json
+-rw-rw-r--  2.0 unx     2656 b- defN 23-Mar-21 13:51 stix_shifter_modules/gcp_chronicle/configuration/lang_en.json
+-rw-rw-r--  2.0 unx        0 b- defN 23-Mar-21 13:47 stix_shifter_modules/gcp_chronicle/stix_translation/__init__.py
+-rw-rw-r--  2.0 unx    21567 b- defN 23-Mar-21 13:51 stix_shifter_modules/gcp_chronicle/stix_translation/json_to_stix_translator.py
+-rw-rw-r--  2.0 unx    27474 b- defN 23-Mar-21 13:47 stix_shifter_modules/gcp_chronicle/stix_translation/query_constructor.py
+-rw-rw-r--  2.0 unx      804 b- defN 23-Mar-21 13:47 stix_shifter_modules/gcp_chronicle/stix_translation/query_translator.py
+-rw-rw-r--  2.0 unx      137 b- defN 23-Mar-21 13:47 stix_shifter_modules/gcp_chronicle/stix_translation/results_translator.py
+-rw-rw-r--  2.0 unx     2273 b- defN 23-Mar-21 13:47 stix_shifter_modules/gcp_chronicle/stix_translation/transformers.py
+-rw-rw-r--  2.0 unx    11972 b- defN 23-Mar-21 13:47 stix_shifter_modules/gcp_chronicle/stix_translation/json/config_map.json
+-rw-rw-r--  2.0 unx    19126 b- defN 23-Mar-21 13:47 stix_shifter_modules/gcp_chronicle/stix_translation/json/from_stix_map.json
+-rw-rw-r--  2.0 unx      619 b- defN 23-Mar-21 13:47 stix_shifter_modules/gcp_chronicle/stix_translation/json/operators.json
+-rw-rw-r--  2.0 unx    47935 b- defN 23-Mar-21 13:47 stix_shifter_modules/gcp_chronicle/stix_translation/json/to_stix_map.json
+-rw-rw-r--  2.0 unx    18763 b- defN 23-Mar-21 13:47 stix_shifter_modules/gcp_chronicle/stix_translation/json/stix_2_1/from_stix_map.json
+-rw-rw-r--  2.0 unx    46863 b- defN 23-Mar-21 13:47 stix_shifter_modules/gcp_chronicle/stix_translation/json/stix_2_1/to_stix_map.json
+-rw-rw-r--  2.0 unx        0 b- defN 23-Mar-21 13:47 stix_shifter_modules/gcp_chronicle/stix_transmission/__init__.py
+-rw-rw-r--  2.0 unx     7568 b- defN 23-Mar-21 13:47 stix_shifter_modules/gcp_chronicle/stix_transmission/api_client.py
+-rw-rw-r--  2.0 unx     3006 b- defN 23-Mar-21 13:47 stix_shifter_modules/gcp_chronicle/stix_transmission/delete_connector.py
+-rw-rw-r--  2.0 unx     1405 b- defN 23-Mar-21 13:47 stix_shifter_modules/gcp_chronicle/stix_transmission/error_mapper.py
+-rw-rw-r--  2.0 unx     2725 b- defN 23-Mar-21 13:47 stix_shifter_modules/gcp_chronicle/stix_transmission/ping_connector.py
+-rw-rw-r--  2.0 unx     2711 b- defN 23-Mar-21 13:47 stix_shifter_modules/gcp_chronicle/stix_transmission/query_connector.py
+-rw-rw-r--  2.0 unx    19228 b- defN 23-Mar-21 13:47 stix_shifter_modules/gcp_chronicle/stix_transmission/results_connector.py
+-rw-rw-r--  2.0 unx     5479 b- defN 23-Mar-21 13:47 stix_shifter_modules/gcp_chronicle/stix_transmission/status_connector.py
+-rw-rw-r--  2.0 unx    12786 b- defN 23-Mar-21 13:51 stix_shifter_modules_gcp_chronicle-5.1.1.dist-info/LICENSE.md
+-rw-rw-r--  2.0 unx     7312 b- defN 23-Mar-21 13:51 stix_shifter_modules_gcp_chronicle-5.1.1.dist-info/METADATA
+-rw-rw-r--  2.0 unx     1418 b- defN 23-Mar-21 13:51 stix_shifter_modules_gcp_chronicle-5.1.1.dist-info/NOTICE
+-rw-rw-r--  2.0 unx      110 b- defN 23-Mar-21 13:51 stix_shifter_modules_gcp_chronicle-5.1.1.dist-info/WHEEL
+-rw-rw-r--  2.0 unx       21 b- defN 23-Mar-21 13:51 stix_shifter_modules_gcp_chronicle-5.1.1.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx     3775 b- defN 23-Mar-21 13:51 stix_shifter_modules_gcp_chronicle-5.1.1.dist-info/RECORD
+31 files, 438933 bytes uncompressed, 61361 bytes compressed:  86.0%
```

## zipnote {}

```diff
@@ -69,26 +69,26 @@
 
 Filename: stix_shifter_modules/gcp_chronicle/stix_transmission/results_connector.py
 Comment: 
 
 Filename: stix_shifter_modules/gcp_chronicle/stix_transmission/status_connector.py
 Comment: 
 
-Filename: stix_shifter_modules_gcp_chronicle-5.1.0.dev786.dist-info/LICENSE.md
+Filename: stix_shifter_modules_gcp_chronicle-5.1.1.dist-info/LICENSE.md
 Comment: 
 
-Filename: stix_shifter_modules_gcp_chronicle-5.1.0.dev786.dist-info/METADATA
+Filename: stix_shifter_modules_gcp_chronicle-5.1.1.dist-info/METADATA
 Comment: 
 
-Filename: stix_shifter_modules_gcp_chronicle-5.1.0.dev786.dist-info/NOTICE
+Filename: stix_shifter_modules_gcp_chronicle-5.1.1.dist-info/NOTICE
 Comment: 
 
-Filename: stix_shifter_modules_gcp_chronicle-5.1.0.dev786.dist-info/WHEEL
+Filename: stix_shifter_modules_gcp_chronicle-5.1.1.dist-info/WHEEL
 Comment: 
 
-Filename: stix_shifter_modules_gcp_chronicle-5.1.0.dev786.dist-info/top_level.txt
+Filename: stix_shifter_modules_gcp_chronicle-5.1.1.dist-info/top_level.txt
 Comment: 
 
-Filename: stix_shifter_modules_gcp_chronicle-5.1.0.dev786.dist-info/RECORD
+Filename: stix_shifter_modules_gcp_chronicle-5.1.1.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## stix_shifter_modules/gcp_chronicle/stix_transmission/results_connector.py

```diff
@@ -1,18 +1,21 @@
 from stix_shifter_utils.modules.base.stix_transmission.base_json_results_connector import BaseJsonResultsConnector
 from stix_shifter_utils.utils.error_response import ErrorResponder
 from stix_shifter_utils.utils import logger
-import json
 from aiogoogle.excs import HTTPError
 from aiohttp.client_exceptions import ClientConnectionError
 from asyncio.exceptions import TimeoutError
 import copy
 import re
 
 
+class InvalidMetadataException(Exception):
+    pass
+
+
 class ResultsConnector(BaseJsonResultsConnector):
     EMAIL_PATTERN = re.compile(r'(^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$)')
     GCP_MAX_PAGE_SIZE = 1000
 
     def __init__(self, api_client):
         self.api_client = api_client
         self.logger = logger.set_logger(__name__)
@@ -20,31 +23,33 @@
 
     async def create_results_connection(self, search_id, offset, length, metadata=None):
         """
         Fetching the results using search id, offset and length
         :param search_id: str, search id generated in transmit query
         :param offset: str, offset value
         :param length: str, length value
-        :param metadata: str
+        :param metadata: dict, result_count, next_page_token
         :return: dict
         """
         return_obj = {}
         response_dict = {}
         response_text = {}
         result = []
         result_count = 0
         local_result_count = 0
-
         try:
             if metadata:
-                result_count, next_page_token = metadata.split(':')
-                result_count = int(result_count)
-                total_records = int(length)
-                if abs(self.api_client.result_limit - result_count) < total_records:
-                    total_records = abs(self.api_client.result_limit - result_count)
+                if isinstance(metadata, dict) and metadata.get('result_count') and metadata.get('next_page_token'):
+                    result_count, next_page_token = metadata['result_count'], metadata['next_page_token']
+                    total_records = int(length)
+                    if abs(self.api_client.result_limit - result_count) < total_records:
+                        total_records = abs(self.api_client.result_limit - result_count)
+                else:
+                    # raise exception when metadata doesnt contain result count or next page token
+                    raise InvalidMetadataException(metadata)
             else:
                 result_count, next_page_token = 0, '0'
                 total_records = int(offset) + int(length)
                 if self.api_client.result_limit < total_records:
                     total_records = self.api_client.result_limit
 
             if total_records <= ResultsConnector.GCP_MAX_PAGE_SIZE:
@@ -74,16 +79,16 @@
                             if remaining_records > ResultsConnector.GCP_MAX_PAGE_SIZE:
                                 page_size = ResultsConnector.GCP_MAX_PAGE_SIZE
                             else:
                                 page_size = remaining_records
 
                             next_page_token = response_text['nextPageToken']
                             next_response = await self.api_client.get_search_results(search_id,
-                                                                               next_page_token,
-                                                                               page_size)
+                                                                                     next_page_token,
+                                                                                     page_size)
                             response_text = next_response.content
                             if next_response.status_code == 200:
                                 if 'detections' in response_text.keys():
                                     result_count += len(response_text['detections'])
                                     local_result_count += len(response_text['detections'])
                                     result.append(response_text['detections'])
                             else:
@@ -95,27 +100,34 @@
                     if result:
                         return_obj['success'] = True
                         final_result = ResultsConnector.get_results_data(result)
                         if metadata:
                             return_obj['data'] = final_result if final_result else []
                         else:
                             return_obj['data'] = final_result[int(offset): total_records] if final_result else []
-                        return_obj['metadata'] = str(result_count) + ':' + response_text.get('nextPageToken', '0')
+                        if response_text.get('nextPageToken') and result_count < self.api_client.result_limit:
+                            return_obj['metadata'] = {"result_count": result_count,
+                                                      "next_page_token": response_text.get('nextPageToken')}
                     else:
                         if not return_obj.get('error') and return_obj.get('success') is not False:
                             return_obj['success'] = True
                             return_obj['data'] = []
 
                 else:
                     return_obj = self.invalid_response(return_obj, response_dict, response_wrapper.status_code,
                                                        response_text)
             else:
                 return_obj['success'] = True
                 return_obj['data'] = []
 
+        except InvalidMetadataException as ex:
+            response_dict['code'] = 100
+            response_dict['message'] = f'Invalid metadata: {str(ex)}'
+            ErrorResponder.fill_error(return_obj, response_dict, ['message'], connector=self.connector)
+
         except ClientConnectionError:
             response_dict['code'] = 1010
             response_dict['message'] = "Invalid Host"
             ErrorResponder.fill_error(return_obj, response_dict, ['message'], connector=self.connector)
 
         except HTTPError as ex:
             if 'invalid_grant' in str(ex):
@@ -133,20 +145,20 @@
                 response_dict['message'] = f'cannot parse {r_ex}'
             ErrorResponder.fill_error(return_obj, response_dict, ['message'], connector=self.connector)
 
         except TimeoutError as ex:
             response_dict['code'] = 120
             response_dict['message'] = 'TimeoutError ' + str(ex)
             ErrorResponder.fill_error(return_obj, response_dict, ['message'], connector=self.connector)
-            
+
         except Exception as exp:
             response_dict['message'] = exp
             self.logger.error('error when getting search results: %s', exp)
             ErrorResponder.fill_error(return_obj, response_dict, ['message'], connector=self.connector)
-        
+
         finally:
             try:
                 if not return_obj.get('data') or result_count >= self.api_client.result_limit or \
                         response_dict.get('message') or not response_text.get('nextPageToken'):
                     if 'code' in response_dict:
                         if response_dict['code'] not in (1010, 1015):
                             self.logger.debug("Deleting the search id in results_connector")
```

## Comparing `stix_shifter_modules_gcp_chronicle-5.1.0.dev786.dist-info/LICENSE.md` & `stix_shifter_modules_gcp_chronicle-5.1.1.dist-info/LICENSE.md`

 * *Files identical despite different names*

## Comparing `stix_shifter_modules_gcp_chronicle-5.1.0.dev786.dist-info/METADATA` & `stix_shifter_modules_gcp_chronicle-5.1.1.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: stix-shifter-modules-gcp-chronicle
-Version: 5.1.0.dev786
+Version: 5.1.1
 Summary: Tools and interface to translate STIX formatted results and queries to different data source formats and to set up appropriate connection strings for invoking and triggering actions in openwhisk
 Home-page: https://github.com/opencybersecurityalliance/stix-shifter
 Author: ibm
 Author-email: 
 Project-URL: Source, https://github.com/opencybersecurityalliance/stix-shifter
 Keywords: datasource stix translate transform transmit
 Classifier: License :: OSI Approved :: Apache Software License
```

## Comparing `stix_shifter_modules_gcp_chronicle-5.1.0.dev786.dist-info/NOTICE` & `stix_shifter_modules_gcp_chronicle-5.1.1.dist-info/NOTICE`

 * *Files identical despite different names*

## Comparing `stix_shifter_modules_gcp_chronicle-5.1.0.dev786.dist-info/RECORD` & `stix_shifter_modules_gcp_chronicle-5.1.1.dist-info/RECORD`

 * *Files 11% similar despite different names*

```diff
@@ -17,15 +17,15 @@
 stix_shifter_modules/gcp_chronicle/stix_translation/json/stix_2_1/to_stix_map.json,sha256=Oc_DLIPv9ZvxwEz2WUFwLr8gUowrwaVyPduJuDxUbkk,46863
 stix_shifter_modules/gcp_chronicle/stix_transmission/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 stix_shifter_modules/gcp_chronicle/stix_transmission/api_client.py,sha256=fL_d_ibDkvWDPiRhQr5UAhi7vUA07Perx8WYJmwRjVQ,7568
 stix_shifter_modules/gcp_chronicle/stix_transmission/delete_connector.py,sha256=AqH9fGjI74-egfEEbij0C61VFAvngVvQUhcYzOYoZbo,3006
 stix_shifter_modules/gcp_chronicle/stix_transmission/error_mapper.py,sha256=KU_s02CUrt55deQEqHbp8QQXzOJDKyfoUYygSz4_FFk,1405
 stix_shifter_modules/gcp_chronicle/stix_transmission/ping_connector.py,sha256=EB0HcsNxJF6jfbEfvIMRMtZFczxJ_Hu9igUH4TT0PUU,2725
 stix_shifter_modules/gcp_chronicle/stix_transmission/query_connector.py,sha256=BEJC9dcelxy-CFvTDmFuGsK-2ZwUw5md5rfWlN5R5Hs,2711
-stix_shifter_modules/gcp_chronicle/stix_transmission/results_connector.py,sha256=geWRpfpw83rTVHGdcaO0nXB6uIheFR9cIIiKKTJaPyE,18413
+stix_shifter_modules/gcp_chronicle/stix_transmission/results_connector.py,sha256=mtJZ9csThPxandSaEel6Pxex7JN620OHKcv8Q77KH5Q,19228
 stix_shifter_modules/gcp_chronicle/stix_transmission/status_connector.py,sha256=3vMJiDFtaDuss7ySEerD8X96O3BTlY1gXWqf3_ePDAk,5479
-stix_shifter_modules_gcp_chronicle-5.1.0.dev786.dist-info/LICENSE.md,sha256=ssGEKMVW69oFTBblVhD1YPolqCOyOCJi4wRDRI7xCnU,12786
-stix_shifter_modules_gcp_chronicle-5.1.0.dev786.dist-info/METADATA,sha256=OfQzd2rZtFj2yWq768CpSezOHqfc2eFvaSWwmX4M1f8,7319
-stix_shifter_modules_gcp_chronicle-5.1.0.dev786.dist-info/NOTICE,sha256=wx-gWE9vSnLJ7YQkrGlMp9VNXOXG57TTxDDRd9CEdYg,1418
-stix_shifter_modules_gcp_chronicle-5.1.0.dev786.dist-info/WHEEL,sha256=bb2Ot9scclHKMOLDEHY6B2sicWOgugjFKaJsT7vwMQo,110
-stix_shifter_modules_gcp_chronicle-5.1.0.dev786.dist-info/top_level.txt,sha256=NX-VgUOr8fI-lMXHt3gtjfsEn1UPaGAVszt6Z_CTp2s,21
-stix_shifter_modules_gcp_chronicle-5.1.0.dev786.dist-info/RECORD,,
+stix_shifter_modules_gcp_chronicle-5.1.1.dist-info/LICENSE.md,sha256=ssGEKMVW69oFTBblVhD1YPolqCOyOCJi4wRDRI7xCnU,12786
+stix_shifter_modules_gcp_chronicle-5.1.1.dist-info/METADATA,sha256=rn4K3lmO1tlvNp8H7934lFtkdgw1q2Tz7YcMmzUAzdI,7312
+stix_shifter_modules_gcp_chronicle-5.1.1.dist-info/NOTICE,sha256=wx-gWE9vSnLJ7YQkrGlMp9VNXOXG57TTxDDRd9CEdYg,1418
+stix_shifter_modules_gcp_chronicle-5.1.1.dist-info/WHEEL,sha256=bb2Ot9scclHKMOLDEHY6B2sicWOgugjFKaJsT7vwMQo,110
+stix_shifter_modules_gcp_chronicle-5.1.1.dist-info/top_level.txt,sha256=NX-VgUOr8fI-lMXHt3gtjfsEn1UPaGAVszt6Z_CTp2s,21
+stix_shifter_modules_gcp_chronicle-5.1.1.dist-info/RECORD,,
```


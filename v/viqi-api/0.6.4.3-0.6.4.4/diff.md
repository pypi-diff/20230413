# Comparing `tmp/viqi_api-0.6.4.3-py3-none-any.whl.zip` & `tmp/viqi_api-0.6.4.4-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,23 +1,23 @@
-Zip file size: 62536 bytes, number of entries: 21
--rw-rw-rw-  2.0 unx      417 b- defN 23-Apr-13 00:12 vqapi/README.md
--rw-r--r--  2.0 unx      276 b- defN 23-Apr-13 00:12 vqapi/__init__.py
--rw-r--r--  2.0 unx     1746 b- defN 23-Apr-13 00:12 vqapi/blockable_module.py
--rw-r--r--  2.0 unx    28745 b- defN 23-Apr-13 00:12 vqapi/bqclass.py
--rw-r--r--  2.0 unx     1595 b- defN 23-Apr-13 00:12 vqapi/casauth.py
--rw-r--r--  2.0 unx     6106 b- defN 23-Apr-13 00:12 vqapi/cmd.py
--rw-r--r--  2.0 unx    50330 b- defN 23-Apr-13 00:12 vqapi/comm.py
--rw-r--r--  2.0 unx    14598 b- defN 23-Apr-13 00:12 vqapi/exception.py
--rw-r--r--  2.0 unx    61496 b- defN 23-Apr-13 00:12 vqapi/services.py
--rw-r--r--  2.0 unx    13926 b- defN 23-Apr-13 00:12 vqapi/util.py
--rw-r--r--  2.0 unx      165 b- defN 23-Apr-13 00:12 vqapi/version.py
--rw-r--r--  2.0 unx    33507 b- defN 23-Apr-13 00:12 vqapi/vqclass.py
--rw-r--r--  2.0 unx    11337 b- defN 23-Apr-13 00:12 vqapi/vqquery.py
--rw-r--r--  2.0 unx     4604 b- defN 23-Apr-13 00:12 vqapi/xmldict.py
--rw-rw-rw-  2.0 unx        8 b- defN 23-Apr-13 00:12 vqapi/RequestsMonkeyPatch/__init__.py
--rw-rw-rw-  2.0 unx      138 b- defN 23-Apr-13 00:12 vqapi/RequestsMonkeyPatch/monkeypatch.py
--rw-rw-rw-  2.0 unx     2010 b- defN 23-Apr-13 00:12 vqapi/RequestsMonkeyPatch/requests_patch.py
--rw-r--r--  2.0 unx     1509 b- defN 23-Apr-13 00:12 viqi_api-0.6.4.3.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Apr-13 00:12 viqi_api-0.6.4.3.dist-info/WHEEL
--rw-r--r--  2.0 unx        6 b- defN 23-Apr-13 00:12 viqi_api-0.6.4.3.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     1624 b- defN 23-Apr-13 00:12 viqi_api-0.6.4.3.dist-info/RECORD
-21 files, 234235 bytes uncompressed, 59946 bytes compressed:  74.4%
+Zip file size: 62721 bytes, number of entries: 21
+-rw-rw-rw-  2.0 unx      417 b- defN 23-Apr-13 06:10 vqapi/README.md
+-rw-r--r--  2.0 unx      276 b- defN 23-Apr-13 06:10 vqapi/__init__.py
+-rw-r--r--  2.0 unx     1746 b- defN 23-Apr-13 06:10 vqapi/blockable_module.py
+-rw-r--r--  2.0 unx    28745 b- defN 23-Apr-13 06:10 vqapi/bqclass.py
+-rw-r--r--  2.0 unx     1595 b- defN 23-Apr-13 06:10 vqapi/casauth.py
+-rw-r--r--  2.0 unx     6106 b- defN 23-Apr-13 06:10 vqapi/cmd.py
+-rw-r--r--  2.0 unx    50375 b- defN 23-Apr-13 06:10 vqapi/comm.py
+-rw-r--r--  2.0 unx    14598 b- defN 23-Apr-13 06:10 vqapi/exception.py
+-rw-r--r--  2.0 unx    61912 b- defN 23-Apr-13 06:10 vqapi/services.py
+-rw-r--r--  2.0 unx    13926 b- defN 23-Apr-13 06:10 vqapi/util.py
+-rw-r--r--  2.0 unx      165 b- defN 23-Apr-13 06:10 vqapi/version.py
+-rw-r--r--  2.0 unx    33627 b- defN 23-Apr-13 06:10 vqapi/vqclass.py
+-rw-r--r--  2.0 unx    11337 b- defN 23-Apr-13 06:10 vqapi/vqquery.py
+-rw-r--r--  2.0 unx     4604 b- defN 23-Apr-13 06:10 vqapi/xmldict.py
+-rw-rw-rw-  2.0 unx        8 b- defN 23-Apr-13 06:10 vqapi/RequestsMonkeyPatch/__init__.py
+-rw-rw-rw-  2.0 unx      138 b- defN 23-Apr-13 06:10 vqapi/RequestsMonkeyPatch/monkeypatch.py
+-rw-rw-rw-  2.0 unx     2010 b- defN 23-Apr-13 06:10 vqapi/RequestsMonkeyPatch/requests_patch.py
+-rw-r--r--  2.0 unx     1509 b- defN 23-Apr-13 06:10 viqi_api-0.6.4.4.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Apr-13 06:10 viqi_api-0.6.4.4.dist-info/WHEEL
+-rw-r--r--  2.0 unx        6 b- defN 23-Apr-13 06:10 viqi_api-0.6.4.4.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     1624 b- defN 23-Apr-13 06:10 viqi_api-0.6.4.4.dist-info/RECORD
+21 files, 234816 bytes uncompressed, 60131 bytes compressed:  74.4%
```

## zipnote {}

```diff
@@ -45,20 +45,20 @@
 
 Filename: vqapi/RequestsMonkeyPatch/monkeypatch.py
 Comment: 
 
 Filename: vqapi/RequestsMonkeyPatch/requests_patch.py
 Comment: 
 
-Filename: viqi_api-0.6.4.3.dist-info/METADATA
+Filename: viqi_api-0.6.4.4.dist-info/METADATA
 Comment: 
 
-Filename: viqi_api-0.6.4.3.dist-info/WHEEL
+Filename: viqi_api-0.6.4.4.dist-info/WHEEL
 Comment: 
 
-Filename: viqi_api-0.6.4.3.dist-info/top_level.txt
+Filename: viqi_api-0.6.4.4.dist-info/top_level.txt
 Comment: 
 
-Filename: viqi_api-0.6.4.3.dist-info/RECORD
+Filename: viqi_api-0.6.4.4.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## vqapi/comm.py

```diff
@@ -373,23 +373,22 @@
         self.deleted = set()
         self.bisque_root = None
         self.factory = BQFactory(self)
         self.dryrun = False
         self.delete_mex = None
         self.delete_build = None
         self.service_map = {}
-        self.cmdline = None
-        self.parse_args = None
+        self.parse_args = None  # initilized by some cmd.py
 
     # Pickle protocol
     def __getstate__(self):
         return (
             self.bisque_root,
             self.c.cookies["mex_session"],
-            self.service_map,
+            { str(key):str(val) for key,val in self.service_map.items()},
             self.parse_args,
         )
 
     def __setstate__(self, tple):
         self.bisque_root = tple[0]
         self.c = BQServer()
         self.c.cookies["mex_session"] = tple[1]
```

## vqapi/services.py

```diff
@@ -212,17 +212,15 @@
 class BaseServiceProxy:
     def __init__(self, session, service_url, timeout=DEFAULT_TIMEOUT):
         self.session = session
         self.service_url = service_url #if isinstance(service_url, str) else service_url.service_url
         self.timeout = timeout
 
     def __str__(self):
-        if isinstance(self.service_url, str):
-            return self.service_url
-        return self.service_url.service_url
+        return self.service_url
 
     def construct(self, path, params=None):
         url = self.service_url
         if params:
             path = f"{path}?{urllib.parse.urlencode(params)}"
         if path:
             url = urllib.parse.urljoin(str(url), str(path))
@@ -1114,42 +1112,54 @@
         data = self.session.service("data_service")
         dataset = Metadoc(tag="dataset", name=dataset_name)
         for member_uniq in member_list:
             member = dataset.add_tag("value", type="object")
             member.text = member_uniq
 
         return data.post(data=dataset, render="doc")
-
-    def delete(self, dataset_uniq, members=False, **kw):
-        if members:
-            params = kw.pop("params", {})
-            params["duri"] = dataset_uniq
-            return self.fetch("delete", params=params, **kw)
+    def append_member(self, dataset_uniq, resource_uniq, **kw):
+        """Append an objects to dataset
+        Args:
+           resource_uniq: str or list
+        """
         data = self.session.service("data_service")
-        return data.delete(dataset_uniq)
+        patch = Metadoc(tag="patch")
+        if isinstance(resource_uniq, str):
+            resource_uniq = [ resource_uniq ]
+        for uniq in resource_uniq:
+            member = Metadoc(tag="value", type="object", value=uniq)
+            patch.add_tag(tag="add", sel=f"/{dataset_uniq}").add_child(member)
+        data.patch(data=patch)
 
-    def append_member(self, dataset_uniq, resource_uniq, **kw):
-        """Append an element"""
+    def delete(self, dataset_uniq, members=False, **kw):
         data = self.session.service("data_service")
-        member = Metadoc(tag="value", type="object")
-        member.text = data.construct(resource_uniq)
-        self.post(dataset_uniq, data=member, render="doc")
+        if not members:
+            data.delete(path=f"{dataset_uniq}")
+            return
+        dataset = data.fetch(docid=f"/{dataset_uniq}", view="deep")
+        patch = Metadoc(tag="patch")
+        for uniq in list(members):
+            uris = dataset.path_query(f"value[@value='{uniq}']/@uri")
+            for uri in uris:
+                patch.add_tag(tag="remove", sel="/{uri}")
+        data.patch(data=patch)
 
     def delete_member(self, dataset_uniq, resource_uniq, **kw):
         """Delete a member..
         @return new dataset if success or None
         """
-        data = self.session.service("data_service")
-        dataset = data.fetch(dataset_uniq, params={"view": "full"}, render="doc")
-        members = dataset.path_query('value[text()="%s"]' % data.construct(resource_uniq))
-        for member in members:
-            member.delete()
-        if len(members):
-            return data.put(dataset_uniq, data=dataset, render="doc")
-        return None
+        raise NotImplementedError
+        # data = self.session.service("data_service")
+        # dataset = data.fetch(dataset_uniq, params={"view": "full"}, render="doc")
+        # members = dataset.path_query('value[text()="%s"]' % data.construct(resource_uniq))
+        # for member in members:
+        #     member.delete()
+        # if len(members):
+        #     return data.put(dataset_uniq, data=dataset, render="doc")
+        # return None
 
 
 class MexProxy(FuturizedServiceProxy):
     def get_all_mexes(self) -> Metadoc:
         """Get module execution (mex) documents for all running modules.
 
         Returns:
```

## vqapi/version.py

```diff
@@ -1,4 +1,4 @@
 # file generated by setuptools_scm
 # don't change, don't track in version control
-__version__ = version = '0.6.4.3'
-__version_tuple__ = version_tuple = (0, 6, 4, 3)
+__version__ = version = '0.6.4.4'
+__version_tuple__ = version_tuple = (0, 6, 4, 4)
```

## vqapi/vqclass.py

```diff
@@ -837,27 +837,36 @@
         c = self.resources.get(resource_type)
         return c.find(session, **kwargs)
 
 
 class VQSession(BQSession):
     def __init__(self):
         super().__init__()
-        self._init_cache()
+        self.factory = VQFactory()
+        self._deltas = []
+
+    def __getstate__(self):
+        return super().__getstate__(), self.factory, self._deltas
+
+    def __setstate__(self, state):
+        super().__setstate__(state[0])
+        self.factory = state[1]
+        self._deltas = state[2]
 
     def init(
         self,
         bisque_url,
         credentials=None,
         moduleuri=None,
         create_mex=False,
         enable_cache=True,
     ):
         res = super().init(bisque_url, credentials, moduleuri, create_mex, enable_cache=enable_cache)
-        self.factory = VQFactory()
-        self._init_cache()
+        #self.factory = VQFactory()
+        #self._init_cache()
         return res
 
     def init_local(
         self,
         user,
         pwd,
         moduleuri=None,
@@ -871,34 +880,30 @@
             pwd,
             moduleuri,
             bisque_root,
             create_mex,
             as_user,
             enable_cache=enable_cache,
         )
-        self.factory = VQFactory()
-        self._init_cache()
+        #self.factory = VQFactory()
+        #self._init_cache()
         return res
 
     def init_mex(self, mex_url, token, user=None, bisque_root=None, enable_cache=False):
         res = super().init_mex(mex_url, token, user, bisque_root, enable_cache=enable_cache)
-        self.factory = VQFactory()
-        self._init_cache()
+        ##self.factory = VQFactory()
+        #self._init_cache()
         return res
 
     def init_request(self, request, enable_cache=True):
         res = super().init_request(request, enable_cache=enable_cache)
-        self.factory = VQFactory()
-        self._init_cache()
+        #self.factory = VQFactory()
+        #self._init_cache()
         return res
 
-    def _init_cache(self, enable_cache=True):
-        # initialize local resource doc cache and delta structure to record changes
-        self._deltas = []
-
     def load(self, uniq: str) -> VQResource:
         return self.factory.load(self, uniq)
 
     def flush(self):
         """
         Write any pending doc changes back to ViQi server.
         """
```

## Comparing `viqi_api-0.6.4.3.dist-info/METADATA` & `viqi_api-0.6.4.4.dist-info/METADATA`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: viqi-api
-Version: 0.6.4.3
+Version: 0.6.4.4
 Summary: ViQi Bisque Module API
 Author: ViQi Inc
 Author-email: info@viqi.org
 Project-URL: homepage, https://www.viqi.org
 Classifier: Programming Language :: Python :: 3
 Classifier: Programming Language :: Python :: 3.8
 Classifier: Programming Language :: Python :: 3.10
```

## Comparing `viqi_api-0.6.4.3.dist-info/RECORD` & `viqi_api-0.6.4.4.dist-info/RECORD`

 * *Files 10% similar despite different names*

```diff
@@ -1,21 +1,21 @@
 vqapi/README.md,sha256=7DM5QUu1mXfOR14RhMMZs1pJcr5GeWoCl68zOkryzZs,417
 vqapi/__init__.py,sha256=F9hkh1APw6yKTSqAepWKLgf-GJpT-TB0JibG1Fb-MxA,276
 vqapi/blockable_module.py,sha256=zMeKq_h2TZLGAvnvuJbf9K0LdzWHNjs_iRdRaB81f8M,1746
 vqapi/bqclass.py,sha256=wJWMdfULDka_6ts2QMFolcsTmXEcYT6F66Ssd7Zf9bQ,28745
 vqapi/casauth.py,sha256=dCmb2VzoyEeo2OL6ffbEutrsmen_ES5hN896TGd5WMw,1595
 vqapi/cmd.py,sha256=YJBN0GkqC9pTPKM_HR-zG8tkAHfwUvQP4ahB7Tau69w,6106
-vqapi/comm.py,sha256=Xkmt0Ku5nqTiSzPWdvobDPxfXhBFb-DQkotTa0YUE-M,50330
+vqapi/comm.py,sha256=RI8ZxYcW7aHD8vxJHEDiyoBZWOmIxk3qhcMXDAMkGG0,50375
 vqapi/exception.py,sha256=3gBTtX8YBJwEpTZC-xIh0P1GAcFvRFZmw7aZigcAOe4,14598
-vqapi/services.py,sha256=7flyYyfzF2sCH8SBDtrUN9voyDTAo_rqfynF7J-d-Zw,61496
+vqapi/services.py,sha256=gPB1HhYrGf4k_INnJWveuTZT1iDEtmzYuazOOJeIaHE,61912
 vqapi/util.py,sha256=5veo8qvyT0DXj_pGg6Kq9kHQ_tGUNej_Ze5wj_l1YCA,13926
-vqapi/version.py,sha256=Yu3APxVJzI_1hcI_LGEMPRA2XjC9zZ7fHSCM8d4L_ks,165
-vqapi/vqclass.py,sha256=AhA9d1liWCn69TOD-ddtPtA55Q0GEzNnTNnhZigqImo,33507
+vqapi/version.py,sha256=yYbEhteaYDCOWz3jpCAOmu6-WPDO8kKOPzbx_C7FcZk,165
+vqapi/vqclass.py,sha256=CwpXAkACNCybtJMVnB6usvNXNfG2_srPIbjMkBcNvWE,33627
 vqapi/vqquery.py,sha256=eCj5EuzGmudAMT0yam9LsD_sJ76niSMWSsYc53ttZJc,11337
 vqapi/xmldict.py,sha256=LlALxsgBZS0Put8rRj6T4S5xMoI1h5gfZvk_bSKivec,4604
 vqapi/RequestsMonkeyPatch/__init__.py,sha256=9_8wL9Scv8_Cs8HJyJHGvx1vwXErsuvlsAqNZLcJQR0,8
 vqapi/RequestsMonkeyPatch/monkeypatch.py,sha256=Dl9WR-wicHkgxKRWZ4yXvs4RMuu9v3CSY3fBMlH3Fl0,138
 vqapi/RequestsMonkeyPatch/requests_patch.py,sha256=CsXlC4OtK1tBVE4I1_ZU75RHGSQgTuSJREqcsM4yjgs,2010
-viqi_api-0.6.4.3.dist-info/METADATA,sha256=AH351Y1CxHNPw9q5GhAc8u1SqhjrQ73HDxwPJbsgQRI,1509
-viqi_api-0.6.4.3.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-viqi_api-0.6.4.3.dist-info/top_level.txt,sha256=3tj8lcUB1FkjX_EiiFuj3I18i3_LJydRRS0stEFKdJU,6
-viqi_api-0.6.4.3.dist-info/RECORD,,
+viqi_api-0.6.4.4.dist-info/METADATA,sha256=BLRC5GjBVo4iJdvp29j1UOMXRnD3KrUnYXqTMH-E5zg,1509
+viqi_api-0.6.4.4.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+viqi_api-0.6.4.4.dist-info/top_level.txt,sha256=3tj8lcUB1FkjX_EiiFuj3I18i3_LJydRRS0stEFKdJU,6
+viqi_api-0.6.4.4.dist-info/RECORD,,
```


# Comparing `tmp/meerk40t-0.8.2000.tar.gz` & `tmp/meerk40t-0.8.3000.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "meerk40t-0.8.2000.tar", last modified: Sat Feb 25 09:54:31 2023, max compression
+gzip compressed data, was "meerk40t-0.8.3000.tar", last modified: Thu Apr 13 19:28:32 2023, max compression
```

## Comparing `meerk40t-0.8.2000.tar` & `meerk40t-0.8.3000.tar`

### file list

```diff
@@ -1,408 +1,454 @@
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.927501 meerk40t-0.8.2000/
--rw-rw-rw-   0        0        0     1086 2022-08-29 19:57:50.000000 meerk40t-0.8.2000/LICENSE
--rw-rw-rw-   0        0        0     5513 2023-02-25 09:54:31.927501 meerk40t-0.8.2000/PKG-INFO
--rw-rw-rw-   0        0        0     3883 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/README.md
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.045450 meerk40t-0.8.2000/meerk40t/
--rw-rw-rw-   0        0        0       19 2022-08-29 19:57:50.000000 meerk40t-0.8.2000/meerk40t/__init__.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.076452 meerk40t-0.8.2000/meerk40t/balormk/
--rw-rw-rw-   0        0        0        0 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/balormk/__init__.py
--rw-rw-rw-   0        0        0     5556 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/balormk/balor_params.py
--rw-rw-rw-   0        0        0    46666 2023-02-25 00:28:24.000000 meerk40t-0.8.2000/meerk40t/balormk/controller.py
--rw-rw-rw-   0        0        0    67052 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/balormk/device.py
--rw-rw-rw-   0        0        0    21024 2023-02-25 00:28:24.000000 meerk40t-0.8.2000/meerk40t/balormk/driver.py
--rw-rw-rw-   0        0        0     5301 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/balormk/elementlightjob.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.088453 meerk40t-0.8.2000/meerk40t/balormk/gui/
--rw-rw-rw-   0        0        0        0 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/balormk/gui/__init__.py
--rw-rw-rw-   0        0        0     3904 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/balormk/gui/balorconfig.py
--rw-rw-rw-   0        0        0     5987 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/balormk/gui/balorcontroller.py
--rw-rw-rw-   0        0        0     5858 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/balormk/gui/baloroperationproperties.py
--rw-rw-rw-   0        0        0     5309 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/balormk/gui/gui.py
--rw-rw-rw-   0        0        0     7752 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/balormk/livefulllightjob.py
--rw-rw-rw-   0        0        0     5978 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/balormk/liveselectionlightjob.py
--rw-rw-rw-   0        0        0     3646 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/balormk/mock_connection.py
--rw-rw-rw-   0        0        0      891 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/balormk/plugin.py
--rw-rw-rw-   0        0        0    11181 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/balormk/usb_connection.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.098453 meerk40t-0.8.2000/meerk40t/camera/
--rw-rw-rw-   0        0        0       17 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/camera/__init__.py
--rw-rw-rw-   0        0        0    13204 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/camera/camera.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.102453 meerk40t-0.8.2000/meerk40t/camera/gui/
--rw-rw-rw-   0        0        0        0 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/camera/gui/__init__.py
--rw-rw-rw-   0        0        0    40400 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/camera/gui/camerapanel.py
--rw-rw-rw-   0        0        0     2341 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/camera/gui/gui.py
--rw-rw-rw-   0        0        0    10112 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/camera/plugin.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.110454 meerk40t-0.8.2000/meerk40t/ch341/
--rw-rw-rw-   0        0        0      739 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/ch341/__init__.py
--rw-rw-rw-   0        0        0    19968 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/ch341/libusb.py
--rw-rw-rw-   0        0        0     5511 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/ch341/mock.py
--rw-rw-rw-   0        0        0     6302 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/ch341/windll.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.164457 meerk40t-0.8.2000/meerk40t/core/
--rw-rw-rw-   0        0        0       15 2022-08-29 19:57:50.000000 meerk40t-0.8.2000/meerk40t/core/__init__.py
--rw-rw-rw-   0        0        0    17179 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/bindalias.py
--rw-rw-rw-   0        0        0      676 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/core.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.200459 meerk40t-0.8.2000/meerk40t/core/cutcode/
--rw-rw-rw-   0        0        0        0 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/cutcode/__init__.py
--rw-rw-rw-   0        0        0     2074 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/cutcode/cubiccut.py
--rw-rw-rw-   0        0        0    12244 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/cutcode/cutcode.py
--rw-rw-rw-   0        0        0     5392 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/cutcode/cutgroup.py
--rw-rw-rw-   0        0        0     5129 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/cutcode/cutobject.py
--rw-rw-rw-   0        0        0      847 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/cutcode/dwellcut.py
--rw-rw-rw-   0        0        0      727 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/cutcode/gotocut.py
--rw-rw-rw-   0        0        0      693 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/cutcode/homecut.py
--rw-rw-rw-   0        0        0      776 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/cutcode/inputcut.py
--rw-rw-rw-   0        0        0      952 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/cutcode/linecut.py
--rw-rw-rw-   0        0        0      786 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/cutcode/outputcut.py
--rw-rw-rw-   0        0        0    10490 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/cutcode/plotcut.py
--rw-rw-rw-   0        0        0     1653 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/cutcode/quadcut.py
--rw-rw-rw-   0        0        0     4168 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/cutcode/rastercut.py
--rw-rw-rw-   0        0        0      892 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/cutcode/setorigincut.py
--rw-rw-rw-   0        0        0      900 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/cutcode/waitcut.py
--rw-rw-rw-   0        0        0    40218 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/cutplan.py
--rw-rw-rw-   0        0        0    10177 2023-02-25 00:28:24.000000 meerk40t-0.8.2000/meerk40t/core/drivers.py
--rw-rw-rw-   0        0        0   230128 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/element_commands.py
--rw-rw-rw-   0        0        0    82017 2023-02-25 01:31:34.000000 meerk40t-0.8.2000/meerk40t/core/element_treeops.py
--rw-rw-rw-   0        0        0     2230 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/element_types.py
--rw-rw-rw-   0        0        0   146046 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/elements.py
--rw-rw-rw-   0        0        0      269 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/exceptions.py
--rw-rw-rw-   0        0        0     8282 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/laserjob.py
--rw-rw-rw-   0        0        0     1951 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/logging.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.286464 meerk40t-0.8.2000/meerk40t/core/node/
--rw-rw-rw-   0        0        0        0 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/__init__.py
--rw-rw-rw-   0        0        0     1260 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/blobnode.py
--rw-rw-rw-   0        0        0     3949 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/bootstrap.py
--rw-rw-rw-   0        0        0      894 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/branch_elems.py
--rw-rw-rw-   0        0        0     1188 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/branch_ops.py
--rw-rw-rw-   0        0        0     1236 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/branch_regmark.py
--rw-rw-rw-   0        0        0      937 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/cutnode.py
--rw-rw-rw-   0        0        0     6695 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/elem_ellipse.py
--rw-rw-rw-   0        0        0     3187 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/elem_geomstr.py
--rw-rw-rw-   0        0        0    29757 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/elem_image.py
--rw-rw-rw-   0        0        0     6683 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/elem_line.py
--rw-rw-rw-   0        0        0     6597 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/elem_path.py
--rw-rw-rw-   0        0        0     2593 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/elem_point.py
--rw-rw-rw-   0        0        0     6935 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/elem_polyline.py
--rw-rw-rw-   0        0        0     6699 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/elem_rect.py
--rw-rw-rw-   0        0        0    15489 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/elem_text.py
--rw-rw-rw-   0        0        0     1088 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/filenode.py
--rw-rw-rw-   0        0        0     2139 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/groupnode.py
--rw-rw-rw-   0        0        0     1872 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/lasercodenode.py
--rw-rw-rw-   0        0        0      928 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/layernode.py
--rw-rw-rw-   0        0        0     1885 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/mixins.py
--rw-rw-rw-   0        0        0    36443 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/node.py
--rw-rw-rw-   0        0        0     3248 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/nutils.py
--rw-rw-rw-   0        0        0    11949 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/op_cut.py
--rw-rw-rw-   0        0        0    10313 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/op_dots.py
--rw-rw-rw-   0        0        0    12000 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/op_engrave.py
--rw-rw-rw-   0        0        0    15178 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/op_hatch.py
--rw-rw-rw-   0        0        0    14400 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/op_image.py
--rw-rw-rw-   0        0        0    20582 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/op_raster.py
--rw-rw-rw-   0        0        0     1580 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/refnode.py
--rw-rw-rw-   0        0        0     7504 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/rootnode.py
--rw-rw-rw-   0        0        0     1502 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/util_console.py
--rw-rw-rw-   0        0        0     2207 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/util_goto.py
--rw-rw-rw-   0        0        0     1946 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/util_home.py
--rw-rw-rw-   0        0        0     3402 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/util_input.py
--rw-rw-rw-   0        0        0     2441 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/util_origin.py
--rw-rw-rw-   0        0        0     3442 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/util_output.py
--rw-rw-rw-   0        0        0     2211 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/node/util_wait.py
--rw-rw-rw-   0        0        0    16353 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/parameters.py
--rw-rw-rw-   0        0        0    37263 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/planner.py
--rw-rw-rw-   0        0        0    22757 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/plotplanner.py
--rw-rw-rw-   0        0        0    23737 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/spoolers.py
--rw-rw-rw-   0        0        0    47351 2023-02-25 09:09:09.000000 meerk40t-0.8.2000/meerk40t/core/svg_io.py
--rw-rw-rw-   0        0        0     5819 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/treeop.py
--rw-rw-rw-   0        0        0     2752 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/undos.py
--rw-rw-rw-   0        0        0    35437 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/units.py
--rw-rw-rw-   0        0        0     2700 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/webhelp.py
--rw-rw-rw-   0        0        0    17392 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/core/wordlist.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.293464 meerk40t-0.8.2000/meerk40t/device/
--rw-rw-rw-   0        0        0       17 2022-08-29 19:57:51.000000 meerk40t-0.8.2000/meerk40t/device/__init__.py
--rw-rw-rw-   0        0        0     1139 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/device/basedevice.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.308465 meerk40t-0.8.2000/meerk40t/device/ch341/
--rw-rw-rw-   0        0        0       16 2022-08-29 19:57:51.000000 meerk40t-0.8.2000/meerk40t/device/ch341/__init__.py
--rw-rw-rw-   0        0        0     7197 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/device/ch341/ch341.py
--rw-rw-rw-   0        0        0    15867 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/device/ch341/ch341libusbdriver.py
--rw-rw-rw-   0        0        0     5505 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/device/ch341/libusb.py
--rw-rw-rw-   0        0        0     5948 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/device/ch341/mock.py
--rw-rw-rw-   0        0        0     6759 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/device/ch341/windll.py
--rw-rw-rw-   0        0        0     4855 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/device/dummydevice.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.317466 meerk40t-0.8.2000/meerk40t/device/gui/
--rw-rw-rw-   0        0        0        0 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/device/gui/__init__.py
--rw-rw-rw-   0        0        0    23841 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/device/gui/defaultactions.py
--rw-rw-rw-   0        0        0    10132 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/device/gui/formatterpanel.py
--rw-rw-rw-   0        0        0     9284 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/device/gui/warningpanel.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.324466 meerk40t-0.8.2000/meerk40t/dxf/
--rw-rw-rw-   0        0        0       14 2022-08-29 19:57:51.000000 meerk40t-0.8.2000/meerk40t/dxf/__init__.py
--rw-rw-rw-   0        0        0    23432 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/dxf/dxf_io.py
--rw-rw-rw-   0        0        0     1318 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/dxf/plugin.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.348467 meerk40t-0.8.2000/meerk40t/extra/
--rw-rw-rw-   0        0        0        0 2022-08-29 19:57:51.000000 meerk40t-0.8.2000/meerk40t/extra/__init__.py
--rw-rw-rw-   0        0        0     4366 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/extra/cag.py
--rw-rw-rw-   0        0        0     2027 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/extra/embroider.py
--rw-rw-rw-   0        0        0    10173 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/extra/hershey.py
--rw-rw-rw-   0        0        0    12235 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/extra/imageactions.py
--rw-rw-rw-   0        0        0     8682 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/extra/inkscape.py
--rw-rw-rw-   0        0        0     8348 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/extra/pathoptimize.py
--rw-rw-rw-   0        0        0     9470 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/extra/potrace.py
--rw-rw-rw-   0        0        0     6893 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/extra/updater.py
--rw-rw-rw-   0        0        0     5120 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/extra/vectrace.py
--rw-rw-rw-   0        0        0     2769 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/extra/winsleep.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.356468 meerk40t-0.8.2000/meerk40t/fill/
--rw-rw-rw-   0        0        0        0 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/fill/__init__.py
--rw-rw-rw-   0        0        0    10357 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/fill/fills.py
--rw-rw-rw-   0        0        0    38279 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/fill/patternfill.py
--rw-rw-rw-   0        0        0    16519 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/fill/patterns.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.383469 meerk40t-0.8.2000/meerk40t/grbl/
--rw-rw-rw-   0        0        0        0 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/grbl/__init__.py
--rw-rw-rw-   0        0        0     2707 2023-02-25 00:28:24.000000 meerk40t-0.8.2000/meerk40t/grbl/control.py
--rw-rw-rw-   0        0        0    18497 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/grbl/controller.py
--rw-rw-rw-   0        0        0    20823 2023-02-25 00:28:24.000000 meerk40t-0.8.2000/meerk40t/grbl/device.py
--rw-rw-rw-   0        0        0    20963 2023-02-25 00:28:24.000000 meerk40t-0.8.2000/meerk40t/grbl/driver.py
--rw-rw-rw-   0        0        0    36161 2023-02-25 00:28:24.000000 meerk40t-0.8.2000/meerk40t/grbl/emulator.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.394470 meerk40t-0.8.2000/meerk40t/grbl/gui/
--rw-rw-rw-   0        0        0        0 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/grbl/gui/__init__.py
--rw-rw-rw-   0        0        0     6305 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/grbl/gui/grblconfiguration.py
--rw-rw-rw-   0        0        0     8386 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/grbl/gui/grblserialcontroller.py
--rw-rw-rw-   0        0        0     3800 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/grbl/gui/gui.py
--rw-rw-rw-   0        0        0     6870 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/grbl/gui/tcpcontroller.py
--rw-rw-rw-   0        0        0     1719 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/grbl/interpreter.py
--rw-rw-rw-   0        0        0      649 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/grbl/loader.py
--rw-rw-rw-   0        0        0     1677 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/grbl/mock_connection.py
--rw-rw-rw-   0        0        0     2835 2023-02-25 00:28:24.000000 meerk40t-0.8.2000/meerk40t/grbl/plugin.py
--rw-rw-rw-   0        0        0     2654 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/grbl/serial_connection.py
--rw-rw-rw-   0        0        0     2602 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/grbl/tcp_connection.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.475475 meerk40t-0.8.2000/meerk40t/gui/
--rw-rw-rw-   0        0        0       14 2022-08-29 19:57:51.000000 meerk40t-0.8.2000/meerk40t/gui/__init__.py
--rw-rw-rw-   0        0        0    11211 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/about.py
--rw-rw-rw-   0        0        0    64846 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/alignment.py
--rw-rw-rw-   0        0        0     2314 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/bufferview.py
--rw-rw-rw-   0        0        0    56390 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/choicepropertypanel.py
--rw-rw-rw-   0        0        0    16555 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/consolepanel.py
--rw-rw-rw-   0        0        0    14927 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/devicepanel.py
--rw-rw-rw-   0        0        0     3866 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/dialogoptions.py
--rw-rw-rw-   0        0        0    11505 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/executejob.py
--rw-rw-rw-   0        0        0     2800 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/fonts.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.479475 meerk40t-0.8.2000/meerk40t/gui/help_assets/
--rw-rw-rw-   0        0        0        0 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/help_assets/__init__.py
--rw-rw-rw-   0        0        0     9380 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/help_assets/help_assets.py
--rw-rw-rw-   0        0        0    31215 2023-02-25 09:09:09.000000 meerk40t-0.8.2000/meerk40t/gui/hersheymanager.py
--rw-rw-rw-   0        0        0   239007 2023-02-25 00:28:11.000000 meerk40t-0.8.2000/meerk40t/gui/icons.py
--rw-rw-rw-   0        0        0    19129 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/imagesplitter.py
--rw-rw-rw-   0        0        0    11758 2023-02-25 09:09:09.000000 meerk40t-0.8.2000/meerk40t/gui/keymap.py
--rw-rw-rw-   0        0        0    16410 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/laserpanel.py
--rw-rw-rw-   0        0        0    40187 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/laserrender.py
--rw-rw-rw-   0        0        0    30777 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/lasertoolpanel.py
--rw-rw-rw-   0        0        0    55893 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/materialtest.py
--rw-rw-rw-   0        0        0     3623 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/mkdebug.py
--rw-rw-rw-   0        0        0     4640 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/mwindow.py
--rw-rw-rw-   0        0        0    79729 2023-02-25 09:09:09.000000 meerk40t-0.8.2000/meerk40t/gui/navigationpanels.py
--rw-rw-rw-   0        0        0     4715 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/notes.py
--rw-rw-rw-   0        0        0    14960 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/opassignment.py
--rw-rw-rw-   0        0        0    10919 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/operation_info.py
--rw-rw-rw-   0        0        0    10319 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/plugin.py
--rw-rw-rw-   0        0        0    21051 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/position.py
--rw-rw-rw-   0        0        0    21256 2023-02-25 09:09:09.000000 meerk40t-0.8.2000/meerk40t/gui/preferences.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.512477 meerk40t-0.8.2000/meerk40t/gui/propertypanels/
--rw-rw-rw-   0        0        0        0 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/propertypanels/__init__.py
--rw-rw-rw-   0        0        0    38620 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/propertypanels/attributes.py
--rw-rw-rw-   0        0        0     5561 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/propertypanels/blobproperty.py
--rw-rw-rw-   0        0        0     2837 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/propertypanels/consoleproperty.py
--rw-rw-rw-   0        0        0     7360 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/propertypanels/groupproperties.py
--rw-rw-rw-   0        0        0    53861 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/propertypanels/imageproperty.py
--rw-rw-rw-   0        0        0     1781 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/propertypanels/inputproperty.py
--rw-rw-rw-   0        0        0     2612 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/propertypanels/opbranchproperties.py
--rw-rw-rw-   0        0        0    67309 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/propertypanels/operationpropertymain.py
--rw-rw-rw-   0        0        0     1789 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/propertypanels/outputproperty.py
--rw-rw-rw-   0        0        0    13370 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/propertypanels/pathproperty.py
--rw-rw-rw-   0        0        0     4398 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/propertypanels/pointproperty.py
--rw-rw-rw-   0        0        0     5748 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/propertypanels/propertywindow.py
--rw-rw-rw-   0        0        0    36709 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/propertypanels/rasterwizardpanels.py
--rw-rw-rw-   0        0        0    27891 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/propertypanels/textproperty.py
--rw-rw-rw-   0        0        0     1771 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/propertypanels/waitproperty.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.530478 meerk40t-0.8.2000/meerk40t/gui/scene/
--rw-rw-rw-   0        0        0        0 2022-08-29 19:57:51.000000 meerk40t-0.8.2000/meerk40t/gui/scene/__init__.py
--rw-rw-rw-   0        0        0     5180 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/scene/guicolors.py
--rw-rw-rw-   0        0        0    41583 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/scene/scene.py
--rw-rw-rw-   0        0        0      637 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/scene/sceneconst.py
--rw-rw-rw-   0        0        0    11680 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/scene/scenepanel.py
--rw-rw-rw-   0        0        0    13224 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/scene/scenespacewidget.py
--rw-rw-rw-   0        0        0    15749 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/scene/widget.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.554479 meerk40t-0.8.2000/meerk40t/gui/scenewidgets/
--rw-rw-rw-   0        0        0        0 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/scenewidgets/__init__.py
--rw-rw-rw-   0        0        0    16387 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/scenewidgets/attractionwidget.py
--rw-rw-rw-   0        0        0     3033 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/scenewidgets/bedwidget.py
--rw-rw-rw-   0        0        0     3081 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/scenewidgets/elementswidget.py
--rw-rw-rw-   0        0        0    26591 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/scenewidgets/gridwidget.py
--rw-rw-rw-   0        0        0    28002 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/scenewidgets/guidewidget.py
--rw-rw-rw-   0        0        0     1876 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/scenewidgets/laserpathwidget.py
--rw-rw-rw-   0        0        0     2343 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/scenewidgets/machineoriginwidget.py
--rw-rw-rw-   0        0        0    12668 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/scenewidgets/rectselectwidget.py
--rw-rw-rw-   0        0        0      893 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/scenewidgets/relocatewidget.py
--rw-rw-rw-   0        0        0     2403 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/scenewidgets/reticlewidget.py
--rw-rw-rw-   0        0        0   102834 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/scenewidgets/selectionwidget.py
--rw-rw-rw-   0        0        0    90186 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/simulation.py
--rw-rw-rw-   0        0        0     7291 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/snapoptions.py
--rw-rw-rw-   0        0        0    38052 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/spoolerpanel.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.575480 meerk40t-0.8.2000/meerk40t/gui/statusbarwidgets/
--rw-rw-rw-   0        0        0        0 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/statusbarwidgets/__init__.py
--rw-rw-rw-   0        0        0    17552 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/statusbarwidgets/infowidget.py
--rw-rw-rw-   0        0        0    13731 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/statusbarwidgets/opassignwidget.py
--rw-rw-rw-   0        0        0     3844 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/statusbarwidgets/selectionwidget.py
--rw-rw-rw-   0        0        0     8335 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/statusbarwidgets/shapepropwidget.py
--rw-rw-rw-   0        0        0     9756 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/statusbarwidgets/statusbar.py
--rw-rw-rw-   0        0        0     9050 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/statusbarwidgets/statusbarwidget.py
--rw-rw-rw-   0        0        0     9340 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/statusbarwidgets/strokewidget.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.611482 meerk40t-0.8.2000/meerk40t/gui/toolwidgets/
--rw-rw-rw-   0        0        0        0 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/toolwidgets/__init__.py
--rw-rw-rw-   0        0        0      983 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/toolwidgets/circlebrush.py
--rw-rw-rw-   0        0        0     8606 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/toolwidgets/toolcircle.py
--rw-rw-rw-   0        0        0     1466 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/toolwidgets/toolcontainer.py
--rw-rw-rw-   0        0        0     3303 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/toolwidgets/tooldraw.py
--rw-rw-rw-   0        0        0     8522 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/toolwidgets/toolellipse.py
--rw-rw-rw-   0        0        0     9151 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/toolwidgets/toollinetext.py
--rw-rw-rw-   0        0        0     7583 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/toolwidgets/toolmeasure.py
--rw-rw-rw-   0        0        0    94257 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/toolwidgets/toolnodeedit.py
--rw-rw-rw-   0        0        0     1781 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/toolwidgets/toolpoint.py
--rw-rw-rw-   0        0        0     5708 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/toolwidgets/toolpolygon.py
--rw-rw-rw-   0        0        0     5895 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/toolwidgets/toolpolyline.py
--rw-rw-rw-   0        0        0     8065 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/toolwidgets/toolrect.py
--rw-rw-rw-   0        0        0     2204 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/toolwidgets/toolrelocate.py
--rw-rw-rw-   0        0        0     4224 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/toolwidgets/toolribbon.py
--rw-rw-rw-   0        0        0     3051 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/toolwidgets/tooltext.py
--rw-rw-rw-   0        0        0     6096 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/toolwidgets/toolvector.py
--rw-rw-rw-   0        0        0     1194 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/toolwidgets/toolwidget.py
--rw-rw-rw-   0        0        0     2844 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/usbconnect.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.624483 meerk40t-0.8.2000/meerk40t/gui/utilitywidgets/
--rw-rw-rw-   0        0        0        0 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/utilitywidgets/__init__.py
--rw-rw-rw-   0        0        0     1362 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/utilitywidgets/buttonwidget.py
--rw-rw-rw-   0        0        0     2812 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/utilitywidgets/checkboxwidget.py
--rw-rw-rw-   0        0        0    11773 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/utilitywidgets/cyclocycloidwidget.py
--rw-rw-rw-   0        0        0     5697 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/utilitywidgets/seekbarwidget.py
--rw-rw-rw-   0        0        0     5167 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/utilitywidgets/togglewidget.py
--rw-rw-rw-   0        0        0    35380 2023-02-25 09:09:09.000000 meerk40t-0.8.2000/meerk40t/gui/wordlisteditor.py
--rw-rw-rw-   0        0        0    37469 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/wxmeerk40t.py
--rw-rw-rw-   0        0        0   139489 2023-02-25 09:09:09.000000 meerk40t-0.8.2000/meerk40t/gui/wxmmain.py
--rw-rw-rw-   0        0        0    48320 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/wxmribbon.py
--rw-rw-rw-   0        0        0    43021 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/wxmscene.py
--rw-rw-rw-   0        0        0    69738 2023-02-25 09:09:09.000000 meerk40t-0.8.2000/meerk40t/gui/wxmtree.py
--rw-rw-rw-   0        0        0    32239 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/wxutils.py
--rw-rw-rw-   0        0        0     2807 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/gui/zmatrix.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.628484 meerk40t-0.8.2000/meerk40t/image/
--rw-rw-rw-   0        0        0       16 2022-08-29 19:57:51.000000 meerk40t-0.8.2000/meerk40t/image/__init__.py
--rw-rw-rw-   0        0        0    65138 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/image/imagetools.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.656485 meerk40t-0.8.2000/meerk40t/kernel/
--rw-rw-rw-   0        0        0      344 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/kernel/__init__.py
--rw-rw-rw-   0        0        0     6819 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/kernel/channel.py
--rw-rw-rw-   0        0        0    18205 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/kernel/context.py
--rw-rw-rw-   0        0        0     1187 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/kernel/exceptions.py
--rw-rw-rw-   0        0        0    14995 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/kernel/functions.py
--rw-rw-rw-   0        0        0     2850 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/kernel/jobs.py
--rw-rw-rw-   0        0        0   130888 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/kernel/kernel.py
--rw-rw-rw-   0        0        0     2263 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/kernel/lifecycles.py
--rw-rw-rw-   0        0        0     1978 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/kernel/module.py
--rw-rw-rw-   0        0        0     5212 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/kernel/service.py
--rw-rw-rw-   0        0        0    11546 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/kernel/settings.py
--rw-rw-rw-   0        0        0      181 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/kernel/states.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.678486 meerk40t-0.8.2000/meerk40t/lihuiyu/
--rw-rw-rw-   0        0        0        0 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/lihuiyu/__init__.py
--rw-rw-rw-   0        0        0    31294 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/lihuiyu/controller.py
--rw-rw-rw-   0        0        0    26810 2023-02-25 00:28:24.000000 meerk40t-0.8.2000/meerk40t/lihuiyu/device.py
--rw-rw-rw-   0        0        0    46679 2023-02-25 00:28:24.000000 meerk40t-0.8.2000/meerk40t/lihuiyu/driver.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.694487 meerk40t-0.8.2000/meerk40t/lihuiyu/gui/
--rw-rw-rw-   0        0        0        0 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/lihuiyu/gui/__init__.py
--rw-rw-rw-   0        0        0     4089 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/lihuiyu/gui/gui.py
--rw-rw-rw-   0        0        0    16374 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/lihuiyu/gui/lhyaccelgui.py
--rw-rw-rw-   0        0        0    24487 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/lihuiyu/gui/lhycontrollergui.py
--rw-rw-rw-   0        0        0    45538 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/lihuiyu/gui/lhydrivergui.py
--rw-rw-rw-   0        0        0     9731 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/lihuiyu/gui/lhyoperationproperties.py
--rw-rw-rw-   0        0        0     7407 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/lihuiyu/gui/tcpcontroller.py
--rw-rw-rw-   0        0        0     1692 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/lihuiyu/interpreter.py
--rw-rw-rw-   0        0        0    16333 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/lihuiyu/laserspeed.py
--rw-rw-rw-   0        0        0     2622 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/lihuiyu/loader.py
--rw-rw-rw-   0        0        0    14051 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/lihuiyu/parser.py
--rw-rw-rw-   0        0        0     1236 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/lihuiyu/plugin.py
--rw-rw-rw-   0        0        0     3343 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/lihuiyu/tcp_connection.py
--rw-rw-rw-   0        0        0     6934 2023-02-25 01:22:21.000000 meerk40t-0.8.2000/meerk40t/main.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.708488 meerk40t-0.8.2000/meerk40t/moshi/
--rw-rw-rw-   0        0        0        0 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/moshi/__init__.py
--rw-rw-rw-   0        0        0    13904 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/moshi/builder.py
--rw-rw-rw-   0        0        0    17816 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/moshi/controller.py
--rw-rw-rw-   0        0        0    12733 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/moshi/device.py
--rw-rw-rw-   0        0        0    23733 2023-02-25 00:28:24.000000 meerk40t-0.8.2000/meerk40t/moshi/driver.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.716488 meerk40t-0.8.2000/meerk40t/moshi/gui/
--rw-rw-rw-   0        0        0        0 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/moshi/gui/__init__.py
--rw-rw-rw-   0        0        0     2566 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/moshi/gui/gui.py
--rw-rw-rw-   0        0        0    21985 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/moshi/gui/moshicontrollergui.py
--rw-rw-rw-   0        0        0     3433 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/moshi/gui/moshidrivergui.py
--rw-rw-rw-   0        0        0      536 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/moshi/plugin.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.726489 meerk40t-0.8.2000/meerk40t/network/
--rw-rw-rw-   0        0        0        0 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/network/__init__.py
--rw-rw-rw-   0        0        0     2111 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/network/console_server.py
--rw-rw-rw-   0        0        0      326 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/network/kernelserver.py
--rw-rw-rw-   0        0        0     5028 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/network/tcp_server.py
--rw-rw-rw-   0        0        0     2731 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/network/udp_server.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.730489 meerk40t-0.8.2000/meerk40t/rotary/
--rw-rw-rw-   0        0        0        0 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/rotary/__init__.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.735490 meerk40t-0.8.2000/meerk40t/rotary/gui/
--rw-rw-rw-   0        0        0        0 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/rotary/gui/__init__.py
--rw-rw-rw-   0        0        0     1645 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/rotary/gui/gui.py
--rw-rw-rw-   0        0        0     9569 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/rotary/gui/rotarysettings.py
--rw-rw-rw-   0        0        0     3187 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/rotary/rotary.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.748490 meerk40t-0.8.2000/meerk40t/ruida/
--rw-rw-rw-   0        0        0        0 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/ruida/__init__.py
--rw-rw-rw-   0        0        0     3295 2023-02-25 00:28:24.000000 meerk40t-0.8.2000/meerk40t/ruida/control.py
--rw-rw-rw-   0        0        0     3714 2023-02-25 00:28:24.000000 meerk40t-0.8.2000/meerk40t/ruida/device.py
--rw-rw-rw-   0        0        0    81392 2023-02-25 00:28:24.000000 meerk40t-0.8.2000/meerk40t/ruida/emulator.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.752491 meerk40t-0.8.2000/meerk40t/ruida/gui/
--rw-rw-rw-   0        0        0        0 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/ruida/gui/__init__.py
--rw-rw-rw-   0        0        0     1102 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/ruida/gui/gui.py
--rw-rw-rw-   0        0        0      657 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/ruida/loader.py
--rw-rw-rw-   0        0        0     2298 2023-02-25 00:28:24.000000 meerk40t-0.8.2000/meerk40t/ruida/plugin.py
--rw-rw-rw-   0        0        0   336389 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/svgelements.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.782492 meerk40t-0.8.2000/meerk40t/tools/
--rw-rw-rw-   0        0        0        0 2022-08-29 19:57:51.000000 meerk40t-0.8.2000/meerk40t/tools/__init__.py
--rw-rw-rw-   0        0        0    21315 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/tools/driver_to_path.py
--rw-rw-rw-   0        0        0    94058 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/tools/geomstr.py
--rw-rw-rw-   0        0        0    12007 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/tools/jhfparser.py
--rw-rw-rw-   0        0        0    42326 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/tools/livinghinges.py
--rw-rw-rw-   0        0        0    31362 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/tools/pathtools.py
--rw-rw-rw-   0        0        0    35800 2022-08-29 19:57:51.000000 meerk40t-0.8.2000/meerk40t/tools/pointfinder.py
--rw-rw-rw-   0        0        0    28049 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/tools/polybool.py
--rw-rw-rw-   0        0        0    20221 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/tools/rasterplotter.py
--rw-rw-rw-   0        0        0    30973 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/tools/shxparser.py
--rw-rw-rw-   0        0        0    16287 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/tools/ttfparser.py
--rw-rw-rw-   0        0        0    20709 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/meerk40t/tools/zinglplotter.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.842496 meerk40t-0.8.2000/meerk40t.egg-info/
--rw-rw-rw-   0        0        0     5513 2023-02-25 09:54:30.000000 meerk40t-0.8.2000/meerk40t.egg-info/PKG-INFO
--rw-rw-rw-   0        0        0    21067 2023-02-25 09:54:30.000000 meerk40t-0.8.2000/meerk40t.egg-info/SOURCES.txt
--rw-rw-rw-   0        0        0        1 2023-02-25 09:54:30.000000 meerk40t-0.8.2000/meerk40t.egg-info/dependency_links.txt
--rw-rw-rw-   0        0        0       48 2023-02-25 09:54:30.000000 meerk40t-0.8.2000/meerk40t.egg-info/entry_points.txt
--rw-rw-rw-   0        0        0      284 2023-02-25 09:54:30.000000 meerk40t-0.8.2000/meerk40t.egg-info/requires.txt
--rw-rw-rw-   0        0        0       14 2023-02-25 09:54:30.000000 meerk40t-0.8.2000/meerk40t.egg-info/top_level.txt
--rw-rw-rw-   0        0        0        2 2021-01-18 14:07:22.000000 meerk40t-0.8.2000/meerk40t.egg-info/zip-safe
--rw-rw-rw-   0        0        0    20222 2022-09-23 03:31:07.000000 meerk40t-0.8.2000/pyproject.toml
--rw-rw-rw-   0        0        0     1128 2023-02-25 09:54:31.929501 meerk40t-0.8.2000/setup.cfg
--rw-rw-rw-   0        0        0      581 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/setup.py
-drwxrwxrwx   0        0        0        0 2023-02-25 09:54:31.830495 meerk40t-0.8.2000/test/
--rw-rw-rw-   0        0        0        0 2022-08-29 19:57:51.000000 meerk40t-0.8.2000/test/__init__.py
--rw-rw-rw-   0        0        0     1385 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/test/bootstrap.py
--rw-rw-rw-   0        0        0      232 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/test/test_cli.py
--rw-rw-rw-   0        0        0    17155 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/test/test_core_cutcode.py
--rw-rw-rw-   0        0        0     4323 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/test/test_core_elements.py
--rw-rw-rw-   0        0        0    14608 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/test/test_core_plotplanner.py
--rw-rw-rw-   0        0        0    13742 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/test/test_core_viewports.py
--rw-rw-rw-   0        0        0     2393 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/test/test_drivers_grbl.py
--rw-rw-rw-   0        0        0    16641 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/test/test_drivers_lihuiyu.py
--rw-rw-rw-   0        0        0     2334 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/test/test_element_degenerate_points.py
--rw-rw-rw-   0        0        0     3332 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/test/test_elements_classify.py
--rw-rw-rw-   0        0        0      631 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/test/test_elements_penbox.py
--rw-rw-rw-   0        0        0     5392 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/test/test_fill.py
--rw-rw-rw-   0        0        0    33839 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/test/test_geomstr.py
--rw-rw-rw-   0        0        0    12913 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/test/test_imagetools_actualize.py
--rw-rw-rw-   0        0        0    11767 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/test/test_imagetools_wizard.py
--rw-rw-rw-   0        0        0     4701 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/test/test_kernel.py
--rw-rw-rw-   0        0        0   107060 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/test/test_laser_speeds.py
--rw-rw-rw-   0        0        0     2138 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/test/test_length.py
--rw-rw-rw-   0        0        0     2281 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/test/test_lifecycle.py
--rw-rw-rw-   0        0        0     1265 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/test/test_spooler.py
--rw-rw-rw-   0        0        0     4624 2023-02-25 00:01:30.000000 meerk40t-0.8.2000/test/test_wobble.py
--rw-rw-rw-   0        0        0     4190 2022-12-30 04:02:50.000000 meerk40t-0.8.2000/test/test_zingl.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.569637 meerk40t-0.8.3000/
+-rw-rw-rw-   0        0        0     1086 2022-08-29 19:57:50.000000 meerk40t-0.8.3000/LICENSE
+-rw-rw-rw-   0        0        0     5619 2023-04-13 19:28:32.570638 meerk40t-0.8.3000/PKG-INFO
+-rw-rw-rw-   0        0        0     3981 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/README.md
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.632584 meerk40t-0.8.3000/meerk40t/
+-rw-rw-rw-   0        0        0       19 2022-08-29 19:57:50.000000 meerk40t-0.8.3000/meerk40t/__init__.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.651585 meerk40t-0.8.3000/meerk40t/balormk/
+-rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/balormk/__init__.py
+-rw-rw-rw-   0        0        0     5556 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/balormk/balor_params.py
+-rw-rw-rw-   0        0        0    46666 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/balormk/controller.py
+-rw-rw-rw-   0        0        0    69394 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/balormk/device.py
+-rw-rw-rw-   0        0        0    21033 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/balormk/driver.py
+-rw-rw-rw-   0        0        0     5304 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/balormk/elementlightjob.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.658585 meerk40t-0.8.3000/meerk40t/balormk/gui/
+-rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/balormk/gui/__init__.py
+-rw-rw-rw-   0        0        0     3941 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/balormk/gui/balorconfig.py
+-rw-rw-rw-   0        0        0     5987 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/balormk/gui/balorcontroller.py
+-rw-rw-rw-   0        0        0     5858 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/balormk/gui/baloroperationproperties.py
+-rw-rw-rw-   0        0        0     5311 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/balormk/gui/gui.py
+-rw-rw-rw-   0        0        0     7755 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/balormk/livefulllightjob.py
+-rw-rw-rw-   0        0        0     5981 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/balormk/liveselectionlightjob.py
+-rw-rw-rw-   0        0        0     3646 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/balormk/mock_connection.py
+-rw-rw-rw-   0        0        0     4991 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/balormk/plugin.py
+-rw-rw-rw-   0        0        0    11181 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/balormk/usb_connection.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.663586 meerk40t-0.8.3000/meerk40t/camera/
+-rw-rw-rw-   0        0        0       17 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/camera/__init__.py
+-rw-rw-rw-   0        0        0    13273 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/camera/camera.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.668586 meerk40t-0.8.3000/meerk40t/camera/gui/
+-rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/camera/gui/__init__.py
+-rw-rw-rw-   0        0        0    40400 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/camera/gui/camerapanel.py
+-rw-rw-rw-   0        0        0     2341 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/camera/gui/gui.py
+-rw-rw-rw-   0        0        0    10112 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/camera/plugin.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.674586 meerk40t-0.8.3000/meerk40t/ch341/
+-rw-rw-rw-   0        0        0      739 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/ch341/__init__.py
+-rw-rw-rw-   0        0        0    21033 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/ch341/libusb.py
+-rw-rw-rw-   0        0        0     5511 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/ch341/mock.py
+-rw-rw-rw-   0        0        0     6302 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/ch341/windll.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.702588 meerk40t-0.8.3000/meerk40t/core/
+-rw-rw-rw-   0        0        0       15 2022-08-29 19:57:50.000000 meerk40t-0.8.3000/meerk40t/core/__init__.py
+-rw-rw-rw-   0        0        0    17576 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/bindalias.py
+-rw-rw-rw-   0        0        0      841 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/core.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.725589 meerk40t-0.8.3000/meerk40t/core/cutcode/
+-rw-rw-rw-   0        0        0        0 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/cutcode/__init__.py
+-rw-rw-rw-   0        0        0     2074 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/cutcode/cubiccut.py
+-rw-rw-rw-   0        0        0    12244 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/cutcode/cutcode.py
+-rw-rw-rw-   0        0        0     5392 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/cutcode/cutgroup.py
+-rw-rw-rw-   0        0        0     5129 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/cutcode/cutobject.py
+-rw-rw-rw-   0        0        0      847 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/cutcode/dwellcut.py
+-rw-rw-rw-   0        0        0      727 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/cutcode/gotocut.py
+-rw-rw-rw-   0        0        0      693 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/cutcode/homecut.py
+-rw-rw-rw-   0        0        0      776 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/cutcode/inputcut.py
+-rw-rw-rw-   0        0        0      952 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/cutcode/linecut.py
+-rw-rw-rw-   0        0        0      786 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/cutcode/outputcut.py
+-rw-rw-rw-   0        0        0    10490 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/cutcode/plotcut.py
+-rw-rw-rw-   0        0        0     1653 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/cutcode/quadcut.py
+-rw-rw-rw-   0        0        0     4168 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/cutcode/rastercut.py
+-rw-rw-rw-   0        0        0      892 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/cutcode/setorigincut.py
+-rw-rw-rw-   0        0        0      900 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/cutcode/waitcut.py
+-rw-rw-rw-   0        0        0    41262 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/cutplan.py
+-rw-rw-rw-   0        0        0    10443 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/drivers.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.753591 meerk40t-0.8.3000/meerk40t/core/elements/
+-rw-rw-rw-   0        0        0        0 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/elements/__init__.py
+-rw-rw-rw-   0        0        0    24140 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/elements/align.py
+-rw-rw-rw-   0        0        0    50660 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/elements/branches.py
+-rw-rw-rw-   0        0        0     7178 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/elements/clipboard.py
+-rw-rw-rw-   0        0        0    87682 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/elements/element_treeops.py
+-rw-rw-rw-   0        0        0     2561 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/elements/element_types.py
+-rw-rw-rw-   0        0        0   149392 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/elements/elements.py
+-rw-rw-rw-   0        0        0    19772 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/elements/grid.py
+-rw-rw-rw-   0        0        0     3212 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/elements/materials.py
+-rw-rw-rw-   0        0        0     1152 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/elements/notes.py
+-rw-rw-rw-   0        0        0    10838 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/elements/penbox.py
+-rw-rw-rw-   0        0        0    23836 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/elements/render.py
+-rw-rw-rw-   0        0        0    76441 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/elements/shapes.py
+-rw-rw-rw-   0        0        0    15500 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/core/elements/trace.py
+-rw-rw-rw-   0        0        0    14470 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/elements/tree_commands.py
+-rw-rw-rw-   0        0        0     1571 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/elements/undo_redo.py
+-rw-rw-rw-   0        0        0     8274 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/elements/wordlist.py
+-rw-rw-rw-   0        0        0      269 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/core/exceptions.py
+-rw-rw-rw-   0        0        0     9609 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/laserjob.py
+-rw-rw-rw-   0        0        0     2136 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/logging.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.814594 meerk40t-0.8.3000/meerk40t/core/node/
+-rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/core/node/__init__.py
+-rw-rw-rw-   0        0        0     1260 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/node/blobnode.py
+-rw-rw-rw-   0        0        0     3949 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/node/bootstrap.py
+-rw-rw-rw-   0        0        0      894 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/node/branch_elems.py
+-rw-rw-rw-   0        0        0     1188 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/node/branch_ops.py
+-rw-rw-rw-   0        0        0     1236 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/node/branch_regmark.py
+-rw-rw-rw-   0        0        0      937 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/node/cutnode.py
+-rw-rw-rw-   0        0        0     6801 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/core/node/elem_ellipse.py
+-rw-rw-rw-   0        0        0     3187 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/node/elem_geomstr.py
+-rw-rw-rw-   0        0        0    30090 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/core/node/elem_image.py
+-rw-rw-rw-   0        0        0     6789 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/core/node/elem_line.py
+-rw-rw-rw-   0        0        0     6597 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/node/elem_path.py
+-rw-rw-rw-   0        0        0     2654 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/core/node/elem_point.py
+-rw-rw-rw-   0        0        0     7041 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/core/node/elem_polyline.py
+-rw-rw-rw-   0        0        0     6805 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/core/node/elem_rect.py
+-rw-rw-rw-   0        0        0    15489 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/node/elem_text.py
+-rw-rw-rw-   0        0        0     1088 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/node/filenode.py
+-rw-rw-rw-   0        0        0     2139 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/node/groupnode.py
+-rw-rw-rw-   0        0        0     1881 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/node/lasercodenode.py
+-rw-rw-rw-   0        0        0      928 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/node/layernode.py
+-rw-rw-rw-   0        0        0     2151 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/node/mixins.py
+-rw-rw-rw-   0        0        0    36602 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/node/node.py
+-rw-rw-rw-   0        0        0     3248 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/node/nutils.py
+-rw-rw-rw-   0        0        0    12129 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/core/node/op_cut.py
+-rw-rw-rw-   0        0        0    10322 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/node/op_dots.py
+-rw-rw-rw-   0        0        0    12180 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/core/node/op_engrave.py
+-rw-rw-rw-   0        0        0    15187 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/core/node/op_hatch.py
+-rw-rw-rw-   0        0        0    14409 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/node/op_image.py
+-rw-rw-rw-   0        0        0    20645 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/node/op_raster.py
+-rw-rw-rw-   0        0        0     1580 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/node/refnode.py
+-rw-rw-rw-   0        0        0     7504 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/node/rootnode.py
+-rw-rw-rw-   0        0        0     1511 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/node/util_console.py
+-rw-rw-rw-   0        0        0     2216 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/node/util_goto.py
+-rw-rw-rw-   0        0        0     1955 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/node/util_home.py
+-rw-rw-rw-   0        0        0     3411 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/node/util_input.py
+-rw-rw-rw-   0        0        0     2450 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/node/util_origin.py
+-rw-rw-rw-   0        0        0     3451 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/node/util_output.py
+-rw-rw-rw-   0        0        0     2220 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/node/util_wait.py
+-rw-rw-rw-   0        0        0    16353 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/core/parameters.py
+-rw-rw-rw-   0        0        0    30434 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/planner.py
+-rw-rw-rw-   0        0        0    22754 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/plotplanner.py
+-rw-rw-rw-   0        0        0    26854 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/spoolers.py
+-rw-rw-rw-   0        0        0    47769 2023-04-13 19:21:44.000000 meerk40t-0.8.3000/meerk40t/core/svg_io.py
+-rw-rw-rw-   0        0        0     6158 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/core/treeop.py
+-rw-rw-rw-   0        0        0     2858 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/core/undos.py
+-rw-rw-rw-   0        0        0    36569 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/units.py
+-rw-rw-rw-   0        0        0     2859 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/webhelp.py
+-rw-rw-rw-   0        0        0    17542 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/core/wordlist.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.819594 meerk40t-0.8.3000/meerk40t/device/
+-rw-rw-rw-   0        0        0       17 2022-08-29 19:57:51.000000 meerk40t-0.8.3000/meerk40t/device/__init__.py
+-rw-rw-rw-   0        0        0     4253 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/device/basedevice.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.828595 meerk40t-0.8.3000/meerk40t/device/ch341/
+-rw-rw-rw-   0        0        0       16 2022-08-29 19:57:51.000000 meerk40t-0.8.3000/meerk40t/device/ch341/__init__.py
+-rw-rw-rw-   0        0        0     7197 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/device/ch341/ch341.py
+-rw-rw-rw-   0        0        0    16050 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/device/ch341/ch341libusbdriver.py
+-rw-rw-rw-   0        0        0     5505 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/device/ch341/libusb.py
+-rw-rw-rw-   0        0        0     5948 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/device/ch341/mock.py
+-rw-rw-rw-   0        0        0     6759 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/device/ch341/windll.py
+-rw-rw-rw-   0        0        0     4504 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/device/dummydevice.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.835595 meerk40t-0.8.3000/meerk40t/device/gui/
+-rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/device/gui/__init__.py
+-rw-rw-rw-   0        0        0    23841 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/device/gui/defaultactions.py
+-rw-rw-rw-   0        0        0    10140 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/device/gui/formatterpanel.py
+-rw-rw-rw-   0        0        0     9284 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/device/gui/warningpanel.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.840596 meerk40t-0.8.3000/meerk40t/dxf/
+-rw-rw-rw-   0        0        0       14 2022-08-29 19:57:51.000000 meerk40t-0.8.3000/meerk40t/dxf/__init__.py
+-rw-rw-rw-   0        0        0    23432 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/dxf/dxf_io.py
+-rw-rw-rw-   0        0        0     1318 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/dxf/plugin.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.854596 meerk40t-0.8.3000/meerk40t/extra/
+-rw-rw-rw-   0        0        0        0 2022-08-29 19:57:51.000000 meerk40t-0.8.3000/meerk40t/extra/__init__.py
+-rw-rw-rw-   0        0        0     4516 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/extra/cag.py
+-rw-rw-rw-   0        0        0     2027 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/extra/embroider.py
+-rw-rw-rw-   0        0        0    11380 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/extra/hershey.py
+-rw-rw-rw-   0        0        0    12235 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/extra/imageactions.py
+-rw-rw-rw-   0        0        0    22736 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/extra/inkscape.py
+-rw-rw-rw-   0        0        0     8348 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/extra/pathoptimize.py
+-rw-rw-rw-   0        0        0     9470 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/extra/potrace.py
+-rw-rw-rw-   0        0        0    12356 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/extra/updater.py
+-rw-rw-rw-   0        0        0     5120 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/extra/vectrace.py
+-rw-rw-rw-   0        0        0     2769 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/extra/winsleep.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.859597 meerk40t-0.8.3000/meerk40t/fill/
+-rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/fill/__init__.py
+-rw-rw-rw-   0        0        0    10357 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/fill/fills.py
+-rw-rw-rw-   0        0        0    38279 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/fill/patternfill.py
+-rw-rw-rw-   0        0        0    16519 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/fill/patterns.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.879598 meerk40t-0.8.3000/meerk40t/grbl/
+-rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/grbl/__init__.py
+-rw-rw-rw-   0        0        0     2668 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/grbl/control.py
+-rw-rw-rw-   0        0        0    18490 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/grbl/controller.py
+-rw-rw-rw-   0        0        0    23410 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/grbl/device.py
+-rw-rw-rw-   0        0        0    22452 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/grbl/driver.py
+-rw-rw-rw-   0        0        0    18743 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/grbl/emulator.py
+-rw-rw-rw-   0        0        0    27894 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/grbl/gcodejob.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.887598 meerk40t-0.8.3000/meerk40t/grbl/gui/
+-rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/grbl/gui/__init__.py
+-rw-rw-rw-   0        0        0     6535 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/grbl/gui/grblconfiguration.py
+-rw-rw-rw-   0        0        0     8386 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/grbl/gui/grblserialcontroller.py
+-rw-rw-rw-   0        0        0     3800 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/grbl/gui/gui.py
+-rw-rw-rw-   0        0        0     6870 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/grbl/gui/tcpcontroller.py
+-rw-rw-rw-   0        0        0     1719 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/grbl/interpreter.py
+-rw-rw-rw-   0        0        0      617 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/grbl/loader.py
+-rw-rw-rw-   0        0        0     1677 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/grbl/mock_connection.py
+-rw-rw-rw-   0        0        0     5760 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/grbl/plugin.py
+-rw-rw-rw-   0        0        0     2667 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/grbl/serial_connection.py
+-rw-rw-rw-   0        0        0     2602 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/grbl/tcp_connection.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.957602 meerk40t-0.8.3000/meerk40t/gui/
+-rw-rw-rw-   0        0        0       14 2022-08-29 19:57:51.000000 meerk40t-0.8.3000/meerk40t/gui/__init__.py
+-rw-rw-rw-   0        0        0    11627 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/about.py
+-rw-rw-rw-   0        0        0    64914 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/alignment.py
+-rw-rw-rw-   0        0        0     2314 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/bufferview.py
+-rw-rw-rw-   0        0        0     2645 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/busy.py
+-rw-rw-rw-   0        0        0    62799 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/choicepropertypanel.py
+-rw-rw-rw-   0        0        0    18111 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/consolepanel.py
+-rw-rw-rw-   0        0        0    20394 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/devicepanel.py
+-rw-rw-rw-   0        0        0     3866 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/dialogoptions.py
+-rw-rw-rw-   0        0        0    11766 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/executejob.py
+-rw-rw-rw-   0        0        0     2800 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/fonts.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.959602 meerk40t-0.8.3000/meerk40t/gui/help_assets/
+-rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/help_assets/__init__.py
+-rw-rw-rw-   0        0        0     9381 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/help_assets/help_assets.py
+-rw-rw-rw-   0        0        0    31290 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/hersheymanager.py
+-rw-rw-rw-   0        0        0   242725 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/icons.py
+-rw-rw-rw-   0        0        0    19129 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/imagesplitter.py
+-rw-rw-rw-   0        0        0    11758 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/keymap.py
+-rw-rw-rw-   0        0        0    23975 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/laserpanel.py
+-rw-rw-rw-   0        0        0    40207 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/laserrender.py
+-rw-rw-rw-   0        0        0    30777 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/lasertoolpanel.py
+-rw-rw-rw-   0        0        0    56121 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/materialtest.py
+-rw-rw-rw-   0        0        0     3623 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/mkdebug.py
+-rw-rw-rw-   0        0        0     4640 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/mwindow.py
+-rw-rw-rw-   0        0        0    81819 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/navigationpanels.py
+-rw-rw-rw-   0        0        0     4715 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/notes.py
+-rw-rw-rw-   0        0        0    14969 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/opassignment.py
+-rw-rw-rw-   0        0        0    10919 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/operation_info.py
+-rw-rw-rw-   0        0        0    11670 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/plugin.py
+-rw-rw-rw-   0        0        0    20747 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/position.py
+-rw-rw-rw-   0        0        0    21256 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/preferences.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.983604 meerk40t-0.8.3000/meerk40t/gui/propertypanels/
+-rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/propertypanels/__init__.py
+-rw-rw-rw-   0        0        0    38620 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/propertypanels/attributes.py
+-rw-rw-rw-   0        0        0     5561 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/propertypanels/blobproperty.py
+-rw-rw-rw-   0        0        0     2837 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/propertypanels/consoleproperty.py
+-rw-rw-rw-   0        0        0     7360 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/propertypanels/groupproperties.py
+-rw-rw-rw-   0        0        0    53861 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/propertypanels/imageproperty.py
+-rw-rw-rw-   0        0        0     1781 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/propertypanels/inputproperty.py
+-rw-rw-rw-   0        0        0     2612 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/propertypanels/opbranchproperties.py
+-rw-rw-rw-   0        0        0    69312 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/propertypanels/operationpropertymain.py
+-rw-rw-rw-   0        0        0     1789 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/propertypanels/outputproperty.py
+-rw-rw-rw-   0        0        0    13370 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/propertypanels/pathproperty.py
+-rw-rw-rw-   0        0        0     4398 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/propertypanels/pointproperty.py
+-rw-rw-rw-   0        0        0     5748 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/propertypanels/propertywindow.py
+-rw-rw-rw-   0        0        0    36709 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/propertypanels/rasterwizardpanels.py
+-rw-rw-rw-   0        0        0    27959 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/gui/propertypanels/textproperty.py
+-rw-rw-rw-   0        0        0     1771 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/propertypanels/waitproperty.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:31.993605 meerk40t-0.8.3000/meerk40t/gui/scene/
+-rw-rw-rw-   0        0        0        0 2022-08-29 19:57:51.000000 meerk40t-0.8.3000/meerk40t/gui/scene/__init__.py
+-rw-rw-rw-   0        0        0     5180 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/scene/guicolors.py
+-rw-rw-rw-   0        0        0    33615 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/scene/scene.py
+-rw-rw-rw-   0        0        0      648 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/scene/sceneconst.py
+-rw-rw-rw-   0        0        0    11695 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/scene/scenepanel.py
+-rw-rw-rw-   0        0        0    13224 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/scene/scenespacewidget.py
+-rw-rw-rw-   0        0        0    15826 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/scene/widget.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.012606 meerk40t-0.8.3000/meerk40t/gui/scenewidgets/
+-rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/scenewidgets/__init__.py
+-rw-rw-rw-   0        0        0    16441 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/scenewidgets/attractionwidget.py
+-rw-rw-rw-   0        0        0     3033 2023-03-14 23:32:20.000000 meerk40t-0.8.3000/meerk40t/gui/scenewidgets/bedwidget.py
+-rw-rw-rw-   0        0        0     3091 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/scenewidgets/elementswidget.py
+-rw-rw-rw-   0        0        0    28381 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/scenewidgets/gridwidget.py
+-rw-rw-rw-   0        0        0    28989 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/scenewidgets/guidewidget.py
+-rw-rw-rw-   0        0        0     1876 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/scenewidgets/laserpathwidget.py
+-rw-rw-rw-   0        0        0     2343 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/scenewidgets/machineoriginwidget.py
+-rw-rw-rw-   0        0        0    12668 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/scenewidgets/rectselectwidget.py
+-rw-rw-rw-   0        0        0     1196 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/scenewidgets/relocatewidget.py
+-rw-rw-rw-   0        0        0     2403 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/scenewidgets/reticlewidget.py
+-rw-rw-rw-   0        0        0   103117 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/gui/scenewidgets/selectionwidget.py
+-rw-rw-rw-   0        0        0    90312 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/simulation.py
+-rw-rw-rw-   0        0        0     7291 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/snapoptions.py
+-rw-rw-rw-   0        0        0    39076 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/gui/spoolerpanel.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.024606 meerk40t-0.8.3000/meerk40t/gui/statusbarwidgets/
+-rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/statusbarwidgets/__init__.py
+-rw-rw-rw-   0        0        0    17561 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/statusbarwidgets/infowidget.py
+-rw-rw-rw-   0        0        0    13740 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/statusbarwidgets/opassignwidget.py
+-rw-rw-rw-   0        0        0     3844 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/statusbarwidgets/selectionwidget.py
+-rw-rw-rw-   0        0        0     8335 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/statusbarwidgets/shapepropwidget.py
+-rw-rw-rw-   0        0        0     9756 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/statusbarwidgets/statusbar.py
+-rw-rw-rw-   0        0        0     9050 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/statusbarwidgets/statusbarwidget.py
+-rw-rw-rw-   0        0        0     9357 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/statusbarwidgets/strokewidget.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.052608 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/
+-rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/__init__.py
+-rw-rw-rw-   0        0        0      983 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/circlebrush.py
+-rw-rw-rw-   0        0        0     8750 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolcircle.py
+-rw-rw-rw-   0        0        0     1476 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolcontainer.py
+-rw-rw-rw-   0        0        0     3313 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/tooldraw.py
+-rw-rw-rw-   0        0        0     8603 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolellipse.py
+-rw-rw-rw-   0        0        0     9358 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toollinetext.py
+-rw-rw-rw-   0        0        0     7613 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolmeasure.py
+-rw-rw-rw-   0        0        0    94489 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolnodeedit.py
+-rw-rw-rw-   0        0        0     1791 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolpoint.py
+-rw-rw-rw-   0        0        0     7078 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolpolygon.py
+-rw-rw-rw-   0        0        0     7173 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolpolyline.py
+-rw-rw-rw-   0        0        0     8146 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolrect.py
+-rw-rw-rw-   0        0        0     2229 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolrelocate.py
+-rw-rw-rw-   0        0        0     4234 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolribbon.py
+-rw-rw-rw-   0        0        0     3061 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/tooltext.py
+-rw-rw-rw-   0        0        0     7516 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolvector.py
+-rw-rw-rw-   0        0        0     1194 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolwidget.py
+-rw-rw-rw-   0        0        0     2844 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/usbconnect.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.069609 meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/
+-rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/__init__.py
+-rw-rw-rw-   0        0        0      737 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/buttonwidget.py
+-rw-rw-rw-   0        0        0     2812 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/checkboxwidget.py
+-rw-rw-rw-   0        0        0    11773 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/cyclocycloidwidget.py
+-rw-rw-rw-   0        0        0      926 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/handlewidget.py
+-rw-rw-rw-   0        0        0    13518 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/harmonograph.py
+-rw-rw-rw-   0        0        0     1073 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/openclosewidget.py
+-rw-rw-rw-   0        0        0     1914 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/rotationwidget.py
+-rw-rw-rw-   0        0        0     2776 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/scalewidget.py
+-rw-rw-rw-   0        0        0     5697 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/seekbarwidget.py
+-rw-rw-rw-   0        0        0     5167 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/togglewidget.py
+-rw-rw-rw-   0        0        0      344 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/toolbarwidget.py
+-rw-rw-rw-   0        0        0    35380 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/gui/wordlisteditor.py
+-rw-rw-rw-   0        0        0    37467 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/wxmeerk40t.py
+-rw-rw-rw-   0        0        0   139114 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/gui/wxmmain.py
+-rw-rw-rw-   0        0        0    54031 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/wxmribbon.py
+-rw-rw-rw-   0        0        0    49719 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/wxmscene.py
+-rw-rw-rw-   0        0        0    69738 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/wxmtree.py
+-rw-rw-rw-   0        0        0    32739 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/gui/wxutils.py
+-rw-rw-rw-   0        0        0     2807 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/gui/zmatrix.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.072609 meerk40t-0.8.3000/meerk40t/image/
+-rw-rw-rw-   0        0        0       16 2022-08-29 19:57:51.000000 meerk40t-0.8.3000/meerk40t/image/__init__.py
+-rw-rw-rw-   0        0        0    65324 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/image/imagetools.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.090610 meerk40t-0.8.3000/meerk40t/kernel/
+-rw-rw-rw-   0        0        0      344 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/kernel/__init__.py
+-rw-rw-rw-   0        0        0     6819 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/kernel/channel.py
+-rw-rw-rw-   0        0        0    18205 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/kernel/context.py
+-rw-rw-rw-   0        0        0     1187 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/kernel/exceptions.py
+-rw-rw-rw-   0        0        0    14995 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/kernel/functions.py
+-rw-rw-rw-   0        0        0     2850 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/kernel/jobs.py
+-rw-rw-rw-   0        0        0   132505 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/kernel/kernel.py
+-rw-rw-rw-   0        0        0     2263 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/kernel/lifecycles.py
+-rw-rw-rw-   0        0        0     1978 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/kernel/module.py
+-rw-rw-rw-   0        0        0     5212 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/kernel/service.py
+-rw-rw-rw-   0        0        0    11606 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/kernel/settings.py
+-rw-rw-rw-   0        0        0      181 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/kernel/states.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.104611 meerk40t-0.8.3000/meerk40t/lihuiyu/
+-rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/__init__.py
+-rw-rw-rw-   0        0        0    31603 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/controller.py
+-rw-rw-rw-   0        0        0    39947 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/device.py
+-rw-rw-rw-   0        0        0    46862 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/driver.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.115611 meerk40t-0.8.3000/meerk40t/lihuiyu/gui/
+-rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/gui/__init__.py
+-rw-rw-rw-   0        0        0     4089 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/gui/gui.py
+-rw-rw-rw-   0        0        0    16374 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/gui/lhyaccelgui.py
+-rw-rw-rw-   0        0        0    24793 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/gui/lhycontrollergui.py
+-rw-rw-rw-   0        0        0    17367 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/gui/lhydrivergui.py
+-rw-rw-rw-   0        0        0     9731 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/gui/lhyoperationproperties.py
+-rw-rw-rw-   0        0        0     7407 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/gui/tcpcontroller.py
+-rw-rw-rw-   0        0        0     1692 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/interpreter.py
+-rw-rw-rw-   0        0        0    16341 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/laserspeed.py
+-rw-rw-rw-   0        0        0     2622 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/loader.py
+-rw-rw-rw-   0        0        0    13937 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/parser.py
+-rw-rw-rw-   0        0        0     3815 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/plugin.py
+-rw-rw-rw-   0        0        0     3474 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/lihuiyu/tcp_connection.py
+-rw-rw-rw-   0        0        0     7233 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/main.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.124612 meerk40t-0.8.3000/meerk40t/moshi/
+-rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/moshi/__init__.py
+-rw-rw-rw-   0        0        0    13904 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/moshi/builder.py
+-rw-rw-rw-   0        0        0    17816 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/moshi/controller.py
+-rw-rw-rw-   0        0        0    15320 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/moshi/device.py
+-rw-rw-rw-   0        0        0    23830 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/moshi/driver.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.128612 meerk40t-0.8.3000/meerk40t/moshi/gui/
+-rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/moshi/gui/__init__.py
+-rw-rw-rw-   0        0        0     2566 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/moshi/gui/gui.py
+-rw-rw-rw-   0        0        0    21985 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/moshi/gui/moshicontrollergui.py
+-rw-rw-rw-   0        0        0     3661 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/moshi/gui/moshidrivergui.py
+-rw-rw-rw-   0        0        0     1462 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/moshi/plugin.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.135613 meerk40t-0.8.3000/meerk40t/network/
+-rw-rw-rw-   0        0        0        0 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/network/__init__.py
+-rw-rw-rw-   0        0        0     2111 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/network/console_server.py
+-rw-rw-rw-   0        0        0      326 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/network/kernelserver.py
+-rw-rw-rw-   0        0        0     5028 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/network/tcp_server.py
+-rw-rw-rw-   0        0        0     2731 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/network/udp_server.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.148613 meerk40t-0.8.3000/meerk40t/newly/
+-rw-rw-rw-   0        0        0        0 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/newly/__init__.py
+-rw-rw-rw-   0        0        0    34652 2023-04-13 19:19:20.000000 meerk40t-0.8.3000/meerk40t/newly/controller.py
+-rw-rw-rw-   0        0        0    24466 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/newly/device.py
+-rw-rw-rw-   0        0        0    12770 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/newly/driver.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.155614 meerk40t-0.8.3000/meerk40t/newly/gui/
+-rw-rw-rw-   0        0        0        0 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/newly/gui/__init__.py
+-rw-rw-rw-   0        0        0     7263 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/newly/gui/gui.py
+-rw-rw-rw-   0        0        0     3586 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/newly/gui/newlyconfig.py
+-rw-rw-rw-   0        0        0     6105 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/newly/gui/newlycontroller.py
+-rw-rw-rw-   0        0        0     1504 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/newly/gui/operationproperties.py
+-rw-rw-rw-   0        0        0     2646 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/newly/mock_connection.py
+-rw-rw-rw-   0        0        0     1642 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/newly/newly_params.py
+-rw-rw-rw-   0        0        0    44191 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/newly/plugin.py
+-rw-rw-rw-   0        0        0    12062 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/newly/usb_connection.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.158614 meerk40t-0.8.3000/meerk40t/rotary/
+-rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/rotary/__init__.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.162614 meerk40t-0.8.3000/meerk40t/rotary/gui/
+-rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/rotary/gui/__init__.py
+-rw-rw-rw-   0        0        0     1645 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/rotary/gui/gui.py
+-rw-rw-rw-   0        0        0     9599 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/rotary/gui/rotarysettings.py
+-rw-rw-rw-   0        0        0     3187 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/rotary/rotary.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.178615 meerk40t-0.8.3000/meerk40t/ruida/
+-rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/ruida/__init__.py
+-rw-rw-rw-   0        0        0     3256 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/ruida/control.py
+-rw-rw-rw-   0        0        0    31762 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/ruida/controller.py
+-rw-rw-rw-   0        0        0     6448 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/ruida/device.py
+-rw-rw-rw-   0        0        0    15377 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/ruida/driver.py
+-rw-rw-rw-   0        0        0    53016 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/ruida/emulator.py
+-rw-rw-rw-   0        0        0      120 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/ruida/exceptions.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.186616 meerk40t-0.8.3000/meerk40t/ruida/gui/
+-rw-rw-rw-   0        0        0        0 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/meerk40t/ruida/gui/__init__.py
+-rw-rw-rw-   0        0        0     2840 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/ruida/gui/gui.py
+-rw-rw-rw-   0        0        0     2505 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/ruida/gui/ruidaconfig.py
+-rw-rw-rw-   0        0        0     5987 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/ruida/gui/ruidacontroller.py
+-rw-rw-rw-   0        0        0     1274 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/ruida/gui/ruidaoperationproperties.py
+-rw-rw-rw-   0        0        0      657 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/ruida/loader.py
+-rw-rw-rw-   0        0        0     3654 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/ruida/mock_connection.py
+-rw-rw-rw-   0        0        0     3157 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/ruida/plugin.py
+-rw-rw-rw-   0        0        0    45282 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/ruida/rdjob.py
+-rw-rw-rw-   0        0        0   338649 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/svgelements.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.206617 meerk40t-0.8.3000/meerk40t/tools/
+-rw-rw-rw-   0        0        0        0 2022-08-29 19:57:51.000000 meerk40t-0.8.3000/meerk40t/tools/__init__.py
+-rw-rw-rw-   0        0        0    21419 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/meerk40t/tools/driver_to_path.py
+-rw-rw-rw-   0        0        0    94058 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/tools/geomstr.py
+-rw-rw-rw-   0        0        0    12007 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/tools/jhfparser.py
+-rw-rw-rw-   0        0        0    42419 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/tools/livinghinges.py
+-rw-rw-rw-   0        0        0    31362 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/tools/pathtools.py
+-rw-rw-rw-   0        0        0    35800 2022-08-29 19:57:51.000000 meerk40t-0.8.3000/meerk40t/tools/pointfinder.py
+-rw-rw-rw-   0        0        0    28108 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/meerk40t/tools/polybool.py
+-rw-rw-rw-   0        0        0    20221 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/tools/rasterplotter.py
+-rw-rw-rw-   0        0        0    30973 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/tools/shxparser.py
+-rw-rw-rw-   0        0        0    16287 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/tools/ttfparser.py
+-rw-rw-rw-   0        0        0    20709 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/meerk40t/tools/zinglplotter.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.471632 meerk40t-0.8.3000/meerk40t.egg-info/
+-rw-rw-rw-   0        0        0     5619 2023-04-13 19:28:31.000000 meerk40t-0.8.3000/meerk40t.egg-info/PKG-INFO
+-rw-rw-rw-   0        0        0    24970 2023-04-13 19:28:31.000000 meerk40t-0.8.3000/meerk40t.egg-info/SOURCES.txt
+-rw-rw-rw-   0        0        0        1 2023-04-13 19:28:31.000000 meerk40t-0.8.3000/meerk40t.egg-info/dependency_links.txt
+-rw-rw-rw-   0        0        0       48 2023-04-13 19:28:31.000000 meerk40t-0.8.3000/meerk40t.egg-info/entry_points.txt
+-rw-rw-rw-   0        0        0      284 2023-04-13 19:28:31.000000 meerk40t-0.8.3000/meerk40t.egg-info/requires.txt
+-rw-rw-rw-   0        0        0       14 2023-04-13 19:28:31.000000 meerk40t-0.8.3000/meerk40t.egg-info/top_level.txt
+-rw-rw-rw-   0        0        0        2 2021-01-18 14:07:22.000000 meerk40t-0.8.3000/meerk40t.egg-info/zip-safe
+-rw-rw-rw-   0        0        0    20222 2022-09-23 03:31:07.000000 meerk40t-0.8.3000/pyproject.toml
+-rw-rw-rw-   0        0        0     1128 2023-04-13 19:28:32.571637 meerk40t-0.8.3000/setup.cfg
+-rw-rw-rw-   0        0        0      581 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/setup.py
+drwxrwxrwx   0        0        0        0 2023-04-13 19:28:32.243619 meerk40t-0.8.3000/test/
+-rw-rw-rw-   0        0        0        0 2022-08-29 19:57:51.000000 meerk40t-0.8.3000/test/__init__.py
+-rw-rw-rw-   0        0        0     1493 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/test/bootstrap.py
+-rw-rw-rw-   0        0        0      232 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/test/test_cli.py
+-rw-rw-rw-   0        0        0    17155 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/test/test_core_cutcode.py
+-rw-rw-rw-   0        0        0     4323 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/test/test_core_elements.py
+-rw-rw-rw-   0        0        0    14608 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/test/test_core_plotplanner.py
+-rw-rw-rw-   0        0        0    13742 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/test/test_core_viewports.py
+-rw-rw-rw-   0        0        0     2393 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/test/test_drivers_grbl.py
+-rw-rw-rw-   0        0        0    16583 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/test/test_drivers_lihuiyu.py
+-rw-rw-rw-   0        0        0     2343 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/test/test_element_degenerate_points.py
+-rw-rw-rw-   0        0        0     3341 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/test/test_elements_classify.py
+-rw-rw-rw-   0        0        0      632 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/test/test_elements_penbox.py
+-rw-rw-rw-   0        0        0     5392 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/test/test_fill.py
+-rw-rw-rw-   0        0        0    32554 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/test/test_geomstr.py
+-rw-rw-rw-   0        0        0    12913 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/test/test_imagetools_actualize.py
+-rw-rw-rw-   0        0        0    11767 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/test/test_imagetools_wizard.py
+-rw-rw-rw-   0        0        0     4701 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/test/test_kernel.py
+-rw-rw-rw-   0        0        0   107060 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/test/test_laser_speeds.py
+-rw-rw-rw-   0        0        0     2138 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/test/test_length.py
+-rw-rw-rw-   0        0        0     2281 2023-04-13 15:41:25.000000 meerk40t-0.8.3000/test/test_lifecycle.py
+-rw-rw-rw-   0        0        0     1119 2023-04-13 18:18:16.000000 meerk40t-0.8.3000/test/test_operations_hatch.py
+-rw-rw-rw-   0        0        0      591 2023-04-13 15:44:12.000000 meerk40t-0.8.3000/test/test_spooler.py
+-rw-rw-rw-   0        0        0     4624 2023-03-06 12:15:27.000000 meerk40t-0.8.3000/test/test_wobble.py
+-rw-rw-rw-   0        0        0     4190 2022-12-30 04:02:50.000000 meerk40t-0.8.3000/test/test_zingl.py
```

### Comparing `meerk40t-0.8.2000/LICENSE` & `meerk40t-0.8.3000/LICENSE`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/PKG-INFO` & `meerk40t-0.8.3000/PKG-INFO`

 * *Files 3% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: meerk40t
-Version: 0.8.2000
+Version: 0.8.3000
 Summary: MeerK40t LaserCutter Software
 Home-page: https://github.com/meerk40t/meerk40t
 Author: Tatarize
 Author-email: tatarize@gmail.com
 License: MIT
 Description: # MeerK40t
         MeerK40t (pronounced MeerKat) is a built-from-the-ground-up MIT licensed open-source laser cutting software.
@@ -60,20 +60,21 @@
         If you have a bug, feature request, or other issue raise it here. These are likely to be resolved. Squeaky wheels get the grease.
         https://github.com/meerk40t/meerk40t/issues
         
         If you need additional support, please research/ask on:
         
         *   [Facebook](https://www.facebook.com/groups/716000085655097/)
         *   [Maker Forums](https://forum.makerforums.info/t/about-the-meerk40t-category/79660)
-        *   [Youtube - David Olsen's channel](https://www.youtube.com/channel/UCsAUV23O2FyKxC0HN7nkAQQ)
+        *   [YouTube - David Olsen's channel](https://www.youtube.com/channel/UCsAUV23O2FyKxC0HN7nkAQQ)
+        *   [YouTube - Some instruction videos](https://www.youtube.com/channel/UCMN9gGvpacxZINPZCSOecaQ)
         *   [Discord](https://discord.gg/vkDD3HdQq6)
         
         ## Assisting the Project
         
-        Open source projects live and die with their support. There are a lots of ways to help the project. There are also a lot of ways the project should help you. 
+        Open source projects live and die with their support. There are a lots of ways to help the project. There are also a lot of ways the project should help you.
         *   Code
         *   Provide Translations in other languages.
         *   Design ( Good design instincts, smooth out the rough edges)
         *   Compile/Testers
         *   Beta testers
         *   Make helpful support content
         *   Make guides ("How to setup cameras?", etc)
```

### Comparing `meerk40t-0.8.2000/README.md` & `meerk40t-0.8.3000/README.md`

 * *Files 4% similar despite different names*

```diff
@@ -52,20 +52,21 @@
 If you have a bug, feature request, or other issue raise it here. These are likely to be resolved. Squeaky wheels get the grease.
 https://github.com/meerk40t/meerk40t/issues
 
 If you need additional support, please research/ask on:
 
 *   [Facebook](https://www.facebook.com/groups/716000085655097/)
 *   [Maker Forums](https://forum.makerforums.info/t/about-the-meerk40t-category/79660)
-*   [Youtube - David Olsen's channel](https://www.youtube.com/channel/UCsAUV23O2FyKxC0HN7nkAQQ)
+*   [YouTube - David Olsen's channel](https://www.youtube.com/channel/UCsAUV23O2FyKxC0HN7nkAQQ)
+*   [YouTube - Some instruction videos](https://www.youtube.com/channel/UCMN9gGvpacxZINPZCSOecaQ)
 *   [Discord](https://discord.gg/vkDD3HdQq6)
 
 ## Assisting the Project
 
-Open source projects live and die with their support. There are a lots of ways to help the project. There are also a lot of ways the project should help you. 
+Open source projects live and die with their support. There are a lots of ways to help the project. There are also a lot of ways the project should help you.
 *   Code
 *   Provide Translations in other languages.
 *   Design ( Good design instincts, smooth out the rough edges)
 *   Compile/Testers
 *   Beta testers
 *   Make helpful support content
 *   Make guides ("How to setup cameras?", etc)
```

### Comparing `meerk40t-0.8.2000/meerk40t/balormk/balor_params.py` & `meerk40t-0.8.3000/meerk40t/balormk/balor_params.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/balormk/controller.py` & `meerk40t-0.8.3000/meerk40t/balormk/controller.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/balormk/device.py` & `meerk40t-0.8.3000/meerk40t/balormk/device.py`

 * *Files 3% similar despite different names*

```diff
@@ -22,19 +22,25 @@
 class BalorDevice(Service, ViewPort):
     """
     The BalorDevice is a MeerK40t service for the device type. It should be the main method of interacting with
     the rest of meerk40t. It defines how the scene should look and contains a spooler which meerk40t will give jobs
     to. This class additionally defines commands which exist as console commands while this service is activated.
     """
 
-    def __init__(self, kernel, path, *args, **kwargs):
+    def __init__(self, kernel, path, *args, choices=None, **kwargs):
         Service.__init__(self, kernel, path)
         self.name = "balor"
         self.extension = "lmc"
         self.job = None
+        if choices is not None:
+            for c in choices:
+                attr = c.get("attr")
+                default = c.get("default")
+                if attr is not None and default is not None:
+                    setattr(self, attr, default)
 
         _ = kernel.translation
         self.register("frequency", (0, 1000))
         self.register(
             "format/op cut",
             "{danger}{defop}{enabled}{pass}{element_type} {speed}mm/s @{power} {frequency}kHz {colcode} {opstop}",
         )
@@ -84,14 +90,15 @@
                 "object": self,
                 "default": "balor-device",
                 "type": str,
                 "label": _("Label"),
                 "tip": _("What is this device called."),
                 "section": "_00_General",
                 "priority": "10",
+                "signals": "device;renamed",
             },
             {
                 "attr": "corfile_enabled",
                 "object": self,
                 "default": False,
                 "type": bool,
                 "label": _("Enable"),
@@ -309,15 +316,15 @@
             {
                 "attr": "default_power",
                 "object": self,
                 "default": 50.0,
                 "type": float,
                 "label": _("Laser Power"),
                 "trailer": "%",
-                "tip": _("How what power level do we cut at?"),
+                "tip": _("What power level do we cut at?"),
             },
             {
                 "attr": "default_speed",
                 "object": self,
                 "default": 100.0,
                 "type": float,
                 "trailer": "mm/s",
@@ -490,183 +497,166 @@
                 "type": int,
                 "label": _("First Pulse Killer"),
                 "trailer": "s",
                 "tip": _(
                     "First Pulse Killer (F.P.K): the lasting time for the first pulse suppress"
                 ),
                 "section": "First Pulse Killer",
-                "hidden": 1,
             },
             {
                 "attr": "pwm_half_period",
                 "object": self,
                 "default": 125,
                 "type": int,
                 "label": _("PWM Half Period"),
                 "tip": _("Pulse Period: the frequency of the preionization signal"),
                 "subsection": "Pulse-Width-Modulation",
-                "hidden": 1,
             },
             {
                 "attr": "pwm_pulse_width",
                 "object": self,
                 "default": 125,
                 "type": int,
                 "label": _("PWM Pulse Width"),
                 "tip": _("Pulse Width: the pulse width of the preionization signal"),
                 "subsection": "Pulse-Width-Modulation",
-                "hidden": 1,
             },
             {
                 "attr": "standby_param_1",
                 "object": self,
                 "default": 2000,
                 "type": int,
                 "label": _("Parameter 1"),
-                "tip": _(""),
+                # "tip": _(""),
                 "subsection": "Standby-Parameter",
-                "hidden": 1,
             },
             {
                 "attr": "standby_param_2",
                 "object": self,
                 "default": 20,
                 "type": int,
                 "label": _("Parameter 2"),
-                "tip": _(""),
+                # "tip": _(""),
                 "subsection": "Standby-Parameter",
-                "hidden": 1,
             },
             {
                 "attr": "timing_mode",
                 "object": self,
                 "default": 1,
                 "type": int,
                 "label": _("Timing Mode"),
-                "tip": _(""),
+                # "tip": _(""),
                 "subsection": "Modes",
-                "hidden": 1,
             },
             {
                 "attr": "delay_mode",
                 "object": self,
                 "default": 1,
                 "type": int,
                 "label": _("Delay Mode"),
-                "tip": _(""),
+                # "tip": _(""),
                 "subsection": "Modes",
-                "hidden": 1,
             },
             {
                 "attr": "laser_mode",
                 "object": self,
                 "default": 1,
                 "type": int,
                 "label": _("Laser Mode"),
-                "tip": _(""),
+                # "tip": _(""),
                 "subsection": "Modes",
-                "hidden": 1,
             },
             {
                 "attr": "control_mode",
                 "object": self,
                 "default": 0,
                 "type": int,
                 "label": _("Control Mode"),
-                "tip": _(""),
+                # "tip": _(""),
                 "subsection": "Modes",
-                "hidden": 1,
             },
             {
                 "attr": "fpk2_p1",
                 "object": self,
                 "default": 0xFFB,
                 "type": int,
                 "label": _("Max Voltage"),
-                "tip": _(""),
+                # "tip": _(""),
                 "trailer": "V",
                 "section": "First Pulse Killer",
                 "subsection": "Parameters",
-                "hidden": 1,
             },
             {
                 "attr": "fpk2_p2",
                 "object": self,
                 "default": 1,
                 "type": int,
                 "label": _("Min Voltage"),
                 "trailer": "V",
-                "tip": _(""),
+                # "tip": _(""),
                 "section": "First Pulse Killer",
                 "subsection": "Parameters",
-                "hidden": 1,
             },
             {
                 "attr": "fpk2_p3",
                 "object": self,
                 "default": 409,
                 "type": int,
                 "label": _("T1"),
                 "trailer": "s",
-                "tip": _(""),
+                # "tip": _(""),
                 "section": "First Pulse Killer",
                 "subsection": "Parameters",
-                "hidden": 1,
             },
             {
                 "attr": "fpk2_p4",
                 "object": self,
                 "default": 100,
                 "type": int,
                 "label": _("T2"),
                 "trailer": "s",
-                "tip": _(""),
+                # "tip": _(""),
                 "section": "First Pulse Killer",
                 "subsection": "Parameters",
-                "hidden": 1,
             },
             {
                 "attr": "fly_res_p1",
                 "object": self,
                 "default": 0,
                 "type": int,
                 "label": _("Param 1"),
-                "tip": _(""),
+                # "tip": _(""),
                 "subsection": "Fly Resolution",
-                "hidden": 1,
             },
             {
                 "attr": "fly_res_p2",
                 "object": self,
                 "default": 99,
                 "type": int,
                 "label": _("Param 2"),
-                "tip": _(""),
+                # "tip": _(""),
                 "subsection": "Fly Resolution",
-                "hidden": 1,
             },
             {
                 "attr": "fly_res_p3",
                 "object": self,
                 "default": 1000,
                 "type": int,
                 "label": _("Param 3"),
-                "tip": _(""),
+                # "tip": _(""),
                 "subsection": "Fly Resolution",
-                "hidden": 1,
             },
             {
                 "attr": "fly_res_p4",
                 "object": self,
                 "default": 25,
                 "type": int,
                 "label": _("Param 4"),
-                "tip": _(""),
+                # "tip": _(""),
                 "subsection": "Fly Resolution",
-                "hidden": 1,
             },
             {
                 "attr": "input_passes_required",
                 "object": self,
                 "default": 3,
                 "type": int,
                 "label": _("Input Signal Hold"),
@@ -680,14 +670,74 @@
                 "default": False,
                 "type": bool,
                 "label": _("Input Operation Hardware"),
                 "tip": _("Use hardware based input operation command"),
             },
         ]
         self.register_choices("balor-extra", choices)
+        choices = [
+            {
+                "attr": "rotary_active",
+                "object": self,
+                "default": False,
+                "type": bool,
+                "label": _("Rotary-Mode active"),
+                "tip": _("Is the rotary mode active for this device"),
+            },
+            {
+                "attr": "rotary_scale_x",
+                "object": self,
+                "default": 1.0,
+                "type": float,
+                "label": _("X-Scale"),
+                "tip": _("Scale that needs to be applied to the X-Axis"),
+                "conditional": (self, "rotary_active"),
+                "subsection": _("Scale"),
+            },
+            {
+                "attr": "rotary_scale_y",
+                "object": self,
+                "default": 1.0,
+                "type": float,
+                "label": _("Y-Scale"),
+                "tip": _("Scale that needs to be applied to the Y-Axis"),
+                "conditional": (self, "rotary_active"),
+                "subsection": _("Scale"),
+            },
+            {
+                "attr": "rotary_supress_home",
+                "object": self,
+                "default": False,
+                "type": bool,
+                "label": _("Ignore Home"),
+                "tip": _("Ignore Home-Command"),
+                "conditional": (self, "rotary_active"),
+            },
+            {
+                "attr": "rotary_mirror_x",
+                "object": self,
+                "default": False,
+                "type": bool,
+                "label": _("Mirror X"),
+                "tip": _("Mirror the elements on the X-Axis"),
+                "conditional": (self, "rotary_active"),
+                "subsection": _("Mirror Output"),
+            },
+            {
+                "attr": "rotary_mirror_y",
+                "object": self,
+                "default": False,
+                "type": bool,
+                "label": _("Mirror Y"),
+                "tip": _("Mirror the elements on the Y-Axis"),
+                "conditional": (self, "rotary_active"),
+                "subsection": _("Mirror Output"),
+            },
+        ]
+        self.register_choices("rotary", choices)
 
         self.state = 0
 
         unit_size = float(Length(self.lens_size))
         galvo_range = 0xFFFF
         units_per_galvo = unit_size / galvo_range
 
@@ -828,24 +878,30 @@
             help=_("Pauses the currently running job"),
         )
         def pause(command, channel, _, data=None, remainder=None, **kwgs):
             if self.driver.paused:
                 channel("Resuming current job")
             else:
                 channel("Pausing current job")
-            self.driver.pause()
+            try:
+                self.driver.pause()
+            except ConnectionRefusedError:
+                channel(_("Could not contact Galvo laser."))
             self.signal("pause")
 
         @self.console_command(
             "resume",
             help=_("Resume the currently running job"),
         )
         def resume(command, channel, _, data=None, remainder=None, **kwgs):
             channel("Resume the current job")
-            self.driver.resume()
+            try:
+                self.driver.resume()
+            except ConnectionRefusedError:
+                channel(_("Could not contact Galvo laser."))
             self.signal("pause")
 
         @self.console_option(
             "idonotlovemyhouse",
             type=bool,
             action="store_true",
             help=_("override one second laser fire pulse duration"),
```

### Comparing `meerk40t-0.8.2000/meerk40t/balormk/driver.py` & `meerk40t-0.8.3000/meerk40t/balormk/driver.py`

 * *Files 2% similar despite different names*

```diff
@@ -189,15 +189,15 @@
         queue = self.queue
         self.queue = list()
         for q in queue:
             settings = q.settings
             penbox = settings.get("penbox_value")
             if penbox is not None:
                 try:
-                    self.value_penbox = self.service.elements.penbox[penbox]
+                    self.value_penbox = self.service.penbox.pens[penbox]
                 except KeyError:
                     self.value_penbox = None
             con.set_settings(settings)
             con.set_wobble(settings)
             # LOOP CHECKS
             if self._aborting:
                 con.abort()
@@ -317,17 +317,15 @@
                         if on & PLOT_FINISH:  # Plot planner is ending.
                             break
                         elif on & PLOT_SETTING:  # Plot planner settings have changed.
                             settings = self.plot_planner.settings
                             penbox = settings.get("penbox_value")
                             if penbox is not None:
                                 try:
-                                    self.value_penbox = self.service.elements.penbox[
-                                        penbox
-                                    ]
+                                    self.value_penbox = self.service.penbox.pens[penbox]
                                 except KeyError:
                                     self.value_penbox = None
                             con.set_settings(settings)
                             con.set_wobble(settings)
                         elif on & (
                             PLOT_RAPID | PLOT_JOG
                         ):  # Plot planner requests position change.
@@ -437,14 +435,16 @@
 
     def home(self):
         """
         This is called home, returns to center.
 
         @return:
         """
+        if self.service.rotary_active and self.service.rotary_supress_home:
+            return
         self.move_abs("50%", "50%")
 
     def physical_home(self):
         """ "
         This would be the command to go to a real physical home position (ie hitting endstops)
         """
         self.home()
```

### Comparing `meerk40t-0.8.2000/meerk40t/balormk/elementlightjob.py` & `meerk40t-0.8.3000/meerk40t/balormk/elementlightjob.py`

 * *Files 4% similar despite different names*

```diff
@@ -59,15 +59,15 @@
         connection.light_mode()
         while self.process(connection):
             if self.stopped:
                 break
         connection.abort()
         self.stopped = True
         self.runtime += time.time() - self.time_started
-        self.service.signal("stop_tracing", True)
+        self.service.signal("light_simulate", False)
 
         if self.service.redlight_preferred:
             connection.light_on()
             connection.write_port()
         else:
             connection.light_off()
             connection.write_port()
```

### Comparing `meerk40t-0.8.2000/meerk40t/balormk/gui/balorconfig.py` & `meerk40t-0.8.3000/meerk40t/balormk/gui/balorconfig.py`

 * *Files 2% similar despite different names*

```diff
@@ -31,14 +31,15 @@
 
         options = (
             ("balor", "Balor"),
             ("balor-redlight", "Redlight"),
             ("balor-global", "Global"),
             ("balor-global-timing", "Timings"),
             ("balor-extra", "Extras"),
+            # ("rotary", "Rotary"),
         )
         self.panels = []
         for item in options:
             section = item[0]
             pagetitle = _(item[1])
             addpanel = self.visible_choices(section)
             if addpanel:
```

### Comparing `meerk40t-0.8.2000/meerk40t/balormk/gui/balorcontroller.py` & `meerk40t-0.8.3000/meerk40t/balormk/gui/balorcontroller.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/balormk/gui/baloroperationproperties.py` & `meerk40t-0.8.3000/meerk40t/balormk/gui/baloroperationproperties.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/balormk/gui/gui.py` & `meerk40t-0.8.3000/meerk40t/balormk/gui/gui.py`

 * *Files 4% similar despite different names*

```diff
@@ -95,15 +95,15 @@
                     },
                 ],
                 "toggle": {
                     "label": _("Stop Tracing..."),
                     "icon": icons8_light_off_50,
                     "tip": _("Turn light off"),
                     "action": lambda v: service("stop\n"),
-                    "signal": "stop_tracing",
+                    "signal": "light_simulate",
                 },
             },
         )
         service.register(
             "button/control/Redlight",
             {
                 "label": _("Red Dot On"),
```

### Comparing `meerk40t-0.8.2000/meerk40t/balormk/livefulllightjob.py` & `meerk40t-0.8.3000/meerk40t/balormk/livefulllightjob.py`

 * *Files 0% similar despite different names*

```diff
@@ -51,15 +51,15 @@
         while self.process(connection):
             if self.stopped:
                 break
         connection.abort()
         self.stopped = True
         self.runtime += time.time() - self.time_started
         self.service.unlisten("emphasized", self.on_emphasis_changed)
-        self.service.signal("stop_tracing", True)
+        self.service.signal("light_simulate", False)
         if self.service.redlight_preferred:
             connection.light_on()
             connection.write_port()
         else:
             connection.light_off()
             connection.write_port()
         return True
```

### Comparing `meerk40t-0.8.2000/meerk40t/balormk/liveselectionlightjob.py` & `meerk40t-0.8.3000/meerk40t/balormk/liveselectionlightjob.py`

 * *Files 2% similar despite different names*

```diff
@@ -52,15 +52,15 @@
         connection.light_mode()
         while self.process(connection):
             if self.stopped:
                 break
         connection.abort()
         self.stopped = True
         self.runtime += time.time() - self.time_started
-        self.service.signal("stop_tracing", True)
+        self.service.signal("light_simulate", False)
         if self.service.redlight_preferred:
             connection.light_on()
             connection.write_port()
         else:
             connection.light_off()
             connection.write_port()
         return True
```

### Comparing `meerk40t-0.8.2000/meerk40t/balormk/mock_connection.py` & `meerk40t-0.8.3000/meerk40t/balormk/mock_connection.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/balormk/usb_connection.py` & `meerk40t-0.8.3000/meerk40t/balormk/usb_connection.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/camera/camera.py` & `meerk40t-0.8.3000/meerk40t/camera/camera.py`

 * *Files 0% similar despite different names*

```diff
@@ -40,15 +40,18 @@
         self.max_tries_frame = 10
         self.setting(int, "width", 640)
         self.setting(int, "height", 480)
         self.setting(bool, "correction_fisheye", False)
         self.setting(bool, "correction_perspective", False)
         self.setting(list, "fisheye", None)
         self.setting(list, "perspective", None)
-        index = int(camera_path[7:])
+        try:
+            index = int(camera_path[7:])
+        except ValueError:
+            index = 0
         self.setting(str, "uri", str(index))
         self.setting(int, "index", index)
         self.setting(bool, "autonormal", False)
         self.setting(bool, "aspect", False)
         self.setting(str, "preserve_aspect", "xMinYMin meet")
         self.fisheye_k = None
         self.fisheye_d = None
```

### Comparing `meerk40t-0.8.2000/meerk40t/camera/gui/camerapanel.py` & `meerk40t-0.8.3000/meerk40t/camera/gui/camerapanel.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/camera/gui/gui.py` & `meerk40t-0.8.3000/meerk40t/camera/gui/gui.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/camera/plugin.py` & `meerk40t-0.8.3000/meerk40t/camera/plugin.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/ch341/__init__.py` & `meerk40t-0.8.3000/meerk40t/ch341/__init__.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/ch341/libusb.py` & `meerk40t-0.8.3000/meerk40t/ch341/libusb.py`

 * *Files 3% similar despite different names*

```diff
@@ -20,14 +20,15 @@
 mCH341_SET_PARA_MODE = 0x9A
 mCH341_PARA_INIT = 0xB1
 mCH341_VENDOR_READ = 0xC0
 mCH341_VENDOR_WRITE = 0x40
 mCH341A_BUF_CLEAR = 0xB2
 mCH341A_DELAY_MS = 0x5E
 mCH341A_GET_VER = 0x5F
+mCH341A_STATUS = 0x52
 
 
 def convert_to_list_bytes(data):
     if isinstance(data, str):  # python 2
         return [ord(e) for e in data]
     else:
         return [e for e in data]
@@ -102,25 +103,23 @@
         self.channel(string)
         return device
 
     def detach_kernel(self, device, interface):
         _ = self.channel._
         try:
             if device.is_kernel_driver_active(interface.bInterfaceNumber):
-                # TODO: This can raise USBError on entity not found.
-                try:
-                    self.channel(_("Attempting to detach kernel."))
-                    device.detach_kernel_driver(interface.bInterfaceNumber)
-                    self.channel(_("Kernel detach: Success."))
-                except usb.core.USBError as e:
-                    self.backend_error_code = e.backend_error_code
+                self.channel(_("Attempting to detach kernel."))
+                device.detach_kernel_driver(interface.bInterfaceNumber)
+                self.channel(_("Kernel detach: Success."))
+        except usb.core.USBError as e:
+            self.backend_error_code = e.backend_error_code
 
-                    self.channel(str(e))
-                    self.channel(_("Kernel detach: Failed."))
-                    raise ConnectionRefusedError
+            self.channel(str(e))
+            self.channel(_("Kernel detach: Failed."))
+            raise ConnectionRefusedError
         except NotImplementedError:
             self.channel(
                 _("Kernel detach: Not Implemented.")
             )  # Driver does not permit kernel detaching.
             # Non-fatal error.
 
     def get_active_config(self, device):
@@ -149,14 +148,20 @@
             self.channel(str(e))
             self.channel(
                 _(
                     "Config Set: Fail\n(Hint: may recover if you change where the USB is plugged in.)"
                 )
             )
             # raise ConnectionRefusedError
+        except NotImplementedError as e:
+            self.channel(
+                _(
+                    "Config Set: Fail\nSet Configuration is not implemented on this platform. Pass."
+                )
+            )
 
     def claim_interface(self, device, interface):
         _ = self.channel._
         try:
             self.channel(_("Attempting to claim interface."))
             usb.util.claim_interface(device, interface)
             self.channel(_("Interface claim: Success"))
@@ -339,14 +344,44 @@
             raise ConnectionError
 
     # pylint: disable=dangerous-default-value
     def CH341GetStatus(self, index=0, status=[0]):
         """D7-0, 8: err, 9: pEmp, 10: Int, 11: SLCT, 12: SDA, 13: Busy, 14: data, 15: addrs"""
         device = self.devices[index]
         try:
+            buffer = device.ctrl_transfer(
+                bmRequestType=mCH341_VENDOR_READ,
+                bRequest=mCH341A_STATUS,
+                wValue=0,
+                wIndex=0,
+                data_or_wLength=8,
+                timeout=self.timeout,
+            )
+            status[0] = buffer
+        except usb.core.USBError as e:
+            self.backend_error_code = e.backend_error_code
+
+            self.channel(str(e))
+            raise ConnectionError
+        return status[0]
+
+    # pylint: disable=dangerous-default-value
+    def CH341GetStatusBulk(self, index=0, status=[0]):
+        """
+        Older bulk based version with a read and write rather than control transfer.
+
+        This version of the status check requires a bulk send of an A0 followed by a read. If the chip is
+        locked up, this will result in timeout errors.
+
+        @param index:
+        @param status:
+        @return:
+        """
+        device = self.devices[index]
+        try:
             device.write(
                 endpoint=BULK_WRITE_ENDPOINT,
                 data=[mCH341_PARA_CMD_STS],
                 timeout=self.timeout,
             )
             # read(self, endpoint, size_or_buffer, timeout = None)
             status[0] = device.read(
@@ -354,15 +389,14 @@
             )
         except usb.core.USBError as e:
             self.backend_error_code = e.backend_error_code
 
             self.channel(str(e))
             raise ConnectionError
         return status[0]
-        # 48, reads 0xc0, 95, 0, 0 (30,00? = 48)
 
     def CH341GetVerIC(self, index=0):
         device = self.devices[index]
         try:
             buffer = device.ctrl_transfer(
                 bmRequestType=mCH341_VENDOR_READ,
                 bRequest=mCH341A_GET_VER,
```

### Comparing `meerk40t-0.8.2000/meerk40t/ch341/mock.py` & `meerk40t-0.8.3000/meerk40t/ch341/mock.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/ch341/windll.py` & `meerk40t-0.8.3000/meerk40t/ch341/windll.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/core/bindalias.py` & `meerk40t-0.8.3000/meerk40t/core/bindalias.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,44 +1,55 @@
 from meerk40t.kernel import CommandMatchRejected, Service
 
-# The following dicts consist of a tuple of values, the first of
-# which is the current default, with any prior defaults following.
-# Prior defaults are used to keep a users keymap / aliases up to date with
-# any changes, unless the user has already changed away from the default.
-# If you want to delete a bind / alias, set the first value to a null string.
-
-# CHOICE OF BINDALIAS vs. MENU
-# These key bindings are in addition to those specified in the menus
-# (like Ctrl+S for File Save). The choice of which of these to use is debatable.
-# On one hand bindalias is a more flexible approach because the user can
-# change keys mappings to whatever they wish whilst menus are fixed.
-# On the other hand, default menu keys can be set per language because the
-# menu strings are translated, whereas bindalias keys are not.
-
-# RESERVED KEYS
-# Regardless of the platform used by individual developers, bindalias needs
-# to conform to BOTH of the following:
-#
-# 1. Mac - common shortcuts defined in https://support.apple.com/en-us/HT201236
-#    should be followed where appropriate and avoided if not. This is important
-#    for MK to be accepted into the Apple app store.
-#    Where keys defined in other sections on this page make sense for this application,
-#    these should also be used by preference.
-#
-# 2. Windows - alt-single letter should be avoided as these correspond to menu
-#    shortcuts (e.g. in english locale, alt-f should activate the file menu).
-#    Common Windows shortcuts can be found at
-#    https://support.microsoft.com/en-us/windows/keyboard-shortcuts-in-windows-dcc61a57-8ff0-cffe-9796-cb9706c75eec
-#
-# In addition where they do not conflict with the above, any synergy with keys commonly used
-# in popular SVG / image editors (e.g. paint.net, inkscape) may be beneficial.
-
-# To change keymaps / alias insert new alias at the beginning of the tuple
-# Later entries in the tuple are used to identify previous defaults and update them to current,
-# so do not delete these until a version change (like 0.8) results in completely new settings anyway.
+"""
+This core class defines two main services: bind and alias. This is a set defined keybinds and alias commands.
+
+If a keybind commands starts with a "+" then the command is triggered on the down-key and the "-" version of
+the same command is triggered on the up-key. If the bind is for any other command, it will execute on key-press.
+If you need this functionality it's best to define these commands as aliases of other commands.
+"""
+
+
+"""
+The following dicts consist of a tuple of values, the first of
+which is the current default, with any prior defaults following.
+Prior defaults are used to keep a users keymap / aliases up to date with
+any changes, unless the user has already changed away from the default.
+If you want to delete a bind / alias, set the first value to a null string.
+
+CHOICE OF BINDALIAS vs. MENU
+These key bindings are in addition to those specified in the menus
+(like Ctrl+S for File Save). The choice of which of these to use is debatable.
+On one hand bindalias is a more flexible approach because the user can
+change keys mappings to whatever they wish whilst menus are fixed.
+On the other hand, default menu keys can be set per language because the
+menu strings are translated, whereas bindalias keys are not.
+
+RESERVED KEYS
+Regardless of the platform used by individual developers, bindalias needs
+to conform to BOTH of the following:
+
+1. Mac - common shortcuts defined in https://support.apple.com/en-us/HT201236
+   should be followed where appropriate and avoided if not. This is important
+   for MK to be accepted into the Apple app store.
+   Where keys defined in other sections on this page make sense for this application,
+   these should also be used by preference.
+2. Windows - alt-single letter should be avoided as these correspond to menu
+   shortcuts (e.g. in english locale, alt-f should activate the file menu).
+   Common Windows shortcuts can be found at
+   https://support.microsoft.com/en-us/windows/keyboard-shortcuts-in-windows-dcc61a57-8ff0-cffe-9796-cb9706c75eec
+
+In addition where they do not conflict with the above, any synergy with keys commonly used
+in popular SVG / image editors (e.g. paint.net, inkscape) may be beneficial.
+
+To change keymaps / alias insert new alias at the beginning of the tuple
+Later entries in the tuple are used to identify previous defaults and update them to current,
+so do not delete these until a version change (like 0.8) results in completely new settings anyway.
+"""
+
 DEFAULT_KEYMAP = {
     "right": ("translate 1mm 0",),
     "left": ("translate -1mm 0",),
     "up": ("translate 0 -1mm",),
     "down": ("translate 0 1mm",),
     "a": ("+left",),
     "d": ("+right",),
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/cutcode/cubiccut.py` & `meerk40t-0.8.3000/meerk40t/core/cutcode/cubiccut.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/core/cutcode/cutcode.py` & `meerk40t-0.8.3000/meerk40t/core/cutcode/cutcode.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/core/cutcode/cutgroup.py` & `meerk40t-0.8.3000/meerk40t/core/cutcode/cutgroup.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/core/cutcode/cutobject.py` & `meerk40t-0.8.3000/meerk40t/core/cutcode/cutobject.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/core/cutcode/dwellcut.py` & `meerk40t-0.8.3000/meerk40t/core/cutcode/dwellcut.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/core/cutcode/gotocut.py` & `meerk40t-0.8.3000/meerk40t/core/cutcode/gotocut.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/core/cutcode/homecut.py` & `meerk40t-0.8.3000/meerk40t/core/cutcode/homecut.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/core/cutcode/inputcut.py` & `meerk40t-0.8.3000/meerk40t/core/cutcode/inputcut.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/core/cutcode/linecut.py` & `meerk40t-0.8.3000/meerk40t/core/cutcode/linecut.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/core/cutcode/outputcut.py` & `meerk40t-0.8.3000/meerk40t/core/cutcode/outputcut.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/core/cutcode/plotcut.py` & `meerk40t-0.8.3000/meerk40t/core/cutcode/plotcut.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/core/cutcode/quadcut.py` & `meerk40t-0.8.3000/meerk40t/core/cutcode/quadcut.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/core/cutcode/rastercut.py` & `meerk40t-0.8.3000/meerk40t/core/cutcode/rastercut.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/core/cutcode/setorigincut.py` & `meerk40t-0.8.3000/meerk40t/core/cutcode/setorigincut.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/core/cutcode/waitcut.py` & `meerk40t-0.8.3000/meerk40t/core/cutcode/waitcut.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/core/cutplan.py` & `meerk40t-0.8.3000/meerk40t/core/cutplan.py`

 * *Files 4% similar despite different names*

```diff
@@ -11,24 +11,26 @@
     rather than being burned in 2 or more separate parts
 *   Split raster images in to self-contained areas to avoid sweeping over large empty areas
     including splitting into individual small areas if burn inner first is set and then recombining
     those inside the same curves so that raster burns are fully optimised.
 """
 
 from copy import copy
+from math import isinf
 from os import times
 from time import time
 from typing import Optional
 
 from ..svgelements import Group, Polygon
 from ..tools.pathtools import VectorMontonizer
 from .cutcode.cutcode import CutCode
 from .cutcode.cutgroup import CutGroup
 from .cutcode.cutobject import CutObject
 from .cutcode.rastercut import RasterCut
+from .node.node import Node
 from .units import Length
 
 
 class CutPlanningFailedError(Exception):
     pass
 
 
@@ -53,15 +55,16 @@
     def __init__(self, name, planner):
         self.name = name
         self.context = planner
         self.plan = list()
         self.spool_commands = list()
         self.commands = list()
         self.channel = self.context.channel("optimize", timestamp=True)
-        # self.setting(bool, "opt_rasters_split", True)
+        self.outline = None
+        self._previous_bounds = None
 
     def __str__(self):
         parts = list()
         parts.append(self.name)
         if len(self.plan):
             parts.append(f"#{len(self.plan)}")
             for p in self.plan:
@@ -112,28 +115,47 @@
         All operation nodes are called with the current context, the matrix converting from scene to device, and
         commands.
 
         Nodes are expected to convert relevant properties and shapes from scene coordinates to device coordinate systems
         if they need operations. They are also expected to add any relevant commands to the commands list. The commands
         list sequentially in the next stage.
         """
-        context = self.context
+        device = self.context.device
 
         # ==========
         # Preprocess Operations
         # ==========
-        matrix = self.context.device.scene_to_device_matrix()
+        matrix = device.scene_to_device_matrix()
+
+        bounds = Node.union_bounds(self.plan, bounds=self._previous_bounds)
+        self._previous_bounds = bounds
+        if bounds is not None:
+            left, top, right, bottom = bounds
+            min_x = min(right, left)
+            min_y = min(top, bottom)
+            max_x = max(right, left)
+            max_y = max(top, bottom)
+            if isinf(min_x) or isinf(min_y) or isinf(max_x) or isinf(max_y):
+                # Infinite bounds are invalid.
+                self.outline = None
+            else:
+                self.outline = (
+                    device.device_position(min_x, min_y),
+                    device.device_position(max_x, min_y),
+                    device.device_position(max_x, max_y),
+                    device.device_position(min_x, max_y),
+                )
 
         # TODO: Correct rotary.
         # rotary = self.context.rotary
         # if rotary.rotary_enabled:
         #     axis = rotary.axis
 
         for op in self.plan:
-            if not hasattr(op, "type"):
+            if not hasattr(op, "type") or op.type is None:
                 continue
             if op.type.startswith("op"):
                 if hasattr(op, "preprocess"):
                     op.preprocess(self.context, matrix, self)
                 for node in op.flat():
                     if node is op:
                         continue
@@ -149,15 +171,19 @@
         Anything that does not have a type is likely able to spool, but cannot merge and are not grouped. Only grouped
         operations are candidates for cutcode merging.
         @return:
         """
         last_type = None
         group = list()
         for c in plan:
-            c_type = c.type if hasattr(c, "type") else type(c).__name__
+            c_type = (
+                c.type
+                if hasattr(c, "type") and c.type is not None
+                else type(c).__name__
+            )
             if last_type is not None:
                 if c_type.startswith("op") != last_type.startswith("op"):
                     # This is not able to be merged
                     yield group
                     group = list()
             group.append(c)
             last_type = c_type
@@ -209,15 +235,15 @@
 
         @param grouped_plan:
         @return:
         """
         context = self.context
         for plan in grouped_plan:
             for op in plan:
-                if not hasattr(op, "type"):
+                if not hasattr(op, "type") or op.type is None:
                     yield op
                     continue
                 if (
                     not op.type.startswith("op")
                     and not op.type.startswith("util")
                     or op.type == "util console"
                 ):
@@ -515,14 +541,15 @@
             cur = self.plan[i]
             prev = self.plan[i - 1]
             if isinstance(cur, CutCode) and isinstance(prev, CutCode):
                 prev.extend(cur)
                 del self.plan[i]
 
     def clear(self):
+        self._previous_bounds = None
         self.plan.clear()
         self.commands.clear()
 
 
 def is_inside(inner, outer, tolerance=0):
     """
     Test that path1 is inside path2.
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/drivers.py` & `meerk40t-0.8.3000/meerk40t/core/drivers.py`

 * *Files 11% similar despite different names*

```diff
@@ -1,9 +1,18 @@
 import time
 
+"""
+A driver is a class which implements a set of various functions that are expected to be called to control a particular
+laser. 
+
+There is no guarantees with regard to what commands should exist other than `hold_work` which is required by the
+spooler. Anything that accesses a driver is expected to call any would-be function as if it may generate an
+AttributeError (because it might).
+"""
+
 DRIVER_STATE_RAPID = 0
 DRIVER_STATE_FINISH = 1
 DRIVER_STATE_PROGRAM = 2
 DRIVER_STATE_RASTER = 3
 DRIVER_STATE_MODECHANGE = 4
 
 PLOT_FINISH = 256
@@ -12,25 +21,24 @@
 PLOT_SETTING = 128
 PLOT_AXIS = 64
 PLOT_DIRECTION = 32
 
 
 class Driver:
     """
-    A driver is a class which implements the spoolable commands which are issued to the spooler by something in the
-    system. The spooled command consist of a method and some data. These are sent to the driver associated with that
-    spooler in linear within a single spooler thread. If a method does not exist, it will not be called;
-    it will be as if the command didn't exist. Some devices may have other functions which can equally be called through
-    spooling particular lasercode.
-
-    Most code however is processed as part of cutcode which is a series of native-coord commands which should be
-    processed in order. These can include curves to cut and places to dwell the laser to be executed as part of a
-    precompiled set of instructions. Cutcode can't do things like pause the laser or leave the rail unlocked, but should
-    be permitted to execute various steps in order, and have that execution manipulated by the most of these remaining
-    commands.
+    This driver is mostly an example. Nothing uses this and drivers are not required to implement this set of functions
+    or any functions, except for hold_work(). get(), set(), and status(). If a particular laser implements something
+    no other laser implements. A function should be implemented to access that functionality. If no code calls
+    that function, then it will not execute. But, often these will get called with buttons or device specific
+    implementations.
+
+    However, most of the time the functions in this file will exist regardless of device, so calling these will be
+    effective most of the time. However, sometimes things like unlock rail for a galvo laser (which has no rail) will
+    not be implemented for obvious reasons. The driver will lack that function and any calling code will remain
+    functional.
     """
 
     def __init__(self, context, name=None):
         self.context = context
         self.name = name
         self._settings = dict()
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/element_treeops.py` & `meerk40t-0.8.3000/meerk40t/core/elements/element_treeops.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,5127 +1,5481 @@
-00000000: 696d 706f 7274 206f 732e 7061 7468 0d0a  import os.path..
-00000010: 6672 6f6d 2063 6f70 7920 696d 706f 7274  from copy import
-00000020: 2063 6f70 790d 0a69 6d70 6f72 7420 6d61   copy..import ma
-00000030: 7468 0d0a 0d0a 6672 6f6d 206d 6565 726b  th....from meerk
-00000040: 3430 742e 6b65 726e 656c 2069 6d70 6f72  40t.kernel impor
-00000050: 7420 436f 6d6d 616e 6453 796e 7461 7845  t CommandSyntaxE
-00000060: 7272 6f72 0d0a 0d0a 6672 6f6d 202e 2e73  rror....from ..s
-00000070: 7667 656c 656d 656e 7473 2069 6d70 6f72  vgelements impor
-00000080: 7420 4d61 7472 6978 2c20 506f 696e 740d  t Matrix, Point.
-00000090: 0a66 726f 6d20 2e63 7574 636f 6465 2e63  .from .cutcode.c
-000000a0: 7574 636f 6465 2069 6d70 6f72 7420 4375  utcode import Cu
-000000b0: 7443 6f64 650d 0a66 726f 6d20 2e65 6c65  tCode..from .ele
-000000c0: 6d65 6e74 5f74 7970 6573 2069 6d70 6f72  ment_types impor
-000000d0: 7420 2a0d 0a66 726f 6d20 2e6e 6f64 652e  t *..from .node.
-000000e0: 656c 656d 5f69 6d61 6765 2069 6d70 6f72  elem_image impor
-000000f0: 7420 496d 6167 654e 6f64 650d 0a66 726f  t ImageNode..fro
-00000100: 6d20 2e6e 6f64 652e 6e6f 6465 2069 6d70  m .node.node imp
-00000110: 6f72 7420 4e6f 6465 0d0a 6672 6f6d 202e  ort Node..from .
-00000120: 7472 6565 6f70 2069 6d70 6f72 7420 280d  treeop import (.
-00000130: 0a20 2020 2067 6574 5f74 7265 655f 6f70  .    get_tree_op
-00000140: 6572 6174 696f 6e2c 0d0a 2020 2020 7472  eration,..    tr
-00000150: 6565 5f63 616c 632c 0d0a 2020 2020 7472  ee_calc,..    tr
-00000160: 6565 5f63 6865 636b 2c0d 0a20 2020 2074  ee_check,..    t
-00000170: 7265 655f 636f 6e64 6974 696f 6e61 6c2c  ree_conditional,
-00000180: 0d0a 2020 2020 7472 6565 5f63 6f6e 6469  ..    tree_condi
-00000190: 7469 6f6e 616c 5f74 7279 2c0d 0a20 2020  tional_try,..   
-000001a0: 2074 7265 655f 6974 6572 6174 652c 0d0a   tree_iterate,..
-000001b0: 2020 2020 7472 6565 5f70 726f 6d70 742c      tree_prompt,
-000001c0: 0d0a 2020 2020 7472 6565 5f72 6164 696f  ..    tree_radio
-000001d0: 2c0d 0a20 2020 2074 7265 655f 7365 7061  ,..    tree_sepa
-000001e0: 7261 746f 725f 6166 7465 722c 0d0a 2020  rator_after,..  
-000001f0: 2020 7472 6565 5f73 6570 6172 6174 6f72    tree_separator
-00000200: 5f62 6566 6f72 652c 0d0a 2020 2020 7472  _before,..    tr
-00000210: 6565 5f73 7562 6d65 6e75 2c0d 0a20 2020  ee_submenu,..   
-00000220: 2074 7265 655f 7661 6c75 6573 2c0d 0a29   tree_values,..)
-00000230: 0d0a 6672 6f6d 202e 756e 6974 7320 696d  ..from .units im
-00000240: 706f 7274 2055 4e49 5453 5f50 4552 5f49  port UNITS_PER_I
-00000250: 4e43 480d 0a0d 0a0d 0a64 6566 2070 6c75  NCH......def plu
-00000260: 6769 6e28 6b65 726e 656c 2c20 6c69 6665  gin(kernel, life
-00000270: 6379 636c 653d 4e6f 6e65 293a 0d0a 2020  cycle=None):..  
-00000280: 2020 5f20 3d20 6b65 726e 656c 2e74 7261    _ = kernel.tra
-00000290: 6e73 6c61 7469 6f6e 0d0a 2020 2020 6966  nslation..    if
-000002a0: 206c 6966 6563 7963 6c65 203d 3d20 2270   lifecycle == "p
-000002b0: 6f73 7462 6f6f 7422 3a0d 0a20 2020 2020  ostboot":..     
-000002c0: 2020 2069 6e69 745f 7472 6565 286b 6572     init_tree(ker
-000002d0: 6e65 6c29 0d0a 0d0a 0d0a 6465 6620 696e  nel)......def in
-000002e0: 6974 5f74 7265 6528 6b65 726e 656c 293a  it_tree(kernel):
-000002f0: 0d0a 2020 2020 7365 6c66 203d 206b 6572  ..    self = ker
-00000300: 6e65 6c2e 656c 656d 656e 7473 0d0a 0d0a  nel.elements....
-00000310: 2020 2020 7472 6565 5f6f 7065 7261 7469      tree_operati
-00000320: 6f6e 203d 2067 6574 5f74 7265 655f 6f70  on = get_tree_op
-00000330: 6572 6174 696f 6e28 7365 6c66 290d 0a0d  eration(self)...
-00000340: 0a20 2020 205f 203d 206b 6572 6e65 6c2e  .    _ = kernel.
-00000350: 7472 616e 736c 6174 696f 6e0d 0a0d 0a20  translation.... 
-00000360: 2020 2023 202d 2d2d 2d2d 2d2d 2d2d 2d2d     # -----------
-00000370: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00000380: 2054 5245 4520 4f50 4552 4154 494f 4e53   TREE OPERATIONS
-00000390: 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d   ---------------
-000003a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 0d0a  ------------....
-000003b0: 2020 2020 6465 6620 6973 5f72 6567 6d61      def is_regma
-000003c0: 726b 286e 6f64 6529 3a0d 0a20 2020 2020  rk(node):..     
-000003d0: 2020 2072 6573 756c 7420 3d20 4661 6c73     result = Fals
-000003e0: 650d 0a20 2020 2020 2020 2074 7279 3a0d  e..        try:.
-000003f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00000400: 6e6f 6465 2e5f 7061 7265 6e74 2e74 7970  node._parent.typ
-00000410: 6520 3d3d 2022 6272 616e 6368 2072 6567  e == "branch reg
-00000420: 223a 0d0a 2020 2020 2020 2020 2020 2020  ":..            
-00000430: 2020 2020 7265 7375 6c74 203d 2054 7275      result = Tru
-00000440: 650d 0a20 2020 2020 2020 2065 7863 6570  e..        excep
-00000450: 7420 4174 7472 6962 7574 6545 7272 6f72  t AttributeError
-00000460: 3a0d 0a20 2020 2020 2020 2020 2020 2070  :..            p
-00000470: 6173 730d 0a20 2020 2020 2020 2072 6574  ass..        ret
-00000480: 7572 6e20 7265 7375 6c74 0d0a 0d0a 2020  urn result....  
-00000490: 2020 6465 6620 6861 735f 6368 616e 6765    def has_change
-000004a0: 7328 6e6f 6465 293a 0d0a 2020 2020 2020  s(node):..      
-000004b0: 2020 7265 7375 6c74 203d 2046 616c 7365    result = False
-000004c0: 0d0a 2020 2020 2020 2020 7472 793a 0d0a  ..        try:..
-000004d0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-000004e0: 6f74 206e 6f64 652e 6d61 7472 6978 2e69  ot node.matrix.i
-000004f0: 735f 6964 656e 7469 7479 2829 3a0d 0a20  s_identity():.. 
-00000500: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00000510: 6573 756c 7420 3d20 5472 7565 0d0a 2020  esult = True..  
-00000520: 2020 2020 2020 6578 6365 7074 2041 7474        except Att
-00000530: 7269 6275 7465 4572 726f 723a 0d0a 2020  ributeError:..  
-00000540: 2020 2020 2020 2020 2020 2320 5468 6572            # Ther
-00000550: 6520 7761 7320 616e 2065 7272 6f72 2064  e was an error d
-00000560: 7572 696e 6720 6368 6563 6b20 666f 7220  uring check for 
-00000570: 6d61 7472 6978 2e69 735f 6964 656e 7469  matrix.is_identi
-00000580: 7479 0d0a 2020 2020 2020 2020 2020 2020  ty..            
-00000590: 7061 7373 0d0a 2020 2020 2020 2020 7265  pass..        re
-000005a0: 7475 726e 2072 6573 756c 740d 0a0d 0a20  turn result.... 
-000005b0: 2020 2040 7472 6565 5f73 6570 6172 6174     @tree_separat
-000005c0: 6f72 5f61 6674 6572 2829 0d0a 2020 2020  or_after()..    
-000005d0: 4074 7265 655f 636f 6e64 6974 696f 6e61  @tree_conditiona
-000005e0: 6c28 6c61 6d62 6461 206e 6f64 653a 206c  l(lambda node: l
-000005f0: 656e 286c 6973 7428 7365 6c66 2e6f 7073  en(list(self.ops
-00000600: 2873 656c 6563 7465 643d 5472 7565 2929  (selected=True))
-00000610: 2920 3d3d 2031 290d 0a20 2020 2040 7472  ) == 1)..    @tr
-00000620: 6565 5f6f 7065 7261 7469 6f6e 285f 2822  ee_operation(_("
-00000630: 4f70 6572 6174 696f 6e20 7072 6f70 6572  Operation proper
-00000640: 7469 6573 2229 2c20 6e6f 6465 5f74 7970  ties"), node_typ
-00000650: 653d 6f70 5f6e 6f64 6573 2c20 6865 6c70  e=op_nodes, help
-00000660: 3d22 2229 0d0a 2020 2020 6465 6620 6f70  ="")..    def op
-00000670: 6572 6174 696f 6e5f 7072 6f70 6572 7479  eration_property
-00000680: 286e 6f64 652c 202a 2a6b 7761 7267 7329  (node, **kwargs)
-00000690: 3a0d 0a20 2020 2020 2020 2061 6374 6976  :..        activ
-000006a0: 6174 6520 3d20 7365 6c66 2e6b 6572 6e65  ate = self.kerne
-000006b0: 6c2e 6c6f 6f6b 7570 2822 6675 6e63 7469  l.lookup("functi
-000006c0: 6f6e 2f6f 7065 6e5f 7072 6f70 6572 7479  on/open_property
-000006d0: 5f77 696e 646f 775f 666f 725f 6e6f 6465  _window_for_node
-000006e0: 2229 0d0a 2020 2020 2020 2020 6966 2061  ")..        if a
-000006f0: 6374 6976 6174 6520 6973 206e 6f74 204e  ctivate is not N
-00000700: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-00000710: 2020 6163 7469 7661 7465 286e 6f64 6529    activate(node)
-00000720: 0d0a 0d0a 2020 2020 4074 7265 655f 7365  ....    @tree_se
-00000730: 7061 7261 746f 725f 6166 7465 7228 290d  parator_after().
-00000740: 0a20 2020 2040 7472 6565 5f6f 7065 7261  .    @tree_opera
-00000750: 7469 6f6e 285f 2822 4564 6974 2229 2c20  tion(_("Edit"), 
-00000760: 6e6f 6465 5f74 7970 653d 2275 7469 6c20  node_type="util 
-00000770: 636f 6e73 6f6c 6522 2c20 6865 6c70 3d22  console", help="
-00000780: 2229 0d0a 2020 2020 6465 6620 6564 6974  ")..    def edit
-00000790: 5f63 6f6e 736f 6c65 5f63 6f6d 6d61 6e64  _console_command
-000007a0: 286e 6f64 652c 202a 2a6b 7761 7267 7329  (node, **kwargs)
-000007b0: 3a0d 0a20 2020 2020 2020 2061 6374 6976  :..        activ
-000007c0: 6174 6520 3d20 7365 6c66 2e6b 6572 6e65  ate = self.kerne
-000007d0: 6c2e 6c6f 6f6b 7570 2822 6675 6e63 7469  l.lookup("functi
-000007e0: 6f6e 2f6f 7065 6e5f 7072 6f70 6572 7479  on/open_property
-000007f0: 5f77 696e 646f 775f 666f 725f 6e6f 6465  _window_for_node
-00000800: 2229 0d0a 2020 2020 2020 2020 6966 2061  ")..        if a
-00000810: 6374 6976 6174 6520 6973 206e 6f74 204e  ctivate is not N
-00000820: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-00000830: 2020 6163 7469 7661 7465 286e 6f64 6529    activate(node)
-00000840: 0d0a 0d0a 2020 2020 4074 7265 655f 7365  ....    @tree_se
-00000850: 7061 7261 746f 725f 6166 7465 7228 290d  parator_after().
-00000860: 0a20 2020 2040 7472 6565 5f6f 7065 7261  .    @tree_opera
-00000870: 7469 6f6e 280d 0a20 2020 2020 2020 205f  tion(..        _
-00000880: 2822 456c 656d 656e 7420 7072 6f70 6572  ("Element proper
-00000890: 7469 6573 2229 2c0d 0a20 2020 2020 2020  ties"),..       
-000008a0: 206e 6f64 655f 7479 7065 3d28 0d0a 2020   node_type=(..  
-000008b0: 2020 2020 2020 2020 2020 2265 6c65 6d20            "elem 
-000008c0: 656c 6c69 7073 6522 2c0d 0a20 2020 2020  ellipse",..     
-000008d0: 2020 2020 2020 2022 656c 656d 2070 6174         "elem pat
-000008e0: 6822 2c0d 0a20 2020 2020 2020 2020 2020  h",..           
-000008f0: 2022 656c 656d 2070 6f69 6e74 222c 0d0a   "elem point",..
-00000900: 2020 2020 2020 2020 2020 2020 2265 6c65              "ele
-00000910: 6d20 706f 6c79 6c69 6e65 222c 0d0a 2020  m polyline",..  
-00000920: 2020 2020 2020 2020 2020 2265 6c65 6d20            "elem 
-00000930: 7265 6374 222c 0d0a 2020 2020 2020 2020  rect",..        
-00000940: 2020 2020 2265 6c65 6d20 6c69 6e65 222c      "elem line",
-00000950: 0d0a 2020 2020 2020 2020 292c 0d0a 2020  ..        ),..  
-00000960: 2020 2020 2020 6865 6c70 3d22 222c 0d0a        help="",..
-00000970: 2020 2020 290d 0a20 2020 2064 6566 2070      )..    def p
-00000980: 6174 685f 7072 6f70 6572 7479 286e 6f64  ath_property(nod
-00000990: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
-000009a0: 2020 2020 2020 2061 6374 6976 6174 6520         activate 
-000009b0: 3d20 7365 6c66 2e6b 6572 6e65 6c2e 6c6f  = self.kernel.lo
-000009c0: 6f6b 7570 2822 6675 6e63 7469 6f6e 2f6f  okup("function/o
-000009d0: 7065 6e5f 7072 6f70 6572 7479 5f77 696e  pen_property_win
-000009e0: 646f 775f 666f 725f 6e6f 6465 2229 0d0a  dow_for_node")..
-000009f0: 2020 2020 2020 2020 6966 2061 6374 6976          if activ
-00000a00: 6174 6520 6973 206e 6f74 204e 6f6e 653a  ate is not None:
-00000a10: 0d0a 2020 2020 2020 2020 2020 2020 6163  ..            ac
-00000a20: 7469 7661 7465 286e 6f64 6529 0d0a 0d0a  tivate(node)....
-00000a30: 2020 2020 4074 7265 655f 7365 7061 7261      @tree_separa
-00000a40: 746f 725f 6166 7465 7228 290d 0a20 2020  tor_after()..   
-00000a50: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
-00000a60: 285f 2822 4772 6f75 7020 7072 6f70 6572  (_("Group proper
-00000a70: 7469 6573 2229 2c20 6e6f 6465 5f74 7970  ties"), node_typ
-00000a80: 653d 2267 726f 7570 222c 2068 656c 703d  e="group", help=
-00000a90: 2222 290d 0a20 2020 2064 6566 2067 726f  "")..    def gro
-00000aa0: 7570 5f70 726f 7065 7274 7928 6e6f 6465  up_property(node
-00000ab0: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-00000ac0: 2020 2020 2020 6163 7469 7661 7465 203d        activate =
-00000ad0: 2073 656c 662e 6b65 726e 656c 2e6c 6f6f   self.kernel.loo
-00000ae0: 6b75 7028 2266 756e 6374 696f 6e2f 6f70  kup("function/op
-00000af0: 656e 5f70 726f 7065 7274 795f 7769 6e64  en_property_wind
-00000b00: 6f77 5f66 6f72 5f6e 6f64 6522 290d 0a20  ow_for_node").. 
-00000b10: 2020 2020 2020 2069 6620 6163 7469 7661         if activa
-00000b20: 7465 2069 7320 6e6f 7420 4e6f 6e65 3a0d  te is not None:.
-00000b30: 0a20 2020 2020 2020 2020 2020 2061 6374  .            act
-00000b40: 6976 6174 6528 6e6f 6465 290d 0a0d 0a20  ivate(node).... 
-00000b50: 2020 2040 7472 6565 5f73 6570 6172 6174     @tree_separat
-00000b60: 6f72 5f61 6674 6572 2829 0d0a 2020 2020  or_after()..    
-00000b70: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
-00000b80: 5f28 2254 6578 7420 7072 6f70 6572 7469  _("Text properti
-00000b90: 6573 2229 2c20 6e6f 6465 5f74 7970 653d  es"), node_type=
-00000ba0: 2265 6c65 6d20 7465 7874 222c 2068 656c  "elem text", hel
-00000bb0: 703d 2222 290d 0a20 2020 2064 6566 2074  p="")..    def t
-00000bc0: 6578 745f 7072 6f70 6572 7479 286e 6f64  ext_property(nod
-00000bd0: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
-00000be0: 2020 2020 2020 2061 6374 6976 6174 6520         activate 
-00000bf0: 3d20 7365 6c66 2e6b 6572 6e65 6c2e 6c6f  = self.kernel.lo
-00000c00: 6f6b 7570 2822 6675 6e63 7469 6f6e 2f6f  okup("function/o
-00000c10: 7065 6e5f 7072 6f70 6572 7479 5f77 696e  pen_property_win
-00000c20: 646f 775f 666f 725f 6e6f 6465 2229 0d0a  dow_for_node")..
-00000c30: 2020 2020 2020 2020 6966 2061 6374 6976          if activ
-00000c40: 6174 6520 6973 206e 6f74 204e 6f6e 653a  ate is not None:
-00000c50: 0d0a 2020 2020 2020 2020 2020 2020 6163  ..            ac
-00000c60: 7469 7661 7465 286e 6f64 6529 0d0a 0d0a  tivate(node)....
-00000c70: 2020 2020 4074 7265 655f 7365 7061 7261      @tree_separa
-00000c80: 746f 725f 6166 7465 7228 290d 0a20 2020  tor_after()..   
-00000c90: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
-00000ca0: 285f 2822 496d 6167 6520 7072 6f70 6572  (_("Image proper
-00000cb0: 7469 6573 2229 2c20 6e6f 6465 5f74 7970  ties"), node_typ
-00000cc0: 653d 2265 6c65 6d20 696d 6167 6522 2c20  e="elem image", 
-00000cd0: 6865 6c70 3d22 2229 0d0a 2020 2020 6465  help="")..    de
-00000ce0: 6620 696d 6167 655f 7072 6f70 6572 7479  f image_property
-00000cf0: 286e 6f64 652c 202a 2a6b 7761 7267 7329  (node, **kwargs)
-00000d00: 3a0d 0a20 2020 2020 2020 2061 6374 6976  :..        activ
-00000d10: 6174 6520 3d20 7365 6c66 2e6b 6572 6e65  ate = self.kerne
-00000d20: 6c2e 6c6f 6f6b 7570 2822 6675 6e63 7469  l.lookup("functi
-00000d30: 6f6e 2f6f 7065 6e5f 7072 6f70 6572 7479  on/open_property
-00000d40: 5f77 696e 646f 775f 666f 725f 6e6f 6465  _window_for_node
-00000d50: 2229 0d0a 2020 2020 2020 2020 6966 2061  ")..        if a
-00000d60: 6374 6976 6174 6520 6973 206e 6f74 204e  ctivate is not N
-00000d70: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-00000d80: 2020 6163 7469 7661 7465 286e 6f64 6529    activate(node)
-00000d90: 0d0a 0d0a 2020 2020 4074 7265 655f 636f  ....    @tree_co
-00000da0: 6e64 6974 696f 6e61 6c28 6c61 6d62 6461  nditional(lambda
-00000db0: 206e 6f64 653a 206e 6f74 2069 735f 7265   node: not is_re
-00000dc0: 676d 6172 6b28 6e6f 6465 2929 0d0a 2020  gmark(node))..  
-00000dd0: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
-00000de0: 6e28 5f28 2255 6e67 726f 7570 2065 6c65  n(_("Ungroup ele
-00000df0: 6d65 6e74 7322 292c 206e 6f64 655f 7479  ments"), node_ty
-00000e00: 7065 3d28 2267 726f 7570 222c 2022 6669  pe=("group", "fi
-00000e10: 6c65 2229 2c20 6865 6c70 3d22 2229 0d0a  le"), help="")..
-00000e20: 2020 2020 6465 6620 756e 6772 6f75 705f      def ungroup_
-00000e30: 656c 656d 656e 7473 286e 6f64 652c 202a  elements(node, *
-00000e40: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
-00000e50: 2020 2074 6f5f 7472 6561 7420 3d20 5b5d     to_treat = []
-00000e60: 0d0a 2020 2020 2020 2020 666f 7220 676e  ..        for gn
-00000e70: 6f64 6520 696e 2073 656c 662e 666c 6174  ode in self.flat
-00000e80: 2873 656c 6563 7465 643d 5472 7565 2c20  (selected=True, 
-00000e90: 6361 7363 6164 653d 4661 6c73 652c 2074  cascade=False, t
-00000ea0: 7970 6573 3d28 2267 726f 7570 222c 2022  ypes=("group", "
-00000eb0: 6669 6c65 2229 293a 0d0a 2020 2020 2020  file")):..      
-00000ec0: 2020 2020 2020 656e 6f64 6520 3d20 676e        enode = gn
-00000ed0: 6f64 650d 0a20 2020 2020 2020 2020 2020  ode..           
-00000ee0: 2077 6869 6c65 2054 7275 653a 0d0a 2020   while True:..  
-00000ef0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00000f00: 2065 6e6f 6465 2e70 6172 656e 7420 6973   enode.parent is
-00000f10: 204e 6f6e 6520 6f72 2065 6e6f 6465 2e70   None or enode.p
-00000f20: 6172 656e 7420 6973 2073 656c 662e 656c  arent is self.el
-00000f30: 656d 5f62 7261 6e63 683a 0d0a 2020 2020  em_branch:..    
-00000f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000f50: 6966 2065 6e6f 6465 206e 6f74 2069 6e20  if enode not in 
-00000f60: 746f 5f74 7265 6174 3a0d 0a20 2020 2020  to_treat:..     
-00000f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000f80: 2020 2074 6f5f 7472 6561 742e 6170 7065     to_treat.appe
-00000f90: 6e64 2865 6e6f 6465 290d 0a20 2020 2020  nd(enode)..     
-00000fa0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00000fb0: 7265 616b 0d0a 2020 2020 2020 2020 2020  reak..          
-00000fc0: 2020 2020 2020 6966 2065 6e6f 6465 2e70        if enode.p
-00000fd0: 6172 656e 742e 7365 6c65 6374 6564 3a0d  arent.selected:.
-00000fe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00000ff0: 2020 2020 2065 6e6f 6465 203d 2065 6e6f       enode = eno
-00001000: 6465 2e70 6172 656e 740d 0a20 2020 2020  de.parent..     
-00001010: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00001020: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00001030: 2020 2020 2020 6966 2065 6e6f 6465 206e        if enode n
-00001040: 6f74 2069 6e20 746f 5f74 7265 6174 3a0d  ot in to_treat:.
-00001050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001060: 2020 2020 2020 2020 2074 6f5f 7472 6561           to_trea
-00001070: 742e 6170 7065 6e64 2865 6e6f 6465 290d  t.append(enode).
-00001080: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001090: 2020 2020 2062 7265 616b 0d0a 0d0a 2020       break....  
-000010a0: 2020 2020 2020 666f 7220 676e 6f64 6520        for gnode 
-000010b0: 696e 2074 6f5f 7472 6561 743a 0d0a 2020  in to_treat:..  
-000010c0: 2020 2020 2020 2020 2020 666f 7220 6e20            for n 
-000010d0: 696e 206c 6973 7428 676e 6f64 652e 6368  in list(gnode.ch
-000010e0: 696c 6472 656e 293a 0d0a 2020 2020 2020  ildren):..      
-000010f0: 2020 2020 2020 2020 2020 676e 6f64 652e            gnode.
-00001100: 696e 7365 7274 5f73 6962 6c69 6e67 286e  insert_sibling(n
-00001110: 290d 0a20 2020 2020 2020 2020 2020 2067  )..            g
-00001120: 6e6f 6465 2e72 656d 6f76 655f 6e6f 6465  node.remove_node
-00001130: 2829 2020 2320 5265 6d6f 7669 6e67 2067  ()  # Removing g
-00001140: 726f 7570 2f66 696c 6520 6e6f 6465 2e0d  roup/file node..
-00001150: 0a0d 0a20 2020 2040 7472 6565 5f63 6f6e  ...    @tree_con
-00001160: 6469 7469 6f6e 616c 286c 616d 6264 6120  ditional(lambda 
-00001170: 6e6f 6465 3a20 6e6f 7420 6973 5f72 6567  node: not is_reg
-00001180: 6d61 726b 286e 6f64 6529 290d 0a20 2020  mark(node))..   
-00001190: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
-000011a0: 280d 0a20 2020 2020 2020 205f 2822 5369  (..        _("Si
-000011b0: 6d70 6c69 6679 2067 726f 7570 2229 2c0d  mplify group"),.
-000011c0: 0a20 2020 2020 2020 206e 6f64 655f 7479  .        node_ty
-000011d0: 7065 3d28 2267 726f 7570 222c 2022 6669  pe=("group", "fi
-000011e0: 6c65 2229 2c0d 0a20 2020 2020 2020 2068  le"),..        h
-000011f0: 656c 703d 5f28 2255 6e6c 6576 656c 2067  elp=_("Unlevel g
-00001200: 726f 7570 7320 6966 2074 6865 7920 6a75  roups if they ju
-00001210: 7374 2063 6f6e 7461 696e 2061 6e6f 7468  st contain anoth
-00001220: 6572 2067 726f 7570 2229 2c0d 0a20 2020  er group"),..   
-00001230: 2029 0d0a 2020 2020 6465 6620 7369 6d70   )..    def simp
-00001240: 6c69 6679 5f67 726f 7570 7328 6e6f 6465  lify_groups(node
-00001250: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-00001260: 2020 2020 2020 6465 6620 7374 7261 6967        def straig
-00001270: 6874 656e 2873 6e6f 6465 293a 0d0a 2020  hten(snode):..  
-00001280: 2020 2020 2020 2020 2020 616d 6f75 6e74            amount
-00001290: 203d 2030 0d0a 2020 2020 2020 2020 2020   = 0..          
-000012a0: 2020 6e65 6564 735f 7265 7065 7469 7469    needs_repetiti
-000012b0: 6f6e 203d 2054 7275 650d 0a20 2020 2020  on = True..     
-000012c0: 2020 2020 2020 2077 6869 6c65 206e 6565         while nee
-000012d0: 6473 5f72 6570 6574 6974 696f 6e3a 0d0a  ds_repetition:..
-000012e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000012f0: 6e65 6564 735f 7265 7065 7469 7469 6f6e  needs_repetition
-00001300: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
-00001310: 2020 2020 2020 2020 2020 636c 203d 206c            cl = l
-00001320: 6973 7428 736e 6f64 652e 6368 696c 6472  ist(snode.childr
-00001330: 656e 290d 0a20 2020 2020 2020 2020 2020  en)..           
-00001340: 2020 2020 2069 6620 6c65 6e28 636c 2920       if len(cl) 
-00001350: 3d3d 2030 3a0d 0a20 2020 2020 2020 2020  == 0:..         
-00001360: 2020 2020 2020 2020 2020 2023 204e 6f20             # No 
-00001370: 4368 696c 6472 656e 3f20 5265 6d6f 7665  Children? Remove
-00001380: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00001390: 2020 2020 2020 616d 6f75 6e74 203d 2031        amount = 1
-000013a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000013b0: 2020 2020 2020 736e 6f64 652e 7265 6d6f        snode.remo
-000013c0: 7665 5f6e 6f64 6528 290d 0a20 2020 2020  ve_node()..     
-000013d0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-000013e0: 6c65 6e28 636c 2920 3d3d 2031 3a0d 0a20  len(cl) == 1:.. 
-000013f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001400: 2020 2067 6e6f 6465 203d 2063 6c5b 305d     gnode = cl[0]
-00001410: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00001420: 2020 2020 2020 6966 2067 6e6f 6465 2069        if gnode i
-00001430: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2067  s not None and g
-00001440: 6e6f 6465 2e74 7970 6520 3d3d 2022 6772  node.type == "gr
-00001450: 6f75 7022 3a0d 0a20 2020 2020 2020 2020  oup":..         
-00001460: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00001470: 6f72 206e 2069 6e20 6c69 7374 2867 6e6f  or n in list(gno
-00001480: 6465 2e63 6869 6c64 7265 6e29 3a0d 0a20  de.children):.. 
-00001490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000014a0: 2020 2020 2020 2020 2020 2067 6e6f 6465             gnode
-000014b0: 2e69 6e73 6572 745f 7369 626c 696e 6728  .insert_sibling(
-000014c0: 6e29 0d0a 2020 2020 2020 2020 2020 2020  n)..            
-000014d0: 2020 2020 2020 2020 2020 2020 676e 6f64              gnod
-000014e0: 652e 7265 6d6f 7665 5f6e 6f64 6528 2920  e.remove_node() 
-000014f0: 2023 2052 656d 6f76 696e 6720 6772 6f75   # Removing grou
-00001500: 702f 6669 6c65 206e 6f64 652e 0d0a 2020  p/file node...  
-00001510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001520: 2020 2020 2020 6e65 6564 735f 7265 7065        needs_repe
-00001530: 7469 7469 6f6e 203d 2054 7275 650d 0a20  tition = True.. 
-00001540: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00001550: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00001560: 2020 2020 2020 2020 2020 666f 7220 6e20            for n 
-00001570: 696e 2063 6c3a 0d0a 2020 2020 2020 2020  in cl:..        
-00001580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001590: 6966 206e 2069 7320 6e6f 7420 4e6f 6e65  if n is not None
-000015a0: 2061 6e64 206e 2e74 7970 6520 3d3d 2022   and n.type == "
-000015b0: 6772 6f75 7022 3a0d 0a20 2020 2020 2020  group":..       
-000015c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000015d0: 2020 2020 2066 6e64 203d 2073 7472 6169       fnd = strai
-000015e0: 6768 7465 6e28 6e29 0d0a 2020 2020 2020  ghten(n)..      
-000015f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001600: 2020 2020 2020 616d 6f75 6e74 202b 3d20        amount += 
-00001610: 666e 640d 0a20 2020 2020 2020 2020 2020  fnd..           
-00001620: 2072 6574 7572 6e20 616d 6f75 6e74 0d0a   return amount..
-00001630: 0d0a 2020 2020 2020 2020 7265 7320 3d20  ..        res = 
-00001640: 7374 7261 6967 6874 656e 286e 6f64 6529  straighten(node)
-00001650: 0d0a 2020 2020 2020 2020 6966 2072 6573  ..        if res
-00001660: 203e 2030 3a0d 0a20 2020 2020 2020 2020   > 0:..         
-00001670: 2020 2073 656c 662e 7369 676e 616c 2822     self.signal("
-00001680: 7265 6275 696c 645f 7472 6565 2229 0d0a  rebuild_tree")..
-00001690: 0d0a 2020 2020 4074 7265 655f 636f 6e64  ..    @tree_cond
-000016a0: 6974 696f 6e61 6c28 6c61 6d62 6461 206e  itional(lambda n
-000016b0: 6f64 653a 206c 656e 286c 6973 7428 7365  ode: len(list(se
-000016c0: 6c66 2e65 6c65 6d73 2865 6d70 6861 7369  lf.elems(emphasi
-000016d0: 7a65 643d 5472 7565 2929 2920 3e20 3029  zed=True))) > 0)
-000016e0: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
-000016f0: 6174 696f 6e28 0d0a 2020 2020 2020 2020  ation(..        
-00001700: 5f28 2245 6c65 6d65 6e74 7320 696e 2073  _("Elements in s
-00001710: 6365 6e65 2e2e 2e22 292c 206e 6f64 655f  cene..."), node_
-00001720: 7479 7065 3d65 6c65 6d5f 6e6f 6465 732c  type=elem_nodes,
-00001730: 2068 656c 703d 2222 2c20 656e 6162 6c65   help="", enable
-00001740: 3d46 616c 7365 0d0a 2020 2020 290d 0a20  =False..    ).. 
-00001750: 2020 2064 6566 2065 6c65 6d65 6e74 5f6c     def element_l
-00001760: 6162 656c 286e 6f64 652c 202a 2a6b 7761  abel(node, **kwa
-00001770: 7267 7329 3a0d 0a20 2020 2020 2020 2072  rgs):..        r
-00001780: 6574 7572 6e0d 0a0d 0a20 2020 2040 7472  eturn....    @tr
-00001790: 6565 5f63 6f6e 6469 7469 6f6e 616c 286c  ee_conditional(l
-000017a0: 616d 6264 6120 6e6f 6465 3a20 6e6f 7420  ambda node: not 
-000017b0: 6973 5f72 6567 6d61 726b 286e 6f64 6529  is_regmark(node)
-000017c0: 290d 0a20 2020 2040 7472 6565 5f63 6f6e  )..    @tree_con
-000017d0: 6469 7469 6f6e 616c 286c 616d 6264 6120  ditional(lambda 
-000017e0: 6e6f 6465 3a20 6c65 6e28 6c69 7374 2873  node: len(list(s
-000017f0: 656c 662e 656c 656d 7328 656d 7068 6173  elf.elems(emphas
-00001800: 697a 6564 3d54 7275 6529 2929 203e 2031  ized=True))) > 1
-00001810: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
-00001820: 7261 7469 6f6e 285f 2822 4772 6f75 7020  ration(_("Group 
-00001830: 656c 656d 656e 7473 2229 2c20 6e6f 6465  elements"), node
-00001840: 5f74 7970 653d 656c 656d 5f6e 6f64 6573  _type=elem_nodes
-00001850: 2c20 6865 6c70 3d22 2229 0d0a 2020 2020  , help="")..    
-00001860: 6465 6620 6772 6f75 705f 656c 656d 656e  def group_elemen
-00001870: 7473 286e 6f64 652c 202a 2a6b 7761 7267  ts(node, **kwarg
-00001880: 7329 3a0d 0a20 2020 2020 2020 2067 726f  s):..        gro
-00001890: 7570 5f6e 6f64 6520 3d20 6e6f 6465 2e70  up_node = node.p
-000018a0: 6172 656e 742e 6164 6428 7479 7065 3d22  arent.add(type="
-000018b0: 6772 6f75 7022 2c20 6c61 6265 6c3d 2247  group", label="G
-000018c0: 726f 7570 2229 0d0a 2020 2020 2020 2020  roup")..        
-000018d0: 666f 7220 6520 696e 206c 6973 7428 7365  for e in list(se
-000018e0: 6c66 2e65 6c65 6d73 2865 6d70 6861 7369  lf.elems(emphasi
-000018f0: 7a65 643d 5472 7565 2929 3a0d 0a20 2020  zed=True)):..   
-00001900: 2020 2020 2020 2020 2067 726f 7570 5f6e           group_n
-00001910: 6f64 652e 6170 7065 6e64 5f63 6869 6c64  ode.append_child
-00001920: 2865 290d 0a0d 0a20 2020 2040 7472 6565  (e)....    @tree
-00001930: 5f63 6f6e 6469 7469 6f6e 616c 280d 0a20  _conditional(.. 
-00001940: 2020 2020 2020 206c 616d 6264 6120 636f         lambda co
-00001950: 6e64 3a20 6c65 6e28 6c69 7374 2873 656c  nd: len(list(sel
-00001960: 662e 666c 6174 2873 656c 6563 7465 643d  f.flat(selected=
-00001970: 5472 7565 2c20 6361 7363 6164 653d 4661  True, cascade=Fa
-00001980: 6c73 652c 2074 7970 6573 3d6f 705f 6e6f  lse, types=op_no
-00001990: 6465 7329 2929 0d0a 2020 2020 2020 2020  des)))..        
-000019a0: 3e3d 2031 0d0a 2020 2020 290d 0a20 2020  >= 1..    )..   
-000019b0: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
-000019c0: 280d 0a20 2020 2020 2020 205f 2822 5265  (..        _("Re
-000019d0: 6d6f 7665 2061 6c6c 2069 7465 6d73 2066  move all items f
-000019e0: 726f 6d20 6f70 6572 6174 696f 6e22 292c  rom operation"),
-000019f0: 206e 6f64 655f 7479 7065 3d6f 705f 7061   node_type=op_pa
-00001a00: 7265 6e74 5f6e 6f64 6573 2c20 6865 6c70  rent_nodes, help
-00001a10: 3d22 220d 0a20 2020 2029 0d0a 2020 2020  =""..    )..    
-00001a20: 6465 6620 636c 6561 725f 616c 6c5f 6f70  def clear_all_op
-00001a30: 5f65 6e74 7269 6573 286e 6f64 652c 202a  _entries(node, *
-00001a40: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
-00001a50: 2020 2077 6974 6820 7365 6c66 2e73 7461     with self.sta
-00001a60: 7469 6328 2263 6c65 6172 5f61 6c6c 5f6f  tic("clear_all_o
-00001a70: 7022 293a 0d0a 2020 2020 2020 2020 2020  p"):..          
-00001a80: 2020 6461 7461 203d 206c 6973 7428 290d    data = list().
-00001a90: 0a20 2020 2020 2020 2020 2020 2072 656d  .            rem
-00001aa0: 6f76 6564 203d 2046 616c 7365 0d0a 2020  oved = False..  
-00001ab0: 2020 2020 2020 2020 2020 666f 7220 6974            for it
-00001ac0: 656d 2069 6e20 6c69 7374 2873 656c 662e  em in list(self.
-00001ad0: 666c 6174 2873 656c 6563 7465 643d 5472  flat(selected=Tr
-00001ae0: 7565 2c20 6361 7363 6164 653d 4661 6c73  ue, cascade=Fals
-00001af0: 652c 2074 7970 6573 3d6f 705f 6e6f 6465  e, types=op_node
-00001b00: 7329 293a 0d0a 2020 2020 2020 2020 2020  s)):..          
-00001b10: 2020 2020 2020 6461 7461 2e61 7070 656e        data.appen
-00001b20: 6428 6974 656d 290d 0a20 2020 2020 2020  d(item)..       
-00001b30: 2020 2020 2066 6f72 2069 7465 6d20 696e       for item in
-00001b40: 2064 6174 613a 0d0a 2020 2020 2020 2020   data:..        
-00001b50: 2020 2020 2020 2020 7265 6d6f 7665 6420          removed 
-00001b60: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
-00001b70: 2020 2020 2020 2020 6974 656d 2e72 656d          item.rem
-00001b80: 6f76 655f 616c 6c5f 6368 696c 6472 656e  ove_all_children
-00001b90: 2829 0d0a 0d0a 2020 2020 4074 7265 655f  ()....    @tree_
-00001ba0: 636f 6e64 6974 696f 6e61 6c28 6c61 6d62  conditional(lamb
-00001bb0: 6461 206e 6f64 653a 2068 6173 6174 7472  da node: hasattr
-00001bc0: 286e 6f64 652c 2022 6f75 7470 7574 2229  (node, "output")
-00001bd0: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
-00001be0: 7261 7469 6f6e 285f 2822 456e 6162 6c65  ration(_("Enable
-00001bf0: 2f44 6973 6162 6c65 206f 7073 2229 2c20  /Disable ops"), 
-00001c00: 6e6f 6465 5f74 7970 653d 6f70 5f6e 6f64  node_type=op_nod
-00001c10: 6573 2c20 6865 6c70 3d22 2229 0d0a 2020  es, help="")..  
-00001c20: 2020 6465 6620 746f 6767 6c65 5f6e 5f6f    def toggle_n_o
-00001c30: 7065 7261 7469 6f6e 7328 6e6f 6465 2c20  perations(node, 
-00001c40: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
-00001c50: 2020 2020 6368 616e 6765 7320 3d20 5b5d      changes = []
-00001c60: 0d0a 2020 2020 2020 2020 666f 7220 6e20  ..        for n 
-00001c70: 696e 2073 656c 662e 6f70 7328 7365 6c65  in self.ops(sele
-00001c80: 6374 6564 3d54 7275 6529 3a0d 0a20 2020  cted=True):..   
-00001c90: 2020 2020 2020 2020 2069 6620 6861 7361           if hasa
-00001ca0: 7474 7228 6e2c 2022 6f75 7470 7574 2229  ttr(n, "output")
-00001cb0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00001cc0: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
-00001cd0: 2020 2020 2020 2020 2020 2020 206e 2e6f               n.o
-00001ce0: 7574 7075 7420 3d20 6e6f 7420 6e2e 6f75  utput = not n.ou
-00001cf0: 7470 7574 0d0a 2020 2020 2020 2020 2020  tput..          
-00001d00: 2020 2020 2020 2020 2020 6e2e 7570 6461            n.upda
-00001d10: 7465 6428 290d 0a20 2020 2020 2020 2020  ted()..         
-00001d20: 2020 2020 2020 2020 2020 2063 6861 6e67             chang
-00001d30: 6573 2e61 7070 656e 6428 6e29 0d0a 2020  es.append(n)..  
-00001d40: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00001d50: 6365 7074 2041 7474 7269 6275 7465 4572  cept AttributeEr
-00001d60: 726f 723a 0d0a 2020 2020 2020 2020 2020  ror:..          
-00001d70: 2020 2020 2020 2020 2020 7061 7373 0d0a            pass..
-00001d80: 2020 2020 2020 2020 6966 206c 656e 2863          if len(c
-00001d90: 6861 6e67 6573 2920 3e20 303a 0d0a 2020  hanges) > 0:..  
-00001da0: 2020 2020 2020 2020 2020 7365 6c66 2e76            self.v
-00001db0: 616c 6964 6174 655f 7365 6c65 6374 6564  alidate_selected
-00001dc0: 5f61 7265 6128 290d 0a20 2020 2020 2020  _area()..       
-00001dd0: 2020 2020 2073 656c 662e 7369 676e 616c       self.signal
-00001de0: 2822 656c 656d 656e 745f 7072 6f70 6572  ("element_proper
-00001df0: 7479 5f75 7064 6174 6522 2c20 6368 616e  ty_update", chan
-00001e00: 6765 7329 0d0a 2020 2020 2020 2020 2020  ges)..          
-00001e10: 2020 7365 6c66 2e73 6967 6e61 6c28 2272    self.signal("r
-00001e20: 6566 7265 7368 5f73 6365 6e65 222c 2022  efresh_scene", "
-00001e30: 5363 656e 6522 290d 0a0d 0a20 2020 2040  Scene")....    @
-00001e40: 7472 6565 5f63 6f6e 6469 7469 6f6e 616c  tree_conditional
-00001e50: 280d 0a20 2020 2020 2020 206c 616d 6264  (..        lambd
-00001e60: 6120 6e6f 6465 3a20 6861 7361 7474 7228  a node: hasattr(
-00001e70: 6e6f 6465 2c20 226f 7574 7075 7422 290d  node, "output").
-00001e80: 0a20 2020 2020 2020 2061 6e64 2068 6173  .        and has
-00001e90: 6174 7472 286e 6f64 652c 2022 6973 5f76  attr(node, "is_v
-00001ea0: 6973 6962 6c65 2229 0d0a 2020 2020 2020  isible")..      
-00001eb0: 2020 616e 6420 6e6f 7420 6765 7461 7474    and not getatt
-00001ec0: 7228 6e6f 6465 2c20 226f 7574 7075 7422  r(node, "output"
-00001ed0: 2c20 5472 7565 290d 0a20 2020 2029 0d0a  , True)..    )..
-00001ee0: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
-00001ef0: 696f 6e28 5f28 2253 686f 772f 4869 6465  ion(_("Show/Hide
-00001f00: 2063 6f6e 7461 696e 6564 2065 6c65 6d65   contained eleme
-00001f10: 6e74 7322 292c 206e 6f64 655f 7479 7065  nts"), node_type
-00001f20: 3d6f 705f 6e6f 6465 732c 2068 656c 703d  =op_nodes, help=
-00001f30: 2222 290d 0a20 2020 2064 6566 2074 6f67  "")..    def tog
-00001f40: 676c 655f 6f70 5f65 6c65 6d5f 7669 7369  gle_op_elem_visi
-00001f50: 6269 6c69 7479 286e 6f64 652c 202a 2a6b  bility(node, **k
-00001f60: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
-00001f70: 2063 6861 6e67 6573 203d 205b 5d0d 0a20   changes = [].. 
-00001f80: 2020 2020 2020 2066 6f72 206e 2069 6e20         for n in 
-00001f90: 7365 6c66 2e6f 7073 2873 656c 6563 7465  self.ops(selecte
-00001fa0: 643d 5472 7565 293a 0d0a 2020 2020 2020  d=True):..      
-00001fb0: 2020 2020 2020 6966 2068 6173 6174 7472        if hasattr
-00001fc0: 286e 2c20 226f 7574 7075 7422 2920 616e  (n, "output") an
-00001fd0: 6420 6861 7361 7474 7228 6e2c 2022 6973  d hasattr(n, "is
-00001fe0: 5f76 6973 6962 6c65 2229 3a0d 0a20 2020  _visible"):..   
-00001ff0: 2020 2020 2020 2020 2020 2020 206e 6577               new
-00002000: 666c 6167 203d 2054 7275 650d 0a20 2020  flag = True..   
-00002010: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00002020: 6e2e 6f75 7470 7574 2069 7320 6e6f 7420  n.output is not 
-00002030: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-00002040: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00002050: 7420 6e2e 6f75 7470 7574 3a0d 0a20 2020  t n.output:..   
-00002060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002070: 2020 2020 206e 6577 666c 6167 203d 2062       newflag = b
-00002080: 6f6f 6c28 6e6f 7420 6e2e 6973 5f76 6973  ool(not n.is_vis
-00002090: 6962 6c65 290d 0a20 2020 2020 2020 2020  ible)..         
-000020a0: 2020 2020 2020 206e 2e69 735f 7669 7369         n.is_visi
-000020b0: 626c 6520 3d20 6e65 7766 6c61 670d 0a20  ble = newflag.. 
-000020c0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-000020d0: 2e75 7064 6174 6564 2829 0d0a 2020 2020  .updated()..    
-000020e0: 2020 2020 2020 2020 2020 2020 6368 616e              chan
-000020f0: 6765 732e 6170 7065 6e64 286e 290d 0a20  ges.append(n).. 
-00002100: 2020 2020 2020 2069 6620 6c65 6e28 6368         if len(ch
-00002110: 616e 6765 7329 203e 2030 3a0d 0a20 2020  anges) > 0:..   
-00002120: 2020 2020 2020 2020 2073 656c 662e 7661           self.va
-00002130: 6c69 6461 7465 5f73 656c 6563 7465 645f  lidate_selected_
-00002140: 6172 6561 2829 0d0a 2020 2020 2020 2020  area()..        
-00002150: 2020 2020 7365 6c66 2e73 6967 6e61 6c28      self.signal(
-00002160: 2265 6c65 6d65 6e74 5f70 726f 7065 7274  "element_propert
-00002170: 795f 7570 6461 7465 222c 2063 6861 6e67  y_update", chang
-00002180: 6573 290d 0a20 2020 2020 2020 2020 2020  es)..           
-00002190: 2073 656c 662e 7369 676e 616c 2822 7265   self.signal("re
-000021a0: 6672 6573 685f 7363 656e 6522 2c20 2253  fresh_scene", "S
-000021b0: 6365 6e65 2229 0d0a 0d0a 2020 2020 4074  cene")....    @t
-000021c0: 7265 655f 7375 626d 656e 7528 5f28 2243  ree_submenu(_("C
-000021d0: 6f6e 7665 7274 206f 7065 7261 7469 6f6e  onvert operation
-000021e0: 2229 290d 0a20 2020 2040 7472 6565 5f6f  "))..    @tree_o
-000021f0: 7065 7261 7469 6f6e 285f 2822 436f 6e76  peration(_("Conv
-00002200: 6572 7420 746f 2049 6d61 6765 2229 2c20  ert to Image"), 
-00002210: 6e6f 6465 5f74 7970 653d 6f70 5f70 6172  node_type=op_par
-00002220: 656e 745f 6e6f 6465 732c 2068 656c 703d  ent_nodes, help=
-00002230: 2222 290d 0a20 2020 2064 6566 2063 6f6e  "")..    def con
-00002240: 7665 7274 5f6f 7065 7261 7469 6f6e 5f69  vert_operation_i
-00002250: 6d61 6765 286e 6f64 652c 202a 2a6b 7761  mage(node, **kwa
-00002260: 7267 7329 3a0d 0a20 2020 2020 2020 2066  rgs):..        f
-00002270: 6f72 206e 2069 6e20 6c69 7374 2873 656c  or n in list(sel
-00002280: 662e 6f70 7328 7365 6c65 6374 6564 3d54  f.ops(selected=T
-00002290: 7275 6529 293a 0d0a 2020 2020 2020 2020  rue)):..        
-000022a0: 2020 2020 6e65 775f 7365 7474 696e 6773      new_settings
-000022b0: 203d 2064 6963 7428 6e2e 7365 7474 696e   = dict(n.settin
-000022c0: 6773 290d 0a20 2020 2020 2020 2020 2020  gs)..           
-000022d0: 206e 6577 5f73 6574 7469 6e67 735b 2274   new_settings["t
-000022e0: 7970 6522 5d20 3d20 226f 7020 696d 6167  ype"] = "op imag
-000022f0: 6522 0d0a 2020 2020 2020 2020 2020 2020  e"..            
-00002300: 6e2e 7265 706c 6163 655f 6e6f 6465 286b  n.replace_node(k
-00002310: 6565 705f 6368 696c 6472 656e 3d54 7275  eep_children=Tru
-00002320: 652c 202a 2a6e 6577 5f73 6574 7469 6e67  e, **new_setting
-00002330: 7329 0d0a 2020 2020 2020 2020 7365 6c66  s)..        self
-00002340: 2e73 6967 6e61 6c28 2272 6562 7569 6c64  .signal("rebuild
-00002350: 5f74 7265 6522 290d 0a0d 0a20 2020 2040  _tree")....    @
-00002360: 7472 6565 5f73 7562 6d65 6e75 285f 2822  tree_submenu(_("
-00002370: 436f 6e76 6572 7420 6f70 6572 6174 696f  Convert operatio
-00002380: 6e22 2929 0d0a 2020 2020 4074 7265 655f  n"))..    @tree_
-00002390: 6f70 6572 6174 696f 6e28 5f28 2243 6f6e  operation(_("Con
-000023a0: 7665 7274 2074 6f20 5261 7374 6572 2229  vert to Raster")
-000023b0: 2c20 6e6f 6465 5f74 7970 653d 6f70 5f70  , node_type=op_p
-000023c0: 6172 656e 745f 6e6f 6465 732c 2068 656c  arent_nodes, hel
-000023d0: 703d 2222 290d 0a20 2020 2064 6566 2063  p="")..    def c
-000023e0: 6f6e 7665 7274 5f6f 7065 7261 7469 6f6e  onvert_operation
-000023f0: 5f72 6173 7465 7228 6e6f 6465 2c20 2a2a  _raster(node, **
-00002400: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
-00002410: 2020 666f 7220 6e20 696e 206c 6973 7428    for n in list(
-00002420: 7365 6c66 2e6f 7073 2873 656c 6563 7465  self.ops(selecte
-00002430: 643d 5472 7565 2929 3a0d 0a20 2020 2020  d=True)):..     
-00002440: 2020 2020 2020 206e 6577 5f73 6574 7469         new_setti
-00002450: 6e67 7320 3d20 6469 6374 286e 2e73 6574  ngs = dict(n.set
-00002460: 7469 6e67 7329 0d0a 2020 2020 2020 2020  tings)..        
-00002470: 2020 2020 6e65 775f 7365 7474 696e 6773      new_settings
-00002480: 5b22 7479 7065 225d 203d 2022 6f70 2072  ["type"] = "op r
-00002490: 6173 7465 7222 0d0a 2020 2020 2020 2020  aster"..        
-000024a0: 2020 2020 6e2e 7265 706c 6163 655f 6e6f      n.replace_no
-000024b0: 6465 286b 6565 705f 6368 696c 6472 656e  de(keep_children
-000024c0: 3d54 7275 652c 202a 2a6e 6577 5f73 6574  =True, **new_set
-000024d0: 7469 6e67 7329 0d0a 2020 2020 2020 2020  tings)..        
-000024e0: 7365 6c66 2e73 6967 6e61 6c28 2272 6562  self.signal("reb
-000024f0: 7569 6c64 5f74 7265 6522 290d 0a0d 0a20  uild_tree").... 
-00002500: 2020 2040 7472 6565 5f73 7562 6d65 6e75     @tree_submenu
-00002510: 285f 2822 436f 6e76 6572 7420 6f70 6572  (_("Convert oper
-00002520: 6174 696f 6e22 2929 0d0a 2020 2020 4074  ation"))..    @t
-00002530: 7265 655f 6f70 6572 6174 696f 6e28 5f28  ree_operation(_(
-00002540: 2243 6f6e 7665 7274 2074 6f20 456e 6772  "Convert to Engr
-00002550: 6176 6522 292c 206e 6f64 655f 7479 7065  ave"), node_type
-00002560: 3d6f 705f 7061 7265 6e74 5f6e 6f64 6573  =op_parent_nodes
-00002570: 2c20 6865 6c70 3d22 2229 0d0a 2020 2020  , help="")..    
-00002580: 6465 6620 636f 6e76 6572 745f 6f70 6572  def convert_oper
-00002590: 6174 696f 6e5f 656e 6772 6176 6528 6e6f  ation_engrave(no
-000025a0: 6465 2c20 2a2a 6b77 6172 6773 293a 0d0a  de, **kwargs):..
-000025b0: 2020 2020 2020 2020 666f 7220 6e20 696e          for n in
-000025c0: 206c 6973 7428 7365 6c66 2e6f 7073 2873   list(self.ops(s
-000025d0: 656c 6563 7465 643d 5472 7565 2929 3a0d  elected=True)):.
-000025e0: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
-000025f0: 5f73 6574 7469 6e67 7320 3d20 6469 6374  _settings = dict
-00002600: 286e 2e73 6574 7469 6e67 7329 0d0a 2020  (n.settings)..  
-00002610: 2020 2020 2020 2020 2020 6e65 775f 7365            new_se
-00002620: 7474 696e 6773 5b22 7479 7065 225d 203d  ttings["type"] =
-00002630: 2022 6f70 2065 6e67 7261 7665 220d 0a20   "op engrave".. 
-00002640: 2020 2020 2020 2020 2020 206e 2e72 6570             n.rep
-00002650: 6c61 6365 5f6e 6f64 6528 6b65 6570 5f63  lace_node(keep_c
-00002660: 6869 6c64 7265 6e3d 5472 7565 2c20 2a2a  hildren=True, **
-00002670: 6e65 775f 7365 7474 696e 6773 290d 0a20  new_settings).. 
-00002680: 2020 2020 2020 2073 656c 662e 7369 676e         self.sign
-00002690: 616c 2822 7265 6275 696c 645f 7472 6565  al("rebuild_tree
-000026a0: 2229 0d0a 0d0a 2020 2020 4074 7265 655f  ")....    @tree_
-000026b0: 7375 626d 656e 7528 5f28 2243 6f6e 7665  submenu(_("Conve
-000026c0: 7274 206f 7065 7261 7469 6f6e 2229 290d  rt operation")).
-000026d0: 0a20 2020 2040 7472 6565 5f6f 7065 7261  .    @tree_opera
-000026e0: 7469 6f6e 285f 2822 436f 6e76 6572 7420  tion(_("Convert 
-000026f0: 746f 2043 7574 2229 2c20 6e6f 6465 5f74  to Cut"), node_t
-00002700: 7970 653d 6f70 5f70 6172 656e 745f 6e6f  ype=op_parent_no
-00002710: 6465 732c 2068 656c 703d 2222 290d 0a20  des, help="").. 
-00002720: 2020 2064 6566 2063 6f6e 7665 7274 5f6f     def convert_o
-00002730: 7065 7261 7469 6f6e 5f63 7574 286e 6f64  peration_cut(nod
-00002740: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
-00002750: 2020 2020 2020 2066 6f72 206e 2069 6e20         for n in 
-00002760: 6c69 7374 2873 656c 662e 6f70 7328 7365  list(self.ops(se
-00002770: 6c65 6374 6564 3d54 7275 6529 293a 0d0a  lected=True)):..
-00002780: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00002790: 7365 7474 696e 6773 203d 2064 6963 7428  settings = dict(
-000027a0: 6e2e 7365 7474 696e 6773 290d 0a20 2020  n.settings)..   
-000027b0: 2020 2020 2020 2020 206e 6577 5f73 6574           new_set
-000027c0: 7469 6e67 735b 2274 7970 6522 5d20 3d20  tings["type"] = 
-000027d0: 226f 7020 6375 7422 0d0a 2020 2020 2020  "op cut"..      
-000027e0: 2020 2020 2020 6e2e 7265 706c 6163 655f        n.replace_
-000027f0: 6e6f 6465 286b 6565 705f 6368 696c 6472  node(keep_childr
-00002800: 656e 3d54 7275 652c 202a 2a6e 6577 5f73  en=True, **new_s
-00002810: 6574 7469 6e67 7329 0d0a 2020 2020 2020  ettings)..      
-00002820: 2020 7365 6c66 2e73 6967 6e61 6c28 2272    self.signal("r
-00002830: 6562 7569 6c64 5f74 7265 6522 290d 0a0d  ebuild_tree")...
-00002840: 0a20 2020 2040 7472 6565 5f73 7562 6d65  .    @tree_subme
-00002850: 6e75 285f 2822 436f 6e76 6572 7420 6f70  nu(_("Convert op
-00002860: 6572 6174 696f 6e22 2929 0d0a 2020 2020  eration"))..    
-00002870: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
-00002880: 5f28 2243 6f6e 7665 7274 2074 6f20 4861  _("Convert to Ha
-00002890: 7463 6822 292c 206e 6f64 655f 7479 7065  tch"), node_type
-000028a0: 3d6f 705f 7061 7265 6e74 5f6e 6f64 6573  =op_parent_nodes
-000028b0: 2c20 6865 6c70 3d22 2229 0d0a 2020 2020  , help="")..    
-000028c0: 6465 6620 636f 6e76 6572 745f 6f70 6572  def convert_oper
-000028d0: 6174 696f 6e5f 6861 7463 6828 6e6f 6465  ation_hatch(node
-000028e0: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-000028f0: 2020 2020 2020 666f 7220 6e20 696e 206c        for n in l
-00002900: 6973 7428 7365 6c66 2e6f 7073 2873 656c  ist(self.ops(sel
-00002910: 6563 7465 643d 5472 7565 2929 3a0d 0a20  ected=True)):.. 
-00002920: 2020 2020 2020 2020 2020 206e 6577 5f73             new_s
-00002930: 6574 7469 6e67 7320 3d20 6469 6374 286e  ettings = dict(n
-00002940: 2e73 6574 7469 6e67 7329 0d0a 2020 2020  .settings)..    
-00002950: 2020 2020 2020 2020 6e65 775f 7365 7474          new_sett
-00002960: 696e 6773 5b22 7479 7065 225d 203d 2022  ings["type"] = "
-00002970: 6f70 2068 6174 6368 220d 0a20 2020 2020  op hatch"..     
-00002980: 2020 2020 2020 206e 2e72 6570 6c61 6365         n.replace
-00002990: 5f6e 6f64 6528 6b65 6570 5f63 6869 6c64  _node(keep_child
-000029a0: 7265 6e3d 5472 7565 2c20 2a2a 6e65 775f  ren=True, **new_
-000029b0: 7365 7474 696e 6773 290d 0a20 2020 2020  settings)..     
-000029c0: 2020 2073 656c 662e 7369 676e 616c 2822     self.signal("
-000029d0: 7265 6275 696c 645f 7472 6565 2229 0d0a  rebuild_tree")..
-000029e0: 0d0a 2020 2020 4074 7265 655f 7375 626d  ..    @tree_subm
-000029f0: 656e 7528 5f28 2243 6f6e 7665 7274 206f  enu(_("Convert o
-00002a00: 7065 7261 7469 6f6e 2229 290d 0a20 2020  peration"))..   
-00002a10: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
-00002a20: 285f 2822 436f 6e76 6572 7420 746f 2044  (_("Convert to D
-00002a30: 6f74 7322 292c 206e 6f64 655f 7479 7065  ots"), node_type
-00002a40: 3d6f 705f 7061 7265 6e74 5f6e 6f64 6573  =op_parent_nodes
-00002a50: 2c20 6865 6c70 3d22 2229 0d0a 2020 2020  , help="")..    
-00002a60: 6465 6620 636f 6e76 6572 745f 6f70 6572  def convert_oper
-00002a70: 6174 696f 6e5f 646f 7473 286e 6f64 652c  ation_dots(node,
-00002a80: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
-00002a90: 2020 2020 2066 6f72 206e 2069 6e20 6c69       for n in li
-00002aa0: 7374 2873 656c 662e 6f70 7328 7365 6c65  st(self.ops(sele
-00002ab0: 6374 6564 3d54 7275 6529 293a 0d0a 2020  cted=True)):..  
-00002ac0: 2020 2020 2020 2020 2020 6e65 775f 7365            new_se
-00002ad0: 7474 696e 6773 203d 2064 6963 7428 6e2e  ttings = dict(n.
-00002ae0: 7365 7474 696e 6773 290d 0a20 2020 2020  settings)..     
-00002af0: 2020 2020 2020 206e 6577 5f73 6574 7469         new_setti
-00002b00: 6e67 735b 2274 7970 6522 5d20 3d20 226f  ngs["type"] = "o
-00002b10: 7020 646f 7473 220d 0a20 2020 2020 2020  p dots"..       
-00002b20: 2020 2020 206e 2e72 6570 6c61 6365 5f6e       n.replace_n
-00002b30: 6f64 6528 6b65 6570 5f63 6869 6c64 7265  ode(keep_childre
-00002b40: 6e3d 5472 7565 2c20 2a2a 6e65 775f 7365  n=True, **new_se
-00002b50: 7474 696e 6773 290d 0a20 2020 2020 2020  ttings)..       
-00002b60: 2073 656c 662e 7369 676e 616c 2822 7265   self.signal("re
-00002b70: 6275 696c 645f 7472 6565 2229 0d0a 0d0a  build_tree")....
-00002b80: 2020 2020 4074 7265 655f 7375 626d 656e      @tree_submen
-00002b90: 7528 5f28 2252 6173 7465 7257 697a 6172  u(_("RasterWizar
-00002ba0: 6422 2929 0d0a 2020 2020 4074 7265 655f  d"))..    @tree_
-00002bb0: 6f70 6572 6174 696f 6e28 5f28 2253 6574  operation(_("Set
-00002bc0: 2074 6f20 4e6f 6e65 2229 2c20 6e6f 6465   to None"), node
-00002bd0: 5f74 7970 653d 2265 6c65 6d20 696d 6167  _type="elem imag
-00002be0: 6522 2c20 6865 6c70 3d22 2229 0d0a 2020  e", help="")..  
-00002bf0: 2020 6465 6620 696d 6167 655f 7261 7374    def image_rast
-00002c00: 6572 7769 7a61 7264 5f61 7070 6c79 5f6e  erwizard_apply_n
-00002c10: 6f6e 6528 6e6f 6465 2c20 2a2a 6b77 6172  one(node, **kwar
-00002c20: 6773 293a 0d0a 2020 2020 2020 2020 6669  gs):..        fi
-00002c30: 7273 746e 6f64 6520 3d20 4e6f 6e65 0d0a  rstnode = None..
-00002c40: 2020 2020 2020 2020 666f 7220 6520 696e          for e in
-00002c50: 206c 6973 7428 7365 6c66 2e65 6c65 6d73   list(self.elems
-00002c60: 2865 6d70 6861 7369 7a65 643d 5472 7565  (emphasized=True
-00002c70: 2929 3a0d 0a20 2020 2020 2020 2020 2020  )):..           
-00002c80: 2069 6620 652e 7479 7065 2021 3d20 2265   if e.type != "e
-00002c90: 6c65 6d20 696d 6167 6522 3a0d 0a20 2020  lem image":..   
-00002ca0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00002cb0: 7469 6e75 650d 0a20 2020 2020 2020 2020  tinue..         
-00002cc0: 2020 2065 2e6f 7065 7261 7469 6f6e 7320     e.operations 
-00002cd0: 3d20 5b5d 0d0a 2020 2020 2020 2020 2020  = []..          
-00002ce0: 2020 652e 7570 6461 7465 284e 6f6e 6529    e.update(None)
-00002cf0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00002d00: 2066 6972 7374 6e6f 6465 2069 7320 4e6f   firstnode is No
-00002d10: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-00002d20: 2020 2020 2066 6972 7374 6e6f 6465 203d       firstnode =
-00002d30: 2065 0d0a 2020 2020 2020 2020 7365 6c66   e..        self
-00002d40: 2e73 6967 6e61 6c28 2272 6566 7265 7368  .signal("refresh
-00002d50: 5f73 6365 6e65 222c 2022 5363 656e 6522  _scene", "Scene"
-00002d60: 290d 0a20 2020 2020 2020 2061 6374 6976  )..        activ
-00002d70: 6174 6520 3d20 7365 6c66 2e6b 6572 6e65  ate = self.kerne
-00002d80: 6c2e 6c6f 6f6b 7570 2822 6675 6e63 7469  l.lookup("functi
-00002d90: 6f6e 2f6f 7065 6e5f 7072 6f70 6572 7479  on/open_property
-00002da0: 5f77 696e 646f 775f 666f 725f 6e6f 6465  _window_for_node
-00002db0: 2229 0d0a 2020 2020 2020 2020 6966 2061  ")..        if a
-00002dc0: 6374 6976 6174 6520 6973 206e 6f74 204e  ctivate is not N
-00002dd0: 6f6e 6520 616e 6420 6669 7273 746e 6f64  one and firstnod
-00002de0: 6520 6973 206e 6f74 204e 6f6e 653a 0d0a  e is not None:..
-00002df0: 2020 2020 2020 2020 2020 2020 6163 7469              acti
-00002e00: 7661 7465 2866 6972 7374 6e6f 6465 290d  vate(firstnode).
-00002e10: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00002e20: 662e 7369 676e 616c 2822 7072 6f70 7570  f.signal("propup
-00002e30: 6461 7465 222c 2066 6972 7374 6e6f 6465  date", firstnode
-00002e40: 290d 0a0d 0a20 2020 2040 7472 6565 5f73  )....    @tree_s
-00002e50: 7562 6d65 6e75 285f 2822 5261 7374 6572  ubmenu(_("Raster
-00002e60: 5769 7a61 7264 2229 290d 0a20 2020 2040  Wizard"))..    @
-00002e70: 7472 6565 5f76 616c 7565 7328 2273 6372  tree_values("scr
-00002e80: 6970 7422 2c20 7661 6c75 6573 3d6c 6973  ipt", values=lis
-00002e90: 7428 7365 6c66 2e6d 6174 6368 2822 7261  t(self.match("ra
-00002ea0: 7374 6572 5f73 6372 6970 7422 2c20 7375  ster_script", su
-00002eb0: 6666 6978 3d54 7275 6529 2929 0d0a 2020  ffix=True)))..  
-00002ec0: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
-00002ed0: 6e28 5f28 2241 7070 6c79 3a20 7b73 6372  n(_("Apply: {scr
-00002ee0: 6970 747d 2229 2c20 6e6f 6465 5f74 7970  ipt}"), node_typ
-00002ef0: 653d 2265 6c65 6d20 696d 6167 6522 2c20  e="elem image", 
-00002f00: 6865 6c70 3d22 2229 0d0a 2020 2020 6465  help="")..    de
-00002f10: 6620 696d 6167 655f 7261 7374 6572 7769  f image_rasterwi
-00002f20: 7a61 7264 5f61 7070 6c79 286e 6f64 652c  zard_apply(node,
-00002f30: 2073 6372 6970 743d 4e6f 6e65 2c20 2a2a   script=None, **
-00002f40: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
-00002f50: 2020 7261 7374 6572 5f73 6372 6970 7420    raster_script 
-00002f60: 3d20 7365 6c66 2e6c 6f6f 6b75 7028 6622  = self.lookup(f"
-00002f70: 7261 7374 6572 5f73 6372 6970 742f 7b73  raster_script/{s
-00002f80: 6372 6970 747d 2229 0d0a 2020 2020 2020  cript}")..      
-00002f90: 2020 6669 7273 746e 6f64 6520 3d20 4e6f    firstnode = No
-00002fa0: 6e65 0d0a 2020 2020 2020 2020 666f 7220  ne..        for 
-00002fb0: 6520 696e 206c 6973 7428 7365 6c66 2e65  e in list(self.e
-00002fc0: 6c65 6d73 2865 6d70 6861 7369 7a65 643d  lems(emphasized=
-00002fd0: 5472 7565 2929 3a0d 0a20 2020 2020 2020  True)):..       
-00002fe0: 2020 2020 2069 6620 652e 7479 7065 2021       if e.type !
-00002ff0: 3d20 2265 6c65 6d20 696d 6167 6522 3a0d  = "elem image":.
-00003000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003010: 2063 6f6e 7469 6e75 650d 0a20 2020 2020   continue..     
-00003020: 2020 2020 2020 2065 2e6f 7065 7261 7469         e.operati
-00003030: 6f6e 7320 3d20 7261 7374 6572 5f73 6372  ons = raster_scr
-00003040: 6970 740d 0a20 2020 2020 2020 2020 2020  ipt..           
-00003050: 2065 2e75 7064 6174 6528 4e6f 6e65 290d   e.update(None).
-00003060: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00003070: 6669 7273 746e 6f64 6520 6973 204e 6f6e  firstnode is Non
-00003080: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00003090: 2020 2020 6669 7273 746e 6f64 6520 3d20      firstnode = 
-000030a0: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
-000030b0: 7369 676e 616c 2822 7265 6672 6573 685f  signal("refresh_
-000030c0: 7363 656e 6522 2c20 2253 6365 6e65 2229  scene", "Scene")
-000030d0: 0d0a 2020 2020 2020 2020 6163 7469 7661  ..        activa
-000030e0: 7465 203d 2073 656c 662e 6b65 726e 656c  te = self.kernel
-000030f0: 2e6c 6f6f 6b75 7028 2266 756e 6374 696f  .lookup("functio
-00003100: 6e2f 6f70 656e 5f70 726f 7065 7274 795f  n/open_property_
-00003110: 7769 6e64 6f77 5f66 6f72 5f6e 6f64 6522  window_for_node"
-00003120: 290d 0a20 2020 2020 2020 2069 6620 6163  )..        if ac
-00003130: 7469 7661 7465 2069 7320 6e6f 7420 4e6f  tivate is not No
-00003140: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-00003150: 2061 6374 6976 6174 6528 6e6f 6465 290d   activate(node).
-00003160: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00003170: 662e 7369 676e 616c 2822 7072 6f70 7570  f.signal("propup
-00003180: 6461 7465 222c 206e 6f64 6529 0d0a 0d0a  date", node)....
-00003190: 2020 2020 6465 6620 7261 6469 6f5f 6d61      def radio_ma
-000031a0: 7463 685f 7370 6565 6428 6e6f 6465 2c20  tch_speed(node, 
-000031b0: 7370 6565 643d 302c 202a 2a6b 7761 7267  speed=0, **kwarg
-000031c0: 7329 3a0d 0a20 2020 2020 2020 2072 6574  s):..        ret
-000031d0: 7572 6e20 6e6f 6465 2e73 7065 6564 203d  urn node.speed =
-000031e0: 3d20 666c 6f61 7428 7370 6565 6429 0d0a  = float(speed)..
-000031f0: 0d0a 2020 2020 4074 7265 655f 7375 626d  ..    @tree_subm
-00003200: 656e 7528 5f28 2253 7065 6564 2066 6f72  enu(_("Speed for
-00003210: 2052 6173 7465 722d 4f70 6572 6174 696f   Raster-Operatio
-00003220: 6e22 2929 0d0a 2020 2020 4074 7265 655f  n"))..    @tree_
-00003230: 7261 6469 6f28 7261 6469 6f5f 6d61 7463  radio(radio_matc
-00003240: 685f 7370 6565 6429 0d0a 2020 2020 4074  h_speed)..    @t
-00003250: 7265 655f 7661 6c75 6573 2822 7370 6565  ree_values("spee
-00003260: 6422 2c20 2835 2c20 3130 2c20 3530 2c20  d", (5, 10, 50, 
-00003270: 3735 2c20 3130 302c 2031 3530 2c20 3230  75, 100, 150, 20
-00003280: 302c 2032 3530 2c20 3330 302c 2033 3530  0, 250, 300, 350
-00003290: 2c20 3430 302c 2034 3530 2c20 3530 3029  , 400, 450, 500)
-000032a0: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
-000032b0: 7261 7469 6f6e 285f 2822 7b73 7065 6564  ration(_("{speed
-000032c0: 7d6d 6d2f 7322 292c 206e 6f64 655f 7479  }mm/s"), node_ty
-000032d0: 7065 3d28 226f 7020 7261 7374 6572 222c  pe=("op raster",
-000032e0: 2022 6f70 2069 6d61 6765 2229 2c20 6865   "op image"), he
-000032f0: 6c70 3d22 2229 0d0a 2020 2020 6465 6620  lp="")..    def 
-00003300: 7365 745f 7370 6565 645f 7261 7374 6572  set_speed_raster
-00003310: 286e 6f64 652c 2073 7065 6564 3d31 3530  (node, speed=150
-00003320: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-00003330: 2020 2020 2020 6461 7461 203d 206c 6973        data = lis
-00003340: 7428 290d 0a20 2020 2020 2020 2066 6f72  t()..        for
-00003350: 206e 2069 6e20 6c69 7374 2873 656c 662e   n in list(self.
-00003360: 6f70 7328 7365 6c65 6374 6564 3d54 7275  ops(selected=Tru
-00003370: 6529 293a 0d0a 2020 2020 2020 2020 2020  e)):..          
-00003380: 2020 6966 206e 2e74 7970 6520 6e6f 7420    if n.type not 
-00003390: 696e 2028 226f 7020 7261 7374 6572 222c  in ("op raster",
-000033a0: 2022 6f70 2069 6d61 6765 2229 3a0d 0a20   "op image"):.. 
-000033b0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000033c0: 6f6e 7469 6e75 650d 0a20 2020 2020 2020  ontinue..       
-000033d0: 2020 2020 206e 2e73 7065 6564 203d 2066       n.speed = f
-000033e0: 6c6f 6174 2873 7065 6564 290d 0a20 2020  loat(speed)..   
-000033f0: 2020 2020 2020 2020 2064 6174 612e 6170           data.ap
-00003400: 7065 6e64 286e 290d 0a20 2020 2020 2020  pend(n)..       
-00003410: 2073 656c 662e 7369 676e 616c 2822 656c   self.signal("el
-00003420: 656d 656e 745f 7072 6f70 6572 7479 5f72  ement_property_r
-00003430: 656c 6f61 6422 2c20 6461 7461 290d 0a0d  eload", data)...
-00003440: 0a20 2020 2040 7472 6565 5f73 7562 6d65  .    @tree_subme
-00003450: 6e75 285f 2822 5370 6565 6420 666f 7220  nu(_("Speed for 
-00003460: 456e 6772 6176 652d 4f70 6572 6174 696f  Engrave-Operatio
-00003470: 6e22 2929 0d0a 2020 2020 4074 7265 655f  n"))..    @tree_
-00003480: 7261 6469 6f28 7261 6469 6f5f 6d61 7463  radio(radio_matc
-00003490: 685f 7370 6565 6429 0d0a 2020 2020 4074  h_speed)..    @t
-000034a0: 7265 655f 7661 6c75 6573 2822 7370 6565  ree_values("spee
-000034b0: 6422 2c20 2835 2c20 372c 2031 302c 2031  d", (5, 7, 10, 1
-000034c0: 352c 2032 302c 2032 352c 2033 302c 2033  5, 20, 25, 30, 3
-000034d0: 352c 2034 302c 2035 3029 290d 0a20 2020  5, 40, 50))..   
-000034e0: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
-000034f0: 280d 0a20 2020 2020 2020 205f 2822 7b73  (..        _("{s
-00003500: 7065 6564 7d6d 6d2f 7322 292c 0d0a 2020  peed}mm/s"),..  
-00003510: 2020 2020 2020 6e6f 6465 5f74 7970 653d        node_type=
-00003520: 2822 6f70 2065 6e67 7261 7665 222c 2022  ("op engrave", "
-00003530: 6f70 2068 6174 6368 2229 2c0d 0a20 2020  op hatch"),..   
-00003540: 2020 2020 2068 656c 703d 2222 2c0d 0a20       help="",.. 
-00003550: 2020 2029 0d0a 2020 2020 6465 6620 7365     )..    def se
-00003560: 745f 7370 6565 645f 7665 6374 6f72 286e  t_speed_vector(n
-00003570: 6f64 652c 2073 7065 6564 3d33 352c 202a  ode, speed=35, *
-00003580: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
-00003590: 2020 2064 6174 6120 3d20 6c69 7374 2829     data = list()
-000035a0: 0d0a 2020 2020 2020 2020 666f 7220 6e20  ..        for n 
-000035b0: 696e 206c 6973 7428 7365 6c66 2e6f 7073  in list(self.ops
-000035c0: 2873 656c 6563 7465 643d 5472 7565 2929  (selected=True))
-000035d0: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-000035e0: 6620 6e2e 7479 7065 206e 6f74 2069 6e20  f n.type not in 
-000035f0: 2822 6f70 2065 6e67 7261 7665 222c 2022  ("op engrave", "
-00003600: 6f70 2068 6174 6368 2229 3a0d 0a20 2020  op hatch"):..   
-00003610: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00003620: 7469 6e75 650d 0a20 2020 2020 2020 2020  tinue..         
-00003630: 2020 206e 2e73 7065 6564 203d 2066 6c6f     n.speed = flo
-00003640: 6174 2873 7065 6564 290d 0a20 2020 2020  at(speed)..     
-00003650: 2020 2020 2020 2064 6174 612e 6170 7065         data.appe
-00003660: 6e64 286e 290d 0a20 2020 2020 2020 2073  nd(n)..        s
-00003670: 656c 662e 7369 676e 616c 2822 656c 656d  elf.signal("elem
-00003680: 656e 745f 7072 6f70 6572 7479 5f72 656c  ent_property_rel
-00003690: 6f61 6422 2c20 6461 7461 290d 0a0d 0a20  oad", data).... 
-000036a0: 2020 2040 7472 6565 5f73 7562 6d65 6e75     @tree_submenu
-000036b0: 285f 2822 5370 6565 6420 666f 7220 4375  (_("Speed for Cu
-000036c0: 742d 4f70 6572 6174 696f 6e22 2929 0d0a  t-Operation"))..
-000036d0: 2020 2020 4074 7265 655f 7261 6469 6f28      @tree_radio(
-000036e0: 7261 6469 6f5f 6d61 7463 685f 7370 6565  radio_match_spee
-000036f0: 6429 0d0a 2020 2020 4074 7265 655f 7661  d)..    @tree_va
-00003700: 6c75 6573 2822 7370 6565 6422 2c20 2832  lues("speed", (2
-00003710: 2c20 332c 2034 2c20 352c 2036 2c20 372c  , 3, 4, 5, 6, 7,
-00003720: 2031 302c 2031 352c 2032 302c 2032 352c   10, 15, 20, 25,
-00003730: 2033 302c 2033 3529 290d 0a20 2020 2040   30, 35))..    @
-00003740: 7472 6565 5f6f 7065 7261 7469 6f6e 280d  tree_operation(.
-00003750: 0a20 2020 2020 2020 205f 2822 7b73 7065  .        _("{spe
-00003760: 6564 7d6d 6d2f 7322 292c 0d0a 2020 2020  ed}mm/s"),..    
-00003770: 2020 2020 6e6f 6465 5f74 7970 653d 226f      node_type="o
-00003780: 7020 6375 7422 2c0d 0a20 2020 2020 2020  p cut",..       
-00003790: 2068 656c 703d 2222 2c0d 0a20 2020 2029   help="",..    )
-000037a0: 0d0a 2020 2020 6465 6620 7365 745f 7370  ..    def set_sp
-000037b0: 6565 645f 7665 6374 6f72 5f63 7574 286e  eed_vector_cut(n
-000037c0: 6f64 652c 2073 7065 6564 3d32 302c 202a  ode, speed=20, *
-000037d0: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
-000037e0: 2020 2064 6174 6120 3d20 6c69 7374 2829     data = list()
-000037f0: 0d0a 2020 2020 2020 2020 666f 7220 6e20  ..        for n 
-00003800: 696e 206c 6973 7428 7365 6c66 2e6f 7073  in list(self.ops
-00003810: 2873 656c 6563 7465 643d 5472 7565 2929  (selected=True))
-00003820: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-00003830: 6620 6e2e 7479 7065 2021 3d20 226f 7020  f n.type != "op 
-00003840: 6375 7422 3a0d 0a20 2020 2020 2020 2020  cut":..         
-00003850: 2020 2020 2020 2063 6f6e 7469 6e75 650d         continue.
-00003860: 0a20 2020 2020 2020 2020 2020 206e 2e73  .            n.s
-00003870: 7065 6564 203d 2066 6c6f 6174 2873 7065  peed = float(spe
-00003880: 6564 290d 0a20 2020 2020 2020 2020 2020  ed)..           
-00003890: 2064 6174 612e 6170 7065 6e64 286e 290d   data.append(n).
-000038a0: 0a20 2020 2020 2020 2073 656c 662e 7369  .        self.si
-000038b0: 676e 616c 2822 656c 656d 656e 745f 7072  gnal("element_pr
-000038c0: 6f70 6572 7479 5f72 656c 6f61 6422 2c20  operty_reload", 
-000038d0: 6461 7461 290d 0a0d 0a20 2020 2064 6566  data)....    def
-000038e0: 2072 6164 696f 5f6d 6174 6368 5f70 6f77   radio_match_pow
-000038f0: 6572 286e 6f64 652c 2070 6f77 6572 3d30  er(node, power=0
-00003900: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-00003910: 2020 2020 2020 7265 7475 726e 206e 6f64        return nod
-00003920: 652e 706f 7765 7220 3d3d 2066 6c6f 6174  e.power == float
-00003930: 2870 6f77 6572 290d 0a0d 0a20 2020 2040  (power)....    @
-00003940: 7472 6565 5f73 7562 6d65 6e75 285f 2822  tree_submenu(_("
-00003950: 506f 7765 7222 2929 0d0a 2020 2020 4074  Power"))..    @t
-00003960: 7265 655f 7261 6469 6f28 7261 6469 6f5f  ree_radio(radio_
-00003970: 6d61 7463 685f 706f 7765 7229 0d0a 2020  match_power)..  
-00003980: 2020 4074 7265 655f 7661 6c75 6573 2822    @tree_values("
-00003990: 706f 7765 7222 2c20 2831 3030 2c20 3235  power", (100, 25
-000039a0: 302c 2033 3333 2c20 3530 302c 2036 3637  0, 333, 500, 667
-000039b0: 2c20 3735 302c 2031 3030 3029 290d 0a20  , 750, 1000)).. 
-000039c0: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
-000039d0: 6f6e 280d 0a20 2020 2020 2020 205f 2822  on(..        _("
-000039e0: 7b70 6f77 6572 7d70 7069 2229 2c0d 0a20  {power}ppi"),.. 
-000039f0: 2020 2020 2020 206e 6f64 655f 7479 7065         node_type
-00003a00: 3d28 226f 7020 6375 7422 2c20 226f 7020  =("op cut", "op 
-00003a10: 7261 7374 6572 222c 2022 6f70 2069 6d61  raster", "op ima
-00003a20: 6765 222c 2022 6f70 2065 6e67 7261 7665  ge", "op engrave
-00003a30: 222c 2022 6f70 2068 6174 6368 2229 2c0d  ", "op hatch"),.
-00003a40: 0a20 2020 2020 2020 2068 656c 703d 2222  .        help=""
-00003a50: 2c0d 0a20 2020 2029 0d0a 2020 2020 6465  ,..    )..    de
-00003a60: 6620 7365 745f 706f 7765 7228 6e6f 6465  f set_power(node
-00003a70: 2c20 706f 7765 723d 3130 3030 2c20 2a2a  , power=1000, **
-00003a80: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
-00003a90: 2020 6461 7461 203d 206c 6973 7428 290d    data = list().
-00003aa0: 0a20 2020 2020 2020 2066 6f72 206e 2069  .        for n i
-00003ab0: 6e20 6c69 7374 2873 656c 662e 6f70 7328  n list(self.ops(
-00003ac0: 7365 6c65 6374 6564 3d54 7275 6529 293a  selected=True)):
-00003ad0: 0d0a 2020 2020 2020 2020 2020 2020 6e2e  ..            n.
-00003ae0: 706f 7765 7220 3d20 666c 6f61 7428 706f  power = float(po
-00003af0: 7765 7229 0d0a 2020 2020 2020 2020 2020  wer)..          
-00003b00: 2020 6461 7461 2e61 7070 656e 6428 6e29    data.append(n)
-00003b10: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
-00003b20: 6967 6e61 6c28 2265 6c65 6d65 6e74 5f70  ignal("element_p
-00003b30: 726f 7065 7274 795f 7265 6c6f 6164 222c  roperty_reload",
-00003b40: 2064 6174 6129 0d0a 0d0a 2020 2020 6465   data)....    de
-00003b50: 6620 7261 6469 6f5f 6d61 7463 6828 6e6f  f radio_match(no
-00003b60: 6465 2c20 6470 693d 3130 302c 202a 2a6b  de, dpi=100, **k
-00003b70: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
-00003b80: 2072 6574 7572 6e20 6e6f 6465 2e64 7069   return node.dpi
-00003b90: 203d 3d20 6470 690d 0a0d 0a20 2020 2040   == dpi....    @
-00003ba0: 7472 6565 5f73 7562 6d65 6e75 285f 2822  tree_submenu(_("
-00003bb0: 4450 4922 2929 0d0a 2020 2020 4074 7265  DPI"))..    @tre
-00003bc0: 655f 7261 6469 6f28 7261 6469 6f5f 6d61  e_radio(radio_ma
-00003bd0: 7463 6829 0d0a 2020 2020 4074 7265 655f  tch)..    @tree_
-00003be0: 7661 6c75 6573 2822 6470 6922 2c20 2831  values("dpi", (1
-00003bf0: 3030 2c20 3235 302c 2033 3333 2c20 3530  00, 250, 333, 50
-00003c00: 302c 2036 3637 2c20 3735 302c 2031 3030  0, 667, 750, 100
-00003c10: 3029 290d 0a20 2020 2040 7472 6565 5f6f  0))..    @tree_o
-00003c20: 7065 7261 7469 6f6e 280d 0a20 2020 2020  peration(..     
-00003c30: 2020 205f 2822 4450 4920 7b64 7069 7d22     _("DPI {dpi}"
-00003c40: 292c 0d0a 2020 2020 2020 2020 6e6f 6465  ),..        node
-00003c50: 5f74 7970 653d 2822 6f70 2072 6173 7465  _type=("op raste
-00003c60: 7222 2c20 2265 6c65 6d20 696d 6167 6522  r", "elem image"
-00003c70: 292c 0d0a 2020 2020 2020 2020 6865 6c70  ),..        help
-00003c80: 3d5f 2822 4368 616e 6765 2064 7069 2076  =_("Change dpi v
-00003c90: 616c 7565 7322 292c 0d0a 2020 2020 290d  alues"),..    ).
-00003ca0: 0a20 2020 2064 6566 2073 6574 5f73 7465  .    def set_ste
-00003cb0: 705f 6e28 6e6f 6465 2c20 6470 693d 312c  p_n(node, dpi=1,
-00003cc0: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
-00003cd0: 2020 2020 2064 6174 6120 3d20 6c69 7374       data = list
-00003ce0: 2829 0d0a 2020 2020 2020 2020 666f 7220  ()..        for 
-00003cf0: 6e20 696e 206c 6973 7428 7365 6c66 2e6f  n in list(self.o
-00003d00: 7073 2873 656c 6563 7465 643d 5472 7565  ps(selected=True
-00003d10: 2929 3a0d 0a20 2020 2020 2020 2020 2020  )):..           
-00003d20: 206e 2e64 7069 203d 2064 7069 0d0a 2020   n.dpi = dpi..  
-00003d30: 2020 2020 2020 2020 2020 6461 7461 2e61            data.a
-00003d40: 7070 656e 6428 6e29 0d0a 2020 2020 2020  ppend(n)..      
-00003d50: 2020 666f 7220 6e20 696e 206c 6973 7428    for n in list(
-00003d60: 7365 6c66 2e65 6c65 6d73 2865 6d70 6861  self.elems(empha
-00003d70: 7369 7a65 643d 5472 7565 2929 3a0d 0a20  sized=True)):.. 
-00003d80: 2020 2020 2020 2020 2020 2069 6620 6e2e             if n.
-00003d90: 7479 7065 203d 3d20 2265 6c65 6d20 696d  type == "elem im
-00003da0: 6167 6522 3a0d 0a20 2020 2020 2020 2020  age":..         
-00003db0: 2020 2020 2020 206e 2e64 7069 203d 2064         n.dpi = d
-00003dc0: 7069 0d0a 2020 2020 2020 2020 2020 2020  pi..            
-00003dd0: 2020 2020 6e2e 7570 6461 7465 284e 6f6e      n.update(Non
-00003de0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-00003df0: 2020 2020 6461 7461 2e61 7070 656e 6428      data.append(
-00003e00: 6e29 0d0a 2020 2020 2020 2020 7365 6c66  n)..        self
-00003e10: 2e73 6967 6e61 6c28 2272 6566 7265 7368  .signal("refresh
-00003e20: 5f73 6365 6e65 222c 2022 5363 656e 6522  _scene", "Scene"
-00003e30: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00003e40: 7369 676e 616c 2822 656c 656d 656e 745f  signal("element_
-00003e50: 7072 6f70 6572 7479 5f72 656c 6f61 6422  property_reload"
-00003e60: 2c20 6461 7461 290d 0a0d 0a20 2020 2064  , data)....    d
-00003e70: 6566 2072 6164 696f 5f6d 6174 6368 5f70  ef radio_match_p
-00003e80: 6173 7365 7328 6e6f 6465 2c20 7061 7373  asses(node, pass
-00003e90: 7661 6c75 653d 312c 202a 2a6b 7761 7267  value=1, **kwarg
-00003ea0: 7329 3a0d 0a20 2020 2020 2020 2072 6574  s):..        ret
-00003eb0: 7572 6e20 286e 6f64 652e 7061 7373 6573  urn (node.passes
-00003ec0: 5f63 7573 746f 6d20 616e 6420 7061 7373  _custom and pass
-00003ed0: 7661 6c75 6520 3d3d 206e 6f64 652e 7061  value == node.pa
-00003ee0: 7373 6573 2920 6f72 2028 0d0a 2020 2020  sses) or (..    
-00003ef0: 2020 2020 2020 2020 6e6f 7420 6e6f 6465          not node
-00003f00: 2e70 6173 7365 735f 6375 7374 6f6d 2061  .passes_custom a
-00003f10: 6e64 2070 6173 7376 616c 7565 203d 3d20  nd passvalue == 
-00003f20: 310d 0a20 2020 2020 2020 2029 0d0a 0d0a  1..        )....
-00003f30: 2020 2020 4074 7265 655f 7375 626d 656e      @tree_submen
-00003f40: 7528 5f28 2253 6574 206f 7065 7261 7469  u(_("Set operati
-00003f50: 6f6e 2070 6173 7365 7322 2929 0d0a 2020  on passes"))..  
-00003f60: 2020 4074 7265 655f 7261 6469 6f28 7261    @tree_radio(ra
-00003f70: 6469 6f5f 6d61 7463 685f 7061 7373 6573  dio_match_passes
-00003f80: 290d 0a20 2020 2040 7472 6565 5f69 7465  )..    @tree_ite
-00003f90: 7261 7465 2822 7061 7373 7661 6c75 6522  rate("passvalue"
-00003fa0: 2c20 312c 2031 3029 0d0a 2020 2020 4074  , 1, 10)..    @t
-00003fb0: 7265 655f 6f70 6572 6174 696f 6e28 5f28  ree_operation(_(
-00003fc0: 2250 6173 7365 7320 7b70 6173 7376 616c  "Passes {passval
-00003fd0: 7565 7d22 292c 206e 6f64 655f 7479 7065  ue}"), node_type
-00003fe0: 3d6f 705f 7061 7265 6e74 5f6e 6f64 6573  =op_parent_nodes
-00003ff0: 2c20 6865 6c70 3d22 2229 0d0a 2020 2020  , help="")..    
-00004000: 6465 6620 7365 745f 6e5f 7061 7373 6573  def set_n_passes
-00004010: 286e 6f64 652c 2070 6173 7376 616c 7565  (node, passvalue
-00004020: 3d31 2c20 2a2a 6b77 6172 6773 293a 0d0a  =1, **kwargs):..
-00004030: 2020 2020 2020 2020 6461 7461 203d 206c          data = l
-00004040: 6973 7428 290d 0a20 2020 2020 2020 2066  ist()..        f
-00004050: 6f72 206e 2069 6e20 6c69 7374 2873 656c  or n in list(sel
-00004060: 662e 6f70 7328 7365 6c65 6374 6564 3d54  f.ops(selected=T
-00004070: 7275 6529 293a 0d0a 2020 2020 2020 2020  rue)):..        
-00004080: 2020 2020 6e2e 7061 7373 6573 203d 2070      n.passes = p
-00004090: 6173 7376 616c 7565 0d0a 2020 2020 2020  assvalue..      
-000040a0: 2020 2020 2020 6e2e 7061 7373 6573 5f63        n.passes_c
-000040b0: 7573 746f 6d20 3d20 7061 7373 7661 6c75  ustom = passvalu
-000040c0: 6520 213d 2031 0d0a 2020 2020 2020 2020  e != 1..        
-000040d0: 2020 2020 6461 7461 2e61 7070 656e 6428      data.append(
-000040e0: 6e29 0d0a 2020 2020 2020 2020 7365 6c66  n)..        self
-000040f0: 2e73 6967 6e61 6c28 2265 6c65 6d65 6e74  .signal("element
-00004100: 5f70 726f 7065 7274 795f 7265 6c6f 6164  _property_reload
-00004110: 222c 2064 6174 6129 0d0a 0d0a 2020 2020  ", data)....    
-00004120: 2320 2d2d 2d2d 2042 7572 6e20 4469 7265  # ---- Burn Dire
-00004130: 6374 696f 6e0d 0a20 2020 2064 6566 2067  ction..    def g
-00004140: 6574 5f64 6972 6563 7469 6f6e 5f76 616c  et_direction_val
-00004150: 7565 7328 293a 0d0a 2020 2020 2020 2020  ues():..        
-00004160: 7265 7475 726e 2028 0d0a 2020 2020 2020  return (..      
-00004170: 2020 2020 2020 2254 6f70 2054 6f20 426f        "Top To Bo
-00004180: 7474 6f6d 222c 0d0a 2020 2020 2020 2020  ttom",..        
-00004190: 2020 2020 2242 6f74 746f 6d20 546f 2054      "Bottom To T
-000041a0: 6f70 222c 0d0a 2020 2020 2020 2020 2020  op",..          
-000041b0: 2020 2252 6967 6874 2054 6f20 4c65 6674    "Right To Left
-000041c0: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
-000041d0: 224c 6566 7420 546f 2052 6967 6874 222c  "Left To Right",
-000041e0: 0d0a 2020 2020 2020 2020 2020 2020 2243  ..            "C
-000041f0: 726f 7373 6861 7463 6822 2c0d 0a20 2020  rosshatch",..   
-00004200: 2020 2020 2029 0d0a 0d0a 2020 2020 6465       )....    de
-00004210: 6620 7261 6469 6f5f 6d61 7463 685f 6469  f radio_match_di
-00004220: 7265 6374 696f 6e28 6e6f 6465 2c20 7261  rection(node, ra
-00004230: 7374 6572 5f64 6972 6563 7469 6f6e 3d22  ster_direction="
-00004240: 222c 202a 2a6b 7761 7267 7329 3a0d 0a20  ", **kwargs):.. 
-00004250: 2020 2020 2020 2076 616c 7565 7320 3d20         values = 
-00004260: 6765 745f 6469 7265 6374 696f 6e5f 7661  get_direction_va
-00004270: 6c75 6573 2829 0d0a 2020 2020 2020 2020  lues()..        
-00004280: 666f 7220 6964 782c 206b 6579 2069 6e20  for idx, key in 
-00004290: 656e 756d 6572 6174 6528 7661 6c75 6573  enumerate(values
-000042a0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-000042b0: 6966 206b 6579 203d 3d20 7261 7374 6572  if key == raster
-000042c0: 5f64 6972 6563 7469 6f6e 3a0d 0a20 2020  _direction:..   
-000042d0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-000042e0: 7572 6e20 6e6f 6465 2e72 6173 7465 725f  urn node.raster_
-000042f0: 6469 7265 6374 696f 6e20 3d3d 2069 6478  direction == idx
-00004300: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00004310: 2046 616c 7365 0d0a 0d0a 2020 2020 4074   False....    @t
-00004320: 7265 655f 7375 626d 656e 7528 5f28 2242  ree_submenu(_("B
-00004330: 7572 6e20 4469 7265 6374 696f 6e22 2929  urn Direction"))
-00004340: 0d0a 2020 2020 4074 7265 655f 7261 6469  ..    @tree_radi
-00004350: 6f28 7261 6469 6f5f 6d61 7463 685f 6469  o(radio_match_di
-00004360: 7265 6374 696f 6e29 0d0a 2020 2020 4074  rection)..    @t
-00004370: 7265 655f 7661 6c75 6573 2822 7261 7374  ree_values("rast
-00004380: 6572 5f64 6972 6563 7469 6f6e 222c 2076  er_direction", v
-00004390: 616c 7565 733d 6765 745f 6469 7265 6374  alues=get_direct
-000043a0: 696f 6e5f 7661 6c75 6573 2829 290d 0a20  ion_values()).. 
-000043b0: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
-000043c0: 6f6e 280d 0a20 2020 2020 2020 2022 7b72  on(..        "{r
-000043d0: 6173 7465 725f 6469 7265 6374 696f 6e7d  aster_direction}
-000043e0: 222c 0d0a 2020 2020 2020 2020 6e6f 6465  ",..        node
-000043f0: 5f74 7970 653d 2822 6f70 2072 6173 7465  _type=("op raste
-00004400: 7222 2c20 226f 7020 696d 6167 6522 292c  r", "op image"),
-00004410: 0d0a 2020 2020 2020 2020 6865 6c70 3d22  ..        help="
-00004420: 222c 0d0a 2020 2020 290d 0a20 2020 2064  ",..    )..    d
-00004430: 6566 2073 6574 5f64 6972 6563 7469 6f6e  ef set_direction
-00004440: 286e 6f64 652c 2072 6173 7465 725f 6469  (node, raster_di
-00004450: 7265 6374 696f 6e3d 2222 2c20 2a2a 6b77  rection="", **kw
-00004460: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
-00004470: 7661 6c75 6573 203d 2067 6574 5f64 6972  values = get_dir
-00004480: 6563 7469 6f6e 5f76 616c 7565 7328 290d  ection_values().
-00004490: 0a20 2020 2020 2020 2066 6f72 2069 6478  .        for idx
-000044a0: 2c20 6b65 7920 696e 2065 6e75 6d65 7261  , key in enumera
-000044b0: 7465 2876 616c 7565 7329 3a0d 0a20 2020  te(values):..   
-000044c0: 2020 2020 2020 2020 2069 6620 6b65 7920           if key 
-000044d0: 3d3d 2072 6173 7465 725f 6469 7265 6374  == raster_direct
-000044e0: 696f 6e3a 0d0a 2020 2020 2020 2020 2020  ion:..          
-000044f0: 2020 2020 2020 6461 7461 203d 206c 6973        data = lis
-00004500: 7428 290d 0a20 2020 2020 2020 2020 2020  t()..           
-00004510: 2020 2020 2066 6f72 206e 2069 6e20 6c69       for n in li
-00004520: 7374 2873 656c 662e 6f70 7328 7365 6c65  st(self.ops(sele
-00004530: 6374 6564 3d54 7275 6529 293a 0d0a 2020  cted=True)):..  
-00004540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004550: 2020 6966 206e 2e74 7970 6520 6e6f 7420    if n.type not 
-00004560: 696e 2028 226f 7020 7261 7374 6572 222c  in ("op raster",
-00004570: 2022 6f70 2069 6d61 6765 2229 3a0d 0a20   "op image"):.. 
-00004580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004590: 2020 2020 2020 2063 6f6e 7469 6e75 650d         continue.
-000045a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000045b0: 2020 2020 206e 2e72 6173 7465 725f 6469       n.raster_di
-000045c0: 7265 6374 696f 6e20 3d20 6964 780d 0a20  rection = idx.. 
-000045d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000045e0: 2020 2064 6174 612e 6170 7065 6e64 286e     data.append(n
-000045f0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00004600: 2020 2073 656c 662e 7369 676e 616c 2822     self.signal("
-00004610: 656c 656d 656e 745f 7072 6f70 6572 7479  element_property
-00004620: 5f72 656c 6f61 6422 2c20 6461 7461 290d  _reload", data).
-00004630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004640: 2062 7265 616b 0d0a 0d0a 2020 2020 6465   break....    de
-00004650: 6620 6765 745f 7377 696e 675f 7661 6c75  f get_swing_valu
-00004660: 6573 2829 3a0d 0a20 2020 2020 2020 2072  es():..        r
-00004670: 6574 7572 6e20 280d 0a20 2020 2020 2020  eturn (..       
-00004680: 2020 2020 205f 2822 556e 6964 6972 6563       _("Unidirec
-00004690: 7469 6f6e 616c 2229 2c0d 0a20 2020 2020  tional"),..     
-000046a0: 2020 2020 2020 205f 2822 4269 6469 7265         _("Bidire
-000046b0: 6374 696f 6e61 6c22 292c 0d0a 2020 2020  ctional"),..    
-000046c0: 2020 2020 290d 0a0d 0a20 2020 2064 6566      )....    def
-000046d0: 2072 6164 696f 5f6d 6174 6368 5f73 7769   radio_match_swi
-000046e0: 6e67 286e 6f64 652c 2072 6173 7465 725f  ng(node, raster_
-000046f0: 7377 696e 673d 2222 2c20 2a2a 6b77 6172  swing="", **kwar
-00004700: 6773 293a 0d0a 2020 2020 2020 2020 7661  gs):..        va
-00004710: 6c75 6573 203d 2067 6574 5f73 7769 6e67  lues = get_swing
-00004720: 5f76 616c 7565 7328 290d 0a20 2020 2020  _values()..     
-00004730: 2020 2066 6f72 2069 6478 2c20 6b65 7920     for idx, key 
-00004740: 696e 2065 6e75 6d65 7261 7465 2876 616c  in enumerate(val
-00004750: 7565 7329 3a0d 0a20 2020 2020 2020 2020  ues):..         
-00004760: 2020 2069 6620 6b65 7920 3d3d 2072 6173     if key == ras
-00004770: 7465 725f 7377 696e 673a 0d0a 2020 2020  ter_swing:..    
-00004780: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00004790: 726e 206e 6f64 652e 6269 6469 7265 6374  rn node.bidirect
-000047a0: 696f 6e61 6c20 3d3d 2069 6478 0d0a 2020  ional == idx..  
-000047b0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-000047c0: 7365 0d0a 0d0a 2020 2020 4074 7265 655f  se....    @tree_
-000047d0: 7375 626d 656e 7528 5f28 2244 6972 6563  submenu(_("Direc
-000047e0: 7469 6f6e 616c 2052 6173 7465 7222 2929  tional Raster"))
-000047f0: 0d0a 2020 2020 4074 7265 655f 7261 6469  ..    @tree_radi
-00004800: 6f28 7261 6469 6f5f 6d61 7463 685f 7377  o(radio_match_sw
-00004810: 696e 6729 0d0a 2020 2020 4074 7265 655f  ing)..    @tree_
-00004820: 7661 6c75 6573 2822 7261 7374 6572 5f73  values("raster_s
-00004830: 7769 6e67 222c 2076 616c 7565 733d 6765  wing", values=ge
-00004840: 745f 7377 696e 675f 7661 6c75 6573 2829  t_swing_values()
-00004850: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
-00004860: 7261 7469 6f6e 280d 0a20 2020 2020 2020  ration(..       
-00004870: 2022 7b72 6173 7465 725f 7377 696e 677d   "{raster_swing}
-00004880: 222c 0d0a 2020 2020 2020 2020 6e6f 6465  ",..        node
-00004890: 5f74 7970 653d 2822 6f70 2072 6173 7465  _type=("op raste
-000048a0: 7222 2c20 226f 7020 696d 6167 6522 292c  r", "op image"),
-000048b0: 0d0a 2020 2020 2020 2020 6865 6c70 3d22  ..        help="
-000048c0: 222c 0d0a 2020 2020 290d 0a20 2020 2064  ",..    )..    d
-000048d0: 6566 2073 6574 5f73 7769 6e67 286e 6f64  ef set_swing(nod
-000048e0: 652c 2072 6173 7465 725f 7377 696e 673d  e, raster_swing=
-000048f0: 2222 2c20 2a2a 6b77 6172 6773 293a 0d0a  "", **kwargs):..
-00004900: 2020 2020 2020 2020 7661 6c75 6573 203d          values =
-00004910: 2067 6574 5f73 7769 6e67 5f76 616c 7565   get_swing_value
-00004920: 7328 290d 0a20 2020 2020 2020 2066 6f72  s()..        for
-00004930: 2069 6478 2c20 6b65 7920 696e 2065 6e75   idx, key in enu
-00004940: 6d65 7261 7465 2876 616c 7565 7329 3a0d  merate(values):.
-00004950: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00004960: 6b65 7920 3d3d 2072 6173 7465 725f 7377  key == raster_sw
-00004970: 696e 673a 0d0a 2020 2020 2020 2020 2020  ing:..          
-00004980: 2020 2020 2020 6461 7461 203d 206c 6973        data = lis
-00004990: 7428 290d 0a20 2020 2020 2020 2020 2020  t()..           
-000049a0: 2020 2020 2066 6f72 206e 2069 6e20 6c69       for n in li
-000049b0: 7374 2873 656c 662e 6f70 7328 7365 6c65  st(self.ops(sele
-000049c0: 6374 6564 3d54 7275 6529 293a 0d0a 2020  cted=True)):..  
-000049d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000049e0: 2020 6966 206e 2e74 7970 6520 6e6f 7420    if n.type not 
-000049f0: 696e 2028 226f 7020 7261 7374 6572 222c  in ("op raster",
-00004a00: 2022 6f70 2069 6d61 6765 2229 3a0d 0a20   "op image"):.. 
-00004a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004a20: 2020 2020 2020 2063 6f6e 7469 6e75 650d         continue.
-00004a30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004a40: 2020 2020 206e 2e62 6964 6972 6563 7469       n.bidirecti
-00004a50: 6f6e 616c 203d 2062 6f6f 6c28 6964 7829  onal = bool(idx)
-00004a60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00004a70: 2020 2020 2020 6461 7461 2e61 7070 656e        data.appen
-00004a80: 6428 6e29 0d0a 2020 2020 2020 2020 2020  d(n)..          
-00004a90: 2020 2020 2020 7365 6c66 2e73 6967 6e61        self.signa
-00004aa0: 6c28 2265 6c65 6d65 6e74 5f70 726f 7065  l("element_prope
-00004ab0: 7274 795f 7265 6c6f 6164 222c 2064 6174  rty_reload", dat
-00004ac0: 6129 0d0a 2020 2020 2020 2020 2020 2020  a)..            
-00004ad0: 2020 2020 6272 6561 6b0d 0a0d 0a20 2020      break....   
-00004ae0: 2040 7472 6565 5f73 6570 6172 6174 6f72   @tree_separator
-00004af0: 5f62 6566 6f72 6528 290d 0a20 2020 2040  _before()..    @
-00004b00: 7472 6565 5f6f 7065 7261 7469 6f6e 280d  tree_operation(.
-00004b10: 0a20 2020 2020 2020 205f 2822 4578 6563  .        _("Exec
-00004b20: 7574 6520 6f70 6572 6174 696f 6e28 7329  ute operation(s)
-00004b30: 2229 2c0d 0a20 2020 2020 2020 206e 6f64  "),..        nod
-00004b40: 655f 7479 7065 3d6f 705f 6e6f 6465 732c  e_type=op_nodes,
-00004b50: 0d0a 2020 2020 2020 2020 6865 6c70 3d5f  ..        help=_
-00004b60: 2822 4578 6563 7574 6520 4a6f 6220 666f  ("Execute Job fo
-00004b70: 7220 7468 6520 7365 6c65 6374 6564 206f  r the selected o
-00004b80: 7065 7261 7469 6f6e 2873 292e 2229 2c0d  peration(s)."),.
-00004b90: 0a20 2020 2029 0d0a 2020 2020 6465 6620  .    )..    def 
-00004ba0: 6578 6563 7574 655f 6a6f 6228 6e6f 6465  execute_job(node
-00004bb0: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-00004bc0: 2020 2020 2020 7365 6c66 2e73 6574 5f6e        self.set_n
-00004bd0: 6f64 655f 656d 7068 6173 6973 286e 6f64  ode_emphasis(nod
-00004be0: 652c 2054 7275 6529 0d0a 2020 2020 2020  e, True)..      
-00004bf0: 2020 7365 6c66 2822 706c 616e 3020 636c    self("plan0 cl
-00004c00: 6561 7220 636f 7079 2d73 656c 6563 7465  ear copy-selecte
-00004c10: 645c 6e22 290d 0a20 2020 2020 2020 2073  d\n")..        s
-00004c20: 656c 6628 2277 696e 646f 7720 6f70 656e  elf("window open
-00004c30: 2045 7865 6375 7465 4a6f 6220 305c 6e22   ExecuteJob 0\n"
-00004c40: 290d 0a0d 0a20 2020 2040 7472 6565 5f73  )....    @tree_s
-00004c50: 6570 6172 6174 6f72 5f61 6674 6572 2829  eparator_after()
-00004c60: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
-00004c70: 6174 696f 6e28 0d0a 2020 2020 2020 2020  ation(..        
-00004c80: 5f28 2253 696d 756c 6174 6520 6f70 6572  _("Simulate oper
-00004c90: 6174 696f 6e28 7329 2229 2c0d 0a20 2020  ation(s)"),..   
-00004ca0: 2020 2020 206e 6f64 655f 7479 7065 3d6f       node_type=o
-00004cb0: 705f 6e6f 6465 732c 0d0a 2020 2020 2020  p_nodes,..      
-00004cc0: 2020 6865 6c70 3d5f 2822 5275 6e20 7369    help=_("Run si
-00004cd0: 6d75 6c61 7469 6f6e 2066 6f72 2074 6865  mulation for the
-00004ce0: 2073 656c 6563 7465 6420 6f70 6572 6174   selected operat
-00004cf0: 696f 6e28 7329 2229 2c0d 0a20 2020 2029  ion(s)"),..    )
-00004d00: 0d0a 2020 2020 6465 6620 636f 6d70 696c  ..    def compil
-00004d10: 655f 616e 645f 7369 6d75 6c61 7465 286e  e_and_simulate(n
-00004d20: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
-00004d30: 0a20 2020 2020 2020 2073 656c 662e 7365  .        self.se
-00004d40: 745f 6e6f 6465 5f65 6d70 6861 7369 7328  t_node_emphasis(
-00004d50: 6e6f 6465 2c20 5472 7565 290d 0a20 2020  node, True)..   
-00004d60: 2020 2020 2073 656c 6628 2270 6c61 6e30       self("plan0
-00004d70: 2063 6f70 792d 7365 6c65 6374 6564 2070   copy-selected p
-00004d80: 7265 7072 6f63 6573 7320 7661 6c69 6461  reprocess valida
-00004d90: 7465 2062 6c6f 6220 7072 656f 7074 206f  te blob preopt o
-00004da0: 7074 696d 697a 655c 6e22 290d 0a20 2020  ptimize\n")..   
-00004db0: 2020 2020 2073 656c 6628 2277 696e 646f       self("windo
-00004dc0: 7720 6f70 656e 2053 696d 756c 6174 696f  w open Simulatio
-00004dd0: 6e20 305c 6e22 290d 0a0d 0a20 2020 2040  n 0\n")....    @
-00004de0: 7472 6565 5f6f 7065 7261 7469 6f6e 285f  tree_operation(_
-00004df0: 2822 476c 6f62 616c 2053 6574 7469 6e67  ("Global Setting
-00004e00: 7322 292c 206e 6f64 655f 7479 7065 3d22  s"), node_type="
-00004e10: 6272 616e 6368 206f 7073 222c 2068 656c  branch ops", hel
-00004e20: 703d 2222 290d 0a20 2020 2064 6566 206f  p="")..    def o
-00004e30: 705f 7072 6f70 286e 6f64 652c 202a 2a6b  p_prop(node, **k
-00004e40: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
-00004e50: 2061 6374 6976 6174 6520 3d20 7365 6c66   activate = self
-00004e60: 2e6b 6572 6e65 6c2e 6c6f 6f6b 7570 2822  .kernel.lookup("
-00004e70: 6675 6e63 7469 6f6e 2f6f 7065 6e5f 7072  function/open_pr
-00004e80: 6f70 6572 7479 5f77 696e 646f 775f 666f  operty_window_fo
-00004e90: 725f 6e6f 6465 2229 0d0a 2020 2020 2020  r_node")..      
-00004ea0: 2020 6966 2061 6374 6976 6174 6520 6973    if activate is
-00004eb0: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
-00004ec0: 2020 2020 2020 2020 6163 7469 7661 7465          activate
-00004ed0: 286e 6f64 6529 0d0a 0d0a 2020 2020 4074  (node)....    @t
-00004ee0: 7265 655f 6f70 6572 6174 696f 6e28 5f28  ree_operation(_(
-00004ef0: 2243 6c65 6172 2061 6c6c 2229 2c20 6e6f  "Clear all"), no
-00004f00: 6465 5f74 7970 653d 2262 7261 6e63 6820  de_type="branch 
-00004f10: 6f70 7322 2c20 6865 6c70 3d22 2229 0d0a  ops", help="")..
-00004f20: 2020 2020 6465 6620 636c 6561 725f 616c      def clear_al
-00004f30: 6c28 6e6f 6465 2c20 2a2a 6b77 6172 6773  l(node, **kwargs
-00004f40: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
-00004f50: 2822 6f70 6572 6174 696f 6e2a 2064 656c  ("operation* del
-00004f60: 6574 655c 6e22 290d 0a0d 0a20 2020 2040  ete\n")....    @
-00004f70: 7472 6565 5f6f 7065 7261 7469 6f6e 280d  tree_operation(.
-00004f80: 0a20 2020 2020 2020 205f 2822 436c 6561  .        _("Clea
-00004f90: 7220 756e 7573 6564 2229 2c0d 0a20 2020  r unused"),..   
-00004fa0: 2020 2020 206e 6f64 655f 7479 7065 3d22       node_type="
-00004fb0: 6272 616e 6368 206f 7073 222c 0d0a 2020  branch ops",..  
-00004fc0: 2020 2020 2020 6865 6c70 3d5f 2822 436c        help=_("Cl
-00004fd0: 6561 7220 6f70 6572 6174 696f 6e73 2077  ear operations w
-00004fe0: 6974 686f 7574 2063 6869 6c64 7265 6e22  ithout children"
-00004ff0: 292c 0d0a 2020 2020 290d 0a20 2020 2064  ),..    )..    d
-00005000: 6566 2063 6c65 6172 5f75 6e75 7365 6428  ef clear_unused(
-00005010: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
-00005020: 0d0a 2020 2020 2020 2020 746f 5f64 656c  ..        to_del
-00005030: 6574 6520 3d20 5b5d 0d0a 2020 2020 2020  ete = []..      
-00005040: 2020 666f 7220 6f70 2069 6e20 7365 6c66    for op in self
-00005050: 2e6f 7073 2829 3a0d 0a20 2020 2020 2020  .ops():..       
-00005060: 2020 2020 2023 2070 7269 6e74 2028 6622       # print (f"
-00005070: 7b6f 702e 7479 7065 7d2c 2072 6566 733d  {op.type}, refs=
-00005080: 7b6c 656e 286f 702e 5f72 6566 6572 656e  {len(op._referen
-00005090: 6365 7329 7d2c 2063 6869 6c64 7265 6e3d  ces)}, children=
-000050a0: 7b6c 656e 286f 702e 5f63 6869 6c64 7265  {len(op._childre
-000050b0: 6e29 7d22 290d 0a20 2020 2020 2020 2020  n)}")..         
-000050c0: 2020 2069 6620 6c65 6e28 6f70 2e5f 6368     if len(op._ch
-000050d0: 696c 6472 656e 2920 3d3d 2030 2061 6e64  ildren) == 0 and
-000050e0: 206e 6f74 206f 702e 7479 7065 203d 3d20   not op.type == 
-000050f0: 2262 6c6f 6222 3a0d 0a20 2020 2020 2020  "blob":..       
-00005100: 2020 2020 2020 2020 2074 6f5f 6465 6c65           to_dele
-00005110: 7465 2e61 7070 656e 6428 6f70 290d 0a20  te.append(op).. 
-00005120: 2020 2020 2020 2069 6620 6c65 6e28 746f         if len(to
-00005130: 5f64 656c 6574 6529 203e 2030 3a0d 0a20  _delete) > 0:.. 
-00005140: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-00005150: 7365 6c66 2e73 7461 7469 6328 2263 6c65  self.static("cle
-00005160: 6172 5f75 6e75 7365 6422 293a 0d0a 2020  ar_unused"):..  
-00005170: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00005180: 6c66 2e72 656d 6f76 655f 6f70 6572 6174  lf.remove_operat
-00005190: 696f 6e73 2874 6f5f 6465 6c65 7465 290d  ions(to_delete).
-000051a0: 0a0d 0a20 2020 2040 7472 6565 5f6f 7065  ...    @tree_ope
-000051b0: 7261 7469 6f6e 285f 2822 436c 6561 7220  ration(_("Clear 
-000051c0: 616c 6c22 292c 206e 6f64 655f 7479 7065  all"), node_type
-000051d0: 3d22 6272 616e 6368 2065 6c65 6d73 222c  ="branch elems",
-000051e0: 2068 656c 703d 2222 290d 0a20 2020 2064   help="")..    d
-000051f0: 6566 2063 6c65 6172 5f61 6c6c 5f65 6c65  ef clear_all_ele
-00005200: 6d73 286e 6f64 652c 202a 2a6b 7761 7267  ms(node, **kwarg
-00005210: 7329 3a0d 0a20 2020 2020 2020 2023 2073  s):..        # s
-00005220: 656c 6628 2265 6c65 6d65 6e74 2a20 6465  elf("element* de
-00005230: 6c65 7465 5c6e 2229 0d0a 2020 2020 2020  lete\n")..      
-00005240: 2020 7769 7468 2073 656c 662e 7374 6174    with self.stat
-00005250: 6963 2822 636c 6561 725f 656c 656d 7322  ic("clear_elems"
-00005260: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00005270: 7365 6c66 2e65 6c65 6d5f 6272 616e 6368  self.elem_branch
-00005280: 2e72 656d 6f76 655f 616c 6c5f 6368 696c  .remove_all_chil
-00005290: 6472 656e 2829 0d0a 0d0a 2020 2020 4074  dren()....    @t
-000052a0: 7265 655f 6f70 6572 6174 696f 6e28 5f28  ree_operation(_(
-000052b0: 2243 6c65 6172 2061 6c6c 2229 2c20 6e6f  "Clear all"), no
-000052c0: 6465 5f74 7970 653d 2262 7261 6e63 6820  de_type="branch 
-000052d0: 7265 6722 2c20 6865 6c70 3d22 2229 0d0a  reg", help="")..
-000052e0: 2020 2020 6465 6620 636c 6561 725f 616c      def clear_al
-000052f0: 6c5f 7265 676d 6172 6b73 286e 6f64 652c  l_regmarks(node,
-00005300: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
-00005310: 2020 2020 2077 6974 6820 7365 6c66 2e73       with self.s
-00005320: 7461 7469 6328 2263 6c65 6172 5f72 6567  tatic("clear_reg
-00005330: 6d61 726b 7322 293a 0d0a 2020 2020 2020  marks"):..      
-00005340: 2020 2020 2020 7365 6c66 2e72 6567 5f62        self.reg_b
-00005350: 7261 6e63 682e 7265 6d6f 7665 5f61 6c6c  ranch.remove_all
-00005360: 5f63 6869 6c64 7265 6e28 290d 0a0d 0a20  _children().... 
-00005370: 2020 2023 203d 3d3d 3d3d 3d3d 3d3d 3d0d     # ==========.
-00005380: 0a20 2020 2023 2052 454d 4f56 4520 4d55  .    # REMOVE MU
-00005390: 4c54 4920 2854 7265 6520 5365 6c65 6374  LTI (Tree Select
-000053a0: 6564 290d 0a20 2020 2023 203d 3d3d 3d3d  ed)..    # =====
-000053b0: 3d3d 3d3d 3d0d 0a20 2020 2023 2043 616c  =====..    # Cal
-000053c0: 6375 6c61 7465 2074 6865 2061 6d6f 756e  culate the amoun
-000053d0: 7420 6f66 2073 656c 6563 7465 6420 6e6f  t of selected no
-000053e0: 6465 7320 696e 2074 6865 2074 7265 653a  des in the tree:
-000053f0: 0d0a 2020 2020 2320 4966 2074 6865 7265  ..    # If there
-00005400: 2061 7265 206f 7073 2073 656c 6563 7465   are ops selecte
-00005410: 6420 7468 656e 2074 6865 7920 7461 6b65  d then they take
-00005420: 2070 7265 6365 6465 6e63 650d 0a20 2020   precedence..   
-00005430: 2023 2061 6e64 2077 696c 6c20 6f6e 6c79   # and will only
-00005440: 2062 6520 636f 756e 7465 640d 0a0d 0a20   be counted.... 
-00005450: 2020 2040 7472 6565 5f63 6f6e 6469 7469     @tree_conditi
-00005460: 6f6e 616c 280d 0a20 2020 2020 2020 206c  onal(..        l
-00005470: 616d 6264 6120 636f 6e64 3a20 6c65 6e28  ambda cond: len(
-00005480: 0d0a 2020 2020 2020 2020 2020 2020 6c69  ..            li
-00005490: 7374 2873 656c 662e 666c 6174 2873 656c  st(self.flat(sel
-000054a0: 6563 7465 643d 5472 7565 2c20 6361 7363  ected=True, casc
-000054b0: 6164 653d 4661 6c73 652c 2074 7970 6573  ade=False, types
-000054c0: 3d22 7265 6665 7265 6e63 6522 2929 0d0a  ="reference"))..
-000054d0: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-000054e0: 2020 203e 3d20 310d 0a20 2020 2029 0d0a     >= 1..    )..
-000054f0: 2020 2020 4074 7265 655f 6361 6c63 280d      @tree_calc(.
-00005500: 0a20 2020 2020 2020 2022 6563 6f75 6e74  .        "ecount
-00005510: 222c 0d0a 2020 2020 2020 2020 6c61 6d62  ",..        lamb
-00005520: 6461 2069 3a20 6c65 6e28 6c69 7374 2873  da i: len(list(s
-00005530: 656c 662e 666c 6174 2873 656c 6563 7465  elf.flat(selecte
-00005540: 643d 5472 7565 2c20 6361 7363 6164 653d  d=True, cascade=
-00005550: 4661 6c73 652c 2074 7970 6573 3d22 7265  False, types="re
-00005560: 6665 7265 6e63 6522 2929 292c 0d0a 2020  ference"))),..  
-00005570: 2020 290d 0a20 2020 2040 7472 6565 5f6f    )..    @tree_o
-00005580: 7065 7261 7469 6f6e 280d 0a20 2020 2020  peration(..     
-00005590: 2020 205f 2822 5265 6d6f 7665 207b 6563     _("Remove {ec
-000055a0: 6f75 6e74 7d20 7365 6c65 6374 6564 2069  ount} selected i
-000055b0: 7465 6d73 2066 726f 6d20 6f70 6572 6174  tems from operat
-000055c0: 696f 6e73 2229 2c0d 0a20 2020 2020 2020  ions"),..       
-000055d0: 206e 6f64 655f 7479 7065 3d22 7265 6665   node_type="refe
-000055e0: 7265 6e63 6522 2c0d 0a20 2020 2020 2020  rence",..       
-000055f0: 2068 656c 703d 2222 2c0d 0a20 2020 2029   help="",..    )
-00005600: 0d0a 2020 2020 6465 6620 7265 6d6f 7665  ..    def remove
-00005610: 5f6d 756c 7469 5f72 6566 6572 656e 6365  _multi_reference
-00005620: 7328 6e6f 6465 2c20 2a2a 6b77 6172 6773  s(node, **kwargs
-00005630: 293a 0d0a 2020 2020 2020 2020 6e6f 6465  ):..        node
-00005640: 7320 3d20 6c69 7374 2873 656c 662e 666c  s = list(self.fl
-00005650: 6174 2873 656c 6563 7465 643d 5472 7565  at(selected=True
-00005660: 2c20 6361 7363 6164 653d 4661 6c73 652c  , cascade=False,
-00005670: 2074 7970 6573 3d22 7265 6665 7265 6e63   types="referenc
-00005680: 6522 2929 0d0a 2020 2020 2020 2020 666f  e"))..        fo
-00005690: 7220 6e6f 6465 2069 6e20 6e6f 6465 733a  r node in nodes:
-000056a0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-000056b0: 206e 6f64 652e 7061 7265 6e74 2069 7320   node.parent is 
-000056c0: 6e6f 7420 4e6f 6e65 3a20 2023 204d 6179  not None:  # May
-000056d0: 2068 6176 6520 616c 7265 6164 7920 7265   have already re
-000056e0: 6d6f 7665 642e 0d0a 2020 2020 2020 2020  moved...        
-000056f0: 2020 2020 2020 2020 6e6f 6465 2e72 656d          node.rem
-00005700: 6f76 655f 6e6f 6465 2829 0d0a 2020 2020  ove_node()..    
-00005710: 2020 2020 7365 6c66 2e73 6574 5f65 6d70      self.set_emp
-00005720: 6861 7369 7328 4e6f 6e65 290d 0a20 2020  hasis(None)..   
-00005730: 2020 2020 2073 656c 662e 7369 676e 616c       self.signal
-00005740: 2822 7265 6672 6573 685f 7472 6565 2229  ("refresh_tree")
-00005750: 0d0a 0d0a 2020 2020 2320 4074 7265 655f  ....    # @tree_
-00005760: 636f 6e64 6974 696f 6e61 6c28 0d0a 2020  conditional(..  
-00005770: 2020 2320 2020 2020 6c61 6d62 6461 2063    #     lambda c
-00005780: 6f6e 643a 206c 656e 280d 0a20 2020 2023  ond: len(..    #
-00005790: 2020 2020 2020 2020 206c 6973 7428 7365           list(se
-000057a0: 6c66 2e66 6c61 7428 7365 6c65 6374 6564  lf.flat(selected
-000057b0: 3d54 7275 652c 2063 6173 6361 6465 3d46  =True, cascade=F
-000057c0: 616c 7365 2c20 7479 7065 733d 6f70 6572  alse, types=oper
-000057d0: 6174 655f 6e6f 6465 7329 290d 0a20 2020  ate_nodes))..   
-000057e0: 2023 2020 2020 2029 0d0a 2020 2020 2320   #     )..    # 
-000057f0: 2020 2020 6966 206c 656e 286c 6973 7428      if len(list(
-00005800: 7365 6c66 2e66 6c61 7428 7365 6c65 6374  self.flat(select
-00005810: 6564 3d54 7275 652c 2063 6173 6361 6465  ed=True, cascade
-00005820: 3d46 616c 7365 2c20 7479 7065 733d 6f70  =False, types=op
-00005830: 6572 6174 655f 6e6f 6465 7329 2929 0d0a  erate_nodes)))..
-00005840: 2020 2020 2320 2020 2020 3e20 300d 0a20      #     > 0.. 
-00005850: 2020 2023 2020 2020 2065 6c73 6520 6c65     #     else le
-00005860: 6e28 0d0a 2020 2020 2320 2020 2020 2020  n(..    #       
-00005870: 2020 6c69 7374 2873 656c 662e 666c 6174    list(self.flat
-00005880: 2873 656c 6563 7465 643d 5472 7565 2c20  (selected=True, 
-00005890: 6361 7363 6164 653d 4661 6c73 652c 2074  cascade=False, t
-000058a0: 7970 6573 3d65 6c65 6d5f 6772 6f75 705f  ypes=elem_group_
-000058b0: 6e6f 6465 7329 290d 0a20 2020 2023 2020  nodes))..    #  
-000058c0: 2020 2029 0d0a 2020 2020 2320 2020 2020     )..    #     
-000058d0: 3e20 310d 0a20 2020 2023 2029 0d0a 2020  > 1..    # )..  
-000058e0: 2020 2320 4074 7265 655f 6361 6c63 280d    # @tree_calc(.
-000058f0: 0a20 2020 2023 2020 2020 2022 6563 6f75  .    #     "ecou
-00005900: 6e74 222c 0d0a 2020 2020 2320 2020 2020  nt",..    #     
-00005910: 6c61 6d62 6461 2069 3a20 6c65 6e28 0d0a  lambda i: len(..
-00005920: 2020 2020 2320 2020 2020 2020 2020 6c69      #         li
-00005930: 7374 2873 656c 662e 666c 6174 2873 656c  st(self.flat(sel
-00005940: 6563 7465 643d 5472 7565 2c20 6361 7363  ected=True, casc
-00005950: 6164 653d 4661 6c73 652c 2074 7970 6573  ade=False, types
-00005960: 3d6f 7065 7261 7465 5f6e 6f64 6573 2929  =operate_nodes))
-00005970: 0d0a 2020 2020 2320 2020 2020 290d 0a20  ..    #     ).. 
-00005980: 2020 2023 2020 2020 2069 6620 6c65 6e28     #     if len(
-00005990: 6c69 7374 2873 656c 662e 666c 6174 2873  list(self.flat(s
-000059a0: 656c 6563 7465 643d 5472 7565 2c20 6361  elected=True, ca
-000059b0: 7363 6164 653d 4661 6c73 652c 2074 7970  scade=False, typ
-000059c0: 6573 3d6f 7065 7261 7465 5f6e 6f64 6573  es=operate_nodes
-000059d0: 2929 290d 0a20 2020 2023 2020 2020 203e  )))..    #     >
-000059e0: 2030 0d0a 2020 2020 2320 2020 2020 656c   0..    #     el
-000059f0: 7365 206c 656e 280d 0a20 2020 2023 2020  se len(..    #  
-00005a00: 2020 2020 2020 206c 6973 7428 7365 6c66         list(self
-00005a10: 2e66 6c61 7428 7365 6c65 6374 6564 3d54  .flat(selected=T
-00005a20: 7275 652c 2063 6173 6361 6465 3d46 616c  rue, cascade=Fal
-00005a30: 7365 2c20 7479 7065 733d 656c 656d 5f67  se, types=elem_g
-00005a40: 726f 7570 5f6e 6f64 6573 2929 0d0a 2020  roup_nodes))..  
-00005a50: 2020 2320 2020 2020 292c 0d0a 2020 2020    #     ),..    
-00005a60: 2320 290d 0a20 2020 2023 2040 7472 6565  # )..    # @tree
-00005a70: 5f63 616c 6328 0d0a 2020 2020 2320 2020  _calc(..    #   
-00005a80: 2020 2272 636f 756e 7422 2c0d 0a20 2020    "rcount",..   
-00005a90: 2023 2020 2020 206c 616d 6264 6120 693a   #     lambda i:
-00005aa0: 206c 656e 280d 0a20 2020 2023 2020 2020   len(..    #    
-00005ab0: 2020 2020 206c 6973 7428 7365 6c66 2e66       list(self.f
-00005ac0: 6c61 7428 7365 6c65 6374 6564 3d54 7275  lat(selected=Tru
-00005ad0: 652c 2063 6173 6361 6465 3d46 616c 7365  e, cascade=False
-00005ae0: 2c20 7479 7065 733d 2822 7265 6665 7265  , types=("refere
-00005af0: 6e63 6522 2929 290d 0a20 2020 2023 2020  nce")))..    #  
-00005b00: 2020 2029 2c0d 0a20 2020 2023 2029 0d0a     ),..    # )..
-00005b10: 2020 2020 2320 4074 7265 655f 6361 6c63      # @tree_calc
-00005b20: 280d 0a20 2020 2023 2020 2020 2022 656c  (..    #     "el
-00005b30: 6f63 222c 0d0a 2020 2020 2320 2020 2020  oc",..    #     
-00005b40: 6c61 6d62 6461 2073 3a20 226f 7065 7261  lambda s: "opera
-00005b50: 7469 6f6e 7322 0d0a 2020 2020 2320 2020  tions"..    #   
-00005b60: 2020 6966 206c 656e 286c 6973 7428 7365    if len(list(se
-00005b70: 6c66 2e66 6c61 7428 7365 6c65 6374 6564  lf.flat(selected
-00005b80: 3d54 7275 652c 2063 6173 6361 6465 3d46  =True, cascade=F
-00005b90: 616c 7365 2c20 7479 7065 733d 6f70 6572  alse, types=oper
-00005ba0: 6174 655f 6e6f 6465 7329 2929 0d0a 2020  ate_nodes)))..  
-00005bb0: 2020 2320 2020 2020 3e20 300d 0a20 2020    #     > 0..   
-00005bc0: 2023 2020 2020 2065 6c73 6520 2265 6c65   #     else "ele
-00005bd0: 6d65 6e74 2d6c 6973 7422 2c0d 0a20 2020  ment-list",..   
-00005be0: 2023 2029 0d0a 2020 2020 2320 4074 7265   # )..    # @tre
-00005bf0: 655f 6f70 6572 6174 696f 6e28 0d0a 2020  e_operation(..  
-00005c00: 2020 2320 2020 2020 5f28 2244 656c 6574    #     _("Delet
-00005c10: 6520 2573 2073 656c 6563 7465 6420 6974  e %s selected it
-00005c20: 656d 7320 6672 6f6d 2025 7320 2852 6566  ems from %s (Ref
-00005c30: 3d25 7329 2229 2025 2028 227b 6563 6f75  =%s)") % ("{ecou
-00005c40: 6e74 7d22 2c20 227b 656c 6f63 7d22 2c20  nt}", "{eloc}", 
-00005c50: 227b 7263 6f75 6e74 7d22 292c 0d0a 2020  "{rcount}"),..  
-00005c60: 2020 2320 2020 2020 6e6f 6465 5f74 7970    #     node_typ
-00005c70: 653d 6e6f 6e5f 7374 7275 6374 7572 616c  e=non_structural
-00005c80: 5f6e 6f64 6573 2c0d 0a20 2020 2023 2020  _nodes,..    #  
-00005c90: 2020 2068 656c 703d 2222 2c0d 0a20 2020     help="",..   
-00005ca0: 2023 2029 0d0a 2020 2020 2320 6465 6620   # )..    # def 
-00005cb0: 7265 6d6f 7665 5f6d 756c 7469 5f6e 6f64  remove_multi_nod
-00005cc0: 6573 286e 6f64 652c 202a 2a6b 7761 7267  es(node, **kwarg
-00005cd0: 7329 3a0d 0a20 2020 2023 2020 2020 2069  s):..    #     i
-00005ce0: 6620 280d 0a20 2020 2023 2020 2020 2020  f (..    #      
-00005cf0: 2020 206c 656e 286c 6973 7428 7365 6c66     len(list(self
-00005d00: 2e66 6c61 7428 7365 6c65 6374 6564 3d54  .flat(selected=T
-00005d10: 7275 652c 2063 6173 6361 6465 3d46 616c  rue, cascade=Fal
-00005d20: 7365 2c20 7479 7065 733d 6f70 6572 6174  se, types=operat
-00005d30: 655f 6e6f 6465 7329 2929 0d0a 2020 2020  e_nodes)))..    
-00005d40: 2320 2020 2020 2020 2020 3e20 300d 0a20  #         > 0.. 
-00005d50: 2020 2023 2020 2020 2029 3a0d 0a20 2020     #     ):..   
-00005d60: 2023 2020 2020 2020 2020 2074 7970 6573   #         types
-00005d70: 203d 206f 7065 7261 7465 5f6e 6f64 6573   = operate_nodes
-00005d80: 0d0a 2020 2020 2320 2020 2020 656c 7365  ..    #     else
-00005d90: 3a0d 0a20 2020 2023 2020 2020 2020 2020  :..    #        
-00005da0: 2074 7970 6573 203d 2065 6c65 6d5f 6772   types = elem_gr
-00005db0: 6f75 705f 6e6f 6465 730d 0a20 2020 2023  oup_nodes..    #
-00005dc0: 2020 2020 206e 6f64 6573 203d 206c 6973       nodes = lis
-00005dd0: 7428 7365 6c66 2e66 6c61 7428 7365 6c65  t(self.flat(sele
-00005de0: 6374 6564 3d54 7275 652c 2063 6173 6361  cted=True, casca
-00005df0: 6465 3d46 616c 7365 2c20 7479 7065 733d  de=False, types=
-00005e00: 7479 7065 7329 290d 0a20 2020 2023 2020  types))..    #  
-00005e10: 2020 2066 6f72 206e 6f64 6520 696e 206e     for node in n
-00005e20: 6f64 6573 3a0d 0a20 2020 2023 2020 2020  odes:..    #    
-00005e30: 2020 2020 2023 2049 6620 7765 2061 7265       # If we are
-00005e40: 2073 656c 6563 7469 6e67 2061 6e20 6f70   selecting an op
-00005e50: 6572 6174 696f 6e20 2f20 616e 2065 6c65  eration / an ele
-00005e60: 6d65 6e74 2077 6974 6869 6e20 616e 206f  ment within an o
-00005e70: 7065 7261 7469 6f6e 2c20 7468 656e 2069  peration, then i
-00005e80: 740d 0a20 2020 2023 2020 2020 2020 2020  t..    #        
-00005e90: 2023 2061 6c73 6f20 7365 6c65 6374 732f   # also selects/
-00005ea0: 656d 7068 6173 697a 6573 2074 6865 2063  emphasizes the c
-00005eb0: 6f6e 7461 696e 6564 2065 6c65 6d65 6e74  ontained element
-00005ec0: 7320 696e 2074 6865 2065 6c65 6d65 6e74  s in the element
-00005ed0: 7320 6272 616e 6368 2e2e 2e0d 0a20 2020  s branch.....   
-00005ee0: 2023 2020 2020 2020 2020 2023 2053 6f20   #         # So 
-00005ef0: 626f 7468 2077 696c 6c20 6265 2064 656c  both will be del
-00005f00: 6574 6564 2e2e 2e0d 0a20 2020 2023 2020  eted.....    #  
-00005f10: 2020 2020 2020 2023 2054 6f20 6369 7263         # To circ
-00005f20: 756d 7665 6e74 2074 6869 732c 2077 6520  umvent this, we 
-00005f30: 696e 7175 6972 6520 6f6e 6365 206d 6f72  inquire once mor
-00005f40: 6520 7468 6520 7365 6c65 6374 6564 2073  e the selected s
-00005f50: 7461 7475 732e 2e2e 0d0a 2020 2020 2320  tatus.....    # 
-00005f60: 2020 2020 2020 2020 6966 206e 6f64 652e          if node.
-00005f70: 7365 6c65 6374 6564 3a0d 0a20 2020 2023  selected:..    #
-00005f80: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00005f90: 6e6f 6465 2e70 6172 656e 7420 6973 206e  node.parent is n
-00005fa0: 6f74 204e 6f6e 653a 2020 2320 4d61 7920  ot None:  # May 
-00005fb0: 6861 7665 2061 6c72 6561 6479 2072 656d  have already rem
-00005fc0: 6f76 6564 2e0d 0a20 2020 2023 2020 2020  oved...    #    
-00005fd0: 2020 2020 2020 2020 2020 2020 206e 6f64               nod
-00005fe0: 652e 7265 6d6f 7665 5f6e 6f64 6528 290d  e.remove_node().
-00005ff0: 0a20 2020 2023 2020 2020 2073 656c 662e  .    #     self.
-00006000: 7365 745f 656d 7068 6173 6973 284e 6f6e  set_emphasis(Non
-00006010: 6529 0d0a 0d0a 2020 2020 2320 3d3d 3d3d  e)....    # ====
-00006020: 3d3d 3d3d 3d3d 0d0a 2020 2020 2320 5245  ======..    # RE
-00006030: 4d4f 5645 2053 494e 474c 4520 2854 7265  MOVE SINGLE (Tre
-00006040: 6520 5365 6c65 6374 6564 202d 2045 4c45  e Selected - ELE
-00006050: 4d45 4e54 290d 0a20 2020 2023 203d 3d3d  MENT)..    # ===
-00006060: 3d3d 3d3d 3d3d 3d0d 0a20 2020 2040 7472  =======..    @tr
-00006070: 6565 5f63 6f6e 6469 7469 6f6e 616c 286c  ee_conditional(l
-00006080: 616d 6264 6120 6e6f 6465 3a20 6e6f 7420  ambda node: not 
-00006090: 6e6f 6465 2e6c 6f63 6b29 0d0a 2020 2020  node.lock)..    
-000060a0: 4074 7265 655f 636f 6e64 6974 696f 6e61  @tree_conditiona
-000060b0: 6c28 0d0a 2020 2020 2020 2020 6c61 6d62  l(..        lamb
-000060c0: 6461 2063 6f6e 643a 206c 656e 280d 0a20  da cond: len(.. 
-000060d0: 2020 2020 2020 2020 2020 206c 6973 7428             list(
-000060e0: 7365 6c66 2e66 6c61 7428 7365 6c65 6374  self.flat(select
-000060f0: 6564 3d54 7275 652c 2063 6173 6361 6465  ed=True, cascade
-00006100: 3d46 616c 7365 2c20 7479 7065 733d 656c  =False, types=el
-00006110: 656d 5f6e 6f64 6573 2929 0d0a 2020 2020  em_nodes))..    
-00006120: 2020 2020 290d 0a20 2020 2020 2020 203d      )..        =
-00006130: 3d20 310d 0a20 2020 2029 0d0a 2020 2020  = 1..    )..    
-00006140: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
-00006150: 0d0a 2020 2020 2020 2020 5f28 2244 656c  ..        _("Del
-00006160: 6574 6520 656c 656d 656e 7420 277b 6e61  ete element '{na
-00006170: 6d65 7d27 2066 756c 6c79 2229 2c0d 0a20  me}' fully"),.. 
-00006180: 2020 2020 2020 206e 6f64 655f 7479 7065         node_type
-00006190: 3d65 6c65 6d5f 6e6f 6465 732c 0d0a 2020  =elem_nodes,..  
-000061a0: 2020 2020 2020 6865 6c70 3d22 222c 0d0a        help="",..
-000061b0: 2020 2020 290d 0a20 2020 2064 6566 2072      )..    def r
-000061c0: 656d 6f76 655f 7479 7065 5f65 6c65 6d28  emove_type_elem(
-000061d0: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
-000061e0: 0d0a 2020 2020 2020 2020 6966 2068 6173  ..        if has
-000061f0: 6174 7472 286e 6f64 652c 2022 6c6f 636b  attr(node, "lock
-00006200: 2229 2061 6e64 206e 6f64 652e 6c6f 636b  ") and node.lock
-00006210: 3a0d 0a20 2020 2020 2020 2020 2020 2070  :..            p
-00006220: 6173 730d 0a20 2020 2020 2020 2065 6c73  ass..        els
-00006230: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00006240: 6e6f 6465 2e72 656d 6f76 655f 6e6f 6465  node.remove_node
-00006250: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-00006260: 7365 6c66 2e73 6574 5f65 6d70 6861 7369  self.set_emphasi
-00006270: 7328 4e6f 6e65 290d 0a0d 0a20 2020 2040  s(None)....    @
-00006280: 7472 6565 5f63 6f6e 6469 7469 6f6e 616c  tree_conditional
-00006290: 280d 0a20 2020 2020 2020 206c 616d 6264  (..        lambd
-000062a0: 6120 636f 6e64 3a20 6c65 6e28 6c69 7374  a cond: len(list
-000062b0: 2873 656c 662e 666c 6174 2873 656c 6563  (self.flat(selec
-000062c0: 7465 643d 5472 7565 2c20 6361 7363 6164  ted=True, cascad
-000062d0: 653d 4661 6c73 652c 2074 7970 6573 3d6f  e=False, types=o
-000062e0: 705f 6e6f 6465 7329 2929 0d0a 2020 2020  p_nodes)))..    
-000062f0: 2020 2020 3d3d 2031 0d0a 2020 2020 290d      == 1..    ).
-00006300: 0a20 2020 2040 7472 6565 5f6f 7065 7261  .    @tree_opera
-00006310: 7469 6f6e 280d 0a20 2020 2020 2020 205f  tion(..        _
-00006320: 2822 4465 6c65 7465 206f 7065 7261 7469  ("Delete operati
-00006330: 6f6e 2027 7b6e 616d 657d 2720 6675 6c6c  on '{name}' full
-00006340: 7922 292c 0d0a 2020 2020 2020 2020 6e6f  y"),..        no
-00006350: 6465 5f74 7970 653d 6f70 5f6e 6f64 6573  de_type=op_nodes
-00006360: 2c0d 0a20 2020 2020 2020 2068 656c 703d  ,..        help=
-00006370: 2222 2c0d 0a20 2020 2029 0d0a 2020 2020  "",..    )..    
-00006380: 6465 6620 7265 6d6f 7665 5f74 7970 655f  def remove_type_
-00006390: 6f70 286e 6f64 652c 202a 2a6b 7761 7267  op(node, **kwarg
-000063a0: 7329 3a0d 0a0d 0a20 2020 2020 2020 206e  s):....        n
-000063b0: 6f64 652e 7265 6d6f 7665 5f6e 6f64 6528  ode.remove_node(
-000063c0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-000063d0: 7365 745f 656d 7068 6173 6973 284e 6f6e  set_emphasis(Non
-000063e0: 6529 0d0a 2020 2020 2020 2020 7365 6c66  e)..        self
-000063f0: 2e73 6967 6e61 6c28 226f 7065 7261 7469  .signal("operati
-00006400: 6f6e 5f72 656d 6f76 6564 2229 0d0a 0d0a  on_removed")....
-00006410: 2020 2020 4074 7265 655f 636f 6e64 6974      @tree_condit
-00006420: 696f 6e61 6c28 0d0a 2020 2020 2020 2020  ional(..        
-00006430: 6c61 6d62 6461 2063 6f6e 643a 206c 656e  lambda cond: len
-00006440: 286c 6973 7428 7365 6c66 2e66 6c61 7428  (list(self.flat(
-00006450: 7365 6c65 6374 6564 3d54 7275 652c 2063  selected=True, c
-00006460: 6173 6361 6465 3d46 616c 7365 2c20 7479  ascade=False, ty
-00006470: 7065 733d 2262 6c6f 6222 2929 290d 0a20  pes="blob"))).. 
-00006480: 2020 2020 2020 203d 3d20 310d 0a20 2020         == 1..   
-00006490: 2029 0d0a 2020 2020 4074 7265 655f 6f70   )..    @tree_op
-000064a0: 6572 6174 696f 6e28 0d0a 2020 2020 2020  eration(..      
-000064b0: 2020 5f28 2244 656c 6574 6520 626c 6f62    _("Delete blob
-000064c0: 2027 7b6e 616d 657d 2720 6675 6c6c 7922   '{name}' fully"
-000064d0: 292c 0d0a 2020 2020 2020 2020 6e6f 6465  ),..        node
-000064e0: 5f74 7970 653d 2262 6c6f 6222 2c0d 0a20  _type="blob",.. 
-000064f0: 2020 2020 2020 2068 656c 703d 2222 2c0d         help="",.
-00006500: 0a20 2020 2029 0d0a 2020 2020 6465 6620  .    )..    def 
-00006510: 7265 6d6f 7665 5f74 7970 655f 626c 6f62  remove_type_blob
-00006520: 286e 6f64 652c 202a 2a6b 7761 7267 7329  (node, **kwargs)
-00006530: 3a0d 0a20 2020 2020 2020 206e 6f64 652e  :..        node.
-00006540: 7265 6d6f 7665 5f6e 6f64 6528 290d 0a20  remove_node().. 
-00006550: 2020 2020 2020 2073 656c 662e 7365 745f         self.set_
-00006560: 656d 7068 6173 6973 284e 6f6e 6529 0d0a  emphasis(None)..
-00006570: 2020 2020 2020 2020 7365 6c66 2e73 6967          self.sig
-00006580: 6e61 6c28 226f 7065 7261 7469 6f6e 5f72  nal("operation_r
-00006590: 656d 6f76 6564 2229 0d0a 0d0a 2020 2020  emoved")....    
-000065a0: 4074 7265 655f 636f 6e64 6974 696f 6e61  @tree_conditiona
-000065b0: 6c28 0d0a 2020 2020 2020 2020 6c61 6d62  l(..        lamb
-000065c0: 6461 2063 6f6e 643a 206c 656e 286c 6973  da cond: len(lis
-000065d0: 7428 7365 6c66 2e66 6c61 7428 7365 6c65  t(self.flat(sele
-000065e0: 6374 6564 3d54 7275 652c 2063 6173 6361  cted=True, casca
-000065f0: 6465 3d46 616c 7365 2c20 7479 7065 733d  de=False, types=
-00006600: 6f70 5f6e 6f64 6573 2929 290d 0a20 2020  op_nodes)))..   
-00006610: 2020 2020 203e 2031 0d0a 2020 2020 290d       > 1..    ).
-00006620: 0a20 2020 2040 7472 6565 5f63 616c 6328  .    @tree_calc(
-00006630: 0d0a 2020 2020 2020 2020 2265 636f 756e  ..        "ecoun
-00006640: 7422 2c0d 0a20 2020 2020 2020 206c 616d  t",..        lam
-00006650: 6264 6120 693a 206c 656e 286c 6973 7428  bda i: len(list(
-00006660: 7365 6c66 2e66 6c61 7428 7365 6c65 6374  self.flat(select
-00006670: 6564 3d54 7275 652c 2063 6173 6361 6465  ed=True, cascade
-00006680: 3d46 616c 7365 2c20 7479 7065 733d 6f70  =False, types=op
-00006690: 5f6e 6f64 6573 2929 292c 0d0a 2020 2020  _nodes))),..    
-000066a0: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
-000066b0: 7261 7469 6f6e 280d 0a20 2020 2020 2020  ration(..       
-000066c0: 205f 2822 4465 6c65 7465 207b 6563 6f75   _("Delete {ecou
-000066d0: 6e74 7d20 6f70 6572 6174 696f 6e73 2066  nt} operations f
-000066e0: 756c 6c79 2229 2c0d 0a20 2020 2020 2020  ully"),..       
-000066f0: 206e 6f64 655f 7479 7065 3d6f 705f 6e6f   node_type=op_no
-00006700: 6465 732c 0d0a 2020 2020 2020 2020 6865  des,..        he
-00006710: 6c70 3d22 222c 0d0a 2020 2020 290d 0a20  lp="",..    ).. 
-00006720: 2020 2064 6566 2072 656d 6f76 655f 7479     def remove_ty
-00006730: 7065 5f6f 705f 6d75 6c74 6970 6c65 286e  pe_op_multiple(n
-00006740: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
-00006750: 0a20 2020 2020 2020 2066 6f72 206f 7020  .        for op 
-00006760: 696e 206c 6973 7428 7365 6c66 2e66 6c61  in list(self.fla
-00006770: 7428 7365 6c65 6374 6564 3d54 7275 652c  t(selected=True,
-00006780: 2063 6173 6361 6465 3d46 616c 7365 2c20   cascade=False, 
-00006790: 7479 7065 733d 6f70 5f6e 6f64 6573 2929  types=op_nodes))
-000067a0: 3a0d 0a20 2020 2020 2020 2020 2020 206f  :..            o
-000067b0: 702e 7265 6d6f 7665 5f6e 6f64 6528 290d  p.remove_node().
-000067c0: 0a20 2020 2020 2020 2073 656c 662e 7365  .        self.se
-000067d0: 745f 656d 7068 6173 6973 284e 6f6e 6529  t_emphasis(None)
-000067e0: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
-000067f0: 6967 6e61 6c28 226f 7065 7261 7469 6f6e  ignal("operation
-00006800: 5f72 656d 6f76 6564 2229 0d0a 0d0a 2020  _removed")....  
-00006810: 2020 6465 6620 636f 6e74 6169 6e73 5f6e    def contains_n
-00006820: 6f5f 6c6f 636b 6564 5f69 7465 6d73 2829  o_locked_items()
-00006830: 3a0d 0a20 2020 2020 2020 206e 6f6c 6f63  :..        noloc
-00006840: 6b20 3d20 5472 7565 0d0a 2020 2020 2020  k = True..      
-00006850: 2020 666f 7220 6520 696e 206c 6973 7428    for e in list(
-00006860: 7365 6c66 2e66 6c61 7428 7365 6c65 6374  self.flat(select
-00006870: 6564 3d54 7275 652c 2063 6173 6361 6465  ed=True, cascade
-00006880: 3d54 7275 6529 293a 0d0a 2020 2020 2020  =True)):..      
-00006890: 2020 2020 2020 6966 2068 6173 6174 7472        if hasattr
-000068a0: 2865 2c20 226c 6f63 6b22 2920 616e 6420  (e, "lock") and 
-000068b0: 652e 6c6f 636b 3a0d 0a20 2020 2020 2020  e.lock:..       
-000068c0: 2020 2020 2020 2020 206e 6f6c 6f63 6b20           nolock 
-000068d0: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
-000068e0: 2020 2020 2020 2020 2062 7265 616b 0d0a           break..
-000068f0: 2020 2020 2020 2020 7265 7475 726e 206e          return n
-00006900: 6f6c 6f63 6b0d 0a0d 0a20 2020 2040 7472  olock....    @tr
-00006910: 6565 5f63 6f6e 6469 7469 6f6e 616c 286c  ee_conditional(l
-00006920: 616d 6264 6120 636f 6e64 3a20 636f 6e74  ambda cond: cont
-00006930: 6169 6e73 5f6e 6f5f 6c6f 636b 6564 5f69  ains_no_locked_i
-00006940: 7465 6d73 2829 290d 0a20 2020 2040 7472  tems())..    @tr
-00006950: 6565 5f63 6f6e 6469 7469 6f6e 616c 280d  ee_conditional(.
-00006960: 0a20 2020 2020 2020 206c 616d 6264 6120  .        lambda 
-00006970: 636f 6e64 3a20 6c65 6e28 0d0a 2020 2020  cond: len(..    
-00006980: 2020 2020 2020 2020 6c69 7374 2873 656c          list(sel
-00006990: 662e 666c 6174 2873 656c 6563 7465 643d  f.flat(selected=
-000069a0: 5472 7565 2c20 6361 7363 6164 653d 4661  True, cascade=Fa
-000069b0: 6c73 652c 2074 7970 6573 3d28 2266 696c  lse, types=("fil
-000069c0: 6522 2c20 2267 726f 7570 2229 2929 0d0a  e", "group")))..
-000069d0: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-000069e0: 2020 203d 3d20 310d 0a20 2020 2029 0d0a     == 1..    )..
-000069f0: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
-00006a00: 696f 6e28 0d0a 2020 2020 2020 2020 5f28  ion(..        _(
-00006a10: 2244 656c 6574 6520 6772 6f75 7020 277b  "Delete group '{
-00006a20: 6e61 6d65 7d27 2061 6e64 2061 6c6c 2069  name}' and all i
-00006a30: 7473 2063 6869 6c64 2d65 6c65 6d65 6e74  ts child-element
-00006a40: 7320 6675 6c6c 7922 292c 0d0a 2020 2020  s fully"),..    
-00006a50: 2020 2020 6e6f 6465 5f74 7970 653d 2267      node_type="g
-00006a60: 726f 7570 222c 0d0a 2020 2020 2020 2020  roup",..        
-00006a70: 6865 6c70 3d22 222c 0d0a 2020 2020 290d  help="",..    ).
-00006a80: 0a20 2020 2064 6566 2072 656d 6f76 655f  .    def remove_
-00006a90: 7479 7065 5f67 7270 286e 6f64 652c 202a  type_grp(node, *
-00006aa0: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
-00006ab0: 2020 206e 6f64 652e 7265 6d6f 7665 5f6e     node.remove_n
-00006ac0: 6f64 6528 290d 0a20 2020 2020 2020 2073  ode()..        s
-00006ad0: 656c 662e 7365 745f 656d 7068 6173 6973  elf.set_emphasis
-00006ae0: 284e 6f6e 6529 0d0a 0d0a 2020 2020 4074  (None)....    @t
-00006af0: 7265 655f 636f 6e64 6974 696f 6e61 6c28  ree_conditional(
-00006b00: 6c61 6d62 6461 2063 6f6e 643a 2063 6f6e  lambda cond: con
-00006b10: 7461 696e 735f 6e6f 5f6c 6f63 6b65 645f  tains_no_locked_
-00006b20: 6974 656d 7328 2929 0d0a 2020 2020 4074  items())..    @t
-00006b30: 7265 655f 636f 6e64 6974 696f 6e61 6c28  ree_conditional(
-00006b40: 0d0a 2020 2020 2020 2020 6c61 6d62 6461  ..        lambda
-00006b50: 2063 6f6e 643a 206c 656e 280d 0a20 2020   cond: len(..   
-00006b60: 2020 2020 2020 2020 206c 6973 7428 7365           list(se
-00006b70: 6c66 2e66 6c61 7428 7365 6c65 6374 6564  lf.flat(selected
-00006b80: 3d54 7275 652c 2063 6173 6361 6465 3d46  =True, cascade=F
-00006b90: 616c 7365 2c20 7479 7065 733d 2822 6669  alse, types=("fi
-00006ba0: 6c65 222c 2022 6772 6f75 7022 2929 290d  le", "group"))).
-00006bb0: 0a20 2020 2020 2020 2029 0d0a 2020 2020  .        )..    
-00006bc0: 2020 2020 3d3d 2031 0d0a 2020 2020 290d      == 1..    ).
-00006bd0: 0a20 2020 2040 7472 6565 5f6f 7065 7261  .    @tree_opera
-00006be0: 7469 6f6e 280d 0a20 2020 2020 2020 205f  tion(..        _
-00006bf0: 2822 5265 6d6f 7665 206c 6f61 6465 6420  ("Remove loaded 
-00006c00: 6669 6c65 2027 7b6e 616d 657d 2720 616e  file '{name}' an
-00006c10: 6420 616c 6c20 6974 7320 6368 696c 642d  d all its child-
-00006c20: 656c 656d 656e 7473 2066 756c 6c79 2229  elements fully")
-00006c30: 2c0d 0a20 2020 2020 2020 206e 6f64 655f  ,..        node_
-00006c40: 7479 7065 3d22 6669 6c65 222c 0d0a 2020  type="file",..  
-00006c50: 2020 2020 2020 6865 6c70 3d22 222c 0d0a        help="",..
-00006c60: 2020 2020 290d 0a20 2020 2064 6566 2072      )..    def r
-00006c70: 656d 6f76 655f 7479 7065 5f66 696c 6528  emove_type_file(
-00006c80: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
-00006c90: 0d0a 2020 2020 2020 2020 6e6f 6465 2e72  ..        node.r
-00006ca0: 656d 6f76 655f 6e6f 6465 2829 0d0a 2020  emove_node()..  
-00006cb0: 2020 2020 2020 7365 6c66 2e73 6574 5f65        self.set_e
-00006cc0: 6d70 6861 7369 7328 4e6f 6e65 290d 0a0d  mphasis(None)...
-00006cd0: 0a20 2020 2040 7472 6565 5f63 6f6e 6469  .    @tree_condi
-00006ce0: 7469 6f6e 616c 286c 616d 6264 6120 6e6f  tional(lambda no
-00006cf0: 6465 3a20 6e6f 7420 6973 5f72 6567 6d61  de: not is_regma
-00006d00: 726b 286e 6f64 6529 290d 0a20 2020 2040  rk(node))..    @
-00006d10: 7472 6565 5f6f 7065 7261 7469 6f6e 280d  tree_operation(.
-00006d20: 0a20 2020 2020 2020 205f 2822 5265 6d6f  .        _("Remo
-00006d30: 7665 2074 7261 6e73 7061 7265 6e74 206f  ve transparent o
-00006d40: 626a 6563 7473 2229 2c0d 0a20 2020 2020  bjects"),..     
-00006d50: 2020 206e 6f64 655f 7479 7065 3d28 2267     node_type=("g
-00006d60: 726f 7570 222c 2022 6669 6c65 2229 2c0d  roup", "file"),.
-00006d70: 0a20 2020 2020 2020 2068 656c 703d 5f28  .        help=_(
-00006d80: 2252 656d 6f76 6520 616c 6c20 656c 656d  "Remove all elem
-00006d90: 656e 7473 2074 6861 7420 6e65 6974 6865  ents that neithe
-00006da0: 7220 6861 7665 2061 2062 6f72 6465 7220  r have a border 
-00006db0: 6e6f 7220 6120 6669 6c6c 2063 6f6c 6f72  nor a fill color
-00006dc0: 2229 2c0d 0a20 2020 2029 0d0a 2020 2020  "),..    )..    
-00006dd0: 6465 6620 7265 6d6f 7665 5f74 7261 6e73  def remove_trans
-00006de0: 7061 7265 6e74 286e 6f64 652c 202a 2a6b  parent(node, **k
-00006df0: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
-00006e00: 2072 6573 203d 2030 0d0a 2020 2020 2020   res = 0..      
-00006e10: 2020 746f 5f72 656d 6f76 6520 3d20 5b5d    to_remove = []
-00006e20: 0d0a 2020 2020 2020 2020 666f 7220 656e  ..        for en
-00006e30: 6f64 6520 696e 2073 656c 662e 666c 6174  ode in self.flat
-00006e40: 280d 0a20 2020 2020 2020 2020 2020 2073  (..            s
-00006e50: 656c 6563 7465 643d 5472 7565 2c0d 0a20  elected=True,.. 
-00006e60: 2020 2020 2020 2020 2020 2063 6173 6361             casca
-00006e70: 6465 3d54 7275 652c 0d0a 2020 2020 2020  de=True,..      
-00006e80: 2020 2020 2020 7479 7065 733d 280d 0a20        types=(.. 
-00006e90: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00006ea0: 656c 656d 2072 6563 7422 2c0d 0a20 2020  elem rect",..   
-00006eb0: 2020 2020 2020 2020 2020 2020 2022 656c               "el
-00006ec0: 656d 2065 6c6c 6970 7365 222c 0d0a 2020  em ellipse",..  
-00006ed0: 2020 2020 2020 2020 2020 2020 2020 2265                "e
-00006ee0: 6c65 6d20 7061 7468 222c 0d0a 2020 2020  lem path",..    
-00006ef0: 2020 2020 2020 2020 2020 2020 2265 6c65              "ele
-00006f00: 6d20 6c69 6e65 222c 0d0a 2020 2020 2020  m line",..      
-00006f10: 2020 2020 2020 2020 2020 2265 6c65 6d20            "elem 
-00006f20: 706f 6c79 6c69 6e65 222c 0d0a 2020 2020  polyline",..    
-00006f30: 2020 2020 2020 2020 292c 0d0a 2020 2020          ),..    
-00006f40: 2020 2020 293a 0d0a 2020 2020 2020 2020      ):..        
-00006f50: 2020 2020 636f 6c6f 7265 6420 3d20 4661      colored = Fa
-00006f60: 6c73 650d 0a20 2020 2020 2020 2020 2020  lse..           
-00006f70: 2069 6620 280d 0a20 2020 2020 2020 2020   if (..         
-00006f80: 2020 2020 2020 2068 6173 6174 7472 2865         hasattr(e
-00006f90: 6e6f 6465 2c20 2266 696c 6c22 290d 0a20  node, "fill").. 
-00006fa0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00006fb0: 6e64 2065 6e6f 6465 2e66 696c 6c20 6973  nd enode.fill is
-00006fc0: 206e 6f74 204e 6f6e 650d 0a20 2020 2020   not None..     
-00006fd0: 2020 2020 2020 2020 2020 2061 6e64 2065             and e
-00006fe0: 6e6f 6465 2e66 696c 6c2e 6172 6762 2069  node.fill.argb i
-00006ff0: 7320 6e6f 7420 4e6f 6e65 0d0a 2020 2020  s not None..    
-00007000: 2020 2020 2020 2020 293a 0d0a 2020 2020          ):..    
-00007010: 2020 2020 2020 2020 2020 2020 636f 6c6f              colo
-00007020: 7265 6420 3d20 5472 7565 0d0a 2020 2020  red = True..    
-00007030: 2020 2020 2020 2020 6966 2028 0d0a 2020          if (..  
-00007040: 2020 2020 2020 2020 2020 2020 2020 6861                ha
-00007050: 7361 7474 7228 656e 6f64 652c 2022 7374  sattr(enode, "st
-00007060: 726f 6b65 2229 0d0a 2020 2020 2020 2020  roke")..        
-00007070: 2020 2020 2020 2020 616e 6420 656e 6f64          and enod
-00007080: 652e 7374 726f 6b65 2069 7320 6e6f 7420  e.stroke is not 
-00007090: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
-000070a0: 2020 2020 2020 616e 6420 656e 6f64 652e        and enode.
-000070b0: 7374 726f 6b65 2e61 7267 6220 6973 206e  stroke.argb is n
-000070c0: 6f74 204e 6f6e 650d 0a20 2020 2020 2020  ot None..       
-000070d0: 2020 2020 2029 3a0d 0a20 2020 2020 2020       ):..       
-000070e0: 2020 2020 2020 2020 2063 6f6c 6f72 6564           colored
-000070f0: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
-00007100: 2020 2020 2069 6620 6e6f 7420 636f 6c6f       if not colo
-00007110: 7265 643a 0d0a 2020 2020 2020 2020 2020  red:..          
-00007120: 2020 2020 2020 7265 7320 2b3d 2031 0d0a        res += 1..
-00007130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007140: 656e 6f64 652e 7265 6d6f 7665 5f6e 6f64  enode.remove_nod
-00007150: 6528 290d 0a0d 0a20 2020 2020 2020 2069  e()....        i
-00007160: 6620 7265 7320 3e20 303a 0d0a 2020 2020  f res > 0:..    
-00007170: 2020 2020 2020 2020 7365 6c66 2e73 6967          self.sig
-00007180: 6e61 6c28 2272 6562 7569 6c64 5f74 7265  nal("rebuild_tre
-00007190: 6522 290d 0a0d 0a20 2020 2023 203d 3d3d  e")....    # ===
-000071a0: 3d3d 3d3d 3d3d 3d0d 0a20 2020 2023 2052  =======..    # R
-000071b0: 656d 6f76 6520 4f70 6572 6174 696f 6e73  emove Operations
-000071c0: 2028 4966 204e 6f20 5472 6565 2053 656c   (If No Tree Sel
-000071d0: 6563 7465 6429 0d0a 2020 2020 2320 4e6f  ected)..    # No
-000071e0: 7465 3a20 5468 6973 2063 6f64 6520 776f  te: This code wo
-000071f0: 756c 6420 7261 7265 6c79 206d 6174 6368  uld rarely match
-00007200: 2061 6e79 7468 696e 6720 7369 6e63 6520   anything since 
-00007210: 7468 6520 7472 6565 2073 656c 6563 7465  the tree selecte
-00007220: 6420 7769 6c6c 2061 6c6d 6f73 7420 616c  d will almost al
-00007230: 7761 7973 2062 6520 7472 7565 2069 6620  ways be true if 
-00007240: 7765 2068 6176 650d 0a20 2020 2023 206d  we have..    # m
-00007250: 6174 6368 2074 6869 7320 636f 6e64 6974  atch this condit
-00007260: 696f 6e61 6c2e 2054 6865 2074 7265 652d  ional. The tree-
-00007270: 7365 6c65 6374 6564 2064 656c 6574 6520  selected delete 
-00007280: 6675 6e63 7469 6f6e 7320 6172 6520 7375  functions are su
-00007290: 7065 7269 6f72 2e0d 0a20 2020 2023 203d  perior...    # =
-000072a0: 3d3d 3d3d 3d3d 3d3d 3d0d 0a20 2020 2040  =========..    @
-000072b0: 7472 6565 5f63 6f6e 6469 7469 6f6e 616c  tree_conditional
-000072c0: 280d 0a20 2020 2020 2020 206c 616d 6264  (..        lambd
-000072d0: 6120 636f 6e64 3a20 6c65 6e28 0d0a 2020  a cond: len(..  
-000072e0: 2020 2020 2020 2020 2020 6c69 7374 2873            list(s
-000072f0: 656c 662e 666c 6174 2873 656c 6563 7465  elf.flat(selecte
-00007300: 643d 5472 7565 2c20 6361 7363 6164 653d  d=True, cascade=
-00007310: 4661 6c73 652c 2074 7970 6573 3d6e 6f6e  False, types=non
-00007320: 5f73 7472 7563 7475 7261 6c5f 6e6f 6465  _structural_node
-00007330: 7329 290d 0a20 2020 2020 2020 2029 0d0a  s))..        )..
-00007340: 2020 2020 2020 2020 3d3d 2030 0d0a 2020          == 0..  
-00007350: 2020 290d 0a20 2020 2040 7472 6565 5f63    )..    @tree_c
-00007360: 6f6e 6469 7469 6f6e 616c 286c 616d 6264  onditional(lambd
-00007370: 6120 6e6f 6465 3a20 6c65 6e28 6c69 7374  a node: len(list
-00007380: 2873 656c 662e 6f70 7328 7365 6c65 6374  (self.ops(select
-00007390: 6564 3d54 7275 6529 2929 203e 2031 290d  ed=True))) > 1).
-000073a0: 0a20 2020 2040 7472 6565 5f63 616c 6328  .    @tree_calc(
-000073b0: 2265 636f 756e 7422 2c20 6c61 6d62 6461  "ecount", lambda
-000073c0: 2069 3a20 6c65 6e28 6c69 7374 2873 656c   i: len(list(sel
-000073d0: 662e 6f70 7328 7365 6c65 6374 6564 3d54  f.ops(selected=T
-000073e0: 7275 6529 2929 290d 0a20 2020 2040 7472  rue))))..    @tr
-000073f0: 6565 5f6f 7065 7261 7469 6f6e 280d 0a20  ee_operation(.. 
-00007400: 2020 2020 2020 205f 2822 4465 6c65 7465         _("Delete
-00007410: 207b 6563 6f75 6e74 7d20 6f70 6572 6174   {ecount} operat
-00007420: 696f 6e73 2229 2c0d 0a20 2020 2020 2020  ions"),..       
-00007430: 206e 6f64 655f 7479 7065 3d28 0d0a 2020   node_type=(..  
-00007440: 2020 2020 2020 2020 2020 226f 7020 6375            "op cu
-00007450: 7422 2c0d 0a20 2020 2020 2020 2020 2020  t",..           
-00007460: 2022 6f70 2072 6173 7465 7222 2c0d 0a20   "op raster",.. 
-00007470: 2020 2020 2020 2020 2020 2022 6f70 2069             "op i
-00007480: 6d61 6765 222c 0d0a 2020 2020 2020 2020  mage",..        
-00007490: 2020 2020 226f 7020 656e 6772 6176 6522      "op engrave"
-000074a0: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
-000074b0: 6f70 2064 6f74 7322 2c0d 0a20 2020 2020  op dots",..     
-000074c0: 2020 2020 2020 2022 6f70 2068 6174 6368         "op hatch
-000074d0: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
-000074e0: 2275 7469 6c20 636f 6e73 6f6c 6522 2c0d  "util console",.
-000074f0: 0a20 2020 2020 2020 2020 2020 2022 7574  .            "ut
-00007500: 696c 2077 6169 7422 2c0d 0a20 2020 2020  il wait",..     
-00007510: 2020 2020 2020 2022 7574 696c 2068 6f6d         "util hom
-00007520: 6522 2c0d 0a20 2020 2020 2020 2020 2020  e",..           
-00007530: 2022 7574 696c 2067 6f74 6f22 2c0d 0a20   "util goto",.. 
-00007540: 2020 2020 2020 2020 2020 2022 7574 696c             "util
-00007550: 206f 7269 6769 6e22 2c0d 0a20 2020 2020   origin",..     
-00007560: 2020 2020 2020 2022 7574 696c 206f 7574         "util out
-00007570: 7075 7422 2c0d 0a20 2020 2020 2020 2020  put",..         
-00007580: 2020 2022 7574 696c 2069 6e70 7574 222c     "util input",
-00007590: 0d0a 2020 2020 2020 2020 2020 2020 226c  ..            "l
-000075a0: 6173 6572 636f 6465 222c 0d0a 2020 2020  asercode",..    
-000075b0: 2020 2020 2020 2020 2263 7574 636f 6465          "cutcode
-000075c0: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
-000075d0: 2262 6c6f 6222 2c0d 0a20 2020 2020 2020  "blob",..       
-000075e0: 2029 2c0d 0a20 2020 2020 2020 2068 656c   ),..        hel
-000075f0: 703d 2222 2c0d 0a20 2020 2029 0d0a 2020  p="",..    )..  
-00007600: 2020 6465 6620 7265 6d6f 7665 5f6e 5f6f    def remove_n_o
-00007610: 7073 286e 6f64 652c 202a 2a6b 7761 7267  ps(node, **kwarg
-00007620: 7329 3a0d 0a20 2020 2020 2020 2073 656c  s):..        sel
-00007630: 6628 226f 7065 7261 7469 6f6e 2064 656c  f("operation del
-00007640: 6574 655c 6e22 290d 0a0d 0a20 2020 2040  ete\n")....    @
-00007650: 7472 6565 5f6f 7065 7261 7469 6f6e 280d  tree_operation(.
-00007660: 0a20 2020 2020 2020 205f 2822 5365 6c65  .        _("Sele
-00007670: 6374 2061 6c6c 2065 6c65 6d65 6e74 7320  ct all elements 
-00007680: 6f66 2073 616d 6520 7479 7065 2229 2c0d  of same type"),.
-00007690: 0a20 2020 2020 2020 206e 6f64 655f 7479  .        node_ty
-000076a0: 7065 3d65 6c65 6d5f 6e6f 6465 732c 0d0a  pe=elem_nodes,..
-000076b0: 2020 2020 2020 2020 6865 6c70 3d5f 2822          help=_("
-000076c0: 5365 6c65 6374 2061 6c6c 2065 6c65 6d65  Select all eleme
-000076d0: 6e74 7320 696e 2073 6365 6e65 2c20 7468  nts in scene, th
-000076e0: 6174 2068 6176 6520 7468 6520 7361 6d65  at have the same
-000076f0: 2074 7970 6520 6173 2074 6869 7320 6e6f   type as this no
-00007700: 6465 2229 2c0d 0a20 2020 2029 0d0a 2020  de"),..    )..  
-00007710: 2020 6465 6620 7365 6c65 6374 5f73 696d    def select_sim
-00007720: 696c 6172 286e 6f64 652c 202a 2a6b 7761  ilar(node, **kwa
-00007730: 7267 7329 3a0d 0a20 2020 2020 2020 206e  rgs):..        n
-00007740: 7479 7065 203d 206e 6f64 652e 7479 7065  type = node.type
-00007750: 0d0a 2020 2020 2020 2020 6368 616e 6765  ..        change
-00007760: 7320 3d20 4661 6c73 650d 0a20 2020 2020  s = False..     
-00007770: 2020 2066 6f72 2065 2069 6e20 7365 6c66     for e in self
-00007780: 2e65 6c65 6d73 2829 3a0d 0a20 2020 2020  .elems():..     
-00007790: 2020 2020 2020 2069 6620 652e 7479 7065         if e.type
-000077a0: 203d 3d20 6e74 7970 6520 616e 6420 6e6f   == ntype and no
-000077b0: 7420 652e 656d 7068 6173 697a 6564 3a0d  t e.emphasized:.
-000077c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000077d0: 2065 2e65 6d70 6861 7369 7a65 6420 3d20   e.emphasized = 
-000077e0: 5472 7565 0d0a 2020 2020 2020 2020 2020  True..          
-000077f0: 2020 2020 2020 652e 7365 6c65 6374 6564        e.selected
-00007800: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
-00007810: 2020 2020 2020 2020 2063 6861 6e67 6573           changes
-00007820: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
-00007830: 2069 6620 6368 616e 6765 733a 0d0a 2020   if changes:..  
-00007840: 2020 2020 2020 2020 2020 7365 6c66 2e76            self.v
-00007850: 616c 6964 6174 655f 7365 6c65 6374 6564  alidate_selected
-00007860: 5f61 7265 6128 290d 0a20 2020 2020 2020  _area()..       
-00007870: 2020 2020 2073 656c 662e 7369 676e 616c       self.signal
-00007880: 2822 7265 6672 6573 685f 7363 656e 6522  ("refresh_scene"
-00007890: 2c20 2253 6365 6e65 2229 0d0a 0d0a 2020  , "Scene")....  
-000078a0: 2020 2320 3d3d 3d3d 3d3d 3d3d 3d3d 0d0a    # ==========..
-000078b0: 2020 2020 2320 5245 4d4f 5645 2045 4c45      # REMOVE ELE
-000078c0: 4d45 4e54 530d 0a20 2020 2023 203d 3d3d  MENTS..    # ===
-000078d0: 3d3d 3d3d 3d3d 3d0d 0a20 2020 2023 204d  =======..    # M
-000078e0: 6f72 6520 7468 616e 206f 6e65 2c20 7370  ore than one, sp
-000078f0: 6563 6961 6c20 6361 7365 203d 3d20 3120  ecial case == 1 
-00007900: 616c 7265 6164 7920 6465 616c 7420 7769  already dealt wi
-00007910: 7468 0d0a 2020 2020 4074 7265 655f 636f  th..    @tree_co
-00007920: 6e64 6974 696f 6e61 6c28 6c61 6d62 6461  nditional(lambda
-00007930: 206e 6f64 653a 206c 656e 286c 6973 7428   node: len(list(
-00007940: 7365 6c66 2e65 6c65 6d73 2865 6d70 6861  self.elems(empha
-00007950: 7369 7a65 643d 5472 7565 2929 2920 3e20  sized=True))) > 
-00007960: 3129 0d0a 2020 2020 4074 7265 655f 6361  1)..    @tree_ca
-00007970: 6c63 2822 6563 6f75 6e74 222c 206c 616d  lc("ecount", lam
-00007980: 6264 6120 693a 206c 656e 286c 6973 7428  bda i: len(list(
-00007990: 7365 6c66 2e65 6c65 6d73 2865 6d70 6861  self.elems(empha
-000079a0: 7369 7a65 643d 5472 7565 2929 2929 0d0a  sized=True))))..
-000079b0: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
-000079c0: 696f 6e28 0d0a 2020 2020 2020 2020 5f28  ion(..        _(
-000079d0: 2244 656c 6574 6520 7b65 636f 756e 747d  "Delete {ecount}
-000079e0: 2065 6c65 6d65 6e74 732c 2061 7320 7365   elements, as se
-000079f0: 6c65 6374 6564 2069 6e20 7363 656e 6522  lected in scene"
-00007a00: 292c 0d0a 2020 2020 2020 2020 6e6f 6465  ),..        node
-00007a10: 5f74 7970 653d 656c 656d 5f67 726f 7570  _type=elem_group
-00007a20: 5f6e 6f64 6573 2c0d 0a20 2020 2020 2020  _nodes,..       
-00007a30: 2068 656c 703d 2222 2c0d 0a20 2020 2029   help="",..    )
-00007a40: 0d0a 2020 2020 6465 6620 7265 6d6f 7665  ..    def remove
-00007a50: 5f6e 5f65 6c65 6d65 6e74 7328 6e6f 6465  _n_elements(node
-00007a60: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-00007a70: 2020 2020 2020 7365 6c66 2822 656c 656d        self("elem
-00007a80: 656e 7420 6465 6c65 7465 5c6e 2229 0d0a  ent delete\n")..
-00007a90: 0d0a 2020 2020 4074 7265 655f 636f 6e64  ..    @tree_cond
-00007aa0: 6974 696f 6e61 6c28 0d0a 2020 2020 2020  itional(..      
-00007ab0: 2020 6c61 6d62 6461 206e 6f64 653a 2069    lambda node: i
-00007ac0: 7369 6e73 7461 6e63 6528 6e6f 6465 2e73  sinstance(node.s
-00007ad0: 6861 7065 2c20 506f 6c79 676f 6e29 2061  hape, Polygon) a
-00007ae0: 6e64 206c 656e 286e 6f64 652e 7368 6170  nd len(node.shap
-00007af0: 652e 706f 696e 7473 2920 3e3d 2033 0d0a  e.points) >= 3..
-00007b00: 2020 2020 290d 0a20 2020 2040 7472 6565      )..    @tree
-00007b10: 5f6f 7065 7261 7469 6f6e 280d 0a20 2020  _operation(..   
-00007b20: 2020 2020 205f 2822 4d61 6b65 2050 6f6c       _("Make Pol
-00007b30: 7967 6f6e 2072 6567 756c 6172 2229 2c0d  ygon regular"),.
-00007b40: 0a20 2020 2020 2020 206e 6f64 655f 7479  .        node_ty
-00007b50: 7065 3d22 656c 656d 2070 6f6c 796c 696e  pe="elem polylin
-00007b60: 6522 2c0d 0a20 2020 2020 2020 2068 656c  e",..        hel
-00007b70: 703d 2222 2c0d 0a20 2020 2029 0d0a 2020  p="",..    )..  
-00007b80: 2020 6465 6620 6d61 6b65 5f70 6f6c 7967    def make_polyg
-00007b90: 6f6e 5f72 6567 756c 6172 286e 6f64 652c  on_regular(node,
-00007ba0: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
-00007bb0: 2020 2020 2023 2066 726f 6d20 2e75 6e69       # from .uni
-00007bc0: 7473 2069 6d70 6f72 7420 4c65 6e67 7468  ts import Length
-00007bd0: 0d0a 2020 2020 2020 2020 2320 6672 6f6d  ..        # from
-00007be0: 202e 2e73 7667 656c 656d 656e 7473 2069   ..svgelements i
-00007bf0: 6d70 6f72 7420 436f 6c6f 720d 0a0d 0a20  mport Color.... 
-00007c00: 2020 2020 2020 2023 2064 6566 206d 6b5f         # def mk_
-00007c10: 6465 6275 675f 706f 696e 7428 782c 2079  debug_point(x, y
-00007c20: 2c20 636f 6c29 3a0d 0a20 2020 2020 2020  , col):..       
-00007c30: 2023 2020 2020 2063 6972 6320 3d20 456c   #     circ = El
-00007c40: 6c69 7073 6528 6378 3d78 2c20 6379 3d79  lipse(cx=x, cy=y
-00007c50: 2c20 723d 666c 6f61 7428 4c65 6e67 7468  , r=float(Length
-00007c60: 2822 316d 6d22 2929 290d 0a20 2020 2020  ("1mm")))..     
-00007c70: 2020 2023 2020 2020 2063 6972 632e 7472     #     circ.tr
-00007c80: 616e 7366 6f72 6d20 3d20 636f 7079 286e  ansform = copy(n
-00007c90: 6f64 652e 7368 6170 652e 7472 616e 7366  ode.shape.transf
-00007ca0: 6f72 6d29 0d0a 2020 2020 2020 2020 2320  orm)..        # 
-00007cb0: 2020 2020 7365 6c66 2e65 6c65 6d5f 6272      self.elem_br
-00007cc0: 616e 6368 2e61 6464 280d 0a20 2020 2020  anch.add(..     
-00007cd0: 2020 2023 2020 2020 2020 2020 2073 6861     #         sha
-00007ce0: 7065 3d63 6972 632c 0d0a 2020 2020 2020  pe=circ,..      
-00007cf0: 2020 2320 2020 2020 2020 2020 7479 7065    #         type
-00007d00: 3d22 656c 656d 2065 6c6c 6970 7365 222c  ="elem ellipse",
-00007d10: 0d0a 2020 2020 2020 2020 2320 2020 2020  ..        #     
-00007d20: 2020 2020 7374 726f 6b65 3d43 6f6c 6f72      stroke=Color
-00007d30: 2863 6f6c 292c 0d0a 2020 2020 2020 2020  (col),..        
-00007d40: 2320 2020 2020 2020 2020 6669 6c6c 3d43  #         fill=C
-00007d50: 6f6c 6f72 2863 6f6c 292c 0d0a 2020 2020  olor(col),..    
-00007d60: 2020 2020 2320 2020 2020 2020 2020 6d61      #         ma
-00007d70: 7472 6978 3d63 6f70 7928 6e6f 6465 2e6d  trix=copy(node.m
-00007d80: 6174 7269 7829 2c0d 0a20 2020 2020 2020  atrix),..       
-00007d90: 2023 2020 2020 2029 0d0a 0d0a 2020 2020   #     )....    
-00007da0: 2020 2020 6966 206e 6f64 6520 6973 204e      if node is N
-00007db0: 6f6e 6520 6f72 206e 6f64 652e 7479 7065  one or node.type
-00007dc0: 2021 3d20 2265 6c65 6d20 706f 6c79 6c69   != "elem polyli
-00007dd0: 6e65 223a 0d0a 2020 2020 2020 2020 2020  ne":..          
-00007de0: 2020 7265 7475 726e 0d0a 2020 2020 2020    return..      
-00007df0: 2020 6e75 6d62 6572 5f70 6f69 6e74 7320    number_points 
-00007e00: 3d20 6c65 6e28 6e6f 6465 2e73 6861 7065  = len(node.shape
-00007e10: 2e70 6f69 6e74 7329 0d0a 2020 2020 2020  .points)..      
-00007e20: 2020 2320 7072 696e 7420 2866 224e 756d    # print (f"Num
-00007e30: 6265 7220 6f66 2070 6f69 6e74 733a 207b  ber of points: {
-00007e40: 6e75 6d62 6572 5f70 6f69 6e74 737d 2229  number_points}")
-00007e50: 0d0a 2020 2020 2020 2020 2320 666f 7220  ..        # for 
-00007e60: 7072 6f70 2069 6e20 6469 7228 6e6f 6465  prop in dir(node
-00007e70: 293a 0d0a 2020 2020 2020 2020 2320 2020  ):..        #   
-00007e80: 2020 7072 696e 7420 2866 227b 7072 6f70    print (f"{prop
-00007e90: 7d20 2d20 7b67 6574 6174 7472 286e 6f64  } - {getattr(nod
-00007ea0: 652c 2027 7072 6f70 272c 2027 2729 7d22  e, 'prop', '')}"
-00007eb0: 290d 0a20 2020 2020 2020 2023 2066 6f72  )..        # for
-00007ec0: 2069 6478 2c20 7074 2069 6e20 656e 756d   idx, pt in enum
-00007ed0: 6572 6174 6528 6e6f 6465 2e73 6861 7065  erate(node.shape
-00007ee0: 2e70 6f69 6e74 7329 3a0d 0a20 2020 2020  .points):..     
-00007ef0: 2020 2023 2020 2020 2070 7269 6e74 2028     #     print (
-00007f00: 6622 7b69 6478 7d3a 207b 7074 2e78 3a2e  f"{idx}: {pt.x:.
-00007f10: 3166 7d2c 207b 7074 2e79 3a2e 3166 7d22  1f}, {pt.y:.1f}"
-00007f20: 290d 0a20 2020 2020 2020 2069 6620 6e75  )..        if nu
-00007f30: 6d62 6572 5f70 6f69 6e74 7320 3c20 3320  mber_points < 3 
-00007f40: 6f72 206e 6f74 2069 7369 6e73 7461 6e63  or not isinstanc
-00007f50: 6528 6e6f 6465 2e73 6861 7065 2c20 506f  e(node.shape, Po
-00007f60: 6c79 676f 6e29 3a0d 0a20 2020 2020 2020  lygon):..       
-00007f70: 2020 2020 2072 6574 7572 6e0d 0a20 2020       return..   
-00007f80: 2020 2020 2070 7473 203d 206e 6f64 652e       pts = node.
-00007f90: 7368 6170 652e 706f 696e 7473 0d0a 2020  shape.points..  
-00007fa0: 2020 2020 2020 6478 203d 2070 7473 5b31        dx = pts[1
-00007fb0: 5d2e 7820 2d20 7074 735b 305d 2e78 0d0a  ].x - pts[0].x..
-00007fc0: 2020 2020 2020 2020 6479 203d 2070 7473          dy = pts
-00007fd0: 5b31 5d2e 7920 2d20 7074 735b 305d 2e79  [1].y - pts[0].y
-00007fe0: 0d0a 2020 2020 2020 2020 6261 7365 6c69  ..        baseli
-00007ff0: 6e65 203d 206d 6174 682e 7371 7274 2864  ne = math.sqrt(d
-00008000: 7820 2a20 6478 202b 2064 7920 2a20 6479  x * dx + dy * dy
-00008010: 290d 0a20 2020 2020 2020 2061 706f 7468  )..        apoth
-00008020: 656d 203d 2062 6173 656c 696e 6520 2f20  em = baseline / 
-00008030: 2832 202a 206d 6174 682e 7461 6e28 6d61  (2 * math.tan(ma
-00008040: 7468 2e74 6175 202f 2028 3220 2a20 6e75  th.tau / (2 * nu
-00008050: 6d62 6572 5f70 6f69 6e74 7329 2929 0d0a  mber_points)))..
-00008060: 2020 2020 2020 2020 6369 7263 756d 7261          circumra
-00008070: 6469 7573 203d 2062 6173 656c 696e 6520  dius = baseline 
-00008080: 2f20 2832 202a 206d 6174 682e 7369 6e28  / (2 * math.sin(
-00008090: 6d61 7468 2e74 6175 202f 2028 3220 2a20  math.tau / (2 * 
-000080a0: 6e75 6d62 6572 5f70 6f69 6e74 7329 2929  number_points)))
-000080b0: 0d0a 2020 2020 2020 2020 6d69 6470 6f69  ..        midpoi
-000080c0: 6e74 203d 2050 6f69 6e74 2870 7473 5b30  nt = Point(pts[0
-000080d0: 5d2e 7820 2b20 302e 3520 2a20 6478 2c20  ].x + 0.5 * dx, 
-000080e0: 7074 735b 305d 2e79 202b 2030 2e35 202a  pts[0].y + 0.5 *
-000080f0: 2064 7929 0d0a 2020 2020 2020 2020 2320   dy)..        # 
-00008100: 206d 6b5f 6465 6275 675f 706f 696e 7428   mk_debug_point(
-00008110: 6d69 6470 6f69 6e74 2e78 2c20 6d69 6470  midpoint.x, midp
-00008120: 6f69 6e74 2e79 2c20 2262 6c61 636b 2229  oint.y, "black")
-00008130: 0d0a 2020 2020 2020 2020 6178 203d 2030  ..        ax = 0
-00008140: 0d0a 2020 2020 2020 2020 6179 203d 2030  ..        ay = 0
-00008150: 0d0a 2020 2020 2020 2020 666f 7220 6964  ..        for id
-00008160: 782c 2070 7420 696e 2065 6e75 6d65 7261  x, pt in enumera
-00008170: 7465 2870 7473 293a 0d0a 2020 2020 2020  te(pts):..      
-00008180: 2020 2020 2020 6178 202b 3d20 7074 2e78        ax += pt.x
-00008190: 0d0a 2020 2020 2020 2020 2020 2020 6179  ..            ay
-000081a0: 202b 3d20 7074 2e79 0d0a 2020 2020 2020   += pt.y..      
-000081b0: 2020 6178 202f 3d20 6e75 6d62 6572 5f70    ax /= number_p
-000081c0: 6f69 6e74 730d 0a20 2020 2020 2020 2061  oints..        a
-000081d0: 7920 2f3d 206e 756d 6265 725f 706f 696e  y /= number_poin
-000081e0: 7473 0d0a 2020 2020 2020 2020 2320 5468  ts..        # Th
-000081f0: 6520 6172 6974 686d 6574 6963 2063 656e  e arithmetic cen
-00008200: 7465 7220 2861 782c 2061 7929 2069 6e64  ter (ax, ay) ind
-00008210: 6963 6174 6573 2074 6f20 7768 6963 680d  icates to which.
-00008220: 0a20 2020 2020 2020 2023 2027 7369 6465  .        # 'side
-00008230: 2720 6f66 2074 6865 2062 6173 656c 696e  ' of the baselin
-00008240: 6520 7468 6520 706f 6c79 676f 6e20 6e65  e the polygon ne
-00008250: 6564 7320 746f 2062 6520 636f 6e73 7472  eds to be constr
-00008260: 7563 7465 640d 0a20 2020 2020 2020 2061  ucted..        a
-00008270: 7269 7468 6d65 7469 635f 6365 6e74 6572  rithmetic_center
-00008280: 203d 2050 6f69 6e74 2861 782c 2061 7929   = Point(ax, ay)
-00008290: 0d0a 2020 2020 2020 2020 2320 6d6b 5f64  ..        # mk_d
-000082a0: 6562 7567 5f70 6f69 6e74 2861 782c 2061  ebug_point(ax, a
-000082b0: 792c 2022 6772 6565 6e22 290d 0a20 2020  y, "green")..   
-000082c0: 2020 2020 2061 6e67 6c65 203d 2070 7473       angle = pts
-000082d0: 5b30 5d2e 616e 676c 655f 746f 2870 7473  [0].angle_to(pts
-000082e0: 5b31 5d29 0d0a 2020 2020 2020 2020 6d69  [1])..        mi
-000082f0: 6461 6e67 6c65 203d 206d 6964 706f 696e  dangle = midpoin
-00008300: 742e 616e 676c 655f 746f 2861 7269 7468  t.angle_to(arith
-00008310: 6d65 7469 635f 6365 6e74 6572 290d 0a20  metic_center).. 
-00008320: 2020 2020 2020 2061 6e67 6c65 202b 3d20         angle += 
-00008330: 6d61 7468 2e74 6175 202f 2034 0d0a 2020  math.tau / 4..  
-00008340: 2020 2020 2020 6669 7273 745f 706f 696e        first_poin
-00008350: 7420 3d20 506f 696e 742e 706f 6c61 7228  t = Point.polar(
-00008360: 6d69 6470 6f69 6e74 2c20 616e 676c 652c  midpoint, angle,
-00008370: 2061 706f 7468 656d 290d 0a20 2020 2020   apothem)..     
-00008380: 2020 2073 6563 6f6e 645f 706f 696e 7420     second_point 
-00008390: 3d20 506f 696e 742e 706f 6c61 7228 6d69  = Point.polar(mi
-000083a0: 6470 6f69 6e74 2c20 616e 676c 6520 2b20  dpoint, angle + 
-000083b0: 6d61 7468 2e74 6175 202f 2032 2c20 6170  math.tau / 2, ap
-000083c0: 6f74 6865 6d29 0d0a 2020 2020 2020 2020  othem)..        
-000083d0: 2320 6d6b 5f64 6562 7567 5f70 6f69 6e74  # mk_debug_point
-000083e0: 2866 6972 7374 5f70 6f69 6e74 2e78 2c20  (first_point.x, 
-000083f0: 6669 7273 745f 706f 696e 742e 792c 2022  first_point.y, "
-00008400: 7965 6c6c 6f77 2229 0d0a 2020 2020 2020  yellow")..      
-00008410: 2020 2320 6d6b 5f64 6562 7567 5f70 6f69    # mk_debug_poi
-00008420: 6e74 2873 6563 6f6e 645f 706f 696e 742e  nt(second_point.
-00008430: 782c 2073 6563 6f6e 645f 706f 696e 742e  x, second_point.
-00008440: 792c 2022 6379 616e 2229 0d0a 2020 2020  y, "cyan")..    
-00008450: 2020 2020 6465 6c74 6161 6e67 6c65 203d      deltaangle =
-00008460: 206d 6174 682e 7461 7520 2f20 6e75 6d62   math.tau / numb
-00008470: 6572 5f70 6f69 6e74 730d 0a20 2020 2020  er_points..     
-00008480: 2020 2064 3120 3d20 6172 6974 686d 6574     d1 = arithmet
-00008490: 6963 5f63 656e 7465 722e 6469 7374 616e  ic_center.distan
-000084a0: 6365 5f74 6f28 6669 7273 745f 706f 696e  ce_to(first_poin
-000084b0: 7429 0d0a 2020 2020 2020 2020 6432 203d  t)..        d2 =
-000084c0: 2061 7269 7468 6d65 7469 635f 6365 6e74   arithmetic_cent
-000084d0: 6572 2e64 6973 7461 6e63 655f 746f 2873  er.distance_to(s
-000084e0: 6563 6f6e 645f 706f 696e 7429 0d0a 2020  econd_point)..  
-000084f0: 2020 2020 2020 6966 2064 3120 3c20 6432        if d1 < d2
-00008500: 3a0d 0a20 2020 2020 2020 2020 2020 2063  :..            c
-00008510: 656e 7465 725f 706f 696e 7420 3d20 636f  enter_point = co
-00008520: 7079 2866 6972 7374 5f70 6f69 6e74 290d  py(first_point).
-00008530: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-00008540: 2020 2020 2020 2020 2020 2020 6365 6e74              cent
-00008550: 6572 5f70 6f69 6e74 203d 2063 6f70 7928  er_point = copy(
-00008560: 7365 636f 6e64 5f70 6f69 6e74 290d 0a20  second_point).. 
-00008570: 2020 2020 2020 2023 206d 6b5f 6465 6275         # mk_debu
-00008580: 675f 706f 696e 7428 6365 6e74 6572 5f70  g_point(center_p
-00008590: 6f69 6e74 2e78 2c20 6365 6e74 6572 5f70  oint.x, center_p
-000085a0: 6f69 6e74 2e79 2c20 2272 6564 2229 0d0a  oint.y, "red")..
-000085b0: 0d0a 2020 2020 2020 2020 6966 2063 656e  ..        if cen
-000085c0: 7465 725f 706f 696e 742e 616e 676c 655f  ter_point.angle_
-000085d0: 746f 2870 7473 5b30 5d29 203e 2063 656e  to(pts[0]) > cen
-000085e0: 7465 725f 706f 696e 742e 616e 676c 655f  ter_point.angle_
-000085f0: 746f 2870 7473 5b31 5d29 3a0d 0a20 2020  to(pts[1]):..   
-00008600: 2020 2020 2020 2020 2064 656c 7461 616e           deltaan
-00008610: 676c 6520 2a3d 202d 310d 0a20 2020 2020  gle *= -1..     
-00008620: 2020 2061 6e67 6c65 203d 2063 656e 7465     angle = cente
-00008630: 725f 706f 696e 742e 616e 676c 655f 746f  r_point.angle_to
-00008640: 2870 7473 5b30 5d29 0d0a 2020 2020 2020  (pts[0])..      
-00008650: 2020 666f 7220 6964 7820 696e 2072 616e    for idx in ran
-00008660: 6765 286e 756d 6265 725f 706f 696e 7473  ge(number_points
-00008670: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00008680: 2320 6966 2069 6478 203e 2031 3a0d 0a20  # if idx > 1:.. 
-00008690: 2020 2020 2020 2020 2020 2070 7420 3d20             pt = 
-000086a0: 506f 696e 742e 706f 6c61 7228 6365 6e74  Point.polar(cent
-000086b0: 6572 5f70 6f69 6e74 2c20 616e 676c 652c  er_point, angle,
-000086c0: 2063 6972 6375 6d72 6164 6975 7329 0d0a   circumradius)..
-000086d0: 2020 2020 2020 2020 2020 2020 7074 735b              pts[
-000086e0: 6964 785d 2e78 203d 2070 742e 780d 0a20  idx].x = pt.x.. 
-000086f0: 2020 2020 2020 2020 2020 2070 7473 5b69             pts[i
-00008700: 6478 5d2e 7920 3d20 7074 2e79 0d0a 2020  dx].y = pt.y..  
-00008710: 2020 2020 2020 2020 2020 616e 676c 6520            angle 
-00008720: 2b3d 2064 656c 7461 616e 676c 650d 0a20  += deltaangle.. 
-00008730: 2020 2020 2020 206e 6f64 652e 616c 7465         node.alte
-00008740: 7265 6428 290d 0a20 2020 2020 2020 2073  red()..        s
-00008750: 656c 662e 7369 676e 616c 2822 7265 6672  elf.signal("refr
-00008760: 6573 685f 7363 656e 6522 2c20 2253 6365  esh_scene", "Sce
-00008770: 6e65 2229 0d0a 0d0a 2020 2020 2320 3d3d  ne")....    # ==
-00008780: 3d3d 3d3d 3d3d 3d3d 0d0a 2020 2020 2320  ========..    # 
-00008790: 434f 4e56 4552 5420 5452 4545 204f 5045  CONVERT TREE OPE
-000087a0: 5241 5449 4f4e 530d 0a20 2020 2023 203d  RATIONS..    # =
-000087b0: 3d3d 3d3d 3d3d 3d3d 3d0d 0a20 2020 2040  =========..    @
-000087c0: 7472 6565 5f6f 7065 7261 7469 6f6e 280d  tree_operation(.
-000087d0: 0a20 2020 2020 2020 205f 2822 436f 6e76  .        _("Conv
-000087e0: 6572 7420 746f 2043 7574 636f 6465 2229  ert to Cutcode")
-000087f0: 2c0d 0a20 2020 2020 2020 206e 6f64 655f  ,..        node_
-00008800: 7479 7065 3d22 6c61 7365 7263 6f64 6522  type="lasercode"
-00008810: 2c0d 0a20 2020 2020 2020 2068 656c 703d  ,..        help=
-00008820: 2222 2c0d 0a20 2020 2029 0d0a 2020 2020  "",..    )..    
-00008830: 6465 6620 6c61 7365 7263 6f64 6532 6375  def lasercode2cu
-00008840: 7428 6e6f 6465 2c20 2a2a 6b77 6172 6773  t(node, **kwargs
-00008850: 293a 0d0a 2020 2020 2020 2020 6e6f 6465  ):..        node
-00008860: 2e72 6570 6c61 6365 5f6e 6f64 6528 4375  .replace_node(Cu
-00008870: 7443 6f64 652e 6672 6f6d 5f6c 6173 6572  tCode.from_laser
-00008880: 636f 6465 286e 6f64 652e 636f 6d6d 616e  code(node.comman
-00008890: 6473 292c 2074 7970 653d 2263 7574 636f  ds), type="cutco
-000088a0: 6465 2229 0d0a 0d0a 2020 2020 4074 7265  de")....    @tre
-000088b0: 655f 636f 6e64 6974 696f 6e61 6c5f 7472  e_conditional_tr
-000088c0: 7928 0d0a 2020 2020 2020 2020 6c61 6d62  y(..        lamb
-000088d0: 6461 206e 6f64 653a 206b 6572 6e65 6c2e  da node: kernel.
-000088e0: 6c6f 6f6b 7570 2866 2265 6d75 6c61 746f  lookup(f"emulato
-000088f0: 722f 7b6e 6f64 652e 6461 7461 5f74 7970  r/{node.data_typ
-00008900: 657d 2229 2069 7320 6e6f 7420 4e6f 6e65  e}") is not None
-00008910: 0d0a 2020 2020 290d 0a20 2020 2040 7472  ..    )..    @tr
-00008920: 6565 5f6f 7065 7261 7469 6f6e 280d 0a20  ee_operation(.. 
-00008930: 2020 2020 2020 205f 2822 436f 6e76 6572         _("Conver
-00008940: 7420 746f 2045 6c65 6d65 6e74 7322 292c  t to Elements"),
-00008950: 0d0a 2020 2020 2020 2020 6e6f 6465 5f74  ..        node_t
-00008960: 7970 653d 2262 6c6f 6222 2c0d 0a20 2020  ype="blob",..   
-00008970: 2020 2020 2068 656c 703d 5f28 2243 6f6e       help=_("Con
-00008980: 7665 7274 2061 7474 6163 6865 6420 6269  vert attached bi
-00008990: 6e61 7279 206f 626a 6563 7420 746f 2065  nary object to e
-000089a0: 6c65 6d65 6e74 7322 292c 0d0a 2020 2020  lements"),..    
-000089b0: 290d 0a20 2020 2064 6566 2062 6c6f 6232  )..    def blob2
-000089c0: 7061 7468 286e 6f64 652c 202a 2a6b 7761  path(node, **kwa
-000089d0: 7267 7329 3a0d 0a20 2020 2020 2020 2063  rgs):..        c
-000089e0: 616e 6365 6c6c 6564 203d 2046 616c 7365  ancelled = False
-000089f0: 0d0a 2020 2020 2020 2020 6672 6f6d 206d  ..        from m
-00008a00: 6565 726b 3430 742e 746f 6f6c 732e 6472  eerk40t.tools.dr
-00008a10: 6976 6572 5f74 6f5f 7061 7468 2069 6d70  iver_to_path imp
-00008a20: 6f72 7420 4472 6976 6572 546f 5061 7468  ort DriverToPath
-00008a30: 0d0a 0d0a 2020 2020 2020 2020 6432 7020  ....        d2p 
-00008a40: 3d20 4472 6976 6572 546f 5061 7468 2829  = DriverToPath()
-00008a50: 0d0a 2020 2020 2020 2020 6469 616c 6f67  ..        dialog
-00008a60: 5f63 6c61 7373 203d 206b 6572 6e65 6c2e  _class = kernel.
-00008a70: 6c6f 6f6b 7570 2822 6469 616c 6f67 2f6f  lookup("dialog/o
-00008a80: 7074 696f 6e73 2229 0d0a 2020 2020 2020  ptions")..      
-00008a90: 2020 6966 2064 6961 6c6f 675f 636c 6173    if dialog_clas
-00008aa0: 7320 616e 6420 6861 7361 7474 7228 6432  s and hasattr(d2
-00008ab0: 702c 2022 6f70 7469 6f6e 7322 293a 0d0a  p, "options"):..
-00008ac0: 2020 2020 2020 2020 2020 2020 6368 6f69              choi
-00008ad0: 6365 7320 3d20 6765 7461 7474 7228 6432  ces = getattr(d2
-00008ae0: 702c 2022 6f70 7469 6f6e 7322 2c20 4e6f  p, "options", No
-00008af0: 6e65 290d 0a20 2020 2020 2020 2020 2020  ne)..           
-00008b00: 2069 6620 6368 6f69 6365 7320 6973 206e   if choices is n
-00008b10: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-00008b20: 2020 2020 2020 2020 2020 666f 7220 656e            for en
-00008b30: 7472 7920 696e 2063 686f 6963 6573 3a0d  try in choices:.
-00008b40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008b50: 2020 2020 2069 6620 226c 6162 656c 2220       if "label" 
-00008b60: 696e 2065 6e74 7279 3a0d 0a20 2020 2020  in entry:..     
-00008b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008b80: 2020 2065 6e74 7279 5b22 6c61 6265 6c22     entry["label"
-00008b90: 5d20 3d20 5f28 656e 7472 795b 226c 6162  ] = _(entry["lab
-00008ba0: 656c 225d 290d 0a20 2020 2020 2020 2020  el"])..         
-00008bb0: 2020 2020 2020 2020 2020 2069 6620 2274             if "t
-00008bc0: 6970 2220 696e 2065 6e74 7279 3a0d 0a20  ip" in entry:.. 
-00008bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008be0: 2020 2020 2020 2065 6e74 7279 5b22 7469         entry["ti
-00008bf0: 7022 5d20 3d20 5f28 656e 7472 795b 2274  p"] = _(entry["t
-00008c00: 6970 225d 290d 0a20 2020 2020 2020 2020  ip"])..         
-00008c10: 2020 2020 2020 2020 2020 2069 6620 2264             if "d
-00008c20: 6973 706c 6179 2220 696e 2065 6e74 7279  isplay" in entry
-00008c30: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00008c40: 2020 2020 2020 2020 2020 206e 6577 6469             newdi
-00008c50: 7370 6c61 7920 3d20 5b5d 0d0a 2020 2020  splay = []..    
-00008c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008c70: 2020 2020 666f 7220 6465 6e74 7279 2069      for dentry i
-00008c80: 6e20 656e 7472 795b 2264 6973 706c 6179  n entry["display
-00008c90: 225d 3a0d 0a20 2020 2020 2020 2020 2020  "]:..           
-00008ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008cb0: 206e 6577 6469 7370 6c61 792e 6170 7065   newdisplay.appe
-00008cc0: 6e64 285f 2864 656e 7472 7929 290d 0a20  nd(_(dentry)).. 
-00008cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008ce0: 2020 2020 2020 2065 6e74 7279 5b22 6469         entry["di
-00008cf0: 7370 6c61 7922 5d20 3d20 6e65 7764 6973  splay"] = newdis
-00008d00: 706c 6179 0d0a 2020 2020 2020 2020 2020  play..          
-00008d10: 2020 2020 2020 6469 616c 6f67 203d 2064        dialog = d
-00008d20: 6961 6c6f 675f 636c 6173 7328 7365 6c66  ialog_class(self
-00008d30: 2e6b 6572 6e65 6c2c 2063 686f 6963 6573  .kernel, choices
-00008d40: 3d63 686f 6963 6573 290d 0a20 2020 2020  =choices)..     
-00008d50: 2020 2020 2020 2020 2020 2072 6573 203d             res =
-00008d60: 2064 6961 6c6f 672e 6469 616c 6f67 5f6f   dialog.dialog_o
-00008d70: 7074 696f 6e73 280d 0a20 2020 2020 2020  ptions(..       
-00008d80: 2020 2020 2020 2020 2020 2020 2074 6974               tit
-00008d90: 6c65 3d5f 2822 426c 6f62 2d43 6f6e 7665  le=_("Blob-Conve
-00008da0: 7273 696f 6e22 292c 0d0a 2020 2020 2020  rsion"),..      
-00008db0: 2020 2020 2020 2020 2020 2020 2020 696e                in
-00008dc0: 7472 6f3d 5f28 0d0a 2020 2020 2020 2020  tro=_(..        
-00008dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008de0: 2259 6f75 2063 616e 2069 6e66 6c75 656e  "You can influen
-00008df0: 6365 2074 6865 2077 6179 204d 4b20 7769  ce the way MK wi
-00008e00: 6c6c 2070 726f 6365 7373 2074 6865 2061  ll process the a
-00008e10: 7474 6163 6865 6420 6269 6e61 7279 2064  ttached binary d
-00008e20: 6174 613a 220d 0a20 2020 2020 2020 2020  ata:"..         
-00008e30: 2020 2020 2020 2020 2020 2029 2c0d 0a20             ),.. 
-00008e40: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00008e50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00008e60: 2020 6966 206e 6f74 2072 6573 3a0d 0a20    if not res:.. 
-00008e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008e80: 2020 2063 616e 6365 6c6c 6564 203d 2054     cancelled = T
-00008e90: 7275 650d 0a20 2020 2020 2020 2069 6620  rue..        if 
-00008ea0: 6e6f 7420 6361 6e63 656c 6c65 643a 0d0a  not cancelled:..
-00008eb0: 2020 2020 2020 2020 2020 2020 6432 702e              d2p.
-00008ec0: 7061 7273 6528 6e6f 6465 2e64 6174 615f  parse(node.data_
-00008ed0: 7479 7065 2c20 6e6f 6465 2e64 6174 612c  type, node.data,
-00008ee0: 2073 656c 6629 0d0a 2020 2020 2020 2020   self)..        
-00008ef0: 7265 7475 726e 2054 7275 650d 0a0d 0a20  return True.... 
-00008f00: 2020 2040 7472 6565 5f63 6f6e 6469 7469     @tree_conditi
-00008f10: 6f6e 616c 5f74 7279 286c 616d 6264 6120  onal_try(lambda 
-00008f20: 6e6f 6465 3a20 6861 7361 7474 7228 6e6f  node: hasattr(no
-00008f30: 6465 2c20 2261 735f 6375 746f 626a 6563  de, "as_cutobjec
-00008f40: 7473 2229 290d 0a20 2020 2040 7472 6565  ts"))..    @tree
-00008f50: 5f6f 7065 7261 7469 6f6e 280d 0a20 2020  _operation(..   
-00008f60: 2020 2020 205f 2822 436f 6e76 6572 7420       _("Convert 
-00008f70: 746f 2043 7574 636f 6465 2229 2c0d 0a20  to Cutcode"),.. 
-00008f80: 2020 2020 2020 206e 6f64 655f 7479 7065         node_type
-00008f90: 3d22 626c 6f62 222c 0d0a 2020 2020 2020  ="blob",..      
-00008fa0: 2020 6865 6c70 3d22 222c 0d0a 2020 2020    help="",..    
-00008fb0: 290d 0a20 2020 2064 6566 2062 6c6f 6232  )..    def blob2
-00008fc0: 6375 7428 6e6f 6465 2c20 2a2a 6b77 6172  cut(node, **kwar
-00008fd0: 6773 293a 0d0a 2020 2020 2020 2020 6e6f  gs):..        no
-00008fe0: 6465 2e72 6570 6c61 6365 5f6e 6f64 6528  de.replace_node(
-00008ff0: 6e6f 6465 2e61 735f 6375 746f 626a 6563  node.as_cutobjec
-00009000: 7473 2829 2c20 7479 7065 3d22 6375 7463  ts(), type="cutc
-00009010: 6f64 6522 290d 0a0d 0a20 2020 2040 7472  ode")....    @tr
-00009020: 6565 5f6f 7065 7261 7469 6f6e 280d 0a20  ee_operation(.. 
-00009030: 2020 2020 2020 205f 2822 436f 6e76 6572         _("Conver
-00009040: 7420 746f 2050 6174 6822 292c 0d0a 2020  t to Path"),..  
-00009050: 2020 2020 2020 6e6f 6465 5f74 7970 653d        node_type=
-00009060: 2263 7574 636f 6465 222c 0d0a 2020 2020  "cutcode",..    
-00009070: 2020 2020 6865 6c70 3d22 222c 0d0a 2020      help="",..  
-00009080: 2020 290d 0a20 2020 2064 6566 2063 7574    )..    def cut
-00009090: 636f 6465 3270 6174 6863 7574 286e 6f64  code2pathcut(nod
-000090a0: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
-000090b0: 2020 2020 2020 2063 7574 636f 6465 203d         cutcode =
-000090c0: 206e 6f64 652e 6375 7463 6f64 650d 0a20   node.cutcode.. 
-000090d0: 2020 2020 2020 2069 6620 6375 7463 6f64         if cutcod
-000090e0: 6520 6973 204e 6f6e 653a 0d0a 2020 2020  e is None:..    
-000090f0: 2020 2020 2020 2020 7265 7475 726e 0d0a          return..
-00009100: 2020 2020 2020 2020 656c 656d 656e 7473          elements
-00009110: 203d 206c 6973 7428 6375 7463 6f64 652e   = list(cutcode.
-00009120: 6173 5f65 6c65 6d65 6e74 7328 2929 0d0a  as_elements())..
-00009130: 2020 2020 2020 2020 6e20 3d20 4e6f 6e65          n = None
-00009140: 0d0a 2020 2020 2020 2020 666f 7220 656c  ..        for el
-00009150: 656d 656e 7420 696e 2065 6c65 6d65 6e74  ement in element
-00009160: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-00009170: 6e20 3d20 7365 6c66 2e65 6c65 6d5f 6272  n = self.elem_br
-00009180: 616e 6368 2e61 6464 2874 7970 653d 2265  anch.add(type="e
-00009190: 6c65 6d20 7061 7468 222c 2070 6174 683d  lem path", path=
-000091a0: 656c 656d 656e 7429 0d0a 2020 2020 2020  element)..      
-000091b0: 2020 6e6f 6465 2e72 656d 6f76 655f 6e6f    node.remove_no
-000091c0: 6465 2829 0d0a 2020 2020 2020 2020 6966  de()..        if
-000091d0: 206e 2069 7320 6e6f 7420 4e6f 6e65 3a0d   n is not None:.
-000091e0: 0a20 2020 2020 2020 2020 2020 206e 2e66  .            n.f
-000091f0: 6f63 7573 2829 0d0a 0d0a 2020 2020 4074  ocus()....    @t
-00009200: 7265 655f 7375 626d 656e 7528 5f28 2243  ree_submenu(_("C
-00009210: 6c6f 6e65 2072 6566 6572 656e 6365 2229  lone reference")
-00009220: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
-00009230: 7261 7469 6f6e 285f 2822 4d61 6b65 2031  ration(_("Make 1
-00009240: 2063 6f70 7922 292c 206e 6f64 655f 7479   copy"), node_ty
-00009250: 7065 3d28 2272 6566 6572 656e 6365 222c  pe=("reference",
-00009260: 292c 2068 656c 703d 2222 290d 0a20 2020  ), help="")..   
-00009270: 2064 6566 2063 6c6f 6e65 5f73 696e 676c   def clone_singl
-00009280: 655f 656c 656d 656e 745f 6f70 286e 6f64  e_element_op(nod
-00009290: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
-000092a0: 2020 2020 2020 2063 6c6f 6e65 5f65 6c65         clone_ele
-000092b0: 6d65 6e74 5f6f 7028 6e6f 6465 2c20 636f  ment_op(node, co
-000092c0: 7069 6573 3d31 2c20 2a2a 6b77 6172 6773  pies=1, **kwargs
-000092d0: 290d 0a0d 0a20 2020 2040 7472 6565 5f73  )....    @tree_s
-000092e0: 7562 6d65 6e75 285f 2822 436c 6f6e 6520  ubmenu(_("Clone 
-000092f0: 7265 6665 7265 6e63 6522 2929 0d0a 2020  reference"))..  
-00009300: 2020 4074 7265 655f 6974 6572 6174 6528    @tree_iterate(
-00009310: 2263 6f70 6965 7322 2c20 322c 2031 3029  "copies", 2, 10)
-00009320: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
-00009330: 6174 696f 6e28 5f28 224d 616b 6520 7b63  ation(_("Make {c
-00009340: 6f70 6965 737d 2063 6f70 6965 7322 292c  opies} copies"),
-00009350: 206e 6f64 655f 7479 7065 3d28 2272 6566   node_type=("ref
-00009360: 6572 656e 6365 222c 292c 2068 656c 703d  erence",), help=
-00009370: 2222 290d 0a20 2020 2064 6566 2063 6c6f  "")..    def clo
-00009380: 6e65 5f65 6c65 6d65 6e74 5f6f 7028 6e6f  ne_element_op(no
-00009390: 6465 2c20 636f 7069 6573 3d31 2c20 2a2a  de, copies=1, **
-000093a0: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
-000093b0: 2020 7769 7468 2073 656c 662e 7374 6174    with self.stat
-000093c0: 6963 2822 636c 6f6e 655f 656c 656d 5f6f  ic("clone_elem_o
-000093d0: 7022 293a 0d0a 2020 2020 2020 2020 2020  p"):..          
-000093e0: 2020 6e6f 6465 7320 3d20 6c69 7374 2873    nodes = list(s
-000093f0: 656c 662e 666c 6174 2873 656c 6563 7465  elf.flat(selecte
-00009400: 643d 5472 7565 2c20 6361 7363 6164 653d  d=True, cascade=
-00009410: 4661 6c73 652c 2074 7970 6573 3d22 7265  False, types="re
-00009420: 6665 7265 6e63 6522 2929 0d0a 2020 2020  ference"))..    
-00009430: 2020 2020 2020 2020 666f 7220 736e 6f64          for snod
-00009440: 6520 696e 206e 6f64 6573 3a0d 0a20 2020  e in nodes:..   
-00009450: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
-00009460: 6578 203d 2073 6e6f 6465 2e70 6172 656e  ex = snode.paren
-00009470: 742e 6368 696c 6472 656e 2e69 6e64 6578  t.children.index
-00009480: 2873 6e6f 6465 290d 0a20 2020 2020 2020  (snode)..       
-00009490: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
-000094a0: 6e20 7261 6e67 6528 636f 7069 6573 293a  n range(copies):
-000094b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000094c0: 2020 2020 2020 736e 6f64 652e 7061 7265        snode.pare
-000094d0: 6e74 2e61 6464 5f72 6566 6572 656e 6365  nt.add_reference
-000094e0: 2873 6e6f 6465 2e6e 6f64 652c 2070 6f73  (snode.node, pos
-000094f0: 3d69 6e64 6578 290d 0a20 2020 2020 2020  =index)..       
-00009500: 2020 2020 2020 2020 2073 6e6f 6465 2e6d           snode.m
-00009510: 6f64 6966 6965 6428 290d 0a0d 0a20 2020  odified()....   
-00009520: 2040 7472 6565 5f63 6f6e 6469 7469 6f6e   @tree_condition
-00009530: 616c 286c 616d 6264 6120 6e6f 6465 3a20  al(lambda node: 
-00009540: 6e6f 6465 2e63 6f75 6e74 5f63 6869 6c64  node.count_child
-00009550: 7265 6e28 2920 3e20 3129 0d0a 2020 2020  ren() > 1)..    
-00009560: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
-00009570: 0d0a 2020 2020 2020 2020 5f28 2252 6576  ..        _("Rev
-00009580: 6572 7365 2073 7562 6974 656d 7320 6f72  erse subitems or
-00009590: 6465 7222 292c 0d0a 2020 2020 2020 2020  der"),..        
-000095a0: 6e6f 6465 5f74 7970 653d 280d 0a20 2020  node_type=(..   
-000095b0: 2020 2020 2020 2020 2022 6f70 2063 7574           "op cut
-000095c0: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
-000095d0: 226f 7020 7261 7374 6572 222c 0d0a 2020  "op raster",..  
-000095e0: 2020 2020 2020 2020 2020 226f 7020 696d            "op im
-000095f0: 6167 6522 2c0d 0a20 2020 2020 2020 2020  age",..         
-00009600: 2020 2022 6f70 2065 6e67 7261 7665 222c     "op engrave",
-00009610: 0d0a 2020 2020 2020 2020 2020 2020 226f  ..            "o
-00009620: 7020 646f 7473 222c 0d0a 2020 2020 2020  p dots",..      
-00009630: 2020 2020 2020 226f 7020 6861 7463 6822        "op hatch"
-00009640: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
-00009650: 6772 6f75 7022 2c0d 0a20 2020 2020 2020  group",..       
-00009660: 2020 2020 2022 6272 616e 6368 2065 6c65       "branch ele
-00009670: 6d73 222c 0d0a 2020 2020 2020 2020 2020  ms",..          
-00009680: 2020 2266 696c 6522 2c0d 0a20 2020 2020    "file",..     
-00009690: 2020 2020 2020 2022 6272 616e 6368 206f         "branch o
-000096a0: 7073 222c 0d0a 2020 2020 2020 2020 292c  ps",..        ),
-000096b0: 0d0a 2020 2020 2020 2020 6865 6c70 3d5f  ..        help=_
-000096c0: 2822 5265 7665 7273 6520 7468 6520 6974  ("Reverse the it
-000096d0: 656d 7320 7769 7468 696e 2074 6869 7320  ems within this 
-000096e0: 7375 6269 7465 6d22 292c 0d0a 2020 2020  subitem"),..    
-000096f0: 290d 0a20 2020 2064 6566 2072 6576 6572  )..    def rever
-00009700: 7365 5f6c 6179 6572 5f6f 7264 6572 286e  se_layer_order(n
-00009710: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
-00009720: 0a20 2020 2020 2020 206e 6f64 652e 7265  .        node.re
-00009730: 7665 7273 6528 290d 0a20 2020 2020 2020  verse()..       
-00009740: 2073 656c 662e 7369 676e 616c 2822 7265   self.signal("re
-00009750: 6672 6573 685f 7472 6565 222c 206c 6973  fresh_tree", lis
-00009760: 7428 7365 6c66 2e66 6c61 7428 7479 7065  t(self.flat(type
-00009770: 733d 2272 6566 6572 656e 6365 2229 2929  s="reference")))
-00009780: 0d0a 0d0a 2020 2020 4074 7265 655f 7365  ....    @tree_se
-00009790: 7061 7261 746f 725f 6166 7465 7228 290d  parator_after().
-000097a0: 0a20 2020 2040 7472 6565 5f63 6f6e 6469  .    @tree_condi
-000097b0: 7469 6f6e 616c 286c 616d 6264 6120 6e6f  tional(lambda no
-000097c0: 6465 3a20 7365 6c66 2e63 6c61 7373 6966  de: self.classif
-000097d0: 795f 6175 746f 6765 6e65 7261 7465 290d  y_autogenerate).
-000097e0: 0a20 2020 2040 7472 6565 5f6f 7065 7261  .    @tree_opera
-000097f0: 7469 6f6e 280d 0a20 2020 2020 2020 205f  tion(..        _
-00009800: 2822 5265 6672 6573 6820 636c 6173 7369  ("Refresh classi
-00009810: 6669 6361 7469 6f6e 2229 2c0d 0a20 2020  fication"),..   
-00009820: 2020 2020 206e 6f64 655f 7479 7065 3d22       node_type="
-00009830: 6272 616e 6368 206f 7073 222c 0d0a 2020  branch ops",..  
-00009840: 2020 2020 2020 6865 6c70 3d5f 2822 5265        help=_("Re
-00009850: 636c 6173 7369 6679 2065 6c65 6d65 6e74  classify element
-00009860: 7320 616e 6420 6372 6561 7465 206f 7065  s and create ope
-00009870: 7261 7469 6f6e 7320 6966 206e 6563 6573  rations if neces
-00009880: 7361 7279 2229 2c0d 0a20 2020 2029 0d0a  sary"),..    )..
-00009890: 2020 2020 6465 6620 7265 6672 6573 685f      def refresh_
-000098a0: 636c 6173 6966 6963 6174 696f 6e73 5f31  clasifications_1
-000098b0: 286e 6f64 652c 202a 2a6b 7761 7267 7329  (node, **kwargs)
-000098c0: 3a0d 0a20 2020 2020 2020 2073 656c 662e  :..        self.
-000098d0: 7265 6d6f 7665 5f65 6c65 6d65 6e74 735f  remove_elements_
-000098e0: 6672 6f6d 5f6f 7065 7261 7469 6f6e 7328  from_operations(
-000098f0: 6c69 7374 2873 656c 662e 656c 656d 7328  list(self.elems(
-00009900: 2929 290d 0a20 2020 2020 2020 2073 656c  )))..        sel
-00009910: 662e 636c 6173 7369 6679 286c 6973 7428  f.classify(list(
-00009920: 7365 6c66 2e65 6c65 6d73 2829 2929 0d0a  self.elems()))..
-00009930: 2020 2020 2020 2020 7365 6c66 2e73 6967          self.sig
-00009940: 6e61 6c28 2272 6566 7265 7368 5f74 7265  nal("refresh_tre
-00009950: 6522 2c20 6c69 7374 2873 656c 662e 666c  e", list(self.fl
-00009960: 6174 2874 7970 6573 3d22 7265 6665 7265  at(types="refere
-00009970: 6e63 6522 2929 290d 0a0d 0a20 2020 2040  nce")))....    @
-00009980: 7472 6565 5f63 6f6e 6469 7469 6f6e 616c  tree_conditional
-00009990: 286c 616d 6264 6120 6e6f 6465 3a20 6e6f  (lambda node: no
-000099a0: 7420 7365 6c66 2e63 6c61 7373 6966 795f  t self.classify_
-000099b0: 6175 746f 6765 6e65 7261 7465 290d 0a20  autogenerate).. 
-000099c0: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
-000099d0: 6f6e 280d 0a20 2020 2020 2020 205f 2822  on(..        _("
-000099e0: 5265 6672 6573 6820 636c 6173 7369 6669  Refresh classifi
-000099f0: 6361 7469 6f6e 2229 2c0d 0a20 2020 2020  cation"),..     
-00009a00: 2020 206e 6f64 655f 7479 7065 3d22 6272     node_type="br
-00009a10: 616e 6368 206f 7073 222c 0d0a 2020 2020  anch ops",..    
-00009a20: 2020 2020 6865 6c70 3d5f 2822 5265 636c      help=_("Recl
-00009a30: 6173 7369 6679 2065 6c65 6d65 6e74 7320  assify elements 
-00009a40: 616e 6420 7573 6520 6f6e 6c79 2065 7869  and use only exi
-00009a50: 7374 696e 6720 6f70 6572 6174 696f 6e73  sting operations
-00009a60: 2229 2c0d 0a20 2020 2029 0d0a 2020 2020  "),..    )..    
-00009a70: 6465 6620 7265 6672 6573 685f 636c 6173  def refresh_clas
-00009a80: 6966 6963 6174 696f 6e73 5f32 286e 6f64  ifications_2(nod
-00009a90: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
-00009aa0: 2020 2020 2020 2073 656c 662e 7265 6d6f         self.remo
-00009ab0: 7665 5f65 6c65 6d65 6e74 735f 6672 6f6d  ve_elements_from
-00009ac0: 5f6f 7065 7261 7469 6f6e 7328 6c69 7374  _operations(list
-00009ad0: 2873 656c 662e 656c 656d 7328 2929 290d  (self.elems())).
-00009ae0: 0a20 2020 2020 2020 2073 656c 662e 636c  .        self.cl
-00009af0: 6173 7369 6679 286c 6973 7428 7365 6c66  assify(list(self
-00009b00: 2e65 6c65 6d73 2829 2929 0d0a 2020 2020  .elems()))..    
-00009b10: 2020 2020 7365 6c66 2e73 6967 6e61 6c28      self.signal(
-00009b20: 2272 6566 7265 7368 5f74 7265 6522 2c20  "refresh_tree", 
-00009b30: 6c69 7374 2873 656c 662e 666c 6174 2874  list(self.flat(t
-00009b40: 7970 6573 3d22 7265 6665 7265 6e63 6522  ypes="reference"
-00009b50: 2929 290d 0a0d 0a20 2020 2040 7472 6565  )))....    @tree
-00009b60: 5f73 6570 6172 6174 6f72 5f61 6674 6572  _separator_after
-00009b70: 2829 0d0a 2020 2020 4074 7265 655f 636f  ()..    @tree_co
-00009b80: 6e64 6974 696f 6e61 6c28 6c61 6d62 6461  nditional(lambda
-00009b90: 206e 6f64 653a 206e 6f74 2073 656c 662e   node: not self.
-00009ba0: 636c 6173 7369 6679 5f61 7574 6f67 656e  classify_autogen
-00009bb0: 6572 6174 6529 0d0a 2020 2020 4074 7265  erate)..    @tre
-00009bc0: 655f 6f70 6572 6174 696f 6e28 0d0a 2020  e_operation(..  
-00009bd0: 2020 2020 2020 5f28 2252 6566 7265 7368        _("Refresh
-00009be0: 202e 2e2e 2028 696e 636c 2061 7574 6f67   ... (incl autog
-00009bf0: 656e 6572 6174 696f 6e29 2229 2c0d 0a20  eneration)"),.. 
-00009c00: 2020 2020 2020 206e 6f64 655f 7479 7065         node_type
-00009c10: 3d22 6272 616e 6368 206f 7073 222c 0d0a  ="branch ops",..
-00009c20: 2020 2020 2020 2020 6865 6c70 3d5f 2822          help=_("
-00009c30: 5265 636c 6173 7369 6679 2065 6c65 6d65  Reclassify eleme
-00009c40: 6e74 7320 616e 6420 6372 6561 7465 206f  nts and create o
-00009c50: 7065 7261 7469 6f6e 7320 6966 206e 6563  perations if nec
-00009c60: 6573 7361 7279 2229 2c0d 0a20 2020 2029  essary"),..    )
-00009c70: 0d0a 2020 2020 6465 6620 7265 6672 6573  ..    def refres
-00009c80: 685f 636c 6173 6966 6963 6174 696f 6e73  h_clasifications
-00009c90: 5f33 286e 6f64 652c 202a 2a6b 7761 7267  _3(node, **kwarg
-00009ca0: 7329 3a0d 0a20 2020 2020 2020 2070 7265  s):..        pre
-00009cb0: 7669 6f75 7320 3d20 7365 6c66 2e63 6c61  vious = self.cla
-00009cc0: 7373 6966 795f 6175 746f 6765 6e65 7261  ssify_autogenera
-00009cd0: 7465 0d0a 2020 2020 2020 2020 7365 6c66  te..        self
-00009ce0: 2e63 6c61 7373 6966 795f 6175 746f 6765  .classify_autoge
-00009cf0: 6e65 7261 7465 203d 2054 7275 650d 0a20  nerate = True.. 
-00009d00: 2020 2020 2020 2073 656c 662e 7265 6d6f         self.remo
-00009d10: 7665 5f65 6c65 6d65 6e74 735f 6672 6f6d  ve_elements_from
-00009d20: 5f6f 7065 7261 7469 6f6e 7328 6c69 7374  _operations(list
-00009d30: 2873 656c 662e 656c 656d 7328 2929 290d  (self.elems())).
-00009d40: 0a20 2020 2020 2020 2073 656c 662e 636c  .        self.cl
-00009d50: 6173 7369 6679 286c 6973 7428 7365 6c66  assify(list(self
-00009d60: 2e65 6c65 6d73 2829 2929 0d0a 2020 2020  .elems()))..    
-00009d70: 2020 2020 7365 6c66 2e63 6c61 7373 6966      self.classif
-00009d80: 795f 6175 746f 6765 6e65 7261 7465 203d  y_autogenerate =
-00009d90: 2070 7265 7669 6f75 730d 0a20 2020 2020   previous..     
-00009da0: 2020 2073 656c 662e 7369 676e 616c 2822     self.signal("
-00009db0: 7265 6672 6573 685f 7472 6565 222c 206c  refresh_tree", l
-00009dc0: 6973 7428 7365 6c66 2e66 6c61 7428 7479  ist(self.flat(ty
-00009dd0: 7065 733d 2272 6566 6572 656e 6365 2229  pes="reference")
-00009de0: 2929 0d0a 0d0a 2020 2020 4074 7265 655f  ))....    @tree_
-00009df0: 636f 6e64 6974 696f 6e61 6c28 6c61 6d62  conditional(lamb
-00009e00: 6461 2063 6f6e 643a 2073 656c 662e 6861  da cond: self.ha
-00009e10: 7665 5f75 6e61 7373 6967 6e65 645f 656c  ve_unassigned_el
-00009e20: 656d 656e 7473 2829 290d 0a20 2020 2040  ements())..    @
-00009e30: 7472 6565 5f6f 7065 7261 7469 6f6e 280d  tree_operation(.
-00009e40: 0a20 2020 2020 2020 205f 2822 5365 6c65  .        _("Sele
-00009e50: 6374 2075 6e61 7373 6967 6e65 6420 656c  ct unassigned el
-00009e60: 656d 656e 7473 2229 2c0d 0a20 2020 2020  ements"),..     
-00009e70: 2020 206e 6f64 655f 7479 7065 3d22 6272     node_type="br
-00009e80: 616e 6368 206f 7073 222c 0d0a 2020 2020  anch ops",..    
-00009e90: 2020 2020 6865 6c70 3d5f 2822 5365 6c65      help=_("Sele
-00009ea0: 6374 2061 6c6c 2065 6c65 6d65 6e74 7320  ct all elements 
-00009eb0: 7468 6174 2077 6f6e 2774 2062 6520 6275  that won't be bu
-00009ec0: 726e 6564 2229 2c0d 0a20 2020 2029 0d0a  rned"),..    )..
-00009ed0: 2020 2020 6465 6620 7365 6c65 6374 5f75      def select_u
-00009ee0: 6e61 7373 6967 6e65 6428 6e6f 6465 2c20  nassigned(node, 
-00009ef0: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
-00009f00: 2020 2020 6368 616e 6765 7320 3d20 4661      changes = Fa
-00009f10: 6c73 650d 0a20 2020 2020 2020 2066 6f72  lse..        for
-00009f20: 206e 6f64 6520 696e 2073 656c 662e 656c   node in self.el
-00009f30: 656d 7328 293a 0d0a 2020 2020 2020 2020  ems():..        
-00009f40: 2020 2020 656d 7068 6173 6973 203d 2062      emphasis = b
-00009f50: 6f6f 6c28 6c65 6e28 6e6f 6465 2e72 6566  ool(len(node.ref
-00009f60: 6572 656e 6365 7329 203d 3d20 3029 0d0a  erences) == 0)..
-00009f70: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00009f80: 6f64 652e 656d 7068 6173 697a 6564 2021  ode.emphasized !
-00009f90: 3d20 656d 7068 6173 6973 3a0d 0a20 2020  = emphasis:..   
-00009fa0: 2020 2020 2020 2020 2020 2020 2063 6861               cha
-00009fb0: 6e67 6573 203d 2054 7275 650d 0a20 2020  nges = True..   
-00009fc0: 2020 2020 2020 2020 2020 2020 206e 6f64               nod
-00009fd0: 652e 656d 7068 6173 697a 6564 203d 2065  e.emphasized = e
-00009fe0: 6d70 6861 7369 730d 0a20 2020 2020 2020  mphasis..       
-00009ff0: 2069 6620 6368 616e 6765 733a 0d0a 2020   if changes:..  
-0000a000: 2020 2020 2020 2020 2020 7365 6c66 2e76            self.v
-0000a010: 616c 6964 6174 655f 7365 6c65 6374 6564  alidate_selected
-0000a020: 5f61 7265 6128 290d 0a20 2020 2020 2020  _area()..       
-0000a030: 2020 2020 2073 656c 662e 7369 676e 616c       self.signal
-0000a040: 2822 7265 6672 6573 685f 7363 656e 6522  ("refresh_scene"
-0000a050: 2c20 2253 6365 6e65 2229 0d0a 0d0a 2020  , "Scene")....  
-0000a060: 2020 6d61 7465 7269 616c 7320 3d20 5b0d    materials = [.
-0000a070: 0a20 2020 2020 2020 205f 2822 576f 6f64  .        _("Wood
-0000a080: 2229 2c0d 0a20 2020 2020 2020 205f 2822  "),..        _("
-0000a090: 4163 7279 6c69 6322 292c 0d0a 2020 2020  Acrylic"),..    
-0000a0a0: 2020 2020 5f28 2246 6f61 6d22 292c 0d0a      _("Foam"),..
-0000a0b0: 2020 2020 2020 2020 5f28 224c 6561 7468          _("Leath
-0000a0c0: 6572 2229 2c0d 0a20 2020 2020 2020 205f  er"),..        _
-0000a0d0: 2822 4361 7264 626f 6172 6422 292c 0d0a  ("Cardboard"),..
-0000a0e0: 2020 2020 2020 2020 5f28 2243 6f72 6b22          _("Cork"
-0000a0f0: 292c 0d0a 2020 2020 2020 2020 5f28 2254  ),..        _("T
-0000a100: 6578 7469 6c65 7322 292c 0d0a 2020 2020  extiles"),..    
-0000a110: 2020 2020 5f28 2250 6170 6572 2229 2c0d      _("Paper"),.
-0000a120: 0a20 2020 2020 2020 205f 2822 5361 7665  .        _("Save
-0000a130: 2d31 2229 2c0d 0a20 2020 2020 2020 205f  -1"),..        _
-0000a140: 2822 5361 7665 2d32 2229 2c0d 0a20 2020  ("Save-2"),..   
-0000a150: 2020 2020 205f 2822 5361 7665 2d33 2229       _("Save-3")
-0000a160: 2c0d 0a20 2020 205d 0d0a 0d0a 2020 2020  ,..    ]....    
-0000a170: 6465 6620 756e 696f 6e5f 6d61 7465 7269  def union_materi
-0000a180: 616c 735f 7361 7665 6428 293a 0d0a 2020  als_saved():..  
-0000a190: 2020 2020 2020 756e 696f 6e20 3d20 5b0d        union = [.
-0000a1a0: 0a20 2020 2020 2020 2020 2020 2064 0d0a  .            d..
-0000a1b0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0000a1c0: 6420 696e 2073 656c 662e 6f70 5f64 6174  d in self.op_dat
-0000a1d0: 612e 7365 6374 696f 6e5f 7365 7428 290d  a.section_set().
-0000a1e0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000a1f0: 6420 6e6f 7420 696e 206d 6174 6572 6961  d not in materia
-0000a200: 6c73 2061 6e64 2064 2021 3d20 2270 7265  ls and d != "pre
-0000a210: 7669 6f75 7322 0d0a 2020 2020 2020 2020  vious"..        
-0000a220: 5d0d 0a20 2020 2020 2020 2075 6e69 6f6e  ]..        union
-0000a230: 2e65 7874 656e 6428 6d61 7465 7269 616c  .extend(material
-0000a240: 7329 0d0a 2020 2020 2020 2020 7265 7475  s)..        retu
-0000a250: 726e 2075 6e69 6f6e 0d0a 0d0a 2020 2020  rn union....    
-0000a260: 6465 6620 6469 6666 6572 656e 6365 5f6d  def difference_m
-0000a270: 6174 6572 6961 6c73 5f73 6176 6564 2829  aterials_saved()
-0000a280: 3a0d 0a20 2020 2020 2020 2073 6563 7320  :..        secs 
-0000a290: 3d20 7365 6c66 2e6f 705f 6461 7461 2e73  = self.op_data.s
-0000a2a0: 6563 7469 6f6e 5f73 6574 2829 0d0a 2020  ection_set()..  
-0000a2b0: 2020 2020 2020 6469 6666 6572 656e 6365        difference
-0000a2c0: 203d 205b 6d20 666f 7220 6d20 696e 206d   = [m for m in m
-0000a2d0: 6174 6572 6961 6c73 2069 6620 6d20 6e6f  aterials if m no
-0000a2e0: 7420 696e 2073 6563 735d 0d0a 2020 2020  t in secs]..    
-0000a2f0: 2020 2020 7265 7475 726e 2064 6966 6665      return diffe
-0000a300: 7265 6e63 650d 0a0d 0a20 2020 2040 7472  rence....    @tr
-0000a310: 6565 5f73 7562 6d65 6e75 285f 2822 4c6f  ee_submenu(_("Lo
-0000a320: 6164 2229 290d 0a20 2020 2040 7472 6565  ad"))..    @tree
-0000a330: 5f76 616c 7565 7328 226f 706e 616d 6522  _values("opname"
-0000a340: 2c20 7661 6c75 6573 3d73 656c 662e 6f70  , values=self.op
-0000a350: 5f64 6174 612e 7365 6374 696f 6e5f 7365  _data.section_se
-0000a360: 7429 0d0a 2020 2020 4074 7265 655f 6f70  t)..    @tree_op
-0000a370: 6572 6174 696f 6e28 227b 6f70 6e61 6d65  eration("{opname
-0000a380: 7d22 2c20 6e6f 6465 5f74 7970 653d 2262  }", node_type="b
-0000a390: 7261 6e63 6820 6f70 7322 2c20 6865 6c70  ranch ops", help
-0000a3a0: 3d22 2229 0d0a 2020 2020 6465 6620 6c6f  ="")..    def lo
-0000a3b0: 6164 5f6f 7073 286e 6f64 652c 206f 706e  ad_ops(node, opn
-0000a3c0: 616d 652c 202a 2a6b 7761 7267 7329 3a0d  ame, **kwargs):.
-0000a3d0: 0a20 2020 2020 2020 2073 656c 6628 6622  .        self(f"
-0000a3e0: 6d61 7465 7269 616c 206c 6f61 6420 7b6f  material load {o
-0000a3f0: 706e 616d 657d 5c6e 2229 0d0a 0d0a 2020  pname}\n")....  
-0000a400: 2020 4074 7265 655f 7365 7061 7261 746f    @tree_separato
-0000a410: 725f 6265 666f 7265 2829 0d0a 2020 2020  r_before()..    
-0000a420: 4074 7265 655f 7375 626d 656e 7528 5f28  @tree_submenu(_(
-0000a430: 224c 6f61 6422 2929 0d0a 2020 2020 4074  "Load"))..    @t
-0000a440: 7265 655f 6f70 6572 6174 696f 6e28 5f28  ree_operation(_(
-0000a450: 224f 7468 6572 2f42 6c75 652f 5265 6422  "Other/Blue/Red"
-0000a460: 292c 206e 6f64 655f 7479 7065 3d22 6272  ), node_type="br
-0000a470: 616e 6368 206f 7073 222c 2068 656c 703d  anch ops", help=
-0000a480: 2222 290d 0a20 2020 2064 6566 2064 6566  "")..    def def
-0000a490: 6175 6c74 5f63 6c61 7373 6966 6963 6174  ault_classificat
-0000a4a0: 696f 6e73 286e 6f64 652c 202a 2a6b 7761  ions(node, **kwa
-0000a4b0: 7267 7329 3a0d 0a20 2020 2020 2020 2073  rgs):..        s
-0000a4c0: 656c 662e 6c6f 6164 5f64 6566 6175 6c74  elf.load_default
-0000a4d0: 2870 6572 666f 726d 636c 6173 7369 6679  (performclassify
-0000a4e0: 3d54 7275 6529 0d0a 0d0a 2020 2020 4074  =True)....    @t
-0000a4f0: 7265 655f 7375 626d 656e 7528 5f28 224c  ree_submenu(_("L
-0000a500: 6f61 6422 2929 0d0a 2020 2020 4074 7265  oad"))..    @tre
-0000a510: 655f 7365 7061 7261 746f 725f 6166 7465  e_separator_afte
-0000a520: 7228 290d 0a20 2020 2040 7472 6565 5f6f  r()..    @tree_o
-0000a530: 7065 7261 7469 6f6e 285f 2822 4261 7369  peration(_("Basi
-0000a540: 6322 292c 206e 6f64 655f 7479 7065 3d22  c"), node_type="
-0000a550: 6272 616e 6368 206f 7073 222c 2068 656c  branch ops", hel
-0000a560: 703d 2222 290d 0a20 2020 2064 6566 2062  p="")..    def b
-0000a570: 6173 6963 5f63 6c61 7373 6966 6963 6174  asic_classificat
-0000a580: 696f 6e73 286e 6f64 652c 202a 2a6b 7761  ions(node, **kwa
-0000a590: 7267 7329 3a0d 0a20 2020 2020 2020 2073  rgs):..        s
-0000a5a0: 656c 662e 6c6f 6164 5f64 6566 6175 6c74  elf.load_default
-0000a5b0: 3228 7065 7266 6f72 6d63 6c61 7373 6966  2(performclassif
-0000a5c0: 793d 5472 7565 290d 0a0d 0a20 2020 2040  y=True)....    @
-0000a5d0: 7472 6565 5f73 7562 6d65 6e75 285f 2822  tree_submenu(_("
-0000a5e0: 5361 7665 2229 290d 0a20 2020 2040 7472  Save"))..    @tr
-0000a5f0: 6565 5f76 616c 7565 7328 226f 706e 616d  ee_values("opnam
-0000a600: 6522 2c20 7661 6c75 6573 3d73 656c 662e  e", values=self.
-0000a610: 6f70 5f64 6174 612e 7365 6374 696f 6e5f  op_data.section_
-0000a620: 7365 7429 0d0a 2020 2020 4074 7265 655f  set)..    @tree_
-0000a630: 6f70 6572 6174 696f 6e28 227b 6f70 6e61  operation("{opna
-0000a640: 6d65 7d22 2c20 6e6f 6465 5f74 7970 653d  me}", node_type=
-0000a650: 2262 7261 6e63 6820 6f70 7322 2c20 6865  "branch ops", he
-0000a660: 6c70 3d22 2229 0d0a 2020 2020 6465 6620  lp="")..    def 
-0000a670: 7361 7665 5f6d 6174 6572 6961 6c73 286e  save_materials(n
-0000a680: 6f64 652c 206f 706e 616d 653d 2273 6176  ode, opname="sav
-0000a690: 6564 222c 202a 2a6b 7761 7267 7329 3a0d  ed", **kwargs):.
-0000a6a0: 0a20 2020 2020 2020 2073 656c 6628 6622  .        self(f"
-0000a6b0: 6d61 7465 7269 616c 2073 6176 6520 7b6f  material save {o
-0000a6c0: 706e 616d 657d 5c6e 2229 0d0a 0d0a 2020  pname}\n")....  
-0000a6d0: 2020 4074 7265 655f 7365 7061 7261 746f    @tree_separato
-0000a6e0: 725f 6265 666f 7265 2829 0d0a 2020 2020  r_before()..    
-0000a6f0: 4074 7265 655f 7375 626d 656e 7528 5f28  @tree_submenu(_(
-0000a700: 2253 6176 6522 2929 0d0a 2020 2020 4074  "Save"))..    @t
-0000a710: 7265 655f 7072 6f6d 7074 2822 6f70 6e61  ree_prompt("opna
-0000a720: 6d65 222c 205f 2822 4e61 6d65 2074 6f20  me", _("Name to 
-0000a730: 7374 6f72 6520 6375 7272 656e 7420 6f70  store current op
-0000a740: 6572 6174 696f 6e73 2075 6e64 6572 3f22  erations under?"
-0000a750: 2929 0d0a 2020 2020 4074 7265 655f 6f70  ))..    @tree_op
-0000a760: 6572 6174 696f 6e28 5f28 224e 6577 2229  eration(_("New")
-0000a770: 2c20 6e6f 6465 5f74 7970 653d 2262 7261  , node_type="bra
-0000a780: 6e63 6820 6f70 7322 2c20 6865 6c70 3d22  nch ops", help="
-0000a790: 2229 0d0a 2020 2020 6465 6620 7361 7665  ")..    def save
-0000a7a0: 5f6d 6174 6572 6961 6c5f 6375 7374 6f6d  _material_custom
-0000a7b0: 286e 6f64 652c 206f 706e 616d 652c 202a  (node, opname, *
-0000a7c0: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
-0000a7d0: 2020 2073 656c 6628 6622 6d61 7465 7269     self(f"materi
-0000a7e0: 616c 2073 6176 6520 7b6f 706e 616d 652e  al save {opname.
-0000a7f0: 7265 706c 6163 6528 2720 272c 2027 5f27  replace(' ', '_'
-0000a800: 297d 5c6e 2229 0d0a 0d0a 2020 2020 4074  )}\n")....    @t
-0000a810: 7265 655f 7375 626d 656e 7528 5f28 2244  ree_submenu(_("D
-0000a820: 656c 6574 6522 2929 0d0a 2020 2020 4074  elete"))..    @t
-0000a830: 7265 655f 7661 6c75 6573 2822 6f70 6e61  ree_values("opna
-0000a840: 6d65 222c 2076 616c 7565 733d 7365 6c66  me", values=self
-0000a850: 2e6f 705f 6461 7461 2e73 6563 7469 6f6e  .op_data.section
-0000a860: 5f73 6574 290d 0a20 2020 2040 7472 6565  _set)..    @tree
-0000a870: 5f6f 7065 7261 7469 6f6e 2822 7b6f 706e  _operation("{opn
-0000a880: 616d 657d 222c 206e 6f64 655f 7479 7065  ame}", node_type
-0000a890: 3d22 6272 616e 6368 206f 7073 222c 2068  ="branch ops", h
-0000a8a0: 656c 703d 2222 290d 0a20 2020 2064 6566  elp="")..    def
-0000a8b0: 2072 656d 6f76 655f 6f70 7328 6e6f 6465   remove_ops(node
-0000a8c0: 2c20 6f70 6e61 6d65 3d22 7361 7665 6422  , opname="saved"
-0000a8d0: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-0000a8e0: 2020 2020 2020 7365 6c66 2866 226d 6174        self(f"mat
-0000a8f0: 6572 6961 6c20 6465 6c65 7465 207b 6f70  erial delete {op
-0000a900: 6e61 6d65 7d5c 6e22 290d 0a0d 0a20 2020  name}\n")....   
-0000a910: 2040 7472 6565 5f73 6570 6172 6174 6f72   @tree_separator
-0000a920: 5f62 6566 6f72 6528 290d 0a20 2020 2040  _before()..    @
-0000a930: 7472 6565 5f73 7562 6d65 6e75 285f 2822  tree_submenu(_("
-0000a940: 4170 7065 6e64 206f 7065 7261 7469 6f6e  Append operation
-0000a950: 2229 290d 0a20 2020 2040 7472 6565 5f6f  "))..    @tree_o
-0000a960: 7065 7261 7469 6f6e 285f 2822 4170 7065  peration(_("Appe
-0000a970: 6e64 2049 6d61 6765 2229 2c20 6e6f 6465  nd Image"), node
-0000a980: 5f74 7970 653d 2262 7261 6e63 6820 6f70  _type="branch op
-0000a990: 7322 2c20 6865 6c70 3d22 2229 0d0a 2020  s", help="")..  
-0000a9a0: 2020 6465 6620 6170 7065 6e64 5f6f 7065    def append_ope
-0000a9b0: 7261 7469 6f6e 5f69 6d61 6765 286e 6f64  ration_image(nod
-0000a9c0: 652c 2070 6f73 3d4e 6f6e 652c 202a 2a6b  e, pos=None, **k
-0000a9d0: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
-0000a9e0: 2073 656c 662e 6f70 5f62 7261 6e63 682e   self.op_branch.
-0000a9f0: 6164 6428 226f 7020 696d 6167 6522 2c20  add("op image", 
-0000aa00: 706f 733d 706f 7329 0d0a 2020 2020 2020  pos=pos)..      
-0000aa10: 2020 7365 6c66 2e73 6967 6e61 6c28 2275    self.signal("u
-0000aa20: 7064 6174 656f 705f 7472 6565 2229 0d0a  pdateop_tree")..
-0000aa30: 0d0a 2020 2020 4074 7265 655f 7375 626d  ..    @tree_subm
-0000aa40: 656e 7528 5f28 2241 7070 656e 6420 6f70  enu(_("Append op
-0000aa50: 6572 6174 696f 6e22 2929 0d0a 2020 2020  eration"))..    
-0000aa60: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
-0000aa70: 5f28 2241 7070 656e 6420 5261 7374 6572  _("Append Raster
-0000aa80: 2229 2c20 6e6f 6465 5f74 7970 653d 2262  "), node_type="b
-0000aa90: 7261 6e63 6820 6f70 7322 2c20 6865 6c70  ranch ops", help
-0000aaa0: 3d22 2229 0d0a 2020 2020 6465 6620 6170  ="")..    def ap
-0000aab0: 7065 6e64 5f6f 7065 7261 7469 6f6e 5f72  pend_operation_r
-0000aac0: 6173 7465 7228 6e6f 6465 2c20 706f 733d  aster(node, pos=
-0000aad0: 4e6f 6e65 2c20 2a2a 6b77 6172 6773 293a  None, **kwargs):
-0000aae0: 0d0a 2020 2020 2020 2020 7365 6c66 2e6f  ..        self.o
-0000aaf0: 705f 6272 616e 6368 2e61 6464 2822 6f70  p_branch.add("op
-0000ab00: 2072 6173 7465 7222 2c20 706f 733d 706f   raster", pos=po
-0000ab10: 7329 0d0a 2020 2020 2020 2020 7365 6c66  s)..        self
-0000ab20: 2e73 6967 6e61 6c28 2275 7064 6174 656f  .signal("updateo
-0000ab30: 705f 7472 6565 2229 0d0a 0d0a 2020 2020  p_tree")....    
-0000ab40: 4074 7265 655f 7375 626d 656e 7528 5f28  @tree_submenu(_(
-0000ab50: 2241 7070 656e 6420 6f70 6572 6174 696f  "Append operatio
-0000ab60: 6e22 2929 0d0a 2020 2020 4074 7265 655f  n"))..    @tree_
-0000ab70: 6f70 6572 6174 696f 6e28 5f28 2241 7070  operation(_("App
-0000ab80: 656e 6420 456e 6772 6176 6522 292c 206e  end Engrave"), n
-0000ab90: 6f64 655f 7479 7065 3d22 6272 616e 6368  ode_type="branch
-0000aba0: 206f 7073 222c 2068 656c 703d 2222 290d   ops", help="").
-0000abb0: 0a20 2020 2064 6566 2061 7070 656e 645f  .    def append_
-0000abc0: 6f70 6572 6174 696f 6e5f 656e 6772 6176  operation_engrav
-0000abd0: 6528 6e6f 6465 2c20 706f 733d 4e6f 6e65  e(node, pos=None
-0000abe0: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-0000abf0: 2020 2020 2020 7365 6c66 2e6f 705f 6272        self.op_br
-0000ac00: 616e 6368 2e61 6464 2822 6f70 2065 6e67  anch.add("op eng
-0000ac10: 7261 7665 222c 2070 6f73 3d70 6f73 290d  rave", pos=pos).
-0000ac20: 0a20 2020 2020 2020 2073 656c 662e 7369  .        self.si
-0000ac30: 676e 616c 2822 7570 6461 7465 6f70 5f74  gnal("updateop_t
-0000ac40: 7265 6522 290d 0a0d 0a20 2020 2040 7472  ree")....    @tr
-0000ac50: 6565 5f73 7562 6d65 6e75 285f 2822 4170  ee_submenu(_("Ap
-0000ac60: 7065 6e64 206f 7065 7261 7469 6f6e 2229  pend operation")
-0000ac70: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
-0000ac80: 7261 7469 6f6e 285f 2822 4170 7065 6e64  ration(_("Append
-0000ac90: 2043 7574 2229 2c20 6e6f 6465 5f74 7970   Cut"), node_typ
-0000aca0: 653d 2262 7261 6e63 6820 6f70 7322 2c20  e="branch ops", 
-0000acb0: 6865 6c70 3d22 2229 0d0a 2020 2020 6465  help="")..    de
-0000acc0: 6620 6170 7065 6e64 5f6f 7065 7261 7469  f append_operati
-0000acd0: 6f6e 5f63 7574 286e 6f64 652c 2070 6f73  on_cut(node, pos
-0000ace0: 3d4e 6f6e 652c 202a 2a6b 7761 7267 7329  =None, **kwargs)
-0000acf0: 3a0d 0a20 2020 2020 2020 2073 656c 662e  :..        self.
-0000ad00: 6f70 5f62 7261 6e63 682e 6164 6428 226f  op_branch.add("o
-0000ad10: 7020 6375 7422 2c20 706f 733d 706f 7329  p cut", pos=pos)
-0000ad20: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
-0000ad30: 6967 6e61 6c28 2275 7064 6174 656f 705f  ignal("updateop_
-0000ad40: 7472 6565 2229 0d0a 0d0a 2020 2020 4074  tree")....    @t
-0000ad50: 7265 655f 7375 626d 656e 7528 5f28 2241  ree_submenu(_("A
-0000ad60: 7070 656e 6420 6f70 6572 6174 696f 6e22  ppend operation"
-0000ad70: 2929 0d0a 2020 2020 4074 7265 655f 6f70  ))..    @tree_op
-0000ad80: 6572 6174 696f 6e28 5f28 2241 7070 656e  eration(_("Appen
-0000ad90: 6420 4861 7463 6822 292c 206e 6f64 655f  d Hatch"), node_
-0000ada0: 7479 7065 3d22 6272 616e 6368 206f 7073  type="branch ops
-0000adb0: 222c 2068 656c 703d 2222 290d 0a20 2020  ", help="")..   
-0000adc0: 2064 6566 2061 7070 656e 645f 6f70 6572   def append_oper
-0000add0: 6174 696f 6e5f 6861 7463 6828 6e6f 6465  ation_hatch(node
-0000ade0: 2c20 706f 733d 4e6f 6e65 2c20 2a2a 6b77  , pos=None, **kw
-0000adf0: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
-0000ae00: 7365 6c66 2e6f 705f 6272 616e 6368 2e61  self.op_branch.a
-0000ae10: 6464 2822 6f70 2068 6174 6368 222c 2070  dd("op hatch", p
-0000ae20: 6f73 3d70 6f73 290d 0a20 2020 2020 2020  os=pos)..       
-0000ae30: 2073 656c 662e 7369 676e 616c 2822 7570   self.signal("up
-0000ae40: 6461 7465 6f70 5f74 7265 6522 290d 0a0d  dateop_tree")...
-0000ae50: 0a20 2020 2040 7472 6565 5f73 7562 6d65  .    @tree_subme
-0000ae60: 6e75 285f 2822 4170 7065 6e64 206f 7065  nu(_("Append ope
-0000ae70: 7261 7469 6f6e 2229 290d 0a20 2020 2040  ration"))..    @
-0000ae80: 7472 6565 5f6f 7065 7261 7469 6f6e 285f  tree_operation(_
-0000ae90: 2822 4170 7065 6e64 2044 6f74 7322 292c  ("Append Dots"),
-0000aea0: 206e 6f64 655f 7479 7065 3d22 6272 616e   node_type="bran
-0000aeb0: 6368 206f 7073 222c 2068 656c 703d 2222  ch ops", help=""
-0000aec0: 290d 0a20 2020 2064 6566 2061 7070 656e  )..    def appen
-0000aed0: 645f 6f70 6572 6174 696f 6e5f 646f 7473  d_operation_dots
-0000aee0: 286e 6f64 652c 2070 6f73 3d4e 6f6e 652c  (node, pos=None,
-0000aef0: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
-0000af00: 2020 2020 2073 656c 662e 6f70 5f62 7261       self.op_bra
-0000af10: 6e63 682e 6164 6428 226f 7020 646f 7473  nch.add("op dots
-0000af20: 222c 2070 6f73 3d70 6f73 290d 0a20 2020  ", pos=pos)..   
-0000af30: 2020 2020 2073 656c 662e 7369 676e 616c       self.signal
-0000af40: 2822 7570 6461 7465 6f70 5f74 7265 6522  ("updateop_tree"
-0000af50: 290d 0a0d 0a20 2020 2040 7472 6565 5f73  )....    @tree_s
-0000af60: 7562 6d65 6e75 285f 2822 4170 7065 6e64  ubmenu(_("Append
-0000af70: 2073 7065 6369 616c 206f 7065 7261 7469   special operati
-0000af80: 6f6e 2873 2922 2929 0d0a 2020 2020 4074  on(s)"))..    @t
-0000af90: 7265 655f 6f70 6572 6174 696f 6e28 5f28  ree_operation(_(
-0000afa0: 2241 7070 656e 6420 486f 6d65 2229 2c20  "Append Home"), 
-0000afb0: 6e6f 6465 5f74 7970 653d 2262 7261 6e63  node_type="branc
-0000afc0: 6820 6f70 7322 2c20 6865 6c70 3d22 2229  h ops", help="")
-0000afd0: 0d0a 2020 2020 6465 6620 6170 7065 6e64  ..    def append
-0000afe0: 5f6f 7065 7261 7469 6f6e 5f68 6f6d 6528  _operation_home(
-0000aff0: 6e6f 6465 2c20 706f 733d 4e6f 6e65 2c20  node, pos=None, 
-0000b000: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
-0000b010: 2020 2020 7365 6c66 2e6f 705f 6272 616e      self.op_bran
-0000b020: 6368 2e61 6464 2874 7970 653d 2275 7469  ch.add(type="uti
-0000b030: 6c20 686f 6d65 222c 2070 6f73 3d70 6f73  l home", pos=pos
-0000b040: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0000b050: 7369 676e 616c 2822 7570 6461 7465 6f70  signal("updateop
-0000b060: 5f74 7265 6522 290d 0a0d 0a20 2020 2040  _tree")....    @
-0000b070: 7472 6565 5f73 7562 6d65 6e75 285f 2822  tree_submenu(_("
-0000b080: 4170 7065 6e64 2073 7065 6369 616c 206f  Append special o
-0000b090: 7065 7261 7469 6f6e 2873 2922 2929 0d0a  peration(s)"))..
-0000b0a0: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
-0000b0b0: 696f 6e28 5f28 2241 7070 656e 6420 5265  ion(_("Append Re
-0000b0c0: 7475 726e 2074 6f20 4f72 6967 696e 2229  turn to Origin")
-0000b0d0: 2c20 6e6f 6465 5f74 7970 653d 2262 7261  , node_type="bra
-0000b0e0: 6e63 6820 6f70 7322 2c20 6865 6c70 3d22  nch ops", help="
-0000b0f0: 2229 0d0a 2020 2020 6465 6620 6170 7065  ")..    def appe
-0000b100: 6e64 5f6f 7065 7261 7469 6f6e 5f67 6f74  nd_operation_got
-0000b110: 6f28 6e6f 6465 2c20 706f 733d 4e6f 6e65  o(node, pos=None
-0000b120: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-0000b130: 2020 2020 2020 7365 6c66 2e6f 705f 6272        self.op_br
-0000b140: 616e 6368 2e61 6464 2874 7970 653d 2275  anch.add(type="u
-0000b150: 7469 6c20 676f 746f 222c 2070 6f73 3d70  til goto", pos=p
-0000b160: 6f73 2c20 783d 302c 2079 3d30 290d 0a20  os, x=0, y=0).. 
-0000b170: 2020 2020 2020 2073 656c 662e 7369 676e         self.sign
-0000b180: 616c 2822 7570 6461 7465 6f70 5f74 7265  al("updateop_tre
-0000b190: 6522 290d 0a0d 0a20 2020 2040 7472 6565  e")....    @tree
-0000b1a0: 5f73 7562 6d65 6e75 285f 2822 4170 7065  _submenu(_("Appe
-0000b1b0: 6e64 2073 7065 6369 616c 206f 7065 7261  nd special opera
-0000b1c0: 7469 6f6e 2873 2922 2929 0d0a 2020 2020  tion(s)"))..    
-0000b1d0: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
-0000b1e0: 0d0a 2020 2020 2020 2020 5f28 2241 7070  ..        _("App
-0000b1f0: 656e 6420 5365 7420 4f72 6967 696e 2229  end Set Origin")
-0000b200: 2c0d 0a20 2020 2020 2020 206e 6f64 655f  ,..        node_
-0000b210: 7479 7065 3d22 6272 616e 6368 206f 7073  type="branch ops
-0000b220: 222c 0d0a 2020 2020 2020 2020 6865 6c70  ",..        help
-0000b230: 3d22 222c 0d0a 2020 2020 290d 0a20 2020  ="",..    )..   
-0000b240: 2064 6566 2061 7070 656e 645f 6f70 6572   def append_oper
-0000b250: 6174 696f 6e5f 7365 746f 7269 6769 6e28  ation_setorigin(
-0000b260: 6e6f 6465 2c20 706f 733d 4e6f 6e65 2c20  node, pos=None, 
-0000b270: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
-0000b280: 2020 2020 7365 6c66 2e6f 705f 6272 616e      self.op_bran
-0000b290: 6368 2e61 6464 280d 0a20 2020 2020 2020  ch.add(..       
-0000b2a0: 2020 2020 2074 7970 653d 2275 7469 6c20       type="util 
-0000b2b0: 6f72 6967 696e 222c 0d0a 2020 2020 2020  origin",..      
-0000b2c0: 2020 2020 2020 706f 733d 706f 732c 0d0a        pos=pos,..
-0000b2d0: 2020 2020 2020 2020 2020 2020 783d 4e6f              x=No
-0000b2e0: 6e65 2c0d 0a20 2020 2020 2020 2020 2020  ne,..           
-0000b2f0: 2079 3d4e 6f6e 652c 0d0a 2020 2020 2020   y=None,..      
-0000b300: 2020 290d 0a20 2020 2020 2020 2073 656c    )..        sel
-0000b310: 662e 7369 676e 616c 2822 7570 6461 7465  f.signal("update
-0000b320: 6f70 5f74 7265 6522 290d 0a0d 0a20 2020  op_tree")....   
-0000b330: 2040 7472 6565 5f73 7562 6d65 6e75 285f   @tree_submenu(_
-0000b340: 2822 4170 7065 6e64 2073 7065 6369 616c  ("Append special
-0000b350: 206f 7065 7261 7469 6f6e 2873 2922 2929   operation(s)"))
-0000b360: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
-0000b370: 6174 696f 6e28 5f28 2241 7070 656e 6420  ation(_("Append 
-0000b380: 4265 6570 2229 2c20 6e6f 6465 5f74 7970  Beep"), node_typ
-0000b390: 653d 2262 7261 6e63 6820 6f70 7322 2c20  e="branch ops", 
-0000b3a0: 6865 6c70 3d22 2229 0d0a 2020 2020 6465  help="")..    de
-0000b3b0: 6620 6170 7065 6e64 5f6f 7065 7261 7469  f append_operati
-0000b3c0: 6f6e 5f62 6565 7028 6e6f 6465 2c20 706f  on_beep(node, po
-0000b3d0: 733d 4e6f 6e65 2c20 2a2a 6b77 6172 6773  s=None, **kwargs
-0000b3e0: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
-0000b3f0: 2e6f 705f 6272 616e 6368 2e61 6464 280d  .op_branch.add(.
-0000b400: 0a20 2020 2020 2020 2020 2020 2074 7970  .            typ
-0000b410: 653d 2275 7469 6c20 636f 6e73 6f6c 6522  e="util console"
-0000b420: 2c0d 0a20 2020 2020 2020 2020 2020 2070  ,..            p
-0000b430: 6f73 3d70 6f73 2c0d 0a20 2020 2020 2020  os=pos,..       
-0000b440: 2020 2020 2063 6f6d 6d61 6e64 3d22 6265       command="be
-0000b450: 6570 222c 0d0a 2020 2020 2020 2020 290d  ep",..        ).
-0000b460: 0a20 2020 2020 2020 2073 656c 662e 7369  .        self.si
-0000b470: 676e 616c 2822 7570 6461 7465 6f70 5f74  gnal("updateop_t
-0000b480: 7265 6522 290d 0a0d 0a20 2020 2040 7472  ree")....    @tr
-0000b490: 6565 5f73 7562 6d65 6e75 285f 2822 4170  ee_submenu(_("Ap
-0000b4a0: 7065 6e64 2073 7065 6369 616c 206f 7065  pend special ope
-0000b4b0: 7261 7469 6f6e 2873 2922 2929 0d0a 2020  ration(s)"))..  
-0000b4c0: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
-0000b4d0: 6e28 5f28 2241 7070 656e 6420 496e 7465  n(_("Append Inte
-0000b4e0: 7272 7570 7422 292c 206e 6f64 655f 7479  rrupt"), node_ty
-0000b4f0: 7065 3d22 6272 616e 6368 206f 7073 222c  pe="branch ops",
-0000b500: 2068 656c 703d 2222 290d 0a20 2020 2064   help="")..    d
-0000b510: 6566 2061 7070 656e 645f 6f70 6572 6174  ef append_operat
-0000b520: 696f 6e5f 696e 7465 7272 7570 7428 6e6f  ion_interrupt(no
-0000b530: 6465 2c20 706f 733d 4e6f 6e65 2c20 2a2a  de, pos=None, **
-0000b540: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
-0000b550: 2020 7365 6c66 2e6f 705f 6272 616e 6368    self.op_branch
-0000b560: 2e61 6464 280d 0a20 2020 2020 2020 2020  .add(..         
-0000b570: 2020 2074 7970 653d 2275 7469 6c20 636f     type="util co
-0000b580: 6e73 6f6c 6522 2c0d 0a20 2020 2020 2020  nsole",..       
-0000b590: 2020 2020 2070 6f73 3d70 6f73 2c0d 0a20       pos=pos,.. 
-0000b5a0: 2020 2020 2020 2020 2020 2063 6f6d 6d61             comma
-0000b5b0: 6e64 3d27 696e 7465 7272 7570 7420 2253  nd='interrupt "S
-0000b5c0: 706f 6f6c 696e 6720 7761 7320 696e 7465  pooling was inte
-0000b5d0: 7272 7570 7465 6422 272c 0d0a 2020 2020  rrupted"',..    
-0000b5e0: 2020 2020 290d 0a20 2020 2020 2020 2073      )..        s
-0000b5f0: 656c 662e 7369 676e 616c 2822 7570 6461  elf.signal("upda
-0000b600: 7465 6f70 5f74 7265 6522 290d 0a0d 0a20  teop_tree").... 
-0000b610: 2020 2040 7472 6565 5f73 7562 6d65 6e75     @tree_submenu
-0000b620: 285f 2822 4170 7065 6e64 2073 7065 6369  (_("Append speci
-0000b630: 616c 206f 7065 7261 7469 6f6e 2873 2922  al operation(s)"
-0000b640: 2929 0d0a 2020 2020 4074 7265 655f 7072  ))..    @tree_pr
-0000b650: 6f6d 7074 2822 7761 6974 5f74 696d 6522  ompt("wait_time"
-0000b660: 2c20 5f28 2257 6169 7420 666f 7220 686f  , _("Wait for ho
-0000b670: 7720 6c6f 6e67 2028 696e 2073 6563 6f6e  w long (in secon
-0000b680: 6473 293f 2229 2c20 6461 7461 5f74 7970  ds)?"), data_typ
-0000b690: 653d 666c 6f61 7429 0d0a 2020 2020 4074  e=float)..    @t
-0000b6a0: 7265 655f 6f70 6572 6174 696f 6e28 5f28  ree_operation(_(
-0000b6b0: 2241 7070 656e 6420 5761 6974 2229 2c20  "Append Wait"), 
-0000b6c0: 6e6f 6465 5f74 7970 653d 2262 7261 6e63  node_type="branc
-0000b6d0: 6820 6f70 7322 2c20 6865 6c70 3d22 2229  h ops", help="")
-0000b6e0: 0d0a 2020 2020 6465 6620 6170 7065 6e64  ..    def append
-0000b6f0: 5f6f 7065 7261 7469 6f6e 5f77 6169 7428  _operation_wait(
-0000b700: 6e6f 6465 2c20 7761 6974 5f74 696d 652c  node, wait_time,
-0000b710: 2070 6f73 3d4e 6f6e 652c 202a 2a6b 7761   pos=None, **kwa
-0000b720: 7267 7329 3a0d 0a20 2020 2020 2020 2073  rgs):..        s
-0000b730: 656c 662e 6f70 5f62 7261 6e63 682e 6164  elf.op_branch.ad
-0000b740: 6428 0d0a 2020 2020 2020 2020 2020 2020  d(..            
-0000b750: 7479 7065 3d22 7574 696c 2077 6169 7422  type="util wait"
-0000b760: 2c0d 0a20 2020 2020 2020 2020 2020 2070  ,..            p
-0000b770: 6f73 3d70 6f73 2c0d 0a20 2020 2020 2020  os=pos,..       
-0000b780: 2020 2020 2077 6169 743d 7761 6974 5f74       wait=wait_t
-0000b790: 696d 652c 0d0a 2020 2020 2020 2020 290d  ime,..        ).
-0000b7a0: 0a20 2020 2020 2020 2073 656c 662e 7369  .        self.si
-0000b7b0: 676e 616c 2822 7570 6461 7465 6f70 5f74  gnal("updateop_t
-0000b7c0: 7265 6522 290d 0a0d 0a20 2020 2040 7472  ree")....    @tr
-0000b7d0: 6565 5f73 7562 6d65 6e75 285f 2822 4170  ee_submenu(_("Ap
-0000b7e0: 7065 6e64 2073 7065 6369 616c 206f 7065  pend special ope
-0000b7f0: 7261 7469 6f6e 2873 2922 2929 0d0a 2020  ration(s)"))..  
-0000b800: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
-0000b810: 6e28 5f28 2241 7070 656e 6420 4f75 7470  n(_("Append Outp
-0000b820: 7574 2229 2c20 6e6f 6465 5f74 7970 653d  ut"), node_type=
-0000b830: 2262 7261 6e63 6820 6f70 7322 2c20 6865  "branch ops", he
-0000b840: 6c70 3d22 2229 0d0a 2020 2020 6465 6620  lp="")..    def 
-0000b850: 6170 7065 6e64 5f6f 7065 7261 7469 6f6e  append_operation
-0000b860: 5f6f 7574 7075 7428 6e6f 6465 2c20 706f  _output(node, po
-0000b870: 733d 4e6f 6e65 2c20 2a2a 6b77 6172 6773  s=None, **kwargs
-0000b880: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
-0000b890: 2e6f 705f 6272 616e 6368 2e61 6464 280d  .op_branch.add(.
-0000b8a0: 0a20 2020 2020 2020 2020 2020 2074 7970  .            typ
-0000b8b0: 653d 2275 7469 6c20 6f75 7470 7574 222c  e="util output",
-0000b8c0: 0d0a 2020 2020 2020 2020 2020 2020 706f  ..            po
-0000b8d0: 733d 706f 732c 0d0a 2020 2020 2020 2020  s=pos,..        
-0000b8e0: 2020 2020 6f75 7470 7574 5f6d 6173 6b3d      output_mask=
-0000b8f0: 302c 0d0a 2020 2020 2020 2020 2020 2020  0,..            
-0000b900: 6f75 7470 7574 5f76 616c 7565 3d30 2c0d  output_value=0,.
-0000b910: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
-0000b920: 7075 745f 6d65 7373 6167 653d 4e6f 6e65  put_message=None
-0000b930: 2c0d 0a20 2020 2020 2020 2029 0d0a 2020  ,..        )..  
-0000b940: 2020 2020 2020 7365 6c66 2e73 6967 6e61        self.signa
-0000b950: 6c28 2275 7064 6174 656f 705f 7472 6565  l("updateop_tree
-0000b960: 2229 0d0a 0d0a 2020 2020 4074 7265 655f  ")....    @tree_
-0000b970: 7375 626d 656e 7528 5f28 2241 7070 656e  submenu(_("Appen
-0000b980: 6420 7370 6563 6961 6c20 6f70 6572 6174  d special operat
-0000b990: 696f 6e28 7329 2229 290d 0a20 2020 2040  ion(s)"))..    @
-0000b9a0: 7472 6565 5f6f 7065 7261 7469 6f6e 285f  tree_operation(_
-0000b9b0: 2822 4170 7065 6e64 2049 6e70 7574 2229  ("Append Input")
-0000b9c0: 2c20 6e6f 6465 5f74 7970 653d 2262 7261  , node_type="bra
-0000b9d0: 6e63 6820 6f70 7322 2c20 6865 6c70 3d22  nch ops", help="
-0000b9e0: 2229 0d0a 2020 2020 6465 6620 6170 7065  ")..    def appe
-0000b9f0: 6e64 5f6f 7065 7261 7469 6f6e 5f69 6e70  nd_operation_inp
-0000ba00: 7574 286e 6f64 652c 2070 6f73 3d4e 6f6e  ut(node, pos=Non
-0000ba10: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
-0000ba20: 2020 2020 2020 2073 656c 662e 6f70 5f62         self.op_b
-0000ba30: 7261 6e63 682e 6164 6428 0d0a 2020 2020  ranch.add(..    
-0000ba40: 2020 2020 2020 2020 7479 7065 3d22 7574          type="ut
-0000ba50: 696c 2069 6e70 7574 222c 0d0a 2020 2020  il input",..    
-0000ba60: 2020 2020 2020 2020 706f 733d 706f 732c          pos=pos,
-0000ba70: 0d0a 2020 2020 2020 2020 2020 2020 696e  ..            in
-0000ba80: 7075 745f 6d61 736b 3d30 2c0d 0a20 2020  put_mask=0,..   
-0000ba90: 2020 2020 2020 2020 2069 6e70 7574 5f76           input_v
-0000baa0: 616c 7565 3d30 2c0d 0a20 2020 2020 2020  alue=0,..       
-0000bab0: 2020 2020 2069 6e70 7574 5f6d 6573 7361       input_messa
-0000bac0: 6765 3d4e 6f6e 652c 0d0a 2020 2020 2020  ge=None,..      
-0000bad0: 2020 290d 0a20 2020 2020 2020 2073 656c    )..        sel
-0000bae0: 662e 7369 676e 616c 2822 7570 6461 7465  f.signal("update
-0000baf0: 6f70 5f74 7265 6522 290d 0a0d 0a20 2020  op_tree")....   
-0000bb00: 2040 7472 6565 5f73 7562 6d65 6e75 285f   @tree_submenu(_
-0000bb10: 2822 4170 7065 6e64 2073 7065 6369 616c  ("Append special
-0000bb20: 206f 7065 7261 7469 6f6e 2873 2922 2929   operation(s)"))
-0000bb30: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
-0000bb40: 6174 696f 6e28 5f28 2241 7070 656e 6420  ation(_("Append 
-0000bb50: 486f 6d65 2f42 6565 702f 496e 7465 7272  Home/Beep/Interr
-0000bb60: 7570 7422 292c 206e 6f64 655f 7479 7065  upt"), node_type
-0000bb70: 3d22 6272 616e 6368 206f 7073 222c 2068  ="branch ops", h
-0000bb80: 656c 703d 2222 290d 0a20 2020 2064 6566  elp="")..    def
-0000bb90: 2061 7070 656e 645f 6f70 6572 6174 696f   append_operatio
-0000bba0: 6e5f 686f 6d65 5f62 6565 705f 696e 7465  n_home_beep_inte
-0000bbb0: 7272 7570 7428 6e6f 6465 2c20 2a2a 6b77  rrupt(node, **kw
-0000bbc0: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
-0000bbd0: 6170 7065 6e64 5f6f 7065 7261 7469 6f6e  append_operation
-0000bbe0: 5f68 6f6d 6528 6e6f 6465 2c20 2a2a 6b77  _home(node, **kw
-0000bbf0: 6172 6773 290d 0a20 2020 2020 2020 2061  args)..        a
-0000bc00: 7070 656e 645f 6f70 6572 6174 696f 6e5f  ppend_operation_
-0000bc10: 6265 6570 286e 6f64 652c 202a 2a6b 7761  beep(node, **kwa
-0000bc20: 7267 7329 0d0a 2020 2020 2020 2020 6170  rgs)..        ap
-0000bc30: 7065 6e64 5f6f 7065 7261 7469 6f6e 5f69  pend_operation_i
-0000bc40: 6e74 6572 7275 7074 286e 6f64 652c 202a  nterrupt(node, *
-0000bc50: 2a6b 7761 7267 7329 0d0a 2020 2020 2020  *kwargs)..      
-0000bc60: 2020 7365 6c66 2e73 6967 6e61 6c28 2275    self.signal("u
-0000bc70: 7064 6174 656f 705f 7472 6565 2229 0d0a  pdateop_tree")..
-0000bc80: 0d0a 2020 2020 4074 7265 655f 7375 626d  ..    @tree_subm
-0000bc90: 656e 7528 5f28 2241 7070 656e 6420 7370  enu(_("Append sp
-0000bca0: 6563 6961 6c20 6f70 6572 6174 696f 6e28  ecial operation(
-0000bcb0: 7329 2229 290d 0a20 2020 2040 7472 6565  s)"))..    @tree
-0000bcc0: 5f6f 7065 7261 7469 6f6e 285f 2822 4170  _operation(_("Ap
-0000bcd0: 7065 6e64 204f 7269 6769 6e2f 4265 6570  pend Origin/Beep
-0000bce0: 2f49 6e74 6572 7275 7074 2229 2c20 6e6f  /Interrupt"), no
-0000bcf0: 6465 5f74 7970 653d 2262 7261 6e63 6820  de_type="branch 
-0000bd00: 6f70 7322 2c20 6865 6c70 3d22 2229 0d0a  ops", help="")..
-0000bd10: 2020 2020 6465 6620 6170 7065 6e64 5f6f      def append_o
-0000bd20: 7065 7261 7469 6f6e 5f6f 7269 6769 6e5f  peration_origin_
-0000bd30: 6265 6570 5f69 6e74 6572 7275 7074 286e  beep_interrupt(n
-0000bd40: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
-0000bd50: 0a20 2020 2020 2020 2061 7070 656e 645f  .        append_
-0000bd60: 6f70 6572 6174 696f 6e5f 676f 746f 286e  operation_goto(n
-0000bd70: 6f64 652c 202a 2a6b 7761 7267 7329 0d0a  ode, **kwargs)..
-0000bd80: 2020 2020 2020 2020 6170 7065 6e64 5f6f          append_o
-0000bd90: 7065 7261 7469 6f6e 5f62 6565 7028 6e6f  peration_beep(no
-0000bda0: 6465 2c20 2a2a 6b77 6172 6773 290d 0a20  de, **kwargs).. 
-0000bdb0: 2020 2020 2020 2061 7070 656e 645f 6f70         append_op
-0000bdc0: 6572 6174 696f 6e5f 696e 7465 7272 7570  eration_interrup
-0000bdd0: 7428 6e6f 6465 2c20 2a2a 6b77 6172 6773  t(node, **kwargs
-0000bde0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0000bdf0: 7369 676e 616c 2822 7570 6461 7465 6f70  signal("updateop
-0000be00: 5f74 7265 6522 290d 0a0d 0a20 2020 2040  _tree")....    @
-0000be10: 7472 6565 5f73 7562 6d65 6e75 285f 2822  tree_submenu(_("
-0000be20: 4170 7065 6e64 2073 7065 6369 616c 206f  Append special o
-0000be30: 7065 7261 7469 6f6e 2873 2922 2929 0d0a  peration(s)"))..
-0000be40: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
-0000be50: 696f 6e28 5f28 2241 7070 656e 6420 5368  ion(_("Append Sh
-0000be60: 7574 646f 776e 2229 2c20 6e6f 6465 5f74  utdown"), node_t
-0000be70: 7970 653d 2262 7261 6e63 6820 6f70 7322  ype="branch ops"
-0000be80: 2c20 6865 6c70 3d22 2229 0d0a 2020 2020  , help="")..    
-0000be90: 6465 6620 6170 7065 6e64 5f6f 7065 7261  def append_opera
-0000bea0: 7469 6f6e 5f73 6875 7464 6f77 6e28 6e6f  tion_shutdown(no
-0000beb0: 6465 2c20 706f 733d 4e6f 6e65 2c20 2a2a  de, pos=None, **
-0000bec0: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
-0000bed0: 2020 7365 6c66 2e6f 705f 6272 616e 6368    self.op_branch
-0000bee0: 2e61 6464 280d 0a20 2020 2020 2020 2020  .add(..         
-0000bef0: 2020 2074 7970 653d 2275 7469 6c20 636f     type="util co
-0000bf00: 6e73 6f6c 6522 2c0d 0a20 2020 2020 2020  nsole",..       
-0000bf10: 2020 2020 2070 6f73 3d70 6f73 2c0d 0a20       pos=pos,.. 
-0000bf20: 2020 2020 2020 2020 2020 2063 6f6d 6d61             comma
-0000bf30: 6e64 3d22 7175 6974 222c 0d0a 2020 2020  nd="quit",..    
-0000bf40: 2020 2020 290d 0a20 2020 2020 2020 2073      )..        s
-0000bf50: 656c 662e 7369 676e 616c 2822 7570 6461  elf.signal("upda
-0000bf60: 7465 6f70 5f74 7265 6522 290d 0a0d 0a20  teop_tree").... 
-0000bf70: 2020 2040 7472 6565 5f73 7562 6d65 6e75     @tree_submenu
-0000bf80: 285f 2822 4170 7065 6e64 2073 7065 6369  (_("Append speci
-0000bf90: 616c 206f 7065 7261 7469 6f6e 2873 2922  al operation(s)"
-0000bfa0: 2929 0d0a 2020 2020 4074 7265 655f 7072  ))..    @tree_pr
-0000bfb0: 6f6d 7074 2822 6f70 6e61 6d65 222c 205f  ompt("opname", _
-0000bfc0: 2822 436f 6e73 6f6c 6520 636f 6d6d 616e  ("Console comman
-0000bfd0: 6420 746f 2061 7070 656e 6420 746f 206f  d to append to o
-0000bfe0: 7065 7261 7469 6f6e 733f 2229 290d 0a20  perations?")).. 
-0000bff0: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
-0000c000: 6f6e 285f 2822 4170 7065 6e64 2043 6f6e  on(_("Append Con
-0000c010: 736f 6c65 2229 2c20 6e6f 6465 5f74 7970  sole"), node_typ
-0000c020: 653d 2262 7261 6e63 6820 6f70 7322 2c20  e="branch ops", 
-0000c030: 6865 6c70 3d22 2229 0d0a 2020 2020 6465  help="")..    de
-0000c040: 6620 6170 7065 6e64 5f6f 7065 7261 7469  f append_operati
-0000c050: 6f6e 5f63 7573 746f 6d28 6e6f 6465 2c20  on_custom(node, 
-0000c060: 6f70 6e61 6d65 2c20 706f 733d 4e6f 6e65  opname, pos=None
-0000c070: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-0000c080: 2020 2020 2020 7365 6c66 2e6f 705f 6272        self.op_br
-0000c090: 616e 6368 2e61 6464 280d 0a20 2020 2020  anch.add(..     
-0000c0a0: 2020 2020 2020 2074 7970 653d 2275 7469         type="uti
-0000c0b0: 6c20 636f 6e73 6f6c 6522 2c0d 0a20 2020  l console",..   
-0000c0c0: 2020 2020 2020 2020 2070 6f73 3d70 6f73           pos=pos
-0000c0d0: 2c0d 0a20 2020 2020 2020 2020 2020 2063  ,..            c
-0000c0e0: 6f6d 6d61 6e64 3d6f 706e 616d 652c 0d0a  ommand=opname,..
-0000c0f0: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-0000c100: 2020 2073 656c 662e 7369 676e 616c 2822     self.signal("
-0000c110: 7570 6461 7465 6f70 5f74 7265 6522 290d  updateop_tree").
-0000c120: 0a0d 0a20 2020 2040 7472 6565 5f6f 7065  ...    @tree_ope
-0000c130: 7261 7469 6f6e 285f 2822 5265 636c 6173  ration(_("Reclas
-0000c140: 7369 6679 206f 7065 7261 7469 6f6e 7322  sify operations"
-0000c150: 292c 206e 6f64 655f 7479 7065 3d22 6272  ), node_type="br
-0000c160: 616e 6368 2065 6c65 6d73 222c 2068 656c  anch elems", hel
-0000c170: 703d 2222 290d 0a20 2020 2064 6566 2072  p="")..    def r
-0000c180: 6563 6c61 7373 6966 795f 6f70 6572 6174  eclassify_operat
-0000c190: 696f 6e73 286e 6f64 652c 202a 2a6b 7761  ions(node, **kwa
-0000c1a0: 7267 7329 3a0d 0a20 2020 2020 2020 2065  rgs):..        e
-0000c1b0: 6c65 6d73 203d 206c 6973 7428 7365 6c66  lems = list(self
-0000c1c0: 2e65 6c65 6d73 2829 290d 0a20 2020 2020  .elems())..     
-0000c1d0: 2020 2073 656c 662e 7265 6d6f 7665 5f65     self.remove_e
-0000c1e0: 6c65 6d65 6e74 735f 6672 6f6d 5f6f 7065  lements_from_ope
-0000c1f0: 7261 7469 6f6e 7328 656c 656d 7329 0d0a  rations(elems)..
-0000c200: 2020 2020 2020 2020 7365 6c66 2e63 6c61          self.cla
-0000c210: 7373 6966 7928 6c69 7374 2873 656c 662e  ssify(list(self.
-0000c220: 656c 656d 7328 2929 290d 0a20 2020 2020  elems()))..     
-0000c230: 2020 2073 656c 662e 7369 676e 616c 2822     self.signal("
-0000c240: 7265 6672 6573 685f 7472 6565 2229 0d0a  refresh_tree")..
-0000c250: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
-0000c260: 6174 696f 6e28 0d0a 2020 2020 2020 2020  ation(..        
-0000c270: 5f28 2252 656d 6f76 6520 616c 6c20 6173  _("Remove all as
-0000c280: 7369 676e 6d65 6e74 7320 6672 6f6d 206f  signments from o
-0000c290: 7065 7261 7469 6f6e 7322 292c 0d0a 2020  perations"),..  
-0000c2a0: 2020 2020 2020 6e6f 6465 5f74 7970 653d        node_type=
-0000c2b0: 2262 7261 6e63 6820 656c 656d 7322 2c0d  "branch elems",.
-0000c2c0: 0a20 2020 2020 2020 2068 656c 703d 5f28  .        help=_(
-0000c2d0: 2241 6e79 2065 7869 7374 696e 6720 6173  "Any existing as
-0000c2e0: 7369 676e 6d65 6e74 206f 6620 656c 656d  signment of elem
-0000c2f0: 656e 7473 2074 6f20 6f70 6572 6174 696f  ents to operatio
-0000c300: 6e73 2077 696c 6c20 6265 2072 656d 6f76  ns will be remov
-0000c310: 6564 2229 2c0d 0a20 2020 2029 0d0a 2020  ed"),..    )..  
-0000c320: 2020 6465 6620 7265 6d6f 7665 5f61 6c6c    def remove_all
-0000c330: 5f61 7373 6967 6e6d 656e 7473 286e 6f64  _assignments(nod
-0000c340: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
-0000c350: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
-0000c360: 2e73 7461 7469 6328 2272 656d 6f76 655f  .static("remove_
-0000c370: 616c 6c5f 6173 7369 676e 2229 3a0d 0a20  all_assign"):.. 
-0000c380: 2020 2020 2020 2020 2020 2066 6f72 206e             for n
-0000c390: 6f64 6520 696e 2073 656c 662e 656c 656d  ode in self.elem
-0000c3a0: 7328 293a 0d0a 2020 2020 2020 2020 2020  s():..          
-0000c3b0: 2020 2020 2020 666f 7220 7265 6620 696e        for ref in
-0000c3c0: 206c 6973 7428 6e6f 6465 2e72 6566 6572   list(node.refer
-0000c3d0: 656e 6365 7329 3a0d 0a20 2020 2020 2020  ences):..       
-0000c3e0: 2020 2020 2020 2020 2020 2020 2072 6566               ref
-0000c3f0: 2e72 656d 6f76 655f 6e6f 6465 2829 0d0a  .remove_node()..
-0000c400: 2020 2020 2020 2020 7365 6c66 2e73 6967          self.sig
-0000c410: 6e61 6c28 2272 6566 7265 7368 5f74 7265  nal("refresh_tre
-0000c420: 6522 290d 0a0d 0a20 2020 2040 7472 6565  e")....    @tree
-0000c430: 5f6f 7065 7261 7469 6f6e 280d 0a20 2020  _operation(..   
-0000c440: 2020 2020 205f 2822 4475 706c 6963 6174       _("Duplicat
-0000c450: 6520 6f70 6572 6174 696f 6e28 7329 2229  e operation(s)")
-0000c460: 2c0d 0a20 2020 2020 2020 206e 6f64 655f  ,..        node_
-0000c470: 7479 7065 3d6f 705f 6e6f 6465 732c 0d0a  type=op_nodes,..
-0000c480: 2020 2020 2020 2020 6865 6c70 3d5f 2822          help=_("
-0000c490: 6475 706c 6963 6174 6520 6f70 6572 6174  duplicate operat
-0000c4a0: 696f 6e20 6e6f 6465 7322 292c 0d0a 2020  ion nodes"),..  
-0000c4b0: 2020 290d 0a20 2020 2064 6566 2064 7570    )..    def dup
-0000c4c0: 6c69 6361 7465 5f6f 7065 7261 7469 6f6e  licate_operation
-0000c4d0: 286e 6f64 652c 202a 2a6b 7761 7267 7329  (node, **kwargs)
-0000c4e0: 3a0d 0a20 2020 2020 2020 2077 6974 6820  :..        with 
-0000c4f0: 7365 6c66 2e73 7461 7469 6328 2264 7570  self.static("dup
-0000c500: 6c69 6361 7465 5f6f 7065 7261 7469 6f6e  licate_operation
-0000c510: 2229 3a0d 0a20 2020 2020 2020 2020 2020  "):..           
-0000c520: 206f 7065 7261 7469 6f6e 7320 3d20 7365   operations = se
-0000c530: 6c66 2e5f 7472 6565 2e67 6574 2874 7970  lf._tree.get(typ
-0000c540: 653d 2262 7261 6e63 6820 6f70 7322 292e  e="branch ops").
-0000c550: 6368 696c 6472 656e 0d0a 2020 2020 2020  children..      
-0000c560: 2020 2020 2020 666f 7220 6f70 2069 6e20        for op in 
-0000c570: 7365 6c66 2e6f 7073 2873 656c 6563 7465  self.ops(selecte
-0000c580: 643d 5472 7565 293a 0d0a 2020 2020 2020  d=True):..      
-0000c590: 2020 2020 2020 2020 2020 7472 793a 0d0a            try:..
-0000c5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c5b0: 2020 2020 706f 7320 3d20 6f70 6572 6174      pos = operat
-0000c5c0: 696f 6e73 2e69 6e64 6578 286f 7029 202b  ions.index(op) +
-0000c5d0: 2031 0d0a 2020 2020 2020 2020 2020 2020   1..            
-0000c5e0: 2020 2020 6578 6365 7074 2056 616c 7565      except Value
-0000c5f0: 4572 726f 723a 0d0a 2020 2020 2020 2020  Error:..        
-0000c600: 2020 2020 2020 2020 2020 2020 706f 7320              pos 
-0000c610: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
-0000c620: 2020 2020 2020 2020 636f 7079 5f6f 7020          copy_op 
-0000c630: 3d20 636f 7079 286f 7029 0d0a 2020 2020  = copy(op)..    
-0000c640: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000c650: 2e61 6464 5f6f 7028 636f 7079 5f6f 702c  .add_op(copy_op,
-0000c660: 2070 6f73 3d70 6f73 290d 0a20 2020 2020   pos=pos)..     
-0000c670: 2020 2020 2020 2020 2020 2066 6f72 2063             for c
-0000c680: 6869 6c64 2069 6e20 6f70 2e63 6869 6c64  hild in op.child
-0000c690: 7265 6e3a 0d0a 2020 2020 2020 2020 2020  ren:..          
-0000c6a0: 2020 2020 2020 2020 2020 7472 793a 0d0a            try:..
-0000c6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c6c0: 2020 2020 2020 2020 636f 7079 5f6f 702e          copy_op.
-0000c6d0: 6164 645f 7265 6665 7265 6e63 6528 6368  add_reference(ch
-0000c6e0: 696c 642e 6e6f 6465 290d 0a20 2020 2020  ild.node)..     
-0000c6f0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000c700: 7863 6570 7420 4174 7472 6962 7574 6545  xcept AttributeE
-0000c710: 7272 6f72 3a0d 0a20 2020 2020 2020 2020  rror:..         
-0000c720: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000c730: 6173 730d 0a0d 0a20 2020 2040 7472 6565  ass....    @tree
-0000c740: 5f63 6f6e 6469 7469 6f6e 616c 286c 616d  _conditional(lam
-0000c750: 6264 6120 6e6f 6465 3a20 6e6f 6465 2e63  bda node: node.c
-0000c760: 6f75 6e74 5f63 6869 6c64 7265 6e28 2920  ount_children() 
-0000c770: 3e20 3129 0d0a 2020 2020 4074 7265 655f  > 1)..    @tree_
-0000c780: 7375 626d 656e 7528 5f28 2250 6173 7365  submenu(_("Passe
-0000c790: 7322 2929 0d0a 2020 2020 4074 7265 655f  s"))..    @tree_
-0000c7a0: 6f70 6572 6174 696f 6e28 0d0a 2020 2020  operation(..    
-0000c7b0: 2020 2020 5f28 2241 6464 2031 2070 6173      _("Add 1 pas
-0000c7c0: 7322 292c 0d0a 2020 2020 2020 2020 6e6f  s"),..        no
-0000c7d0: 6465 5f74 7970 653d 2822 6f70 2069 6d61  de_type=("op ima
-0000c7e0: 6765 222c 2022 6f70 2065 6e67 7261 7665  ge", "op engrave
-0000c7f0: 222c 2022 6f70 2063 7574 222c 2022 6f70  ", "op cut", "op
-0000c800: 2068 6174 6368 2229 2c0d 0a20 2020 2020   hatch"),..     
-0000c810: 2020 2068 656c 703d 2222 2c0d 0a20 2020     help="",..   
-0000c820: 2029 0d0a 2020 2020 6465 6620 6164 645f   )..    def add_
-0000c830: 315f 7061 7373 286e 6f64 652c 202a 2a6b  1_pass(node, **k
-0000c840: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
-0000c850: 2061 6464 5f6e 5f70 6173 7365 7328 6e6f   add_n_passes(no
-0000c860: 6465 2c20 636f 7069 6573 3d31 2c20 2a2a  de, copies=1, **
-0000c870: 6b77 6172 6773 290d 0a0d 0a20 2020 2040  kwargs)....    @
-0000c880: 7472 6565 5f63 6f6e 6469 7469 6f6e 616c  tree_conditional
-0000c890: 286c 616d 6264 6120 6e6f 6465 3a20 6e6f  (lambda node: no
-0000c8a0: 6465 2e63 6f75 6e74 5f63 6869 6c64 7265  de.count_childre
-0000c8b0: 6e28 2920 3e20 3129 0d0a 2020 2020 4074  n() > 1)..    @t
-0000c8c0: 7265 655f 7375 626d 656e 7528 5f28 2250  ree_submenu(_("P
-0000c8d0: 6173 7365 7322 2929 0d0a 2020 2020 4074  asses"))..    @t
-0000c8e0: 7265 655f 6974 6572 6174 6528 2263 6f70  ree_iterate("cop
-0000c8f0: 6965 7322 2c20 322c 2031 3029 0d0a 2020  ies", 2, 10)..  
-0000c900: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
-0000c910: 6e28 0d0a 2020 2020 2020 2020 5f28 2241  n(..        _("A
-0000c920: 6464 207b 636f 7069 6573 7d20 7061 7373  dd {copies} pass
-0000c930: 6573 2229 2c0d 0a20 2020 2020 2020 206e  es"),..        n
-0000c940: 6f64 655f 7479 7065 3d28 226f 7020 696d  ode_type=("op im
-0000c950: 6167 6522 2c20 226f 7020 656e 6772 6176  age", "op engrav
-0000c960: 6522 2c20 226f 7020 6375 7422 2c20 226f  e", "op cut", "o
-0000c970: 7020 6861 7463 6822 292c 0d0a 2020 2020  p hatch"),..    
-0000c980: 2020 2020 6865 6c70 3d22 222c 0d0a 2020      help="",..  
-0000c990: 2020 290d 0a20 2020 2064 6566 2061 6464    )..    def add
-0000c9a0: 5f6e 5f70 6173 7365 7328 6e6f 6465 2c20  _n_passes(node, 
-0000c9b0: 636f 7069 6573 3d31 2c20 2a2a 6b77 6172  copies=1, **kwar
-0000c9c0: 6773 293a 0d0a 2020 2020 2020 2020 6164  gs):..        ad
-0000c9d0: 645f 6e6f 6465 7320 3d20 6c69 7374 286e  d_nodes = list(n
-0000c9e0: 6f64 652e 6368 696c 6472 656e 290d 0a0d  ode.children)...
-0000c9f0: 0a20 2020 2020 2020 2072 656d 6f76 6564  .        removed
-0000ca00: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
-0000ca10: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
-0000ca20: 2830 2c20 6c65 6e28 6164 645f 6e6f 6465  (0, len(add_node
-0000ca30: 7329 293a 0d0a 2020 2020 2020 2020 2020  s)):..          
-0000ca40: 2020 666f 7220 7120 696e 2072 616e 6765    for q in range
-0000ca50: 2830 2c20 6929 3a0d 0a20 2020 2020 2020  (0, i):..       
-0000ca60: 2020 2020 2020 2020 2069 6620 6164 645f           if add_
-0000ca70: 6e6f 6465 735b 715d 2069 7320 6164 645f  nodes[q] is add_
-0000ca80: 6e6f 6465 735b 695d 3a0d 0a20 2020 2020  nodes[i]:..     
-0000ca90: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0000caa0: 6464 5f6e 6f64 6573 5b69 5d20 3d20 4e6f  dd_nodes[i] = No
-0000cab0: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
-0000cac0: 2020 2020 2020 2020 7265 6d6f 7665 6420          removed 
-0000cad0: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
-0000cae0: 6966 2072 656d 6f76 6564 3a0d 0a20 2020  if removed:..   
-0000caf0: 2020 2020 2020 2020 2061 6464 5f6e 6f64           add_nod
-0000cb00: 6573 203d 205b 6320 666f 7220 6320 696e  es = [c for c in
-0000cb10: 2061 6464 5f6e 6f64 6573 2069 6620 6320   add_nodes if c 
-0000cb20: 6973 206e 6f74 204e 6f6e 655d 0d0a 2020  is not None]..  
-0000cb30: 2020 2020 2020 6164 645f 6e6f 6465 7320        add_nodes 
-0000cb40: 2a3d 2063 6f70 6965 730d 0a20 2020 2020  *= copies..     
-0000cb50: 2020 2066 6f72 206e 2069 6e20 6164 645f     for n in add_
-0000cb60: 6e6f 6465 733a 0d0a 2020 2020 2020 2020  nodes:..        
-0000cb70: 2020 2020 6e6f 6465 2e61 6464 5f72 6566      node.add_ref
-0000cb80: 6572 656e 6365 286e 2e6e 6f64 6529 0d0a  erence(n.node)..
-0000cb90: 2020 2020 2020 2020 7365 6c66 2e73 6967          self.sig
-0000cba0: 6e61 6c28 2272 6562 7569 6c64 5f74 7265  nal("rebuild_tre
-0000cbb0: 6522 290d 0a0d 0a20 2020 2040 7472 6565  e")....    @tree
-0000cbc0: 5f63 6f6e 6469 7469 6f6e 616c 286c 616d  _conditional(lam
-0000cbd0: 6264 6120 6e6f 6465 3a20 6e6f 6465 2e63  bda node: node.c
-0000cbe0: 6f75 6e74 5f63 6869 6c64 7265 6e28 2920  ount_children() 
-0000cbf0: 3e20 3129 0d0a 2020 2020 4074 7265 655f  > 1)..    @tree_
-0000cc00: 7375 626d 656e 7528 5f28 2244 7570 6c69  submenu(_("Dupli
-0000cc10: 6361 7465 2065 6c65 6d65 6e74 2873 2922  cate element(s)"
-0000cc20: 2929 0d0a 2020 2020 4074 7265 655f 6f70  ))..    @tree_op
-0000cc30: 6572 6174 696f 6e28 0d0a 2020 2020 2020  eration(..      
-0000cc40: 2020 5f28 2244 7570 6c69 6361 7465 2065    _("Duplicate e
-0000cc50: 6c65 6d65 6e74 7320 3120 7469 6d65 2229  lements 1 time")
-0000cc60: 2c0d 0a20 2020 2020 2020 206e 6f64 655f  ,..        node_
-0000cc70: 7479 7065 3d28 226f 7020 696d 6167 6522  type=("op image"
-0000cc80: 2c20 226f 7020 656e 6772 6176 6522 2c20  , "op engrave", 
-0000cc90: 226f 7020 6375 7422 292c 0d0a 2020 2020  "op cut"),..    
-0000cca0: 2020 2020 6865 6c70 3d22 222c 0d0a 2020      help="",..  
-0000ccb0: 2020 290d 0a20 2020 2064 6566 2064 7570    )..    def dup
-0000ccc0: 5f31 5f63 6f70 7928 6e6f 6465 2c20 2a2a  _1_copy(node, **
-0000ccd0: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
-0000cce0: 2020 6475 705f 6e5f 636f 7069 6573 286e    dup_n_copies(n
-0000ccf0: 6f64 652c 2063 6f70 6965 733d 312c 202a  ode, copies=1, *
-0000cd00: 2a6b 7761 7267 7329 0d0a 0d0a 2020 2020  *kwargs)....    
-0000cd10: 4074 7265 655f 636f 6e64 6974 696f 6e61  @tree_conditiona
-0000cd20: 6c28 6c61 6d62 6461 206e 6f64 653a 206e  l(lambda node: n
-0000cd30: 6f64 652e 636f 756e 745f 6368 696c 6472  ode.count_childr
-0000cd40: 656e 2829 203e 2031 290d 0a20 2020 2040  en() > 1)..    @
-0000cd50: 7472 6565 5f73 7562 6d65 6e75 285f 2822  tree_submenu(_("
-0000cd60: 4475 706c 6963 6174 6520 656c 656d 656e  Duplicate elemen
-0000cd70: 7428 7329 2229 290d 0a20 2020 2040 7472  t(s)"))..    @tr
-0000cd80: 6565 5f69 7465 7261 7465 2822 636f 7069  ee_iterate("copi
-0000cd90: 6573 222c 2032 2c20 3130 290d 0a20 2020  es", 2, 10)..   
-0000cda0: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
-0000cdb0: 280d 0a20 2020 2020 2020 205f 2822 4475  (..        _("Du
-0000cdc0: 706c 6963 6174 6520 656c 656d 656e 7473  plicate elements
-0000cdd0: 207b 636f 7069 6573 7d20 7469 6d65 7322   {copies} times"
-0000cde0: 292c 0d0a 2020 2020 2020 2020 6e6f 6465  ),..        node
-0000cdf0: 5f74 7970 653d 2822 6f70 2069 6d61 6765  _type=("op image
-0000ce00: 222c 2022 6f70 2065 6e67 7261 7665 222c  ", "op engrave",
-0000ce10: 2022 6f70 2063 7574 2229 2c0d 0a20 2020   "op cut"),..   
-0000ce20: 2020 2020 2068 656c 703d 2222 2c0d 0a20       help="",.. 
-0000ce30: 2020 2029 0d0a 2020 2020 6465 6620 6475     )..    def du
-0000ce40: 705f 6e5f 636f 7069 6573 286e 6f64 652c  p_n_copies(node,
-0000ce50: 2063 6f70 6965 733d 312c 202a 2a6b 7761   copies=1, **kwa
-0000ce60: 7267 7329 3a0d 0a20 2020 2020 2020 2023  rgs):..        #
-0000ce70: 2043 6f64 6520 696e 2073 6572 6965 732e   Code in series.
-0000ce80: 0d0a 2020 2020 2020 2020 2320 6164 645f  ..        # add_
-0000ce90: 6e6f 6465 7320 3d20 6c69 7374 286e 6f64  nodes = list(nod
-0000cea0: 652e 6368 696c 6472 656e 290d 0a20 2020  e.children)..   
-0000ceb0: 2020 2020 2023 2061 6464 5f6e 6f64 6573       # add_nodes
-0000cec0: 202a 3d20 636f 7069 6573 0d0a 2020 2020   *= copies..    
-0000ced0: 2020 2020 2320 666f 7220 6e20 696e 2061      # for n in a
-0000cee0: 6464 5f6e 6f64 6573 3a0d 0a20 2020 2020  dd_nodes:..     
-0000cef0: 2020 2023 2020 2020 206e 6f64 652e 6164     #     node.ad
-0000cf00: 645f 7265 6665 7265 6e63 6528 6e2e 6e6f  d_reference(n.no
-0000cf10: 6465 290d 0a0d 0a20 2020 2020 2020 2023  de)....        #
-0000cf20: 2043 6f64 6520 696e 2070 6172 616c 6c65   Code in paralle
-0000cf30: 6c2e 0d0a 2020 2020 2020 2020 6164 645f  l...        add_
-0000cf40: 6e6f 6465 7320 3d20 6c69 7374 286e 6f64  nodes = list(nod
-0000cf50: 652e 6368 696c 6472 656e 290d 0a20 2020  e.children)..   
-0000cf60: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
-0000cf70: 6e67 6528 6c65 6e28 6164 645f 6e6f 6465  nge(len(add_node
-0000cf80: 7329 202d 2031 2c20 2d31 2c20 2d31 293a  s) - 1, -1, -1):
-0000cf90: 0d0a 2020 2020 2020 2020 2020 2020 6e20  ..            n 
-0000cfa0: 3d20 6164 645f 6e6f 6465 735b 695d 0d0a  = add_nodes[i]..
-0000cfb0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0000cfc0: 6b20 696e 2072 616e 6765 2863 6f70 6965  k in range(copie
-0000cfd0: 7329 3a0d 0a20 2020 2020 2020 2020 2020  s):..           
-0000cfe0: 2020 2020 206e 6f64 652e 6164 645f 7265       node.add_re
-0000cff0: 6665 7265 6e63 6528 6e2e 6e6f 6465 2c20  ference(n.node, 
-0000d000: 706f 733d 6929 0d0a 0d0a 2020 2020 2020  pos=i)....      
-0000d010: 2020 7365 6c66 2e73 6967 6e61 6c28 2272    self.signal("r
-0000d020: 6566 7265 7368 5f74 7265 6522 290d 0a0d  efresh_tree")...
-0000d030: 0a20 2020 2040 7472 6565 5f6f 7065 7261  .    @tree_opera
-0000d040: 7469 6f6e 280d 0a20 2020 2020 2020 205f  tion(..        _
-0000d050: 2822 4d61 6b65 2072 6173 7465 7220 696d  ("Make raster im
-0000d060: 6167 6522 292c 0d0a 2020 2020 2020 2020  age"),..        
-0000d070: 6e6f 6465 5f74 7970 653d 2822 6f70 2069  node_type=("op i
-0000d080: 6d61 6765 222c 2022 6f70 2072 6173 7465  mage", "op raste
-0000d090: 7222 292c 0d0a 2020 2020 2020 2020 6865  r"),..        he
-0000d0a0: 6c70 3d5f 2822 4372 6561 7465 2061 6e20  lp=_("Create an 
-0000d0b0: 696d 6167 6520 6672 6f6d 2074 6865 2061  image from the a
-0000d0c0: 7373 6967 6e65 6420 656c 656d 656e 7473  ssigned elements
-0000d0d0: 2e22 292c 0d0a 2020 2020 290d 0a20 2020  ."),..    )..   
-0000d0e0: 2064 6566 206d 616b 655f 7261 7374 6572   def make_raster
-0000d0f0: 5f69 6d61 6765 286e 6f64 652c 202a 2a6b  _image(node, **k
-0000d100: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
-0000d110: 2064 6174 6120 3d20 6c69 7374 286e 6f64   data = list(nod
-0000d120: 652e 666c 6174 2874 7970 6573 3d65 6c65  e.flat(types=ele
-0000d130: 6d5f 7265 665f 6e6f 6465 7329 290d 0a20  m_ref_nodes)).. 
-0000d140: 2020 2020 2020 2069 6620 6c65 6e28 6461         if len(da
-0000d150: 7461 2920 3d3d 2030 3a0d 0a20 2020 2020  ta) == 0:..     
-0000d160: 2020 2020 2020 2072 6574 7572 6e0d 0a20         return.. 
-0000d170: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
-0000d180: 2020 2020 2020 2020 2062 6f75 6e64 7320           bounds 
-0000d190: 3d20 4e6f 6465 2e75 6e69 6f6e 5f62 6f75  = Node.union_bou
-0000d1a0: 6e64 7328 6461 7461 2c20 6174 7472 3d22  nds(data, attr="
-0000d1b0: 7061 696e 745f 626f 756e 6473 2229 0d0a  paint_bounds")..
-0000d1c0: 2020 2020 2020 2020 2020 2020 7769 6474              widt
-0000d1d0: 6820 3d20 626f 756e 6473 5b32 5d20 2d20  h = bounds[2] - 
-0000d1e0: 626f 756e 6473 5b30 5d0d 0a20 2020 2020  bounds[0]..     
-0000d1f0: 2020 2020 2020 2068 6569 6768 7420 3d20         height = 
-0000d200: 626f 756e 6473 5b33 5d20 2d20 626f 756e  bounds[3] - boun
-0000d210: 6473 5b31 5d0d 0a20 2020 2020 2020 2065  ds[1]..        e
-0000d220: 7863 6570 7420 5479 7065 4572 726f 723a  xcept TypeError:
-0000d230: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
-0000d240: 6973 6520 436f 6d6d 616e 6453 796e 7461  ise CommandSynta
-0000d250: 7845 7272 6f72 0d0a 2020 2020 2020 2020  xError..        
-0000d260: 6d61 6b65 5f72 6173 7465 7220 3d20 7365  make_raster = se
-0000d270: 6c66 2e6c 6f6f 6b75 7028 2272 656e 6465  lf.lookup("rende
-0000d280: 722d 6f70 2f6d 616b 655f 7261 7374 6572  r-op/make_raster
-0000d290: 2229 0d0a 2020 2020 2020 2020 6966 206e  ")..        if n
-0000d2a0: 6f74 206d 616b 655f 7261 7374 6572 3a0d  ot make_raster:.
-0000d2b0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0000d2c0: 7365 2056 616c 7565 4572 726f 7228 224e  se ValueError("N
-0000d2d0: 6f20 7265 6e64 6572 6572 2069 7320 7265  o renderer is re
-0000d2e0: 6769 7374 6572 6564 2074 6f20 7065 7266  gistered to perf
-0000d2f0: 6f72 6d20 7265 6e64 6572 2e22 290d 0a0d  orm render.")...
-0000d300: 0a20 2020 2020 2020 2064 6f74 735f 7065  .        dots_pe
-0000d310: 725f 756e 6974 7320 3d20 6e6f 6465 2e64  r_units = node.d
-0000d320: 7069 202f 2055 4e49 5453 5f50 4552 5f49  pi / UNITS_PER_I
-0000d330: 4e43 480d 0a20 2020 2020 2020 206e 6577  NCH..        new
-0000d340: 5f77 6964 7468 203d 2077 6964 7468 202a  _width = width *
-0000d350: 2064 6f74 735f 7065 725f 756e 6974 730d   dots_per_units.
-0000d360: 0a20 2020 2020 2020 206e 6577 5f68 6569  .        new_hei
-0000d370: 6768 7420 3d20 6865 6967 6874 202a 2064  ght = height * d
-0000d380: 6f74 735f 7065 725f 756e 6974 730d 0a0d  ots_per_units...
-0000d390: 0a20 2020 2020 2020 2069 6d61 6765 203d  .        image =
-0000d3a0: 206d 616b 655f 7261 7374 6572 280d 0a20   make_raster(.. 
-0000d3b0: 2020 2020 2020 2020 2020 2064 6174 612c             data,
-0000d3c0: 0d0a 2020 2020 2020 2020 2020 2020 626f  ..            bo
-0000d3d0: 756e 6473 3d62 6f75 6e64 732c 0d0a 2020  unds=bounds,..  
-0000d3e0: 2020 2020 2020 2020 2020 7769 6474 683d            width=
-0000d3f0: 6e65 775f 7769 6474 682c 0d0a 2020 2020  new_width,..    
-0000d400: 2020 2020 2020 2020 6865 6967 6874 3d6e          height=n
-0000d410: 6577 5f68 6569 6768 742c 0d0a 2020 2020  ew_height,..    
-0000d420: 2020 2020 290d 0a20 2020 2020 2020 206d      )..        m
-0000d430: 6174 7269 7820 3d20 4d61 7472 6978 2e73  atrix = Matrix.s
-0000d440: 6361 6c65 2877 6964 7468 202f 206e 6577  cale(width / new
-0000d450: 5f77 6964 7468 2c20 6865 6967 6874 202f  _width, height /
-0000d460: 206e 6577 5f68 6569 6768 7429 0d0a 2020   new_height)..  
-0000d470: 2020 2020 2020 6d61 7472 6978 2e70 6f73        matrix.pos
-0000d480: 745f 7472 616e 736c 6174 6528 626f 756e  t_translate(boun
-0000d490: 6473 5b30 5d2c 2062 6f75 6e64 735b 315d  ds[0], bounds[1]
-0000d4a0: 290d 0a0d 0a20 2020 2020 2020 2069 6d61  )....        ima
-0000d4b0: 6765 5f6e 6f64 6520 3d20 496d 6167 654e  ge_node = ImageN
-0000d4c0: 6f64 6528 696d 6167 653d 696d 6167 652c  ode(image=image,
-0000d4d0: 206d 6174 7269 783d 6d61 7472 6978 2c20   matrix=matrix, 
-0000d4e0: 6470 693d 6e6f 6465 2e64 7069 290d 0a20  dpi=node.dpi).. 
-0000d4f0: 2020 2020 2020 2073 656c 662e 656c 656d         self.elem
-0000d500: 5f62 7261 6e63 682e 6164 645f 6e6f 6465  _branch.add_node
-0000d510: 2869 6d61 6765 5f6e 6f64 6529 0d0a 2020  (image_node)..  
-0000d520: 2020 2020 2020 6e6f 6465 2e61 6464 5f72        node.add_r
-0000d530: 6566 6572 656e 6365 2869 6d61 6765 5f6e  eference(image_n
-0000d540: 6f64 6529 0d0a 2020 2020 2020 2020 7365  ode)..        se
-0000d550: 6c66 2e73 6967 6e61 6c28 2272 6566 7265  lf.signal("refre
-0000d560: 7368 5f73 6365 6e65 222c 2022 5363 656e  sh_scene", "Scen
-0000d570: 6522 290d 0a0d 0a20 2020 2064 6566 2061  e")....    def a
-0000d580: 6464 5f61 6674 6572 5f69 6e64 6578 286e  dd_after_index(n
-0000d590: 6f64 653d 4e6f 6e65 293a 0d0a 2020 2020  ode=None):..    
-0000d5a0: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
-0000d5b0: 2020 2020 2020 6966 206e 6f64 6520 6973        if node is
-0000d5c0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-0000d5d0: 2020 2020 2020 2020 6e6f 6465 203d 206c          node = l
-0000d5e0: 6973 7428 7365 6c66 2e6f 7073 2873 656c  ist(self.ops(sel
-0000d5f0: 6563 7465 643d 5472 7565 2929 5b2d 315d  ected=True))[-1]
-0000d600: 0d0a 2020 2020 2020 2020 2020 2020 6f70  ..            op
-0000d610: 6572 6174 696f 6e73 203d 2073 656c 662e  erations = self.
-0000d620: 5f74 7265 652e 6765 7428 7479 7065 3d22  _tree.get(type="
-0000d630: 6272 616e 6368 206f 7073 2229 2e63 6869  branch ops").chi
-0000d640: 6c64 7265 6e0d 0a20 2020 2020 2020 2020  ldren..         
-0000d650: 2020 2072 6574 7572 6e20 6f70 6572 6174     return operat
-0000d660: 696f 6e73 2e69 6e64 6578 286e 6f64 6529  ions.index(node)
-0000d670: 202b 2031 0d0a 2020 2020 2020 2020 6578   + 1..        ex
-0000d680: 6365 7074 2028 5661 6c75 6545 7272 6f72  cept (ValueError
-0000d690: 2c20 496e 6465 7845 7272 6f72 293a 0d0a  , IndexError):..
-0000d6a0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000d6b0: 726e 204e 6f6e 650d 0a0d 0a20 2020 2040  rn None....    @
-0000d6c0: 7472 6565 5f73 6570 6172 6174 6f72 5f62  tree_separator_b
-0000d6d0: 6566 6f72 6528 290d 0a20 2020 2040 7472  efore()..    @tr
-0000d6e0: 6565 5f73 7562 6d65 6e75 285f 2822 496e  ee_submenu(_("In
-0000d6f0: 7365 7274 206f 7065 7261 7469 6f6e 2229  sert operation")
-0000d700: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
-0000d710: 7261 7469 6f6e 285f 2822 4164 6420 496d  ration(_("Add Im
-0000d720: 6167 6522 292c 206e 6f64 655f 7479 7065  age"), node_type
-0000d730: 3d6f 705f 6e6f 6465 732c 2068 656c 703d  =op_nodes, help=
-0000d740: 2222 290d 0a20 2020 2064 6566 2061 6464  "")..    def add
-0000d750: 5f6f 7065 7261 7469 6f6e 5f69 6d61 6765  _operation_image
-0000d760: 286e 6f64 652c 202a 2a6b 7761 7267 7329  (node, **kwargs)
-0000d770: 3a0d 0a20 2020 2020 2020 2061 7070 656e  :..        appen
-0000d780: 645f 6f70 6572 6174 696f 6e5f 696d 6167  d_operation_imag
-0000d790: 6528 6e6f 6465 2c20 706f 733d 6164 645f  e(node, pos=add_
-0000d7a0: 6166 7465 725f 696e 6465 7828 6e6f 6465  after_index(node
-0000d7b0: 292c 202a 2a6b 7761 7267 7329 0d0a 0d0a  ), **kwargs)....
-0000d7c0: 2020 2020 4074 7265 655f 7375 626d 656e      @tree_submen
-0000d7d0: 7528 5f28 2249 6e73 6572 7420 6f70 6572  u(_("Insert oper
-0000d7e0: 6174 696f 6e22 2929 0d0a 2020 2020 4074  ation"))..    @t
-0000d7f0: 7265 655f 6f70 6572 6174 696f 6e28 5f28  ree_operation(_(
-0000d800: 2241 6464 2052 6173 7465 7222 292c 206e  "Add Raster"), n
-0000d810: 6f64 655f 7479 7065 3d6f 705f 6e6f 6465  ode_type=op_node
-0000d820: 732c 2068 656c 703d 2222 290d 0a20 2020  s, help="")..   
-0000d830: 2064 6566 2061 6464 5f6f 7065 7261 7469   def add_operati
-0000d840: 6f6e 5f72 6173 7465 7228 6e6f 6465 2c20  on_raster(node, 
-0000d850: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
-0000d860: 2020 2020 6170 7065 6e64 5f6f 7065 7261      append_opera
-0000d870: 7469 6f6e 5f72 6173 7465 7228 6e6f 6465  tion_raster(node
-0000d880: 2c20 706f 733d 6164 645f 6166 7465 725f  , pos=add_after_
-0000d890: 696e 6465 7828 6e6f 6465 292c 202a 2a6b  index(node), **k
-0000d8a0: 7761 7267 7329 0d0a 0d0a 2020 2020 4074  wargs)....    @t
-0000d8b0: 7265 655f 7375 626d 656e 7528 5f28 2249  ree_submenu(_("I
-0000d8c0: 6e73 6572 7420 6f70 6572 6174 696f 6e22  nsert operation"
-0000d8d0: 2929 0d0a 2020 2020 4074 7265 655f 6f70  ))..    @tree_op
-0000d8e0: 6572 6174 696f 6e28 5f28 2241 6464 2045  eration(_("Add E
-0000d8f0: 6e67 7261 7665 2229 2c20 6e6f 6465 5f74  ngrave"), node_t
-0000d900: 7970 653d 6f70 5f6e 6f64 6573 2c20 6865  ype=op_nodes, he
-0000d910: 6c70 3d22 2229 0d0a 2020 2020 6465 6620  lp="")..    def 
-0000d920: 6164 645f 6f70 6572 6174 696f 6e5f 656e  add_operation_en
-0000d930: 6772 6176 6528 6e6f 6465 2c20 2a2a 6b77  grave(node, **kw
-0000d940: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
-0000d950: 6170 7065 6e64 5f6f 7065 7261 7469 6f6e  append_operation
-0000d960: 5f65 6e67 7261 7665 286e 6f64 652c 2070  _engrave(node, p
-0000d970: 6f73 3d61 6464 5f61 6674 6572 5f69 6e64  os=add_after_ind
-0000d980: 6578 286e 6f64 6529 2c20 2a2a 6b77 6172  ex(node), **kwar
-0000d990: 6773 290d 0a0d 0a20 2020 2040 7472 6565  gs)....    @tree
-0000d9a0: 5f73 7562 6d65 6e75 285f 2822 496e 7365  _submenu(_("Inse
-0000d9b0: 7274 206f 7065 7261 7469 6f6e 2229 290d  rt operation")).
-0000d9c0: 0a20 2020 2040 7472 6565 5f6f 7065 7261  .    @tree_opera
-0000d9d0: 7469 6f6e 285f 2822 4164 6420 4375 7422  tion(_("Add Cut"
-0000d9e0: 292c 206e 6f64 655f 7479 7065 3d6f 705f  ), node_type=op_
-0000d9f0: 6e6f 6465 732c 2068 656c 703d 2222 290d  nodes, help="").
-0000da00: 0a20 2020 2064 6566 2061 6464 5f6f 7065  .    def add_ope
-0000da10: 7261 7469 6f6e 5f63 7574 286e 6f64 652c  ration_cut(node,
-0000da20: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
-0000da30: 2020 2020 2061 7070 656e 645f 6f70 6572       append_oper
-0000da40: 6174 696f 6e5f 6375 7428 6e6f 6465 2c20  ation_cut(node, 
-0000da50: 706f 733d 6164 645f 6166 7465 725f 696e  pos=add_after_in
-0000da60: 6465 7828 6e6f 6465 292c 202a 2a6b 7761  dex(node), **kwa
-0000da70: 7267 7329 0d0a 0d0a 2020 2020 4074 7265  rgs)....    @tre
-0000da80: 655f 7375 626d 656e 7528 5f28 2249 6e73  e_submenu(_("Ins
-0000da90: 6572 7420 6f70 6572 6174 696f 6e22 2929  ert operation"))
-0000daa0: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
-0000dab0: 6174 696f 6e28 5f28 2241 6464 2048 6174  ation(_("Add Hat
-0000dac0: 6368 2229 2c20 6e6f 6465 5f74 7970 653d  ch"), node_type=
-0000dad0: 6f70 5f6e 6f64 6573 2c20 6865 6c70 3d22  op_nodes, help="
-0000dae0: 2229 0d0a 2020 2020 6465 6620 6164 645f  ")..    def add_
-0000daf0: 6f70 6572 6174 696f 6e5f 6861 7463 6828  operation_hatch(
-0000db00: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
-0000db10: 0d0a 2020 2020 2020 2020 6170 7065 6e64  ..        append
-0000db20: 5f6f 7065 7261 7469 6f6e 5f68 6174 6368  _operation_hatch
-0000db30: 286e 6f64 652c 2070 6f73 3d61 6464 5f61  (node, pos=add_a
-0000db40: 6674 6572 5f69 6e64 6578 286e 6f64 6529  fter_index(node)
-0000db50: 2c20 2a2a 6b77 6172 6773 290d 0a0d 0a20  , **kwargs).... 
-0000db60: 2020 2040 7472 6565 5f73 7562 6d65 6e75     @tree_submenu
-0000db70: 285f 2822 496e 7365 7274 206f 7065 7261  (_("Insert opera
-0000db80: 7469 6f6e 2229 290d 0a20 2020 2040 7472  tion"))..    @tr
-0000db90: 6565 5f6f 7065 7261 7469 6f6e 285f 2822  ee_operation(_("
-0000dba0: 4164 6420 446f 7473 2229 2c20 6e6f 6465  Add Dots"), node
-0000dbb0: 5f74 7970 653d 6f70 5f6e 6f64 6573 2c20  _type=op_nodes, 
-0000dbc0: 6865 6c70 3d22 2229 0d0a 2020 2020 6465  help="")..    de
-0000dbd0: 6620 6164 645f 6f70 6572 6174 696f 6e5f  f add_operation_
-0000dbe0: 646f 7473 286e 6f64 652c 202a 2a6b 7761  dots(node, **kwa
-0000dbf0: 7267 7329 3a0d 0a20 2020 2020 2020 2061  rgs):..        a
-0000dc00: 7070 656e 645f 6f70 6572 6174 696f 6e5f  ppend_operation_
-0000dc10: 646f 7473 286e 6f64 652c 2070 6f73 3d61  dots(node, pos=a
-0000dc20: 6464 5f61 6674 6572 5f69 6e64 6578 286e  dd_after_index(n
-0000dc30: 6f64 6529 2c20 2a2a 6b77 6172 6773 290d  ode), **kwargs).
-0000dc40: 0a0d 0a20 2020 2040 7472 6565 5f73 7562  ...    @tree_sub
-0000dc50: 6d65 6e75 285f 2822 496e 7365 7274 2073  menu(_("Insert s
-0000dc60: 7065 6369 616c 206f 7065 7261 7469 6f6e  pecial operation
-0000dc70: 2873 2922 2929 0d0a 2020 2020 4074 7265  (s)"))..    @tre
-0000dc80: 655f 6f70 6572 6174 696f 6e28 5f28 2241  e_operation(_("A
-0000dc90: 6464 2048 6f6d 6522 292c 206e 6f64 655f  dd Home"), node_
-0000dca0: 7479 7065 3d6f 705f 6e6f 6465 732c 2068  type=op_nodes, h
-0000dcb0: 656c 703d 2222 290d 0a20 2020 2064 6566  elp="")..    def
-0000dcc0: 2061 6464 5f6f 7065 7261 7469 6f6e 5f68   add_operation_h
-0000dcd0: 6f6d 6528 6e6f 6465 2c20 2a2a 6b77 6172  ome(node, **kwar
-0000dce0: 6773 293a 0d0a 2020 2020 2020 2020 6170  gs):..        ap
-0000dcf0: 7065 6e64 5f6f 7065 7261 7469 6f6e 5f68  pend_operation_h
-0000dd00: 6f6d 6528 6e6f 6465 2c20 706f 733d 6164  ome(node, pos=ad
-0000dd10: 645f 6166 7465 725f 696e 6465 7828 6e6f  d_after_index(no
-0000dd20: 6465 292c 202a 2a6b 7761 7267 7329 0d0a  de), **kwargs)..
-0000dd30: 0d0a 2020 2020 4074 7265 655f 7375 626d  ..    @tree_subm
-0000dd40: 656e 7528 5f28 2249 6e73 6572 7420 7370  enu(_("Insert sp
-0000dd50: 6563 6961 6c20 6f70 6572 6174 696f 6e28  ecial operation(
-0000dd60: 7329 2229 290d 0a20 2020 2040 7472 6565  s)"))..    @tree
-0000dd70: 5f6f 7065 7261 7469 6f6e 285f 2822 4164  _operation(_("Ad
-0000dd80: 6420 5265 7475 726e 2074 6f20 4f72 6967  d Return to Orig
-0000dd90: 696e 2229 2c20 6e6f 6465 5f74 7970 653d  in"), node_type=
-0000dda0: 6f70 5f6e 6f64 6573 2c20 6865 6c70 3d22  op_nodes, help="
-0000ddb0: 2229 0d0a 2020 2020 6465 6620 6164 645f  ")..    def add_
-0000ddc0: 6f70 6572 6174 696f 6e5f 6f72 6967 696e  operation_origin
-0000ddd0: 286e 6f64 652c 202a 2a6b 7761 7267 7329  (node, **kwargs)
-0000dde0: 3a0d 0a20 2020 2020 2020 2061 7070 656e  :..        appen
-0000ddf0: 645f 6f70 6572 6174 696f 6e5f 676f 746f  d_operation_goto
-0000de00: 286e 6f64 652c 2070 6f73 3d61 6464 5f61  (node, pos=add_a
-0000de10: 6674 6572 5f69 6e64 6578 286e 6f64 6529  fter_index(node)
-0000de20: 2c20 2a2a 6b77 6172 6773 290d 0a0d 0a20  , **kwargs).... 
-0000de30: 2020 2040 7472 6565 5f73 7562 6d65 6e75     @tree_submenu
-0000de40: 285f 2822 496e 7365 7274 2073 7065 6369  (_("Insert speci
-0000de50: 616c 206f 7065 7261 7469 6f6e 2873 2922  al operation(s)"
-0000de60: 2929 0d0a 2020 2020 4074 7265 655f 6f70  ))..    @tree_op
-0000de70: 6572 6174 696f 6e28 5f28 2241 6464 2042  eration(_("Add B
-0000de80: 6565 7022 292c 206e 6f64 655f 7479 7065  eep"), node_type
-0000de90: 3d6f 705f 6e6f 6465 732c 2068 656c 703d  =op_nodes, help=
-0000dea0: 2222 290d 0a20 2020 2064 6566 2061 6464  "")..    def add
-0000deb0: 5f6f 7065 7261 7469 6f6e 5f62 6565 7028  _operation_beep(
-0000dec0: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
-0000ded0: 0d0a 2020 2020 2020 2020 6170 7065 6e64  ..        append
-0000dee0: 5f6f 7065 7261 7469 6f6e 5f62 6565 7028  _operation_beep(
-0000def0: 6e6f 6465 2c20 706f 733d 6164 645f 6166  node, pos=add_af
-0000df00: 7465 725f 696e 6465 7828 6e6f 6465 292c  ter_index(node),
-0000df10: 202a 2a6b 7761 7267 7329 0d0a 0d0a 2020   **kwargs)....  
-0000df20: 2020 4074 7265 655f 7375 626d 656e 7528    @tree_submenu(
-0000df30: 5f28 2249 6e73 6572 7420 7370 6563 6961  _("Insert specia
-0000df40: 6c20 6f70 6572 6174 696f 6e28 7329 2229  l operation(s)")
-0000df50: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
-0000df60: 7261 7469 6f6e 285f 2822 4164 6420 496e  ration(_("Add In
-0000df70: 7465 7272 7570 7422 292c 206e 6f64 655f  terrupt"), node_
-0000df80: 7479 7065 3d6f 705f 6e6f 6465 732c 2068  type=op_nodes, h
-0000df90: 656c 703d 2222 290d 0a20 2020 2064 6566  elp="")..    def
-0000dfa0: 2061 6464 5f6f 7065 7261 7469 6f6e 5f69   add_operation_i
-0000dfb0: 6e74 6572 7275 7074 286e 6f64 652c 202a  nterrupt(node, *
-0000dfc0: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
-0000dfd0: 2020 2061 7070 656e 645f 6f70 6572 6174     append_operat
-0000dfe0: 696f 6e5f 696e 7465 7272 7570 7428 6e6f  ion_interrupt(no
-0000dff0: 6465 2c20 706f 733d 6164 645f 6166 7465  de, pos=add_afte
-0000e000: 725f 696e 6465 7828 6e6f 6465 292c 202a  r_index(node), *
-0000e010: 2a6b 7761 7267 7329 0d0a 0d0a 2020 2020  *kwargs)....    
-0000e020: 4074 7265 655f 7375 626d 656e 7528 5f28  @tree_submenu(_(
-0000e030: 2249 6e73 6572 7420 7370 6563 6961 6c20  "Insert special 
-0000e040: 6f70 6572 6174 696f 6e28 7329 2229 290d  operation(s)")).
-0000e050: 0a20 2020 2040 7472 6565 5f70 726f 6d70  .    @tree_promp
-0000e060: 7428 2277 6169 745f 7469 6d65 222c 205f  t("wait_time", _
-0000e070: 2822 5761 6974 2066 6f72 2068 6f77 206c  ("Wait for how l
-0000e080: 6f6e 6720 2869 6e20 7365 636f 6e64 7329  ong (in seconds)
-0000e090: 3f22 292c 2064 6174 615f 7479 7065 3d66  ?"), data_type=f
-0000e0a0: 6c6f 6174 290d 0a20 2020 2040 7472 6565  loat)..    @tree
-0000e0b0: 5f6f 7065 7261 7469 6f6e 285f 2822 4164  _operation(_("Ad
-0000e0c0: 6420 5761 6974 2229 2c20 6e6f 6465 5f74  d Wait"), node_t
-0000e0d0: 7970 653d 6f70 5f6e 6f64 6573 2c20 6865  ype=op_nodes, he
-0000e0e0: 6c70 3d22 2229 0d0a 2020 2020 6465 6620  lp="")..    def 
-0000e0f0: 6164 645f 6f70 6572 6174 696f 6e5f 7761  add_operation_wa
-0000e100: 6974 286e 6f64 652c 2077 6169 745f 7469  it(node, wait_ti
-0000e110: 6d65 2c20 2a2a 6b77 6172 6773 293a 0d0a  me, **kwargs):..
-0000e120: 2020 2020 2020 2020 6170 7065 6e64 5f6f          append_o
-0000e130: 7065 7261 7469 6f6e 5f77 6169 7428 0d0a  peration_wait(..
-0000e140: 2020 2020 2020 2020 2020 2020 6e6f 6465              node
-0000e150: 2c20 7761 6974 5f74 696d 653d 7761 6974  , wait_time=wait
-0000e160: 5f74 696d 652c 2070 6f73 3d61 6464 5f61  _time, pos=add_a
-0000e170: 6674 6572 5f69 6e64 6578 286e 6f64 6529  fter_index(node)
-0000e180: 2c20 2a2a 6b77 6172 6773 0d0a 2020 2020  , **kwargs..    
-0000e190: 2020 2020 290d 0a0d 0a20 2020 2040 7472      )....    @tr
-0000e1a0: 6565 5f73 7562 6d65 6e75 285f 2822 496e  ee_submenu(_("In
-0000e1b0: 7365 7274 2073 7065 6369 616c 206f 7065  sert special ope
-0000e1c0: 7261 7469 6f6e 2873 2922 2929 0d0a 2020  ration(s)"))..  
-0000e1d0: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
-0000e1e0: 6e28 5f28 2241 6464 204f 7574 7075 7422  n(_("Add Output"
-0000e1f0: 292c 206e 6f64 655f 7479 7065 3d6f 705f  ), node_type=op_
-0000e200: 6e6f 6465 732c 2068 656c 703d 2222 290d  nodes, help="").
-0000e210: 0a20 2020 2064 6566 2061 6464 5f6f 7065  .    def add_ope
-0000e220: 7261 7469 6f6e 5f6f 7574 7075 7428 6e6f  ration_output(no
-0000e230: 6465 2c20 2a2a 6b77 6172 6773 293a 0d0a  de, **kwargs):..
-0000e240: 2020 2020 2020 2020 6170 7065 6e64 5f6f          append_o
-0000e250: 7065 7261 7469 6f6e 5f6f 7574 7075 7428  peration_output(
-0000e260: 6e6f 6465 2c20 706f 733d 6164 645f 6166  node, pos=add_af
-0000e270: 7465 725f 696e 6465 7828 6e6f 6465 292c  ter_index(node),
-0000e280: 202a 2a6b 7761 7267 7329 0d0a 0d0a 2020   **kwargs)....  
-0000e290: 2020 4074 7265 655f 7375 626d 656e 7528    @tree_submenu(
-0000e2a0: 5f28 2249 6e73 6572 7420 7370 6563 6961  _("Insert specia
-0000e2b0: 6c20 6f70 6572 6174 696f 6e28 7329 2229  l operation(s)")
-0000e2c0: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
-0000e2d0: 7261 7469 6f6e 285f 2822 4164 6420 496e  ration(_("Add In
-0000e2e0: 7075 7422 292c 206e 6f64 655f 7479 7065  put"), node_type
-0000e2f0: 3d6f 705f 6e6f 6465 732c 2068 656c 703d  =op_nodes, help=
-0000e300: 2222 290d 0a20 2020 2064 6566 2061 6464  "")..    def add
-0000e310: 5f6f 7065 7261 7469 6f6e 5f69 6e70 7574  _operation_input
-0000e320: 286e 6f64 652c 202a 2a6b 7761 7267 7329  (node, **kwargs)
-0000e330: 3a0d 0a20 2020 2020 2020 2061 7070 656e  :..        appen
-0000e340: 645f 6f70 6572 6174 696f 6e5f 696e 7075  d_operation_inpu
-0000e350: 7428 6e6f 6465 2c20 706f 733d 6164 645f  t(node, pos=add_
-0000e360: 6166 7465 725f 696e 6465 7828 6e6f 6465  after_index(node
-0000e370: 292c 202a 2a6b 7761 7267 7329 0d0a 0d0a  ), **kwargs)....
-0000e380: 2020 2020 4074 7265 655f 7375 626d 656e      @tree_submen
-0000e390: 7528 5f28 2249 6e73 6572 7420 7370 6563  u(_("Insert spec
-0000e3a0: 6961 6c20 6f70 6572 6174 696f 6e28 7329  ial operation(s)
-0000e3b0: 2229 290d 0a20 2020 2040 7472 6565 5f6f  "))..    @tree_o
-0000e3c0: 7065 7261 7469 6f6e 285f 2822 4164 6420  peration(_("Add 
-0000e3d0: 486f 6d65 2f42 6565 702f 496e 7465 7272  Home/Beep/Interr
-0000e3e0: 7570 7422 292c 206e 6f64 655f 7479 7065  upt"), node_type
-0000e3f0: 3d6f 705f 6e6f 6465 732c 2068 656c 703d  =op_nodes, help=
-0000e400: 2222 290d 0a20 2020 2064 6566 2061 6464  "")..    def add
-0000e410: 5f6f 7065 7261 7469 6f6e 5f68 6f6d 655f  _operation_home_
-0000e420: 6265 6570 5f69 6e74 6572 7275 7074 286e  beep_interrupt(n
-0000e430: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
-0000e440: 0a20 2020 2020 2020 2070 6f73 203d 2061  .        pos = a
-0000e450: 6464 5f61 6674 6572 5f69 6e64 6578 286e  dd_after_index(n
-0000e460: 6f64 6529 0d0a 2020 2020 2020 2020 6170  ode)..        ap
-0000e470: 7065 6e64 5f6f 7065 7261 7469 6f6e 5f68  pend_operation_h
-0000e480: 6f6d 6528 6e6f 6465 2c20 706f 733d 706f  ome(node, pos=po
-0000e490: 732c 202a 2a6b 7761 7267 7329 0d0a 2020  s, **kwargs)..  
-0000e4a0: 2020 2020 2020 6966 2070 6f73 3a0d 0a20        if pos:.. 
-0000e4b0: 2020 2020 2020 2020 2020 2070 6f73 202b             pos +
-0000e4c0: 3d20 310d 0a20 2020 2020 2020 2061 7070  = 1..        app
-0000e4d0: 656e 645f 6f70 6572 6174 696f 6e5f 6265  end_operation_be
-0000e4e0: 6570 286e 6f64 652c 2070 6f73 3d70 6f73  ep(node, pos=pos
-0000e4f0: 2c20 2a2a 6b77 6172 6773 290d 0a20 2020  , **kwargs)..   
-0000e500: 2020 2020 2069 6620 706f 733a 0d0a 2020       if pos:..  
-0000e510: 2020 2020 2020 2020 2020 706f 7320 2b3d            pos +=
-0000e520: 2031 0d0a 2020 2020 2020 2020 6170 7065   1..        appe
-0000e530: 6e64 5f6f 7065 7261 7469 6f6e 5f69 6e74  nd_operation_int
-0000e540: 6572 7275 7074 286e 6f64 652c 2070 6f73  errupt(node, pos
-0000e550: 3d70 6f73 2c20 2a2a 6b77 6172 6773 290d  =pos, **kwargs).
-0000e560: 0a0d 0a20 2020 2040 7472 6565 5f73 7562  ...    @tree_sub
-0000e570: 6d65 6e75 285f 2822 496e 7365 7274 2073  menu(_("Insert s
-0000e580: 7065 6369 616c 206f 7065 7261 7469 6f6e  pecial operation
-0000e590: 2873 2922 2929 0d0a 2020 2020 4074 7265  (s)"))..    @tre
-0000e5a0: 655f 6f70 6572 6174 696f 6e28 5f28 2241  e_operation(_("A
-0000e5b0: 6464 204f 7269 6769 6e2f 4265 6570 2f49  dd Origin/Beep/I
-0000e5c0: 6e74 6572 7275 7074 2229 2c20 6e6f 6465  nterrupt"), node
-0000e5d0: 5f74 7970 653d 6f70 5f6e 6f64 6573 2c20  _type=op_nodes, 
-0000e5e0: 6865 6c70 3d22 2229 0d0a 2020 2020 6465  help="")..    de
-0000e5f0: 6620 6164 645f 6f70 6572 6174 696f 6e5f  f add_operation_
-0000e600: 6f72 6967 696e 5f62 6565 705f 696e 7465  origin_beep_inte
-0000e610: 7272 7570 7428 6e6f 6465 2c20 2a2a 6b77  rrupt(node, **kw
-0000e620: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
-0000e630: 706f 7320 3d20 6164 645f 6166 7465 725f  pos = add_after_
-0000e640: 696e 6465 7828 6e6f 6465 290d 0a20 2020  index(node)..   
-0000e650: 2020 2020 2061 7070 656e 645f 6f70 6572       append_oper
-0000e660: 6174 696f 6e5f 676f 746f 286e 6f64 652c  ation_goto(node,
-0000e670: 2070 6f73 3d70 6f73 2c20 2a2a 6b77 6172   pos=pos, **kwar
-0000e680: 6773 290d 0a20 2020 2020 2020 2069 6620  gs)..        if 
-0000e690: 706f 733a 0d0a 2020 2020 2020 2020 2020  pos:..          
-0000e6a0: 2020 706f 7320 2b3d 2031 0d0a 2020 2020    pos += 1..    
-0000e6b0: 2020 2020 6170 7065 6e64 5f6f 7065 7261      append_opera
-0000e6c0: 7469 6f6e 5f62 6565 7028 6e6f 6465 2c20  tion_beep(node, 
-0000e6d0: 706f 733d 706f 732c 202a 2a6b 7761 7267  pos=pos, **kwarg
-0000e6e0: 7329 0d0a 2020 2020 2020 2020 6966 2070  s)..        if p
-0000e6f0: 6f73 3a0d 0a20 2020 2020 2020 2020 2020  os:..           
-0000e700: 2070 6f73 202b 3d20 310d 0a20 2020 2020   pos += 1..     
-0000e710: 2020 2061 7070 656e 645f 6f70 6572 6174     append_operat
-0000e720: 696f 6e5f 696e 7465 7272 7570 7428 6e6f  ion_interrupt(no
-0000e730: 6465 2c20 706f 733d 706f 732c 202a 2a6b  de, pos=pos, **k
-0000e740: 7761 7267 7329 0d0a 0d0a 2020 2020 4074  wargs)....    @t
-0000e750: 7265 655f 6f70 6572 6174 696f 6e28 5f28  ree_operation(_(
-0000e760: 2252 656c 6f61 6420 277b 6e61 6d65 7d27  "Reload '{name}'
-0000e770: 2229 2c20 6e6f 6465 5f74 7970 653d 2266  "), node_type="f
-0000e780: 696c 6522 2c20 6865 6c70 3d22 2229 0d0a  ile", help="")..
-0000e790: 2020 2020 6465 6620 7265 6c6f 6164 5f66      def reload_f
-0000e7a0: 696c 6528 6e6f 6465 2c20 2a2a 6b77 6172  ile(node, **kwar
-0000e7b0: 6773 293a 0d0a 2020 2020 2020 2020 6669  gs):..        fi
-0000e7c0: 6c65 7061 7468 203d 206e 6f64 652e 6669  lepath = node.fi
-0000e7d0: 6c65 7061 7468 0d0a 2020 2020 2020 2020  lepath..        
-0000e7e0: 6e6f 6465 2e72 656d 6f76 655f 6e6f 6465  node.remove_node
-0000e7f0: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
-0000e800: 2e6c 6f61 6428 6669 6c65 7061 7468 290d  .load(filepath).
-0000e810: 0a0d 0a20 2020 2040 7472 6565 5f6f 7065  ...    @tree_ope
-0000e820: 7261 7469 6f6e 280d 0a20 2020 2020 2020  ration(..       
-0000e830: 205f 2822 4f70 656e 2069 6e20 5379 7374   _("Open in Syst
-0000e840: 656d 3a20 277b 6e61 6d65 7d27 2229 2c0d  em: '{name}'"),.
-0000e850: 0a20 2020 2020 2020 206e 6f64 655f 7479  .        node_ty
-0000e860: 7065 3d22 6669 6c65 222c 0d0a 2020 2020  pe="file",..    
-0000e870: 2020 2020 6865 6c70 3d5f 280d 0a20 2020      help=_(..   
-0000e880: 2020 2020 2020 2020 2022 4f70 656e 2074           "Open t
-0000e890: 6869 7320 6669 6c65 2069 6e20 7468 6520  his file in the 
-0000e8a0: 7379 7374 656d 2061 7070 6c69 6361 7469  system applicati
-0000e8b0: 6f6e 2061 7373 6f63 6961 7465 6420 7769  on associated wi
-0000e8c0: 7468 2074 6869 7320 7479 7065 206f 6620  th this type of 
-0000e8d0: 6669 6c65 220d 0a20 2020 2020 2020 2029  file"..        )
-0000e8e0: 2c0d 0a20 2020 2029 0d0a 2020 2020 6465  ,..    )..    de
-0000e8f0: 6620 6f70 656e 5f73 7973 7465 6d5f 6669  f open_system_fi
-0000e900: 6c65 286e 6f64 652c 202a 2a6b 7761 7267  le(node, **kwarg
-0000e910: 7329 3a0d 0a20 2020 2020 2020 2066 696c  s):..        fil
-0000e920: 6570 6174 6820 3d20 6e6f 6465 2e66 696c  epath = node.fil
-0000e930: 6570 6174 680d 0a20 2020 2020 2020 206e  epath..        n
-0000e940: 6f72 6d61 6c69 7a65 6420 3d20 6f73 2e70  ormalized = os.p
-0000e950: 6174 682e 7265 616c 7061 7468 2866 696c  ath.realpath(fil
-0000e960: 6570 6174 6829 0d0a 0d0a 2020 2020 2020  epath)....      
-0000e970: 2020 696d 706f 7274 2070 6c61 7466 6f72    import platfor
-0000e980: 6d0d 0a0d 0a20 2020 2020 2020 2073 7973  m....        sys
-0000e990: 7465 6d20 3d20 706c 6174 666f 726d 2e73  tem = platform.s
-0000e9a0: 7973 7465 6d28 290d 0a20 2020 2020 2020  ystem()..       
-0000e9b0: 2069 6620 7379 7374 656d 203d 3d20 2244   if system == "D
-0000e9c0: 6172 7769 6e22 3a0d 0a20 2020 2020 2020  arwin":..       
-0000e9d0: 2020 2020 2066 726f 6d20 6f73 2069 6d70       from os imp
-0000e9e0: 6f72 7420 7379 7374 656d 2061 7320 6f70  ort system as op
-0000e9f0: 656e 5f69 6e5f 7368 656c 6c0d 0a0d 0a20  en_in_shell.... 
-0000ea00: 2020 2020 2020 2020 2020 206f 7065 6e5f             open_
-0000ea10: 696e 5f73 6865 6c6c 2866 226f 7065 6e20  in_shell(f"open 
-0000ea20: 277b 6e6f 726d 616c 697a 6564 7d27 2229  '{normalized}'")
-0000ea30: 0d0a 2020 2020 2020 2020 656c 6966 2073  ..        elif s
-0000ea40: 7973 7465 6d20 3d3d 2022 5769 6e64 6f77  ystem == "Window
-0000ea50: 7322 3a0d 0a20 2020 2020 2020 2020 2020  s":..           
-0000ea60: 2066 726f 6d20 6f73 2069 6d70 6f72 7420   from os import 
-0000ea70: 7374 6172 7466 696c 6520 6173 206f 7065  startfile as ope
-0000ea80: 6e5f 696e 5f73 6865 6c6c 0d0a 0d0a 2020  n_in_shell....  
-0000ea90: 2020 2020 2020 2020 2020 6f70 656e 5f69            open_i
-0000eaa0: 6e5f 7368 656c 6c28 6627 227b 6e6f 726d  n_shell(f'"{norm
-0000eab0: 616c 697a 6564 7d22 2729 0d0a 2020 2020  alized}"')..    
-0000eac0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-0000ead0: 2020 2020 2020 2066 726f 6d20 6f73 2069         from os i
-0000eae0: 6d70 6f72 7420 7379 7374 656d 2061 7320  mport system as 
-0000eaf0: 6f70 656e 5f69 6e5f 7368 656c 6c0d 0a0d  open_in_shell...
-0000eb00: 0a20 2020 2020 2020 2020 2020 206f 7065  .            ope
-0000eb10: 6e5f 696e 5f73 6865 6c6c 2866 2278 6467  n_in_shell(f"xdg
-0000eb20: 2d6f 7065 6e20 277b 6e6f 726d 616c 697a  -open '{normaliz
-0000eb30: 6564 7d27 2229 0d0a 0d0a 2020 2020 6465  ed}'")....    de
-0000eb40: 6620 6765 745f 7661 6c75 6573 2829 3a0d  f get_values():.
-0000eb50: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000eb60: 5b6f 2066 6f72 206f 2069 6e20 7365 6c66  [o for o in self
-0000eb70: 2e6f 7073 2829 2069 6620 6f2e 7479 7065  .ops() if o.type
-0000eb80: 2e73 7461 7274 7377 6974 6828 226f 7022  .startswith("op"
-0000eb90: 295d 0d0a 0d0a 2020 2020 4074 7265 655f  )]....    @tree_
-0000eba0: 636f 6e64 6974 696f 6e61 6c28 6c61 6d62  conditional(lamb
-0000ebb0: 6461 206e 6f64 653a 206e 6f74 2069 735f  da node: not is_
-0000ebc0: 7265 676d 6172 6b28 6e6f 6465 2929 0d0a  regmark(node))..
-0000ebd0: 2020 2020 4074 7265 655f 7375 626d 656e      @tree_submen
-0000ebe0: 7528 5f28 2241 7373 6967 6e20 4f70 6572  u(_("Assign Oper
-0000ebf0: 6174 696f 6e22 2929 0d0a 2020 2020 4074  ation"))..    @t
-0000ec00: 7265 655f 7661 6c75 6573 2822 6f70 5f61  ree_values("op_a
-0000ec10: 7373 6967 6e22 2c20 7661 6c75 6573 3d67  ssign", values=g
-0000ec20: 6574 5f76 616c 7565 7329 0d0a 2020 2020  et_values)..    
-0000ec30: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
-0000ec40: 227b 6f70 5f61 7373 6967 6e7d 222c 206e  "{op_assign}", n
-0000ec50: 6f64 655f 7479 7065 3d65 6c65 6d5f 6e6f  ode_type=elem_no
-0000ec60: 6465 732c 2068 656c 703d 2222 290d 0a20  des, help="").. 
-0000ec70: 2020 2064 6566 206d 656e 755f 6173 7369     def menu_assi
-0000ec80: 676e 5f6f 7065 7261 7469 6f6e 7328 6e6f  gn_operations(no
-0000ec90: 6465 2c20 6f70 5f61 7373 6967 6e2c 202a  de, op_assign, *
-0000eca0: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
-0000ecb0: 2020 2069 6620 7365 6c66 2e63 6c61 7373     if self.class
-0000ecc0: 6966 795f 696e 6865 7269 745f 7374 726f  ify_inherit_stro
-0000ecd0: 6b65 3a0d 0a20 2020 2020 2020 2020 2020  ke:..           
-0000ece0: 2069 6d70 6f73 6520 3d20 2274 6f5f 6f70   impose = "to_op
-0000ecf0: 220d 0a20 2020 2020 2020 2020 2020 2061  "..            a
-0000ed00: 7474 7269 6220 3d20 2273 7472 6f6b 6522  ttrib = "stroke"
-0000ed10: 0d0a 2020 2020 2020 2020 2020 2020 7369  ..            si
-0000ed20: 6d69 6c61 7220 3d20 5472 7565 0d0a 2020  milar = True..  
-0000ed30: 2020 2020 2020 656c 6966 2073 656c 662e        elif self.
-0000ed40: 636c 6173 7369 6679 5f69 6e68 6572 6974  classify_inherit
-0000ed50: 5f66 696c 6c3a 0d0a 2020 2020 2020 2020  _fill:..        
-0000ed60: 2020 2020 696d 706f 7365 203d 2022 746f      impose = "to
-0000ed70: 5f6f 7022 0d0a 2020 2020 2020 2020 2020  _op"..          
-0000ed80: 2020 6174 7472 6962 203d 2022 6669 6c6c    attrib = "fill
-0000ed90: 220d 0a20 2020 2020 2020 2020 2020 2073  "..            s
-0000eda0: 696d 696c 6172 203d 2054 7275 650d 0a20  imilar = True.. 
-0000edb0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-0000edc0: 2020 2020 2020 2020 2020 696d 706f 7365            impose
-0000edd0: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
-0000ede0: 2020 2020 2061 7474 7269 6220 3d20 4e6f       attrib = No
-0000edf0: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
-0000ee00: 7369 6d69 6c61 7220 3d20 4661 6c73 650d  similar = False.
-0000ee10: 0a20 2020 2020 2020 2065 7863 6c75 7369  .        exclusi
-0000ee20: 7665 203d 2073 656c 662e 636c 6173 7369  ve = self.classi
-0000ee30: 6679 5f69 6e68 6572 6974 5f65 7863 6c75  fy_inherit_exclu
-0000ee40: 7369 7665 0d0a 2020 2020 2020 2020 6461  sive..        da
-0000ee50: 7461 203d 206c 6973 7428 7365 6c66 2e65  ta = list(self.e
-0000ee60: 6c65 6d73 2865 6d70 6861 7369 7a65 643d  lems(emphasized=
-0000ee70: 5472 7565 2929 0d0a 2020 2020 2020 2020  True))..        
-0000ee80: 7365 6c66 2e61 7373 6967 6e5f 6f70 6572  self.assign_oper
-0000ee90: 6174 696f 6e28 0d0a 2020 2020 2020 2020  ation(..        
-0000eea0: 2020 2020 6f70 5f61 7373 6967 6e3d 6f70      op_assign=op
-0000eeb0: 5f61 7373 6967 6e2c 0d0a 2020 2020 2020  _assign,..      
-0000eec0: 2020 2020 2020 6461 7461 3d64 6174 612c        data=data,
-0000eed0: 0d0a 2020 2020 2020 2020 2020 2020 696d  ..            im
-0000eee0: 706f 7365 3d69 6d70 6f73 652c 0d0a 2020  pose=impose,..  
-0000eef0: 2020 2020 2020 2020 2020 6174 7472 6962            attrib
-0000ef00: 3d61 7474 7269 622c 0d0a 2020 2020 2020  =attrib,..      
-0000ef10: 2020 2020 2020 7369 6d69 6c61 723d 7369        similar=si
-0000ef20: 6d69 6c61 722c 0d0a 2020 2020 2020 2020  milar,..        
-0000ef30: 2020 2020 6578 636c 7573 6976 653d 6578      exclusive=ex
-0000ef40: 636c 7573 6976 652c 0d0a 2020 2020 2020  clusive,..      
-0000ef50: 2020 290d 0a0d 0a20 2020 2064 6566 2065    )....    def e
-0000ef60: 7863 6c75 7369 7665 5f6d 6174 6368 286e  xclusive_match(n
-0000ef70: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
-0000ef80: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000ef90: 7365 6c66 2e63 6c61 7373 6966 795f 696e  self.classify_in
-0000efa0: 6865 7269 745f 6578 636c 7573 6976 650d  herit_exclusive.
-0000efb0: 0a0d 0a20 2020 2040 7472 6565 5f73 6570  ...    @tree_sep
-0000efc0: 6172 6174 6f72 5f62 6566 6f72 6528 290d  arator_before().
-0000efd0: 0a20 2020 2040 7472 6565 5f73 7562 6d65  .    @tree_subme
-0000efe0: 6e75 285f 2822 4173 7369 676e 204f 7065  nu(_("Assign Ope
-0000eff0: 7261 7469 6f6e 2229 290d 0a20 2020 2040  ration"))..    @
-0000f000: 7472 6565 5f6f 7065 7261 7469 6f6e 280d  tree_operation(.
-0000f010: 0a20 2020 2020 2020 205f 2822 5265 6d6f  .        _("Remo
-0000f020: 7665 2061 6c6c 2061 7373 6967 6e6d 656e  ve all assignmen
-0000f030: 7473 2066 726f 6d20 6f70 6572 6174 696f  ts from operatio
-0000f040: 6e73 2229 2c0d 0a20 2020 2020 2020 206e  ns"),..        n
-0000f050: 6f64 655f 7479 7065 3d65 6c65 6d5f 6772  ode_type=elem_gr
-0000f060: 6f75 705f 6e6f 6465 732c 0d0a 2020 2020  oup_nodes,..    
-0000f070: 2020 2020 6865 6c70 3d5f 2822 416e 7920      help=_("Any 
-0000f080: 6578 6973 7469 6e67 2061 7373 6967 6e6d  existing assignm
-0000f090: 656e 7420 6f66 2074 6869 7320 656c 656d  ent of this elem
-0000f0a0: 656e 7420 746f 206f 7065 7261 7469 6f6e  ent to operation
-0000f0b0: 7320 7769 6c6c 2062 6520 7265 6d6f 7665  s will be remove
-0000f0c0: 6422 292c 0d0a 2020 2020 290d 0a20 2020  d"),..    )..   
-0000f0d0: 2064 6566 2072 656d 6f76 655f 6173 7369   def remove_assi
-0000f0e0: 676e 6d65 6e74 7328 7369 6e67 6c65 6e6f  gnments(singleno
-0000f0f0: 6465 2c20 2a2a 6b77 6172 6773 293a 0d0a  de, **kwargs):..
-0000f100: 2020 2020 2020 2020 6465 6620 7265 6d5f          def rem_
-0000f110: 6e6f 6465 2872 6e6f 6465 293a 0d0a 2020  node(rnode):..  
-0000f120: 2020 2020 2020 2020 2020 2320 7265 6375            # recu
-0000f130: 7273 6976 656c 7920 7265 6d6f 7665 2061  rsively remove a
-0000f140: 7373 6967 6e6d 656e 7473 2e2e 2e0d 0a20  ssignments..... 
-0000f150: 2020 2020 2020 2020 2020 2069 6620 726e             if rn
-0000f160: 6f64 652e 7479 7065 2069 6e20 2822 6669  ode.type in ("fi
-0000f170: 6c65 222c 2022 6772 6f75 7022 293a 0d0a  le", "group"):..
-0000f180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f190: 666f 7220 636e 6f64 6520 696e 206c 6973  for cnode in lis
-0000f1a0: 7428 726e 6f64 652e 5f63 6869 6c64 7265  t(rnode._childre
-0000f1b0: 6e29 3a0d 0a20 2020 2020 2020 2020 2020  n):..           
-0000f1c0: 2020 2020 2020 2020 2072 656d 5f6e 6f64           rem_nod
-0000f1d0: 6528 636e 6f64 6529 0d0a 2020 2020 2020  e(cnode)..      
-0000f1e0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-0000f1f0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0000f200: 2072 6566 2069 6e20 6c69 7374 2872 6e6f   ref in list(rno
-0000f210: 6465 2e72 6566 6572 656e 6365 7329 3a0d  de.references):.
-0000f220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f230: 2020 2020 2072 6566 2e72 656d 6f76 655f       ref.remove_
-0000f240: 6e6f 6465 2829 0d0a 0d0a 2020 2020 2020  node()....      
-0000f250: 2020 7769 7468 2073 656c 662e 7374 6174    with self.stat
-0000f260: 6963 2822 7265 6d6f 7665 5f61 7373 6967  ic("remove_assig
-0000f270: 6e22 293a 0d0a 2020 2020 2020 2020 2020  n"):..          
-0000f280: 2020 666f 7220 6e6f 6465 2069 6e20 6c69    for node in li
-0000f290: 7374 2873 656c 662e 656c 656d 7328 656d  st(self.elems(em
-0000f2a0: 7068 6173 697a 6564 3d54 7275 6529 293a  phasized=True)):
-0000f2b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000f2c0: 2020 7265 6d5f 6e6f 6465 286e 6f64 6529    rem_node(node)
-0000f2d0: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
-0000f2e0: 6967 6e61 6c28 2272 6566 7265 7368 5f74  ignal("refresh_t
-0000f2f0: 7265 6522 290d 0a0d 0a20 2020 2040 7472  ree")....    @tr
-0000f300: 6565 5f73 6570 6172 6174 6f72 5f62 6566  ee_separator_bef
-0000f310: 6f72 6528 290d 0a20 2020 2040 7472 6565  ore()..    @tree
-0000f320: 5f73 7562 6d65 6e75 285f 2822 4173 7369  _submenu(_("Assi
-0000f330: 676e 204f 7065 7261 7469 6f6e 2229 290d  gn Operation")).
-0000f340: 0a20 2020 2040 7472 6565 5f63 6865 636b  .    @tree_check
-0000f350: 2865 7863 6c75 7369 7665 5f6d 6174 6368  (exclusive_match
-0000f360: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
-0000f370: 7261 7469 6f6e 280d 0a20 2020 2020 2020  ration(..       
-0000f380: 205f 2822 4578 636c 7573 6976 6520 6173   _("Exclusive as
-0000f390: 7369 676e 6d65 6e74 2229 2c0d 0a20 2020  signment"),..   
-0000f3a0: 2020 2020 206e 6f64 655f 7479 7065 3d65       node_type=e
-0000f3b0: 6c65 6d5f 6e6f 6465 732c 0d0a 2020 2020  lem_nodes,..    
-0000f3c0: 2020 2020 6865 6c70 3d5f 280d 0a20 2020      help=_(..   
-0000f3d0: 2020 2020 2020 2020 2022 416e 2061 7373           "An ass
-0000f3e0: 6967 6e6d 656e 7420 7769 6c6c 2072 656d  ignment will rem
-0000f3f0: 6f76 6520 616c 6c20 6f74 6865 7220 636c  ove all other cl
-0000f400: 6173 7369 6669 6361 7469 6f6e 7320 6f66  assifications of
-0000f410: 2074 6869 7320 656c 656d 656e 7420 6966   this element if
-0000f420: 2063 6865 636b 6564 220d 0a20 2020 2020   checked"..     
-0000f430: 2020 2029 2c0d 0a20 2020 2029 0d0a 2020     ),..    )..  
-0000f440: 2020 6465 6620 7365 745f 6173 7369 676e    def set_assign
-0000f450: 5f6f 7074 696f 6e5f 6578 636c 7573 6976  _option_exclusiv
-0000f460: 6528 6e6f 6465 2c20 2a2a 6b77 6172 6773  e(node, **kwargs
-0000f470: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
-0000f480: 2e63 6c61 7373 6966 795f 696e 6865 7269  .classify_inheri
-0000f490: 745f 6578 636c 7573 6976 6520 3d20 6e6f  t_exclusive = no
-0000f4a0: 7420 7365 6c66 2e63 6c61 7373 6966 795f  t self.classify_
-0000f4b0: 696e 6865 7269 745f 6578 636c 7573 6976  inherit_exclusiv
-0000f4c0: 650d 0a0d 0a20 2020 2064 6566 2073 7472  e....    def str
-0000f4d0: 6f6b 655f 6d61 7463 6828 6e6f 6465 2c20  oke_match(node, 
-0000f4e0: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
-0000f4f0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000f500: 636c 6173 7369 6679 5f69 6e68 6572 6974  classify_inherit
-0000f510: 5f73 7472 6f6b 650d 0a0d 0a20 2020 2040  _stroke....    @
-0000f520: 7472 6565 5f73 6570 6172 6174 6f72 5f62  tree_separator_b
-0000f530: 6566 6f72 6528 290d 0a20 2020 2040 7472  efore()..    @tr
-0000f540: 6565 5f73 7562 6d65 6e75 285f 2822 4173  ee_submenu(_("As
-0000f550: 7369 676e 204f 7065 7261 7469 6f6e 2229  sign Operation")
-0000f560: 290d 0a20 2020 2040 7472 6565 5f63 6865  )..    @tree_che
-0000f570: 636b 2873 7472 6f6b 655f 6d61 7463 6829  ck(stroke_match)
-0000f580: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
-0000f590: 6174 696f 6e28 0d0a 2020 2020 2020 2020  ation(..        
-0000f5a0: 5f28 2249 6e68 6572 6974 2073 7472 6f6b  _("Inherit strok
-0000f5b0: 6520 616e 6420 636c 6173 7369 6679 2073  e and classify s
-0000f5c0: 696d 696c 6172 2229 2c0d 0a20 2020 2020  imilar"),..     
-0000f5d0: 2020 206e 6f64 655f 7479 7065 3d65 6c65     node_type=ele
-0000f5e0: 6d5f 6e6f 6465 732c 0d0a 2020 2020 2020  m_nodes,..      
-0000f5f0: 2020 6865 6c70 3d5f 2822 4f70 6572 6174    help=_("Operat
-0000f600: 696f 6e20 7769 6c6c 2069 6e68 6572 6974  ion will inherit
-0000f610: 2065 6c65 6d65 6e74 2073 7472 6f6b 6520   element stroke 
-0000f620: 636f 6c6f 7222 292c 0d0a 2020 2020 290d  color"),..    ).
-0000f630: 0a20 2020 2064 6566 2073 6574 5f61 7373  .    def set_ass
-0000f640: 6967 6e5f 6f70 7469 6f6e 5f73 7472 6f6b  ign_option_strok
-0000f650: 6528 6e6f 6465 2c20 2a2a 6b77 6172 6773  e(node, **kwargs
-0000f660: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
-0000f670: 2e63 6c61 7373 6966 795f 696e 6865 7269  .classify_inheri
-0000f680: 745f 7374 726f 6b65 203d 206e 6f74 2073  t_stroke = not s
-0000f690: 656c 662e 636c 6173 7369 6679 5f69 6e68  elf.classify_inh
-0000f6a0: 6572 6974 5f73 7472 6f6b 650d 0a20 2020  erit_stroke..   
-0000f6b0: 2020 2020 2023 2050 6f6f 7220 6d61 6e73       # Poor mans
-0000f6c0: 2072 6164 696f 0d0a 2020 2020 2020 2020   radio..        
-0000f6d0: 6966 2073 656c 662e 636c 6173 7369 6679  if self.classify
-0000f6e0: 5f69 6e68 6572 6974 5f73 7472 6f6b 653a  _inherit_stroke:
-0000f6f0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0000f700: 6c66 2e63 6c61 7373 6966 795f 696e 6865  lf.classify_inhe
-0000f710: 7269 745f 6669 6c6c 203d 2046 616c 7365  rit_fill = False
-0000f720: 0d0a 0d0a 2020 2020 6465 6620 6669 6c6c  ....    def fill
-0000f730: 5f6d 6174 6368 286e 6f64 652c 202a 2a6b  _match(node, **k
-0000f740: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
-0000f750: 2072 6574 7572 6e20 7365 6c66 2e63 6c61   return self.cla
-0000f760: 7373 6966 795f 696e 6865 7269 745f 6669  ssify_inherit_fi
-0000f770: 6c6c 0d0a 0d0a 2020 2020 4074 7265 655f  ll....    @tree_
-0000f780: 7375 626d 656e 7528 5f28 2241 7373 6967  submenu(_("Assig
-0000f790: 6e20 4f70 6572 6174 696f 6e22 2929 0d0a  n Operation"))..
-0000f7a0: 2020 2020 4074 7265 655f 6368 6563 6b28      @tree_check(
-0000f7b0: 6669 6c6c 5f6d 6174 6368 290d 0a20 2020  fill_match)..   
-0000f7c0: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
-0000f7d0: 280d 0a20 2020 2020 2020 205f 2822 496e  (..        _("In
-0000f7e0: 6865 7269 7420 6669 6c6c 2061 6e64 2063  herit fill and c
-0000f7f0: 6c61 7373 6966 7920 7369 6d69 6c61 7222  lassify similar"
-0000f800: 292c 0d0a 2020 2020 2020 2020 6e6f 6465  ),..        node
-0000f810: 5f74 7970 653d 656c 656d 5f6e 6f64 6573  _type=elem_nodes
-0000f820: 2c0d 0a20 2020 2020 2020 2068 656c 703d  ,..        help=
-0000f830: 5f28 224f 7065 7261 7469 6f6e 2077 696c  _("Operation wil
-0000f840: 6c20 696e 6865 7269 7420 656c 656d 656e  l inherit elemen
-0000f850: 7420 6669 6c6c 2063 6f6c 6f72 2229 2c0d  t fill color"),.
-0000f860: 0a20 2020 2029 0d0a 2020 2020 6465 6620  .    )..    def 
-0000f870: 7365 745f 6173 7369 676e 5f6f 7074 696f  set_assign_optio
-0000f880: 6e5f 6669 6c6c 286e 6f64 652c 202a 2a6b  n_fill(node, **k
-0000f890: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
-0000f8a0: 2073 656c 662e 636c 6173 7369 6679 5f69   self.classify_i
-0000f8b0: 6e68 6572 6974 5f66 696c 6c20 3d20 6e6f  nherit_fill = no
-0000f8c0: 7420 7365 6c66 2e63 6c61 7373 6966 795f  t self.classify_
-0000f8d0: 696e 6865 7269 745f 6669 6c6c 0d0a 2020  inherit_fill..  
-0000f8e0: 2020 2020 2020 2320 506f 6f72 206d 616e        # Poor man
-0000f8f0: 7320 7261 6469 6f0d 0a20 2020 2020 2020  s radio..       
-0000f900: 2069 6620 7365 6c66 2e63 6c61 7373 6966   if self.classif
-0000f910: 795f 696e 6865 7269 745f 6669 6c6c 3a0d  y_inherit_fill:.
-0000f920: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000f930: 662e 636c 6173 7369 6679 5f69 6e68 6572  f.classify_inher
-0000f940: 6974 5f73 7472 6f6b 6520 3d20 4661 6c73  it_stroke = Fals
-0000f950: 650d 0a0d 0a20 2020 2040 7472 6565 5f63  e....    @tree_c
-0000f960: 6f6e 6469 7469 6f6e 616c 286c 616d 6264  onditional(lambd
-0000f970: 6120 6e6f 6465 3a20 6e6f 7420 6973 5f72  a node: not is_r
-0000f980: 6567 6d61 726b 286e 6f64 6529 290d 0a20  egmark(node)).. 
-0000f990: 2020 2040 7472 6565 5f73 7562 6d65 6e75     @tree_submenu
-0000f9a0: 285f 2822 4475 706c 6963 6174 6520 656c  (_("Duplicate el
-0000f9b0: 656d 656e 7428 7329 2229 290d 0a20 2020  ement(s)"))..   
-0000f9c0: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
-0000f9d0: 285f 2822 4d61 6b65 2031 2063 6f70 7922  (_("Make 1 copy"
-0000f9e0: 292c 206e 6f64 655f 7479 7065 3d65 6c65  ), node_type=ele
-0000f9f0: 6d5f 6e6f 6465 732c 2068 656c 703d 2222  m_nodes, help=""
-0000fa00: 290d 0a20 2020 2064 6566 2064 7570 6c69  )..    def dupli
-0000fa10: 6361 7465 5f65 6c65 6d65 6e74 5f31 286e  cate_element_1(n
-0000fa20: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
-0000fa30: 0a20 2020 2020 2020 2064 7570 6c69 6361  .        duplica
-0000fa40: 7465 5f65 6c65 6d65 6e74 5f6e 286e 6f64  te_element_n(nod
-0000fa50: 652c 2063 6f70 6965 733d 312c 202a 2a6b  e, copies=1, **k
-0000fa60: 7761 7267 7329 0d0a 0d0a 2020 2020 4074  wargs)....    @t
-0000fa70: 7265 655f 636f 6e64 6974 696f 6e61 6c28  ree_conditional(
-0000fa80: 6c61 6d62 6461 206e 6f64 653a 206e 6f74  lambda node: not
-0000fa90: 2069 735f 7265 676d 6172 6b28 6e6f 6465   is_regmark(node
-0000faa0: 2929 0d0a 2020 2020 4074 7265 655f 7375  ))..    @tree_su
-0000fab0: 626d 656e 7528 5f28 2244 7570 6c69 6361  bmenu(_("Duplica
-0000fac0: 7465 2065 6c65 6d65 6e74 2873 2922 2929  te element(s)"))
-0000fad0: 0d0a 2020 2020 4074 7265 655f 6974 6572  ..    @tree_iter
-0000fae0: 6174 6528 2263 6f70 6965 7322 2c20 322c  ate("copies", 2,
-0000faf0: 2031 3029 0d0a 2020 2020 4074 7265 655f   10)..    @tree_
-0000fb00: 6f70 6572 6174 696f 6e28 5f28 224d 616b  operation(_("Mak
-0000fb10: 6520 7b63 6f70 6965 737d 2063 6f70 6965  e {copies} copie
-0000fb20: 7322 292c 206e 6f64 655f 7479 7065 3d65  s"), node_type=e
-0000fb30: 6c65 6d5f 6e6f 6465 732c 2068 656c 703d  lem_nodes, help=
-0000fb40: 2222 290d 0a20 2020 2064 6566 2064 7570  "")..    def dup
-0000fb50: 6c69 6361 7465 5f65 6c65 6d65 6e74 5f6e  licate_element_n
-0000fb60: 286e 6f64 652c 2063 6f70 6965 732c 202a  (node, copies, *
-0000fb70: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
-0000fb80: 2020 2063 6f70 795f 6e6f 6465 7320 3d20     copy_nodes = 
-0000fb90: 6c69 7374 2829 0d0a 2020 2020 2020 2020  list()..        
-0000fba0: 6478 203d 2073 656c 662e 6c65 6e67 7468  dx = self.length
-0000fbb0: 5f78 2822 336d 6d22 290d 0a20 2020 2020  _x("3mm")..     
-0000fbc0: 2020 2064 7920 3d20 7365 6c66 2e6c 656e     dy = self.len
-0000fbd0: 6774 685f 7928 2233 6d6d 2229 0d0a 2020  gth_y("3mm")..  
-0000fbe0: 2020 2020 2020 6465 6c74 615f 776f 7264        delta_word
-0000fbf0: 6c69 7374 203d 2031 0d0a 2020 2020 2020  list = 1..      
-0000fc00: 2020 666f 7220 6520 696e 206c 6973 7428    for e in list(
-0000fc10: 7365 6c66 2e65 6c65 6d73 2865 6d70 6861  self.elems(empha
-0000fc20: 7369 7a65 643d 5472 7565 2929 3a0d 0a20  sized=True)):.. 
-0000fc30: 2020 2020 2020 2020 2020 2064 656c 7461             delta
-0000fc40: 5f77 6f72 646c 6973 7420 3d20 300d 0a20  _wordlist = 0.. 
-0000fc50: 2020 2020 2020 2020 2020 2066 6f72 206e             for n
-0000fc60: 2069 6e20 7261 6e67 6528 636f 7069 6573   in range(copies
-0000fc70: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0000fc80: 2020 2020 6465 6c74 615f 776f 7264 6c69      delta_wordli
-0000fc90: 7374 202b 3d20 310d 0a20 2020 2020 2020  st += 1..       
-0000fca0: 2020 2020 2020 2020 2063 6f70 795f 6e6f           copy_no
-0000fcb0: 6465 203d 2063 6f70 7928 6529 0d0a 2020  de = copy(e)..  
-0000fcc0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0000fcd0: 7079 5f6e 6f64 652e 6d61 7472 6978 202a  py_node.matrix *
-0000fce0: 3d20 4d61 7472 6978 2e74 7261 6e73 6c61  = Matrix.transla
-0000fcf0: 7465 2828 6e20 2b20 3129 202a 2064 782c  te((n + 1) * dx,
-0000fd00: 2028 6e20 2b20 3129 202a 2064 7929 0d0a   (n + 1) * dy)..
-0000fd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fd20: 6861 645f 6f70 7469 6f6e 616c 203d 2046  had_optional = F
-0000fd30: 616c 7365 0d0a 2020 2020 2020 2020 2020  alse..          
-0000fd40: 2020 2020 2020 2320 4e65 6564 2074 6f20        # Need to 
-0000fd50: 6164 6420 7374 726f 6b65 2061 6e64 2066  add stroke and f
-0000fd60: 696c 6c2c 2061 7320 636f 7079 2077 696c  ill, as copy wil
-0000fd70: 6c20 7461 6b65 2074 6865 0d0a 2020 2020  l take the..    
-0000fd80: 2020 2020 2020 2020 2020 2020 2320 6465              # de
-0000fd90: 6661 756c 7420 7661 6c75 6573 2066 6f72  fault values for
-0000fda0: 2074 6865 7365 2061 7474 7269 6275 7465   these attribute
-0000fdb0: 730d 0a20 2020 2020 2020 2020 2020 2020  s..             
-0000fdc0: 2020 2066 6f72 206f 7074 696f 6e61 6c20     for optional 
-0000fdd0: 696e 2028 2266 696c 6c22 2c20 2273 7472  in ("fill", "str
-0000fde0: 6f6b 6522 293a 0d0a 2020 2020 2020 2020  oke"):..        
-0000fdf0: 2020 2020 2020 2020 2020 2020 6966 2068              if h
-0000fe00: 6173 6174 7472 2865 2c20 6f70 7469 6f6e  asattr(e, option
-0000fe10: 616c 293a 0d0a 2020 2020 2020 2020 2020  al):..          
-0000fe20: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0000fe30: 7461 7474 7228 636f 7079 5f6e 6f64 652c  tattr(copy_node,
-0000fe40: 206f 7074 696f 6e61 6c2c 2067 6574 6174   optional, getat
-0000fe50: 7472 2865 2c20 6f70 7469 6f6e 616c 2929  tr(e, optional))
-0000fe60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000fe70: 2020 666f 7220 6f70 7469 6f6e 616c 2069    for optional i
-0000fe80: 6e20 2822 7778 666f 6e74 222c 2022 6d6b  n ("wxfont", "mk
-0000fe90: 7465 7874 222c 2022 6d6b 666f 6e74 222c  text", "mkfont",
-0000fea0: 2022 6d6b 666f 6e74 7369 7a65 2229 3a0d   "mkfontsize"):.
-0000feb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fec0: 2020 2020 2069 6620 6861 7361 7474 7228       if hasattr(
-0000fed0: 652c 206f 7074 696f 6e61 6c29 3a0d 0a20  e, optional):.. 
-0000fee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fef0: 2020 2020 2020 2068 6164 5f6f 7074 696f         had_optio
-0000ff00: 6e61 6c20 3d20 5472 7565 0d0a 2020 2020  nal = True..    
-0000ff10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ff20: 2020 2020 7365 7461 7474 7228 636f 7079      setattr(copy
-0000ff30: 5f6e 6f64 652c 206f 7074 696f 6e61 6c2c  _node, optional,
-0000ff40: 2067 6574 6174 7472 2865 2c20 6f70 7469   getattr(e, opti
-0000ff50: 6f6e 616c 2929 0d0a 2020 2020 2020 2020  onal))..        
-0000ff60: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0000ff70: 636f 7079 5f69 6e63 7265 6173 6573 5f77  copy_increases_w
-0000ff80: 6f72 646c 6973 745f 7265 6665 7265 6e63  ordlist_referenc
-0000ff90: 6573 2061 6e64 2068 6173 6174 7472 2865  es and hasattr(e
-0000ffa0: 2c20 2274 6578 7422 293a 0d0a 2020 2020  , "text"):..    
-0000ffb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ffc0: 636f 7079 5f6e 6f64 652e 7465 7874 203d  copy_node.text =
-0000ffd0: 2073 656c 662e 776f 7264 6c69 7374 5f64   self.wordlist_d
-0000ffe0: 656c 7461 2865 2e74 6578 742c 2064 656c  elta(e.text, del
-0000fff0: 7461 5f77 6f72 646c 6973 7429 0d0a 2020  ta_wordlist)..  
-00010000: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00010010: 6966 2073 656c 662e 636f 7079 5f69 6e63  if self.copy_inc
-00010020: 7265 6173 6573 5f77 6f72 646c 6973 745f  reases_wordlist_
-00010030: 7265 6665 7265 6e63 6573 2061 6e64 2068  references and h
-00010040: 6173 6174 7472 2865 2c20 226d 6b74 6578  asattr(e, "mktex
-00010050: 7422 293a 0d0a 2020 2020 2020 2020 2020  t"):..          
-00010060: 2020 2020 2020 2020 2020 636f 7079 5f6e            copy_n
-00010070: 6f64 652e 6d6b 7465 7874 203d 2073 656c  ode.mktext = sel
-00010080: 662e 776f 7264 6c69 7374 5f64 656c 7461  f.wordlist_delta
-00010090: 2865 2e6d 6b74 6578 742c 2064 656c 7461  (e.mktext, delta
-000100a0: 5f77 6f72 646c 6973 7429 0d0a 2020 2020  _wordlist)..    
-000100b0: 2020 2020 2020 2020 2020 2020 6e6f 6465              node
-000100c0: 2e70 6172 656e 742e 6164 645f 6e6f 6465  .parent.add_node
-000100d0: 2863 6f70 795f 6e6f 6465 290d 0a20 2020  (copy_node)..   
-000100e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000100f0: 6861 645f 6f70 7469 6f6e 616c 3a0d 0a20  had_optional:.. 
-00010100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010110: 2020 2066 6f72 2070 726f 7065 7274 795f     for property_
-00010120: 6f70 2069 6e20 7365 6c66 2e6b 6572 6e65  op in self.kerne
-00010130: 6c2e 6c6f 6f6b 7570 5f61 6c6c 2822 7061  l.lookup_all("pa
-00010140: 7468 5f75 7064 6174 6572 2f2e 2a22 293a  th_updater/.*"):
-00010150: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00010160: 2020 2020 2020 2020 2020 7072 6f70 6572            proper
-00010170: 7479 5f6f 7028 7365 6c66 2e6b 6572 6e65  ty_op(self.kerne
-00010180: 6c2e 726f 6f74 2c20 636f 7079 5f6e 6f64  l.root, copy_nod
-00010190: 6529 0d0a 0d0a 2020 2020 2020 2020 2020  e)....          
-000101a0: 2020 2020 2020 636f 7079 5f6e 6f64 6573        copy_nodes
-000101b0: 2e61 7070 656e 6428 636f 7079 5f6e 6f64  .append(copy_nod
-000101c0: 6529 0d0a 0d0a 2020 2020 2020 2020 6966  e)....        if
-000101d0: 2073 656c 662e 636c 6173 7369 6679 5f6e   self.classify_n
-000101e0: 6577 3a0d 0a20 2020 2020 2020 2020 2020  ew:..           
-000101f0: 2073 656c 662e 636c 6173 7369 6679 2863   self.classify(c
-00010200: 6f70 795f 6e6f 6465 7329 0d0a 0d0a 2020  opy_nodes)....  
-00010210: 2020 2020 2020 7365 6c66 2e73 6574 5f65        self.set_e
-00010220: 6d70 6861 7369 7328 4e6f 6e65 290d 0a0d  mphasis(None)...
-00010230: 0a20 2020 2064 6566 2068 6173 5f77 6f72  .    def has_wor
-00010240: 646c 6973 7428 6e6f 6465 293a 0d0a 2020  dlist(node):..  
-00010250: 2020 2020 2020 7265 7375 6c74 203d 2046        result = F
-00010260: 616c 7365 0d0a 2020 2020 2020 2020 7478  alse..        tx
-00010270: 7420 3d20 2222 0d0a 2020 2020 2020 2020  t = ""..        
-00010280: 6966 2068 6173 6174 7472 286e 6f64 652c  if hasattr(node,
-00010290: 2022 7465 7874 2229 2061 6e64 206e 6f64   "text") and nod
-000102a0: 652e 7465 7874 2069 7320 6e6f 7420 4e6f  e.text is not No
-000102b0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-000102c0: 2074 7874 203d 206e 6f64 652e 7465 7874   txt = node.text
-000102d0: 0d0a 2020 2020 2020 2020 6966 2068 6173  ..        if has
-000102e0: 6174 7472 286e 6f64 652c 2022 6d6b 7465  attr(node, "mkte
-000102f0: 7874 2229 2061 6e64 206e 6f64 652e 6d6b  xt") and node.mk
-00010300: 7465 7874 2069 7320 6e6f 7420 4e6f 6e65  text is not None
-00010310: 3a0d 0a20 2020 2020 2020 2020 2020 2074  :..            t
-00010320: 7874 203d 206e 6f64 652e 6d6b 7465 7874  xt = node.mktext
-00010330: 0d0a 2020 2020 2020 2020 2320 5665 7279  ..        # Very
-00010340: 2073 7475 7069 642c 2062 7574 2067 6f6f   stupid, but goo
-00010350: 6420 656e 6f75 6768 0d0a 2020 2020 2020  d enough..      
-00010360: 2020 6966 2022 7b22 2069 6e20 7478 7420    if "{" in txt 
-00010370: 616e 6420 227d 2220 696e 2074 7874 3a0d  and "}" in txt:.
-00010380: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-00010390: 756c 7420 3d20 5472 7565 0d0a 2020 2020  ult = True..    
-000103a0: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
-000103b0: 740d 0a0d 0a20 2020 2040 7472 6565 5f63  t....    @tree_c
-000103c0: 6f6e 6469 7469 6f6e 616c 286c 616d 6264  onditional(lambd
-000103d0: 6120 6e6f 6465 3a20 6861 735f 776f 7264  a node: has_word
-000103e0: 6c69 7374 286e 6f64 6529 290d 0a20 2020  list(node))..   
-000103f0: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
-00010400: 280d 0a20 2020 2020 2020 205f 2822 496e  (..        _("In
-00010410: 6372 6561 7365 2057 6f72 646c 6973 742d  crease Wordlist-
-00010420: 5265 6665 7265 6e63 6522 292c 0d0a 2020  Reference"),..  
-00010430: 2020 2020 2020 6e6f 6465 5f74 7970 653d        node_type=
-00010440: 280d 0a20 2020 2020 2020 2020 2020 2022  (..            "
-00010450: 656c 656d 2074 6578 7422 2c0d 0a20 2020  elem text",..   
-00010460: 2020 2020 2020 2020 2022 656c 656d 2070           "elem p
-00010470: 6174 6822 2c0d 0a20 2020 2020 2020 2029  ath",..        )
-00010480: 2c0d 0a20 2020 2020 2020 2068 656c 703d  ,..        help=
-00010490: 5f28 2241 646a 7573 7473 2074 6865 2072  _("Adjusts the r
-000104a0: 6566 6572 656e 6365 2076 616c 7565 2066  eference value f
-000104b0: 6f72 2061 2077 6f72 646c 6973 742c 2069  or a wordlist, i
-000104c0: 6520 7b6e 616d 657d 2074 6f20 7b6e 616d  e {name} to {nam
-000104d0: 6523 2b31 7d22 292c 0d0a 2020 2020 290d  e#+1}"),..    ).
-000104e0: 0a20 2020 2064 6566 2077 6c69 7374 5f70  .    def wlist_p
-000104f0: 6c75 7328 7369 6e67 6c65 6e6f 6465 2c20  lus(singlenode, 
-00010500: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
-00010510: 2020 2020 6461 7461 203d 206c 6973 7428      data = list(
-00010520: 290d 0a20 2020 2020 2020 2066 6f72 206e  )..        for n
-00010530: 6f64 6520 696e 206c 6973 7428 7365 6c66  ode in list(self
-00010540: 2e65 6c65 6d73 2865 6d70 6861 7369 7a65  .elems(emphasize
-00010550: 643d 5472 7565 2929 3a0d 0a20 2020 2020  d=True)):..     
-00010560: 2020 2020 2020 2069 6620 6e6f 7420 6861         if not ha
-00010570: 735f 776f 7264 6c69 7374 286e 6f64 6529  s_wordlist(node)
-00010580: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00010590: 2020 2063 6f6e 7469 6e75 650d 0a20 2020     continue..   
-000105a0: 2020 2020 2020 2020 2064 656c 7461 5f77           delta_w
-000105b0: 6f72 646c 6973 7420 3d20 310d 0a20 2020  ordlist = 1..   
-000105c0: 2020 2020 2020 2020 2069 6620 6861 7361           if hasa
-000105d0: 7474 7228 6e6f 6465 2c20 2274 6578 7422  ttr(node, "text"
-000105e0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-000105f0: 2020 2020 6e6f 6465 2e74 6578 7420 3d20      node.text = 
-00010600: 7365 6c66 2e77 6f72 646c 6973 745f 6465  self.wordlist_de
-00010610: 6c74 6128 6e6f 6465 2e74 6578 742c 2064  lta(node.text, d
-00010620: 656c 7461 5f77 6f72 646c 6973 7429 0d0a  elta_wordlist)..
-00010630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010640: 6e6f 6465 2e61 6c74 6572 6564 2829 0d0a  node.altered()..
-00010650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010660: 6461 7461 2e61 7070 656e 6428 6e6f 6465  data.append(node
-00010670: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-00010680: 6c69 6620 6861 7361 7474 7228 6e6f 6465  lif hasattr(node
-00010690: 2c20 226d 6b74 6578 7422 293a 0d0a 2020  , "mktext"):..  
-000106a0: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
-000106b0: 6465 2e6d 6b74 6578 7420 3d20 7365 6c66  de.mktext = self
-000106c0: 2e77 6f72 646c 6973 745f 6465 6c74 6128  .wordlist_delta(
-000106d0: 6e6f 6465 2e6d 6b74 6578 742c 2064 656c  node.mktext, del
-000106e0: 7461 5f77 6f72 646c 6973 7429 0d0a 2020  ta_wordlist)..  
-000106f0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00010700: 7220 7072 6f70 6572 7479 5f6f 7020 696e  r property_op in
-00010710: 2073 656c 662e 6b65 726e 656c 2e6c 6f6f   self.kernel.loo
-00010720: 6b75 705f 616c 6c28 2270 6174 685f 7570  kup_all("path_up
-00010730: 6461 7465 722f 2e2a 2229 3a0d 0a20 2020  dater/.*"):..   
-00010740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010750: 2070 726f 7065 7274 795f 6f70 2873 656c   property_op(sel
-00010760: 662e 6b65 726e 656c 2e72 6f6f 742c 206e  f.kernel.root, n
-00010770: 6f64 6529 0d0a 2020 2020 2020 2020 2020  ode)..          
-00010780: 2020 2020 2020 6461 7461 2e61 7070 656e        data.appen
-00010790: 6428 6e6f 6465 290d 0a20 2020 2020 2020  d(node)..       
-000107a0: 2073 656c 662e 7369 676e 616c 2822 656c   self.signal("el
-000107b0: 656d 656e 745f 7072 6f70 6572 7479 5f75  ement_property_u
-000107c0: 7064 6174 6522 2c20 6461 7461 290d 0a0d  pdate", data)...
-000107d0: 0a20 2020 2040 7472 6565 5f63 6f6e 6469  .    @tree_condi
-000107e0: 7469 6f6e 616c 286c 616d 6264 6120 6e6f  tional(lambda no
-000107f0: 6465 3a20 6861 735f 776f 7264 6c69 7374  de: has_wordlist
-00010800: 286e 6f64 6529 290d 0a20 2020 2040 7472  (node))..    @tr
-00010810: 6565 5f6f 7065 7261 7469 6f6e 280d 0a20  ee_operation(.. 
-00010820: 2020 2020 2020 205f 2822 4465 6372 6561         _("Decrea
-00010830: 7365 2057 6f72 646c 6973 742d 5265 6665  se Wordlist-Refe
-00010840: 7265 6e63 6522 292c 0d0a 2020 2020 2020  rence"),..      
-00010850: 2020 6e6f 6465 5f74 7970 653d 280d 0a20    node_type=(.. 
-00010860: 2020 2020 2020 2020 2020 2022 656c 656d             "elem
-00010870: 2074 6578 7422 2c0d 0a20 2020 2020 2020   text",..       
-00010880: 2020 2020 2022 656c 656d 2070 6174 6822       "elem path"
-00010890: 2c0d 0a20 2020 2020 2020 2029 2c0d 0a20  ,..        ),.. 
-000108a0: 2020 2020 2020 2068 656c 703d 5f28 2241         help=_("A
-000108b0: 646a 7573 7473 2074 6865 2072 6566 6572  djusts the refer
-000108c0: 656e 6365 2076 616c 7565 2066 6f72 2061  ence value for a
-000108d0: 2077 6f72 646c 6973 742c 2069 6520 7b6e   wordlist, ie {n
-000108e0: 616d 6523 2b33 7d20 746f 207b 6e61 6d65  ame#+3} to {name
-000108f0: 232b 327d 2229 2c0d 0a20 2020 2029 0d0a  #+2}"),..    )..
-00010900: 2020 2020 6465 6620 776c 6973 745f 6d69      def wlist_mi
-00010910: 6e75 7328 7369 6e67 6c65 6e6f 6465 2c20  nus(singlenode, 
-00010920: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
-00010930: 2020 2020 6461 7461 203d 206c 6973 7428      data = list(
-00010940: 290d 0a20 2020 2020 2020 2066 6f72 206e  )..        for n
-00010950: 6f64 6520 696e 206c 6973 7428 7365 6c66  ode in list(self
-00010960: 2e65 6c65 6d73 2865 6d70 6861 7369 7a65  .elems(emphasize
-00010970: 643d 5472 7565 2929 3a0d 0a20 2020 2020  d=True)):..     
-00010980: 2020 2020 2020 2069 6620 6e6f 7420 6861         if not ha
-00010990: 735f 776f 7264 6c69 7374 286e 6f64 6529  s_wordlist(node)
-000109a0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000109b0: 2020 2063 6f6e 7469 6e75 650d 0a20 2020     continue..   
-000109c0: 2020 2020 2020 2020 2064 656c 7461 5f77           delta_w
-000109d0: 6f72 646c 6973 7420 3d20 2d31 0d0a 2020  ordlist = -1..  
-000109e0: 2020 2020 2020 2020 2020 6966 2068 6173            if has
-000109f0: 6174 7472 286e 6f64 652c 2022 7465 7874  attr(node, "text
-00010a00: 2229 3a0d 0a20 2020 2020 2020 2020 2020  "):..           
-00010a10: 2020 2020 206e 6f64 652e 7465 7874 203d       node.text =
-00010a20: 2073 656c 662e 776f 7264 6c69 7374 5f64   self.wordlist_d
-00010a30: 656c 7461 286e 6f64 652e 7465 7874 2c20  elta(node.text, 
-00010a40: 6465 6c74 615f 776f 7264 6c69 7374 290d  delta_wordlist).
-00010a50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010a60: 206e 6f64 652e 616c 7465 7265 6428 290d   node.altered().
-00010a70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010a80: 2064 6174 612e 6170 7065 6e64 286e 6f64   data.append(nod
-00010a90: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-00010aa0: 656c 6966 2068 6173 6174 7472 286e 6f64  elif hasattr(nod
-00010ab0: 652c 2022 6d6b 7465 7874 2229 3a0d 0a20  e, "mktext"):.. 
-00010ac0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00010ad0: 6f64 652e 6d6b 7465 7874 203d 2073 656c  ode.mktext = sel
-00010ae0: 662e 776f 7264 6c69 7374 5f64 656c 7461  f.wordlist_delta
-00010af0: 286e 6f64 652e 6d6b 7465 7874 2c20 6465  (node.mktext, de
-00010b00: 6c74 615f 776f 7264 6c69 7374 290d 0a20  lta_wordlist).. 
-00010b10: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00010b20: 6f72 2070 726f 7065 7274 795f 6f70 2069  or property_op i
-00010b30: 6e20 7365 6c66 2e6b 6572 6e65 6c2e 6c6f  n self.kernel.lo
-00010b40: 6f6b 7570 5f61 6c6c 2822 7061 7468 5f75  okup_all("path_u
-00010b50: 7064 6174 6572 2f2e 2a22 293a 0d0a 2020  pdater/.*"):..  
-00010b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b70: 2020 7072 6f70 6572 7479 5f6f 7028 7365    property_op(se
-00010b80: 6c66 2e6b 6572 6e65 6c2e 726f 6f74 2c20  lf.kernel.root, 
-00010b90: 6e6f 6465 290d 0a20 2020 2020 2020 2020  node)..         
-00010ba0: 2020 2020 2020 2064 6174 612e 6170 7065         data.appe
-00010bb0: 6e64 286e 6f64 6529 0d0a 2020 2020 2020  nd(node)..      
-00010bc0: 2020 7365 6c66 2e73 6967 6e61 6c28 2265    self.signal("e
-00010bd0: 6c65 6d65 6e74 5f70 726f 7065 7274 795f  lement_property_
-00010be0: 7570 6461 7465 222c 2064 6174 6129 0d0a  update", data)..
-00010bf0: 0d0a 2020 2020 4074 7265 655f 636f 6e64  ..    @tree_cond
-00010c00: 6974 696f 6e61 6c28 6c61 6d62 6461 206e  itional(lambda n
-00010c10: 6f64 653a 2068 6173 5f76 6563 746f 7269  ode: has_vectori
-00010c20: 7a65 286e 6f64 6529 290d 0a20 2020 2040  ze(node))..    @
-00010c30: 7472 6565 5f73 7562 6d65 6e75 285f 2822  tree_submenu(_("
-00010c40: 4f75 746c 696e 6520 656c 656d 656e 7428  Outline element(
-00010c50: 7329 2e2e 2e22 2929 0d0a 2020 2020 4074  s)..."))..    @t
-00010c60: 7265 655f 6974 6572 6174 6528 226f 6666  ree_iterate("off
-00010c70: 7365 7422 2c20 312c 2031 3029 0d0a 2020  set", 1, 10)..  
-00010c80: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
-00010c90: 6e28 0d0a 2020 2020 2020 2020 5f28 222e  n(..        _(".
-00010ca0: 2e2e 7769 7468 207b 6f66 6673 6574 7d6d  ..with {offset}m
-00010cb0: 6d20 6469 7374 616e 6365 2229 2c0d 0a20  m distance"),.. 
-00010cc0: 2020 2020 2020 206e 6f64 655f 7479 7065         node_type
-00010cd0: 3d65 6c65 6d5f 6e6f 6465 732c 0d0a 2020  =elem_nodes,..  
-00010ce0: 2020 2020 2020 6865 6c70 3d22 222c 0d0a        help="",..
-00010cf0: 2020 2020 290d 0a20 2020 2064 6566 206d      )..    def m
-00010d00: 616b 655f 6f75 746c 696e 6573 286e 6f64  ake_outlines(nod
-00010d10: 652c 206f 6666 7365 743d 312c 202a 2a6b  e, offset=1, **k
-00010d20: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
-00010d30: 2073 656c 6628 6622 6f75 746c 696e 6520   self(f"outline 
-00010d40: 7b6f 6666 7365 747d 6d6d 5c6e 2229 0d0a  {offset}mm\n")..
-00010d50: 2020 2020 2020 2020 7365 6c66 2e73 6967          self.sig
-00010d60: 6e61 6c28 2272 6566 7265 7368 5f74 7265  nal("refresh_tre
-00010d70: 6522 290d 0a0d 0a20 2020 2064 6566 2068  e")....    def h
-00010d80: 6173 5f76 6563 746f 7269 7a65 286e 6f64  as_vectorize(nod
-00010d90: 6529 3a0d 0a20 2020 2020 2020 2072 6573  e):..        res
-00010da0: 756c 7420 3d20 4661 6c73 650d 0a20 2020  ult = False..   
-00010db0: 2020 2020 206d 616b 655f 7665 6374 6f72       make_vector
-00010dc0: 203d 2073 656c 662e 6c6f 6f6b 7570 2822   = self.lookup("
-00010dd0: 7265 6e64 6572 2d6f 702f 6d61 6b65 5f76  render-op/make_v
-00010de0: 6563 746f 7222 290d 0a20 2020 2020 2020  ector")..       
-00010df0: 2069 6620 6d61 6b65 5f76 6563 746f 723a   if make_vector:
-00010e00: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-00010e10: 7375 6c74 203d 2054 7275 650d 0a20 2020  sult = True..   
-00010e20: 2020 2020 2072 6574 7572 6e20 7265 7375       return resu
-00010e30: 6c74 0d0a 0d0a 2020 2020 4074 7265 655f  lt....    @tree_
-00010e40: 636f 6e64 6974 696f 6e61 6c28 6c61 6d62  conditional(lamb
-00010e50: 6461 206e 6f64 653a 2068 6173 5f76 6563  da node: has_vec
-00010e60: 746f 7269 7a65 286e 6f64 6529 290d 0a20  torize(node)).. 
-00010e70: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
-00010e80: 6f6e 280d 0a20 2020 2020 2020 205f 2822  on(..        _("
-00010e90: 5472 6163 6520 6269 746d 6170 2229 2c0d  Trace bitmap"),.
-00010ea0: 0a20 2020 2020 2020 206e 6f64 655f 7479  .        node_ty
-00010eb0: 7065 3d28 0d0a 2020 2020 2020 2020 2020  pe=(..          
-00010ec0: 2020 2265 6c65 6d20 7465 7874 222c 0d0a    "elem text",..
-00010ed0: 2020 2020 2020 2020 2020 2020 2265 6c65              "ele
-00010ee0: 6d20 696d 6167 6522 2c0d 0a20 2020 2020  m image",..     
-00010ef0: 2020 2029 2c0d 0a20 2020 2020 2020 2068     ),..        h
-00010f00: 656c 703d 5f28 2256 6563 746f 7269 7a65  elp=_("Vectorize
-00010f10: 2074 6865 2067 6976 656e 2065 6c65 6d65   the given eleme
-00010f20: 6e74 2229 2c0d 0a20 2020 2029 0d0a 2020  nt"),..    )..  
-00010f30: 2020 6465 6620 7472 6163 655f 6269 746d    def trace_bitm
-00010f40: 6170 286e 6f64 652c 202a 2a6b 7761 7267  ap(node, **kwarg
-00010f50: 7329 3a0d 0a20 2020 2020 2020 2073 656c  s):..        sel
-00010f60: 6628 2276 6563 746f 7269 7a65 5c6e 2229  f("vectorize\n")
-00010f70: 0d0a 0d0a 2020 2020 4074 7265 655f 636f  ....    @tree_co
-00010f80: 6e64 6974 696f 6e61 6c28 6c61 6d62 6461  nditional(lambda
-00010f90: 206e 6f64 653a 206e 6f74 2069 735f 7265   node: not is_re
-00010fa0: 676d 6172 6b28 6e6f 6465 2929 0d0a 2020  gmark(node))..  
-00010fb0: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
-00010fc0: 6e28 0d0a 2020 2020 2020 2020 5f28 2243  n(..        _("C
-00010fd0: 6f6e 7665 7274 2074 6f20 7061 7468 2229  onvert to path")
-00010fe0: 2c0d 0a20 2020 2020 2020 206e 6f64 655f  ,..        node_
-00010ff0: 7479 7065 3d28 0d0a 2020 2020 2020 2020  type=(..        
-00011000: 2020 2020 2265 6c65 6d20 656c 6c69 7073      "elem ellips
-00011010: 6522 2c0d 0a20 2020 2020 2020 2020 2020  e",..           
-00011020: 2022 656c 656d 2070 6174 6822 2c0d 0a20   "elem path",.. 
-00011030: 2020 2020 2020 2020 2020 2022 656c 656d             "elem
-00011040: 2070 6f6c 796c 696e 6522 2c0d 0a20 2020   polyline",..   
-00011050: 2020 2020 2020 2020 2022 656c 656d 2072           "elem r
-00011060: 6563 7422 2c0d 0a20 2020 2020 2020 2020  ect",..         
-00011070: 2020 2022 656c 656d 206c 696e 6522 2c0d     "elem line",.
-00011080: 0a20 2020 2020 2020 2029 2c0d 0a20 2020  .        ),..   
-00011090: 2020 2020 2068 656c 703d 2222 2c0d 0a20       help="",.. 
-000110a0: 2020 2029 0d0a 2020 2020 6465 6620 636f     )..    def co
-000110b0: 6e76 6572 745f 746f 5f70 6174 6828 7369  nvert_to_path(si
-000110c0: 6e67 6c65 6e6f 6465 2c20 2a2a 6b77 6172  nglenode, **kwar
-000110d0: 6773 293a 0d0a 2020 2020 2020 2020 666f  gs):..        fo
-000110e0: 7220 6e6f 6465 2069 6e20 6c69 7374 2873  r node in list(s
-000110f0: 656c 662e 656c 656d 7328 656d 7068 6173  elf.elems(emphas
-00011100: 697a 6564 3d54 7275 6529 293a 0d0a 2020  ized=True)):..  
-00011110: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00011120: 206e 6f64 6520 6e6f 7420 696e 2028 0d0a   node not in (..
-00011130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011140: 2265 6c65 6d20 656c 6c69 7073 6522 2c0d  "elem ellipse",.
-00011150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011160: 2022 656c 656d 2070 6174 6822 2c0d 0a20   "elem path",.. 
-00011170: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00011180: 656c 656d 2070 6f6c 796c 696e 6522 2c0d  elem polyline",.
-00011190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000111a0: 2022 656c 656d 2072 6563 7422 2c0d 0a20   "elem rect",.. 
-000111b0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-000111c0: 656c 656d 206c 696e 6522 2c0d 0a20 2020  elem line",..   
-000111d0: 2020 2020 2020 2020 2029 3a0d 0a20 2020           ):..   
-000111e0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-000111f0: 7469 6e75 650d 0a20 2020 2020 2020 2020  tinue..         
-00011200: 2020 206f 6c64 7374 7566 6620 3d20 5b5d     oldstuff = []
-00011210: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-00011220: 7220 6174 7472 6962 2069 6e20 2822 7374  r attrib in ("st
-00011230: 726f 6b65 222c 2022 6669 6c6c 222c 2022  roke", "fill", "
-00011240: 7374 726f 6b65 5f77 6964 7468 222c 2022  stroke_width", "
-00011250: 7374 726f 6b65 5f73 6361 6c65 6422 293a  stroke_scaled"):
-00011260: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00011270: 2020 6966 2068 6173 6174 7472 286e 6f64    if hasattr(nod
-00011280: 652c 2061 7474 7269 6229 3a0d 0a20 2020  e, attrib):..   
+00000000: 2222 220d 0a54 6869 7320 6973 2061 206c  """..This is a l
+00000010: 6172 6765 206e 756d 6265 7220 6f66 2066  arge number of f
+00000020: 6c61 6767 6564 2074 7265 6520 6f70 6572  lagged tree oper
+00000030: 6174 696f 6e73 2e20 5468 6520 6465 7461  ations. The deta
+00000040: 696c 7320 6f66 2068 6f77 2074 6865 7365  ils of how these
+00000050: 2061 7265 2072 6567 6973 7465 7265 6420   are registered 
+00000060: 6973 2061 7661 696c 6962 6c65 2069 6e20  is availible in 
+00000070: 7468 6520 7472 6565 6f70 2e70 790d 0a66  the treeop.py..f
+00000080: 696c 652e 2054 6865 7365 2064 6566 696e  ile. These defin
+00000090: 6520 7468 6520 7269 6768 742d 636c 6963  e the right-clic
+000000a0: 6b20 6e6f 6465 206d 656e 7520 6f70 6572  k node menu oper
+000000b0: 6174 696f 6e73 2e20 5468 6174 206d 656e  ations. That men
+000000c0: 7520 6973 2064 796e 616d 6963 616c 6c79  u is dynamically
+000000d0: 2063 7265 6174 6564 2062 6173 6564 206f   created based o
+000000e0: 6e20 7661 7269 6f75 7320 636f 6e74 6578  n various contex
+000000f0: 740d 0a63 7565 732e 0d0a 2222 220d 0a0d  t..cues..."""...
+00000100: 0a0d 0a69 6d70 6f72 7420 6d61 7468 0d0a  ...import math..
+00000110: 696d 706f 7274 206f 732e 7061 7468 0d0a  import os.path..
+00000120: 6672 6f6d 2063 6f70 7920 696d 706f 7274  from copy import
+00000130: 2063 6f70 790d 0a0d 0a66 726f 6d20 6d65   copy....from me
+00000140: 6572 6b34 3074 2e63 6f72 652e 6375 7463  erk40t.core.cutc
+00000150: 6f64 652e 6375 7463 6f64 6520 696d 706f  ode.cutcode impo
+00000160: 7274 2043 7574 436f 6465 0d0a 6672 6f6d  rt CutCode..from
+00000170: 206d 6565 726b 3430 742e 636f 7265 2e6e   meerk40t.core.n
+00000180: 6f64 652e 656c 656d 5f69 6d61 6765 2069  ode.elem_image i
+00000190: 6d70 6f72 7420 496d 6167 654e 6f64 650d  mport ImageNode.
+000001a0: 0a66 726f 6d20 6d65 6572 6b34 3074 2e63  .from meerk40t.c
+000001b0: 6f72 652e 6e6f 6465 2e6e 6f64 6520 696d  ore.node.node im
+000001c0: 706f 7274 204e 6f64 650d 0a66 726f 6d20  port Node..from 
+000001d0: 6d65 6572 6b34 3074 2e63 6f72 652e 7472  meerk40t.core.tr
+000001e0: 6565 6f70 2069 6d70 6f72 7420 280d 0a20  eeop import (.. 
+000001f0: 2020 2067 6574 5f74 7265 655f 6f70 6572     get_tree_oper
+00000200: 6174 696f 6e2c 0d0a 2020 2020 7472 6565  ation,..    tree
+00000210: 5f63 616c 632c 0d0a 2020 2020 7472 6565  _calc,..    tree
+00000220: 5f63 6865 636b 2c0d 0a20 2020 2074 7265  _check,..    tre
+00000230: 655f 636f 6e64 6974 696f 6e61 6c2c 0d0a  e_conditional,..
+00000240: 2020 2020 7472 6565 5f63 6f6e 6469 7469      tree_conditi
+00000250: 6f6e 616c 5f74 7279 2c0d 0a20 2020 2074  onal_try,..    t
+00000260: 7265 655f 6974 6572 6174 652c 0d0a 2020  ree_iterate,..  
+00000270: 2020 7472 6565 5f70 726f 6d70 742c 0d0a    tree_prompt,..
+00000280: 2020 2020 7472 6565 5f72 6164 696f 2c0d      tree_radio,.
+00000290: 0a20 2020 2074 7265 655f 7365 7061 7261  .    tree_separa
+000002a0: 746f 725f 6166 7465 722c 0d0a 2020 2020  tor_after,..    
+000002b0: 7472 6565 5f73 6570 6172 6174 6f72 5f62  tree_separator_b
+000002c0: 6566 6f72 652c 0d0a 2020 2020 7472 6565  efore,..    tree
+000002d0: 5f73 7562 6d65 6e75 2c0d 0a20 2020 2074  _submenu,..    t
+000002e0: 7265 655f 7661 6c75 6573 2c0d 0a29 0d0a  ree_values,..)..
+000002f0: 6672 6f6d 206d 6565 726b 3430 742e 636f  from meerk40t.co
+00000300: 7265 2e75 6e69 7473 2069 6d70 6f72 7420  re.units import 
+00000310: 554e 4954 535f 5045 525f 494e 4348 0d0a  UNITS_PER_INCH..
+00000320: 6672 6f6d 206d 6565 726b 3430 742e 6b65  from meerk40t.ke
+00000330: 726e 656c 2069 6d70 6f72 7420 436f 6d6d  rnel import Comm
+00000340: 616e 6453 796e 7461 7845 7272 6f72 0d0a  andSyntaxError..
+00000350: 6672 6f6d 206d 6565 726b 3430 742e 7376  from meerk40t.sv
+00000360: 6765 6c65 6d65 6e74 7320 696d 706f 7274  gelements import
+00000370: 204d 6174 7269 782c 2050 6f69 6e74 0d0a   Matrix, Point..
+00000380: 0d0a 6672 6f6d 202e 656c 656d 656e 745f  ..from .element_
+00000390: 7479 7065 7320 696d 706f 7274 202a 0d0a  types import *..
+000003a0: 0d0a 0d0a 6465 6620 706c 7567 696e 286b  ....def plugin(k
+000003b0: 6572 6e65 6c2c 206c 6966 6563 7963 6c65  ernel, lifecycle
+000003c0: 3d4e 6f6e 6529 3a0d 0a20 2020 205f 203d  =None):..    _ =
+000003d0: 206b 6572 6e65 6c2e 7472 616e 736c 6174   kernel.translat
+000003e0: 696f 6e0d 0a20 2020 2069 6620 6c69 6665  ion..    if life
+000003f0: 6379 636c 6520 3d3d 2022 706f 7374 626f  cycle == "postbo
+00000400: 6f74 223a 0d0a 2020 2020 2020 2020 696e  ot":..        in
+00000410: 6974 5f74 7265 6528 6b65 726e 656c 290d  it_tree(kernel).
+00000420: 0a0d 0a0d 0a64 6566 2069 6e69 745f 7472  .....def init_tr
+00000430: 6565 286b 6572 6e65 6c29 3a0d 0a20 2020  ee(kernel):..   
+00000440: 2073 656c 6620 3d20 6b65 726e 656c 2e65   self = kernel.e
+00000450: 6c65 6d65 6e74 730d 0a0d 0a20 2020 2074  lements....    t
+00000460: 7265 655f 6f70 6572 6174 696f 6e20 3d20  ree_operation = 
+00000470: 6765 745f 7472 6565 5f6f 7065 7261 7469  get_tree_operati
+00000480: 6f6e 2873 656c 6629 0d0a 0d0a 2020 2020  on(self)....    
+00000490: 5f20 3d20 6b65 726e 656c 2e74 7261 6e73  _ = kernel.trans
+000004a0: 6c61 7469 6f6e 0d0a 0d0a 2020 2020 2320  lation....    # 
+000004b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000004c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d20 5452 4545  ----------- TREE
+000004d0: 204f 5045 5241 5449 4f4e 5320 2d2d 2d2d   OPERATIONS ----
+000004e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000004f0: 2d2d 2d2d 2d2d 2d0d 0a0d 0a20 2020 2064  -------....    d
+00000500: 6566 2069 735f 7265 676d 6172 6b28 6e6f  ef is_regmark(no
+00000510: 6465 293a 0d0a 2020 2020 2020 2020 7265  de):..        re
+00000520: 7375 6c74 203d 2046 616c 7365 0d0a 2020  sult = False..  
+00000530: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+00000540: 2020 2020 2020 2020 6966 206e 6f64 652e          if node.
+00000550: 5f70 6172 656e 742e 7479 7065 203d 3d20  _parent.type == 
+00000560: 2262 7261 6e63 6820 7265 6722 3a0d 0a20  "branch reg":.. 
+00000570: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00000580: 6573 756c 7420 3d20 5472 7565 0d0a 2020  esult = True..  
+00000590: 2020 2020 2020 6578 6365 7074 2041 7474        except Att
+000005a0: 7269 6275 7465 4572 726f 723a 0d0a 2020  ributeError:..  
+000005b0: 2020 2020 2020 2020 2020 7061 7373 0d0a            pass..
+000005c0: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+000005d0: 6573 756c 740d 0a0d 0a20 2020 2064 6566  esult....    def
+000005e0: 2068 6173 5f63 6861 6e67 6573 286e 6f64   has_changes(nod
+000005f0: 6529 3a0d 0a20 2020 2020 2020 2072 6573  e):..        res
+00000600: 756c 7420 3d20 4661 6c73 650d 0a20 2020  ult = False..   
+00000610: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
+00000620: 2020 2020 2020 2069 6620 6e6f 7420 6e6f         if not no
+00000630: 6465 2e6d 6174 7269 782e 6973 5f69 6465  de.matrix.is_ide
+00000640: 6e74 6974 7928 293a 0d0a 2020 2020 2020  ntity():..      
+00000650: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+00000660: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
+00000670: 2065 7863 6570 7420 4174 7472 6962 7574   except Attribut
+00000680: 6545 7272 6f72 3a0d 0a20 2020 2020 2020  eError:..       
+00000690: 2020 2020 2023 2054 6865 7265 2077 6173       # There was
+000006a0: 2061 6e20 6572 726f 7220 6475 7269 6e67   an error during
+000006b0: 2063 6865 636b 2066 6f72 206d 6174 7269   check for matri
+000006c0: 782e 6973 5f69 6465 6e74 6974 790d 0a20  x.is_identity.. 
+000006d0: 2020 2020 2020 2020 2020 2070 6173 730d             pass.
+000006e0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000006f0: 7265 7375 6c74 0d0a 0d0a 2020 2020 4074  result....    @t
+00000700: 7265 655f 7365 7061 7261 746f 725f 6166  ree_separator_af
+00000710: 7465 7228 290d 0a20 2020 2040 7472 6565  ter()..    @tree
+00000720: 5f63 6f6e 6469 7469 6f6e 616c 286c 616d  _conditional(lam
+00000730: 6264 6120 6e6f 6465 3a20 6c65 6e28 6c69  bda node: len(li
+00000740: 7374 2873 656c 662e 6f70 7328 7365 6c65  st(self.ops(sele
+00000750: 6374 6564 3d54 7275 6529 2929 203d 3d20  cted=True))) == 
+00000760: 3129 0d0a 2020 2020 4074 7265 655f 6f70  1)..    @tree_op
+00000770: 6572 6174 696f 6e28 5f28 224f 7065 7261  eration(_("Opera
+00000780: 7469 6f6e 2070 726f 7065 7274 6965 7322  tion properties"
+00000790: 292c 206e 6f64 655f 7479 7065 3d6f 705f  ), node_type=op_
+000007a0: 6e6f 6465 732c 2068 656c 703d 2222 290d  nodes, help="").
+000007b0: 0a20 2020 2064 6566 206f 7065 7261 7469  .    def operati
+000007c0: 6f6e 5f70 726f 7065 7274 7928 6e6f 6465  on_property(node
+000007d0: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+000007e0: 2020 2020 2020 6163 7469 7661 7465 203d        activate =
+000007f0: 2073 656c 662e 6b65 726e 656c 2e6c 6f6f   self.kernel.loo
+00000800: 6b75 7028 2266 756e 6374 696f 6e2f 6f70  kup("function/op
+00000810: 656e 5f70 726f 7065 7274 795f 7769 6e64  en_property_wind
+00000820: 6f77 5f66 6f72 5f6e 6f64 6522 290d 0a20  ow_for_node").. 
+00000830: 2020 2020 2020 2069 6620 6163 7469 7661         if activa
+00000840: 7465 2069 7320 6e6f 7420 4e6f 6e65 3a0d  te is not None:.
+00000850: 0a20 2020 2020 2020 2020 2020 2061 6374  .            act
+00000860: 6976 6174 6528 6e6f 6465 290d 0a0d 0a20  ivate(node).... 
+00000870: 2020 2040 7472 6565 5f73 6570 6172 6174     @tree_separat
+00000880: 6f72 5f61 6674 6572 2829 0d0a 2020 2020  or_after()..    
+00000890: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
+000008a0: 5f28 2245 6469 7422 292c 206e 6f64 655f  _("Edit"), node_
+000008b0: 7479 7065 3d22 7574 696c 2063 6f6e 736f  type="util conso
+000008c0: 6c65 222c 2068 656c 703d 2222 290d 0a20  le", help="").. 
+000008d0: 2020 2064 6566 2065 6469 745f 636f 6e73     def edit_cons
+000008e0: 6f6c 655f 636f 6d6d 616e 6428 6e6f 6465  ole_command(node
+000008f0: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+00000900: 2020 2020 2020 6163 7469 7661 7465 203d        activate =
+00000910: 2073 656c 662e 6b65 726e 656c 2e6c 6f6f   self.kernel.loo
+00000920: 6b75 7028 2266 756e 6374 696f 6e2f 6f70  kup("function/op
+00000930: 656e 5f70 726f 7065 7274 795f 7769 6e64  en_property_wind
+00000940: 6f77 5f66 6f72 5f6e 6f64 6522 290d 0a20  ow_for_node").. 
+00000950: 2020 2020 2020 2069 6620 6163 7469 7661         if activa
+00000960: 7465 2069 7320 6e6f 7420 4e6f 6e65 3a0d  te is not None:.
+00000970: 0a20 2020 2020 2020 2020 2020 2061 6374  .            act
+00000980: 6976 6174 6528 6e6f 6465 290d 0a0d 0a20  ivate(node).... 
+00000990: 2020 2040 7472 6565 5f73 6570 6172 6174     @tree_separat
+000009a0: 6f72 5f61 6674 6572 2829 0d0a 2020 2020  or_after()..    
+000009b0: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
+000009c0: 0d0a 2020 2020 2020 2020 5f28 2245 6c65  ..        _("Ele
+000009d0: 6d65 6e74 2070 726f 7065 7274 6965 7322  ment properties"
+000009e0: 292c 0d0a 2020 2020 2020 2020 6e6f 6465  ),..        node
+000009f0: 5f74 7970 653d 280d 0a20 2020 2020 2020  _type=(..       
+00000a00: 2020 2020 2022 656c 656d 2065 6c6c 6970       "elem ellip
+00000a10: 7365 222c 0d0a 2020 2020 2020 2020 2020  se",..          
+00000a20: 2020 2265 6c65 6d20 7061 7468 222c 0d0a    "elem path",..
+00000a30: 2020 2020 2020 2020 2020 2020 2265 6c65              "ele
+00000a40: 6d20 706f 696e 7422 2c0d 0a20 2020 2020  m point",..     
+00000a50: 2020 2020 2020 2022 656c 656d 2070 6f6c         "elem pol
+00000a60: 796c 696e 6522 2c0d 0a20 2020 2020 2020  yline",..       
+00000a70: 2020 2020 2022 656c 656d 2072 6563 7422       "elem rect"
+00000a80: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
+00000a90: 656c 656d 206c 696e 6522 2c0d 0a20 2020  elem line",..   
+00000aa0: 2020 2020 2029 2c0d 0a20 2020 2020 2020       ),..       
+00000ab0: 2068 656c 703d 2222 2c0d 0a20 2020 2029   help="",..    )
+00000ac0: 0d0a 2020 2020 6465 6620 7061 7468 5f70  ..    def path_p
+00000ad0: 726f 7065 7274 7928 6e6f 6465 2c20 2a2a  roperty(node, **
+00000ae0: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
+00000af0: 2020 6163 7469 7661 7465 203d 2073 656c    activate = sel
+00000b00: 662e 6b65 726e 656c 2e6c 6f6f 6b75 7028  f.kernel.lookup(
+00000b10: 2266 756e 6374 696f 6e2f 6f70 656e 5f70  "function/open_p
+00000b20: 726f 7065 7274 795f 7769 6e64 6f77 5f66  roperty_window_f
+00000b30: 6f72 5f6e 6f64 6522 290d 0a20 2020 2020  or_node")..     
+00000b40: 2020 2069 6620 6163 7469 7661 7465 2069     if activate i
+00000b50: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
+00000b60: 2020 2020 2020 2020 2061 6374 6976 6174           activat
+00000b70: 6528 6e6f 6465 290d 0a0d 0a20 2020 2040  e(node)....    @
+00000b80: 7472 6565 5f73 6570 6172 6174 6f72 5f61  tree_separator_a
+00000b90: 6674 6572 2829 0d0a 2020 2020 4074 7265  fter()..    @tre
+00000ba0: 655f 6f70 6572 6174 696f 6e28 5f28 2247  e_operation(_("G
+00000bb0: 726f 7570 2070 726f 7065 7274 6965 7322  roup properties"
+00000bc0: 292c 206e 6f64 655f 7479 7065 3d22 6772  ), node_type="gr
+00000bd0: 6f75 7022 2c20 6865 6c70 3d22 2229 0d0a  oup", help="")..
+00000be0: 2020 2020 6465 6620 6772 6f75 705f 7072      def group_pr
+00000bf0: 6f70 6572 7479 286e 6f64 652c 202a 2a6b  operty(node, **k
+00000c00: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
+00000c10: 2061 6374 6976 6174 6520 3d20 7365 6c66   activate = self
+00000c20: 2e6b 6572 6e65 6c2e 6c6f 6f6b 7570 2822  .kernel.lookup("
+00000c30: 6675 6e63 7469 6f6e 2f6f 7065 6e5f 7072  function/open_pr
+00000c40: 6f70 6572 7479 5f77 696e 646f 775f 666f  operty_window_fo
+00000c50: 725f 6e6f 6465 2229 0d0a 2020 2020 2020  r_node")..      
+00000c60: 2020 6966 2061 6374 6976 6174 6520 6973    if activate is
+00000c70: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
+00000c80: 2020 2020 2020 2020 6163 7469 7661 7465          activate
+00000c90: 286e 6f64 6529 0d0a 0d0a 2020 2020 4074  (node)....    @t
+00000ca0: 7265 655f 7365 7061 7261 746f 725f 6166  ree_separator_af
+00000cb0: 7465 7228 290d 0a20 2020 2040 7472 6565  ter()..    @tree
+00000cc0: 5f6f 7065 7261 7469 6f6e 285f 2822 5465  _operation(_("Te
+00000cd0: 7874 2070 726f 7065 7274 6965 7322 292c  xt properties"),
+00000ce0: 206e 6f64 655f 7479 7065 3d22 656c 656d   node_type="elem
+00000cf0: 2074 6578 7422 2c20 6865 6c70 3d22 2229   text", help="")
+00000d00: 0d0a 2020 2020 6465 6620 7465 7874 5f70  ..    def text_p
+00000d10: 726f 7065 7274 7928 6e6f 6465 2c20 2a2a  roperty(node, **
+00000d20: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
+00000d30: 2020 6163 7469 7661 7465 203d 2073 656c    activate = sel
+00000d40: 662e 6b65 726e 656c 2e6c 6f6f 6b75 7028  f.kernel.lookup(
+00000d50: 2266 756e 6374 696f 6e2f 6f70 656e 5f70  "function/open_p
+00000d60: 726f 7065 7274 795f 7769 6e64 6f77 5f66  roperty_window_f
+00000d70: 6f72 5f6e 6f64 6522 290d 0a20 2020 2020  or_node")..     
+00000d80: 2020 2069 6620 6163 7469 7661 7465 2069     if activate i
+00000d90: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
+00000da0: 2020 2020 2020 2020 2061 6374 6976 6174           activat
+00000db0: 6528 6e6f 6465 290d 0a0d 0a20 2020 2040  e(node)....    @
+00000dc0: 7472 6565 5f73 6570 6172 6174 6f72 5f61  tree_separator_a
+00000dd0: 6674 6572 2829 0d0a 2020 2020 4074 7265  fter()..    @tre
+00000de0: 655f 6f70 6572 6174 696f 6e28 5f28 2249  e_operation(_("I
+00000df0: 6d61 6765 2070 726f 7065 7274 6965 7322  mage properties"
+00000e00: 292c 206e 6f64 655f 7479 7065 3d22 656c  ), node_type="el
+00000e10: 656d 2069 6d61 6765 222c 2068 656c 703d  em image", help=
+00000e20: 2222 290d 0a20 2020 2064 6566 2069 6d61  "")..    def ima
+00000e30: 6765 5f70 726f 7065 7274 7928 6e6f 6465  ge_property(node
+00000e40: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+00000e50: 2020 2020 2020 6163 7469 7661 7465 203d        activate =
+00000e60: 2073 656c 662e 6b65 726e 656c 2e6c 6f6f   self.kernel.loo
+00000e70: 6b75 7028 2266 756e 6374 696f 6e2f 6f70  kup("function/op
+00000e80: 656e 5f70 726f 7065 7274 795f 7769 6e64  en_property_wind
+00000e90: 6f77 5f66 6f72 5f6e 6f64 6522 290d 0a20  ow_for_node").. 
+00000ea0: 2020 2020 2020 2069 6620 6163 7469 7661         if activa
+00000eb0: 7465 2069 7320 6e6f 7420 4e6f 6e65 3a0d  te is not None:.
+00000ec0: 0a20 2020 2020 2020 2020 2020 2061 6374  .            act
+00000ed0: 6976 6174 6528 6e6f 6465 290d 0a0d 0a20  ivate(node).... 
+00000ee0: 2020 2040 7472 6565 5f63 6f6e 6469 7469     @tree_conditi
+00000ef0: 6f6e 616c 286c 616d 6264 6120 6e6f 6465  onal(lambda node
+00000f00: 3a20 6e6f 7420 6973 5f72 6567 6d61 726b  : not is_regmark
+00000f10: 286e 6f64 6529 290d 0a20 2020 2040 7472  (node))..    @tr
+00000f20: 6565 5f6f 7065 7261 7469 6f6e 285f 2822  ee_operation(_("
+00000f30: 556e 6772 6f75 7020 656c 656d 656e 7473  Ungroup elements
+00000f40: 2229 2c20 6e6f 6465 5f74 7970 653d 2822  "), node_type=("
+00000f50: 6772 6f75 7022 2c20 2266 696c 6522 292c  group", "file"),
+00000f60: 2068 656c 703d 2222 290d 0a20 2020 2064   help="")..    d
+00000f70: 6566 2075 6e67 726f 7570 5f65 6c65 6d65  ef ungroup_eleme
+00000f80: 6e74 7328 6e6f 6465 2c20 2a2a 6b77 6172  nts(node, **kwar
+00000f90: 6773 293a 0d0a 2020 2020 2020 2020 746f  gs):..        to
+00000fa0: 5f74 7265 6174 203d 205b 5d0d 0a20 2020  _treat = []..   
+00000fb0: 2020 2020 2066 6f72 2067 6e6f 6465 2069       for gnode i
+00000fc0: 6e20 7365 6c66 2e66 6c61 7428 7365 6c65  n self.flat(sele
+00000fd0: 6374 6564 3d54 7275 652c 2063 6173 6361  cted=True, casca
+00000fe0: 6465 3d46 616c 7365 2c20 7479 7065 733d  de=False, types=
+00000ff0: 2822 6772 6f75 7022 2c20 2266 696c 6522  ("group", "file"
+00001000: 2929 3a0d 0a20 2020 2020 2020 2020 2020  )):..           
+00001010: 2065 6e6f 6465 203d 2067 6e6f 6465 0d0a   enode = gnode..
+00001020: 2020 2020 2020 2020 2020 2020 7768 696c              whil
+00001030: 6520 5472 7565 3a0d 0a20 2020 2020 2020  e True:..       
+00001040: 2020 2020 2020 2020 2069 6620 656e 6f64           if enod
+00001050: 652e 7061 7265 6e74 2069 7320 4e6f 6e65  e.parent is None
+00001060: 206f 7220 656e 6f64 652e 7061 7265 6e74   or enode.parent
+00001070: 2069 7320 7365 6c66 2e65 6c65 6d5f 6272   is self.elem_br
+00001080: 616e 6368 3a0d 0a20 2020 2020 2020 2020  anch:..         
+00001090: 2020 2020 2020 2020 2020 2069 6620 656e             if en
+000010a0: 6f64 6520 6e6f 7420 696e 2074 6f5f 7472  ode not in to_tr
+000010b0: 6561 743a 0d0a 2020 2020 2020 2020 2020  eat:..          
+000010c0: 2020 2020 2020 2020 2020 2020 2020 746f                to
+000010d0: 5f74 7265 6174 2e61 7070 656e 6428 656e  _treat.append(en
+000010e0: 6f64 6529 0d0a 2020 2020 2020 2020 2020  ode)..          
+000010f0: 2020 2020 2020 2020 2020 6272 6561 6b0d            break.
+00001100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001110: 2069 6620 656e 6f64 652e 7061 7265 6e74   if enode.parent
+00001120: 2e73 656c 6563 7465 643a 0d0a 2020 2020  .selected:..    
+00001130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001140: 656e 6f64 6520 3d20 656e 6f64 652e 7061  enode = enode.pa
+00001150: 7265 6e74 0d0a 2020 2020 2020 2020 2020  rent..          
+00001160: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00001170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001180: 2069 6620 656e 6f64 6520 6e6f 7420 696e   if enode not in
+00001190: 2074 6f5f 7472 6561 743a 0d0a 2020 2020   to_treat:..    
+000011a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000011b0: 2020 2020 746f 5f74 7265 6174 2e61 7070      to_treat.app
+000011c0: 656e 6428 656e 6f64 6529 0d0a 2020 2020  end(enode)..    
+000011d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000011e0: 6272 6561 6b0d 0a0d 0a20 2020 2020 2020  break....       
+000011f0: 2066 6f72 2067 6e6f 6465 2069 6e20 746f   for gnode in to
+00001200: 5f74 7265 6174 3a0d 0a20 2020 2020 2020  _treat:..       
+00001210: 2020 2020 2066 6f72 206e 2069 6e20 6c69       for n in li
+00001220: 7374 2867 6e6f 6465 2e63 6869 6c64 7265  st(gnode.childre
+00001230: 6e29 3a0d 0a20 2020 2020 2020 2020 2020  n):..           
+00001240: 2020 2020 2067 6e6f 6465 2e69 6e73 6572       gnode.inser
+00001250: 745f 7369 626c 696e 6728 6e29 0d0a 2020  t_sibling(n)..  
+00001260: 2020 2020 2020 2020 2020 676e 6f64 652e            gnode.
+00001270: 7265 6d6f 7665 5f6e 6f64 6528 2920 2023  remove_node()  #
+00001280: 2052 656d 6f76 696e 6720 6772 6f75 702f   Removing group/
+00001290: 6669 6c65 206e 6f64 652e 0d0a 0d0a 2020  file node.....  
+000012a0: 2020 4074 7265 655f 636f 6e64 6974 696f    @tree_conditio
+000012b0: 6e61 6c28 6c61 6d62 6461 206e 6f64 653a  nal(lambda node:
+000012c0: 206e 6f74 2069 735f 7265 676d 6172 6b28   not is_regmark(
+000012d0: 6e6f 6465 2929 0d0a 2020 2020 4074 7265  node))..    @tre
+000012e0: 655f 6f70 6572 6174 696f 6e28 0d0a 2020  e_operation(..  
+000012f0: 2020 2020 2020 5f28 2253 696d 706c 6966        _("Simplif
+00001300: 7920 6772 6f75 7022 292c 0d0a 2020 2020  y group"),..    
+00001310: 2020 2020 6e6f 6465 5f74 7970 653d 2822      node_type=("
+00001320: 6772 6f75 7022 2c20 2266 696c 6522 292c  group", "file"),
+00001330: 0d0a 2020 2020 2020 2020 6865 6c70 3d5f  ..        help=_
+00001340: 2822 556e 6c65 7665 6c20 6772 6f75 7073  ("Unlevel groups
+00001350: 2069 6620 7468 6579 206a 7573 7420 636f   if they just co
+00001360: 6e74 6169 6e20 616e 6f74 6865 7220 6772  ntain another gr
+00001370: 6f75 7022 292c 0d0a 2020 2020 290d 0a20  oup"),..    ).. 
+00001380: 2020 2064 6566 2073 696d 706c 6966 795f     def simplify_
+00001390: 6772 6f75 7073 286e 6f64 652c 202a 2a6b  groups(node, **k
+000013a0: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
+000013b0: 2064 6566 2073 7472 6169 6768 7465 6e28   def straighten(
+000013c0: 736e 6f64 6529 3a0d 0a20 2020 2020 2020  snode):..       
+000013d0: 2020 2020 2061 6d6f 756e 7420 3d20 300d       amount = 0.
+000013e0: 0a20 2020 2020 2020 2020 2020 206e 6565  .            nee
+000013f0: 6473 5f72 6570 6574 6974 696f 6e20 3d20  ds_repetition = 
+00001400: 5472 7565 0d0a 2020 2020 2020 2020 2020  True..          
+00001410: 2020 7768 696c 6520 6e65 6564 735f 7265    while needs_re
+00001420: 7065 7469 7469 6f6e 3a0d 0a20 2020 2020  petition:..     
+00001430: 2020 2020 2020 2020 2020 206e 6565 6473             needs
+00001440: 5f72 6570 6574 6974 696f 6e20 3d20 4661  _repetition = Fa
+00001450: 6c73 650d 0a20 2020 2020 2020 2020 2020  lse..           
+00001460: 2020 2020 2063 6c20 3d20 6c69 7374 2873       cl = list(s
+00001470: 6e6f 6465 2e63 6869 6c64 7265 6e29 0d0a  node.children)..
+00001480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001490: 6966 206c 656e 2863 6c29 203d 3d20 303a  if len(cl) == 0:
+000014a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000014b0: 2020 2020 2020 2320 4e6f 2043 6869 6c64        # No Child
+000014c0: 7265 6e3f 2052 656d 6f76 650d 0a20 2020  ren? Remove..   
+000014d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000014e0: 2061 6d6f 756e 7420 3d20 310d 0a20 2020   amount = 1..   
+000014f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001500: 2073 6e6f 6465 2e72 656d 6f76 655f 6e6f   snode.remove_no
+00001510: 6465 2829 0d0a 2020 2020 2020 2020 2020  de()..          
+00001520: 2020 2020 2020 656c 6966 206c 656e 2863        elif len(c
+00001530: 6c29 203d 3d20 313a 0d0a 2020 2020 2020  l) == 1:..      
+00001540: 2020 2020 2020 2020 2020 2020 2020 676e                gn
+00001550: 6f64 6520 3d20 636c 5b30 5d0d 0a20 2020  ode = cl[0]..   
+00001560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001570: 2069 6620 676e 6f64 6520 6973 206e 6f74   if gnode is not
+00001580: 204e 6f6e 6520 616e 6420 676e 6f64 652e   None and gnode.
+00001590: 7479 7065 203d 3d20 2267 726f 7570 223a  type == "group":
+000015a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000015b0: 2020 2020 2020 2020 2020 666f 7220 6e20            for n 
+000015c0: 696e 206c 6973 7428 676e 6f64 652e 6368  in list(gnode.ch
+000015d0: 696c 6472 656e 293a 0d0a 2020 2020 2020  ildren):..      
+000015e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000015f0: 2020 2020 2020 676e 6f64 652e 696e 7365        gnode.inse
+00001600: 7274 5f73 6962 6c69 6e67 286e 290d 0a20  rt_sibling(n).. 
+00001610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001620: 2020 2020 2020 2067 6e6f 6465 2e72 656d         gnode.rem
+00001630: 6f76 655f 6e6f 6465 2829 2020 2320 5265  ove_node()  # Re
+00001640: 6d6f 7669 6e67 2067 726f 7570 2f66 696c  moving group/fil
+00001650: 6520 6e6f 6465 2e0d 0a20 2020 2020 2020  e node...       
+00001660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001670: 206e 6565 6473 5f72 6570 6574 6974 696f   needs_repetitio
+00001680: 6e20 3d20 5472 7565 0d0a 2020 2020 2020  n = True..      
+00001690: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+000016a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000016b0: 2020 2020 2066 6f72 206e 2069 6e20 636c       for n in cl
+000016c0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000016d0: 2020 2020 2020 2020 2020 2069 6620 6e20             if n 
+000016e0: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+000016f0: 6e2e 7479 7065 203d 3d20 2267 726f 7570  n.type == "group
+00001700: 223a 0d0a 2020 2020 2020 2020 2020 2020  ":..            
+00001710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001720: 666e 6420 3d20 7374 7261 6967 6874 656e  fnd = straighten
+00001730: 286e 290d 0a20 2020 2020 2020 2020 2020  (n)..           
+00001740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001750: 2061 6d6f 756e 7420 2b3d 2066 6e64 0d0a   amount += fnd..
+00001760: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00001770: 726e 2061 6d6f 756e 740d 0a0d 0a20 2020  rn amount....   
+00001780: 2020 2020 2072 6573 203d 2073 7472 6169       res = strai
+00001790: 6768 7465 6e28 6e6f 6465 290d 0a20 2020  ghten(node)..   
+000017a0: 2020 2020 2069 6620 7265 7320 3e20 303a       if res > 0:
+000017b0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+000017c0: 6c66 2e73 6967 6e61 6c28 2272 6562 7569  lf.signal("rebui
+000017d0: 6c64 5f74 7265 6522 290d 0a0d 0a20 2020  ld_tree")....   
+000017e0: 2040 7472 6565 5f63 6f6e 6469 7469 6f6e   @tree_condition
+000017f0: 616c 286c 616d 6264 6120 6e6f 6465 3a20  al(lambda node: 
+00001800: 6c65 6e28 6c69 7374 2873 656c 662e 656c  len(list(self.el
+00001810: 656d 7328 656d 7068 6173 697a 6564 3d54  ems(emphasized=T
+00001820: 7275 6529 2929 203e 2030 290d 0a20 2020  rue))) > 0)..   
+00001830: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
+00001840: 280d 0a20 2020 2020 2020 205f 2822 456c  (..        _("El
+00001850: 656d 656e 7473 2069 6e20 7363 656e 652e  ements in scene.
+00001860: 2e2e 2229 2c20 6e6f 6465 5f74 7970 653d  .."), node_type=
+00001870: 656c 656d 5f6e 6f64 6573 2c20 6865 6c70  elem_nodes, help
+00001880: 3d22 222c 2065 6e61 626c 653d 4661 6c73  ="", enable=Fals
+00001890: 650d 0a20 2020 2029 0d0a 2020 2020 6465  e..    )..    de
+000018a0: 6620 656c 656d 656e 745f 6c61 6265 6c28  f element_label(
+000018b0: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
+000018c0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+000018d0: 0d0a 0d0a 2020 2020 4074 7265 655f 636f  ....    @tree_co
+000018e0: 6e64 6974 696f 6e61 6c28 6c61 6d62 6461  nditional(lambda
+000018f0: 206e 6f64 653a 206e 6f74 2069 735f 7265   node: not is_re
+00001900: 676d 6172 6b28 6e6f 6465 2929 0d0a 2020  gmark(node))..  
+00001910: 2020 4074 7265 655f 636f 6e64 6974 696f    @tree_conditio
+00001920: 6e61 6c28 6c61 6d62 6461 206e 6f64 653a  nal(lambda node:
+00001930: 206c 656e 286c 6973 7428 7365 6c66 2e65   len(list(self.e
+00001940: 6c65 6d73 2865 6d70 6861 7369 7a65 643d  lems(emphasized=
+00001950: 5472 7565 2929 2920 3e20 3129 0d0a 2020  True))) > 1)..  
+00001960: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
+00001970: 6e28 5f28 2247 726f 7570 2065 6c65 6d65  n(_("Group eleme
+00001980: 6e74 7322 292c 206e 6f64 655f 7479 7065  nts"), node_type
+00001990: 3d65 6c65 6d5f 6e6f 6465 732c 2068 656c  =elem_nodes, hel
+000019a0: 703d 2222 290d 0a20 2020 2064 6566 2067  p="")..    def g
+000019b0: 726f 7570 5f65 6c65 6d65 6e74 7328 6e6f  roup_elements(no
+000019c0: 6465 2c20 2a2a 6b77 6172 6773 293a 0d0a  de, **kwargs):..
+000019d0: 2020 2020 2020 2020 6772 6f75 705f 6e6f          group_no
+000019e0: 6465 203d 206e 6f64 652e 7061 7265 6e74  de = node.parent
+000019f0: 2e61 6464 2874 7970 653d 2267 726f 7570  .add(type="group
+00001a00: 222c 206c 6162 656c 3d22 4772 6f75 7022  ", label="Group"
+00001a10: 290d 0a20 2020 2020 2020 2066 6f72 2065  )..        for e
+00001a20: 2069 6e20 6c69 7374 2873 656c 662e 656c   in list(self.el
+00001a30: 656d 7328 656d 7068 6173 697a 6564 3d54  ems(emphasized=T
+00001a40: 7275 6529 293a 0d0a 2020 2020 2020 2020  rue)):..        
+00001a50: 2020 2020 6772 6f75 705f 6e6f 6465 2e61      group_node.a
+00001a60: 7070 656e 645f 6368 696c 6428 6529 0d0a  ppend_child(e)..
+00001a70: 0d0a 2020 2020 4074 7265 655f 636f 6e64  ..    @tree_cond
+00001a80: 6974 696f 6e61 6c28 0d0a 2020 2020 2020  itional(..      
+00001a90: 2020 6c61 6d62 6461 2063 6f6e 643a 206c    lambda cond: l
+00001aa0: 656e 286c 6973 7428 7365 6c66 2e66 6c61  en(list(self.fla
+00001ab0: 7428 7365 6c65 6374 6564 3d54 7275 652c  t(selected=True,
+00001ac0: 2063 6173 6361 6465 3d46 616c 7365 2c20   cascade=False, 
+00001ad0: 7479 7065 733d 6f70 5f6e 6f64 6573 2929  types=op_nodes))
+00001ae0: 290d 0a20 2020 2020 2020 203e 3d20 310d  )..        >= 1.
+00001af0: 0a20 2020 2029 0d0a 2020 2020 4074 7265  .    )..    @tre
+00001b00: 655f 6f70 6572 6174 696f 6e28 0d0a 2020  e_operation(..  
+00001b10: 2020 2020 2020 5f28 2252 656d 6f76 6520        _("Remove 
+00001b20: 616c 6c20 6974 656d 7320 6672 6f6d 206f  all items from o
+00001b30: 7065 7261 7469 6f6e 2229 2c20 6e6f 6465  peration"), node
+00001b40: 5f74 7970 653d 6f70 5f70 6172 656e 745f  _type=op_parent_
+00001b50: 6e6f 6465 732c 2068 656c 703d 2222 0d0a  nodes, help=""..
+00001b60: 2020 2020 290d 0a20 2020 2064 6566 2063      )..    def c
+00001b70: 6c65 6172 5f61 6c6c 5f6f 705f 656e 7472  lear_all_op_entr
+00001b80: 6965 7328 6e6f 6465 2c20 2a2a 6b77 6172  ies(node, **kwar
+00001b90: 6773 293a 0d0a 2020 2020 2020 2020 7769  gs):..        wi
+00001ba0: 7468 2073 656c 662e 7374 6174 6963 2822  th self.static("
+00001bb0: 636c 6561 725f 616c 6c5f 6f70 2229 3a0d  clear_all_op"):.
+00001bc0: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
+00001bd0: 6120 3d20 6c69 7374 2829 0d0a 2020 2020  a = list()..    
+00001be0: 2020 2020 2020 2020 7265 6d6f 7665 6420          removed 
+00001bf0: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
+00001c00: 2020 2020 2066 6f72 2069 7465 6d20 696e       for item in
+00001c10: 206c 6973 7428 7365 6c66 2e66 6c61 7428   list(self.flat(
+00001c20: 7365 6c65 6374 6564 3d54 7275 652c 2063  selected=True, c
+00001c30: 6173 6361 6465 3d46 616c 7365 2c20 7479  ascade=False, ty
+00001c40: 7065 733d 6f70 5f6e 6f64 6573 2929 3a0d  pes=op_nodes)):.
+00001c50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001c60: 2064 6174 612e 6170 7065 6e64 2869 7465   data.append(ite
+00001c70: 6d29 0d0a 2020 2020 2020 2020 2020 2020  m)..            
+00001c80: 666f 7220 6974 656d 2069 6e20 6461 7461  for item in data
+00001c90: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00001ca0: 2020 2072 656d 6f76 6564 203d 2054 7275     removed = Tru
+00001cb0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+00001cc0: 2020 2069 7465 6d2e 7265 6d6f 7665 5f61     item.remove_a
+00001cd0: 6c6c 5f63 6869 6c64 7265 6e28 290d 0a0d  ll_children()...
+00001ce0: 0a20 2020 2040 7472 6565 5f63 6f6e 6469  .    @tree_condi
+00001cf0: 7469 6f6e 616c 286c 616d 6264 6120 6e6f  tional(lambda no
+00001d00: 6465 3a20 6861 7361 7474 7228 6e6f 6465  de: hasattr(node
+00001d10: 2c20 226f 7574 7075 7422 2929 0d0a 2020  , "output"))..  
+00001d20: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
+00001d30: 6e28 5f28 2245 6e61 626c 652f 4469 7361  n(_("Enable/Disa
+00001d40: 626c 6520 6f70 7322 292c 206e 6f64 655f  ble ops"), node_
+00001d50: 7479 7065 3d6f 705f 6e6f 6465 732c 2068  type=op_nodes, h
+00001d60: 656c 703d 2222 290d 0a20 2020 2064 6566  elp="")..    def
+00001d70: 2074 6f67 676c 655f 6e5f 6f70 6572 6174   toggle_n_operat
+00001d80: 696f 6e73 286e 6f64 652c 202a 2a6b 7761  ions(node, **kwa
+00001d90: 7267 7329 3a0d 0a20 2020 2020 2020 2063  rgs):..        c
+00001da0: 6861 6e67 6573 203d 205b 5d0d 0a20 2020  hanges = []..   
+00001db0: 2020 2020 2066 6f72 206e 2069 6e20 7365       for n in se
+00001dc0: 6c66 2e6f 7073 2873 656c 6563 7465 643d  lf.ops(selected=
+00001dd0: 5472 7565 293a 0d0a 2020 2020 2020 2020  True):..        
+00001de0: 2020 2020 6966 2068 6173 6174 7472 286e      if hasattr(n
+00001df0: 2c20 226f 7574 7075 7422 293a 0d0a 2020  , "output"):..  
+00001e00: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+00001e10: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+00001e20: 2020 2020 2020 2020 6e2e 6f75 7470 7574          n.output
+00001e30: 203d 206e 6f74 206e 2e6f 7574 7075 740d   = not n.output.
+00001e40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001e50: 2020 2020 206e 2e75 7064 6174 6564 2829       n.updated()
+00001e60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00001e70: 2020 2020 2020 6368 616e 6765 732e 6170        changes.ap
+00001e80: 7065 6e64 286e 290d 0a20 2020 2020 2020  pend(n)..       
+00001e90: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+00001ea0: 4174 7472 6962 7574 6545 7272 6f72 3a0d  AttributeError:.
+00001eb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001ec0: 2020 2020 2070 6173 730d 0a20 2020 2020       pass..     
+00001ed0: 2020 2069 6620 6c65 6e28 6368 616e 6765     if len(change
+00001ee0: 7329 203e 2030 3a0d 0a20 2020 2020 2020  s) > 0:..       
+00001ef0: 2020 2020 2073 656c 662e 7661 6c69 6461       self.valida
+00001f00: 7465 5f73 656c 6563 7465 645f 6172 6561  te_selected_area
+00001f10: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00001f20: 7365 6c66 2e73 6967 6e61 6c28 2265 6c65  self.signal("ele
+00001f30: 6d65 6e74 5f70 726f 7065 7274 795f 7570  ment_property_up
+00001f40: 6461 7465 222c 2063 6861 6e67 6573 290d  date", changes).
+00001f50: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00001f60: 662e 7369 676e 616c 2822 7265 6672 6573  f.signal("refres
+00001f70: 685f 7363 656e 6522 2c20 2253 6365 6e65  h_scene", "Scene
+00001f80: 2229 0d0a 0d0a 2020 2020 4074 7265 655f  ")....    @tree_
+00001f90: 636f 6e64 6974 696f 6e61 6c28 0d0a 2020  conditional(..  
+00001fa0: 2020 2020 2020 6c61 6d62 6461 206e 6f64        lambda nod
+00001fb0: 653a 2068 6173 6174 7472 286e 6f64 652c  e: hasattr(node,
+00001fc0: 2022 6f75 7470 7574 2229 0d0a 2020 2020   "output")..    
+00001fd0: 2020 2020 616e 6420 6861 7361 7474 7228      and hasattr(
+00001fe0: 6e6f 6465 2c20 2269 735f 7669 7369 626c  node, "is_visibl
+00001ff0: 6522 290d 0a20 2020 2020 2020 2061 6e64  e")..        and
+00002000: 206e 6f74 2067 6574 6174 7472 286e 6f64   not getattr(nod
+00002010: 652c 2022 6f75 7470 7574 222c 2054 7275  e, "output", Tru
+00002020: 6529 0d0a 2020 2020 290d 0a20 2020 2040  e)..    )..    @
+00002030: 7472 6565 5f6f 7065 7261 7469 6f6e 285f  tree_operation(_
+00002040: 2822 5368 6f77 2f48 6964 6520 636f 6e74  ("Show/Hide cont
+00002050: 6169 6e65 6420 656c 656d 656e 7473 2229  ained elements")
+00002060: 2c20 6e6f 6465 5f74 7970 653d 6f70 5f6e  , node_type=op_n
+00002070: 6f64 6573 2c20 6865 6c70 3d22 2229 0d0a  odes, help="")..
+00002080: 2020 2020 6465 6620 746f 6767 6c65 5f6f      def toggle_o
+00002090: 705f 656c 656d 5f76 6973 6962 696c 6974  p_elem_visibilit
+000020a0: 7928 6e6f 6465 2c20 2a2a 6b77 6172 6773  y(node, **kwargs
+000020b0: 293a 0d0a 2020 2020 2020 2020 6368 616e  ):..        chan
+000020c0: 6765 7320 3d20 5b5d 0d0a 2020 2020 2020  ges = []..      
+000020d0: 2020 666f 7220 6e20 696e 2073 656c 662e    for n in self.
+000020e0: 6f70 7328 7365 6c65 6374 6564 3d54 7275  ops(selected=Tru
+000020f0: 6529 3a0d 0a20 2020 2020 2020 2020 2020  e):..           
+00002100: 2069 6620 6861 7361 7474 7228 6e2c 2022   if hasattr(n, "
+00002110: 6f75 7470 7574 2229 2061 6e64 2068 6173  output") and has
+00002120: 6174 7472 286e 2c20 2269 735f 7669 7369  attr(n, "is_visi
+00002130: 626c 6522 293a 0d0a 2020 2020 2020 2020  ble"):..        
+00002140: 2020 2020 2020 2020 6e65 7766 6c61 6720          newflag 
+00002150: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
+00002160: 2020 2020 2020 2020 6966 206e 2e6f 7574          if n.out
+00002170: 7075 7420 6973 206e 6f74 204e 6f6e 653a  put is not None:
+00002180: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00002190: 2020 2020 2020 6966 206e 6f74 206e 2e6f        if not n.o
+000021a0: 7574 7075 743a 0d0a 2020 2020 2020 2020  utput:..        
+000021b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000021c0: 6e65 7766 6c61 6720 3d20 626f 6f6c 286e  newflag = bool(n
+000021d0: 6f74 206e 2e69 735f 7669 7369 626c 6529  ot n.is_visible)
+000021e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000021f0: 2020 6e2e 6973 5f76 6973 6962 6c65 203d    n.is_visible =
+00002200: 206e 6577 666c 6167 0d0a 2020 2020 2020   newflag..      
+00002210: 2020 2020 2020 2020 2020 6e2e 7570 6461            n.upda
+00002220: 7465 6428 290d 0a20 2020 2020 2020 2020  ted()..         
+00002230: 2020 2020 2020 2063 6861 6e67 6573 2e61         changes.a
+00002240: 7070 656e 6428 6e29 0d0a 2020 2020 2020  ppend(n)..      
+00002250: 2020 6966 206c 656e 2863 6861 6e67 6573    if len(changes
+00002260: 2920 3e20 303a 0d0a 2020 2020 2020 2020  ) > 0:..        
+00002270: 2020 2020 7365 6c66 2e76 616c 6964 6174      self.validat
+00002280: 655f 7365 6c65 6374 6564 5f61 7265 6128  e_selected_area(
+00002290: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+000022a0: 656c 662e 7369 676e 616c 2822 656c 656d  elf.signal("elem
+000022b0: 656e 745f 7072 6f70 6572 7479 5f75 7064  ent_property_upd
+000022c0: 6174 6522 2c20 6368 616e 6765 7329 0d0a  ate", changes)..
+000022d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000022e0: 2e73 6967 6e61 6c28 2272 6566 7265 7368  .signal("refresh
+000022f0: 5f73 6365 6e65 222c 2022 5363 656e 6522  _scene", "Scene"
+00002300: 290d 0a0d 0a20 2020 2040 7472 6565 5f63  )....    @tree_c
+00002310: 6f6e 6469 7469 6f6e 616c 286c 616d 6264  onditional(lambd
+00002320: 6120 6e6f 6465 3a20 6861 7361 7474 7228  a node: hasattr(
+00002330: 6e6f 6465 2c20 226f 7574 7075 7422 2929  node, "output"))
+00002340: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
+00002350: 6174 696f 6e28 0d0a 2020 2020 2020 2020  ation(..        
+00002360: 5f28 2245 6e61 626c 6520 7369 6d69 6c61  _("Enable simila
+00002370: 7222 292c 0d0a 2020 2020 2020 2020 6e6f  r"),..        no
+00002380: 6465 5f74 7970 653d 6f70 5f6e 6f64 6573  de_type=op_nodes
+00002390: 2c0d 0a20 2020 2020 2020 2068 656c 703d  ,..        help=
+000023a0: 5f28 2245 6e61 626c 6520 616c 6c20 6f70  _("Enable all op
+000023b0: 6572 6174 696f 6e73 206f 6620 7468 6973  erations of this
+000023c0: 2074 7970 6522 292c 0d0a 2020 2020 290d   type"),..    ).
+000023d0: 0a20 2020 2064 6566 206f 7073 5f65 6e61  .    def ops_ena
+000023e0: 626c 655f 7369 6d69 6c61 7228 6e6f 6465  ble_similar(node
+000023f0: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+00002400: 2020 2020 2020 6f70 6c69 7374 203d 205b        oplist = [
+00002410: 5d0d 0a20 2020 2020 2020 2066 6f72 206e  ]..        for n
+00002420: 2069 6e20 7365 6c66 2e6f 7073 2829 3a0d   in self.ops():.
+00002430: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00002440: 6e2e 7479 7065 203d 3d20 6e6f 6465 2e74  n.type == node.t
+00002450: 7970 653a 0d0a 2020 2020 2020 2020 2020  ype:..          
+00002460: 2020 2020 2020 6f70 6c69 7374 2e61 7070        oplist.app
+00002470: 656e 6428 6e29 0d0a 2020 2020 2020 2020  end(n)..        
+00002480: 7365 745f 6f70 5f6f 7574 7075 7428 6f70  set_op_output(op
+00002490: 6c69 7374 2c20 5472 7565 290d 0a0d 0a20  list, True).... 
+000024a0: 2020 2040 7472 6565 5f63 6f6e 6469 7469     @tree_conditi
+000024b0: 6f6e 616c 286c 616d 6264 6120 6e6f 6465  onal(lambda node
+000024c0: 3a20 6861 7361 7474 7228 6e6f 6465 2c20  : hasattr(node, 
+000024d0: 226f 7574 7075 7422 2929 0d0a 2020 2020  "output"))..    
+000024e0: 4074 7265 655f 7365 7061 7261 746f 725f  @tree_separator_
+000024f0: 6166 7465 7228 290d 0a20 2020 2040 7472  after()..    @tr
+00002500: 6565 5f6f 7065 7261 7469 6f6e 280d 0a20  ee_operation(.. 
+00002510: 2020 2020 2020 205f 2822 4469 7361 626c         _("Disabl
+00002520: 6520 7369 6d69 6c61 7222 292c 0d0a 2020  e similar"),..  
+00002530: 2020 2020 2020 6e6f 6465 5f74 7970 653d        node_type=
+00002540: 6f70 5f6e 6f64 6573 2c0d 0a20 2020 2020  op_nodes,..     
+00002550: 2020 2068 656c 703d 5f28 2244 6973 6162     help=_("Disab
+00002560: 6c65 2061 6c6c 206f 7065 7261 7469 6f6e  le all operation
+00002570: 7320 6f66 2074 6869 7320 7479 7065 2229  s of this type")
+00002580: 2c0d 0a20 2020 2029 0d0a 2020 2020 6465  ,..    )..    de
+00002590: 6620 6f70 735f 6469 7361 626c 655f 7369  f ops_disable_si
+000025a0: 6d69 6c61 7228 6e6f 6465 2c20 2a2a 6b77  milar(node, **kw
+000025b0: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
+000025c0: 6f70 6c69 7374 203d 205b 5d0d 0a20 2020  oplist = []..   
+000025d0: 2020 2020 2066 6f72 206e 2069 6e20 7365       for n in se
+000025e0: 6c66 2e6f 7073 2829 3a0d 0a20 2020 2020  lf.ops():..     
+000025f0: 2020 2020 2020 2069 6620 6e2e 7479 7065         if n.type
+00002600: 203d 3d20 6e6f 6465 2e74 7970 653a 0d0a   == node.type:..
+00002610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002620: 6f70 6c69 7374 2e61 7070 656e 6428 6e29  oplist.append(n)
+00002630: 0d0a 2020 2020 2020 2020 7365 745f 6f70  ..        set_op
+00002640: 5f6f 7574 7075 7428 6f70 6c69 7374 2c20  _output(oplist, 
+00002650: 4661 6c73 6529 0d0a 0d0a 2020 2020 4074  False)....    @t
+00002660: 7265 655f 7375 626d 656e 7528 5f28 2243  ree_submenu(_("C
+00002670: 6f6e 7665 7274 206f 7065 7261 7469 6f6e  onvert operation
+00002680: 2229 290d 0a20 2020 2040 7472 6565 5f6f  "))..    @tree_o
+00002690: 7065 7261 7469 6f6e 285f 2822 436f 6e76  peration(_("Conv
+000026a0: 6572 7420 746f 2049 6d61 6765 2229 2c20  ert to Image"), 
+000026b0: 6e6f 6465 5f74 7970 653d 6f70 5f70 6172  node_type=op_par
+000026c0: 656e 745f 6e6f 6465 732c 2068 656c 703d  ent_nodes, help=
+000026d0: 2222 290d 0a20 2020 2064 6566 2063 6f6e  "")..    def con
+000026e0: 7665 7274 5f6f 7065 7261 7469 6f6e 5f69  vert_operation_i
+000026f0: 6d61 6765 286e 6f64 652c 202a 2a6b 7761  mage(node, **kwa
+00002700: 7267 7329 3a0d 0a20 2020 2020 2020 2066  rgs):..        f
+00002710: 6f72 206e 2069 6e20 6c69 7374 2873 656c  or n in list(sel
+00002720: 662e 6f70 7328 7365 6c65 6374 6564 3d54  f.ops(selected=T
+00002730: 7275 6529 293a 0d0a 2020 2020 2020 2020  rue)):..        
+00002740: 2020 2020 6e65 775f 7365 7474 696e 6773      new_settings
+00002750: 203d 2064 6963 7428 6e2e 7365 7474 696e   = dict(n.settin
+00002760: 6773 290d 0a20 2020 2020 2020 2020 2020  gs)..           
+00002770: 206e 6577 5f73 6574 7469 6e67 735b 2274   new_settings["t
+00002780: 7970 6522 5d20 3d20 226f 7020 696d 6167  ype"] = "op imag
+00002790: 6522 0d0a 2020 2020 2020 2020 2020 2020  e"..            
+000027a0: 6e2e 7265 706c 6163 655f 6e6f 6465 286b  n.replace_node(k
+000027b0: 6565 705f 6368 696c 6472 656e 3d54 7275  eep_children=Tru
+000027c0: 652c 202a 2a6e 6577 5f73 6574 7469 6e67  e, **new_setting
+000027d0: 7329 0d0a 2020 2020 2020 2020 7365 6c66  s)..        self
+000027e0: 2e73 6967 6e61 6c28 2272 6562 7569 6c64  .signal("rebuild
+000027f0: 5f74 7265 6522 290d 0a0d 0a20 2020 2040  _tree")....    @
+00002800: 7472 6565 5f73 7562 6d65 6e75 285f 2822  tree_submenu(_("
+00002810: 436f 6e76 6572 7420 6f70 6572 6174 696f  Convert operatio
+00002820: 6e22 2929 0d0a 2020 2020 4074 7265 655f  n"))..    @tree_
+00002830: 6f70 6572 6174 696f 6e28 5f28 2243 6f6e  operation(_("Con
+00002840: 7665 7274 2074 6f20 5261 7374 6572 2229  vert to Raster")
+00002850: 2c20 6e6f 6465 5f74 7970 653d 6f70 5f70  , node_type=op_p
+00002860: 6172 656e 745f 6e6f 6465 732c 2068 656c  arent_nodes, hel
+00002870: 703d 2222 290d 0a20 2020 2064 6566 2063  p="")..    def c
+00002880: 6f6e 7665 7274 5f6f 7065 7261 7469 6f6e  onvert_operation
+00002890: 5f72 6173 7465 7228 6e6f 6465 2c20 2a2a  _raster(node, **
+000028a0: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
+000028b0: 2020 666f 7220 6e20 696e 206c 6973 7428    for n in list(
+000028c0: 7365 6c66 2e6f 7073 2873 656c 6563 7465  self.ops(selecte
+000028d0: 643d 5472 7565 2929 3a0d 0a20 2020 2020  d=True)):..     
+000028e0: 2020 2020 2020 206e 6577 5f73 6574 7469         new_setti
+000028f0: 6e67 7320 3d20 6469 6374 286e 2e73 6574  ngs = dict(n.set
+00002900: 7469 6e67 7329 0d0a 2020 2020 2020 2020  tings)..        
+00002910: 2020 2020 6e65 775f 7365 7474 696e 6773      new_settings
+00002920: 5b22 7479 7065 225d 203d 2022 6f70 2072  ["type"] = "op r
+00002930: 6173 7465 7222 0d0a 2020 2020 2020 2020  aster"..        
+00002940: 2020 2020 6e2e 7265 706c 6163 655f 6e6f      n.replace_no
+00002950: 6465 286b 6565 705f 6368 696c 6472 656e  de(keep_children
+00002960: 3d54 7275 652c 202a 2a6e 6577 5f73 6574  =True, **new_set
+00002970: 7469 6e67 7329 0d0a 2020 2020 2020 2020  tings)..        
+00002980: 7365 6c66 2e73 6967 6e61 6c28 2272 6562  self.signal("reb
+00002990: 7569 6c64 5f74 7265 6522 290d 0a0d 0a20  uild_tree").... 
+000029a0: 2020 2040 7472 6565 5f73 7562 6d65 6e75     @tree_submenu
+000029b0: 285f 2822 436f 6e76 6572 7420 6f70 6572  (_("Convert oper
+000029c0: 6174 696f 6e22 2929 0d0a 2020 2020 4074  ation"))..    @t
+000029d0: 7265 655f 6f70 6572 6174 696f 6e28 5f28  ree_operation(_(
+000029e0: 2243 6f6e 7665 7274 2074 6f20 456e 6772  "Convert to Engr
+000029f0: 6176 6522 292c 206e 6f64 655f 7479 7065  ave"), node_type
+00002a00: 3d6f 705f 7061 7265 6e74 5f6e 6f64 6573  =op_parent_nodes
+00002a10: 2c20 6865 6c70 3d22 2229 0d0a 2020 2020  , help="")..    
+00002a20: 6465 6620 636f 6e76 6572 745f 6f70 6572  def convert_oper
+00002a30: 6174 696f 6e5f 656e 6772 6176 6528 6e6f  ation_engrave(no
+00002a40: 6465 2c20 2a2a 6b77 6172 6773 293a 0d0a  de, **kwargs):..
+00002a50: 2020 2020 2020 2020 666f 7220 6e20 696e          for n in
+00002a60: 206c 6973 7428 7365 6c66 2e6f 7073 2873   list(self.ops(s
+00002a70: 656c 6563 7465 643d 5472 7565 2929 3a0d  elected=True)):.
+00002a80: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
+00002a90: 5f73 6574 7469 6e67 7320 3d20 6469 6374  _settings = dict
+00002aa0: 286e 2e73 6574 7469 6e67 7329 0d0a 2020  (n.settings)..  
+00002ab0: 2020 2020 2020 2020 2020 6e65 775f 7365            new_se
+00002ac0: 7474 696e 6773 5b22 7479 7065 225d 203d  ttings["type"] =
+00002ad0: 2022 6f70 2065 6e67 7261 7665 220d 0a20   "op engrave".. 
+00002ae0: 2020 2020 2020 2020 2020 206e 2e72 6570             n.rep
+00002af0: 6c61 6365 5f6e 6f64 6528 6b65 6570 5f63  lace_node(keep_c
+00002b00: 6869 6c64 7265 6e3d 5472 7565 2c20 2a2a  hildren=True, **
+00002b10: 6e65 775f 7365 7474 696e 6773 290d 0a20  new_settings).. 
+00002b20: 2020 2020 2020 2073 656c 662e 7369 676e         self.sign
+00002b30: 616c 2822 7265 6275 696c 645f 7472 6565  al("rebuild_tree
+00002b40: 2229 0d0a 0d0a 2020 2020 4074 7265 655f  ")....    @tree_
+00002b50: 7375 626d 656e 7528 5f28 2243 6f6e 7665  submenu(_("Conve
+00002b60: 7274 206f 7065 7261 7469 6f6e 2229 290d  rt operation")).
+00002b70: 0a20 2020 2040 7472 6565 5f6f 7065 7261  .    @tree_opera
+00002b80: 7469 6f6e 285f 2822 436f 6e76 6572 7420  tion(_("Convert 
+00002b90: 746f 2043 7574 2229 2c20 6e6f 6465 5f74  to Cut"), node_t
+00002ba0: 7970 653d 6f70 5f70 6172 656e 745f 6e6f  ype=op_parent_no
+00002bb0: 6465 732c 2068 656c 703d 2222 290d 0a20  des, help="").. 
+00002bc0: 2020 2064 6566 2063 6f6e 7665 7274 5f6f     def convert_o
+00002bd0: 7065 7261 7469 6f6e 5f63 7574 286e 6f64  peration_cut(nod
+00002be0: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
+00002bf0: 2020 2020 2020 2066 6f72 206e 2069 6e20         for n in 
+00002c00: 6c69 7374 2873 656c 662e 6f70 7328 7365  list(self.ops(se
+00002c10: 6c65 6374 6564 3d54 7275 6529 293a 0d0a  lected=True)):..
+00002c20: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+00002c30: 7365 7474 696e 6773 203d 2064 6963 7428  settings = dict(
+00002c40: 6e2e 7365 7474 696e 6773 290d 0a20 2020  n.settings)..   
+00002c50: 2020 2020 2020 2020 206e 6577 5f73 6574           new_set
+00002c60: 7469 6e67 735b 2274 7970 6522 5d20 3d20  tings["type"] = 
+00002c70: 226f 7020 6375 7422 0d0a 2020 2020 2020  "op cut"..      
+00002c80: 2020 2020 2020 6e2e 7265 706c 6163 655f        n.replace_
+00002c90: 6e6f 6465 286b 6565 705f 6368 696c 6472  node(keep_childr
+00002ca0: 656e 3d54 7275 652c 202a 2a6e 6577 5f73  en=True, **new_s
+00002cb0: 6574 7469 6e67 7329 0d0a 2020 2020 2020  ettings)..      
+00002cc0: 2020 7365 6c66 2e73 6967 6e61 6c28 2272    self.signal("r
+00002cd0: 6562 7569 6c64 5f74 7265 6522 290d 0a0d  ebuild_tree")...
+00002ce0: 0a20 2020 2040 7472 6565 5f73 7562 6d65  .    @tree_subme
+00002cf0: 6e75 285f 2822 436f 6e76 6572 7420 6f70  nu(_("Convert op
+00002d00: 6572 6174 696f 6e22 2929 0d0a 2020 2020  eration"))..    
+00002d10: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
+00002d20: 5f28 2243 6f6e 7665 7274 2074 6f20 4861  _("Convert to Ha
+00002d30: 7463 6822 292c 206e 6f64 655f 7479 7065  tch"), node_type
+00002d40: 3d6f 705f 7061 7265 6e74 5f6e 6f64 6573  =op_parent_nodes
+00002d50: 2c20 6865 6c70 3d22 2229 0d0a 2020 2020  , help="")..    
+00002d60: 6465 6620 636f 6e76 6572 745f 6f70 6572  def convert_oper
+00002d70: 6174 696f 6e5f 6861 7463 6828 6e6f 6465  ation_hatch(node
+00002d80: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+00002d90: 2020 2020 2020 666f 7220 6e20 696e 206c        for n in l
+00002da0: 6973 7428 7365 6c66 2e6f 7073 2873 656c  ist(self.ops(sel
+00002db0: 6563 7465 643d 5472 7565 2929 3a0d 0a20  ected=True)):.. 
+00002dc0: 2020 2020 2020 2020 2020 206e 6577 5f73             new_s
+00002dd0: 6574 7469 6e67 7320 3d20 6469 6374 286e  ettings = dict(n
+00002de0: 2e73 6574 7469 6e67 7329 0d0a 2020 2020  .settings)..    
+00002df0: 2020 2020 2020 2020 6e65 775f 7365 7474          new_sett
+00002e00: 696e 6773 5b22 7479 7065 225d 203d 2022  ings["type"] = "
+00002e10: 6f70 2068 6174 6368 220d 0a20 2020 2020  op hatch"..     
+00002e20: 2020 2020 2020 206e 2e72 6570 6c61 6365         n.replace
+00002e30: 5f6e 6f64 6528 6b65 6570 5f63 6869 6c64  _node(keep_child
+00002e40: 7265 6e3d 5472 7565 2c20 2a2a 6e65 775f  ren=True, **new_
+00002e50: 7365 7474 696e 6773 290d 0a20 2020 2020  settings)..     
+00002e60: 2020 2073 656c 662e 7369 676e 616c 2822     self.signal("
+00002e70: 7265 6275 696c 645f 7472 6565 2229 0d0a  rebuild_tree")..
+00002e80: 0d0a 2020 2020 4074 7265 655f 7375 626d  ..    @tree_subm
+00002e90: 656e 7528 5f28 2243 6f6e 7665 7274 206f  enu(_("Convert o
+00002ea0: 7065 7261 7469 6f6e 2229 290d 0a20 2020  peration"))..   
+00002eb0: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
+00002ec0: 285f 2822 436f 6e76 6572 7420 746f 2044  (_("Convert to D
+00002ed0: 6f74 7322 292c 206e 6f64 655f 7479 7065  ots"), node_type
+00002ee0: 3d6f 705f 7061 7265 6e74 5f6e 6f64 6573  =op_parent_nodes
+00002ef0: 2c20 6865 6c70 3d22 2229 0d0a 2020 2020  , help="")..    
+00002f00: 6465 6620 636f 6e76 6572 745f 6f70 6572  def convert_oper
+00002f10: 6174 696f 6e5f 646f 7473 286e 6f64 652c  ation_dots(node,
+00002f20: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
+00002f30: 2020 2020 2066 6f72 206e 2069 6e20 6c69       for n in li
+00002f40: 7374 2873 656c 662e 6f70 7328 7365 6c65  st(self.ops(sele
+00002f50: 6374 6564 3d54 7275 6529 293a 0d0a 2020  cted=True)):..  
+00002f60: 2020 2020 2020 2020 2020 6e65 775f 7365            new_se
+00002f70: 7474 696e 6773 203d 2064 6963 7428 6e2e  ttings = dict(n.
+00002f80: 7365 7474 696e 6773 290d 0a20 2020 2020  settings)..     
+00002f90: 2020 2020 2020 206e 6577 5f73 6574 7469         new_setti
+00002fa0: 6e67 735b 2274 7970 6522 5d20 3d20 226f  ngs["type"] = "o
+00002fb0: 7020 646f 7473 220d 0a20 2020 2020 2020  p dots"..       
+00002fc0: 2020 2020 206e 2e72 6570 6c61 6365 5f6e       n.replace_n
+00002fd0: 6f64 6528 6b65 6570 5f63 6869 6c64 7265  ode(keep_childre
+00002fe0: 6e3d 5472 7565 2c20 2a2a 6e65 775f 7365  n=True, **new_se
+00002ff0: 7474 696e 6773 290d 0a20 2020 2020 2020  ttings)..       
+00003000: 2073 656c 662e 7369 676e 616c 2822 7265   self.signal("re
+00003010: 6275 696c 645f 7472 6565 2229 0d0a 0d0a  build_tree")....
+00003020: 2020 2020 4074 7265 655f 7375 626d 656e      @tree_submen
+00003030: 7528 5f28 2252 6173 7465 7257 697a 6172  u(_("RasterWizar
+00003040: 6422 2929 0d0a 2020 2020 4074 7265 655f  d"))..    @tree_
+00003050: 6f70 6572 6174 696f 6e28 5f28 2253 6574  operation(_("Set
+00003060: 2074 6f20 4e6f 6e65 2229 2c20 6e6f 6465   to None"), node
+00003070: 5f74 7970 653d 2265 6c65 6d20 696d 6167  _type="elem imag
+00003080: 6522 2c20 6865 6c70 3d22 2229 0d0a 2020  e", help="")..  
+00003090: 2020 6465 6620 696d 6167 655f 7261 7374    def image_rast
+000030a0: 6572 7769 7a61 7264 5f61 7070 6c79 5f6e  erwizard_apply_n
+000030b0: 6f6e 6528 6e6f 6465 2c20 2a2a 6b77 6172  one(node, **kwar
+000030c0: 6773 293a 0d0a 2020 2020 2020 2020 6669  gs):..        fi
+000030d0: 7273 746e 6f64 6520 3d20 4e6f 6e65 0d0a  rstnode = None..
+000030e0: 2020 2020 2020 2020 666f 7220 6520 696e          for e in
+000030f0: 206c 6973 7428 7365 6c66 2e65 6c65 6d73   list(self.elems
+00003100: 2865 6d70 6861 7369 7a65 643d 5472 7565  (emphasized=True
+00003110: 2929 3a0d 0a20 2020 2020 2020 2020 2020  )):..           
+00003120: 2069 6620 652e 7479 7065 2021 3d20 2265   if e.type != "e
+00003130: 6c65 6d20 696d 6167 6522 3a0d 0a20 2020  lem image":..   
+00003140: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00003150: 7469 6e75 650d 0a20 2020 2020 2020 2020  tinue..         
+00003160: 2020 2065 2e6f 7065 7261 7469 6f6e 7320     e.operations 
+00003170: 3d20 5b5d 0d0a 2020 2020 2020 2020 2020  = []..          
+00003180: 2020 652e 7570 6461 7465 284e 6f6e 6529    e.update(None)
+00003190: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+000031a0: 2066 6972 7374 6e6f 6465 2069 7320 4e6f   firstnode is No
+000031b0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+000031c0: 2020 2020 2066 6972 7374 6e6f 6465 203d       firstnode =
+000031d0: 2065 0d0a 2020 2020 2020 2020 7365 6c66   e..        self
+000031e0: 2e73 6967 6e61 6c28 2272 6566 7265 7368  .signal("refresh
+000031f0: 5f73 6365 6e65 222c 2022 5363 656e 6522  _scene", "Scene"
+00003200: 290d 0a20 2020 2020 2020 2061 6374 6976  )..        activ
+00003210: 6174 6520 3d20 7365 6c66 2e6b 6572 6e65  ate = self.kerne
+00003220: 6c2e 6c6f 6f6b 7570 2822 6675 6e63 7469  l.lookup("functi
+00003230: 6f6e 2f6f 7065 6e5f 7072 6f70 6572 7479  on/open_property
+00003240: 5f77 696e 646f 775f 666f 725f 6e6f 6465  _window_for_node
+00003250: 2229 0d0a 2020 2020 2020 2020 6966 2061  ")..        if a
+00003260: 6374 6976 6174 6520 6973 206e 6f74 204e  ctivate is not N
+00003270: 6f6e 6520 616e 6420 6669 7273 746e 6f64  one and firstnod
+00003280: 6520 6973 206e 6f74 204e 6f6e 653a 0d0a  e is not None:..
+00003290: 2020 2020 2020 2020 2020 2020 6163 7469              acti
+000032a0: 7661 7465 2866 6972 7374 6e6f 6465 290d  vate(firstnode).
+000032b0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000032c0: 662e 7369 676e 616c 2822 7072 6f70 7570  f.signal("propup
+000032d0: 6461 7465 222c 2066 6972 7374 6e6f 6465  date", firstnode
+000032e0: 290d 0a0d 0a20 2020 2040 7472 6565 5f73  )....    @tree_s
+000032f0: 7562 6d65 6e75 285f 2822 5261 7374 6572  ubmenu(_("Raster
+00003300: 5769 7a61 7264 2229 290d 0a20 2020 2040  Wizard"))..    @
+00003310: 7472 6565 5f76 616c 7565 7328 2273 6372  tree_values("scr
+00003320: 6970 7422 2c20 7661 6c75 6573 3d6c 6973  ipt", values=lis
+00003330: 7428 7365 6c66 2e6d 6174 6368 2822 7261  t(self.match("ra
+00003340: 7374 6572 5f73 6372 6970 7422 2c20 7375  ster_script", su
+00003350: 6666 6978 3d54 7275 6529 2929 0d0a 2020  ffix=True)))..  
+00003360: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
+00003370: 6e28 5f28 2241 7070 6c79 3a20 7b73 6372  n(_("Apply: {scr
+00003380: 6970 747d 2229 2c20 6e6f 6465 5f74 7970  ipt}"), node_typ
+00003390: 653d 2265 6c65 6d20 696d 6167 6522 2c20  e="elem image", 
+000033a0: 6865 6c70 3d22 2229 0d0a 2020 2020 6465  help="")..    de
+000033b0: 6620 696d 6167 655f 7261 7374 6572 7769  f image_rasterwi
+000033c0: 7a61 7264 5f61 7070 6c79 286e 6f64 652c  zard_apply(node,
+000033d0: 2073 6372 6970 743d 4e6f 6e65 2c20 2a2a   script=None, **
+000033e0: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
+000033f0: 2020 7261 7374 6572 5f73 6372 6970 7420    raster_script 
+00003400: 3d20 7365 6c66 2e6c 6f6f 6b75 7028 6622  = self.lookup(f"
+00003410: 7261 7374 6572 5f73 6372 6970 742f 7b73  raster_script/{s
+00003420: 6372 6970 747d 2229 0d0a 2020 2020 2020  cript}")..      
+00003430: 2020 6669 7273 746e 6f64 6520 3d20 4e6f    firstnode = No
+00003440: 6e65 0d0a 2020 2020 2020 2020 666f 7220  ne..        for 
+00003450: 6520 696e 206c 6973 7428 7365 6c66 2e65  e in list(self.e
+00003460: 6c65 6d73 2865 6d70 6861 7369 7a65 643d  lems(emphasized=
+00003470: 5472 7565 2929 3a0d 0a20 2020 2020 2020  True)):..       
+00003480: 2020 2020 2069 6620 652e 7479 7065 2021       if e.type !
+00003490: 3d20 2265 6c65 6d20 696d 6167 6522 3a0d  = "elem image":.
+000034a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000034b0: 2063 6f6e 7469 6e75 650d 0a20 2020 2020   continue..     
+000034c0: 2020 2020 2020 2065 2e6f 7065 7261 7469         e.operati
+000034d0: 6f6e 7320 3d20 7261 7374 6572 5f73 6372  ons = raster_scr
+000034e0: 6970 740d 0a20 2020 2020 2020 2020 2020  ipt..           
+000034f0: 2065 2e75 7064 6174 6528 4e6f 6e65 290d   e.update(None).
+00003500: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00003510: 6669 7273 746e 6f64 6520 6973 204e 6f6e  firstnode is Non
+00003520: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00003530: 2020 2020 6669 7273 746e 6f64 6520 3d20      firstnode = 
+00003540: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
+00003550: 7369 676e 616c 2822 7265 6672 6573 685f  signal("refresh_
+00003560: 7363 656e 6522 2c20 2253 6365 6e65 2229  scene", "Scene")
+00003570: 0d0a 2020 2020 2020 2020 6163 7469 7661  ..        activa
+00003580: 7465 203d 2073 656c 662e 6b65 726e 656c  te = self.kernel
+00003590: 2e6c 6f6f 6b75 7028 2266 756e 6374 696f  .lookup("functio
+000035a0: 6e2f 6f70 656e 5f70 726f 7065 7274 795f  n/open_property_
+000035b0: 7769 6e64 6f77 5f66 6f72 5f6e 6f64 6522  window_for_node"
+000035c0: 290d 0a20 2020 2020 2020 2069 6620 6163  )..        if ac
+000035d0: 7469 7661 7465 2069 7320 6e6f 7420 4e6f  tivate is not No
+000035e0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+000035f0: 2061 6374 6976 6174 6528 6e6f 6465 290d   activate(node).
+00003600: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00003610: 662e 7369 676e 616c 2822 7072 6f70 7570  f.signal("propup
+00003620: 6461 7465 222c 206e 6f64 6529 0d0a 0d0a  date", node)....
+00003630: 2020 2020 6465 6620 7261 6469 6f5f 6d61      def radio_ma
+00003640: 7463 685f 7370 6565 6428 6e6f 6465 2c20  tch_speed(node, 
+00003650: 7370 6565 643d 302c 202a 2a6b 7761 7267  speed=0, **kwarg
+00003660: 7329 3a0d 0a20 2020 2020 2020 2072 6574  s):..        ret
+00003670: 7572 6e20 6e6f 6465 2e73 7065 6564 203d  urn node.speed =
+00003680: 3d20 666c 6f61 7428 7370 6565 6429 0d0a  = float(speed)..
+00003690: 0d0a 2020 2020 4074 7265 655f 7375 626d  ..    @tree_subm
+000036a0: 656e 7528 5f28 2253 7065 6564 2066 6f72  enu(_("Speed for
+000036b0: 2052 6173 7465 722d 4f70 6572 6174 696f   Raster-Operatio
+000036c0: 6e22 2929 0d0a 2020 2020 4074 7265 655f  n"))..    @tree_
+000036d0: 7261 6469 6f28 7261 6469 6f5f 6d61 7463  radio(radio_matc
+000036e0: 685f 7370 6565 6429 0d0a 2020 2020 4074  h_speed)..    @t
+000036f0: 7265 655f 7661 6c75 6573 2822 7370 6565  ree_values("spee
+00003700: 6422 2c20 2835 2c20 3130 2c20 3530 2c20  d", (5, 10, 50, 
+00003710: 3735 2c20 3130 302c 2031 3530 2c20 3230  75, 100, 150, 20
+00003720: 302c 2032 3530 2c20 3330 302c 2033 3530  0, 250, 300, 350
+00003730: 2c20 3430 302c 2034 3530 2c20 3530 3029  , 400, 450, 500)
+00003740: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
+00003750: 7261 7469 6f6e 285f 2822 7b73 7065 6564  ration(_("{speed
+00003760: 7d6d 6d2f 7322 292c 206e 6f64 655f 7479  }mm/s"), node_ty
+00003770: 7065 3d28 226f 7020 7261 7374 6572 222c  pe=("op raster",
+00003780: 2022 6f70 2069 6d61 6765 2229 2c20 6865   "op image"), he
+00003790: 6c70 3d22 2229 0d0a 2020 2020 6465 6620  lp="")..    def 
+000037a0: 7365 745f 7370 6565 645f 7261 7374 6572  set_speed_raster
+000037b0: 286e 6f64 652c 2073 7065 6564 3d31 3530  (node, speed=150
+000037c0: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+000037d0: 2020 2020 2020 6461 7461 203d 206c 6973        data = lis
+000037e0: 7428 290d 0a20 2020 2020 2020 2066 6f72  t()..        for
+000037f0: 206e 2069 6e20 6c69 7374 2873 656c 662e   n in list(self.
+00003800: 6f70 7328 7365 6c65 6374 6564 3d54 7275  ops(selected=Tru
+00003810: 6529 293a 0d0a 2020 2020 2020 2020 2020  e)):..          
+00003820: 2020 6966 206e 2e74 7970 6520 6e6f 7420    if n.type not 
+00003830: 696e 2028 226f 7020 7261 7374 6572 222c  in ("op raster",
+00003840: 2022 6f70 2069 6d61 6765 2229 3a0d 0a20   "op image"):.. 
+00003850: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00003860: 6f6e 7469 6e75 650d 0a20 2020 2020 2020  ontinue..       
+00003870: 2020 2020 206e 2e73 7065 6564 203d 2066       n.speed = f
+00003880: 6c6f 6174 2873 7065 6564 290d 0a20 2020  loat(speed)..   
+00003890: 2020 2020 2020 2020 2064 6174 612e 6170           data.ap
+000038a0: 7065 6e64 286e 290d 0a20 2020 2020 2020  pend(n)..       
+000038b0: 2073 656c 662e 7369 676e 616c 2822 656c   self.signal("el
+000038c0: 656d 656e 745f 7072 6f70 6572 7479 5f72  ement_property_r
+000038d0: 656c 6f61 6422 2c20 6461 7461 290d 0a0d  eload", data)...
+000038e0: 0a20 2020 2040 7472 6565 5f73 7562 6d65  .    @tree_subme
+000038f0: 6e75 285f 2822 5370 6565 6420 666f 7220  nu(_("Speed for 
+00003900: 5665 6374 6f72 2d4f 7065 7261 7469 6f6e  Vector-Operation
+00003910: 2229 290d 0a20 2020 2040 7472 6565 5f72  "))..    @tree_r
+00003920: 6164 696f 2872 6164 696f 5f6d 6174 6368  adio(radio_match
+00003930: 5f73 7065 6564 290d 0a20 2020 2040 7472  _speed)..    @tr
+00003940: 6565 5f76 616c 7565 7328 2273 7065 6564  ee_values("speed
+00003950: 222c 2028 322c 2033 2c20 342c 2035 2c20  ", (2, 3, 4, 5, 
+00003960: 362c 2037 2c20 3130 2c20 3135 2c20 3230  6, 7, 10, 15, 20
+00003970: 2c20 3235 2c20 3330 2c20 3335 2c20 3430  , 25, 30, 35, 40
+00003980: 2c20 3530 2929 0d0a 2020 2020 4074 7265  , 50))..    @tre
+00003990: 655f 6f70 6572 6174 696f 6e28 0d0a 2020  e_operation(..  
+000039a0: 2020 2020 2020 5f28 227b 7370 6565 647d        _("{speed}
+000039b0: 6d6d 2f73 2229 2c0d 0a20 2020 2020 2020  mm/s"),..       
+000039c0: 206e 6f64 655f 7479 7065 3d28 226f 7020   node_type=("op 
+000039d0: 6375 7422 2c20 226f 7020 656e 6772 6176  cut", "op engrav
+000039e0: 6522 2c20 226f 7020 6861 7463 6822 292c  e", "op hatch"),
+000039f0: 0d0a 2020 2020 2020 2020 6865 6c70 3d22  ..        help="
+00003a00: 222c 0d0a 2020 2020 290d 0a20 2020 2064  ",..    )..    d
+00003a10: 6566 2073 6574 5f73 7065 6564 5f76 6563  ef set_speed_vec
+00003a20: 746f 725f 6375 7428 6e6f 6465 2c20 7370  tor_cut(node, sp
+00003a30: 6565 643d 3230 2c20 2a2a 6b77 6172 6773  eed=20, **kwargs
+00003a40: 293a 0d0a 2020 2020 2020 2020 6461 7461  ):..        data
+00003a50: 203d 206c 6973 7428 290d 0a20 2020 2020   = list()..     
+00003a60: 2020 2066 6f72 206e 2069 6e20 6c69 7374     for n in list
+00003a70: 2873 656c 662e 6f70 7328 7365 6c65 6374  (self.ops(select
+00003a80: 6564 3d54 7275 6529 293a 0d0a 2020 2020  ed=True)):..    
+00003a90: 2020 2020 2020 2020 6966 206e 2e74 7970          if n.typ
+00003aa0: 6520 6e6f 7420 696e 2028 226f 7020 6375  e not in ("op cu
+00003ab0: 7422 2c20 226f 7020 656e 6772 6176 6522  t", "op engrave"
+00003ac0: 2c20 226f 7020 6861 7463 6822 293a 0d0a  , "op hatch"):..
+00003ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003ae0: 636f 6e74 696e 7565 0d0a 2020 2020 2020  continue..      
+00003af0: 2020 2020 2020 6e2e 7370 6565 6420 3d20        n.speed = 
+00003b00: 666c 6f61 7428 7370 6565 6429 0d0a 2020  float(speed)..  
+00003b10: 2020 2020 2020 2020 2020 6461 7461 2e61            data.a
+00003b20: 7070 656e 6428 6e29 0d0a 2020 2020 2020  ppend(n)..      
+00003b30: 2020 7365 6c66 2e73 6967 6e61 6c28 2265    self.signal("e
+00003b40: 6c65 6d65 6e74 5f70 726f 7065 7274 795f  lement_property_
+00003b50: 7265 6c6f 6164 222c 2064 6174 6129 0d0a  reload", data)..
+00003b60: 0d0a 2020 2020 6465 6620 7261 6469 6f5f  ..    def radio_
+00003b70: 6d61 7463 685f 706f 7765 7228 6e6f 6465  match_power(node
+00003b80: 2c20 706f 7765 723d 302c 202a 2a6b 7761  , power=0, **kwa
+00003b90: 7267 7329 3a0d 0a20 2020 2020 2020 2072  rgs):..        r
+00003ba0: 6574 7572 6e20 6e6f 6465 2e70 6f77 6572  eturn node.power
+00003bb0: 203d 3d20 666c 6f61 7428 706f 7765 7229   == float(power)
+00003bc0: 0d0a 0d0a 2020 2020 4074 7265 655f 7375  ....    @tree_su
+00003bd0: 626d 656e 7528 5f28 2250 6f77 6572 2229  bmenu(_("Power")
+00003be0: 290d 0a20 2020 2040 7472 6565 5f72 6164  )..    @tree_rad
+00003bf0: 696f 2872 6164 696f 5f6d 6174 6368 5f70  io(radio_match_p
+00003c00: 6f77 6572 290d 0a20 2020 2040 7472 6565  ower)..    @tree
+00003c10: 5f76 616c 7565 7328 2270 6f77 6572 222c  _values("power",
+00003c20: 2028 3130 302c 2032 3530 2c20 3333 332c   (100, 250, 333,
+00003c30: 2035 3030 2c20 3636 372c 2037 3530 2c20   500, 667, 750, 
+00003c40: 3130 3030 2929 0d0a 2020 2020 4074 7265  1000))..    @tre
+00003c50: 655f 6361 6c63 2822 706f 7765 725f 3130  e_calc("power_10
+00003c60: 222c 206c 616d 6264 6120 693a 2072 6f75  ", lambda i: rou
+00003c70: 6e64 2869 202f 2031 302c 2031 2929 0d0a  nd(i / 10, 1))..
+00003c80: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
+00003c90: 696f 6e28 0d0a 2020 2020 2020 2020 5f28  ion(..        _(
+00003ca0: 227b 706f 7765 727d 7070 6920 287b 706f  "{power}ppi ({po
+00003cb0: 7765 725f 3130 7d25 2922 292c 0d0a 2020  wer_10}%)"),..  
+00003cc0: 2020 2020 2020 6e6f 6465 5f74 7970 653d        node_type=
+00003cd0: 2822 6f70 2063 7574 222c 2022 6f70 2072  ("op cut", "op r
+00003ce0: 6173 7465 7222 2c20 226f 7020 696d 6167  aster", "op imag
+00003cf0: 6522 2c20 226f 7020 656e 6772 6176 6522  e", "op engrave"
+00003d00: 2c20 226f 7020 6861 7463 6822 292c 0d0a  , "op hatch"),..
+00003d10: 2020 2020 2020 2020 6865 6c70 3d22 222c          help="",
+00003d20: 0d0a 2020 2020 290d 0a20 2020 2064 6566  ..    )..    def
+00003d30: 2073 6574 5f70 6f77 6572 286e 6f64 652c   set_power(node,
+00003d40: 2070 6f77 6572 3d31 3030 302c 202a 2a6b   power=1000, **k
+00003d50: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
+00003d60: 2064 6174 6120 3d20 6c69 7374 2829 0d0a   data = list()..
+00003d70: 2020 2020 2020 2020 666f 7220 6e20 696e          for n in
+00003d80: 206c 6973 7428 7365 6c66 2e6f 7073 2873   list(self.ops(s
+00003d90: 656c 6563 7465 643d 5472 7565 2929 3a0d  elected=True)):.
+00003da0: 0a20 2020 2020 2020 2020 2020 206e 2e70  .            n.p
+00003db0: 6f77 6572 203d 2066 6c6f 6174 2870 6f77  ower = float(pow
+00003dc0: 6572 290d 0a20 2020 2020 2020 2020 2020  er)..           
+00003dd0: 2064 6174 612e 6170 7065 6e64 286e 290d   data.append(n).
+00003de0: 0a20 2020 2020 2020 2073 656c 662e 7369  .        self.si
+00003df0: 676e 616c 2822 656c 656d 656e 745f 7072  gnal("element_pr
+00003e00: 6f70 6572 7479 5f72 656c 6f61 6422 2c20  operty_reload", 
+00003e10: 6461 7461 290d 0a0d 0a20 2020 2064 6566  data)....    def
+00003e20: 2072 6164 696f 5f6d 6174 6368 286e 6f64   radio_match(nod
+00003e30: 652c 2064 7069 3d31 3030 2c20 2a2a 6b77  e, dpi=100, **kw
+00003e40: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
+00003e50: 7265 7475 726e 206e 6f64 652e 6470 6920  return node.dpi 
+00003e60: 3d3d 2064 7069 0d0a 0d0a 2020 2020 4074  == dpi....    @t
+00003e70: 7265 655f 7375 626d 656e 7528 5f28 2244  ree_submenu(_("D
+00003e80: 5049 2229 290d 0a20 2020 2040 7472 6565  PI"))..    @tree
+00003e90: 5f72 6164 696f 2872 6164 696f 5f6d 6174  _radio(radio_mat
+00003ea0: 6368 290d 0a20 2020 2040 7472 6565 5f76  ch)..    @tree_v
+00003eb0: 616c 7565 7328 2264 7069 222c 2028 3130  alues("dpi", (10
+00003ec0: 302c 2032 3530 2c20 3333 332c 2035 3030  0, 250, 333, 500
+00003ed0: 2c20 3636 372c 2037 3530 2c20 3130 3030  , 667, 750, 1000
+00003ee0: 2929 0d0a 2020 2020 4074 7265 655f 6f70  ))..    @tree_op
+00003ef0: 6572 6174 696f 6e28 0d0a 2020 2020 2020  eration(..      
+00003f00: 2020 5f28 2244 5049 207b 6470 697d 2229    _("DPI {dpi}")
+00003f10: 2c0d 0a20 2020 2020 2020 206e 6f64 655f  ,..        node_
+00003f20: 7479 7065 3d28 226f 7020 7261 7374 6572  type=("op raster
+00003f30: 222c 2022 656c 656d 2069 6d61 6765 2229  ", "elem image")
+00003f40: 2c0d 0a20 2020 2020 2020 2068 656c 703d  ,..        help=
+00003f50: 5f28 2243 6861 6e67 6520 6470 6920 7661  _("Change dpi va
+00003f60: 6c75 6573 2229 2c0d 0a20 2020 2029 0d0a  lues"),..    )..
+00003f70: 2020 2020 6465 6620 7365 745f 7374 6570      def set_step
+00003f80: 5f6e 286e 6f64 652c 2064 7069 3d31 2c20  _n(node, dpi=1, 
+00003f90: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
+00003fa0: 2020 2020 6461 7461 203d 206c 6973 7428      data = list(
+00003fb0: 290d 0a20 2020 2020 2020 2066 6f72 206e  )..        for n
+00003fc0: 2069 6e20 6c69 7374 2873 656c 662e 6f70   in list(self.op
+00003fd0: 7328 7365 6c65 6374 6564 3d54 7275 6529  s(selected=True)
+00003fe0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00003ff0: 6e2e 6470 6920 3d20 6470 690d 0a20 2020  n.dpi = dpi..   
+00004000: 2020 2020 2020 2020 2064 6174 612e 6170           data.ap
+00004010: 7065 6e64 286e 290d 0a20 2020 2020 2020  pend(n)..       
+00004020: 2066 6f72 206e 2069 6e20 6c69 7374 2873   for n in list(s
+00004030: 656c 662e 656c 656d 7328 656d 7068 6173  elf.elems(emphas
+00004040: 697a 6564 3d54 7275 6529 293a 0d0a 2020  ized=True)):..  
+00004050: 2020 2020 2020 2020 2020 6966 206e 2e74            if n.t
+00004060: 7970 6520 3d3d 2022 656c 656d 2069 6d61  ype == "elem ima
+00004070: 6765 223a 0d0a 2020 2020 2020 2020 2020  ge":..          
+00004080: 2020 2020 2020 6e2e 6470 6920 3d20 6470        n.dpi = dp
+00004090: 690d 0a20 2020 2020 2020 2020 2020 2020  i..             
+000040a0: 2020 206e 2e75 7064 6174 6528 4e6f 6e65     n.update(None
+000040b0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000040c0: 2020 2064 6174 612e 6170 7065 6e64 286e     data.append(n
+000040d0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+000040e0: 7369 676e 616c 2822 7265 6672 6573 685f  signal("refresh_
+000040f0: 7363 656e 6522 2c20 2253 6365 6e65 2229  scene", "Scene")
+00004100: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+00004110: 6967 6e61 6c28 2265 6c65 6d65 6e74 5f70  ignal("element_p
+00004120: 726f 7065 7274 795f 7265 6c6f 6164 222c  roperty_reload",
+00004130: 2064 6174 6129 0d0a 0d0a 2020 2020 6465   data)....    de
+00004140: 6620 7261 6469 6f5f 6d61 7463 685f 7061  f radio_match_pa
+00004150: 7373 6573 286e 6f64 652c 2070 6173 7376  sses(node, passv
+00004160: 616c 7565 3d31 2c20 2a2a 6b77 6172 6773  alue=1, **kwargs
+00004170: 293a 0d0a 2020 2020 2020 2020 7265 7475  ):..        retu
+00004180: 726e 2028 6e6f 6465 2e70 6173 7365 735f  rn (node.passes_
+00004190: 6375 7374 6f6d 2061 6e64 2070 6173 7376  custom and passv
+000041a0: 616c 7565 203d 3d20 6e6f 6465 2e70 6173  alue == node.pas
+000041b0: 7365 7329 206f 7220 280d 0a20 2020 2020  ses) or (..     
+000041c0: 2020 2020 2020 206e 6f74 206e 6f64 652e         not node.
+000041d0: 7061 7373 6573 5f63 7573 746f 6d20 616e  passes_custom an
+000041e0: 6420 7061 7373 7661 6c75 6520 3d3d 2031  d passvalue == 1
+000041f0: 0d0a 2020 2020 2020 2020 290d 0a0d 0a20  ..        ).... 
+00004200: 2020 2040 7472 6565 5f73 7562 6d65 6e75     @tree_submenu
+00004210: 285f 2822 5365 7420 6f70 6572 6174 696f  (_("Set operatio
+00004220: 6e20 7061 7373 6573 2229 290d 0a20 2020  n passes"))..   
+00004230: 2040 7472 6565 5f72 6164 696f 2872 6164   @tree_radio(rad
+00004240: 696f 5f6d 6174 6368 5f70 6173 7365 7329  io_match_passes)
+00004250: 0d0a 2020 2020 4074 7265 655f 6974 6572  ..    @tree_iter
+00004260: 6174 6528 2270 6173 7376 616c 7565 222c  ate("passvalue",
+00004270: 2031 2c20 3130 290d 0a20 2020 2040 7472   1, 10)..    @tr
+00004280: 6565 5f6f 7065 7261 7469 6f6e 285f 2822  ee_operation(_("
+00004290: 5061 7373 6573 207b 7061 7373 7661 6c75  Passes {passvalu
+000042a0: 657d 2229 2c20 6e6f 6465 5f74 7970 653d  e}"), node_type=
+000042b0: 6f70 5f70 6172 656e 745f 6e6f 6465 732c  op_parent_nodes,
+000042c0: 2068 656c 703d 2222 290d 0a20 2020 2064   help="")..    d
+000042d0: 6566 2073 6574 5f6e 5f70 6173 7365 7328  ef set_n_passes(
+000042e0: 6e6f 6465 2c20 7061 7373 7661 6c75 653d  node, passvalue=
+000042f0: 312c 202a 2a6b 7761 7267 7329 3a0d 0a20  1, **kwargs):.. 
+00004300: 2020 2020 2020 2064 6174 6120 3d20 6c69         data = li
+00004310: 7374 2829 0d0a 2020 2020 2020 2020 666f  st()..        fo
+00004320: 7220 6e20 696e 206c 6973 7428 7365 6c66  r n in list(self
+00004330: 2e6f 7073 2873 656c 6563 7465 643d 5472  .ops(selected=Tr
+00004340: 7565 2929 3a0d 0a20 2020 2020 2020 2020  ue)):..         
+00004350: 2020 206e 2e70 6173 7365 7320 3d20 7061     n.passes = pa
+00004360: 7373 7661 6c75 650d 0a20 2020 2020 2020  ssvalue..       
+00004370: 2020 2020 206e 2e70 6173 7365 735f 6375       n.passes_cu
+00004380: 7374 6f6d 203d 2070 6173 7376 616c 7565  stom = passvalue
+00004390: 2021 3d20 310d 0a20 2020 2020 2020 2020   != 1..         
+000043a0: 2020 2064 6174 612e 6170 7065 6e64 286e     data.append(n
+000043b0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+000043c0: 7369 676e 616c 2822 656c 656d 656e 745f  signal("element_
+000043d0: 7072 6f70 6572 7479 5f72 656c 6f61 6422  property_reload"
+000043e0: 2c20 6461 7461 290d 0a0d 0a20 2020 2023  , data)....    #
+000043f0: 202d 2d2d 2d20 4275 726e 2044 6972 6563   ---- Burn Direc
+00004400: 7469 6f6e 0d0a 2020 2020 6465 6620 6765  tion..    def ge
+00004410: 745f 6469 7265 6374 696f 6e5f 7661 6c75  t_direction_valu
+00004420: 6573 2829 3a0d 0a20 2020 2020 2020 2072  es():..        r
+00004430: 6574 7572 6e20 280d 0a20 2020 2020 2020  eturn (..       
+00004440: 2020 2020 2022 546f 7020 546f 2042 6f74       "Top To Bot
+00004450: 746f 6d22 2c0d 0a20 2020 2020 2020 2020  tom",..         
+00004460: 2020 2022 426f 7474 6f6d 2054 6f20 546f     "Bottom To To
+00004470: 7022 2c0d 0a20 2020 2020 2020 2020 2020  p",..           
+00004480: 2022 5269 6768 7420 546f 204c 6566 7422   "Right To Left"
+00004490: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
+000044a0: 4c65 6674 2054 6f20 5269 6768 7422 2c0d  Left To Right",.
+000044b0: 0a20 2020 2020 2020 2020 2020 2022 4372  .            "Cr
+000044c0: 6f73 7368 6174 6368 222c 0d0a 2020 2020  osshatch",..    
+000044d0: 2020 2020 290d 0a0d 0a20 2020 2064 6566      )....    def
+000044e0: 2072 6164 696f 5f6d 6174 6368 5f64 6972   radio_match_dir
+000044f0: 6563 7469 6f6e 286e 6f64 652c 2072 6173  ection(node, ras
+00004500: 7465 725f 6469 7265 6374 696f 6e3d 2222  ter_direction=""
+00004510: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+00004520: 2020 2020 2020 7661 6c75 6573 203d 2067        values = g
+00004530: 6574 5f64 6972 6563 7469 6f6e 5f76 616c  et_direction_val
+00004540: 7565 7328 290d 0a20 2020 2020 2020 2066  ues()..        f
+00004550: 6f72 2069 6478 2c20 6b65 7920 696e 2065  or idx, key in e
+00004560: 6e75 6d65 7261 7465 2876 616c 7565 7329  numerate(values)
+00004570: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+00004580: 6620 6b65 7920 3d3d 2072 6173 7465 725f  f key == raster_
+00004590: 6469 7265 6374 696f 6e3a 0d0a 2020 2020  direction:..    
+000045a0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000045b0: 726e 206e 6f64 652e 7261 7374 6572 5f64  rn node.raster_d
+000045c0: 6972 6563 7469 6f6e 203d 3d20 6964 780d  irection == idx.
+000045d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000045e0: 4661 6c73 650d 0a0d 0a20 2020 2040 7472  False....    @tr
+000045f0: 6565 5f73 7562 6d65 6e75 285f 2822 4275  ee_submenu(_("Bu
+00004600: 726e 2044 6972 6563 7469 6f6e 2229 290d  rn Direction")).
+00004610: 0a20 2020 2040 7472 6565 5f72 6164 696f  .    @tree_radio
+00004620: 2872 6164 696f 5f6d 6174 6368 5f64 6972  (radio_match_dir
+00004630: 6563 7469 6f6e 290d 0a20 2020 2040 7472  ection)..    @tr
+00004640: 6565 5f76 616c 7565 7328 2272 6173 7465  ee_values("raste
+00004650: 725f 6469 7265 6374 696f 6e22 2c20 7661  r_direction", va
+00004660: 6c75 6573 3d67 6574 5f64 6972 6563 7469  lues=get_directi
+00004670: 6f6e 5f76 616c 7565 7328 2929 0d0a 2020  on_values())..  
+00004680: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
+00004690: 6e28 0d0a 2020 2020 2020 2020 227b 7261  n(..        "{ra
+000046a0: 7374 6572 5f64 6972 6563 7469 6f6e 7d22  ster_direction}"
+000046b0: 2c0d 0a20 2020 2020 2020 206e 6f64 655f  ,..        node_
+000046c0: 7479 7065 3d28 226f 7020 7261 7374 6572  type=("op raster
+000046d0: 222c 2022 6f70 2069 6d61 6765 2229 2c0d  ", "op image"),.
+000046e0: 0a20 2020 2020 2020 2068 656c 703d 2222  .        help=""
+000046f0: 2c0d 0a20 2020 2029 0d0a 2020 2020 6465  ,..    )..    de
+00004700: 6620 7365 745f 6469 7265 6374 696f 6e28  f set_direction(
+00004710: 6e6f 6465 2c20 7261 7374 6572 5f64 6972  node, raster_dir
+00004720: 6563 7469 6f6e 3d22 222c 202a 2a6b 7761  ection="", **kwa
+00004730: 7267 7329 3a0d 0a20 2020 2020 2020 2076  rgs):..        v
+00004740: 616c 7565 7320 3d20 6765 745f 6469 7265  alues = get_dire
+00004750: 6374 696f 6e5f 7661 6c75 6573 2829 0d0a  ction_values()..
+00004760: 2020 2020 2020 2020 666f 7220 6964 782c          for idx,
+00004770: 206b 6579 2069 6e20 656e 756d 6572 6174   key in enumerat
+00004780: 6528 7661 6c75 6573 293a 0d0a 2020 2020  e(values):..    
+00004790: 2020 2020 2020 2020 6966 206b 6579 203d          if key =
+000047a0: 3d20 7261 7374 6572 5f64 6972 6563 7469  = raster_directi
+000047b0: 6f6e 3a0d 0a20 2020 2020 2020 2020 2020  on:..           
+000047c0: 2020 2020 2064 6174 6120 3d20 6c69 7374       data = list
+000047d0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+000047e0: 2020 2020 666f 7220 6e20 696e 206c 6973      for n in lis
+000047f0: 7428 7365 6c66 2e6f 7073 2873 656c 6563  t(self.ops(selec
+00004800: 7465 643d 5472 7565 2929 3a0d 0a20 2020  ted=True)):..   
+00004810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004820: 2069 6620 6e2e 7479 7065 206e 6f74 2069   if n.type not i
+00004830: 6e20 2822 6f70 2072 6173 7465 7222 2c20  n ("op raster", 
+00004840: 226f 7020 696d 6167 6522 293a 0d0a 2020  "op image"):..  
+00004850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004860: 2020 2020 2020 636f 6e74 696e 7565 0d0a        continue..
+00004870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004880: 2020 2020 6e2e 7261 7374 6572 5f64 6972      n.raster_dir
+00004890: 6563 7469 6f6e 203d 2069 6478 0d0a 2020  ection = idx..  
+000048a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000048b0: 2020 6461 7461 2e61 7070 656e 6428 6e29    data.append(n)
+000048c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000048d0: 2020 7365 6c66 2e73 6967 6e61 6c28 2265    self.signal("e
+000048e0: 6c65 6d65 6e74 5f70 726f 7065 7274 795f  lement_property_
+000048f0: 7265 6c6f 6164 222c 2064 6174 6129 0d0a  reload", data)..
+00004900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004910: 6272 6561 6b0d 0a0d 0a20 2020 2064 6566  break....    def
+00004920: 2067 6574 5f73 7769 6e67 5f76 616c 7565   get_swing_value
+00004930: 7328 293a 0d0a 2020 2020 2020 2020 7265  s():..        re
+00004940: 7475 726e 2028 0d0a 2020 2020 2020 2020  turn (..        
+00004950: 2020 2020 5f28 2255 6e69 6469 7265 6374      _("Unidirect
+00004960: 696f 6e61 6c22 292c 0d0a 2020 2020 2020  ional"),..      
+00004970: 2020 2020 2020 5f28 2242 6964 6972 6563        _("Bidirec
+00004980: 7469 6f6e 616c 2229 2c0d 0a20 2020 2020  tional"),..     
+00004990: 2020 2029 0d0a 0d0a 2020 2020 6465 6620     )....    def 
+000049a0: 7261 6469 6f5f 6d61 7463 685f 7377 696e  radio_match_swin
+000049b0: 6728 6e6f 6465 2c20 7261 7374 6572 5f73  g(node, raster_s
+000049c0: 7769 6e67 3d22 222c 202a 2a6b 7761 7267  wing="", **kwarg
+000049d0: 7329 3a0d 0a20 2020 2020 2020 2076 616c  s):..        val
+000049e0: 7565 7320 3d20 6765 745f 7377 696e 675f  ues = get_swing_
+000049f0: 7661 6c75 6573 2829 0d0a 2020 2020 2020  values()..      
+00004a00: 2020 666f 7220 6964 782c 206b 6579 2069    for idx, key i
+00004a10: 6e20 656e 756d 6572 6174 6528 7661 6c75  n enumerate(valu
+00004a20: 6573 293a 0d0a 2020 2020 2020 2020 2020  es):..          
+00004a30: 2020 6966 206b 6579 203d 3d20 7261 7374    if key == rast
+00004a40: 6572 5f73 7769 6e67 3a0d 0a20 2020 2020  er_swing:..     
+00004a50: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00004a60: 6e20 6e6f 6465 2e62 6964 6972 6563 7469  n node.bidirecti
+00004a70: 6f6e 616c 203d 3d20 6964 780d 0a20 2020  onal == idx..   
+00004a80: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00004a90: 650d 0a0d 0a20 2020 2040 7472 6565 5f73  e....    @tree_s
+00004aa0: 7562 6d65 6e75 285f 2822 4469 7265 6374  ubmenu(_("Direct
+00004ab0: 696f 6e61 6c20 5261 7374 6572 2229 290d  ional Raster")).
+00004ac0: 0a20 2020 2040 7472 6565 5f72 6164 696f  .    @tree_radio
+00004ad0: 2872 6164 696f 5f6d 6174 6368 5f73 7769  (radio_match_swi
+00004ae0: 6e67 290d 0a20 2020 2040 7472 6565 5f76  ng)..    @tree_v
+00004af0: 616c 7565 7328 2272 6173 7465 725f 7377  alues("raster_sw
+00004b00: 696e 6722 2c20 7661 6c75 6573 3d67 6574  ing", values=get
+00004b10: 5f73 7769 6e67 5f76 616c 7565 7328 2929  _swing_values())
+00004b20: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
+00004b30: 6174 696f 6e28 0d0a 2020 2020 2020 2020  ation(..        
+00004b40: 227b 7261 7374 6572 5f73 7769 6e67 7d22  "{raster_swing}"
+00004b50: 2c0d 0a20 2020 2020 2020 206e 6f64 655f  ,..        node_
+00004b60: 7479 7065 3d28 226f 7020 7261 7374 6572  type=("op raster
+00004b70: 222c 2022 6f70 2069 6d61 6765 2229 2c0d  ", "op image"),.
+00004b80: 0a20 2020 2020 2020 2068 656c 703d 2222  .        help=""
+00004b90: 2c0d 0a20 2020 2029 0d0a 2020 2020 6465  ,..    )..    de
+00004ba0: 6620 7365 745f 7377 696e 6728 6e6f 6465  f set_swing(node
+00004bb0: 2c20 7261 7374 6572 5f73 7769 6e67 3d22  , raster_swing="
+00004bc0: 222c 202a 2a6b 7761 7267 7329 3a0d 0a20  ", **kwargs):.. 
+00004bd0: 2020 2020 2020 2076 616c 7565 7320 3d20         values = 
+00004be0: 6765 745f 7377 696e 675f 7661 6c75 6573  get_swing_values
+00004bf0: 2829 0d0a 2020 2020 2020 2020 666f 7220  ()..        for 
+00004c00: 6964 782c 206b 6579 2069 6e20 656e 756d  idx, key in enum
+00004c10: 6572 6174 6528 7661 6c75 6573 293a 0d0a  erate(values):..
+00004c20: 2020 2020 2020 2020 2020 2020 6966 206b              if k
+00004c30: 6579 203d 3d20 7261 7374 6572 5f73 7769  ey == raster_swi
+00004c40: 6e67 3a0d 0a20 2020 2020 2020 2020 2020  ng:..           
+00004c50: 2020 2020 2064 6174 6120 3d20 6c69 7374       data = list
+00004c60: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00004c70: 2020 2020 666f 7220 6e20 696e 206c 6973      for n in lis
+00004c80: 7428 7365 6c66 2e6f 7073 2873 656c 6563  t(self.ops(selec
+00004c90: 7465 643d 5472 7565 2929 3a0d 0a20 2020  ted=True)):..   
+00004ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004cb0: 2069 6620 6e2e 7479 7065 206e 6f74 2069   if n.type not i
+00004cc0: 6e20 2822 6f70 2072 6173 7465 7222 2c20  n ("op raster", 
+00004cd0: 226f 7020 696d 6167 6522 293a 0d0a 2020  "op image"):..  
+00004ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004cf0: 2020 2020 2020 636f 6e74 696e 7565 0d0a        continue..
+00004d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004d10: 2020 2020 6e2e 6269 6469 7265 6374 696f      n.bidirectio
+00004d20: 6e61 6c20 3d20 626f 6f6c 2869 6478 290d  nal = bool(idx).
+00004d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004d40: 2020 2020 2064 6174 612e 6170 7065 6e64       data.append
+00004d50: 286e 290d 0a20 2020 2020 2020 2020 2020  (n)..           
+00004d60: 2020 2020 2073 656c 662e 7369 676e 616c       self.signal
+00004d70: 2822 656c 656d 656e 745f 7072 6f70 6572  ("element_proper
+00004d80: 7479 5f72 656c 6f61 6422 2c20 6461 7461  ty_reload", data
+00004d90: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00004da0: 2020 2062 7265 616b 0d0a 0d0a 2020 2020     break....    
+00004db0: 4074 7265 655f 7365 7061 7261 746f 725f  @tree_separator_
+00004dc0: 6265 666f 7265 2829 0d0a 2020 2020 4074  before()..    @t
+00004dd0: 7265 655f 6f70 6572 6174 696f 6e28 0d0a  ree_operation(..
+00004de0: 2020 2020 2020 2020 5f28 2245 7865 6375          _("Execu
+00004df0: 7465 206f 7065 7261 7469 6f6e 2873 2922  te operation(s)"
+00004e00: 292c 0d0a 2020 2020 2020 2020 6e6f 6465  ),..        node
+00004e10: 5f74 7970 653d 6f70 5f6e 6f64 6573 2c0d  _type=op_nodes,.
+00004e20: 0a20 2020 2020 2020 2068 656c 703d 5f28  .        help=_(
+00004e30: 2245 7865 6375 7465 204a 6f62 2066 6f72  "Execute Job for
+00004e40: 2074 6865 2073 656c 6563 7465 6420 6f70   the selected op
+00004e50: 6572 6174 696f 6e28 7329 2e22 292c 0d0a  eration(s)."),..
+00004e60: 2020 2020 290d 0a20 2020 2064 6566 2065      )..    def e
+00004e70: 7865 6375 7465 5f6a 6f62 286e 6f64 652c  xecute_job(node,
+00004e80: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
+00004e90: 2020 2020 2073 656c 662e 7365 745f 6e6f       self.set_no
+00004ea0: 6465 5f65 6d70 6861 7369 7328 6e6f 6465  de_emphasis(node
+00004eb0: 2c20 5472 7565 290d 0a20 2020 2020 2020  , True)..       
+00004ec0: 2073 656c 6628 2270 6c61 6e30 2063 6c65   self("plan0 cle
+00004ed0: 6172 2063 6f70 792d 7365 6c65 6374 6564  ar copy-selected
+00004ee0: 5c6e 2229 0d0a 2020 2020 2020 2020 7365  \n")..        se
+00004ef0: 6c66 2822 7769 6e64 6f77 206f 7065 6e20  lf("window open 
+00004f00: 4578 6563 7574 654a 6f62 2030 5c6e 2229  ExecuteJob 0\n")
+00004f10: 0d0a 0d0a 2020 2020 4074 7265 655f 7365  ....    @tree_se
+00004f20: 7061 7261 746f 725f 6166 7465 7228 290d  parator_after().
+00004f30: 0a20 2020 2040 7472 6565 5f6f 7065 7261  .    @tree_opera
+00004f40: 7469 6f6e 280d 0a20 2020 2020 2020 205f  tion(..        _
+00004f50: 2822 5369 6d75 6c61 7465 206f 7065 7261  ("Simulate opera
+00004f60: 7469 6f6e 2873 2922 292c 0d0a 2020 2020  tion(s)"),..    
+00004f70: 2020 2020 6e6f 6465 5f74 7970 653d 6f70      node_type=op
+00004f80: 5f6e 6f64 6573 2c0d 0a20 2020 2020 2020  _nodes,..       
+00004f90: 2068 656c 703d 5f28 2252 756e 2073 696d   help=_("Run sim
+00004fa0: 756c 6174 696f 6e20 666f 7220 7468 6520  ulation for the 
+00004fb0: 7365 6c65 6374 6564 206f 7065 7261 7469  selected operati
+00004fc0: 6f6e 2873 2922 292c 0d0a 2020 2020 290d  on(s)"),..    ).
+00004fd0: 0a20 2020 2064 6566 2063 6f6d 7069 6c65  .    def compile
+00004fe0: 5f61 6e64 5f73 696d 756c 6174 6528 6e6f  _and_simulate(no
+00004ff0: 6465 2c20 2a2a 6b77 6172 6773 293a 0d0a  de, **kwargs):..
+00005000: 2020 2020 2020 2020 7365 6c66 2e73 6574          self.set
+00005010: 5f6e 6f64 655f 656d 7068 6173 6973 286e  _node_emphasis(n
+00005020: 6f64 652c 2054 7275 6529 0d0a 2020 2020  ode, True)..    
+00005030: 2020 2020 7365 6c66 2822 706c 616e 3020      self("plan0 
+00005040: 636f 7079 2d73 656c 6563 7465 6420 7072  copy-selected pr
+00005050: 6570 726f 6365 7373 2076 616c 6964 6174  eprocess validat
+00005060: 6520 626c 6f62 2070 7265 6f70 7420 6f70  e blob preopt op
+00005070: 7469 6d69 7a65 5c6e 2229 0d0a 2020 2020  timize\n")..    
+00005080: 2020 2020 7365 6c66 2822 7769 6e64 6f77      self("window
+00005090: 206f 7065 6e20 5369 6d75 6c61 7469 6f6e   open Simulation
+000050a0: 2030 2031 2031 5c6e 2229 2020 2320 506c   0 1 1\n")  # Pl
+000050b0: 616e 204e 616d 652c 2041 7574 6f2d 436c  an Name, Auto-Cl
+000050c0: 6561 722c 204f 7074 696d 6973 650d 0a0d  ear, Optimise...
+000050d0: 0a20 2020 2023 203d 3d3d 3d3d 3d3d 3d3d  .    # =========
+000050e0: 3d0d 0a20 2020 2023 2047 656e 6572 616c  =..    # General
+000050f0: 206d 656e 752d 656e 7472 6965 7320 666f   menu-entries fo
+00005100: 7220 6f70 6572 6174 696f 6e20 6272 616e  r operation bran
+00005110: 6368 0d0a 2020 2020 2320 3d3d 3d3d 3d3d  ch..    # ======
+00005120: 3d3d 3d3d 0d0a 0d0a 2020 2020 4074 7265  ====....    @tre
+00005130: 655f 6f70 6572 6174 696f 6e28 5f28 2247  e_operation(_("G
+00005140: 6c6f 6261 6c20 5365 7474 696e 6773 2229  lobal Settings")
+00005150: 2c20 6e6f 6465 5f74 7970 653d 2262 7261  , node_type="bra
+00005160: 6e63 6820 6f70 7322 2c20 6865 6c70 3d22  nch ops", help="
+00005170: 2229 0d0a 2020 2020 6465 6620 6f70 5f70  ")..    def op_p
+00005180: 726f 7028 6e6f 6465 2c20 2a2a 6b77 6172  rop(node, **kwar
+00005190: 6773 293a 0d0a 2020 2020 2020 2020 6163  gs):..        ac
+000051a0: 7469 7661 7465 203d 2073 656c 662e 6b65  tivate = self.ke
+000051b0: 726e 656c 2e6c 6f6f 6b75 7028 2266 756e  rnel.lookup("fun
+000051c0: 6374 696f 6e2f 6f70 656e 5f70 726f 7065  ction/open_prope
+000051d0: 7274 795f 7769 6e64 6f77 5f66 6f72 5f6e  rty_window_for_n
+000051e0: 6f64 6522 290d 0a20 2020 2020 2020 2069  ode")..        i
+000051f0: 6620 6163 7469 7661 7465 2069 7320 6e6f  f activate is no
+00005200: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+00005210: 2020 2020 2061 6374 6976 6174 6528 6e6f       activate(no
+00005220: 6465 290d 0a0d 0a20 2020 2040 7472 6565  de)....    @tree
+00005230: 5f6f 7065 7261 7469 6f6e 285f 2822 436c  _operation(_("Cl
+00005240: 6561 7220 616c 6c22 292c 206e 6f64 655f  ear all"), node_
+00005250: 7479 7065 3d22 6272 616e 6368 206f 7073  type="branch ops
+00005260: 222c 2068 656c 703d 2222 290d 0a20 2020  ", help="")..   
+00005270: 2064 6566 2063 6c65 6172 5f61 6c6c 286e   def clear_all(n
+00005280: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
+00005290: 0a20 2020 2020 2020 2073 656c 6628 226f  .        self("o
+000052a0: 7065 7261 7469 6f6e 2a20 6465 6c65 7465  peration* delete
+000052b0: 5c6e 2229 0d0a 0d0a 2020 2020 4074 7265  \n")....    @tre
+000052c0: 655f 6f70 6572 6174 696f 6e28 0d0a 2020  e_operation(..  
+000052d0: 2020 2020 2020 5f28 2243 6c65 6172 2075        _("Clear u
+000052e0: 6e75 7365 6422 292c 0d0a 2020 2020 2020  nused"),..      
+000052f0: 2020 6e6f 6465 5f74 7970 653d 2262 7261    node_type="bra
+00005300: 6e63 6820 6f70 7322 2c0d 0a20 2020 2020  nch ops",..     
+00005310: 2020 2068 656c 703d 5f28 2243 6c65 6172     help=_("Clear
+00005320: 206f 7065 7261 7469 6f6e 7320 7769 7468   operations with
+00005330: 6f75 7420 6368 696c 6472 656e 2229 2c0d  out children"),.
+00005340: 0a20 2020 2029 0d0a 2020 2020 6465 6620  .    )..    def 
+00005350: 636c 6561 725f 756e 7573 6564 286e 6f64  clear_unused(nod
+00005360: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
+00005370: 2020 2020 2020 2074 6f5f 6465 6c65 7465         to_delete
+00005380: 203d 205b 5d0d 0a20 2020 2020 2020 2066   = []..        f
+00005390: 6f72 206f 7020 696e 2073 656c 662e 6f70  or op in self.op
+000053a0: 7328 293a 0d0a 2020 2020 2020 2020 2020  s():..          
+000053b0: 2020 2320 7072 696e 7420 2866 227b 6f70    # print (f"{op
+000053c0: 2e74 7970 657d 2c20 7265 6673 3d7b 6c65  .type}, refs={le
+000053d0: 6e28 6f70 2e5f 7265 6665 7265 6e63 6573  n(op._references
+000053e0: 297d 2c20 6368 696c 6472 656e 3d7b 6c65  )}, children={le
+000053f0: 6e28 6f70 2e5f 6368 696c 6472 656e 297d  n(op._children)}
+00005400: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+00005410: 6966 206c 656e 286f 702e 5f63 6869 6c64  if len(op._child
+00005420: 7265 6e29 203d 3d20 3020 616e 6420 6e6f  ren) == 0 and no
+00005430: 7420 6f70 2e74 7970 6520 3d3d 2022 626c  t op.type == "bl
+00005440: 6f62 223a 0d0a 2020 2020 2020 2020 2020  ob":..          
+00005450: 2020 2020 2020 746f 5f64 656c 6574 652e        to_delete.
+00005460: 6170 7065 6e64 286f 7029 0d0a 2020 2020  append(op)..    
+00005470: 2020 2020 6966 206c 656e 2874 6f5f 6465      if len(to_de
+00005480: 6c65 7465 2920 3e20 303a 0d0a 2020 2020  lete) > 0:..    
+00005490: 2020 2020 2020 2020 7769 7468 2073 656c          with sel
+000054a0: 662e 7374 6174 6963 2822 636c 6561 725f  f.static("clear_
+000054b0: 756e 7573 6564 2229 3a0d 0a20 2020 2020  unused"):..     
+000054c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000054d0: 7265 6d6f 7665 5f6f 7065 7261 7469 6f6e  remove_operation
+000054e0: 7328 746f 5f64 656c 6574 6529 0d0a 0d0a  s(to_delete)....
+000054f0: 2020 2020 6465 6620 7261 6469 6f5f 6d61      def radio_ma
+00005500: 7463 685f 7370 6565 645f 616c 6c28 6e6f  tch_speed_all(no
+00005510: 6465 2c20 7370 6565 643d 302c 202a 2a6b  de, speed=0, **k
+00005520: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
+00005530: 206d 6178 7370 6565 6420 3d20 300d 0a20   maxspeed = 0.. 
+00005540: 2020 2020 2020 2066 6f72 206e 2069 6e20         for n in 
+00005550: 6c69 7374 2873 656c 662e 6f70 7328 2929  list(self.ops())
+00005560: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+00005570: 6620 6e2e 7370 6565 6420 6973 206e 6f74  f n.speed is not
+00005580: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00005590: 2020 2020 2020 2020 6d61 7873 7065 6564          maxspeed
+000055a0: 203d 206d 6178 286d 6178 7370 6565 642c   = max(maxspeed,
+000055b0: 206e 2e73 7065 6564 290d 0a20 2020 2020   n.speed)..     
+000055c0: 2020 2072 6574 7572 6e20 626f 6f6c 2861     return bool(a
+000055d0: 6273 286d 6178 7370 6565 6420 2d20 666c  bs(maxspeed - fl
+000055e0: 6f61 7428 7370 6565 6429 2920 3c20 302e  oat(speed)) < 0.
+000055f0: 3529 0d0a 0d0a 2020 2020 4074 7265 655f  5)....    @tree_
+00005600: 7375 626d 656e 7528 5f28 2253 6361 6c65  submenu(_("Scale
+00005610: 2073 7065 6564 2073 6574 7469 6e67 7322   speed settings"
+00005620: 2929 0d0a 2020 2020 4074 7265 655f 7261  ))..    @tree_ra
+00005630: 6469 6f28 7261 6469 6f5f 6d61 7463 685f  dio(radio_match_
+00005640: 7370 6565 645f 616c 6c29 0d0a 2020 2020  speed_all)..    
+00005650: 4074 7265 655f 7661 6c75 6573 2822 7370  @tree_values("sp
+00005660: 6565 6422 2c20 2835 2c20 3130 2c20 3530  eed", (5, 10, 50
+00005670: 2c20 3735 2c20 3130 302c 2031 3530 2c20  , 75, 100, 150, 
+00005680: 3230 302c 2032 3530 2c20 3330 302c 2033  200, 250, 300, 3
+00005690: 3530 2c20 3430 302c 2034 3530 2c20 3530  50, 400, 450, 50
+000056a0: 3029 290d 0a20 2020 2040 7472 6565 5f6f  0))..    @tree_o
+000056b0: 7065 7261 7469 6f6e 280d 0a20 2020 2020  peration(..     
+000056c0: 2020 205f 2822 4d61 7820 7370 6565 6420     _("Max speed 
+000056d0: 3d20 7b73 7065 6564 7d6d 6d2f 7322 292c  = {speed}mm/s"),
+000056e0: 0d0a 2020 2020 2020 2020 6e6f 6465 5f74  ..        node_t
+000056f0: 7970 653d 2262 7261 6e63 6820 6f70 7322  ype="branch ops"
+00005700: 2c0d 0a20 2020 2020 2020 2068 656c 703d  ,..        help=
+00005710: 2222 2c0d 0a20 2020 2029 0d0a 2020 2020  "",..    )..    
+00005720: 6465 6620 7365 745f 7370 6565 645f 6c65  def set_speed_le
+00005730: 7665 6c73 286e 6f64 652c 2073 7065 6564  vels(node, speed
+00005740: 3d31 3530 2c20 2a2a 6b77 6172 6773 293a  =150, **kwargs):
+00005750: 0d0a 2020 2020 2020 2020 6461 7461 203d  ..        data =
+00005760: 206c 6973 7428 290d 0a20 2020 2020 2020   list()..       
+00005770: 206d 6178 7370 6565 6420 3d20 300d 0a20   maxspeed = 0.. 
+00005780: 2020 2020 2020 2066 6f72 206e 2069 6e20         for n in 
+00005790: 6c69 7374 2873 656c 662e 6f70 7328 2929  list(self.ops())
+000057a0: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+000057b0: 6620 6e2e 7370 6565 6420 6973 206e 6f74  f n.speed is not
+000057c0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+000057d0: 2020 2020 2020 2020 6d61 7873 7065 6564          maxspeed
+000057e0: 203d 206d 6178 286d 6178 7370 6565 642c   = max(maxspeed,
+000057f0: 206e 2e73 7065 6564 290d 0a20 2020 2020   n.speed)..     
+00005800: 2020 2069 6620 6d61 7873 7065 6564 203d     if maxspeed =
+00005810: 3d20 303a 0d0a 2020 2020 2020 2020 2020  = 0:..          
+00005820: 2020 7265 7475 726e 0d0a 2020 2020 2020    return..      
+00005830: 2020 666f 7220 6e20 696e 206c 6973 7428    for n in list(
+00005840: 7365 6c66 2e6f 7073 2829 293a 0d0a 2020  self.ops()):..  
+00005850: 2020 2020 2020 2020 2020 6966 206e 2e73            if n.s
+00005860: 7065 6564 2069 7320 6e6f 7420 4e6f 6e65  peed is not None
+00005870: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00005880: 2020 206f 6c64 7370 6565 6420 3d20 666c     oldspeed = fl
+00005890: 6f61 7428 6e2e 7370 6565 6429 0d0a 2020  oat(n.speed)..  
+000058a0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+000058b0: 7773 7065 6564 203d 206f 6c64 7370 6565  wspeed = oldspee
+000058c0: 6420 2f20 6d61 7873 7065 6564 202a 2073  d / maxspeed * s
+000058d0: 7065 6564 0d0a 2020 2020 2020 2020 2020  peed..          
+000058e0: 2020 2020 2020 6e2e 7370 6565 6420 3d20        n.speed = 
+000058f0: 666c 6f61 7428 6e65 7773 7065 6564 290d  float(newspeed).
+00005900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005910: 2064 6174 612e 6170 7065 6e64 286e 290d   data.append(n).
+00005920: 0a20 2020 2020 2020 2073 656c 662e 7369  .        self.si
+00005930: 676e 616c 2822 656c 656d 656e 745f 7072  gnal("element_pr
+00005940: 6f70 6572 7479 5f72 656c 6f61 6422 2c20  operty_reload", 
+00005950: 6461 7461 290d 0a0d 0a20 2020 2064 6566  data)....    def
+00005960: 2072 6164 696f 5f6d 6174 6368 5f70 6f77   radio_match_pow
+00005970: 6572 5f61 6c6c 286e 6f64 652c 2070 6f77  er_all(node, pow
+00005980: 6572 3d30 2c20 2a2a 6b77 6172 6773 293a  er=0, **kwargs):
+00005990: 0d0a 2020 2020 2020 2020 6d61 7870 6f77  ..        maxpow
+000059a0: 6572 203d 2030 0d0a 2020 2020 2020 2020  er = 0..        
+000059b0: 666f 7220 6e20 696e 206c 6973 7428 7365  for n in list(se
+000059c0: 6c66 2e6f 7073 2829 293a 0d0a 2020 2020  lf.ops()):..    
+000059d0: 2020 2020 2020 2020 6966 206e 2e70 6f77          if n.pow
+000059e0: 6572 2069 7320 6e6f 7420 4e6f 6e65 3a0d  er is not None:.
+000059f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005a00: 206d 6178 706f 7765 7220 3d20 6d61 7828   maxpower = max(
+00005a10: 6d61 7870 6f77 6572 2c20 6e2e 706f 7765  maxpower, n.powe
+00005a20: 7229 0d0a 2020 2020 2020 2020 7265 7475  r)..        retu
+00005a30: 726e 2062 6f6f 6c28 6162 7328 6d61 7870  rn bool(abs(maxp
+00005a40: 6f77 6572 202d 2066 6c6f 6174 2870 6f77  ower - float(pow
+00005a50: 6572 2929 203c 2030 2e35 290d 0a0d 0a20  er)) < 0.5).... 
+00005a60: 2020 2040 7472 6565 5f73 7562 6d65 6e75     @tree_submenu
+00005a70: 285f 2822 5363 616c 6520 706f 7765 7220  (_("Scale power 
+00005a80: 7365 7474 696e 6773 2229 290d 0a20 2020  settings"))..   
+00005a90: 2040 7472 6565 5f72 6164 696f 2872 6164   @tree_radio(rad
+00005aa0: 696f 5f6d 6174 6368 5f70 6f77 6572 5f61  io_match_power_a
+00005ab0: 6c6c 290d 0a20 2020 2040 7472 6565 5f76  ll)..    @tree_v
+00005ac0: 616c 7565 7328 2270 6f77 6572 222c 2028  alues("power", (
+00005ad0: 3130 302c 2032 3530 2c20 3333 332c 2035  100, 250, 333, 5
+00005ae0: 3030 2c20 3636 372c 2037 3530 2c20 3130  00, 667, 750, 10
+00005af0: 3030 2929 0d0a 2020 2020 4074 7265 655f  00))..    @tree_
+00005b00: 6361 6c63 2822 706f 7765 725f 3130 222c  calc("power_10",
+00005b10: 206c 616d 6264 6120 693a 2072 6f75 6e64   lambda i: round
+00005b20: 2869 202f 2031 302c 2031 2929 0d0a 2020  (i / 10, 1))..  
+00005b30: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
+00005b40: 6e28 0d0a 2020 2020 2020 2020 5f28 224d  n(..        _("M
+00005b50: 6178 2070 6f77 6572 203d 207b 706f 7765  ax power = {powe
+00005b60: 727d 7070 6920 287b 706f 7765 725f 3130  r}ppi ({power_10
+00005b70: 7d25 2922 292c 0d0a 2020 2020 2020 2020  }%)"),..        
+00005b80: 6e6f 6465 5f74 7970 653d 2262 7261 6e63  node_type="branc
+00005b90: 6820 6f70 7322 2c0d 0a20 2020 2020 2020  h ops",..       
+00005ba0: 2068 656c 703d 2222 2c0d 0a20 2020 2029   help="",..    )
+00005bb0: 0d0a 2020 2020 6465 6620 7365 745f 706f  ..    def set_po
+00005bc0: 7765 725f 6c65 7665 6c73 286e 6f64 652c  wer_levels(node,
+00005bd0: 2070 6f77 6572 3d31 3030 302c 202a 2a6b   power=1000, **k
+00005be0: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
+00005bf0: 2064 6174 6120 3d20 6c69 7374 2829 0d0a   data = list()..
+00005c00: 2020 2020 2020 2020 6d61 7870 6f77 6572          maxpower
+00005c10: 203d 2030 0d0a 2020 2020 2020 2020 666f   = 0..        fo
+00005c20: 7220 6e20 696e 206c 6973 7428 7365 6c66  r n in list(self
+00005c30: 2e6f 7073 2829 293a 0d0a 2020 2020 2020  .ops()):..      
+00005c40: 2020 2020 2020 6966 206e 2e70 6f77 6572        if n.power
+00005c50: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
+00005c60: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00005c70: 6178 706f 7765 7220 3d20 6d61 7828 6d61  axpower = max(ma
+00005c80: 7870 6f77 6572 2c20 6e2e 706f 7765 7229  xpower, n.power)
+00005c90: 0d0a 2020 2020 2020 2020 6966 206d 6178  ..        if max
+00005ca0: 706f 7765 7220 3d3d 2030 3a0d 0a20 2020  power == 0:..   
+00005cb0: 2020 2020 2020 2020 2072 6574 7572 6e0d           return.
+00005cc0: 0a20 2020 2020 2020 2066 6f72 206e 2069  .        for n i
+00005cd0: 6e20 6c69 7374 2873 656c 662e 6f70 7328  n list(self.ops(
+00005ce0: 2929 3a0d 0a20 2020 2020 2020 2020 2020  )):..           
+00005cf0: 2069 6620 6e2e 706f 7765 7220 6973 206e   if n.power is n
+00005d00: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
+00005d10: 2020 2020 2020 2020 2020 6f6c 6470 6f77            oldpow
+00005d20: 6572 203d 2066 6c6f 6174 286e 2e70 6f77  er = float(n.pow
+00005d30: 6572 290d 0a20 2020 2020 2020 2020 2020  er)..           
+00005d40: 2020 2020 206e 6577 706f 7765 7220 3d20       newpower = 
+00005d50: 6f6c 6470 6f77 6572 202f 206d 6178 706f  oldpower / maxpo
+00005d60: 7765 7220 2a20 706f 7765 720d 0a20 2020  wer * power..   
+00005d70: 2020 2020 2020 2020 2020 2020 206e 2e70               n.p
+00005d80: 6f77 6572 203d 2066 6c6f 6174 286e 6577  ower = float(new
+00005d90: 706f 7765 7229 0d0a 2020 2020 2020 2020  power)..        
+00005da0: 2020 2020 2020 2020 6461 7461 2e61 7070          data.app
+00005db0: 656e 6428 6e29 0d0a 2020 2020 2020 2020  end(n)..        
+00005dc0: 7365 6c66 2e73 6967 6e61 6c28 2265 6c65  self.signal("ele
+00005dd0: 6d65 6e74 5f70 726f 7065 7274 795f 7265  ment_property_re
+00005de0: 6c6f 6164 222c 2064 6174 6129 0d0a 0d0a  load", data)....
+00005df0: 2020 2020 6465 6620 7365 745f 6f70 5f6f      def set_op_o
+00005e00: 7574 7075 7428 6f70 732c 2076 616c 7565  utput(ops, value
+00005e10: 293a 0d0a 2020 2020 2020 2020 6e65 7776  ):..        newv
+00005e20: 616c 7565 203d 2076 616c 7565 0d0a 2020  alue = value..  
+00005e30: 2020 2020 2020 666f 7220 6e20 696e 206f        for n in o
+00005e40: 7073 3a0d 0a20 2020 2020 2020 2020 2020  ps:..           
+00005e50: 2069 6620 7661 6c75 6520 6973 204e 6f6e   if value is Non
+00005e60: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00005e70: 2020 2020 6e65 7776 616c 7565 203d 206e      newvalue = n
+00005e80: 6f74 206e 2e6f 7574 7075 740d 0a20 2020  ot n.output..   
+00005e90: 2020 2020 2020 2020 2074 7279 3a0d 0a20           try:.. 
+00005ea0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00005eb0: 2e6f 7574 7075 7420 3d20 6e65 7776 616c  .output = newval
+00005ec0: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
+00005ed0: 2020 2020 6e2e 7570 6461 7465 6428 290d      n.updated().
+00005ee0: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+00005ef0: 6570 7420 4174 7472 6962 7574 6545 7272  ept AttributeErr
+00005f00: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
+00005f10: 2020 2020 2070 6173 730d 0a20 2020 2020       pass..     
+00005f20: 2020 2073 656c 662e 7369 676e 616c 2822     self.signal("
+00005f30: 656c 656d 656e 745f 7072 6f70 6572 7479  element_property
+00005f40: 5f75 7064 6174 6522 2c20 6f70 7329 0d0a  _update", ops)..
+00005f50: 0d0a 2020 2020 4074 7265 655f 7365 7061  ..    @tree_sepa
+00005f60: 7261 746f 725f 6265 666f 7265 2829 0d0a  rator_before()..
+00005f70: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
+00005f80: 696f 6e28 0d0a 2020 2020 2020 2020 5f28  ion(..        _(
+00005f90: 2245 6e61 626c 6520 616c 6c20 6f70 6572  "Enable all oper
+00005fa0: 6174 696f 6e73 2229 2c0d 0a20 2020 2020  ations"),..     
+00005fb0: 2020 206e 6f64 655f 7479 7065 3d22 6272     node_type="br
+00005fc0: 616e 6368 206f 7073 222c 0d0a 2020 2020  anch ops",..    
+00005fd0: 2020 2020 6865 6c70 3d5f 2822 456e 6162      help=_("Enab
+00005fe0: 6c65 2061 6c6c 206f 7065 7261 7469 6f6e  le all operation
+00005ff0: 7322 292c 0d0a 2020 2020 290d 0a20 2020  s"),..    )..   
+00006000: 2064 6566 206f 7073 5f65 6e61 626c 655f   def ops_enable_
+00006010: 616c 6c28 6e6f 6465 2c20 2a2a 6b77 6172  all(node, **kwar
+00006020: 6773 293a 0d0a 2020 2020 2020 2020 7365  gs):..        se
+00006030: 745f 6f70 5f6f 7574 7075 7428 6c69 7374  t_op_output(list
+00006040: 2873 656c 662e 6f70 7328 2929 2c20 5472  (self.ops()), Tr
+00006050: 7565 290d 0a0d 0a20 2020 2040 7472 6565  ue)....    @tree
+00006060: 5f6f 7065 7261 7469 6f6e 280d 0a20 2020  _operation(..   
+00006070: 2020 2020 205f 2822 4469 7361 626c 6520       _("Disable 
+00006080: 616c 6c20 6f70 6572 6174 696f 6e73 2229  all operations")
+00006090: 2c0d 0a20 2020 2020 2020 206e 6f64 655f  ,..        node_
+000060a0: 7479 7065 3d22 6272 616e 6368 206f 7073  type="branch ops
+000060b0: 222c 0d0a 2020 2020 2020 2020 6865 6c70  ",..        help
+000060c0: 3d5f 2822 4469 7361 626c 6520 616c 6c20  =_("Disable all 
+000060d0: 6f70 6572 6174 696f 6e73 2229 2c0d 0a20  operations"),.. 
+000060e0: 2020 2029 0d0a 2020 2020 6465 6620 6f70     )..    def op
+000060f0: 735f 6469 7361 626c 655f 616c 6c28 6e6f  s_disable_all(no
+00006100: 6465 2c20 2a2a 6b77 6172 6773 293a 0d0a  de, **kwargs):..
+00006110: 2020 2020 2020 2020 7365 745f 6f70 5f6f          set_op_o
+00006120: 7574 7075 7428 6c69 7374 2873 656c 662e  utput(list(self.
+00006130: 6f70 7328 2929 2c20 4661 6c73 6529 0d0a  ops()), False)..
+00006140: 0d0a 2020 2020 4074 7265 655f 7365 7061  ..    @tree_sepa
+00006150: 7261 746f 725f 6166 7465 7228 290d 0a20  rator_after().. 
+00006160: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
+00006170: 6f6e 280d 0a20 2020 2020 2020 205f 2822  on(..        _("
+00006180: 546f 6767 6c65 2061 6c6c 206f 7065 7261  Toggle all opera
+00006190: 7469 6f6e 7322 292c 0d0a 2020 2020 2020  tions"),..      
+000061a0: 2020 6e6f 6465 5f74 7970 653d 2262 7261    node_type="bra
+000061b0: 6e63 6820 6f70 7322 2c0d 0a20 2020 2020  nch ops",..     
+000061c0: 2020 2068 656c 703d 5f28 2254 6f67 676c     help=_("Toggl
+000061d0: 6520 656e 6162 6c65 642d 7374 6174 7573  e enabled-status
+000061e0: 206f 6620 616c 6c20 6f70 6572 6174 696f   of all operatio
+000061f0: 6e73 2229 2c0d 0a20 2020 2029 0d0a 2020  ns"),..    )..  
+00006200: 2020 6465 6620 6f70 735f 746f 6767 6c65    def ops_toggle
+00006210: 5f61 6c6c 286e 6f64 652c 202a 2a6b 7761  _all(node, **kwa
+00006220: 7267 7329 3a0d 0a20 2020 2020 2020 2073  rgs):..        s
+00006230: 6574 5f6f 705f 6f75 7470 7574 286c 6973  et_op_output(lis
+00006240: 7428 7365 6c66 2e6f 7073 2829 292c 204e  t(self.ops()), N
+00006250: 6f6e 6529 0d0a 0d0a 2020 2020 2320 3d3d  one)....    # ==
+00006260: 3d3d 3d3d 3d3d 3d3d 0d0a 2020 2020 2320  ========..    # 
+00006270: 4765 6e65 7261 6c20 6d65 6e75 2d65 6e74  General menu-ent
+00006280: 7269 6573 2066 6f72 2065 6c65 6d20 6272  ries for elem br
+00006290: 616e 6368 0d0a 2020 2020 2320 3d3d 3d3d  anch..    # ====
+000062a0: 3d3d 3d3d 3d3d 0d0a 0d0a 2020 2020 4074  ======....    @t
+000062b0: 7265 655f 6f70 6572 6174 696f 6e28 5f28  ree_operation(_(
+000062c0: 2243 6c65 6172 2061 6c6c 2229 2c20 6e6f  "Clear all"), no
+000062d0: 6465 5f74 7970 653d 2262 7261 6e63 6820  de_type="branch 
+000062e0: 656c 656d 7322 2c20 6865 6c70 3d22 2229  elems", help="")
+000062f0: 0d0a 2020 2020 6465 6620 636c 6561 725f  ..    def clear_
+00006300: 616c 6c5f 656c 656d 7328 6e6f 6465 2c20  all_elems(node, 
+00006310: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
+00006320: 2020 2020 2320 7365 6c66 2822 656c 656d      # self("elem
+00006330: 656e 742a 2064 656c 6574 655c 6e22 290d  ent* delete\n").
+00006340: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
+00006350: 6c66 2e73 7461 7469 6328 2263 6c65 6172  lf.static("clear
+00006360: 5f65 6c65 6d73 2229 3a0d 0a20 2020 2020  _elems"):..     
+00006370: 2020 2020 2020 2073 656c 662e 656c 656d         self.elem
+00006380: 5f62 7261 6e63 682e 7265 6d6f 7665 5f61  _branch.remove_a
+00006390: 6c6c 5f63 6869 6c64 7265 6e28 290d 0a0d  ll_children()...
+000063a0: 0a20 2020 2023 203d 3d3d 3d3d 3d3d 3d3d  .    # =========
+000063b0: 3d0d 0a20 2020 2023 2047 656e 6572 616c  =..    # General
+000063c0: 206d 656e 752d 656e 7472 6965 7320 666f   menu-entries fo
+000063d0: 7220 7265 676d 6172 6b20 6272 616e 6368  r regmark branch
+000063e0: 0d0a 2020 2020 2320 3d3d 3d3d 3d3d 3d3d  ..    # ========
+000063f0: 3d3d 0d0a 0d0a 2020 2020 4074 7265 655f  ==....    @tree_
+00006400: 6f70 6572 6174 696f 6e28 5f28 2243 6c65  operation(_("Cle
+00006410: 6172 2061 6c6c 2229 2c20 6e6f 6465 5f74  ar all"), node_t
+00006420: 7970 653d 2262 7261 6e63 6820 7265 6722  ype="branch reg"
+00006430: 2c20 6865 6c70 3d22 2229 0d0a 2020 2020  , help="")..    
+00006440: 6465 6620 636c 6561 725f 616c 6c5f 7265  def clear_all_re
+00006450: 676d 6172 6b73 286e 6f64 652c 202a 2a6b  gmarks(node, **k
+00006460: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
+00006470: 2077 6974 6820 7365 6c66 2e73 7461 7469   with self.stati
+00006480: 6328 2263 6c65 6172 5f72 6567 6d61 726b  c("clear_regmark
+00006490: 7322 293a 0d0a 2020 2020 2020 2020 2020  s"):..          
+000064a0: 2020 7365 6c66 2e72 6567 5f62 7261 6e63    self.reg_branc
+000064b0: 682e 7265 6d6f 7665 5f61 6c6c 5f63 6869  h.remove_all_chi
+000064c0: 6c64 7265 6e28 290d 0a0d 0a20 2020 2023  ldren()....    #
+000064d0: 203d 3d3d 3d3d 3d3d 3d3d 3d0d 0a20 2020   ==========..   
+000064e0: 2023 2052 454d 4f56 4520 4d55 4c54 4920   # REMOVE MULTI 
+000064f0: 2854 7265 6520 5365 6c65 6374 6564 290d  (Tree Selected).
+00006500: 0a20 2020 2023 203d 3d3d 3d3d 3d3d 3d3d  .    # =========
+00006510: 3d0d 0a20 2020 2023 2043 616c 6375 6c61  =..    # Calcula
+00006520: 7465 2074 6865 2061 6d6f 756e 7420 6f66  te the amount of
+00006530: 2073 656c 6563 7465 6420 6e6f 6465 7320   selected nodes 
+00006540: 696e 2074 6865 2074 7265 653a 0d0a 2020  in the tree:..  
+00006550: 2020 2320 4966 2074 6865 7265 2061 7265    # If there are
+00006560: 206f 7073 2073 656c 6563 7465 6420 7468   ops selected th
+00006570: 656e 2074 6865 7920 7461 6b65 2070 7265  en they take pre
+00006580: 6365 6465 6e63 650d 0a20 2020 2023 2061  cedence..    # a
+00006590: 6e64 2077 696c 6c20 6f6e 6c79 2062 6520  nd will only be 
+000065a0: 636f 756e 7465 640d 0a0d 0a20 2020 2040  counted....    @
+000065b0: 7472 6565 5f63 6f6e 6469 7469 6f6e 616c  tree_conditional
+000065c0: 280d 0a20 2020 2020 2020 206c 616d 6264  (..        lambd
+000065d0: 6120 636f 6e64 3a20 6c65 6e28 0d0a 2020  a cond: len(..  
+000065e0: 2020 2020 2020 2020 2020 6c69 7374 2873            list(s
+000065f0: 656c 662e 666c 6174 2873 656c 6563 7465  elf.flat(selecte
+00006600: 643d 5472 7565 2c20 6361 7363 6164 653d  d=True, cascade=
+00006610: 4661 6c73 652c 2074 7970 6573 3d22 7265  False, types="re
+00006620: 6665 7265 6e63 6522 2929 0d0a 2020 2020  ference"))..    
+00006630: 2020 2020 290d 0a20 2020 2020 2020 203e      )..        >
+00006640: 3d20 310d 0a20 2020 2029 0d0a 2020 2020  = 1..    )..    
+00006650: 4074 7265 655f 6361 6c63 280d 0a20 2020  @tree_calc(..   
+00006660: 2020 2020 2022 6563 6f75 6e74 222c 0d0a       "ecount",..
+00006670: 2020 2020 2020 2020 6c61 6d62 6461 2069          lambda i
+00006680: 3a20 6c65 6e28 6c69 7374 2873 656c 662e  : len(list(self.
+00006690: 666c 6174 2873 656c 6563 7465 643d 5472  flat(selected=Tr
+000066a0: 7565 2c20 6361 7363 6164 653d 4661 6c73  ue, cascade=Fals
+000066b0: 652c 2074 7970 6573 3d22 7265 6665 7265  e, types="refere
+000066c0: 6e63 6522 2929 292c 0d0a 2020 2020 290d  nce"))),..    ).
+000066d0: 0a20 2020 2040 7472 6565 5f6f 7065 7261  .    @tree_opera
+000066e0: 7469 6f6e 280d 0a20 2020 2020 2020 205f  tion(..        _
+000066f0: 2822 5265 6d6f 7665 207b 6563 6f75 6e74  ("Remove {ecount
+00006700: 7d20 7365 6c65 6374 6564 2069 7465 6d73  } selected items
+00006710: 2066 726f 6d20 6f70 6572 6174 696f 6e73   from operations
+00006720: 2229 2c0d 0a20 2020 2020 2020 206e 6f64  "),..        nod
+00006730: 655f 7479 7065 3d22 7265 6665 7265 6e63  e_type="referenc
+00006740: 6522 2c0d 0a20 2020 2020 2020 2068 656c  e",..        hel
+00006750: 703d 2222 2c0d 0a20 2020 2029 0d0a 2020  p="",..    )..  
+00006760: 2020 6465 6620 7265 6d6f 7665 5f6d 756c    def remove_mul
+00006770: 7469 5f72 6566 6572 656e 6365 7328 6e6f  ti_references(no
+00006780: 6465 2c20 2a2a 6b77 6172 6773 293a 0d0a  de, **kwargs):..
+00006790: 2020 2020 2020 2020 6e6f 6465 7320 3d20          nodes = 
+000067a0: 6c69 7374 2873 656c 662e 666c 6174 2873  list(self.flat(s
+000067b0: 656c 6563 7465 643d 5472 7565 2c20 6361  elected=True, ca
+000067c0: 7363 6164 653d 4661 6c73 652c 2074 7970  scade=False, typ
+000067d0: 6573 3d22 7265 6665 7265 6e63 6522 2929  es="reference"))
+000067e0: 0d0a 2020 2020 2020 2020 666f 7220 6e6f  ..        for no
+000067f0: 6465 2069 6e20 6e6f 6465 733a 0d0a 2020  de in nodes:..  
+00006800: 2020 2020 2020 2020 2020 6966 206e 6f64            if nod
+00006810: 652e 7061 7265 6e74 2069 7320 6e6f 7420  e.parent is not 
+00006820: 4e6f 6e65 3a20 2023 204d 6179 2068 6176  None:  # May hav
+00006830: 6520 616c 7265 6164 7920 7265 6d6f 7665  e already remove
+00006840: 642e 0d0a 2020 2020 2020 2020 2020 2020  d...            
+00006850: 2020 2020 6e6f 6465 2e72 656d 6f76 655f      node.remove_
+00006860: 6e6f 6465 2829 0d0a 2020 2020 2020 2020  node()..        
+00006870: 7365 6c66 2e73 6574 5f65 6d70 6861 7369  self.set_emphasi
+00006880: 7328 4e6f 6e65 290d 0a20 2020 2020 2020  s(None)..       
+00006890: 2073 656c 662e 7369 676e 616c 2822 7265   self.signal("re
+000068a0: 6672 6573 685f 7472 6565 2229 0d0a 0d0a  fresh_tree")....
+000068b0: 2020 2020 2320 4074 7265 655f 636f 6e64      # @tree_cond
+000068c0: 6974 696f 6e61 6c28 0d0a 2020 2020 2320  itional(..    # 
+000068d0: 2020 2020 6c61 6d62 6461 2063 6f6e 643a      lambda cond:
+000068e0: 206c 656e 280d 0a20 2020 2023 2020 2020   len(..    #    
+000068f0: 2020 2020 206c 6973 7428 7365 6c66 2e66       list(self.f
+00006900: 6c61 7428 7365 6c65 6374 6564 3d54 7275  lat(selected=Tru
+00006910: 652c 2063 6173 6361 6465 3d46 616c 7365  e, cascade=False
+00006920: 2c20 7479 7065 733d 6f70 6572 6174 655f  , types=operate_
+00006930: 6e6f 6465 7329 290d 0a20 2020 2023 2020  nodes))..    #  
+00006940: 2020 2029 0d0a 2020 2020 2320 2020 2020     )..    #     
+00006950: 6966 206c 656e 286c 6973 7428 7365 6c66  if len(list(self
+00006960: 2e66 6c61 7428 7365 6c65 6374 6564 3d54  .flat(selected=T
+00006970: 7275 652c 2063 6173 6361 6465 3d46 616c  rue, cascade=Fal
+00006980: 7365 2c20 7479 7065 733d 6f70 6572 6174  se, types=operat
+00006990: 655f 6e6f 6465 7329 2929 0d0a 2020 2020  e_nodes)))..    
+000069a0: 2320 2020 2020 3e20 300d 0a20 2020 2023  #     > 0..    #
+000069b0: 2020 2020 2065 6c73 6520 6c65 6e28 0d0a       else len(..
+000069c0: 2020 2020 2320 2020 2020 2020 2020 6c69      #         li
+000069d0: 7374 2873 656c 662e 666c 6174 2873 656c  st(self.flat(sel
+000069e0: 6563 7465 643d 5472 7565 2c20 6361 7363  ected=True, casc
+000069f0: 6164 653d 4661 6c73 652c 2074 7970 6573  ade=False, types
+00006a00: 3d65 6c65 6d5f 6772 6f75 705f 6e6f 6465  =elem_group_node
+00006a10: 7329 290d 0a20 2020 2023 2020 2020 2029  s))..    #     )
+00006a20: 0d0a 2020 2020 2320 2020 2020 3e20 310d  ..    #     > 1.
+00006a30: 0a20 2020 2023 2029 0d0a 2020 2020 2320  .    # )..    # 
+00006a40: 4074 7265 655f 6361 6c63 280d 0a20 2020  @tree_calc(..   
+00006a50: 2023 2020 2020 2022 6563 6f75 6e74 222c   #     "ecount",
+00006a60: 0d0a 2020 2020 2320 2020 2020 6c61 6d62  ..    #     lamb
+00006a70: 6461 2069 3a20 6c65 6e28 0d0a 2020 2020  da i: len(..    
+00006a80: 2320 2020 2020 2020 2020 6c69 7374 2873  #         list(s
+00006a90: 656c 662e 666c 6174 2873 656c 6563 7465  elf.flat(selecte
+00006aa0: 643d 5472 7565 2c20 6361 7363 6164 653d  d=True, cascade=
+00006ab0: 4661 6c73 652c 2074 7970 6573 3d6f 7065  False, types=ope
+00006ac0: 7261 7465 5f6e 6f64 6573 2929 0d0a 2020  rate_nodes))..  
+00006ad0: 2020 2320 2020 2020 290d 0a20 2020 2023    #     )..    #
+00006ae0: 2020 2020 2069 6620 6c65 6e28 6c69 7374       if len(list
+00006af0: 2873 656c 662e 666c 6174 2873 656c 6563  (self.flat(selec
+00006b00: 7465 643d 5472 7565 2c20 6361 7363 6164  ted=True, cascad
+00006b10: 653d 4661 6c73 652c 2074 7970 6573 3d6f  e=False, types=o
+00006b20: 7065 7261 7465 5f6e 6f64 6573 2929 290d  perate_nodes))).
+00006b30: 0a20 2020 2023 2020 2020 203e 2030 0d0a  .    #     > 0..
+00006b40: 2020 2020 2320 2020 2020 656c 7365 206c      #     else l
+00006b50: 656e 280d 0a20 2020 2023 2020 2020 2020  en(..    #      
+00006b60: 2020 206c 6973 7428 7365 6c66 2e66 6c61     list(self.fla
+00006b70: 7428 7365 6c65 6374 6564 3d54 7275 652c  t(selected=True,
+00006b80: 2063 6173 6361 6465 3d46 616c 7365 2c20   cascade=False, 
+00006b90: 7479 7065 733d 656c 656d 5f67 726f 7570  types=elem_group
+00006ba0: 5f6e 6f64 6573 2929 0d0a 2020 2020 2320  _nodes))..    # 
+00006bb0: 2020 2020 292c 0d0a 2020 2020 2320 290d      ),..    # ).
+00006bc0: 0a20 2020 2023 2040 7472 6565 5f63 616c  .    # @tree_cal
+00006bd0: 6328 0d0a 2020 2020 2320 2020 2020 2272  c(..    #     "r
+00006be0: 636f 756e 7422 2c0d 0a20 2020 2023 2020  count",..    #  
+00006bf0: 2020 206c 616d 6264 6120 693a 206c 656e     lambda i: len
+00006c00: 280d 0a20 2020 2023 2020 2020 2020 2020  (..    #        
+00006c10: 206c 6973 7428 7365 6c66 2e66 6c61 7428   list(self.flat(
+00006c20: 7365 6c65 6374 6564 3d54 7275 652c 2063  selected=True, c
+00006c30: 6173 6361 6465 3d46 616c 7365 2c20 7479  ascade=False, ty
+00006c40: 7065 733d 2822 7265 6665 7265 6e63 6522  pes=("reference"
+00006c50: 2929 290d 0a20 2020 2023 2020 2020 2029  )))..    #     )
+00006c60: 2c0d 0a20 2020 2023 2029 0d0a 2020 2020  ,..    # )..    
+00006c70: 2320 4074 7265 655f 6361 6c63 280d 0a20  # @tree_calc(.. 
+00006c80: 2020 2023 2020 2020 2022 656c 6f63 222c     #     "eloc",
+00006c90: 0d0a 2020 2020 2320 2020 2020 6c61 6d62  ..    #     lamb
+00006ca0: 6461 2073 3a20 226f 7065 7261 7469 6f6e  da s: "operation
+00006cb0: 7322 0d0a 2020 2020 2320 2020 2020 6966  s"..    #     if
+00006cc0: 206c 656e 286c 6973 7428 7365 6c66 2e66   len(list(self.f
+00006cd0: 6c61 7428 7365 6c65 6374 6564 3d54 7275  lat(selected=Tru
+00006ce0: 652c 2063 6173 6361 6465 3d46 616c 7365  e, cascade=False
+00006cf0: 2c20 7479 7065 733d 6f70 6572 6174 655f  , types=operate_
+00006d00: 6e6f 6465 7329 2929 0d0a 2020 2020 2320  nodes)))..    # 
+00006d10: 2020 2020 3e20 300d 0a20 2020 2023 2020      > 0..    #  
+00006d20: 2020 2065 6c73 6520 2265 6c65 6d65 6e74     else "element
+00006d30: 2d6c 6973 7422 2c0d 0a20 2020 2023 2029  -list",..    # )
+00006d40: 0d0a 2020 2020 2320 4074 7265 655f 6f70  ..    # @tree_op
+00006d50: 6572 6174 696f 6e28 0d0a 2020 2020 2320  eration(..    # 
+00006d60: 2020 2020 5f28 2244 656c 6574 6520 2573      _("Delete %s
+00006d70: 2073 656c 6563 7465 6420 6974 656d 7320   selected items 
+00006d80: 6672 6f6d 2025 7320 2852 6566 3d25 7329  from %s (Ref=%s)
+00006d90: 2229 2025 2028 227b 6563 6f75 6e74 7d22  ") % ("{ecount}"
+00006da0: 2c20 227b 656c 6f63 7d22 2c20 227b 7263  , "{eloc}", "{rc
+00006db0: 6f75 6e74 7d22 292c 0d0a 2020 2020 2320  ount}"),..    # 
+00006dc0: 2020 2020 6e6f 6465 5f74 7970 653d 6e6f      node_type=no
+00006dd0: 6e5f 7374 7275 6374 7572 616c 5f6e 6f64  n_structural_nod
+00006de0: 6573 2c0d 0a20 2020 2023 2020 2020 2068  es,..    #     h
+00006df0: 656c 703d 2222 2c0d 0a20 2020 2023 2029  elp="",..    # )
+00006e00: 0d0a 2020 2020 2320 6465 6620 7265 6d6f  ..    # def remo
+00006e10: 7665 5f6d 756c 7469 5f6e 6f64 6573 286e  ve_multi_nodes(n
+00006e20: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
+00006e30: 0a20 2020 2023 2020 2020 2069 6620 280d  .    #     if (.
+00006e40: 0a20 2020 2023 2020 2020 2020 2020 206c  .    #         l
+00006e50: 656e 286c 6973 7428 7365 6c66 2e66 6c61  en(list(self.fla
+00006e60: 7428 7365 6c65 6374 6564 3d54 7275 652c  t(selected=True,
+00006e70: 2063 6173 6361 6465 3d46 616c 7365 2c20   cascade=False, 
+00006e80: 7479 7065 733d 6f70 6572 6174 655f 6e6f  types=operate_no
+00006e90: 6465 7329 2929 0d0a 2020 2020 2320 2020  des)))..    #   
+00006ea0: 2020 2020 2020 3e20 300d 0a20 2020 2023        > 0..    #
+00006eb0: 2020 2020 2029 3a0d 0a20 2020 2023 2020       ):..    #  
+00006ec0: 2020 2020 2020 2074 7970 6573 203d 206f         types = o
+00006ed0: 7065 7261 7465 5f6e 6f64 6573 0d0a 2020  perate_nodes..  
+00006ee0: 2020 2320 2020 2020 656c 7365 3a0d 0a20    #     else:.. 
+00006ef0: 2020 2023 2020 2020 2020 2020 2074 7970     #         typ
+00006f00: 6573 203d 2065 6c65 6d5f 6772 6f75 705f  es = elem_group_
+00006f10: 6e6f 6465 730d 0a20 2020 2023 2020 2020  nodes..    #    
+00006f20: 206e 6f64 6573 203d 206c 6973 7428 7365   nodes = list(se
+00006f30: 6c66 2e66 6c61 7428 7365 6c65 6374 6564  lf.flat(selected
+00006f40: 3d54 7275 652c 2063 6173 6361 6465 3d46  =True, cascade=F
+00006f50: 616c 7365 2c20 7479 7065 733d 7479 7065  alse, types=type
+00006f60: 7329 290d 0a20 2020 2023 2020 2020 2066  s))..    #     f
+00006f70: 6f72 206e 6f64 6520 696e 206e 6f64 6573  or node in nodes
+00006f80: 3a0d 0a20 2020 2023 2020 2020 2020 2020  :..    #        
+00006f90: 2023 2049 6620 7765 2061 7265 2073 656c   # If we are sel
+00006fa0: 6563 7469 6e67 2061 6e20 6f70 6572 6174  ecting an operat
+00006fb0: 696f 6e20 2f20 616e 2065 6c65 6d65 6e74  ion / an element
+00006fc0: 2077 6974 6869 6e20 616e 206f 7065 7261   within an opera
+00006fd0: 7469 6f6e 2c20 7468 656e 2069 740d 0a20  tion, then it.. 
+00006fe0: 2020 2023 2020 2020 2020 2020 2023 2061     #         # a
+00006ff0: 6c73 6f20 7365 6c65 6374 732f 656d 7068  lso selects/emph
+00007000: 6173 697a 6573 2074 6865 2063 6f6e 7461  asizes the conta
+00007010: 696e 6564 2065 6c65 6d65 6e74 7320 696e  ined elements in
+00007020: 2074 6865 2065 6c65 6d65 6e74 7320 6272   the elements br
+00007030: 616e 6368 2e2e 2e0d 0a20 2020 2023 2020  anch.....    #  
+00007040: 2020 2020 2020 2023 2053 6f20 626f 7468         # So both
+00007050: 2077 696c 6c20 6265 2064 656c 6574 6564   will be deleted
+00007060: 2e2e 2e0d 0a20 2020 2023 2020 2020 2020  .....    #      
+00007070: 2020 2023 2054 6f20 6369 7263 756d 7665     # To circumve
+00007080: 6e74 2074 6869 732c 2077 6520 696e 7175  nt this, we inqu
+00007090: 6972 6520 6f6e 6365 206d 6f72 6520 7468  ire once more th
+000070a0: 6520 7365 6c65 6374 6564 2073 7461 7475  e selected statu
+000070b0: 732e 2e2e 0d0a 2020 2020 2320 2020 2020  s.....    #     
+000070c0: 2020 2020 6966 206e 6f64 652e 7365 6c65      if node.sele
+000070d0: 6374 6564 3a0d 0a20 2020 2023 2020 2020  cted:..    #    
+000070e0: 2020 2020 2020 2020 2069 6620 6e6f 6465           if node
+000070f0: 2e70 6172 656e 7420 6973 206e 6f74 204e  .parent is not N
+00007100: 6f6e 653a 2020 2320 4d61 7920 6861 7665  one:  # May have
+00007110: 2061 6c72 6561 6479 2072 656d 6f76 6564   already removed
+00007120: 2e0d 0a20 2020 2023 2020 2020 2020 2020  ...    #        
+00007130: 2020 2020 2020 2020 206e 6f64 652e 7265           node.re
+00007140: 6d6f 7665 5f6e 6f64 6528 290d 0a20 2020  move_node()..   
+00007150: 2023 2020 2020 2073 656c 662e 7365 745f   #     self.set_
+00007160: 656d 7068 6173 6973 284e 6f6e 6529 0d0a  emphasis(None)..
+00007170: 0d0a 2020 2020 2320 3d3d 3d3d 3d3d 3d3d  ..    # ========
+00007180: 3d3d 0d0a 2020 2020 2320 5245 4d4f 5645  ==..    # REMOVE
+00007190: 2053 494e 474c 4520 2854 7265 6520 5365   SINGLE (Tree Se
+000071a0: 6c65 6374 6564 202d 2045 4c45 4d45 4e54  lected - ELEMENT
+000071b0: 290d 0a20 2020 2023 203d 3d3d 3d3d 3d3d  )..    # =======
+000071c0: 3d3d 3d0d 0a20 2020 2040 7472 6565 5f63  ===..    @tree_c
+000071d0: 6f6e 6469 7469 6f6e 616c 286c 616d 6264  onditional(lambd
+000071e0: 6120 6e6f 6465 3a20 6e6f 7420 6e6f 6465  a node: not node
+000071f0: 2e6c 6f63 6b29 0d0a 2020 2020 4074 7265  .lock)..    @tre
+00007200: 655f 636f 6e64 6974 696f 6e61 6c28 0d0a  e_conditional(..
+00007210: 2020 2020 2020 2020 6c61 6d62 6461 2063          lambda c
+00007220: 6f6e 643a 206c 656e 280d 0a20 2020 2020  ond: len(..     
+00007230: 2020 2020 2020 206c 6973 7428 7365 6c66         list(self
+00007240: 2e66 6c61 7428 7365 6c65 6374 6564 3d54  .flat(selected=T
+00007250: 7275 652c 2063 6173 6361 6465 3d46 616c  rue, cascade=Fal
+00007260: 7365 2c20 7479 7065 733d 656c 656d 5f6e  se, types=elem_n
+00007270: 6f64 6573 2929 0d0a 2020 2020 2020 2020  odes))..        
+00007280: 290d 0a20 2020 2020 2020 203d 3d20 310d  )..        == 1.
+00007290: 0a20 2020 2029 0d0a 2020 2020 4074 7265  .    )..    @tre
+000072a0: 655f 6f70 6572 6174 696f 6e28 0d0a 2020  e_operation(..  
+000072b0: 2020 2020 2020 5f28 2244 656c 6574 6520        _("Delete 
+000072c0: 656c 656d 656e 7420 277b 6e61 6d65 7d27  element '{name}'
+000072d0: 2066 756c 6c79 2229 2c0d 0a20 2020 2020   fully"),..     
+000072e0: 2020 206e 6f64 655f 7479 7065 3d65 6c65     node_type=ele
+000072f0: 6d5f 6e6f 6465 732c 0d0a 2020 2020 2020  m_nodes,..      
+00007300: 2020 6865 6c70 3d22 222c 0d0a 2020 2020    help="",..    
+00007310: 290d 0a20 2020 2064 6566 2072 656d 6f76  )..    def remov
+00007320: 655f 7479 7065 5f65 6c65 6d28 6e6f 6465  e_type_elem(node
+00007330: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+00007340: 2020 2020 2020 6966 2068 6173 6174 7472        if hasattr
+00007350: 286e 6f64 652c 2022 6c6f 636b 2229 2061  (node, "lock") a
+00007360: 6e64 206e 6f64 652e 6c6f 636b 3a0d 0a20  nd node.lock:.. 
+00007370: 2020 2020 2020 2020 2020 2070 6173 730d             pass.
+00007380: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+00007390: 2020 2020 2020 2020 2020 2020 6e6f 6465              node
+000073a0: 2e72 656d 6f76 655f 6e6f 6465 2829 0d0a  .remove_node()..
+000073b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000073c0: 2e73 6574 5f65 6d70 6861 7369 7328 4e6f  .set_emphasis(No
+000073d0: 6e65 290d 0a0d 0a20 2020 2040 7472 6565  ne)....    @tree
+000073e0: 5f63 6f6e 6469 7469 6f6e 616c 280d 0a20  _conditional(.. 
+000073f0: 2020 2020 2020 206c 616d 6264 6120 636f         lambda co
+00007400: 6e64 3a20 6c65 6e28 6c69 7374 2873 656c  nd: len(list(sel
+00007410: 662e 666c 6174 2873 656c 6563 7465 643d  f.flat(selected=
+00007420: 5472 7565 2c20 6361 7363 6164 653d 4661  True, cascade=Fa
+00007430: 6c73 652c 2074 7970 6573 3d6f 705f 6e6f  lse, types=op_no
+00007440: 6465 7329 2929 0d0a 2020 2020 2020 2020  des)))..        
+00007450: 3d3d 2031 0d0a 2020 2020 290d 0a20 2020  == 1..    )..   
+00007460: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
+00007470: 280d 0a20 2020 2020 2020 205f 2822 4465  (..        _("De
+00007480: 6c65 7465 206f 7065 7261 7469 6f6e 2027  lete operation '
+00007490: 7b6e 616d 657d 2720 6675 6c6c 7922 292c  {name}' fully"),
+000074a0: 0d0a 2020 2020 2020 2020 6e6f 6465 5f74  ..        node_t
+000074b0: 7970 653d 6f70 5f6e 6f64 6573 2c0d 0a20  ype=op_nodes,.. 
+000074c0: 2020 2020 2020 2068 656c 703d 2222 2c0d         help="",.
+000074d0: 0a20 2020 2029 0d0a 2020 2020 6465 6620  .    )..    def 
+000074e0: 7265 6d6f 7665 5f74 7970 655f 6f70 286e  remove_type_op(n
+000074f0: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
+00007500: 0a0d 0a20 2020 2020 2020 206e 6f64 652e  ...        node.
+00007510: 7265 6d6f 7665 5f6e 6f64 6528 290d 0a20  remove_node().. 
+00007520: 2020 2020 2020 2073 656c 662e 7365 745f         self.set_
+00007530: 656d 7068 6173 6973 284e 6f6e 6529 0d0a  emphasis(None)..
+00007540: 2020 2020 2020 2020 7365 6c66 2e73 6967          self.sig
+00007550: 6e61 6c28 226f 7065 7261 7469 6f6e 5f72  nal("operation_r
+00007560: 656d 6f76 6564 2229 0d0a 0d0a 2020 2020  emoved")....    
+00007570: 4074 7265 655f 636f 6e64 6974 696f 6e61  @tree_conditiona
+00007580: 6c28 0d0a 2020 2020 2020 2020 6c61 6d62  l(..        lamb
+00007590: 6461 2063 6f6e 643a 206c 656e 286c 6973  da cond: len(lis
+000075a0: 7428 7365 6c66 2e66 6c61 7428 7365 6c65  t(self.flat(sele
+000075b0: 6374 6564 3d54 7275 652c 2063 6173 6361  cted=True, casca
+000075c0: 6465 3d46 616c 7365 2c20 7479 7065 733d  de=False, types=
+000075d0: 2262 6c6f 6222 2929 290d 0a20 2020 2020  "blob")))..     
+000075e0: 2020 203d 3d20 310d 0a20 2020 2029 0d0a     == 1..    )..
+000075f0: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
+00007600: 696f 6e28 0d0a 2020 2020 2020 2020 5f28  ion(..        _(
+00007610: 2244 656c 6574 6520 626c 6f62 2027 7b6e  "Delete blob '{n
+00007620: 616d 657d 2720 6675 6c6c 7922 292c 0d0a  ame}' fully"),..
+00007630: 2020 2020 2020 2020 6e6f 6465 5f74 7970          node_typ
+00007640: 653d 2262 6c6f 6222 2c0d 0a20 2020 2020  e="blob",..     
+00007650: 2020 2068 656c 703d 2222 2c0d 0a20 2020     help="",..   
+00007660: 2029 0d0a 2020 2020 6465 6620 7265 6d6f   )..    def remo
+00007670: 7665 5f74 7970 655f 626c 6f62 286e 6f64  ve_type_blob(nod
+00007680: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
+00007690: 2020 2020 2020 206e 6f64 652e 7265 6d6f         node.remo
+000076a0: 7665 5f6e 6f64 6528 290d 0a20 2020 2020  ve_node()..     
+000076b0: 2020 2073 656c 662e 7365 745f 656d 7068     self.set_emph
+000076c0: 6173 6973 284e 6f6e 6529 0d0a 2020 2020  asis(None)..    
+000076d0: 2020 2020 7365 6c66 2e73 6967 6e61 6c28      self.signal(
+000076e0: 226f 7065 7261 7469 6f6e 5f72 656d 6f76  "operation_remov
+000076f0: 6564 2229 0d0a 0d0a 2020 2020 4074 7265  ed")....    @tre
+00007700: 655f 636f 6e64 6974 696f 6e61 6c28 0d0a  e_conditional(..
+00007710: 2020 2020 2020 2020 6c61 6d62 6461 2063          lambda c
+00007720: 6f6e 643a 206c 656e 286c 6973 7428 7365  ond: len(list(se
+00007730: 6c66 2e66 6c61 7428 7365 6c65 6374 6564  lf.flat(selected
+00007740: 3d54 7275 652c 2063 6173 6361 6465 3d46  =True, cascade=F
+00007750: 616c 7365 2c20 7479 7065 733d 6f70 5f6e  alse, types=op_n
+00007760: 6f64 6573 2929 290d 0a20 2020 2020 2020  odes)))..       
+00007770: 203e 2031 0d0a 2020 2020 290d 0a20 2020   > 1..    )..   
+00007780: 2040 7472 6565 5f63 616c 6328 0d0a 2020   @tree_calc(..  
+00007790: 2020 2020 2020 2265 636f 756e 7422 2c0d        "ecount",.
+000077a0: 0a20 2020 2020 2020 206c 616d 6264 6120  .        lambda 
+000077b0: 693a 206c 656e 286c 6973 7428 7365 6c66  i: len(list(self
+000077c0: 2e66 6c61 7428 7365 6c65 6374 6564 3d54  .flat(selected=T
+000077d0: 7275 652c 2063 6173 6361 6465 3d46 616c  rue, cascade=Fal
+000077e0: 7365 2c20 7479 7065 733d 6f70 5f6e 6f64  se, types=op_nod
+000077f0: 6573 2929 292c 0d0a 2020 2020 290d 0a20  es))),..    ).. 
+00007800: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
+00007810: 6f6e 280d 0a20 2020 2020 2020 205f 2822  on(..        _("
+00007820: 4465 6c65 7465 207b 6563 6f75 6e74 7d20  Delete {ecount} 
+00007830: 6f70 6572 6174 696f 6e73 2066 756c 6c79  operations fully
+00007840: 2229 2c0d 0a20 2020 2020 2020 206e 6f64  "),..        nod
+00007850: 655f 7479 7065 3d6f 705f 6e6f 6465 732c  e_type=op_nodes,
+00007860: 0d0a 2020 2020 2020 2020 6865 6c70 3d22  ..        help="
+00007870: 222c 0d0a 2020 2020 290d 0a20 2020 2064  ",..    )..    d
+00007880: 6566 2072 656d 6f76 655f 7479 7065 5f6f  ef remove_type_o
+00007890: 705f 6d75 6c74 6970 6c65 286e 6f64 652c  p_multiple(node,
+000078a0: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
+000078b0: 2020 2020 2066 6f72 206f 7020 696e 206c       for op in l
+000078c0: 6973 7428 7365 6c66 2e66 6c61 7428 7365  ist(self.flat(se
+000078d0: 6c65 6374 6564 3d54 7275 652c 2063 6173  lected=True, cas
+000078e0: 6361 6465 3d46 616c 7365 2c20 7479 7065  cade=False, type
+000078f0: 733d 6f70 5f6e 6f64 6573 2929 3a0d 0a20  s=op_nodes)):.. 
+00007900: 2020 2020 2020 2020 2020 206f 702e 7265             op.re
+00007910: 6d6f 7665 5f6e 6f64 6528 290d 0a20 2020  move_node()..   
+00007920: 2020 2020 2073 656c 662e 7365 745f 656d       self.set_em
+00007930: 7068 6173 6973 284e 6f6e 6529 0d0a 2020  phasis(None)..  
+00007940: 2020 2020 2020 7365 6c66 2e73 6967 6e61        self.signa
+00007950: 6c28 226f 7065 7261 7469 6f6e 5f72 656d  l("operation_rem
+00007960: 6f76 6564 2229 0d0a 0d0a 2020 2020 6465  oved")....    de
+00007970: 6620 636f 6e74 6169 6e73 5f6e 6f5f 6c6f  f contains_no_lo
+00007980: 636b 6564 5f69 7465 6d73 2829 3a0d 0a20  cked_items():.. 
+00007990: 2020 2020 2020 206e 6f6c 6f63 6b20 3d20         nolock = 
+000079a0: 5472 7565 0d0a 2020 2020 2020 2020 666f  True..        fo
+000079b0: 7220 6520 696e 206c 6973 7428 7365 6c66  r e in list(self
+000079c0: 2e66 6c61 7428 7365 6c65 6374 6564 3d54  .flat(selected=T
+000079d0: 7275 652c 2063 6173 6361 6465 3d54 7275  rue, cascade=Tru
+000079e0: 6529 293a 0d0a 2020 2020 2020 2020 2020  e)):..          
+000079f0: 2020 6966 2068 6173 6174 7472 2865 2c20    if hasattr(e, 
+00007a00: 226c 6f63 6b22 2920 616e 6420 652e 6c6f  "lock") and e.lo
+00007a10: 636b 3a0d 0a20 2020 2020 2020 2020 2020  ck:..           
+00007a20: 2020 2020 206e 6f6c 6f63 6b20 3d20 4661       nolock = Fa
+00007a30: 6c73 650d 0a20 2020 2020 2020 2020 2020  lse..           
+00007a40: 2020 2020 2062 7265 616b 0d0a 2020 2020       break..    
+00007a50: 2020 2020 7265 7475 726e 206e 6f6c 6f63      return noloc
+00007a60: 6b0d 0a0d 0a20 2020 2040 7472 6565 5f63  k....    @tree_c
+00007a70: 6f6e 6469 7469 6f6e 616c 286c 616d 6264  onditional(lambd
+00007a80: 6120 636f 6e64 3a20 636f 6e74 6169 6e73  a cond: contains
+00007a90: 5f6e 6f5f 6c6f 636b 6564 5f69 7465 6d73  _no_locked_items
+00007aa0: 2829 290d 0a20 2020 2040 7472 6565 5f63  ())..    @tree_c
+00007ab0: 6f6e 6469 7469 6f6e 616c 280d 0a20 2020  onditional(..   
+00007ac0: 2020 2020 206c 616d 6264 6120 636f 6e64       lambda cond
+00007ad0: 3a20 6c65 6e28 0d0a 2020 2020 2020 2020  : len(..        
+00007ae0: 2020 2020 6c69 7374 2873 656c 662e 666c      list(self.fl
+00007af0: 6174 2873 656c 6563 7465 643d 5472 7565  at(selected=True
+00007b00: 2c20 6361 7363 6164 653d 4661 6c73 652c  , cascade=False,
+00007b10: 2074 7970 6573 3d28 2266 696c 6522 2c20   types=("file", 
+00007b20: 2267 726f 7570 2229 2929 0d0a 2020 2020  "group")))..    
+00007b30: 2020 2020 290d 0a20 2020 2020 2020 203d      )..        =
+00007b40: 3d20 310d 0a20 2020 2029 0d0a 2020 2020  = 1..    )..    
+00007b50: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
+00007b60: 0d0a 2020 2020 2020 2020 5f28 2244 656c  ..        _("Del
+00007b70: 6574 6520 6772 6f75 7020 277b 6e61 6d65  ete group '{name
+00007b80: 7d27 2061 6e64 2061 6c6c 2069 7473 2063  }' and all its c
+00007b90: 6869 6c64 2d65 6c65 6d65 6e74 7320 6675  hild-elements fu
+00007ba0: 6c6c 7922 292c 0d0a 2020 2020 2020 2020  lly"),..        
+00007bb0: 6e6f 6465 5f74 7970 653d 2267 726f 7570  node_type="group
+00007bc0: 222c 0d0a 2020 2020 2020 2020 6865 6c70  ",..        help
+00007bd0: 3d22 222c 0d0a 2020 2020 290d 0a20 2020  ="",..    )..   
+00007be0: 2064 6566 2072 656d 6f76 655f 7479 7065   def remove_type
+00007bf0: 5f67 7270 286e 6f64 652c 202a 2a6b 7761  _grp(node, **kwa
+00007c00: 7267 7329 3a0d 0a20 2020 2020 2020 206e  rgs):..        n
+00007c10: 6f64 652e 7265 6d6f 7665 5f6e 6f64 6528  ode.remove_node(
+00007c20: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00007c30: 7365 745f 656d 7068 6173 6973 284e 6f6e  set_emphasis(Non
+00007c40: 6529 0d0a 0d0a 2020 2020 4074 7265 655f  e)....    @tree_
+00007c50: 636f 6e64 6974 696f 6e61 6c28 6c61 6d62  conditional(lamb
+00007c60: 6461 2063 6f6e 643a 2063 6f6e 7461 696e  da cond: contain
+00007c70: 735f 6e6f 5f6c 6f63 6b65 645f 6974 656d  s_no_locked_item
+00007c80: 7328 2929 0d0a 2020 2020 4074 7265 655f  s())..    @tree_
+00007c90: 636f 6e64 6974 696f 6e61 6c28 0d0a 2020  conditional(..  
+00007ca0: 2020 2020 2020 6c61 6d62 6461 2063 6f6e        lambda con
+00007cb0: 643a 206c 656e 280d 0a20 2020 2020 2020  d: len(..       
+00007cc0: 2020 2020 206c 6973 7428 7365 6c66 2e66       list(self.f
+00007cd0: 6c61 7428 7365 6c65 6374 6564 3d54 7275  lat(selected=Tru
+00007ce0: 652c 2063 6173 6361 6465 3d46 616c 7365  e, cascade=False
+00007cf0: 2c20 7479 7065 733d 2822 6669 6c65 222c  , types=("file",
+00007d00: 2022 6772 6f75 7022 2929 290d 0a20 2020   "group")))..   
+00007d10: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+00007d20: 3d3d 2031 0d0a 2020 2020 290d 0a20 2020  == 1..    )..   
+00007d30: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
+00007d40: 280d 0a20 2020 2020 2020 205f 2822 5265  (..        _("Re
+00007d50: 6d6f 7665 206c 6f61 6465 6420 6669 6c65  move loaded file
+00007d60: 2027 7b6e 616d 657d 2720 616e 6420 616c   '{name}' and al
+00007d70: 6c20 6974 7320 6368 696c 642d 656c 656d  l its child-elem
+00007d80: 656e 7473 2066 756c 6c79 2229 2c0d 0a20  ents fully"),.. 
+00007d90: 2020 2020 2020 206e 6f64 655f 7479 7065         node_type
+00007da0: 3d22 6669 6c65 222c 0d0a 2020 2020 2020  ="file",..      
+00007db0: 2020 6865 6c70 3d22 222c 0d0a 2020 2020    help="",..    
+00007dc0: 290d 0a20 2020 2064 6566 2072 656d 6f76  )..    def remov
+00007dd0: 655f 7479 7065 5f66 696c 6528 6e6f 6465  e_type_file(node
+00007de0: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+00007df0: 2020 2020 2020 6e6f 6465 2e72 656d 6f76        node.remov
+00007e00: 655f 6e6f 6465 2829 0d0a 2020 2020 2020  e_node()..      
+00007e10: 2020 7365 6c66 2e73 6574 5f65 6d70 6861    self.set_empha
+00007e20: 7369 7328 4e6f 6e65 290d 0a0d 0a20 2020  sis(None)....   
+00007e30: 2040 7472 6565 5f63 6f6e 6469 7469 6f6e   @tree_condition
+00007e40: 616c 286c 616d 6264 6120 6e6f 6465 3a20  al(lambda node: 
+00007e50: 6e6f 7420 6973 5f72 6567 6d61 726b 286e  not is_regmark(n
+00007e60: 6f64 6529 290d 0a20 2020 2040 7472 6565  ode))..    @tree
+00007e70: 5f6f 7065 7261 7469 6f6e 280d 0a20 2020  _operation(..   
+00007e80: 2020 2020 205f 2822 5265 6d6f 7665 2074       _("Remove t
+00007e90: 7261 6e73 7061 7265 6e74 206f 626a 6563  ransparent objec
+00007ea0: 7473 2229 2c0d 0a20 2020 2020 2020 206e  ts"),..        n
+00007eb0: 6f64 655f 7479 7065 3d28 2267 726f 7570  ode_type=("group
+00007ec0: 222c 2022 6669 6c65 2229 2c0d 0a20 2020  ", "file"),..   
+00007ed0: 2020 2020 2068 656c 703d 5f28 2252 656d       help=_("Rem
+00007ee0: 6f76 6520 616c 6c20 656c 656d 656e 7473  ove all elements
+00007ef0: 2074 6861 7420 6e65 6974 6865 7220 6861   that neither ha
+00007f00: 7665 2061 2062 6f72 6465 7220 6e6f 7220  ve a border nor 
+00007f10: 6120 6669 6c6c 2063 6f6c 6f72 2229 2c0d  a fill color"),.
+00007f20: 0a20 2020 2029 0d0a 2020 2020 6465 6620  .    )..    def 
+00007f30: 7265 6d6f 7665 5f74 7261 6e73 7061 7265  remove_transpare
+00007f40: 6e74 286e 6f64 652c 202a 2a6b 7761 7267  nt(node, **kwarg
+00007f50: 7329 3a0d 0a20 2020 2020 2020 2072 6573  s):..        res
+00007f60: 203d 2030 0d0a 2020 2020 2020 2020 746f   = 0..        to
+00007f70: 5f72 656d 6f76 6520 3d20 5b5d 0d0a 2020  _remove = []..  
+00007f80: 2020 2020 2020 666f 7220 656e 6f64 6520        for enode 
+00007f90: 696e 2073 656c 662e 666c 6174 280d 0a20  in self.flat(.. 
+00007fa0: 2020 2020 2020 2020 2020 2073 656c 6563             selec
+00007fb0: 7465 643d 5472 7565 2c0d 0a20 2020 2020  ted=True,..     
+00007fc0: 2020 2020 2020 2063 6173 6361 6465 3d54         cascade=T
+00007fd0: 7275 652c 0d0a 2020 2020 2020 2020 2020  rue,..          
+00007fe0: 2020 7479 7065 733d 280d 0a20 2020 2020    types=(..     
+00007ff0: 2020 2020 2020 2020 2020 2022 656c 656d             "elem
+00008000: 2072 6563 7422 2c0d 0a20 2020 2020 2020   rect",..       
+00008010: 2020 2020 2020 2020 2022 656c 656d 2065           "elem e
+00008020: 6c6c 6970 7365 222c 0d0a 2020 2020 2020  llipse",..      
+00008030: 2020 2020 2020 2020 2020 2265 6c65 6d20            "elem 
+00008040: 7061 7468 222c 0d0a 2020 2020 2020 2020  path",..        
+00008050: 2020 2020 2020 2020 2265 6c65 6d20 6c69          "elem li
+00008060: 6e65 222c 0d0a 2020 2020 2020 2020 2020  ne",..          
+00008070: 2020 2020 2020 2265 6c65 6d20 706f 6c79        "elem poly
+00008080: 6c69 6e65 222c 0d0a 2020 2020 2020 2020  line",..        
+00008090: 2020 2020 292c 0d0a 2020 2020 2020 2020      ),..        
+000080a0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+000080b0: 636f 6c6f 7265 6420 3d20 4661 6c73 650d  colored = False.
+000080c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000080d0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+000080e0: 2020 2068 6173 6174 7472 2865 6e6f 6465     hasattr(enode
+000080f0: 2c20 2266 696c 6c22 290d 0a20 2020 2020  , "fill")..     
+00008100: 2020 2020 2020 2020 2020 2061 6e64 2065             and e
+00008110: 6e6f 6465 2e66 696c 6c20 6973 206e 6f74  node.fill is not
+00008120: 204e 6f6e 650d 0a20 2020 2020 2020 2020   None..         
+00008130: 2020 2020 2020 2061 6e64 2065 6e6f 6465         and enode
+00008140: 2e66 696c 6c2e 6172 6762 2069 7320 6e6f  .fill.argb is no
+00008150: 7420 4e6f 6e65 0d0a 2020 2020 2020 2020  t None..        
+00008160: 2020 2020 293a 0d0a 2020 2020 2020 2020      ):..        
+00008170: 2020 2020 2020 2020 636f 6c6f 7265 6420          colored 
+00008180: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
+00008190: 2020 2020 6966 2028 0d0a 2020 2020 2020      if (..      
+000081a0: 2020 2020 2020 2020 2020 6861 7361 7474            hasatt
+000081b0: 7228 656e 6f64 652c 2022 7374 726f 6b65  r(enode, "stroke
+000081c0: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+000081d0: 2020 2020 616e 6420 656e 6f64 652e 7374      and enode.st
+000081e0: 726f 6b65 2069 7320 6e6f 7420 4e6f 6e65  roke is not None
+000081f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00008200: 2020 616e 6420 656e 6f64 652e 7374 726f    and enode.stro
+00008210: 6b65 2e61 7267 6220 6973 206e 6f74 204e  ke.argb is not N
+00008220: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
+00008230: 2029 3a0d 0a20 2020 2020 2020 2020 2020   ):..           
+00008240: 2020 2020 2063 6f6c 6f72 6564 203d 2054       colored = T
+00008250: 7275 650d 0a20 2020 2020 2020 2020 2020  rue..           
+00008260: 2069 6620 6e6f 7420 636f 6c6f 7265 643a   if not colored:
+00008270: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00008280: 2020 7265 7320 2b3d 2031 0d0a 2020 2020    res += 1..    
+00008290: 2020 2020 2020 2020 2020 2020 656e 6f64              enod
+000082a0: 652e 7265 6d6f 7665 5f6e 6f64 6528 290d  e.remove_node().
+000082b0: 0a0d 0a20 2020 2020 2020 2069 6620 7265  ...        if re
+000082c0: 7320 3e20 303a 0d0a 2020 2020 2020 2020  s > 0:..        
+000082d0: 2020 2020 7365 6c66 2e73 6967 6e61 6c28      self.signal(
+000082e0: 2272 6562 7569 6c64 5f74 7265 6522 290d  "rebuild_tree").
+000082f0: 0a0d 0a20 2020 2023 203d 3d3d 3d3d 3d3d  ...    # =======
+00008300: 3d3d 3d0d 0a20 2020 2023 2052 656d 6f76  ===..    # Remov
+00008310: 6520 4f70 6572 6174 696f 6e73 2028 4966  e Operations (If
+00008320: 204e 6f20 5472 6565 2053 656c 6563 7465   No Tree Selecte
+00008330: 6429 0d0a 2020 2020 2320 4e6f 7465 3a20  d)..    # Note: 
+00008340: 5468 6973 2063 6f64 6520 776f 756c 6420  This code would 
+00008350: 7261 7265 6c79 206d 6174 6368 2061 6e79  rarely match any
+00008360: 7468 696e 6720 7369 6e63 6520 7468 6520  thing since the 
+00008370: 7472 6565 2073 656c 6563 7465 6420 7769  tree selected wi
+00008380: 6c6c 2061 6c6d 6f73 7420 616c 7761 7973  ll almost always
+00008390: 2062 6520 7472 7565 2069 6620 7765 2068   be true if we h
+000083a0: 6176 650d 0a20 2020 2023 206d 6174 6368  ave..    # match
+000083b0: 2074 6869 7320 636f 6e64 6974 696f 6e61   this conditiona
+000083c0: 6c2e 2054 6865 2074 7265 652d 7365 6c65  l. The tree-sele
+000083d0: 6374 6564 2064 656c 6574 6520 6675 6e63  cted delete func
+000083e0: 7469 6f6e 7320 6172 6520 7375 7065 7269  tions are superi
+000083f0: 6f72 2e0d 0a20 2020 2023 203d 3d3d 3d3d  or...    # =====
+00008400: 3d3d 3d3d 3d0d 0a20 2020 2040 7472 6565  =====..    @tree
+00008410: 5f63 6f6e 6469 7469 6f6e 616c 280d 0a20  _conditional(.. 
+00008420: 2020 2020 2020 206c 616d 6264 6120 636f         lambda co
+00008430: 6e64 3a20 6c65 6e28 0d0a 2020 2020 2020  nd: len(..      
+00008440: 2020 2020 2020 6c69 7374 2873 656c 662e        list(self.
+00008450: 666c 6174 2873 656c 6563 7465 643d 5472  flat(selected=Tr
+00008460: 7565 2c20 6361 7363 6164 653d 4661 6c73  ue, cascade=Fals
+00008470: 652c 2074 7970 6573 3d6e 6f6e 5f73 7472  e, types=non_str
+00008480: 7563 7475 7261 6c5f 6e6f 6465 7329 290d  uctural_nodes)).
+00008490: 0a20 2020 2020 2020 2029 0d0a 2020 2020  .        )..    
+000084a0: 2020 2020 3d3d 2030 0d0a 2020 2020 290d      == 0..    ).
+000084b0: 0a20 2020 2040 7472 6565 5f63 6f6e 6469  .    @tree_condi
+000084c0: 7469 6f6e 616c 286c 616d 6264 6120 6e6f  tional(lambda no
+000084d0: 6465 3a20 6c65 6e28 6c69 7374 2873 656c  de: len(list(sel
+000084e0: 662e 6f70 7328 7365 6c65 6374 6564 3d54  f.ops(selected=T
+000084f0: 7275 6529 2929 203e 2031 290d 0a20 2020  rue))) > 1)..   
+00008500: 2040 7472 6565 5f63 616c 6328 2265 636f   @tree_calc("eco
+00008510: 756e 7422 2c20 6c61 6d62 6461 2069 3a20  unt", lambda i: 
+00008520: 6c65 6e28 6c69 7374 2873 656c 662e 6f70  len(list(self.op
+00008530: 7328 7365 6c65 6374 6564 3d54 7275 6529  s(selected=True)
+00008540: 2929 290d 0a20 2020 2040 7472 6565 5f6f  )))..    @tree_o
+00008550: 7065 7261 7469 6f6e 280d 0a20 2020 2020  peration(..     
+00008560: 2020 205f 2822 4465 6c65 7465 207b 6563     _("Delete {ec
+00008570: 6f75 6e74 7d20 6f70 6572 6174 696f 6e73  ount} operations
+00008580: 2229 2c0d 0a20 2020 2020 2020 206e 6f64  "),..        nod
+00008590: 655f 7479 7065 3d28 0d0a 2020 2020 2020  e_type=(..      
+000085a0: 2020 2020 2020 226f 7020 6375 7422 2c0d        "op cut",.
+000085b0: 0a20 2020 2020 2020 2020 2020 2022 6f70  .            "op
+000085c0: 2072 6173 7465 7222 2c0d 0a20 2020 2020   raster",..     
+000085d0: 2020 2020 2020 2022 6f70 2069 6d61 6765         "op image
+000085e0: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+000085f0: 226f 7020 656e 6772 6176 6522 2c0d 0a20  "op engrave",.. 
+00008600: 2020 2020 2020 2020 2020 2022 6f70 2064             "op d
+00008610: 6f74 7322 2c0d 0a20 2020 2020 2020 2020  ots",..         
+00008620: 2020 2022 6f70 2068 6174 6368 222c 0d0a     "op hatch",..
+00008630: 2020 2020 2020 2020 2020 2020 2275 7469              "uti
+00008640: 6c20 636f 6e73 6f6c 6522 2c0d 0a20 2020  l console",..   
+00008650: 2020 2020 2020 2020 2022 7574 696c 2077           "util w
+00008660: 6169 7422 2c0d 0a20 2020 2020 2020 2020  ait",..         
+00008670: 2020 2022 7574 696c 2068 6f6d 6522 2c0d     "util home",.
+00008680: 0a20 2020 2020 2020 2020 2020 2022 7574  .            "ut
+00008690: 696c 2067 6f74 6f22 2c0d 0a20 2020 2020  il goto",..     
+000086a0: 2020 2020 2020 2022 7574 696c 206f 7269         "util ori
+000086b0: 6769 6e22 2c0d 0a20 2020 2020 2020 2020  gin",..         
+000086c0: 2020 2022 7574 696c 206f 7574 7075 7422     "util output"
+000086d0: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
+000086e0: 7574 696c 2069 6e70 7574 222c 0d0a 2020  util input",..  
+000086f0: 2020 2020 2020 2020 2020 226c 6173 6572            "laser
+00008700: 636f 6465 222c 0d0a 2020 2020 2020 2020  code",..        
+00008710: 2020 2020 2263 7574 636f 6465 222c 0d0a      "cutcode",..
+00008720: 2020 2020 2020 2020 2020 2020 2262 6c6f              "blo
+00008730: 6222 2c0d 0a20 2020 2020 2020 2029 2c0d  b",..        ),.
+00008740: 0a20 2020 2020 2020 2068 656c 703d 2222  .        help=""
+00008750: 2c0d 0a20 2020 2029 0d0a 2020 2020 6465  ,..    )..    de
+00008760: 6620 7265 6d6f 7665 5f6e 5f6f 7073 286e  f remove_n_ops(n
+00008770: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
+00008780: 0a20 2020 2020 2020 2073 656c 6628 226f  .        self("o
+00008790: 7065 7261 7469 6f6e 2064 656c 6574 655c  peration delete\
+000087a0: 6e22 290d 0a0d 0a20 2020 2040 7472 6565  n")....    @tree
+000087b0: 5f6f 7065 7261 7469 6f6e 280d 0a20 2020  _operation(..   
+000087c0: 2020 2020 205f 2822 5365 6c65 6374 2061       _("Select a
+000087d0: 6c6c 2065 6c65 6d65 6e74 7320 6f66 2073  ll elements of s
+000087e0: 616d 6520 7479 7065 2229 2c0d 0a20 2020  ame type"),..   
+000087f0: 2020 2020 206e 6f64 655f 7479 7065 3d65       node_type=e
+00008800: 6c65 6d5f 6e6f 6465 732c 0d0a 2020 2020  lem_nodes,..    
+00008810: 2020 2020 6865 6c70 3d5f 2822 5365 6c65      help=_("Sele
+00008820: 6374 2061 6c6c 2065 6c65 6d65 6e74 7320  ct all elements 
+00008830: 696e 2073 6365 6e65 2c20 7468 6174 2068  in scene, that h
+00008840: 6176 6520 7468 6520 7361 6d65 2074 7970  ave the same typ
+00008850: 6520 6173 2074 6869 7320 6e6f 6465 2229  e as this node")
+00008860: 2c0d 0a20 2020 2029 0d0a 2020 2020 6465  ,..    )..    de
+00008870: 6620 7365 6c65 6374 5f73 696d 696c 6172  f select_similar
+00008880: 286e 6f64 652c 202a 2a6b 7761 7267 7329  (node, **kwargs)
+00008890: 3a0d 0a20 2020 2020 2020 206e 7479 7065  :..        ntype
+000088a0: 203d 206e 6f64 652e 7479 7065 0d0a 2020   = node.type..  
+000088b0: 2020 2020 2020 6368 616e 6765 7320 3d20        changes = 
+000088c0: 4661 6c73 650d 0a20 2020 2020 2020 2066  False..        f
+000088d0: 6f72 2065 2069 6e20 7365 6c66 2e65 6c65  or e in self.ele
+000088e0: 6d73 2829 3a0d 0a20 2020 2020 2020 2020  ms():..         
+000088f0: 2020 2069 6620 652e 7479 7065 203d 3d20     if e.type == 
+00008900: 6e74 7970 6520 616e 6420 6e6f 7420 652e  ntype and not e.
+00008910: 656d 7068 6173 697a 6564 3a0d 0a20 2020  emphasized:..   
+00008920: 2020 2020 2020 2020 2020 2020 2065 2e65               e.e
+00008930: 6d70 6861 7369 7a65 6420 3d20 5472 7565  mphasized = True
+00008940: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00008950: 2020 652e 7365 6c65 6374 6564 203d 2054    e.selected = T
+00008960: 7275 650d 0a20 2020 2020 2020 2020 2020  rue..           
+00008970: 2020 2020 2063 6861 6e67 6573 203d 2054       changes = T
+00008980: 7275 650d 0a20 2020 2020 2020 2069 6620  rue..        if 
+00008990: 6368 616e 6765 733a 0d0a 2020 2020 2020  changes:..      
+000089a0: 2020 2020 2020 7365 6c66 2e76 616c 6964        self.valid
+000089b0: 6174 655f 7365 6c65 6374 6564 5f61 7265  ate_selected_are
+000089c0: 6128 290d 0a20 2020 2020 2020 2020 2020  a()..           
+000089d0: 2073 656c 662e 7369 676e 616c 2822 7265   self.signal("re
+000089e0: 6672 6573 685f 7363 656e 6522 2c20 2253  fresh_scene", "S
+000089f0: 6365 6e65 2229 0d0a 0d0a 2020 2020 2320  cene")....    # 
+00008a00: 3d3d 3d3d 3d3d 3d3d 3d3d 0d0a 2020 2020  ==========..    
+00008a10: 2320 5245 4d4f 5645 2045 4c45 4d45 4e54  # REMOVE ELEMENT
+00008a20: 530d 0a20 2020 2023 203d 3d3d 3d3d 3d3d  S..    # =======
+00008a30: 3d3d 3d0d 0a20 2020 2023 204d 6f72 6520  ===..    # More 
+00008a40: 7468 616e 206f 6e65 2c20 7370 6563 6961  than one, specia
+00008a50: 6c20 6361 7365 203d 3d20 3120 616c 7265  l case == 1 alre
+00008a60: 6164 7920 6465 616c 7420 7769 7468 0d0a  ady dealt with..
+00008a70: 2020 2020 4074 7265 655f 636f 6e64 6974      @tree_condit
+00008a80: 696f 6e61 6c28 6c61 6d62 6461 206e 6f64  ional(lambda nod
+00008a90: 653a 206c 656e 286c 6973 7428 7365 6c66  e: len(list(self
+00008aa0: 2e65 6c65 6d73 2865 6d70 6861 7369 7a65  .elems(emphasize
+00008ab0: 643d 5472 7565 2929 2920 3e20 3129 0d0a  d=True))) > 1)..
+00008ac0: 2020 2020 4074 7265 655f 6361 6c63 2822      @tree_calc("
+00008ad0: 6563 6f75 6e74 222c 206c 616d 6264 6120  ecount", lambda 
+00008ae0: 693a 206c 656e 286c 6973 7428 7365 6c66  i: len(list(self
+00008af0: 2e65 6c65 6d73 2865 6d70 6861 7369 7a65  .elems(emphasize
+00008b00: 643d 5472 7565 2929 2929 0d0a 2020 2020  d=True))))..    
+00008b10: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
+00008b20: 0d0a 2020 2020 2020 2020 5f28 2244 656c  ..        _("Del
+00008b30: 6574 6520 7b65 636f 756e 747d 2065 6c65  ete {ecount} ele
+00008b40: 6d65 6e74 732c 2061 7320 7365 6c65 6374  ments, as select
+00008b50: 6564 2069 6e20 7363 656e 6522 292c 0d0a  ed in scene"),..
+00008b60: 2020 2020 2020 2020 6e6f 6465 5f74 7970          node_typ
+00008b70: 653d 656c 656d 5f67 726f 7570 5f6e 6f64  e=elem_group_nod
+00008b80: 6573 2c0d 0a20 2020 2020 2020 2068 656c  es,..        hel
+00008b90: 703d 2222 2c0d 0a20 2020 2029 0d0a 2020  p="",..    )..  
+00008ba0: 2020 6465 6620 7265 6d6f 7665 5f6e 5f65    def remove_n_e
+00008bb0: 6c65 6d65 6e74 7328 6e6f 6465 2c20 2a2a  lements(node, **
+00008bc0: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
+00008bd0: 2020 7365 6c66 2822 656c 656d 656e 7420    self("element 
+00008be0: 6465 6c65 7465 5c6e 2229 0d0a 0d0a 2020  delete\n")....  
+00008bf0: 2020 4074 7265 655f 636f 6e64 6974 696f    @tree_conditio
+00008c00: 6e61 6c28 0d0a 2020 2020 2020 2020 6c61  nal(..        la
+00008c10: 6d62 6461 206e 6f64 653a 2069 7369 6e73  mbda node: isins
+00008c20: 7461 6e63 6528 6e6f 6465 2e73 6861 7065  tance(node.shape
+00008c30: 2c20 506f 6c79 676f 6e29 2061 6e64 206c  , Polygon) and l
+00008c40: 656e 286e 6f64 652e 7368 6170 652e 706f  en(node.shape.po
+00008c50: 696e 7473 2920 3e3d 2033 0d0a 2020 2020  ints) >= 3..    
+00008c60: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
+00008c70: 7261 7469 6f6e 280d 0a20 2020 2020 2020  ration(..       
+00008c80: 205f 2822 4d61 6b65 2050 6f6c 7967 6f6e   _("Make Polygon
+00008c90: 2072 6567 756c 6172 2229 2c0d 0a20 2020   regular"),..   
+00008ca0: 2020 2020 206e 6f64 655f 7479 7065 3d22       node_type="
+00008cb0: 656c 656d 2070 6f6c 796c 696e 6522 2c0d  elem polyline",.
+00008cc0: 0a20 2020 2020 2020 2068 656c 703d 2222  .        help=""
+00008cd0: 2c0d 0a20 2020 2029 0d0a 2020 2020 6465  ,..    )..    de
+00008ce0: 6620 6d61 6b65 5f70 6f6c 7967 6f6e 5f72  f make_polygon_r
+00008cf0: 6567 756c 6172 286e 6f64 652c 202a 2a6b  egular(node, **k
+00008d00: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
+00008d10: 2023 2066 726f 6d20 2e75 6e69 7473 2069   # from .units i
+00008d20: 6d70 6f72 7420 4c65 6e67 7468 0d0a 2020  mport Length..  
+00008d30: 2020 2020 2020 2320 6672 6f6d 202e 2e73        # from ..s
+00008d40: 7667 656c 656d 656e 7473 2069 6d70 6f72  vgelements impor
+00008d50: 7420 436f 6c6f 720d 0a0d 0a20 2020 2020  t Color....     
+00008d60: 2020 2023 2064 6566 206d 6b5f 6465 6275     # def mk_debu
+00008d70: 675f 706f 696e 7428 782c 2079 2c20 636f  g_point(x, y, co
+00008d80: 6c29 3a0d 0a20 2020 2020 2020 2023 2020  l):..        #  
+00008d90: 2020 2063 6972 6320 3d20 456c 6c69 7073     circ = Ellips
+00008da0: 6528 6378 3d78 2c20 6379 3d79 2c20 723d  e(cx=x, cy=y, r=
+00008db0: 666c 6f61 7428 4c65 6e67 7468 2822 316d  float(Length("1m
+00008dc0: 6d22 2929 290d 0a20 2020 2020 2020 2023  m")))..        #
+00008dd0: 2020 2020 2063 6972 632e 7472 616e 7366       circ.transf
+00008de0: 6f72 6d20 3d20 636f 7079 286e 6f64 652e  orm = copy(node.
+00008df0: 7368 6170 652e 7472 616e 7366 6f72 6d29  shape.transform)
+00008e00: 0d0a 2020 2020 2020 2020 2320 2020 2020  ..        #     
+00008e10: 7365 6c66 2e65 6c65 6d5f 6272 616e 6368  self.elem_branch
+00008e20: 2e61 6464 280d 0a20 2020 2020 2020 2023  .add(..        #
+00008e30: 2020 2020 2020 2020 2073 6861 7065 3d63           shape=c
+00008e40: 6972 632c 0d0a 2020 2020 2020 2020 2320  irc,..        # 
+00008e50: 2020 2020 2020 2020 7479 7065 3d22 656c          type="el
+00008e60: 656d 2065 6c6c 6970 7365 222c 0d0a 2020  em ellipse",..  
+00008e70: 2020 2020 2020 2320 2020 2020 2020 2020        #         
+00008e80: 7374 726f 6b65 3d43 6f6c 6f72 2863 6f6c  stroke=Color(col
+00008e90: 292c 0d0a 2020 2020 2020 2020 2320 2020  ),..        #   
+00008ea0: 2020 2020 2020 6669 6c6c 3d43 6f6c 6f72        fill=Color
+00008eb0: 2863 6f6c 292c 0d0a 2020 2020 2020 2020  (col),..        
+00008ec0: 2320 2020 2020 2020 2020 6d61 7472 6978  #         matrix
+00008ed0: 3d63 6f70 7928 6e6f 6465 2e6d 6174 7269  =copy(node.matri
+00008ee0: 7829 2c0d 0a20 2020 2020 2020 2023 2020  x),..        #  
+00008ef0: 2020 2029 0d0a 0d0a 2020 2020 2020 2020     )....        
+00008f00: 6966 206e 6f64 6520 6973 204e 6f6e 6520  if node is None 
+00008f10: 6f72 206e 6f64 652e 7479 7065 2021 3d20  or node.type != 
+00008f20: 2265 6c65 6d20 706f 6c79 6c69 6e65 223a  "elem polyline":
+00008f30: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00008f40: 7475 726e 0d0a 2020 2020 2020 2020 6e75  turn..        nu
+00008f50: 6d62 6572 5f70 6f69 6e74 7320 3d20 6c65  mber_points = le
+00008f60: 6e28 6e6f 6465 2e73 6861 7065 2e70 6f69  n(node.shape.poi
+00008f70: 6e74 7329 0d0a 2020 2020 2020 2020 2320  nts)..        # 
+00008f80: 7072 696e 7420 2866 224e 756d 6265 7220  print (f"Number 
+00008f90: 6f66 2070 6f69 6e74 733a 207b 6e75 6d62  of points: {numb
+00008fa0: 6572 5f70 6f69 6e74 737d 2229 0d0a 2020  er_points}")..  
+00008fb0: 2020 2020 2020 2320 666f 7220 7072 6f70        # for prop
+00008fc0: 2069 6e20 6469 7228 6e6f 6465 293a 0d0a   in dir(node):..
+00008fd0: 2020 2020 2020 2020 2320 2020 2020 7072          #     pr
+00008fe0: 696e 7420 2866 227b 7072 6f70 7d20 2d20  int (f"{prop} - 
+00008ff0: 7b67 6574 6174 7472 286e 6f64 652c 2027  {getattr(node, '
+00009000: 7072 6f70 272c 2027 2729 7d22 290d 0a20  prop', '')}").. 
+00009010: 2020 2020 2020 2023 2066 6f72 2069 6478         # for idx
+00009020: 2c20 7074 2069 6e20 656e 756d 6572 6174  , pt in enumerat
+00009030: 6528 6e6f 6465 2e73 6861 7065 2e70 6f69  e(node.shape.poi
+00009040: 6e74 7329 3a0d 0a20 2020 2020 2020 2023  nts):..        #
+00009050: 2020 2020 2070 7269 6e74 2028 6622 7b69       print (f"{i
+00009060: 6478 7d3a 207b 7074 2e78 3a2e 3166 7d2c  dx}: {pt.x:.1f},
+00009070: 207b 7074 2e79 3a2e 3166 7d22 290d 0a20   {pt.y:.1f}").. 
+00009080: 2020 2020 2020 2069 6620 6e75 6d62 6572         if number
+00009090: 5f70 6f69 6e74 7320 3c20 3320 6f72 206e  _points < 3 or n
+000090a0: 6f74 2069 7369 6e73 7461 6e63 6528 6e6f  ot isinstance(no
+000090b0: 6465 2e73 6861 7065 2c20 506f 6c79 676f  de.shape, Polygo
+000090c0: 6e29 3a0d 0a20 2020 2020 2020 2020 2020  n):..           
+000090d0: 2072 6574 7572 6e0d 0a20 2020 2020 2020   return..       
+000090e0: 2070 7473 203d 206e 6f64 652e 7368 6170   pts = node.shap
+000090f0: 652e 706f 696e 7473 0d0a 2020 2020 2020  e.points..      
+00009100: 2020 6478 203d 2070 7473 5b31 5d2e 7820    dx = pts[1].x 
+00009110: 2d20 7074 735b 305d 2e78 0d0a 2020 2020  - pts[0].x..    
+00009120: 2020 2020 6479 203d 2070 7473 5b31 5d2e      dy = pts[1].
+00009130: 7920 2d20 7074 735b 305d 2e79 0d0a 2020  y - pts[0].y..  
+00009140: 2020 2020 2020 6261 7365 6c69 6e65 203d        baseline =
+00009150: 206d 6174 682e 7371 7274 2864 7820 2a20   math.sqrt(dx * 
+00009160: 6478 202b 2064 7920 2a20 6479 290d 0a20  dx + dy * dy).. 
+00009170: 2020 2020 2020 2061 706f 7468 656d 203d         apothem =
+00009180: 2062 6173 656c 696e 6520 2f20 2832 202a   baseline / (2 *
+00009190: 206d 6174 682e 7461 6e28 6d61 7468 2e74   math.tan(math.t
+000091a0: 6175 202f 2028 3220 2a20 6e75 6d62 6572  au / (2 * number
+000091b0: 5f70 6f69 6e74 7329 2929 0d0a 2020 2020  _points)))..    
+000091c0: 2020 2020 6369 7263 756d 7261 6469 7573      circumradius
+000091d0: 203d 2062 6173 656c 696e 6520 2f20 2832   = baseline / (2
+000091e0: 202a 206d 6174 682e 7369 6e28 6d61 7468   * math.sin(math
+000091f0: 2e74 6175 202f 2028 3220 2a20 6e75 6d62  .tau / (2 * numb
+00009200: 6572 5f70 6f69 6e74 7329 2929 0d0a 2020  er_points)))..  
+00009210: 2020 2020 2020 6d69 6470 6f69 6e74 203d        midpoint =
+00009220: 2050 6f69 6e74 2870 7473 5b30 5d2e 7820   Point(pts[0].x 
+00009230: 2b20 302e 3520 2a20 6478 2c20 7074 735b  + 0.5 * dx, pts[
+00009240: 305d 2e79 202b 2030 2e35 202a 2064 7929  0].y + 0.5 * dy)
+00009250: 0d0a 2020 2020 2020 2020 2320 206d 6b5f  ..        #  mk_
+00009260: 6465 6275 675f 706f 696e 7428 6d69 6470  debug_point(midp
+00009270: 6f69 6e74 2e78 2c20 6d69 6470 6f69 6e74  oint.x, midpoint
+00009280: 2e79 2c20 2262 6c61 636b 2229 0d0a 2020  .y, "black")..  
+00009290: 2020 2020 2020 6178 203d 2030 0d0a 2020        ax = 0..  
+000092a0: 2020 2020 2020 6179 203d 2030 0d0a 2020        ay = 0..  
+000092b0: 2020 2020 2020 666f 7220 6964 782c 2070        for idx, p
+000092c0: 7420 696e 2065 6e75 6d65 7261 7465 2870  t in enumerate(p
+000092d0: 7473 293a 0d0a 2020 2020 2020 2020 2020  ts):..          
+000092e0: 2020 6178 202b 3d20 7074 2e78 0d0a 2020    ax += pt.x..  
+000092f0: 2020 2020 2020 2020 2020 6179 202b 3d20            ay += 
+00009300: 7074 2e79 0d0a 2020 2020 2020 2020 6178  pt.y..        ax
+00009310: 202f 3d20 6e75 6d62 6572 5f70 6f69 6e74   /= number_point
+00009320: 730d 0a20 2020 2020 2020 2061 7920 2f3d  s..        ay /=
+00009330: 206e 756d 6265 725f 706f 696e 7473 0d0a   number_points..
+00009340: 2020 2020 2020 2020 2320 5468 6520 6172          # The ar
+00009350: 6974 686d 6574 6963 2063 656e 7465 7220  ithmetic center 
+00009360: 2861 782c 2061 7929 2069 6e64 6963 6174  (ax, ay) indicat
+00009370: 6573 2074 6f20 7768 6963 680d 0a20 2020  es to which..   
+00009380: 2020 2020 2023 2027 7369 6465 2720 6f66       # 'side' of
+00009390: 2074 6865 2062 6173 656c 696e 6520 7468   the baseline th
+000093a0: 6520 706f 6c79 676f 6e20 6e65 6564 7320  e polygon needs 
+000093b0: 746f 2062 6520 636f 6e73 7472 7563 7465  to be constructe
+000093c0: 640d 0a20 2020 2020 2020 2061 7269 7468  d..        arith
+000093d0: 6d65 7469 635f 6365 6e74 6572 203d 2050  metic_center = P
+000093e0: 6f69 6e74 2861 782c 2061 7929 0d0a 2020  oint(ax, ay)..  
+000093f0: 2020 2020 2020 2320 6d6b 5f64 6562 7567        # mk_debug
+00009400: 5f70 6f69 6e74 2861 782c 2061 792c 2022  _point(ax, ay, "
+00009410: 6772 6565 6e22 290d 0a20 2020 2020 2020  green")..       
+00009420: 2061 6e67 6c65 203d 2070 7473 5b30 5d2e   angle = pts[0].
+00009430: 616e 676c 655f 746f 2870 7473 5b31 5d29  angle_to(pts[1])
+00009440: 0d0a 2020 2020 2020 2020 6d69 6461 6e67  ..        midang
+00009450: 6c65 203d 206d 6964 706f 696e 742e 616e  le = midpoint.an
+00009460: 676c 655f 746f 2861 7269 7468 6d65 7469  gle_to(arithmeti
+00009470: 635f 6365 6e74 6572 290d 0a20 2020 2020  c_center)..     
+00009480: 2020 2061 6e67 6c65 202b 3d20 6d61 7468     angle += math
+00009490: 2e74 6175 202f 2034 0d0a 2020 2020 2020  .tau / 4..      
+000094a0: 2020 6669 7273 745f 706f 696e 7420 3d20    first_point = 
+000094b0: 506f 696e 742e 706f 6c61 7228 6d69 6470  Point.polar(midp
+000094c0: 6f69 6e74 2c20 616e 676c 652c 2061 706f  oint, angle, apo
+000094d0: 7468 656d 290d 0a20 2020 2020 2020 2073  them)..        s
+000094e0: 6563 6f6e 645f 706f 696e 7420 3d20 506f  econd_point = Po
+000094f0: 696e 742e 706f 6c61 7228 6d69 6470 6f69  int.polar(midpoi
+00009500: 6e74 2c20 616e 676c 6520 2b20 6d61 7468  nt, angle + math
+00009510: 2e74 6175 202f 2032 2c20 6170 6f74 6865  .tau / 2, apothe
+00009520: 6d29 0d0a 2020 2020 2020 2020 2320 6d6b  m)..        # mk
+00009530: 5f64 6562 7567 5f70 6f69 6e74 2866 6972  _debug_point(fir
+00009540: 7374 5f70 6f69 6e74 2e78 2c20 6669 7273  st_point.x, firs
+00009550: 745f 706f 696e 742e 792c 2022 7965 6c6c  t_point.y, "yell
+00009560: 6f77 2229 0d0a 2020 2020 2020 2020 2320  ow")..        # 
+00009570: 6d6b 5f64 6562 7567 5f70 6f69 6e74 2873  mk_debug_point(s
+00009580: 6563 6f6e 645f 706f 696e 742e 782c 2073  econd_point.x, s
+00009590: 6563 6f6e 645f 706f 696e 742e 792c 2022  econd_point.y, "
+000095a0: 6379 616e 2229 0d0a 2020 2020 2020 2020  cyan")..        
+000095b0: 6465 6c74 6161 6e67 6c65 203d 206d 6174  deltaangle = mat
+000095c0: 682e 7461 7520 2f20 6e75 6d62 6572 5f70  h.tau / number_p
+000095d0: 6f69 6e74 730d 0a20 2020 2020 2020 2064  oints..        d
+000095e0: 3120 3d20 6172 6974 686d 6574 6963 5f63  1 = arithmetic_c
+000095f0: 656e 7465 722e 6469 7374 616e 6365 5f74  enter.distance_t
+00009600: 6f28 6669 7273 745f 706f 696e 7429 0d0a  o(first_point)..
+00009610: 2020 2020 2020 2020 6432 203d 2061 7269          d2 = ari
+00009620: 7468 6d65 7469 635f 6365 6e74 6572 2e64  thmetic_center.d
+00009630: 6973 7461 6e63 655f 746f 2873 6563 6f6e  istance_to(secon
+00009640: 645f 706f 696e 7429 0d0a 2020 2020 2020  d_point)..      
+00009650: 2020 6966 2064 3120 3c20 6432 3a0d 0a20    if d1 < d2:.. 
+00009660: 2020 2020 2020 2020 2020 2063 656e 7465             cente
+00009670: 725f 706f 696e 7420 3d20 636f 7079 2866  r_point = copy(f
+00009680: 6972 7374 5f70 6f69 6e74 290d 0a20 2020  irst_point)..   
+00009690: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+000096a0: 2020 2020 2020 2020 6365 6e74 6572 5f70          center_p
+000096b0: 6f69 6e74 203d 2063 6f70 7928 7365 636f  oint = copy(seco
+000096c0: 6e64 5f70 6f69 6e74 290d 0a20 2020 2020  nd_point)..     
+000096d0: 2020 2023 206d 6b5f 6465 6275 675f 706f     # mk_debug_po
+000096e0: 696e 7428 6365 6e74 6572 5f70 6f69 6e74  int(center_point
+000096f0: 2e78 2c20 6365 6e74 6572 5f70 6f69 6e74  .x, center_point
+00009700: 2e79 2c20 2272 6564 2229 0d0a 0d0a 2020  .y, "red")....  
+00009710: 2020 2020 2020 6966 2063 656e 7465 725f        if center_
+00009720: 706f 696e 742e 616e 676c 655f 746f 2870  point.angle_to(p
+00009730: 7473 5b30 5d29 203e 2063 656e 7465 725f  ts[0]) > center_
+00009740: 706f 696e 742e 616e 676c 655f 746f 2870  point.angle_to(p
+00009750: 7473 5b31 5d29 3a0d 0a20 2020 2020 2020  ts[1]):..       
+00009760: 2020 2020 2064 656c 7461 616e 676c 6520       deltaangle 
+00009770: 2a3d 202d 310d 0a20 2020 2020 2020 2061  *= -1..        a
+00009780: 6e67 6c65 203d 2063 656e 7465 725f 706f  ngle = center_po
+00009790: 696e 742e 616e 676c 655f 746f 2870 7473  int.angle_to(pts
+000097a0: 5b30 5d29 0d0a 2020 2020 2020 2020 666f  [0])..        fo
+000097b0: 7220 6964 7820 696e 2072 616e 6765 286e  r idx in range(n
+000097c0: 756d 6265 725f 706f 696e 7473 293a 0d0a  umber_points):..
+000097d0: 2020 2020 2020 2020 2020 2020 2320 6966              # if
+000097e0: 2069 6478 203e 2031 3a0d 0a20 2020 2020   idx > 1:..     
+000097f0: 2020 2020 2020 2070 7420 3d20 506f 696e         pt = Poin
+00009800: 742e 706f 6c61 7228 6365 6e74 6572 5f70  t.polar(center_p
+00009810: 6f69 6e74 2c20 616e 676c 652c 2063 6972  oint, angle, cir
+00009820: 6375 6d72 6164 6975 7329 0d0a 2020 2020  cumradius)..    
+00009830: 2020 2020 2020 2020 7074 735b 6964 785d          pts[idx]
+00009840: 2e78 203d 2070 742e 780d 0a20 2020 2020  .x = pt.x..     
+00009850: 2020 2020 2020 2070 7473 5b69 6478 5d2e         pts[idx].
+00009860: 7920 3d20 7074 2e79 0d0a 2020 2020 2020  y = pt.y..      
+00009870: 2020 2020 2020 616e 676c 6520 2b3d 2064        angle += d
+00009880: 656c 7461 616e 676c 650d 0a20 2020 2020  eltaangle..     
+00009890: 2020 206e 6f64 652e 616c 7465 7265 6428     node.altered(
+000098a0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+000098b0: 7369 676e 616c 2822 7265 6672 6573 685f  signal("refresh_
+000098c0: 7363 656e 6522 2c20 2253 6365 6e65 2229  scene", "Scene")
+000098d0: 0d0a 0d0a 2020 2020 2320 3d3d 3d3d 3d3d  ....    # ======
+000098e0: 3d3d 3d3d 0d0a 2020 2020 2320 434f 4e56  ====..    # CONV
+000098f0: 4552 5420 5452 4545 204f 5045 5241 5449  ERT TREE OPERATI
+00009900: 4f4e 530d 0a20 2020 2023 203d 3d3d 3d3d  ONS..    # =====
+00009910: 3d3d 3d3d 3d0d 0a20 2020 2040 7472 6565  =====..    @tree
+00009920: 5f6f 7065 7261 7469 6f6e 280d 0a20 2020  _operation(..   
+00009930: 2020 2020 205f 2822 436f 6e76 6572 7420       _("Convert 
+00009940: 746f 2043 7574 636f 6465 2229 2c0d 0a20  to Cutcode"),.. 
+00009950: 2020 2020 2020 206e 6f64 655f 7479 7065         node_type
+00009960: 3d22 6c61 7365 7263 6f64 6522 2c0d 0a20  ="lasercode",.. 
+00009970: 2020 2020 2020 2068 656c 703d 2222 2c0d         help="",.
+00009980: 0a20 2020 2029 0d0a 2020 2020 6465 6620  .    )..    def 
+00009990: 6c61 7365 7263 6f64 6532 6375 7428 6e6f  lasercode2cut(no
+000099a0: 6465 2c20 2a2a 6b77 6172 6773 293a 0d0a  de, **kwargs):..
+000099b0: 2020 2020 2020 2020 6e6f 6465 2e72 6570          node.rep
+000099c0: 6c61 6365 5f6e 6f64 6528 4375 7443 6f64  lace_node(CutCod
+000099d0: 652e 6672 6f6d 5f6c 6173 6572 636f 6465  e.from_lasercode
+000099e0: 286e 6f64 652e 636f 6d6d 616e 6473 292c  (node.commands),
+000099f0: 2074 7970 653d 2263 7574 636f 6465 2229   type="cutcode")
+00009a00: 0d0a 0d0a 2020 2020 4074 7265 655f 636f  ....    @tree_co
+00009a10: 6e64 6974 696f 6e61 6c5f 7472 7928 0d0a  nditional_try(..
+00009a20: 2020 2020 2020 2020 6c61 6d62 6461 206e          lambda n
+00009a30: 6f64 653a 206b 6572 6e65 6c2e 6c6f 6f6b  ode: kernel.look
+00009a40: 7570 2866 2273 706f 6f6c 6572 6a6f 622f  up(f"spoolerjob/
+00009a50: 7b6e 6f64 652e 6461 7461 5f74 7970 657d  {node.data_type}
+00009a60: 2229 2069 7320 6e6f 7420 4e6f 6e65 0d0a  ") is not None..
+00009a70: 2020 2020 290d 0a20 2020 2040 7472 6565      )..    @tree
+00009a80: 5f6f 7065 7261 7469 6f6e 280d 0a20 2020  _operation(..   
+00009a90: 2020 2020 205f 2822 436f 6e76 6572 7420       _("Convert 
+00009aa0: 746f 2045 6c65 6d65 6e74 7322 292c 0d0a  to Elements"),..
+00009ab0: 2020 2020 2020 2020 6e6f 6465 5f74 7970          node_typ
+00009ac0: 653d 2262 6c6f 6222 2c0d 0a20 2020 2020  e="blob",..     
+00009ad0: 2020 2068 656c 703d 5f28 2243 6f6e 7665     help=_("Conve
+00009ae0: 7274 2061 7474 6163 6865 6420 6269 6e61  rt attached bina
+00009af0: 7279 206f 626a 6563 7420 746f 2065 6c65  ry object to ele
+00009b00: 6d65 6e74 7322 292c 0d0a 2020 2020 290d  ments"),..    ).
+00009b10: 0a20 2020 2064 6566 2062 6c6f 6232 7061  .    def blob2pa
+00009b20: 7468 286e 6f64 652c 202a 2a6b 7761 7267  th(node, **kwarg
+00009b30: 7329 3a0d 0a20 2020 2020 2020 2063 616e  s):..        can
+00009b40: 6365 6c6c 6564 203d 2046 616c 7365 0d0a  celled = False..
+00009b50: 2020 2020 2020 2020 6672 6f6d 206d 6565          from mee
+00009b60: 726b 3430 742e 746f 6f6c 732e 6472 6976  rk40t.tools.driv
+00009b70: 6572 5f74 6f5f 7061 7468 2069 6d70 6f72  er_to_path impor
+00009b80: 7420 4472 6976 6572 546f 5061 7468 0d0a  t DriverToPath..
+00009b90: 0d0a 2020 2020 2020 2020 6432 7020 3d20  ..        d2p = 
+00009ba0: 4472 6976 6572 546f 5061 7468 2829 0d0a  DriverToPath()..
+00009bb0: 2020 2020 2020 2020 6469 616c 6f67 5f63          dialog_c
+00009bc0: 6c61 7373 203d 206b 6572 6e65 6c2e 6c6f  lass = kernel.lo
+00009bd0: 6f6b 7570 2822 6469 616c 6f67 2f6f 7074  okup("dialog/opt
+00009be0: 696f 6e73 2229 0d0a 2020 2020 2020 2020  ions")..        
+00009bf0: 6966 2064 6961 6c6f 675f 636c 6173 7320  if dialog_class 
+00009c00: 616e 6420 6861 7361 7474 7228 6432 702c  and hasattr(d2p,
+00009c10: 2022 6f70 7469 6f6e 7322 293a 0d0a 2020   "options"):..  
+00009c20: 2020 2020 2020 2020 2020 6368 6f69 6365            choice
+00009c30: 7320 3d20 6765 7461 7474 7228 6432 702c  s = getattr(d2p,
+00009c40: 2022 6f70 7469 6f6e 7322 2c20 4e6f 6e65   "options", None
+00009c50: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+00009c60: 6620 6368 6f69 6365 7320 6973 206e 6f74  f choices is not
+00009c70: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00009c80: 2020 2020 2020 2020 666f 7220 656e 7472          for entr
+00009c90: 7920 696e 2063 686f 6963 6573 3a0d 0a20  y in choices:.. 
+00009ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009cb0: 2020 2069 6620 226c 6162 656c 2220 696e     if "label" in
+00009cc0: 2065 6e74 7279 3a0d 0a20 2020 2020 2020   entry:..       
+00009cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009ce0: 2065 6e74 7279 5b22 6c61 6265 6c22 5d20   entry["label"] 
+00009cf0: 3d20 5f28 656e 7472 795b 226c 6162 656c  = _(entry["label
+00009d00: 225d 290d 0a20 2020 2020 2020 2020 2020  "])..           
+00009d10: 2020 2020 2020 2020 2069 6620 2274 6970           if "tip
+00009d20: 2220 696e 2065 6e74 7279 3a0d 0a20 2020  " in entry:..   
+00009d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009d40: 2020 2020 2065 6e74 7279 5b22 7469 7022       entry["tip"
+00009d50: 5d20 3d20 5f28 656e 7472 795b 2274 6970  ] = _(entry["tip
+00009d60: 225d 290d 0a20 2020 2020 2020 2020 2020  "])..           
+00009d70: 2020 2020 2020 2020 2069 6620 2264 6973           if "dis
+00009d80: 706c 6179 2220 696e 2065 6e74 7279 3a0d  play" in entry:.
+00009d90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009da0: 2020 2020 2020 2020 206e 6577 6469 7370           newdisp
+00009db0: 6c61 7920 3d20 5b5d 0d0a 2020 2020 2020  lay = []..      
+00009dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009dd0: 2020 666f 7220 6465 6e74 7279 2069 6e20    for dentry in 
+00009de0: 656e 7472 795b 2264 6973 706c 6179 225d  entry["display"]
+00009df0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00009e00: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00009e10: 6577 6469 7370 6c61 792e 6170 7065 6e64  ewdisplay.append
+00009e20: 285f 2864 656e 7472 7929 290d 0a20 2020  (_(dentry))..   
+00009e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009e40: 2020 2020 2065 6e74 7279 5b22 6469 7370       entry["disp
+00009e50: 6c61 7922 5d20 3d20 6e65 7764 6973 706c  lay"] = newdispl
+00009e60: 6179 0d0a 2020 2020 2020 2020 2020 2020  ay..            
+00009e70: 2020 2020 6469 616c 6f67 203d 2064 6961      dialog = dia
+00009e80: 6c6f 675f 636c 6173 7328 7365 6c66 2e6b  log_class(self.k
+00009e90: 6572 6e65 6c2c 2063 686f 6963 6573 3d63  ernel, choices=c
+00009ea0: 686f 6963 6573 290d 0a20 2020 2020 2020  hoices)..       
+00009eb0: 2020 2020 2020 2020 2072 6573 203d 2064           res = d
+00009ec0: 6961 6c6f 672e 6469 616c 6f67 5f6f 7074  ialog.dialog_opt
+00009ed0: 696f 6e73 280d 0a20 2020 2020 2020 2020  ions(..         
+00009ee0: 2020 2020 2020 2020 2020 2074 6974 6c65             title
+00009ef0: 3d5f 2822 426c 6f62 2d43 6f6e 7665 7273  =_("Blob-Convers
+00009f00: 696f 6e22 292c 0d0a 2020 2020 2020 2020  ion"),..        
+00009f10: 2020 2020 2020 2020 2020 2020 696e 7472              intr
+00009f20: 6f3d 5f28 0d0a 2020 2020 2020 2020 2020  o=_(..          
+00009f30: 2020 2020 2020 2020 2020 2020 2020 2259                "Y
+00009f40: 6f75 2063 616e 2069 6e66 6c75 656e 6365  ou can influence
+00009f50: 2074 6865 2077 6179 204d 4b20 7769 6c6c   the way MK will
+00009f60: 2070 726f 6365 7373 2074 6865 2061 7474   process the att
+00009f70: 6163 6865 6420 6269 6e61 7279 2064 6174  ached binary dat
+00009f80: 613a 220d 0a20 2020 2020 2020 2020 2020  a:"..           
+00009f90: 2020 2020 2020 2020 2029 2c0d 0a20 2020           ),..   
+00009fa0: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
+00009fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009fc0: 6966 206e 6f74 2072 6573 3a0d 0a20 2020  if not res:..   
+00009fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009fe0: 2063 616e 6365 6c6c 6564 203d 2054 7275   cancelled = Tru
+00009ff0: 650d 0a20 2020 2020 2020 2069 6620 6e6f  e..        if no
+0000a000: 7420 6361 6e63 656c 6c65 643a 0d0a 2020  t cancelled:..  
+0000a010: 2020 2020 2020 2020 2020 6432 702e 7061            d2p.pa
+0000a020: 7273 6528 6e6f 6465 2e64 6174 615f 7479  rse(node.data_ty
+0000a030: 7065 2c20 6e6f 6465 2e64 6174 612c 2073  pe, node.data, s
+0000a040: 656c 6629 0d0a 2020 2020 2020 2020 7265  elf)..        re
+0000a050: 7475 726e 2054 7275 650d 0a0d 0a20 2020  turn True....   
+0000a060: 2040 7472 6565 5f63 6f6e 6469 7469 6f6e   @tree_condition
+0000a070: 616c 5f74 7279 280d 0a20 2020 2020 2020  al_try(..       
+0000a080: 206c 616d 6264 6120 6e6f 6465 3a20 6b65   lambda node: ke
+0000a090: 726e 656c 2e6c 6f6f 6b75 7028 6622 7370  rnel.lookup(f"sp
+0000a0a0: 6f6f 6c65 726a 6f62 2f7b 6e6f 6465 2e64  oolerjob/{node.d
+0000a0b0: 6174 615f 7479 7065 7d22 2920 6973 206e  ata_type}") is n
+0000a0c0: 6f74 204e 6f6e 650d 0a20 2020 2029 0d0a  ot None..    )..
+0000a0d0: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
+0000a0e0: 696f 6e28 0d0a 2020 2020 2020 2020 5f28  ion(..        _(
+0000a0f0: 2245 7865 6375 7465 2042 6c6f 6222 292c  "Execute Blob"),
+0000a100: 0d0a 2020 2020 2020 2020 6e6f 6465 5f74  ..        node_t
+0000a110: 7970 653d 2262 6c6f 6222 2c0d 0a20 2020  ype="blob",..   
+0000a120: 2020 2020 2068 656c 703d 5f28 2252 756e       help=_("Run
+0000a130: 2074 6865 2067 6976 656e 2062 6c6f 6220   the given blob 
+0000a140: 6f6e 2074 6865 2063 7572 7265 6e74 2064  on the current d
+0000a150: 6576 6963 6522 292c 0d0a 2020 2020 290d  evice"),..    ).
+0000a160: 0a20 2020 2064 6566 2062 6c6f 625f 6578  .    def blob_ex
+0000a170: 6563 7574 6528 6e6f 6465 2c20 2a2a 6b77  ecute(node, **kw
+0000a180: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
+0000a190: 7370 6f6f 6c65 725f 6a6f 6220 3d20 7365  spooler_job = se
+0000a1a0: 6c66 2e6c 6f6f 6b75 7028 6622 7370 6f6f  lf.lookup(f"spoo
+0000a1b0: 6c65 726a 6f62 2f7b 6e6f 6465 2e64 6174  lerjob/{node.dat
+0000a1c0: 615f 7479 7065 7d22 290d 0a20 2020 2020  a_type}")..     
+0000a1d0: 2020 206d 6174 7269 7820 3d20 7365 6c66     matrix = self
+0000a1e0: 2e64 6576 6963 652e 7363 656e 655f 746f  .device.scene_to
+0000a1f0: 5f64 6576 6963 655f 6d61 7472 6978 2829  _device_matrix()
+0000a200: 0d0a 2020 2020 2020 2020 6a6f 625f 6f62  ..        job_ob
+0000a210: 6a65 6374 203d 2073 706f 6f6c 6572 5f6a  ject = spooler_j
+0000a220: 6f62 2873 656c 662e 6465 7669 6365 2e64  ob(self.device.d
+0000a230: 7269 7665 722c 206d 6174 7269 7829 0d0a  river, matrix)..
+0000a240: 2020 2020 2020 2020 6a6f 625f 6f62 6a65          job_obje
+0000a250: 6374 2e77 7269 7465 5f62 6c6f 6228 6e6f  ct.write_blob(no
+0000a260: 6465 2e64 6174 6129 0d0a 2020 2020 2020  de.data)..      
+0000a270: 2020 7365 6c66 2e64 6576 6963 652e 7370    self.device.sp
+0000a280: 6f6f 6c65 722e 7365 6e64 286a 6f62 5f6f  ooler.send(job_o
+0000a290: 626a 6563 7429 0d0a 0d0a 2020 2020 4074  bject)....    @t
+0000a2a0: 7265 655f 636f 6e64 6974 696f 6e61 6c5f  ree_conditional_
+0000a2b0: 7472 7928 6c61 6d62 6461 206e 6f64 653a  try(lambda node:
+0000a2c0: 2068 6173 6174 7472 286e 6f64 652c 2022   hasattr(node, "
+0000a2d0: 6173 5f63 7574 6f62 6a65 6374 7322 2929  as_cutobjects"))
+0000a2e0: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
+0000a2f0: 6174 696f 6e28 0d0a 2020 2020 2020 2020  ation(..        
+0000a300: 5f28 2243 6f6e 7665 7274 2074 6f20 4375  _("Convert to Cu
+0000a310: 7463 6f64 6522 292c 0d0a 2020 2020 2020  tcode"),..      
+0000a320: 2020 6e6f 6465 5f74 7970 653d 2262 6c6f    node_type="blo
+0000a330: 6222 2c0d 0a20 2020 2020 2020 2068 656c  b",..        hel
+0000a340: 703d 2222 2c0d 0a20 2020 2029 0d0a 2020  p="",..    )..  
+0000a350: 2020 6465 6620 626c 6f62 3263 7574 286e    def blob2cut(n
+0000a360: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
+0000a370: 0a20 2020 2020 2020 206e 6f64 652e 7265  .        node.re
+0000a380: 706c 6163 655f 6e6f 6465 286e 6f64 652e  place_node(node.
+0000a390: 6173 5f63 7574 6f62 6a65 6374 7328 292c  as_cutobjects(),
+0000a3a0: 2074 7970 653d 2263 7574 636f 6465 2229   type="cutcode")
+0000a3b0: 0d0a 0d0a 2020 2020 4074 7265 655f 6f70  ....    @tree_op
+0000a3c0: 6572 6174 696f 6e28 0d0a 2020 2020 2020  eration(..      
+0000a3d0: 2020 5f28 2243 6f6e 7665 7274 2074 6f20    _("Convert to 
+0000a3e0: 5061 7468 2229 2c0d 0a20 2020 2020 2020  Path"),..       
+0000a3f0: 206e 6f64 655f 7479 7065 3d22 6375 7463   node_type="cutc
+0000a400: 6f64 6522 2c0d 0a20 2020 2020 2020 2068  ode",..        h
+0000a410: 656c 703d 2222 2c0d 0a20 2020 2029 0d0a  elp="",..    )..
+0000a420: 2020 2020 6465 6620 6375 7463 6f64 6532      def cutcode2
+0000a430: 7061 7468 6375 7428 6e6f 6465 2c20 2a2a  pathcut(node, **
+0000a440: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
+0000a450: 2020 6375 7463 6f64 6520 3d20 6e6f 6465    cutcode = node
+0000a460: 2e63 7574 636f 6465 0d0a 2020 2020 2020  .cutcode..      
+0000a470: 2020 6966 2063 7574 636f 6465 2069 7320    if cutcode is 
+0000a480: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+0000a490: 2020 2072 6574 7572 6e0d 0a20 2020 2020     return..     
+0000a4a0: 2020 2065 6c65 6d65 6e74 7320 3d20 6c69     elements = li
+0000a4b0: 7374 2863 7574 636f 6465 2e61 735f 656c  st(cutcode.as_el
+0000a4c0: 656d 656e 7473 2829 290d 0a20 2020 2020  ements())..     
+0000a4d0: 2020 206e 203d 204e 6f6e 650d 0a20 2020     n = None..   
+0000a4e0: 2020 2020 2066 6f72 2065 6c65 6d65 6e74       for element
+0000a4f0: 2069 6e20 656c 656d 656e 7473 3a0d 0a20   in elements:.. 
+0000a500: 2020 2020 2020 2020 2020 206e 203d 2073             n = s
+0000a510: 656c 662e 656c 656d 5f62 7261 6e63 682e  elf.elem_branch.
+0000a520: 6164 6428 7479 7065 3d22 656c 656d 2070  add(type="elem p
+0000a530: 6174 6822 2c20 7061 7468 3d65 6c65 6d65  ath", path=eleme
+0000a540: 6e74 290d 0a20 2020 2020 2020 206e 6f64  nt)..        nod
+0000a550: 652e 7265 6d6f 7665 5f6e 6f64 6528 290d  e.remove_node().
+0000a560: 0a20 2020 2020 2020 2069 6620 6e20 6973  .        if n is
+0000a570: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
+0000a580: 2020 2020 2020 2020 6e2e 666f 6375 7328          n.focus(
+0000a590: 290d 0a0d 0a20 2020 2040 7472 6565 5f73  )....    @tree_s
+0000a5a0: 7562 6d65 6e75 285f 2822 436c 6f6e 6520  ubmenu(_("Clone 
+0000a5b0: 7265 6665 7265 6e63 6522 2929 0d0a 2020  reference"))..  
+0000a5c0: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
+0000a5d0: 6e28 5f28 224d 616b 6520 3120 636f 7079  n(_("Make 1 copy
+0000a5e0: 2229 2c20 6e6f 6465 5f74 7970 653d 2822  "), node_type=("
+0000a5f0: 7265 6665 7265 6e63 6522 2c29 2c20 6865  reference",), he
+0000a600: 6c70 3d22 2229 0d0a 2020 2020 6465 6620  lp="")..    def 
+0000a610: 636c 6f6e 655f 7369 6e67 6c65 5f65 6c65  clone_single_ele
+0000a620: 6d65 6e74 5f6f 7028 6e6f 6465 2c20 2a2a  ment_op(node, **
+0000a630: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
+0000a640: 2020 636c 6f6e 655f 656c 656d 656e 745f    clone_element_
+0000a650: 6f70 286e 6f64 652c 2063 6f70 6965 733d  op(node, copies=
+0000a660: 312c 202a 2a6b 7761 7267 7329 0d0a 0d0a  1, **kwargs)....
+0000a670: 2020 2020 4074 7265 655f 7375 626d 656e      @tree_submen
+0000a680: 7528 5f28 2243 6c6f 6e65 2072 6566 6572  u(_("Clone refer
+0000a690: 656e 6365 2229 290d 0a20 2020 2040 7472  ence"))..    @tr
+0000a6a0: 6565 5f69 7465 7261 7465 2822 636f 7069  ee_iterate("copi
+0000a6b0: 6573 222c 2032 2c20 3130 290d 0a20 2020  es", 2, 10)..   
+0000a6c0: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
+0000a6d0: 285f 2822 4d61 6b65 207b 636f 7069 6573  (_("Make {copies
+0000a6e0: 7d20 636f 7069 6573 2229 2c20 6e6f 6465  } copies"), node
+0000a6f0: 5f74 7970 653d 2822 7265 6665 7265 6e63  _type=("referenc
+0000a700: 6522 2c29 2c20 6865 6c70 3d22 2229 0d0a  e",), help="")..
+0000a710: 2020 2020 6465 6620 636c 6f6e 655f 656c      def clone_el
+0000a720: 656d 656e 745f 6f70 286e 6f64 652c 2063  ement_op(node, c
+0000a730: 6f70 6965 733d 312c 202a 2a6b 7761 7267  opies=1, **kwarg
+0000a740: 7329 3a0d 0a20 2020 2020 2020 2077 6974  s):..        wit
+0000a750: 6820 7365 6c66 2e73 7461 7469 6328 2263  h self.static("c
+0000a760: 6c6f 6e65 5f65 6c65 6d5f 6f70 2229 3a0d  lone_elem_op"):.
+0000a770: 0a20 2020 2020 2020 2020 2020 206e 6f64  .            nod
+0000a780: 6573 203d 206c 6973 7428 7365 6c66 2e66  es = list(self.f
+0000a790: 6c61 7428 7365 6c65 6374 6564 3d54 7275  lat(selected=Tru
+0000a7a0: 652c 2063 6173 6361 6465 3d46 616c 7365  e, cascade=False
+0000a7b0: 2c20 7479 7065 733d 2272 6566 6572 656e  , types="referen
+0000a7c0: 6365 2229 290d 0a20 2020 2020 2020 2020  ce"))..         
+0000a7d0: 2020 2066 6f72 2073 6e6f 6465 2069 6e20     for snode in 
+0000a7e0: 6e6f 6465 733a 0d0a 2020 2020 2020 2020  nodes:..        
+0000a7f0: 2020 2020 2020 2020 696e 6465 7820 3d20          index = 
+0000a800: 736e 6f64 652e 7061 7265 6e74 2e63 6869  snode.parent.chi
+0000a810: 6c64 7265 6e2e 696e 6465 7828 736e 6f64  ldren.index(snod
+0000a820: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+0000a830: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
+0000a840: 6765 2863 6f70 6965 7329 3a0d 0a20 2020  ge(copies):..   
+0000a850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a860: 2073 6e6f 6465 2e70 6172 656e 742e 6164   snode.parent.ad
+0000a870: 645f 7265 6665 7265 6e63 6528 736e 6f64  d_reference(snod
+0000a880: 652e 6e6f 6465 2c20 706f 733d 696e 6465  e.node, pos=inde
+0000a890: 7829 0d0a 2020 2020 2020 2020 2020 2020  x)..            
+0000a8a0: 2020 2020 736e 6f64 652e 6d6f 6469 6669      snode.modifi
+0000a8b0: 6564 2829 0d0a 0d0a 2020 2020 4074 7265  ed()....    @tre
+0000a8c0: 655f 636f 6e64 6974 696f 6e61 6c28 6c61  e_conditional(la
+0000a8d0: 6d62 6461 206e 6f64 653a 206e 6f64 652e  mbda node: node.
+0000a8e0: 636f 756e 745f 6368 696c 6472 656e 2829  count_children()
+0000a8f0: 203e 2031 290d 0a20 2020 2040 7472 6565   > 1)..    @tree
+0000a900: 5f6f 7065 7261 7469 6f6e 280d 0a20 2020  _operation(..   
+0000a910: 2020 2020 205f 2822 5265 7665 7273 6520       _("Reverse 
+0000a920: 7375 6269 7465 6d73 206f 7264 6572 2229  subitems order")
+0000a930: 2c0d 0a20 2020 2020 2020 206e 6f64 655f  ,..        node_
+0000a940: 7479 7065 3d28 0d0a 2020 2020 2020 2020  type=(..        
+0000a950: 2020 2020 226f 7020 6375 7422 2c0d 0a20      "op cut",.. 
+0000a960: 2020 2020 2020 2020 2020 2022 6f70 2072             "op r
+0000a970: 6173 7465 7222 2c0d 0a20 2020 2020 2020  aster",..       
+0000a980: 2020 2020 2022 6f70 2069 6d61 6765 222c       "op image",
+0000a990: 0d0a 2020 2020 2020 2020 2020 2020 226f  ..            "o
+0000a9a0: 7020 656e 6772 6176 6522 2c0d 0a20 2020  p engrave",..   
+0000a9b0: 2020 2020 2020 2020 2022 6f70 2064 6f74           "op dot
+0000a9c0: 7322 2c0d 0a20 2020 2020 2020 2020 2020  s",..           
+0000a9d0: 2022 6f70 2068 6174 6368 222c 0d0a 2020   "op hatch",..  
+0000a9e0: 2020 2020 2020 2020 2020 2267 726f 7570            "group
+0000a9f0: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+0000aa00: 2262 7261 6e63 6820 656c 656d 7322 2c0d  "branch elems",.
+0000aa10: 0a20 2020 2020 2020 2020 2020 2022 6669  .            "fi
+0000aa20: 6c65 222c 0d0a 2020 2020 2020 2020 2020  le",..          
+0000aa30: 2020 2262 7261 6e63 6820 6f70 7322 2c0d    "branch ops",.
+0000aa40: 0a20 2020 2020 2020 2029 2c0d 0a20 2020  .        ),..   
+0000aa50: 2020 2020 2068 656c 703d 5f28 2252 6576       help=_("Rev
+0000aa60: 6572 7365 2074 6865 2069 7465 6d73 2077  erse the items w
+0000aa70: 6974 6869 6e20 7468 6973 2073 7562 6974  ithin this subit
+0000aa80: 656d 2229 2c0d 0a20 2020 2029 0d0a 2020  em"),..    )..  
+0000aa90: 2020 6465 6620 7265 7665 7273 655f 6c61    def reverse_la
+0000aaa0: 7965 725f 6f72 6465 7228 6e6f 6465 2c20  yer_order(node, 
+0000aab0: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
+0000aac0: 2020 2020 6e6f 6465 2e72 6576 6572 7365      node.reverse
+0000aad0: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
+0000aae0: 2e73 6967 6e61 6c28 2272 6566 7265 7368  .signal("refresh
+0000aaf0: 5f74 7265 6522 2c20 6c69 7374 2873 656c  _tree", list(sel
+0000ab00: 662e 666c 6174 2874 7970 6573 3d22 7265  f.flat(types="re
+0000ab10: 6665 7265 6e63 6522 2929 290d 0a0d 0a20  ference"))).... 
+0000ab20: 2020 2040 7472 6565 5f73 6570 6172 6174     @tree_separat
+0000ab30: 6f72 5f61 6674 6572 2829 0d0a 2020 2020  or_after()..    
+0000ab40: 4074 7265 655f 636f 6e64 6974 696f 6e61  @tree_conditiona
+0000ab50: 6c28 6c61 6d62 6461 206e 6f64 653a 2073  l(lambda node: s
+0000ab60: 656c 662e 636c 6173 7369 6679 5f61 7574  elf.classify_aut
+0000ab70: 6f67 656e 6572 6174 6529 0d0a 2020 2020  ogenerate)..    
+0000ab80: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
+0000ab90: 0d0a 2020 2020 2020 2020 5f28 2252 6566  ..        _("Ref
+0000aba0: 7265 7368 2063 6c61 7373 6966 6963 6174  resh classificat
+0000abb0: 696f 6e22 292c 0d0a 2020 2020 2020 2020  ion"),..        
+0000abc0: 6e6f 6465 5f74 7970 653d 2262 7261 6e63  node_type="branc
+0000abd0: 6820 6f70 7322 2c0d 0a20 2020 2020 2020  h ops",..       
+0000abe0: 2068 656c 703d 5f28 2252 6563 6c61 7373   help=_("Reclass
+0000abf0: 6966 7920 656c 656d 656e 7473 2061 6e64  ify elements and
+0000ac00: 2063 7265 6174 6520 6f70 6572 6174 696f   create operatio
+0000ac10: 6e73 2069 6620 6e65 6365 7373 6172 7922  ns if necessary"
+0000ac20: 292c 0d0a 2020 2020 290d 0a20 2020 2064  ),..    )..    d
+0000ac30: 6566 2072 6566 7265 7368 5f63 6c61 7369  ef refresh_clasi
+0000ac40: 6669 6361 7469 6f6e 735f 3128 6e6f 6465  fications_1(node
+0000ac50: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+0000ac60: 2020 2020 2020 7365 6c66 2e72 656d 6f76        self.remov
+0000ac70: 655f 656c 656d 656e 7473 5f66 726f 6d5f  e_elements_from_
+0000ac80: 6f70 6572 6174 696f 6e73 286c 6973 7428  operations(list(
+0000ac90: 7365 6c66 2e65 6c65 6d73 2829 2929 0d0a  self.elems()))..
+0000aca0: 2020 2020 2020 2020 7365 6c66 2e63 6c61          self.cla
+0000acb0: 7373 6966 7928 6c69 7374 2873 656c 662e  ssify(list(self.
+0000acc0: 656c 656d 7328 2929 290d 0a20 2020 2020  elems()))..     
+0000acd0: 2020 2073 656c 662e 7369 676e 616c 2822     self.signal("
+0000ace0: 7265 6672 6573 685f 7472 6565 222c 206c  refresh_tree", l
+0000acf0: 6973 7428 7365 6c66 2e66 6c61 7428 7479  ist(self.flat(ty
+0000ad00: 7065 733d 2272 6566 6572 656e 6365 2229  pes="reference")
+0000ad10: 2929 0d0a 0d0a 2020 2020 4074 7265 655f  ))....    @tree_
+0000ad20: 636f 6e64 6974 696f 6e61 6c28 6c61 6d62  conditional(lamb
+0000ad30: 6461 206e 6f64 653a 206e 6f74 2073 656c  da node: not sel
+0000ad40: 662e 636c 6173 7369 6679 5f61 7574 6f67  f.classify_autog
+0000ad50: 656e 6572 6174 6529 0d0a 2020 2020 4074  enerate)..    @t
+0000ad60: 7265 655f 6f70 6572 6174 696f 6e28 0d0a  ree_operation(..
+0000ad70: 2020 2020 2020 2020 5f28 2252 6566 7265          _("Refre
+0000ad80: 7368 2063 6c61 7373 6966 6963 6174 696f  sh classificatio
+0000ad90: 6e22 292c 0d0a 2020 2020 2020 2020 6e6f  n"),..        no
+0000ada0: 6465 5f74 7970 653d 2262 7261 6e63 6820  de_type="branch 
+0000adb0: 6f70 7322 2c0d 0a20 2020 2020 2020 2068  ops",..        h
+0000adc0: 656c 703d 5f28 2252 6563 6c61 7373 6966  elp=_("Reclassif
+0000add0: 7920 656c 656d 656e 7473 2061 6e64 2075  y elements and u
+0000ade0: 7365 206f 6e6c 7920 6578 6973 7469 6e67  se only existing
+0000adf0: 206f 7065 7261 7469 6f6e 7322 292c 0d0a   operations"),..
+0000ae00: 2020 2020 290d 0a20 2020 2064 6566 2072      )..    def r
+0000ae10: 6566 7265 7368 5f63 6c61 7369 6669 6361  efresh_clasifica
+0000ae20: 7469 6f6e 735f 3228 6e6f 6465 2c20 2a2a  tions_2(node, **
+0000ae30: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
+0000ae40: 2020 7365 6c66 2e72 656d 6f76 655f 656c    self.remove_el
+0000ae50: 656d 656e 7473 5f66 726f 6d5f 6f70 6572  ements_from_oper
+0000ae60: 6174 696f 6e73 286c 6973 7428 7365 6c66  ations(list(self
+0000ae70: 2e65 6c65 6d73 2829 2929 0d0a 2020 2020  .elems()))..    
+0000ae80: 2020 2020 7365 6c66 2e63 6c61 7373 6966      self.classif
+0000ae90: 7928 6c69 7374 2873 656c 662e 656c 656d  y(list(self.elem
+0000aea0: 7328 2929 290d 0a20 2020 2020 2020 2073  s()))..        s
+0000aeb0: 656c 662e 7369 676e 616c 2822 7265 6672  elf.signal("refr
+0000aec0: 6573 685f 7472 6565 222c 206c 6973 7428  esh_tree", list(
+0000aed0: 7365 6c66 2e66 6c61 7428 7479 7065 733d  self.flat(types=
+0000aee0: 2272 6566 6572 656e 6365 2229 2929 0d0a  "reference")))..
+0000aef0: 0d0a 2020 2020 4074 7265 655f 7365 7061  ..    @tree_sepa
+0000af00: 7261 746f 725f 6166 7465 7228 290d 0a20  rator_after().. 
+0000af10: 2020 2040 7472 6565 5f63 6f6e 6469 7469     @tree_conditi
+0000af20: 6f6e 616c 286c 616d 6264 6120 6e6f 6465  onal(lambda node
+0000af30: 3a20 6e6f 7420 7365 6c66 2e63 6c61 7373  : not self.class
+0000af40: 6966 795f 6175 746f 6765 6e65 7261 7465  ify_autogenerate
+0000af50: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
+0000af60: 7261 7469 6f6e 280d 0a20 2020 2020 2020  ration(..       
+0000af70: 205f 2822 5265 6672 6573 6820 2e2e 2e20   _("Refresh ... 
+0000af80: 2869 6e63 6c20 6175 746f 6765 6e65 7261  (incl autogenera
+0000af90: 7469 6f6e 2922 292c 0d0a 2020 2020 2020  tion)"),..      
+0000afa0: 2020 6e6f 6465 5f74 7970 653d 2262 7261    node_type="bra
+0000afb0: 6e63 6820 6f70 7322 2c0d 0a20 2020 2020  nch ops",..     
+0000afc0: 2020 2068 656c 703d 5f28 2252 6563 6c61     help=_("Recla
+0000afd0: 7373 6966 7920 656c 656d 656e 7473 2061  ssify elements a
+0000afe0: 6e64 2063 7265 6174 6520 6f70 6572 6174  nd create operat
+0000aff0: 696f 6e73 2069 6620 6e65 6365 7373 6172  ions if necessar
+0000b000: 7922 292c 0d0a 2020 2020 290d 0a20 2020  y"),..    )..   
+0000b010: 2064 6566 2072 6566 7265 7368 5f63 6c61   def refresh_cla
+0000b020: 7369 6669 6361 7469 6f6e 735f 3328 6e6f  sifications_3(no
+0000b030: 6465 2c20 2a2a 6b77 6172 6773 293a 0d0a  de, **kwargs):..
+0000b040: 2020 2020 2020 2020 7072 6576 696f 7573          previous
+0000b050: 203d 2073 656c 662e 636c 6173 7369 6679   = self.classify
+0000b060: 5f61 7574 6f67 656e 6572 6174 650d 0a20  _autogenerate.. 
+0000b070: 2020 2020 2020 2073 656c 662e 636c 6173         self.clas
+0000b080: 7369 6679 5f61 7574 6f67 656e 6572 6174  sify_autogenerat
+0000b090: 6520 3d20 5472 7565 0d0a 2020 2020 2020  e = True..      
+0000b0a0: 2020 7365 6c66 2e72 656d 6f76 655f 656c    self.remove_el
+0000b0b0: 656d 656e 7473 5f66 726f 6d5f 6f70 6572  ements_from_oper
+0000b0c0: 6174 696f 6e73 286c 6973 7428 7365 6c66  ations(list(self
+0000b0d0: 2e65 6c65 6d73 2829 2929 0d0a 2020 2020  .elems()))..    
+0000b0e0: 2020 2020 7365 6c66 2e63 6c61 7373 6966      self.classif
+0000b0f0: 7928 6c69 7374 2873 656c 662e 656c 656d  y(list(self.elem
+0000b100: 7328 2929 290d 0a20 2020 2020 2020 2073  s()))..        s
+0000b110: 656c 662e 636c 6173 7369 6679 5f61 7574  elf.classify_aut
+0000b120: 6f67 656e 6572 6174 6520 3d20 7072 6576  ogenerate = prev
+0000b130: 696f 7573 0d0a 2020 2020 2020 2020 7365  ious..        se
+0000b140: 6c66 2e73 6967 6e61 6c28 2272 6566 7265  lf.signal("refre
+0000b150: 7368 5f74 7265 6522 2c20 6c69 7374 2873  sh_tree", list(s
+0000b160: 656c 662e 666c 6174 2874 7970 6573 3d22  elf.flat(types="
+0000b170: 7265 6665 7265 6e63 6522 2929 290d 0a0d  reference")))...
+0000b180: 0a20 2020 2040 7472 6565 5f63 6f6e 6469  .    @tree_condi
+0000b190: 7469 6f6e 616c 286c 616d 6264 6120 636f  tional(lambda co
+0000b1a0: 6e64 3a20 7365 6c66 2e68 6176 655f 756e  nd: self.have_un
+0000b1b0: 6173 7369 676e 6564 5f65 6c65 6d65 6e74  assigned_element
+0000b1c0: 7328 2929 0d0a 2020 2020 4074 7265 655f  s())..    @tree_
+0000b1d0: 6f70 6572 6174 696f 6e28 0d0a 2020 2020  operation(..    
+0000b1e0: 2020 2020 5f28 2253 656c 6563 7420 756e      _("Select un
+0000b1f0: 6173 7369 676e 6564 2065 6c65 6d65 6e74  assigned element
+0000b200: 7322 292c 0d0a 2020 2020 2020 2020 6e6f  s"),..        no
+0000b210: 6465 5f74 7970 653d 2262 7261 6e63 6820  de_type="branch 
+0000b220: 6f70 7322 2c0d 0a20 2020 2020 2020 2068  ops",..        h
+0000b230: 656c 703d 5f28 2253 656c 6563 7420 616c  elp=_("Select al
+0000b240: 6c20 656c 656d 656e 7473 2074 6861 7420  l elements that 
+0000b250: 776f 6e27 7420 6265 2062 7572 6e65 6422  won't be burned"
+0000b260: 292c 0d0a 2020 2020 290d 0a20 2020 2064  ),..    )..    d
+0000b270: 6566 2073 656c 6563 745f 756e 6173 7369  ef select_unassi
+0000b280: 676e 6564 286e 6f64 652c 202a 2a6b 7761  gned(node, **kwa
+0000b290: 7267 7329 3a0d 0a20 2020 2020 2020 2063  rgs):..        c
+0000b2a0: 6861 6e67 6573 203d 2046 616c 7365 0d0a  hanges = False..
+0000b2b0: 2020 2020 2020 2020 666f 7220 6e6f 6465          for node
+0000b2c0: 2069 6e20 7365 6c66 2e65 6c65 6d73 2829   in self.elems()
+0000b2d0: 3a0d 0a20 2020 2020 2020 2020 2020 2065  :..            e
+0000b2e0: 6d70 6861 7369 7320 3d20 626f 6f6c 286c  mphasis = bool(l
+0000b2f0: 656e 286e 6f64 652e 7265 6665 7265 6e63  en(node.referenc
+0000b300: 6573 2920 3d3d 2030 290d 0a20 2020 2020  es) == 0)..     
+0000b310: 2020 2020 2020 2069 6620 6e6f 6465 2e65         if node.e
+0000b320: 6d70 6861 7369 7a65 6420 213d 2065 6d70  mphasized != emp
+0000b330: 6861 7369 733a 0d0a 2020 2020 2020 2020  hasis:..        
+0000b340: 2020 2020 2020 2020 6368 616e 6765 7320          changes 
+0000b350: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
+0000b360: 2020 2020 2020 2020 6e6f 6465 2e65 6d70          node.emp
+0000b370: 6861 7369 7a65 6420 3d20 656d 7068 6173  hasized = emphas
+0000b380: 6973 0d0a 2020 2020 2020 2020 6966 2063  is..        if c
+0000b390: 6861 6e67 6573 3a0d 0a20 2020 2020 2020  hanges:..       
+0000b3a0: 2020 2020 2073 656c 662e 7661 6c69 6461       self.valida
+0000b3b0: 7465 5f73 656c 6563 7465 645f 6172 6561  te_selected_area
+0000b3c0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+0000b3d0: 7365 6c66 2e73 6967 6e61 6c28 2272 6566  self.signal("ref
+0000b3e0: 7265 7368 5f73 6365 6e65 222c 2022 5363  resh_scene", "Sc
+0000b3f0: 656e 6522 290d 0a0d 0a20 2020 206d 6174  ene")....    mat
+0000b400: 6572 6961 6c73 203d 205b 0d0a 2020 2020  erials = [..    
+0000b410: 2020 2020 5f28 2257 6f6f 6422 292c 0d0a      _("Wood"),..
+0000b420: 2020 2020 2020 2020 5f28 2241 6372 796c          _("Acryl
+0000b430: 6963 2229 2c0d 0a20 2020 2020 2020 205f  ic"),..        _
+0000b440: 2822 466f 616d 2229 2c0d 0a20 2020 2020  ("Foam"),..     
+0000b450: 2020 205f 2822 4c65 6174 6865 7222 292c     _("Leather"),
+0000b460: 0d0a 2020 2020 2020 2020 5f28 2243 6172  ..        _("Car
+0000b470: 6462 6f61 7264 2229 2c0d 0a20 2020 2020  dboard"),..     
+0000b480: 2020 205f 2822 436f 726b 2229 2c0d 0a20     _("Cork"),.. 
+0000b490: 2020 2020 2020 205f 2822 5465 7874 696c         _("Textil
+0000b4a0: 6573 2229 2c0d 0a20 2020 2020 2020 205f  es"),..        _
+0000b4b0: 2822 5061 7065 7222 292c 0d0a 2020 2020  ("Paper"),..    
+0000b4c0: 2020 2020 5f28 2253 6176 652d 3122 292c      _("Save-1"),
+0000b4d0: 0d0a 2020 2020 2020 2020 5f28 2253 6176  ..        _("Sav
+0000b4e0: 652d 3222 292c 0d0a 2020 2020 2020 2020  e-2"),..        
+0000b4f0: 5f28 2253 6176 652d 3322 292c 0d0a 2020  _("Save-3"),..  
+0000b500: 2020 5d0d 0a0d 0a20 2020 2064 6566 2075    ]....    def u
+0000b510: 6e69 6f6e 5f6d 6174 6572 6961 6c73 5f73  nion_materials_s
+0000b520: 6176 6564 2829 3a0d 0a20 2020 2020 2020  aved():..       
+0000b530: 2075 6e69 6f6e 203d 205b 0d0a 2020 2020   union = [..    
+0000b540: 2020 2020 2020 2020 640d 0a20 2020 2020          d..     
+0000b550: 2020 2020 2020 2066 6f72 2064 2069 6e20         for d in 
+0000b560: 7365 6c66 2e6f 705f 6461 7461 2e73 6563  self.op_data.sec
+0000b570: 7469 6f6e 5f73 6574 2829 0d0a 2020 2020  tion_set()..    
+0000b580: 2020 2020 2020 2020 6966 2064 206e 6f74          if d not
+0000b590: 2069 6e20 6d61 7465 7269 616c 7320 616e   in materials an
+0000b5a0: 6420 6420 213d 2022 7072 6576 696f 7573  d d != "previous
+0000b5b0: 220d 0a20 2020 2020 2020 205d 0d0a 2020  "..        ]..  
+0000b5c0: 2020 2020 2020 756e 696f 6e2e 6578 7465        union.exte
+0000b5d0: 6e64 286d 6174 6572 6961 6c73 290d 0a20  nd(materials).. 
+0000b5e0: 2020 2020 2020 2072 6574 7572 6e20 756e         return un
+0000b5f0: 696f 6e0d 0a0d 0a20 2020 2064 6566 2064  ion....    def d
+0000b600: 6966 6665 7265 6e63 655f 6d61 7465 7269  ifference_materi
+0000b610: 616c 735f 7361 7665 6428 293a 0d0a 2020  als_saved():..  
+0000b620: 2020 2020 2020 7365 6373 203d 2073 656c        secs = sel
+0000b630: 662e 6f70 5f64 6174 612e 7365 6374 696f  f.op_data.sectio
+0000b640: 6e5f 7365 7428 290d 0a20 2020 2020 2020  n_set()..       
+0000b650: 2064 6966 6665 7265 6e63 6520 3d20 5b6d   difference = [m
+0000b660: 2066 6f72 206d 2069 6e20 6d61 7465 7269   for m in materi
+0000b670: 616c 7320 6966 206d 206e 6f74 2069 6e20  als if m not in 
+0000b680: 7365 6373 5d0d 0a20 2020 2020 2020 2072  secs]..        r
+0000b690: 6574 7572 6e20 6469 6666 6572 656e 6365  eturn difference
+0000b6a0: 0d0a 0d0a 2020 2020 4074 7265 655f 7375  ....    @tree_su
+0000b6b0: 626d 656e 7528 5f28 224c 6f61 6422 2929  bmenu(_("Load"))
+0000b6c0: 0d0a 2020 2020 4074 7265 655f 7661 6c75  ..    @tree_valu
+0000b6d0: 6573 2822 6f70 6e61 6d65 222c 2076 616c  es("opname", val
+0000b6e0: 7565 733d 7365 6c66 2e6f 705f 6461 7461  ues=self.op_data
+0000b6f0: 2e73 6563 7469 6f6e 5f73 6574 290d 0a20  .section_set).. 
+0000b700: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
+0000b710: 6f6e 2822 7b6f 706e 616d 657d 222c 206e  on("{opname}", n
+0000b720: 6f64 655f 7479 7065 3d22 6272 616e 6368  ode_type="branch
+0000b730: 206f 7073 222c 2068 656c 703d 2222 290d   ops", help="").
+0000b740: 0a20 2020 2064 6566 206c 6f61 645f 6f70  .    def load_op
+0000b750: 7328 6e6f 6465 2c20 6f70 6e61 6d65 2c20  s(node, opname, 
+0000b760: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
+0000b770: 2020 2020 7365 6c66 2866 226d 6174 6572      self(f"mater
+0000b780: 6961 6c20 6c6f 6164 207b 6f70 6e61 6d65  ial load {opname
+0000b790: 7d5c 6e22 290d 0a0d 0a20 2020 2040 7472  }\n")....    @tr
+0000b7a0: 6565 5f73 6570 6172 6174 6f72 5f62 6566  ee_separator_bef
+0000b7b0: 6f72 6528 290d 0a20 2020 2040 7472 6565  ore()..    @tree
+0000b7c0: 5f73 7562 6d65 6e75 285f 2822 4c6f 6164  _submenu(_("Load
+0000b7d0: 2229 290d 0a20 2020 2040 7472 6565 5f6f  "))..    @tree_o
+0000b7e0: 7065 7261 7469 6f6e 285f 2822 4f74 6865  peration(_("Othe
+0000b7f0: 722f 426c 7565 2f52 6564 2229 2c20 6e6f  r/Blue/Red"), no
+0000b800: 6465 5f74 7970 653d 2262 7261 6e63 6820  de_type="branch 
+0000b810: 6f70 7322 2c20 6865 6c70 3d22 2229 0d0a  ops", help="")..
+0000b820: 2020 2020 6465 6620 6465 6661 756c 745f      def default_
+0000b830: 636c 6173 7369 6669 6361 7469 6f6e 7328  classifications(
+0000b840: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
+0000b850: 0d0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
+0000b860: 6f61 645f 6465 6661 756c 7428 7065 7266  oad_default(perf
+0000b870: 6f72 6d63 6c61 7373 6966 793d 5472 7565  ormclassify=True
+0000b880: 290d 0a0d 0a20 2020 2040 7472 6565 5f73  )....    @tree_s
+0000b890: 7562 6d65 6e75 285f 2822 4c6f 6164 2229  ubmenu(_("Load")
+0000b8a0: 290d 0a20 2020 2040 7472 6565 5f73 6570  )..    @tree_sep
+0000b8b0: 6172 6174 6f72 5f61 6674 6572 2829 0d0a  arator_after()..
+0000b8c0: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
+0000b8d0: 696f 6e28 5f28 2242 6173 6963 2229 2c20  ion(_("Basic"), 
+0000b8e0: 6e6f 6465 5f74 7970 653d 2262 7261 6e63  node_type="branc
+0000b8f0: 6820 6f70 7322 2c20 6865 6c70 3d22 2229  h ops", help="")
+0000b900: 0d0a 2020 2020 6465 6620 6261 7369 635f  ..    def basic_
+0000b910: 636c 6173 7369 6669 6361 7469 6f6e 7328  classifications(
+0000b920: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
+0000b930: 0d0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
+0000b940: 6f61 645f 6465 6661 756c 7432 2870 6572  oad_default2(per
+0000b950: 666f 726d 636c 6173 7369 6679 3d54 7275  formclassify=Tru
+0000b960: 6529 0d0a 0d0a 2020 2020 4074 7265 655f  e)....    @tree_
+0000b970: 7375 626d 656e 7528 5f28 2253 6176 6522  submenu(_("Save"
+0000b980: 2929 0d0a 2020 2020 4074 7265 655f 7661  ))..    @tree_va
+0000b990: 6c75 6573 2822 6f70 6e61 6d65 222c 2076  lues("opname", v
+0000b9a0: 616c 7565 733d 7365 6c66 2e6f 705f 6461  alues=self.op_da
+0000b9b0: 7461 2e73 6563 7469 6f6e 5f73 6574 290d  ta.section_set).
+0000b9c0: 0a20 2020 2040 7472 6565 5f6f 7065 7261  .    @tree_opera
+0000b9d0: 7469 6f6e 2822 7b6f 706e 616d 657d 222c  tion("{opname}",
+0000b9e0: 206e 6f64 655f 7479 7065 3d22 6272 616e   node_type="bran
+0000b9f0: 6368 206f 7073 222c 2068 656c 703d 2222  ch ops", help=""
+0000ba00: 290d 0a20 2020 2064 6566 2073 6176 655f  )..    def save_
+0000ba10: 6d61 7465 7269 616c 7328 6e6f 6465 2c20  materials(node, 
+0000ba20: 6f70 6e61 6d65 3d22 7361 7665 6422 2c20  opname="saved", 
+0000ba30: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
+0000ba40: 2020 2020 7365 6c66 2866 226d 6174 6572      self(f"mater
+0000ba50: 6961 6c20 7361 7665 207b 6f70 6e61 6d65  ial save {opname
+0000ba60: 7d5c 6e22 290d 0a0d 0a20 2020 2040 7472  }\n")....    @tr
+0000ba70: 6565 5f73 6570 6172 6174 6f72 5f62 6566  ee_separator_bef
+0000ba80: 6f72 6528 290d 0a20 2020 2040 7472 6565  ore()..    @tree
+0000ba90: 5f73 7562 6d65 6e75 285f 2822 5361 7665  _submenu(_("Save
+0000baa0: 2229 290d 0a20 2020 2040 7472 6565 5f70  "))..    @tree_p
+0000bab0: 726f 6d70 7428 226f 706e 616d 6522 2c20  rompt("opname", 
+0000bac0: 5f28 224e 616d 6520 746f 2073 746f 7265  _("Name to store
+0000bad0: 2063 7572 7265 6e74 206f 7065 7261 7469   current operati
+0000bae0: 6f6e 7320 756e 6465 723f 2229 290d 0a20  ons under?")).. 
+0000baf0: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
+0000bb00: 6f6e 285f 2822 4e65 7722 292c 206e 6f64  on(_("New"), nod
+0000bb10: 655f 7479 7065 3d22 6272 616e 6368 206f  e_type="branch o
+0000bb20: 7073 222c 2068 656c 703d 2222 290d 0a20  ps", help="").. 
+0000bb30: 2020 2064 6566 2073 6176 655f 6d61 7465     def save_mate
+0000bb40: 7269 616c 5f63 7573 746f 6d28 6e6f 6465  rial_custom(node
+0000bb50: 2c20 6f70 6e61 6d65 2c20 2a2a 6b77 6172  , opname, **kwar
+0000bb60: 6773 293a 0d0a 2020 2020 2020 2020 7365  gs):..        se
+0000bb70: 6c66 2866 226d 6174 6572 6961 6c20 7361  lf(f"material sa
+0000bb80: 7665 207b 6f70 6e61 6d65 2e72 6570 6c61  ve {opname.repla
+0000bb90: 6365 2827 2027 2c20 275f 2729 7d5c 6e22  ce(' ', '_')}\n"
+0000bba0: 290d 0a0d 0a20 2020 2040 7472 6565 5f73  )....    @tree_s
+0000bbb0: 7562 6d65 6e75 285f 2822 4465 6c65 7465  ubmenu(_("Delete
+0000bbc0: 2229 290d 0a20 2020 2040 7472 6565 5f76  "))..    @tree_v
+0000bbd0: 616c 7565 7328 226f 706e 616d 6522 2c20  alues("opname", 
+0000bbe0: 7661 6c75 6573 3d73 656c 662e 6f70 5f64  values=self.op_d
+0000bbf0: 6174 612e 7365 6374 696f 6e5f 7365 7429  ata.section_set)
+0000bc00: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
+0000bc10: 6174 696f 6e28 227b 6f70 6e61 6d65 7d22  ation("{opname}"
+0000bc20: 2c20 6e6f 6465 5f74 7970 653d 2262 7261  , node_type="bra
+0000bc30: 6e63 6820 6f70 7322 2c20 6865 6c70 3d22  nch ops", help="
+0000bc40: 2229 0d0a 2020 2020 6465 6620 7265 6d6f  ")..    def remo
+0000bc50: 7665 5f6f 7073 286e 6f64 652c 206f 706e  ve_ops(node, opn
+0000bc60: 616d 653d 2273 6176 6564 222c 202a 2a6b  ame="saved", **k
+0000bc70: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
+0000bc80: 2073 656c 6628 6622 6d61 7465 7269 616c   self(f"material
+0000bc90: 2064 656c 6574 6520 7b6f 706e 616d 657d   delete {opname}
+0000bca0: 5c6e 2229 0d0a 0d0a 2020 2020 4074 7265  \n")....    @tre
+0000bcb0: 655f 7365 7061 7261 746f 725f 6265 666f  e_separator_befo
+0000bcc0: 7265 2829 0d0a 2020 2020 4074 7265 655f  re()..    @tree_
+0000bcd0: 7375 626d 656e 7528 5f28 2241 7070 656e  submenu(_("Appen
+0000bce0: 6420 6f70 6572 6174 696f 6e22 2929 0d0a  d operation"))..
+0000bcf0: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
+0000bd00: 696f 6e28 5f28 2241 7070 656e 6420 496d  ion(_("Append Im
+0000bd10: 6167 6522 292c 206e 6f64 655f 7479 7065  age"), node_type
+0000bd20: 3d22 6272 616e 6368 206f 7073 222c 2068  ="branch ops", h
+0000bd30: 656c 703d 2222 290d 0a20 2020 2064 6566  elp="")..    def
+0000bd40: 2061 7070 656e 645f 6f70 6572 6174 696f   append_operatio
+0000bd50: 6e5f 696d 6167 6528 6e6f 6465 2c20 706f  n_image(node, po
+0000bd60: 733d 4e6f 6e65 2c20 2a2a 6b77 6172 6773  s=None, **kwargs
+0000bd70: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
+0000bd80: 2e6f 705f 6272 616e 6368 2e61 6464 2822  .op_branch.add("
+0000bd90: 6f70 2069 6d61 6765 222c 2070 6f73 3d70  op image", pos=p
+0000bda0: 6f73 290d 0a20 2020 2020 2020 2073 656c  os)..        sel
+0000bdb0: 662e 7369 676e 616c 2822 7570 6461 7465  f.signal("update
+0000bdc0: 6f70 5f74 7265 6522 290d 0a0d 0a20 2020  op_tree")....   
+0000bdd0: 2040 7472 6565 5f73 7562 6d65 6e75 285f   @tree_submenu(_
+0000bde0: 2822 4170 7065 6e64 206f 7065 7261 7469  ("Append operati
+0000bdf0: 6f6e 2229 290d 0a20 2020 2040 7472 6565  on"))..    @tree
+0000be00: 5f6f 7065 7261 7469 6f6e 285f 2822 4170  _operation(_("Ap
+0000be10: 7065 6e64 2052 6173 7465 7222 292c 206e  pend Raster"), n
+0000be20: 6f64 655f 7479 7065 3d22 6272 616e 6368  ode_type="branch
+0000be30: 206f 7073 222c 2068 656c 703d 2222 290d   ops", help="").
+0000be40: 0a20 2020 2064 6566 2061 7070 656e 645f  .    def append_
+0000be50: 6f70 6572 6174 696f 6e5f 7261 7374 6572  operation_raster
+0000be60: 286e 6f64 652c 2070 6f73 3d4e 6f6e 652c  (node, pos=None,
+0000be70: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
+0000be80: 2020 2020 2073 656c 662e 6f70 5f62 7261       self.op_bra
+0000be90: 6e63 682e 6164 6428 226f 7020 7261 7374  nch.add("op rast
+0000bea0: 6572 222c 2070 6f73 3d70 6f73 290d 0a20  er", pos=pos).. 
+0000beb0: 2020 2020 2020 2073 656c 662e 7369 676e         self.sign
+0000bec0: 616c 2822 7570 6461 7465 6f70 5f74 7265  al("updateop_tre
+0000bed0: 6522 290d 0a0d 0a20 2020 2040 7472 6565  e")....    @tree
+0000bee0: 5f73 7562 6d65 6e75 285f 2822 4170 7065  _submenu(_("Appe
+0000bef0: 6e64 206f 7065 7261 7469 6f6e 2229 290d  nd operation")).
+0000bf00: 0a20 2020 2040 7472 6565 5f6f 7065 7261  .    @tree_opera
+0000bf10: 7469 6f6e 285f 2822 4170 7065 6e64 2045  tion(_("Append E
+0000bf20: 6e67 7261 7665 2229 2c20 6e6f 6465 5f74  ngrave"), node_t
+0000bf30: 7970 653d 2262 7261 6e63 6820 6f70 7322  ype="branch ops"
+0000bf40: 2c20 6865 6c70 3d22 2229 0d0a 2020 2020  , help="")..    
+0000bf50: 6465 6620 6170 7065 6e64 5f6f 7065 7261  def append_opera
+0000bf60: 7469 6f6e 5f65 6e67 7261 7665 286e 6f64  tion_engrave(nod
+0000bf70: 652c 2070 6f73 3d4e 6f6e 652c 202a 2a6b  e, pos=None, **k
+0000bf80: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
+0000bf90: 2073 656c 662e 6f70 5f62 7261 6e63 682e   self.op_branch.
+0000bfa0: 6164 6428 226f 7020 656e 6772 6176 6522  add("op engrave"
+0000bfb0: 2c20 706f 733d 706f 7329 0d0a 2020 2020  , pos=pos)..    
+0000bfc0: 2020 2020 7365 6c66 2e73 6967 6e61 6c28      self.signal(
+0000bfd0: 2275 7064 6174 656f 705f 7472 6565 2229  "updateop_tree")
+0000bfe0: 0d0a 0d0a 2020 2020 4074 7265 655f 7375  ....    @tree_su
+0000bff0: 626d 656e 7528 5f28 2241 7070 656e 6420  bmenu(_("Append 
+0000c000: 6f70 6572 6174 696f 6e22 2929 0d0a 2020  operation"))..  
+0000c010: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
+0000c020: 6e28 5f28 2241 7070 656e 6420 4375 7422  n(_("Append Cut"
+0000c030: 292c 206e 6f64 655f 7479 7065 3d22 6272  ), node_type="br
+0000c040: 616e 6368 206f 7073 222c 2068 656c 703d  anch ops", help=
+0000c050: 2222 290d 0a20 2020 2064 6566 2061 7070  "")..    def app
+0000c060: 656e 645f 6f70 6572 6174 696f 6e5f 6375  end_operation_cu
+0000c070: 7428 6e6f 6465 2c20 706f 733d 4e6f 6e65  t(node, pos=None
+0000c080: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+0000c090: 2020 2020 2020 7365 6c66 2e6f 705f 6272        self.op_br
+0000c0a0: 616e 6368 2e61 6464 2822 6f70 2063 7574  anch.add("op cut
+0000c0b0: 222c 2070 6f73 3d70 6f73 290d 0a20 2020  ", pos=pos)..   
+0000c0c0: 2020 2020 2073 656c 662e 7369 676e 616c       self.signal
+0000c0d0: 2822 7570 6461 7465 6f70 5f74 7265 6522  ("updateop_tree"
+0000c0e0: 290d 0a0d 0a20 2020 2040 7472 6565 5f73  )....    @tree_s
+0000c0f0: 7562 6d65 6e75 285f 2822 4170 7065 6e64  ubmenu(_("Append
+0000c100: 206f 7065 7261 7469 6f6e 2229 290d 0a20   operation")).. 
+0000c110: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
+0000c120: 6f6e 285f 2822 4170 7065 6e64 2048 6174  on(_("Append Hat
+0000c130: 6368 2229 2c20 6e6f 6465 5f74 7970 653d  ch"), node_type=
+0000c140: 2262 7261 6e63 6820 6f70 7322 2c20 6865  "branch ops", he
+0000c150: 6c70 3d22 2229 0d0a 2020 2020 6465 6620  lp="")..    def 
+0000c160: 6170 7065 6e64 5f6f 7065 7261 7469 6f6e  append_operation
+0000c170: 5f68 6174 6368 286e 6f64 652c 2070 6f73  _hatch(node, pos
+0000c180: 3d4e 6f6e 652c 202a 2a6b 7761 7267 7329  =None, **kwargs)
+0000c190: 3a0d 0a20 2020 2020 2020 2073 656c 662e  :..        self.
+0000c1a0: 6f70 5f62 7261 6e63 682e 6164 6428 226f  op_branch.add("o
+0000c1b0: 7020 6861 7463 6822 2c20 706f 733d 706f  p hatch", pos=po
+0000c1c0: 7329 0d0a 2020 2020 2020 2020 7365 6c66  s)..        self
+0000c1d0: 2e73 6967 6e61 6c28 2275 7064 6174 656f  .signal("updateo
+0000c1e0: 705f 7472 6565 2229 0d0a 0d0a 2020 2020  p_tree")....    
+0000c1f0: 4074 7265 655f 7375 626d 656e 7528 5f28  @tree_submenu(_(
+0000c200: 2241 7070 656e 6420 6f70 6572 6174 696f  "Append operatio
+0000c210: 6e22 2929 0d0a 2020 2020 4074 7265 655f  n"))..    @tree_
+0000c220: 6f70 6572 6174 696f 6e28 5f28 2241 7070  operation(_("App
+0000c230: 656e 6420 446f 7473 2229 2c20 6e6f 6465  end Dots"), node
+0000c240: 5f74 7970 653d 2262 7261 6e63 6820 6f70  _type="branch op
+0000c250: 7322 2c20 6865 6c70 3d22 2229 0d0a 2020  s", help="")..  
+0000c260: 2020 6465 6620 6170 7065 6e64 5f6f 7065    def append_ope
+0000c270: 7261 7469 6f6e 5f64 6f74 7328 6e6f 6465  ration_dots(node
+0000c280: 2c20 706f 733d 4e6f 6e65 2c20 2a2a 6b77  , pos=None, **kw
+0000c290: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
+0000c2a0: 7365 6c66 2e6f 705f 6272 616e 6368 2e61  self.op_branch.a
+0000c2b0: 6464 2822 6f70 2064 6f74 7322 2c20 706f  dd("op dots", po
+0000c2c0: 733d 706f 7329 0d0a 2020 2020 2020 2020  s=pos)..        
+0000c2d0: 7365 6c66 2e73 6967 6e61 6c28 2275 7064  self.signal("upd
+0000c2e0: 6174 656f 705f 7472 6565 2229 0d0a 0d0a  ateop_tree")....
+0000c2f0: 2020 2020 4074 7265 655f 7375 626d 656e      @tree_submen
+0000c300: 7528 5f28 2241 7070 656e 6420 7370 6563  u(_("Append spec
+0000c310: 6961 6c20 6f70 6572 6174 696f 6e28 7329  ial operation(s)
+0000c320: 2229 290d 0a20 2020 2040 7472 6565 5f6f  "))..    @tree_o
+0000c330: 7065 7261 7469 6f6e 285f 2822 4170 7065  peration(_("Appe
+0000c340: 6e64 2048 6f6d 6522 292c 206e 6f64 655f  nd Home"), node_
+0000c350: 7479 7065 3d22 6272 616e 6368 206f 7073  type="branch ops
+0000c360: 222c 2068 656c 703d 2222 290d 0a20 2020  ", help="")..   
+0000c370: 2064 6566 2061 7070 656e 645f 6f70 6572   def append_oper
+0000c380: 6174 696f 6e5f 686f 6d65 286e 6f64 652c  ation_home(node,
+0000c390: 2070 6f73 3d4e 6f6e 652c 202a 2a6b 7761   pos=None, **kwa
+0000c3a0: 7267 7329 3a0d 0a20 2020 2020 2020 2073  rgs):..        s
+0000c3b0: 656c 662e 6f70 5f62 7261 6e63 682e 6164  elf.op_branch.ad
+0000c3c0: 6428 7479 7065 3d22 7574 696c 2068 6f6d  d(type="util hom
+0000c3d0: 6522 2c20 706f 733d 706f 7329 0d0a 2020  e", pos=pos)..  
+0000c3e0: 2020 2020 2020 7365 6c66 2e73 6967 6e61        self.signa
+0000c3f0: 6c28 2275 7064 6174 656f 705f 7472 6565  l("updateop_tree
+0000c400: 2229 0d0a 0d0a 2020 2020 4074 7265 655f  ")....    @tree_
+0000c410: 7375 626d 656e 7528 5f28 2241 7070 656e  submenu(_("Appen
+0000c420: 6420 7370 6563 6961 6c20 6f70 6572 6174  d special operat
+0000c430: 696f 6e28 7329 2229 290d 0a20 2020 2040  ion(s)"))..    @
+0000c440: 7472 6565 5f6f 7065 7261 7469 6f6e 285f  tree_operation(_
+0000c450: 2822 4170 7065 6e64 2052 6574 7572 6e20  ("Append Return 
+0000c460: 746f 204f 7269 6769 6e22 292c 206e 6f64  to Origin"), nod
+0000c470: 655f 7479 7065 3d22 6272 616e 6368 206f  e_type="branch o
+0000c480: 7073 222c 2068 656c 703d 2222 290d 0a20  ps", help="").. 
+0000c490: 2020 2064 6566 2061 7070 656e 645f 6f70     def append_op
+0000c4a0: 6572 6174 696f 6e5f 676f 746f 286e 6f64  eration_goto(nod
+0000c4b0: 652c 2070 6f73 3d4e 6f6e 652c 202a 2a6b  e, pos=None, **k
+0000c4c0: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
+0000c4d0: 2073 656c 662e 6f70 5f62 7261 6e63 682e   self.op_branch.
+0000c4e0: 6164 6428 7479 7065 3d22 7574 696c 2067  add(type="util g
+0000c4f0: 6f74 6f22 2c20 706f 733d 706f 732c 2078  oto", pos=pos, x
+0000c500: 3d30 2c20 793d 3029 0d0a 2020 2020 2020  =0, y=0)..      
+0000c510: 2020 7365 6c66 2e73 6967 6e61 6c28 2275    self.signal("u
+0000c520: 7064 6174 656f 705f 7472 6565 2229 0d0a  pdateop_tree")..
+0000c530: 0d0a 2020 2020 4074 7265 655f 7375 626d  ..    @tree_subm
+0000c540: 656e 7528 5f28 2241 7070 656e 6420 7370  enu(_("Append sp
+0000c550: 6563 6961 6c20 6f70 6572 6174 696f 6e28  ecial operation(
+0000c560: 7329 2229 290d 0a20 2020 2040 7472 6565  s)"))..    @tree
+0000c570: 5f6f 7065 7261 7469 6f6e 280d 0a20 2020  _operation(..   
+0000c580: 2020 2020 205f 2822 4170 7065 6e64 2053       _("Append S
+0000c590: 6574 204f 7269 6769 6e22 292c 0d0a 2020  et Origin"),..  
+0000c5a0: 2020 2020 2020 6e6f 6465 5f74 7970 653d        node_type=
+0000c5b0: 2262 7261 6e63 6820 6f70 7322 2c0d 0a20  "branch ops",.. 
+0000c5c0: 2020 2020 2020 2068 656c 703d 2222 2c0d         help="",.
+0000c5d0: 0a20 2020 2029 0d0a 2020 2020 6465 6620  .    )..    def 
+0000c5e0: 6170 7065 6e64 5f6f 7065 7261 7469 6f6e  append_operation
+0000c5f0: 5f73 6574 6f72 6967 696e 286e 6f64 652c  _setorigin(node,
+0000c600: 2070 6f73 3d4e 6f6e 652c 202a 2a6b 7761   pos=None, **kwa
+0000c610: 7267 7329 3a0d 0a20 2020 2020 2020 2073  rgs):..        s
+0000c620: 656c 662e 6f70 5f62 7261 6e63 682e 6164  elf.op_branch.ad
+0000c630: 6428 0d0a 2020 2020 2020 2020 2020 2020  d(..            
+0000c640: 7479 7065 3d22 7574 696c 206f 7269 6769  type="util origi
+0000c650: 6e22 2c0d 0a20 2020 2020 2020 2020 2020  n",..           
+0000c660: 2070 6f73 3d70 6f73 2c0d 0a20 2020 2020   pos=pos,..     
+0000c670: 2020 2020 2020 2078 3d4e 6f6e 652c 0d0a         x=None,..
+0000c680: 2020 2020 2020 2020 2020 2020 793d 4e6f              y=No
+0000c690: 6e65 2c0d 0a20 2020 2020 2020 2029 0d0a  ne,..        )..
+0000c6a0: 2020 2020 2020 2020 7365 6c66 2e73 6967          self.sig
+0000c6b0: 6e61 6c28 2275 7064 6174 656f 705f 7472  nal("updateop_tr
+0000c6c0: 6565 2229 0d0a 0d0a 2020 2020 4074 7265  ee")....    @tre
+0000c6d0: 655f 7375 626d 656e 7528 5f28 2241 7070  e_submenu(_("App
+0000c6e0: 656e 6420 7370 6563 6961 6c20 6f70 6572  end special oper
+0000c6f0: 6174 696f 6e28 7329 2229 290d 0a20 2020  ation(s)"))..   
+0000c700: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
+0000c710: 285f 2822 4170 7065 6e64 2042 6565 7022  (_("Append Beep"
+0000c720: 292c 206e 6f64 655f 7479 7065 3d22 6272  ), node_type="br
+0000c730: 616e 6368 206f 7073 222c 2068 656c 703d  anch ops", help=
+0000c740: 2222 290d 0a20 2020 2064 6566 2061 7070  "")..    def app
+0000c750: 656e 645f 6f70 6572 6174 696f 6e5f 6265  end_operation_be
+0000c760: 6570 286e 6f64 652c 2070 6f73 3d4e 6f6e  ep(node, pos=Non
+0000c770: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
+0000c780: 2020 2020 2020 2073 656c 662e 6f70 5f62         self.op_b
+0000c790: 7261 6e63 682e 6164 6428 0d0a 2020 2020  ranch.add(..    
+0000c7a0: 2020 2020 2020 2020 7479 7065 3d22 7574          type="ut
+0000c7b0: 696c 2063 6f6e 736f 6c65 222c 0d0a 2020  il console",..  
+0000c7c0: 2020 2020 2020 2020 2020 706f 733d 706f            pos=po
+0000c7d0: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
+0000c7e0: 636f 6d6d 616e 643d 2262 6565 7022 2c0d  command="beep",.
+0000c7f0: 0a20 2020 2020 2020 2029 0d0a 2020 2020  .        )..    
+0000c800: 2020 2020 7365 6c66 2e73 6967 6e61 6c28      self.signal(
+0000c810: 2275 7064 6174 656f 705f 7472 6565 2229  "updateop_tree")
+0000c820: 0d0a 0d0a 2020 2020 4074 7265 655f 7375  ....    @tree_su
+0000c830: 626d 656e 7528 5f28 2241 7070 656e 6420  bmenu(_("Append 
+0000c840: 7370 6563 6961 6c20 6f70 6572 6174 696f  special operatio
+0000c850: 6e28 7329 2229 290d 0a20 2020 2040 7472  n(s)"))..    @tr
+0000c860: 6565 5f6f 7065 7261 7469 6f6e 285f 2822  ee_operation(_("
+0000c870: 4170 7065 6e64 2049 6e74 6572 7275 7074  Append Interrupt
+0000c880: 2229 2c20 6e6f 6465 5f74 7970 653d 2262  "), node_type="b
+0000c890: 7261 6e63 6820 6f70 7322 2c20 6865 6c70  ranch ops", help
+0000c8a0: 3d22 2229 0d0a 2020 2020 6465 6620 6170  ="")..    def ap
+0000c8b0: 7065 6e64 5f6f 7065 7261 7469 6f6e 5f69  pend_operation_i
+0000c8c0: 6e74 6572 7275 7074 286e 6f64 652c 2070  nterrupt(node, p
+0000c8d0: 6f73 3d4e 6f6e 652c 202a 2a6b 7761 7267  os=None, **kwarg
+0000c8e0: 7329 3a0d 0a20 2020 2020 2020 2073 656c  s):..        sel
+0000c8f0: 662e 6f70 5f62 7261 6e63 682e 6164 6428  f.op_branch.add(
+0000c900: 0d0a 2020 2020 2020 2020 2020 2020 7479  ..            ty
+0000c910: 7065 3d22 7574 696c 2063 6f6e 736f 6c65  pe="util console
+0000c920: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+0000c930: 706f 733d 706f 732c 0d0a 2020 2020 2020  pos=pos,..      
+0000c940: 2020 2020 2020 636f 6d6d 616e 643d 2769        command='i
+0000c950: 6e74 6572 7275 7074 2022 5370 6f6f 6c69  nterrupt "Spooli
+0000c960: 6e67 2077 6173 2069 6e74 6572 7275 7074  ng was interrupt
+0000c970: 6564 2227 2c0d 0a20 2020 2020 2020 2029  ed"',..        )
+0000c980: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+0000c990: 6967 6e61 6c28 2275 7064 6174 656f 705f  ignal("updateop_
+0000c9a0: 7472 6565 2229 0d0a 0d0a 2020 2020 4074  tree")....    @t
+0000c9b0: 7265 655f 7375 626d 656e 7528 5f28 2241  ree_submenu(_("A
+0000c9c0: 7070 656e 6420 7370 6563 6961 6c20 6f70  ppend special op
+0000c9d0: 6572 6174 696f 6e28 7329 2229 290d 0a20  eration(s)")).. 
+0000c9e0: 2020 2040 7472 6565 5f70 726f 6d70 7428     @tree_prompt(
+0000c9f0: 2277 6169 745f 7469 6d65 222c 205f 2822  "wait_time", _("
+0000ca00: 5761 6974 2066 6f72 2068 6f77 206c 6f6e  Wait for how lon
+0000ca10: 6720 2869 6e20 7365 636f 6e64 7329 3f22  g (in seconds)?"
+0000ca20: 292c 2064 6174 615f 7479 7065 3d66 6c6f  ), data_type=flo
+0000ca30: 6174 290d 0a20 2020 2040 7472 6565 5f6f  at)..    @tree_o
+0000ca40: 7065 7261 7469 6f6e 285f 2822 4170 7065  peration(_("Appe
+0000ca50: 6e64 2057 6169 7422 292c 206e 6f64 655f  nd Wait"), node_
+0000ca60: 7479 7065 3d22 6272 616e 6368 206f 7073  type="branch ops
+0000ca70: 222c 2068 656c 703d 2222 290d 0a20 2020  ", help="")..   
+0000ca80: 2064 6566 2061 7070 656e 645f 6f70 6572   def append_oper
+0000ca90: 6174 696f 6e5f 7761 6974 286e 6f64 652c  ation_wait(node,
+0000caa0: 2077 6169 745f 7469 6d65 2c20 706f 733d   wait_time, pos=
+0000cab0: 4e6f 6e65 2c20 2a2a 6b77 6172 6773 293a  None, **kwargs):
+0000cac0: 0d0a 2020 2020 2020 2020 7365 6c66 2e6f  ..        self.o
+0000cad0: 705f 6272 616e 6368 2e61 6464 280d 0a20  p_branch.add(.. 
+0000cae0: 2020 2020 2020 2020 2020 2074 7970 653d             type=
+0000caf0: 2275 7469 6c20 7761 6974 222c 0d0a 2020  "util wait",..  
+0000cb00: 2020 2020 2020 2020 2020 706f 733d 706f            pos=po
+0000cb10: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
+0000cb20: 7761 6974 3d77 6169 745f 7469 6d65 2c0d  wait=wait_time,.
+0000cb30: 0a20 2020 2020 2020 2029 0d0a 2020 2020  .        )..    
+0000cb40: 2020 2020 7365 6c66 2e73 6967 6e61 6c28      self.signal(
+0000cb50: 2275 7064 6174 656f 705f 7472 6565 2229  "updateop_tree")
+0000cb60: 0d0a 0d0a 2020 2020 4074 7265 655f 7375  ....    @tree_su
+0000cb70: 626d 656e 7528 5f28 2241 7070 656e 6420  bmenu(_("Append 
+0000cb80: 7370 6563 6961 6c20 6f70 6572 6174 696f  special operatio
+0000cb90: 6e28 7329 2229 290d 0a20 2020 2040 7472  n(s)"))..    @tr
+0000cba0: 6565 5f6f 7065 7261 7469 6f6e 285f 2822  ee_operation(_("
+0000cbb0: 4170 7065 6e64 204f 7574 7075 7422 292c  Append Output"),
+0000cbc0: 206e 6f64 655f 7479 7065 3d22 6272 616e   node_type="bran
+0000cbd0: 6368 206f 7073 222c 2068 656c 703d 2222  ch ops", help=""
+0000cbe0: 290d 0a20 2020 2064 6566 2061 7070 656e  )..    def appen
+0000cbf0: 645f 6f70 6572 6174 696f 6e5f 6f75 7470  d_operation_outp
+0000cc00: 7574 286e 6f64 652c 2070 6f73 3d4e 6f6e  ut(node, pos=Non
+0000cc10: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
+0000cc20: 2020 2020 2020 2073 656c 662e 6f70 5f62         self.op_b
+0000cc30: 7261 6e63 682e 6164 6428 0d0a 2020 2020  ranch.add(..    
+0000cc40: 2020 2020 2020 2020 7479 7065 3d22 7574          type="ut
+0000cc50: 696c 206f 7574 7075 7422 2c0d 0a20 2020  il output",..   
+0000cc60: 2020 2020 2020 2020 2070 6f73 3d70 6f73           pos=pos
+0000cc70: 2c0d 0a20 2020 2020 2020 2020 2020 206f  ,..            o
+0000cc80: 7574 7075 745f 6d61 736b 3d30 2c0d 0a20  utput_mask=0,.. 
+0000cc90: 2020 2020 2020 2020 2020 206f 7574 7075             outpu
+0000cca0: 745f 7661 6c75 653d 302c 0d0a 2020 2020  t_value=0,..    
+0000ccb0: 2020 2020 2020 2020 6f75 7470 7574 5f6d          output_m
+0000ccc0: 6573 7361 6765 3d4e 6f6e 652c 0d0a 2020  essage=None,..  
+0000ccd0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+0000cce0: 2073 656c 662e 7369 676e 616c 2822 7570   self.signal("up
+0000ccf0: 6461 7465 6f70 5f74 7265 6522 290d 0a0d  dateop_tree")...
+0000cd00: 0a20 2020 2040 7472 6565 5f73 7562 6d65  .    @tree_subme
+0000cd10: 6e75 285f 2822 4170 7065 6e64 2073 7065  nu(_("Append spe
+0000cd20: 6369 616c 206f 7065 7261 7469 6f6e 2873  cial operation(s
+0000cd30: 2922 2929 0d0a 2020 2020 4074 7265 655f  )"))..    @tree_
+0000cd40: 6f70 6572 6174 696f 6e28 5f28 2241 7070  operation(_("App
+0000cd50: 656e 6420 496e 7075 7422 292c 206e 6f64  end Input"), nod
+0000cd60: 655f 7479 7065 3d22 6272 616e 6368 206f  e_type="branch o
+0000cd70: 7073 222c 2068 656c 703d 2222 290d 0a20  ps", help="").. 
+0000cd80: 2020 2064 6566 2061 7070 656e 645f 6f70     def append_op
+0000cd90: 6572 6174 696f 6e5f 696e 7075 7428 6e6f  eration_input(no
+0000cda0: 6465 2c20 706f 733d 4e6f 6e65 2c20 2a2a  de, pos=None, **
+0000cdb0: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
+0000cdc0: 2020 7365 6c66 2e6f 705f 6272 616e 6368    self.op_branch
+0000cdd0: 2e61 6464 280d 0a20 2020 2020 2020 2020  .add(..         
+0000cde0: 2020 2074 7970 653d 2275 7469 6c20 696e     type="util in
+0000cdf0: 7075 7422 2c0d 0a20 2020 2020 2020 2020  put",..         
+0000ce00: 2020 2070 6f73 3d70 6f73 2c0d 0a20 2020     pos=pos,..   
+0000ce10: 2020 2020 2020 2020 2069 6e70 7574 5f6d           input_m
+0000ce20: 6173 6b3d 302c 0d0a 2020 2020 2020 2020  ask=0,..        
+0000ce30: 2020 2020 696e 7075 745f 7661 6c75 653d      input_value=
+0000ce40: 302c 0d0a 2020 2020 2020 2020 2020 2020  0,..            
+0000ce50: 696e 7075 745f 6d65 7373 6167 653d 4e6f  input_message=No
+0000ce60: 6e65 2c0d 0a20 2020 2020 2020 2029 0d0a  ne,..        )..
+0000ce70: 2020 2020 2020 2020 7365 6c66 2e73 6967          self.sig
+0000ce80: 6e61 6c28 2275 7064 6174 656f 705f 7472  nal("updateop_tr
+0000ce90: 6565 2229 0d0a 0d0a 2020 2020 4074 7265  ee")....    @tre
+0000cea0: 655f 7375 626d 656e 7528 5f28 2241 7070  e_submenu(_("App
+0000ceb0: 656e 6420 7370 6563 6961 6c20 6f70 6572  end special oper
+0000cec0: 6174 696f 6e28 7329 2229 290d 0a20 2020  ation(s)"))..   
+0000ced0: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
+0000cee0: 285f 2822 4170 7065 6e64 2048 6f6d 652f  (_("Append Home/
+0000cef0: 4265 6570 2f49 6e74 6572 7275 7074 2229  Beep/Interrupt")
+0000cf00: 2c20 6e6f 6465 5f74 7970 653d 2262 7261  , node_type="bra
+0000cf10: 6e63 6820 6f70 7322 2c20 6865 6c70 3d22  nch ops", help="
+0000cf20: 2229 0d0a 2020 2020 6465 6620 6170 7065  ")..    def appe
+0000cf30: 6e64 5f6f 7065 7261 7469 6f6e 5f68 6f6d  nd_operation_hom
+0000cf40: 655f 6265 6570 5f69 6e74 6572 7275 7074  e_beep_interrupt
+0000cf50: 286e 6f64 652c 202a 2a6b 7761 7267 7329  (node, **kwargs)
+0000cf60: 3a0d 0a20 2020 2020 2020 2061 7070 656e  :..        appen
+0000cf70: 645f 6f70 6572 6174 696f 6e5f 686f 6d65  d_operation_home
+0000cf80: 286e 6f64 652c 202a 2a6b 7761 7267 7329  (node, **kwargs)
+0000cf90: 0d0a 2020 2020 2020 2020 6170 7065 6e64  ..        append
+0000cfa0: 5f6f 7065 7261 7469 6f6e 5f62 6565 7028  _operation_beep(
+0000cfb0: 6e6f 6465 2c20 2a2a 6b77 6172 6773 290d  node, **kwargs).
+0000cfc0: 0a20 2020 2020 2020 2061 7070 656e 645f  .        append_
+0000cfd0: 6f70 6572 6174 696f 6e5f 696e 7465 7272  operation_interr
+0000cfe0: 7570 7428 6e6f 6465 2c20 2a2a 6b77 6172  upt(node, **kwar
+0000cff0: 6773 290d 0a20 2020 2020 2020 2073 656c  gs)..        sel
+0000d000: 662e 7369 676e 616c 2822 7570 6461 7465  f.signal("update
+0000d010: 6f70 5f74 7265 6522 290d 0a0d 0a20 2020  op_tree")....   
+0000d020: 2040 7472 6565 5f73 7562 6d65 6e75 285f   @tree_submenu(_
+0000d030: 2822 4170 7065 6e64 2073 7065 6369 616c  ("Append special
+0000d040: 206f 7065 7261 7469 6f6e 2873 2922 2929   operation(s)"))
+0000d050: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
+0000d060: 6174 696f 6e28 5f28 2241 7070 656e 6420  ation(_("Append 
+0000d070: 4f72 6967 696e 2f42 6565 702f 496e 7465  Origin/Beep/Inte
+0000d080: 7272 7570 7422 292c 206e 6f64 655f 7479  rrupt"), node_ty
+0000d090: 7065 3d22 6272 616e 6368 206f 7073 222c  pe="branch ops",
+0000d0a0: 2068 656c 703d 2222 290d 0a20 2020 2064   help="")..    d
+0000d0b0: 6566 2061 7070 656e 645f 6f70 6572 6174  ef append_operat
+0000d0c0: 696f 6e5f 6f72 6967 696e 5f62 6565 705f  ion_origin_beep_
+0000d0d0: 696e 7465 7272 7570 7428 6e6f 6465 2c20  interrupt(node, 
+0000d0e0: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
+0000d0f0: 2020 2020 6170 7065 6e64 5f6f 7065 7261      append_opera
+0000d100: 7469 6f6e 5f67 6f74 6f28 6e6f 6465 2c20  tion_goto(node, 
+0000d110: 2a2a 6b77 6172 6773 290d 0a20 2020 2020  **kwargs)..     
+0000d120: 2020 2061 7070 656e 645f 6f70 6572 6174     append_operat
+0000d130: 696f 6e5f 6265 6570 286e 6f64 652c 202a  ion_beep(node, *
+0000d140: 2a6b 7761 7267 7329 0d0a 2020 2020 2020  *kwargs)..      
+0000d150: 2020 6170 7065 6e64 5f6f 7065 7261 7469    append_operati
+0000d160: 6f6e 5f69 6e74 6572 7275 7074 286e 6f64  on_interrupt(nod
+0000d170: 652c 202a 2a6b 7761 7267 7329 0d0a 2020  e, **kwargs)..  
+0000d180: 2020 2020 2020 7365 6c66 2e73 6967 6e61        self.signa
+0000d190: 6c28 2275 7064 6174 656f 705f 7472 6565  l("updateop_tree
+0000d1a0: 2229 0d0a 0d0a 2020 2020 4074 7265 655f  ")....    @tree_
+0000d1b0: 7375 626d 656e 7528 5f28 2241 7070 656e  submenu(_("Appen
+0000d1c0: 6420 7370 6563 6961 6c20 6f70 6572 6174  d special operat
+0000d1d0: 696f 6e28 7329 2229 290d 0a20 2020 2040  ion(s)"))..    @
+0000d1e0: 7472 6565 5f6f 7065 7261 7469 6f6e 285f  tree_operation(_
+0000d1f0: 2822 4170 7065 6e64 2053 6875 7464 6f77  ("Append Shutdow
+0000d200: 6e22 292c 206e 6f64 655f 7479 7065 3d22  n"), node_type="
+0000d210: 6272 616e 6368 206f 7073 222c 2068 656c  branch ops", hel
+0000d220: 703d 2222 290d 0a20 2020 2064 6566 2061  p="")..    def a
+0000d230: 7070 656e 645f 6f70 6572 6174 696f 6e5f  ppend_operation_
+0000d240: 7368 7574 646f 776e 286e 6f64 652c 2070  shutdown(node, p
+0000d250: 6f73 3d4e 6f6e 652c 202a 2a6b 7761 7267  os=None, **kwarg
+0000d260: 7329 3a0d 0a20 2020 2020 2020 2073 656c  s):..        sel
+0000d270: 662e 6f70 5f62 7261 6e63 682e 6164 6428  f.op_branch.add(
+0000d280: 0d0a 2020 2020 2020 2020 2020 2020 7479  ..            ty
+0000d290: 7065 3d22 7574 696c 2063 6f6e 736f 6c65  pe="util console
+0000d2a0: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+0000d2b0: 706f 733d 706f 732c 0d0a 2020 2020 2020  pos=pos,..      
+0000d2c0: 2020 2020 2020 636f 6d6d 616e 643d 2271        command="q
+0000d2d0: 7569 7422 2c0d 0a20 2020 2020 2020 2029  uit",..        )
+0000d2e0: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+0000d2f0: 6967 6e61 6c28 2275 7064 6174 656f 705f  ignal("updateop_
+0000d300: 7472 6565 2229 0d0a 0d0a 2020 2020 4074  tree")....    @t
+0000d310: 7265 655f 7375 626d 656e 7528 5f28 2241  ree_submenu(_("A
+0000d320: 7070 656e 6420 7370 6563 6961 6c20 6f70  ppend special op
+0000d330: 6572 6174 696f 6e28 7329 2229 290d 0a20  eration(s)")).. 
+0000d340: 2020 2040 7472 6565 5f70 726f 6d70 7428     @tree_prompt(
+0000d350: 226f 706e 616d 6522 2c20 5f28 2243 6f6e  "opname", _("Con
+0000d360: 736f 6c65 2063 6f6d 6d61 6e64 2074 6f20  sole command to 
+0000d370: 6170 7065 6e64 2074 6f20 6f70 6572 6174  append to operat
+0000d380: 696f 6e73 3f22 2929 0d0a 2020 2020 4074  ions?"))..    @t
+0000d390: 7265 655f 6f70 6572 6174 696f 6e28 5f28  ree_operation(_(
+0000d3a0: 2241 7070 656e 6420 436f 6e73 6f6c 6522  "Append Console"
+0000d3b0: 292c 206e 6f64 655f 7479 7065 3d22 6272  ), node_type="br
+0000d3c0: 616e 6368 206f 7073 222c 2068 656c 703d  anch ops", help=
+0000d3d0: 2222 290d 0a20 2020 2064 6566 2061 7070  "")..    def app
+0000d3e0: 656e 645f 6f70 6572 6174 696f 6e5f 6375  end_operation_cu
+0000d3f0: 7374 6f6d 286e 6f64 652c 206f 706e 616d  stom(node, opnam
+0000d400: 652c 2070 6f73 3d4e 6f6e 652c 202a 2a6b  e, pos=None, **k
+0000d410: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
+0000d420: 2073 656c 662e 6f70 5f62 7261 6e63 682e   self.op_branch.
+0000d430: 6164 6428 0d0a 2020 2020 2020 2020 2020  add(..          
+0000d440: 2020 7479 7065 3d22 7574 696c 2063 6f6e    type="util con
+0000d450: 736f 6c65 222c 0d0a 2020 2020 2020 2020  sole",..        
+0000d460: 2020 2020 706f 733d 706f 732c 0d0a 2020      pos=pos,..  
+0000d470: 2020 2020 2020 2020 2020 636f 6d6d 616e            comman
+0000d480: 643d 6f70 6e61 6d65 2c0d 0a20 2020 2020  d=opname,..     
+0000d490: 2020 2029 0d0a 2020 2020 2020 2020 7365     )..        se
+0000d4a0: 6c66 2e73 6967 6e61 6c28 2275 7064 6174  lf.signal("updat
+0000d4b0: 656f 705f 7472 6565 2229 0d0a 0d0a 2020  eop_tree")....  
+0000d4c0: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
+0000d4d0: 6e28 5f28 2252 6563 6c61 7373 6966 7920  n(_("Reclassify 
+0000d4e0: 6f70 6572 6174 696f 6e73 2229 2c20 6e6f  operations"), no
+0000d4f0: 6465 5f74 7970 653d 2262 7261 6e63 6820  de_type="branch 
+0000d500: 656c 656d 7322 2c20 6865 6c70 3d22 2229  elems", help="")
+0000d510: 0d0a 2020 2020 6465 6620 7265 636c 6173  ..    def reclas
+0000d520: 7369 6679 5f6f 7065 7261 7469 6f6e 7328  sify_operations(
+0000d530: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
+0000d540: 0d0a 2020 2020 2020 2020 656c 656d 7320  ..        elems 
+0000d550: 3d20 6c69 7374 2873 656c 662e 656c 656d  = list(self.elem
+0000d560: 7328 2929 0d0a 2020 2020 2020 2020 7365  s())..        se
+0000d570: 6c66 2e72 656d 6f76 655f 656c 656d 656e  lf.remove_elemen
+0000d580: 7473 5f66 726f 6d5f 6f70 6572 6174 696f  ts_from_operatio
+0000d590: 6e73 2865 6c65 6d73 290d 0a20 2020 2020  ns(elems)..     
+0000d5a0: 2020 2073 656c 662e 636c 6173 7369 6679     self.classify
+0000d5b0: 286c 6973 7428 7365 6c66 2e65 6c65 6d73  (list(self.elems
+0000d5c0: 2829 2929 0d0a 2020 2020 2020 2020 7365  ()))..        se
+0000d5d0: 6c66 2e73 6967 6e61 6c28 2272 6566 7265  lf.signal("refre
+0000d5e0: 7368 5f74 7265 6522 290d 0a0d 0a20 2020  sh_tree")....   
+0000d5f0: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
+0000d600: 280d 0a20 2020 2020 2020 205f 2822 5265  (..        _("Re
+0000d610: 6d6f 7665 2061 6c6c 2061 7373 6967 6e6d  move all assignm
+0000d620: 656e 7473 2066 726f 6d20 6f70 6572 6174  ents from operat
+0000d630: 696f 6e73 2229 2c0d 0a20 2020 2020 2020  ions"),..       
+0000d640: 206e 6f64 655f 7479 7065 3d22 6272 616e   node_type="bran
+0000d650: 6368 2065 6c65 6d73 222c 0d0a 2020 2020  ch elems",..    
+0000d660: 2020 2020 6865 6c70 3d5f 2822 416e 7920      help=_("Any 
+0000d670: 6578 6973 7469 6e67 2061 7373 6967 6e6d  existing assignm
+0000d680: 656e 7420 6f66 2065 6c65 6d65 6e74 7320  ent of elements 
+0000d690: 746f 206f 7065 7261 7469 6f6e 7320 7769  to operations wi
+0000d6a0: 6c6c 2062 6520 7265 6d6f 7665 6422 292c  ll be removed"),
+0000d6b0: 0d0a 2020 2020 290d 0a20 2020 2064 6566  ..    )..    def
+0000d6c0: 2072 656d 6f76 655f 616c 6c5f 6173 7369   remove_all_assi
+0000d6d0: 676e 6d65 6e74 7328 6e6f 6465 2c20 2a2a  gnments(node, **
+0000d6e0: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
+0000d6f0: 2020 7769 7468 2073 656c 662e 7374 6174    with self.stat
+0000d700: 6963 2822 7265 6d6f 7665 5f61 6c6c 5f61  ic("remove_all_a
+0000d710: 7373 6967 6e22 293a 0d0a 2020 2020 2020  ssign"):..      
+0000d720: 2020 2020 2020 666f 7220 6e6f 6465 2069        for node i
+0000d730: 6e20 7365 6c66 2e65 6c65 6d73 2829 3a0d  n self.elems():.
+0000d740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d750: 2066 6f72 2072 6566 2069 6e20 6c69 7374   for ref in list
+0000d760: 286e 6f64 652e 7265 6665 7265 6e63 6573  (node.references
+0000d770: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0000d780: 2020 2020 2020 2020 7265 662e 7265 6d6f          ref.remo
+0000d790: 7665 5f6e 6f64 6528 290d 0a20 2020 2020  ve_node()..     
+0000d7a0: 2020 2073 656c 662e 7369 676e 616c 2822     self.signal("
+0000d7b0: 7265 6672 6573 685f 7472 6565 2229 0d0a  refresh_tree")..
+0000d7c0: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
+0000d7d0: 6174 696f 6e28 0d0a 2020 2020 2020 2020  ation(..        
+0000d7e0: 5f28 2244 7570 6c69 6361 7465 206f 7065  _("Duplicate ope
+0000d7f0: 7261 7469 6f6e 2873 2922 292c 0d0a 2020  ration(s)"),..  
+0000d800: 2020 2020 2020 6e6f 6465 5f74 7970 653d        node_type=
+0000d810: 6f70 5f6e 6f64 6573 2c0d 0a20 2020 2020  op_nodes,..     
+0000d820: 2020 2068 656c 703d 5f28 2264 7570 6c69     help=_("dupli
+0000d830: 6361 7465 206f 7065 7261 7469 6f6e 206e  cate operation n
+0000d840: 6f64 6573 2229 2c0d 0a20 2020 2029 0d0a  odes"),..    )..
+0000d850: 2020 2020 6465 6620 6475 706c 6963 6174      def duplicat
+0000d860: 655f 6f70 6572 6174 696f 6e28 6e6f 6465  e_operation(node
+0000d870: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+0000d880: 2020 2020 2020 7769 7468 2073 656c 662e        with self.
+0000d890: 7374 6174 6963 2822 6475 706c 6963 6174  static("duplicat
+0000d8a0: 655f 6f70 6572 6174 696f 6e22 293a 0d0a  e_operation"):..
+0000d8b0: 2020 2020 2020 2020 2020 2020 6f70 6572              oper
+0000d8c0: 6174 696f 6e73 203d 2073 656c 662e 5f74  ations = self._t
+0000d8d0: 7265 652e 6765 7428 7479 7065 3d22 6272  ree.get(type="br
+0000d8e0: 616e 6368 206f 7073 2229 2e63 6869 6c64  anch ops").child
+0000d8f0: 7265 6e0d 0a20 2020 2020 2020 2020 2020  ren..           
+0000d900: 2066 6f72 206f 7020 696e 2073 656c 662e   for op in self.
+0000d910: 6f70 7328 7365 6c65 6374 6564 3d54 7275  ops(selected=Tru
+0000d920: 6529 3a0d 0a20 2020 2020 2020 2020 2020  e):..           
+0000d930: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
+0000d940: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000d950: 6f73 203d 206f 7065 7261 7469 6f6e 732e  os = operations.
+0000d960: 696e 6465 7828 6f70 2920 2b20 310d 0a20  index(op) + 1.. 
+0000d970: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000d980: 7863 6570 7420 5661 6c75 6545 7272 6f72  xcept ValueError
+0000d990: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000d9a0: 2020 2020 2020 2070 6f73 203d 204e 6f6e         pos = Non
+0000d9b0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+0000d9c0: 2020 2063 6f70 795f 6f70 203d 2063 6f70     copy_op = cop
+0000d9d0: 7928 6f70 290d 0a20 2020 2020 2020 2020  y(op)..         
+0000d9e0: 2020 2020 2020 2073 656c 662e 6164 645f         self.add_
+0000d9f0: 6f70 2863 6f70 795f 6f70 2c20 706f 733d  op(copy_op, pos=
+0000da00: 706f 7329 0d0a 2020 2020 2020 2020 2020  pos)..          
+0000da10: 2020 2020 2020 666f 7220 6368 696c 6420        for child 
+0000da20: 696e 206f 702e 6368 696c 6472 656e 3a0d  in op.children:.
+0000da30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000da40: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
+0000da50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000da60: 2020 2063 6f70 795f 6f70 2e61 6464 5f72     copy_op.add_r
+0000da70: 6566 6572 656e 6365 2863 6869 6c64 2e6e  eference(child.n
+0000da80: 6f64 6529 0d0a 2020 2020 2020 2020 2020  ode)..          
+0000da90: 2020 2020 2020 2020 2020 6578 6365 7074            except
+0000daa0: 2041 7474 7269 6275 7465 4572 726f 723a   AttributeError:
+0000dab0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000dac0: 2020 2020 2020 2020 2020 7061 7373 0d0a            pass..
+0000dad0: 0d0a 2020 2020 4074 7265 655f 636f 6e64  ..    @tree_cond
+0000dae0: 6974 696f 6e61 6c28 6c61 6d62 6461 206e  itional(lambda n
+0000daf0: 6f64 653a 206e 6f64 652e 636f 756e 745f  ode: node.count_
+0000db00: 6368 696c 6472 656e 2829 203e 2031 290d  children() > 1).
+0000db10: 0a20 2020 2040 7472 6565 5f73 7562 6d65  .    @tree_subme
+0000db20: 6e75 285f 2822 5061 7373 6573 2229 290d  nu(_("Passes")).
+0000db30: 0a20 2020 2040 7472 6565 5f6f 7065 7261  .    @tree_opera
+0000db40: 7469 6f6e 280d 0a20 2020 2020 2020 205f  tion(..        _
+0000db50: 2822 4164 6420 3120 7061 7373 2229 2c0d  ("Add 1 pass"),.
+0000db60: 0a20 2020 2020 2020 206e 6f64 655f 7479  .        node_ty
+0000db70: 7065 3d28 226f 7020 696d 6167 6522 2c20  pe=("op image", 
+0000db80: 226f 7020 656e 6772 6176 6522 2c20 226f  "op engrave", "o
+0000db90: 7020 6375 7422 2c20 226f 7020 6861 7463  p cut", "op hatc
+0000dba0: 6822 292c 0d0a 2020 2020 2020 2020 6865  h"),..        he
+0000dbb0: 6c70 3d22 222c 0d0a 2020 2020 290d 0a20  lp="",..    ).. 
+0000dbc0: 2020 2064 6566 2061 6464 5f31 5f70 6173     def add_1_pas
+0000dbd0: 7328 6e6f 6465 2c20 2a2a 6b77 6172 6773  s(node, **kwargs
+0000dbe0: 293a 0d0a 2020 2020 2020 2020 6164 645f  ):..        add_
+0000dbf0: 6e5f 7061 7373 6573 286e 6f64 652c 2063  n_passes(node, c
+0000dc00: 6f70 6965 733d 312c 202a 2a6b 7761 7267  opies=1, **kwarg
+0000dc10: 7329 0d0a 0d0a 2020 2020 4074 7265 655f  s)....    @tree_
+0000dc20: 636f 6e64 6974 696f 6e61 6c28 6c61 6d62  conditional(lamb
+0000dc30: 6461 206e 6f64 653a 206e 6f64 652e 636f  da node: node.co
+0000dc40: 756e 745f 6368 696c 6472 656e 2829 203e  unt_children() >
+0000dc50: 2031 290d 0a20 2020 2040 7472 6565 5f73   1)..    @tree_s
+0000dc60: 7562 6d65 6e75 285f 2822 5061 7373 6573  ubmenu(_("Passes
+0000dc70: 2229 290d 0a20 2020 2040 7472 6565 5f69  "))..    @tree_i
+0000dc80: 7465 7261 7465 2822 636f 7069 6573 222c  terate("copies",
+0000dc90: 2032 2c20 3130 290d 0a20 2020 2040 7472   2, 10)..    @tr
+0000dca0: 6565 5f6f 7065 7261 7469 6f6e 280d 0a20  ee_operation(.. 
+0000dcb0: 2020 2020 2020 205f 2822 4164 6420 7b63         _("Add {c
+0000dcc0: 6f70 6965 737d 2070 6173 7365 7322 292c  opies} passes"),
+0000dcd0: 0d0a 2020 2020 2020 2020 6e6f 6465 5f74  ..        node_t
+0000dce0: 7970 653d 2822 6f70 2069 6d61 6765 222c  ype=("op image",
+0000dcf0: 2022 6f70 2065 6e67 7261 7665 222c 2022   "op engrave", "
+0000dd00: 6f70 2063 7574 222c 2022 6f70 2068 6174  op cut", "op hat
+0000dd10: 6368 2229 2c0d 0a20 2020 2020 2020 2068  ch"),..        h
+0000dd20: 656c 703d 2222 2c0d 0a20 2020 2029 0d0a  elp="",..    )..
+0000dd30: 2020 2020 6465 6620 6164 645f 6e5f 7061      def add_n_pa
+0000dd40: 7373 6573 286e 6f64 652c 2063 6f70 6965  sses(node, copie
+0000dd50: 733d 312c 202a 2a6b 7761 7267 7329 3a0d  s=1, **kwargs):.
+0000dd60: 0a20 2020 2020 2020 2061 6464 5f6e 6f64  .        add_nod
+0000dd70: 6573 203d 206c 6973 7428 6e6f 6465 2e63  es = list(node.c
+0000dd80: 6869 6c64 7265 6e29 0d0a 0d0a 2020 2020  hildren)....    
+0000dd90: 2020 2020 7265 6d6f 7665 6420 3d20 4661      removed = Fa
+0000dda0: 6c73 650d 0a20 2020 2020 2020 2066 6f72  lse..        for
+0000ddb0: 2069 2069 6e20 7261 6e67 6528 302c 206c   i in range(0, l
+0000ddc0: 656e 2861 6464 5f6e 6f64 6573 2929 3a0d  en(add_nodes)):.
+0000ddd0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0000dde0: 2071 2069 6e20 7261 6e67 6528 302c 2069   q in range(0, i
+0000ddf0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0000de00: 2020 2020 6966 2061 6464 5f6e 6f64 6573      if add_nodes
+0000de10: 5b71 5d20 6973 2061 6464 5f6e 6f64 6573  [q] is add_nodes
+0000de20: 5b69 5d3a 0d0a 2020 2020 2020 2020 2020  [i]:..          
+0000de30: 2020 2020 2020 2020 2020 6164 645f 6e6f            add_no
+0000de40: 6465 735b 695d 203d 204e 6f6e 650d 0a20  des[i] = None.. 
+0000de50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000de60: 2020 2072 656d 6f76 6564 203d 2054 7275     removed = Tru
+0000de70: 650d 0a20 2020 2020 2020 2069 6620 7265  e..        if re
+0000de80: 6d6f 7665 643a 0d0a 2020 2020 2020 2020  moved:..        
+0000de90: 2020 2020 6164 645f 6e6f 6465 7320 3d20      add_nodes = 
+0000dea0: 5b63 2066 6f72 2063 2069 6e20 6164 645f  [c for c in add_
+0000deb0: 6e6f 6465 7320 6966 2063 2069 7320 6e6f  nodes if c is no
+0000dec0: 7420 4e6f 6e65 5d0d 0a20 2020 2020 2020  t None]..       
+0000ded0: 2061 6464 5f6e 6f64 6573 202a 3d20 636f   add_nodes *= co
+0000dee0: 7069 6573 0d0a 2020 2020 2020 2020 666f  pies..        fo
+0000def0: 7220 6e20 696e 2061 6464 5f6e 6f64 6573  r n in add_nodes
+0000df00: 3a0d 0a20 2020 2020 2020 2020 2020 206e  :..            n
+0000df10: 6f64 652e 6164 645f 7265 6665 7265 6e63  ode.add_referenc
+0000df20: 6528 6e2e 6e6f 6465 290d 0a20 2020 2020  e(n.node)..     
+0000df30: 2020 2073 656c 662e 7369 676e 616c 2822     self.signal("
+0000df40: 7265 6275 696c 645f 7472 6565 2229 0d0a  rebuild_tree")..
+0000df50: 0d0a 2020 2020 4074 7265 655f 636f 6e64  ..    @tree_cond
+0000df60: 6974 696f 6e61 6c28 6c61 6d62 6461 206e  itional(lambda n
+0000df70: 6f64 653a 206e 6f64 652e 636f 756e 745f  ode: node.count_
+0000df80: 6368 696c 6472 656e 2829 203e 2031 290d  children() > 1).
+0000df90: 0a20 2020 2040 7472 6565 5f73 7562 6d65  .    @tree_subme
+0000dfa0: 6e75 285f 2822 4475 706c 6963 6174 6520  nu(_("Duplicate 
+0000dfb0: 656c 656d 656e 7428 7329 2229 290d 0a20  element(s)")).. 
+0000dfc0: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
+0000dfd0: 6f6e 280d 0a20 2020 2020 2020 205f 2822  on(..        _("
+0000dfe0: 4475 706c 6963 6174 6520 656c 656d 656e  Duplicate elemen
+0000dff0: 7473 2031 2074 696d 6522 292c 0d0a 2020  ts 1 time"),..  
+0000e000: 2020 2020 2020 6e6f 6465 5f74 7970 653d        node_type=
+0000e010: 2822 6f70 2069 6d61 6765 222c 2022 6f70  ("op image", "op
+0000e020: 2065 6e67 7261 7665 222c 2022 6f70 2063   engrave", "op c
+0000e030: 7574 2229 2c0d 0a20 2020 2020 2020 2068  ut"),..        h
+0000e040: 656c 703d 2222 2c0d 0a20 2020 2029 0d0a  elp="",..    )..
+0000e050: 2020 2020 6465 6620 6475 705f 315f 636f      def dup_1_co
+0000e060: 7079 286e 6f64 652c 202a 2a6b 7761 7267  py(node, **kwarg
+0000e070: 7329 3a0d 0a20 2020 2020 2020 2064 7570  s):..        dup
+0000e080: 5f6e 5f63 6f70 6965 7328 6e6f 6465 2c20  _n_copies(node, 
+0000e090: 636f 7069 6573 3d31 2c20 2a2a 6b77 6172  copies=1, **kwar
+0000e0a0: 6773 290d 0a0d 0a20 2020 2040 7472 6565  gs)....    @tree
+0000e0b0: 5f63 6f6e 6469 7469 6f6e 616c 286c 616d  _conditional(lam
+0000e0c0: 6264 6120 6e6f 6465 3a20 6e6f 6465 2e63  bda node: node.c
+0000e0d0: 6f75 6e74 5f63 6869 6c64 7265 6e28 2920  ount_children() 
+0000e0e0: 3e20 3129 0d0a 2020 2020 4074 7265 655f  > 1)..    @tree_
+0000e0f0: 7375 626d 656e 7528 5f28 2244 7570 6c69  submenu(_("Dupli
+0000e100: 6361 7465 2065 6c65 6d65 6e74 2873 2922  cate element(s)"
+0000e110: 2929 0d0a 2020 2020 4074 7265 655f 6974  ))..    @tree_it
+0000e120: 6572 6174 6528 2263 6f70 6965 7322 2c20  erate("copies", 
+0000e130: 322c 2031 3029 0d0a 2020 2020 4074 7265  2, 10)..    @tre
+0000e140: 655f 6f70 6572 6174 696f 6e28 0d0a 2020  e_operation(..  
+0000e150: 2020 2020 2020 5f28 2244 7570 6c69 6361        _("Duplica
+0000e160: 7465 2065 6c65 6d65 6e74 7320 7b63 6f70  te elements {cop
+0000e170: 6965 737d 2074 696d 6573 2229 2c0d 0a20  ies} times"),.. 
+0000e180: 2020 2020 2020 206e 6f64 655f 7479 7065         node_type
+0000e190: 3d28 226f 7020 696d 6167 6522 2c20 226f  =("op image", "o
+0000e1a0: 7020 656e 6772 6176 6522 2c20 226f 7020  p engrave", "op 
+0000e1b0: 6375 7422 292c 0d0a 2020 2020 2020 2020  cut"),..        
+0000e1c0: 6865 6c70 3d22 222c 0d0a 2020 2020 290d  help="",..    ).
+0000e1d0: 0a20 2020 2064 6566 2064 7570 5f6e 5f63  .    def dup_n_c
+0000e1e0: 6f70 6965 7328 6e6f 6465 2c20 636f 7069  opies(node, copi
+0000e1f0: 6573 3d31 2c20 2a2a 6b77 6172 6773 293a  es=1, **kwargs):
+0000e200: 0d0a 2020 2020 2020 2020 2320 436f 6465  ..        # Code
+0000e210: 2069 6e20 7365 7269 6573 2e0d 0a20 2020   in series...   
+0000e220: 2020 2020 2023 2061 6464 5f6e 6f64 6573       # add_nodes
+0000e230: 203d 206c 6973 7428 6e6f 6465 2e63 6869   = list(node.chi
+0000e240: 6c64 7265 6e29 0d0a 2020 2020 2020 2020  ldren)..        
+0000e250: 2320 6164 645f 6e6f 6465 7320 2a3d 2063  # add_nodes *= c
+0000e260: 6f70 6965 730d 0a20 2020 2020 2020 2023  opies..        #
+0000e270: 2066 6f72 206e 2069 6e20 6164 645f 6e6f   for n in add_no
+0000e280: 6465 733a 0d0a 2020 2020 2020 2020 2320  des:..        # 
+0000e290: 2020 2020 6e6f 6465 2e61 6464 5f72 6566      node.add_ref
+0000e2a0: 6572 656e 6365 286e 2e6e 6f64 6529 0d0a  erence(n.node)..
+0000e2b0: 0d0a 2020 2020 2020 2020 2320 436f 6465  ..        # Code
+0000e2c0: 2069 6e20 7061 7261 6c6c 656c 2e0d 0a20   in parallel... 
+0000e2d0: 2020 2020 2020 2061 6464 5f6e 6f64 6573         add_nodes
+0000e2e0: 203d 206c 6973 7428 6e6f 6465 2e63 6869   = list(node.chi
+0000e2f0: 6c64 7265 6e29 0d0a 2020 2020 2020 2020  ldren)..        
+0000e300: 666f 7220 6920 696e 2072 616e 6765 286c  for i in range(l
+0000e310: 656e 2861 6464 5f6e 6f64 6573 2920 2d20  en(add_nodes) - 
+0000e320: 312c 202d 312c 202d 3129 3a0d 0a20 2020  1, -1, -1):..   
+0000e330: 2020 2020 2020 2020 206e 203d 2061 6464           n = add
+0000e340: 5f6e 6f64 6573 5b69 5d0d 0a20 2020 2020  _nodes[i]..     
+0000e350: 2020 2020 2020 2066 6f72 206b 2069 6e20         for k in 
+0000e360: 7261 6e67 6528 636f 7069 6573 293a 0d0a  range(copies):..
+0000e370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e380: 6e6f 6465 2e61 6464 5f72 6566 6572 656e  node.add_referen
+0000e390: 6365 286e 2e6e 6f64 652c 2070 6f73 3d69  ce(n.node, pos=i
+0000e3a0: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
+0000e3b0: 662e 7369 676e 616c 2822 7265 6672 6573  f.signal("refres
+0000e3c0: 685f 7472 6565 2229 0d0a 0d0a 2020 2020  h_tree")....    
+0000e3d0: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
+0000e3e0: 0d0a 2020 2020 2020 2020 5f28 224d 616b  ..        _("Mak
+0000e3f0: 6520 7261 7374 6572 2069 6d61 6765 2229  e raster image")
+0000e400: 2c0d 0a20 2020 2020 2020 206e 6f64 655f  ,..        node_
+0000e410: 7479 7065 3d28 226f 7020 696d 6167 6522  type=("op image"
+0000e420: 2c20 226f 7020 7261 7374 6572 2229 2c0d  , "op raster"),.
+0000e430: 0a20 2020 2020 2020 2068 656c 703d 5f28  .        help=_(
+0000e440: 2243 7265 6174 6520 616e 2069 6d61 6765  "Create an image
+0000e450: 2066 726f 6d20 7468 6520 6173 7369 676e   from the assign
+0000e460: 6564 2065 6c65 6d65 6e74 732e 2229 2c0d  ed elements."),.
+0000e470: 0a20 2020 2029 0d0a 2020 2020 6465 6620  .    )..    def 
+0000e480: 6d61 6b65 5f72 6173 7465 725f 696d 6167  make_raster_imag
+0000e490: 6528 6e6f 6465 2c20 2a2a 6b77 6172 6773  e(node, **kwargs
+0000e4a0: 293a 0d0a 2020 2020 2020 2020 6461 7461  ):..        data
+0000e4b0: 203d 206c 6973 7428 6e6f 6465 2e66 6c61   = list(node.fla
+0000e4c0: 7428 7479 7065 733d 656c 656d 5f72 6566  t(types=elem_ref
+0000e4d0: 5f6e 6f64 6573 2929 0d0a 2020 2020 2020  _nodes))..      
+0000e4e0: 2020 6966 206c 656e 2864 6174 6129 203d    if len(data) =
+0000e4f0: 3d20 303a 0d0a 2020 2020 2020 2020 2020  = 0:..          
+0000e500: 2020 7265 7475 726e 0d0a 2020 2020 2020    return..      
+0000e510: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
+0000e520: 2020 2020 626f 756e 6473 203d 204e 6f64      bounds = Nod
+0000e530: 652e 756e 696f 6e5f 626f 756e 6473 2864  e.union_bounds(d
+0000e540: 6174 612c 2061 7474 723d 2270 6169 6e74  ata, attr="paint
+0000e550: 5f62 6f75 6e64 7322 290d 0a20 2020 2020  _bounds")..     
+0000e560: 2020 2020 2020 2077 6964 7468 203d 2062         width = b
+0000e570: 6f75 6e64 735b 325d 202d 2062 6f75 6e64  ounds[2] - bound
+0000e580: 735b 305d 0d0a 2020 2020 2020 2020 2020  s[0]..          
+0000e590: 2020 6865 6967 6874 203d 2062 6f75 6e64    height = bound
+0000e5a0: 735b 335d 202d 2062 6f75 6e64 735b 315d  s[3] - bounds[1]
+0000e5b0: 0d0a 2020 2020 2020 2020 6578 6365 7074  ..        except
+0000e5c0: 2054 7970 6545 7272 6f72 3a0d 0a20 2020   TypeError:..   
+0000e5d0: 2020 2020 2020 2020 2072 6169 7365 2043           raise C
+0000e5e0: 6f6d 6d61 6e64 5379 6e74 6178 4572 726f  ommandSyntaxErro
+0000e5f0: 720d 0a20 2020 2020 2020 206d 616b 655f  r..        make_
+0000e600: 7261 7374 6572 203d 2073 656c 662e 6c6f  raster = self.lo
+0000e610: 6f6b 7570 2822 7265 6e64 6572 2d6f 702f  okup("render-op/
+0000e620: 6d61 6b65 5f72 6173 7465 7222 290d 0a20  make_raster").. 
+0000e630: 2020 2020 2020 2069 6620 6e6f 7420 6d61         if not ma
+0000e640: 6b65 5f72 6173 7465 723a 0d0a 2020 2020  ke_raster:..    
+0000e650: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+0000e660: 6c75 6545 7272 6f72 2822 4e6f 2072 656e  lueError("No ren
+0000e670: 6465 7265 7220 6973 2072 6567 6973 7465  derer is registe
+0000e680: 7265 6420 746f 2070 6572 666f 726d 2072  red to perform r
+0000e690: 656e 6465 722e 2229 0d0a 0d0a 2020 2020  ender.")....    
+0000e6a0: 2020 2020 646f 7473 5f70 6572 5f75 6e69      dots_per_uni
+0000e6b0: 7473 203d 206e 6f64 652e 6470 6920 2f20  ts = node.dpi / 
+0000e6c0: 554e 4954 535f 5045 525f 494e 4348 0d0a  UNITS_PER_INCH..
+0000e6d0: 2020 2020 2020 2020 6e65 775f 7769 6474          new_widt
+0000e6e0: 6820 3d20 7769 6474 6820 2a20 646f 7473  h = width * dots
+0000e6f0: 5f70 6572 5f75 6e69 7473 0d0a 2020 2020  _per_units..    
+0000e700: 2020 2020 6e65 775f 6865 6967 6874 203d      new_height =
+0000e710: 2068 6569 6768 7420 2a20 646f 7473 5f70   height * dots_p
+0000e720: 6572 5f75 6e69 7473 0d0a 0d0a 2020 2020  er_units....    
+0000e730: 2020 2020 696d 6167 6520 3d20 6d61 6b65      image = make
+0000e740: 5f72 6173 7465 7228 0d0a 2020 2020 2020  _raster(..      
+0000e750: 2020 2020 2020 6461 7461 2c0d 0a20 2020        data,..   
+0000e760: 2020 2020 2020 2020 2062 6f75 6e64 733d           bounds=
+0000e770: 626f 756e 6473 2c0d 0a20 2020 2020 2020  bounds,..       
+0000e780: 2020 2020 2077 6964 7468 3d6e 6577 5f77       width=new_w
+0000e790: 6964 7468 2c0d 0a20 2020 2020 2020 2020  idth,..         
+0000e7a0: 2020 2068 6569 6768 743d 6e65 775f 6865     height=new_he
+0000e7b0: 6967 6874 2c0d 0a20 2020 2020 2020 2029  ight,..        )
+0000e7c0: 0d0a 2020 2020 2020 2020 6d61 7472 6978  ..        matrix
+0000e7d0: 203d 204d 6174 7269 782e 7363 616c 6528   = Matrix.scale(
+0000e7e0: 7769 6474 6820 2f20 6e65 775f 7769 6474  width / new_widt
+0000e7f0: 682c 2068 6569 6768 7420 2f20 6e65 775f  h, height / new_
+0000e800: 6865 6967 6874 290d 0a20 2020 2020 2020  height)..       
+0000e810: 206d 6174 7269 782e 706f 7374 5f74 7261   matrix.post_tra
+0000e820: 6e73 6c61 7465 2862 6f75 6e64 735b 305d  nslate(bounds[0]
+0000e830: 2c20 626f 756e 6473 5b31 5d29 0d0a 0d0a  , bounds[1])....
+0000e840: 2020 2020 2020 2020 696d 6167 655f 6e6f          image_no
+0000e850: 6465 203d 2049 6d61 6765 4e6f 6465 2869  de = ImageNode(i
+0000e860: 6d61 6765 3d69 6d61 6765 2c20 6d61 7472  mage=image, matr
+0000e870: 6978 3d6d 6174 7269 782c 2064 7069 3d6e  ix=matrix, dpi=n
+0000e880: 6f64 652e 6470 6929 0d0a 2020 2020 2020  ode.dpi)..      
+0000e890: 2020 7365 6c66 2e65 6c65 6d5f 6272 616e    self.elem_bran
+0000e8a0: 6368 2e61 6464 5f6e 6f64 6528 696d 6167  ch.add_node(imag
+0000e8b0: 655f 6e6f 6465 290d 0a20 2020 2020 2020  e_node)..       
+0000e8c0: 206e 6f64 652e 6164 645f 7265 6665 7265   node.add_refere
+0000e8d0: 6e63 6528 696d 6167 655f 6e6f 6465 290d  nce(image_node).
+0000e8e0: 0a20 2020 2020 2020 2073 656c 662e 7369  .        self.si
+0000e8f0: 676e 616c 2822 7265 6672 6573 685f 7363  gnal("refresh_sc
+0000e900: 656e 6522 2c20 2253 6365 6e65 2229 0d0a  ene", "Scene")..
+0000e910: 0d0a 2020 2020 6465 6620 6164 645f 6166  ..    def add_af
+0000e920: 7465 725f 696e 6465 7828 6e6f 6465 3d4e  ter_index(node=N
+0000e930: 6f6e 6529 3a0d 0a20 2020 2020 2020 2074  one):..        t
+0000e940: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
+0000e950: 2069 6620 6e6f 6465 2069 7320 4e6f 6e65   if node is None
+0000e960: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000e970: 2020 206e 6f64 6520 3d20 6c69 7374 2873     node = list(s
+0000e980: 656c 662e 6f70 7328 7365 6c65 6374 6564  elf.ops(selected
+0000e990: 3d54 7275 6529 295b 2d31 5d0d 0a20 2020  =True))[-1]..   
+0000e9a0: 2020 2020 2020 2020 206f 7065 7261 7469           operati
+0000e9b0: 6f6e 7320 3d20 7365 6c66 2e5f 7472 6565  ons = self._tree
+0000e9c0: 2e67 6574 2874 7970 653d 2262 7261 6e63  .get(type="branc
+0000e9d0: 6820 6f70 7322 292e 6368 696c 6472 656e  h ops").children
+0000e9e0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+0000e9f0: 7475 726e 206f 7065 7261 7469 6f6e 732e  turn operations.
+0000ea00: 696e 6465 7828 6e6f 6465 2920 2b20 310d  index(node) + 1.
+0000ea10: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+0000ea20: 2856 616c 7565 4572 726f 722c 2049 6e64  (ValueError, Ind
+0000ea30: 6578 4572 726f 7229 3a0d 0a20 2020 2020  exError):..     
+0000ea40: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+0000ea50: 6e65 0d0a 0d0a 2020 2020 4074 7265 655f  ne....    @tree_
+0000ea60: 7365 7061 7261 746f 725f 6265 666f 7265  separator_before
+0000ea70: 2829 0d0a 2020 2020 4074 7265 655f 7375  ()..    @tree_su
+0000ea80: 626d 656e 7528 5f28 2249 6e73 6572 7420  bmenu(_("Insert 
+0000ea90: 6f70 6572 6174 696f 6e22 2929 0d0a 2020  operation"))..  
+0000eaa0: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
+0000eab0: 6e28 5f28 2241 6464 2049 6d61 6765 2229  n(_("Add Image")
+0000eac0: 2c20 6e6f 6465 5f74 7970 653d 6f70 5f6e  , node_type=op_n
+0000ead0: 6f64 6573 2c20 6865 6c70 3d22 2229 0d0a  odes, help="")..
+0000eae0: 2020 2020 6465 6620 6164 645f 6f70 6572      def add_oper
+0000eaf0: 6174 696f 6e5f 696d 6167 6528 6e6f 6465  ation_image(node
+0000eb00: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+0000eb10: 2020 2020 2020 6170 7065 6e64 5f6f 7065        append_ope
+0000eb20: 7261 7469 6f6e 5f69 6d61 6765 286e 6f64  ration_image(nod
+0000eb30: 652c 2070 6f73 3d61 6464 5f61 6674 6572  e, pos=add_after
+0000eb40: 5f69 6e64 6578 286e 6f64 6529 2c20 2a2a  _index(node), **
+0000eb50: 6b77 6172 6773 290d 0a0d 0a20 2020 2040  kwargs)....    @
+0000eb60: 7472 6565 5f73 7562 6d65 6e75 285f 2822  tree_submenu(_("
+0000eb70: 496e 7365 7274 206f 7065 7261 7469 6f6e  Insert operation
+0000eb80: 2229 290d 0a20 2020 2040 7472 6565 5f6f  "))..    @tree_o
+0000eb90: 7065 7261 7469 6f6e 285f 2822 4164 6420  peration(_("Add 
+0000eba0: 5261 7374 6572 2229 2c20 6e6f 6465 5f74  Raster"), node_t
+0000ebb0: 7970 653d 6f70 5f6e 6f64 6573 2c20 6865  ype=op_nodes, he
+0000ebc0: 6c70 3d22 2229 0d0a 2020 2020 6465 6620  lp="")..    def 
+0000ebd0: 6164 645f 6f70 6572 6174 696f 6e5f 7261  add_operation_ra
+0000ebe0: 7374 6572 286e 6f64 652c 202a 2a6b 7761  ster(node, **kwa
+0000ebf0: 7267 7329 3a0d 0a20 2020 2020 2020 2061  rgs):..        a
+0000ec00: 7070 656e 645f 6f70 6572 6174 696f 6e5f  ppend_operation_
+0000ec10: 7261 7374 6572 286e 6f64 652c 2070 6f73  raster(node, pos
+0000ec20: 3d61 6464 5f61 6674 6572 5f69 6e64 6578  =add_after_index
+0000ec30: 286e 6f64 6529 2c20 2a2a 6b77 6172 6773  (node), **kwargs
+0000ec40: 290d 0a0d 0a20 2020 2040 7472 6565 5f73  )....    @tree_s
+0000ec50: 7562 6d65 6e75 285f 2822 496e 7365 7274  ubmenu(_("Insert
+0000ec60: 206f 7065 7261 7469 6f6e 2229 290d 0a20   operation")).. 
+0000ec70: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
+0000ec80: 6f6e 285f 2822 4164 6420 456e 6772 6176  on(_("Add Engrav
+0000ec90: 6522 292c 206e 6f64 655f 7479 7065 3d6f  e"), node_type=o
+0000eca0: 705f 6e6f 6465 732c 2068 656c 703d 2222  p_nodes, help=""
+0000ecb0: 290d 0a20 2020 2064 6566 2061 6464 5f6f  )..    def add_o
+0000ecc0: 7065 7261 7469 6f6e 5f65 6e67 7261 7665  peration_engrave
+0000ecd0: 286e 6f64 652c 202a 2a6b 7761 7267 7329  (node, **kwargs)
+0000ece0: 3a0d 0a20 2020 2020 2020 2061 7070 656e  :..        appen
+0000ecf0: 645f 6f70 6572 6174 696f 6e5f 656e 6772  d_operation_engr
+0000ed00: 6176 6528 6e6f 6465 2c20 706f 733d 6164  ave(node, pos=ad
+0000ed10: 645f 6166 7465 725f 696e 6465 7828 6e6f  d_after_index(no
+0000ed20: 6465 292c 202a 2a6b 7761 7267 7329 0d0a  de), **kwargs)..
+0000ed30: 0d0a 2020 2020 4074 7265 655f 7375 626d  ..    @tree_subm
+0000ed40: 656e 7528 5f28 2249 6e73 6572 7420 6f70  enu(_("Insert op
+0000ed50: 6572 6174 696f 6e22 2929 0d0a 2020 2020  eration"))..    
+0000ed60: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
+0000ed70: 5f28 2241 6464 2043 7574 2229 2c20 6e6f  _("Add Cut"), no
+0000ed80: 6465 5f74 7970 653d 6f70 5f6e 6f64 6573  de_type=op_nodes
+0000ed90: 2c20 6865 6c70 3d22 2229 0d0a 2020 2020  , help="")..    
+0000eda0: 6465 6620 6164 645f 6f70 6572 6174 696f  def add_operatio
+0000edb0: 6e5f 6375 7428 6e6f 6465 2c20 2a2a 6b77  n_cut(node, **kw
+0000edc0: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
+0000edd0: 6170 7065 6e64 5f6f 7065 7261 7469 6f6e  append_operation
+0000ede0: 5f63 7574 286e 6f64 652c 2070 6f73 3d61  _cut(node, pos=a
+0000edf0: 6464 5f61 6674 6572 5f69 6e64 6578 286e  dd_after_index(n
+0000ee00: 6f64 6529 2c20 2a2a 6b77 6172 6773 290d  ode), **kwargs).
+0000ee10: 0a0d 0a20 2020 2040 7472 6565 5f73 7562  ...    @tree_sub
+0000ee20: 6d65 6e75 285f 2822 496e 7365 7274 206f  menu(_("Insert o
+0000ee30: 7065 7261 7469 6f6e 2229 290d 0a20 2020  peration"))..   
+0000ee40: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
+0000ee50: 285f 2822 4164 6420 4861 7463 6822 292c  (_("Add Hatch"),
+0000ee60: 206e 6f64 655f 7479 7065 3d6f 705f 6e6f   node_type=op_no
+0000ee70: 6465 732c 2068 656c 703d 2222 290d 0a20  des, help="").. 
+0000ee80: 2020 2064 6566 2061 6464 5f6f 7065 7261     def add_opera
+0000ee90: 7469 6f6e 5f68 6174 6368 286e 6f64 652c  tion_hatch(node,
+0000eea0: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
+0000eeb0: 2020 2020 2061 7070 656e 645f 6f70 6572       append_oper
+0000eec0: 6174 696f 6e5f 6861 7463 6828 6e6f 6465  ation_hatch(node
+0000eed0: 2c20 706f 733d 6164 645f 6166 7465 725f  , pos=add_after_
+0000eee0: 696e 6465 7828 6e6f 6465 292c 202a 2a6b  index(node), **k
+0000eef0: 7761 7267 7329 0d0a 0d0a 2020 2020 4074  wargs)....    @t
+0000ef00: 7265 655f 7375 626d 656e 7528 5f28 2249  ree_submenu(_("I
+0000ef10: 6e73 6572 7420 6f70 6572 6174 696f 6e22  nsert operation"
+0000ef20: 2929 0d0a 2020 2020 4074 7265 655f 6f70  ))..    @tree_op
+0000ef30: 6572 6174 696f 6e28 5f28 2241 6464 2044  eration(_("Add D
+0000ef40: 6f74 7322 292c 206e 6f64 655f 7479 7065  ots"), node_type
+0000ef50: 3d6f 705f 6e6f 6465 732c 2068 656c 703d  =op_nodes, help=
+0000ef60: 2222 290d 0a20 2020 2064 6566 2061 6464  "")..    def add
+0000ef70: 5f6f 7065 7261 7469 6f6e 5f64 6f74 7328  _operation_dots(
+0000ef80: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
+0000ef90: 0d0a 2020 2020 2020 2020 6170 7065 6e64  ..        append
+0000efa0: 5f6f 7065 7261 7469 6f6e 5f64 6f74 7328  _operation_dots(
+0000efb0: 6e6f 6465 2c20 706f 733d 6164 645f 6166  node, pos=add_af
+0000efc0: 7465 725f 696e 6465 7828 6e6f 6465 292c  ter_index(node),
+0000efd0: 202a 2a6b 7761 7267 7329 0d0a 0d0a 2020   **kwargs)....  
+0000efe0: 2020 4074 7265 655f 7375 626d 656e 7528    @tree_submenu(
+0000eff0: 5f28 2249 6e73 6572 7420 7370 6563 6961  _("Insert specia
+0000f000: 6c20 6f70 6572 6174 696f 6e28 7329 2229  l operation(s)")
+0000f010: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
+0000f020: 7261 7469 6f6e 285f 2822 4164 6420 486f  ration(_("Add Ho
+0000f030: 6d65 2229 2c20 6e6f 6465 5f74 7970 653d  me"), node_type=
+0000f040: 6f70 5f6e 6f64 6573 2c20 6865 6c70 3d22  op_nodes, help="
+0000f050: 2229 0d0a 2020 2020 6465 6620 6164 645f  ")..    def add_
+0000f060: 6f70 6572 6174 696f 6e5f 686f 6d65 286e  operation_home(n
+0000f070: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
+0000f080: 0a20 2020 2020 2020 2061 7070 656e 645f  .        append_
+0000f090: 6f70 6572 6174 696f 6e5f 686f 6d65 286e  operation_home(n
+0000f0a0: 6f64 652c 2070 6f73 3d61 6464 5f61 6674  ode, pos=add_aft
+0000f0b0: 6572 5f69 6e64 6578 286e 6f64 6529 2c20  er_index(node), 
+0000f0c0: 2a2a 6b77 6172 6773 290d 0a0d 0a20 2020  **kwargs)....   
+0000f0d0: 2040 7472 6565 5f73 7562 6d65 6e75 285f   @tree_submenu(_
+0000f0e0: 2822 496e 7365 7274 2073 7065 6369 616c  ("Insert special
+0000f0f0: 206f 7065 7261 7469 6f6e 2873 2922 2929   operation(s)"))
+0000f100: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
+0000f110: 6174 696f 6e28 5f28 2241 6464 2052 6574  ation(_("Add Ret
+0000f120: 7572 6e20 746f 204f 7269 6769 6e22 292c  urn to Origin"),
+0000f130: 206e 6f64 655f 7479 7065 3d6f 705f 6e6f   node_type=op_no
+0000f140: 6465 732c 2068 656c 703d 2222 290d 0a20  des, help="").. 
+0000f150: 2020 2064 6566 2061 6464 5f6f 7065 7261     def add_opera
+0000f160: 7469 6f6e 5f6f 7269 6769 6e28 6e6f 6465  tion_origin(node
+0000f170: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+0000f180: 2020 2020 2020 6170 7065 6e64 5f6f 7065        append_ope
+0000f190: 7261 7469 6f6e 5f67 6f74 6f28 6e6f 6465  ration_goto(node
+0000f1a0: 2c20 706f 733d 6164 645f 6166 7465 725f  , pos=add_after_
+0000f1b0: 696e 6465 7828 6e6f 6465 292c 202a 2a6b  index(node), **k
+0000f1c0: 7761 7267 7329 0d0a 0d0a 2020 2020 4074  wargs)....    @t
+0000f1d0: 7265 655f 7375 626d 656e 7528 5f28 2249  ree_submenu(_("I
+0000f1e0: 6e73 6572 7420 7370 6563 6961 6c20 6f70  nsert special op
+0000f1f0: 6572 6174 696f 6e28 7329 2229 290d 0a20  eration(s)")).. 
+0000f200: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
+0000f210: 6f6e 285f 2822 4164 6420 4265 6570 2229  on(_("Add Beep")
+0000f220: 2c20 6e6f 6465 5f74 7970 653d 6f70 5f6e  , node_type=op_n
+0000f230: 6f64 6573 2c20 6865 6c70 3d22 2229 0d0a  odes, help="")..
+0000f240: 2020 2020 6465 6620 6164 645f 6f70 6572      def add_oper
+0000f250: 6174 696f 6e5f 6265 6570 286e 6f64 652c  ation_beep(node,
+0000f260: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
+0000f270: 2020 2020 2061 7070 656e 645f 6f70 6572       append_oper
+0000f280: 6174 696f 6e5f 6265 6570 286e 6f64 652c  ation_beep(node,
+0000f290: 2070 6f73 3d61 6464 5f61 6674 6572 5f69   pos=add_after_i
+0000f2a0: 6e64 6578 286e 6f64 6529 2c20 2a2a 6b77  ndex(node), **kw
+0000f2b0: 6172 6773 290d 0a0d 0a20 2020 2040 7472  args)....    @tr
+0000f2c0: 6565 5f73 7562 6d65 6e75 285f 2822 496e  ee_submenu(_("In
+0000f2d0: 7365 7274 2073 7065 6369 616c 206f 7065  sert special ope
+0000f2e0: 7261 7469 6f6e 2873 2922 2929 0d0a 2020  ration(s)"))..  
+0000f2f0: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
+0000f300: 6e28 5f28 2241 6464 2049 6e74 6572 7275  n(_("Add Interru
+0000f310: 7074 2229 2c20 6e6f 6465 5f74 7970 653d  pt"), node_type=
+0000f320: 6f70 5f6e 6f64 6573 2c20 6865 6c70 3d22  op_nodes, help="
+0000f330: 2229 0d0a 2020 2020 6465 6620 6164 645f  ")..    def add_
+0000f340: 6f70 6572 6174 696f 6e5f 696e 7465 7272  operation_interr
+0000f350: 7570 7428 6e6f 6465 2c20 2a2a 6b77 6172  upt(node, **kwar
+0000f360: 6773 293a 0d0a 2020 2020 2020 2020 6170  gs):..        ap
+0000f370: 7065 6e64 5f6f 7065 7261 7469 6f6e 5f69  pend_operation_i
+0000f380: 6e74 6572 7275 7074 286e 6f64 652c 2070  nterrupt(node, p
+0000f390: 6f73 3d61 6464 5f61 6674 6572 5f69 6e64  os=add_after_ind
+0000f3a0: 6578 286e 6f64 6529 2c20 2a2a 6b77 6172  ex(node), **kwar
+0000f3b0: 6773 290d 0a0d 0a20 2020 2040 7472 6565  gs)....    @tree
+0000f3c0: 5f73 7562 6d65 6e75 285f 2822 496e 7365  _submenu(_("Inse
+0000f3d0: 7274 2073 7065 6369 616c 206f 7065 7261  rt special opera
+0000f3e0: 7469 6f6e 2873 2922 2929 0d0a 2020 2020  tion(s)"))..    
+0000f3f0: 4074 7265 655f 7072 6f6d 7074 2822 7761  @tree_prompt("wa
+0000f400: 6974 5f74 696d 6522 2c20 5f28 2257 6169  it_time", _("Wai
+0000f410: 7420 666f 7220 686f 7720 6c6f 6e67 2028  t for how long (
+0000f420: 696e 2073 6563 6f6e 6473 293f 2229 2c20  in seconds)?"), 
+0000f430: 6461 7461 5f74 7970 653d 666c 6f61 7429  data_type=float)
+0000f440: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
+0000f450: 6174 696f 6e28 5f28 2241 6464 2057 6169  ation(_("Add Wai
+0000f460: 7422 292c 206e 6f64 655f 7479 7065 3d6f  t"), node_type=o
+0000f470: 705f 6e6f 6465 732c 2068 656c 703d 2222  p_nodes, help=""
+0000f480: 290d 0a20 2020 2064 6566 2061 6464 5f6f  )..    def add_o
+0000f490: 7065 7261 7469 6f6e 5f77 6169 7428 6e6f  peration_wait(no
+0000f4a0: 6465 2c20 7761 6974 5f74 696d 652c 202a  de, wait_time, *
+0000f4b0: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
+0000f4c0: 2020 2061 7070 656e 645f 6f70 6572 6174     append_operat
+0000f4d0: 696f 6e5f 7761 6974 280d 0a20 2020 2020  ion_wait(..     
+0000f4e0: 2020 2020 2020 206e 6f64 652c 2077 6169         node, wai
+0000f4f0: 745f 7469 6d65 3d77 6169 745f 7469 6d65  t_time=wait_time
+0000f500: 2c20 706f 733d 6164 645f 6166 7465 725f  , pos=add_after_
+0000f510: 696e 6465 7828 6e6f 6465 292c 202a 2a6b  index(node), **k
+0000f520: 7761 7267 730d 0a20 2020 2020 2020 2029  wargs..        )
+0000f530: 0d0a 0d0a 2020 2020 4074 7265 655f 7375  ....    @tree_su
+0000f540: 626d 656e 7528 5f28 2249 6e73 6572 7420  bmenu(_("Insert 
+0000f550: 7370 6563 6961 6c20 6f70 6572 6174 696f  special operatio
+0000f560: 6e28 7329 2229 290d 0a20 2020 2040 7472  n(s)"))..    @tr
+0000f570: 6565 5f6f 7065 7261 7469 6f6e 285f 2822  ee_operation(_("
+0000f580: 4164 6420 4f75 7470 7574 2229 2c20 6e6f  Add Output"), no
+0000f590: 6465 5f74 7970 653d 6f70 5f6e 6f64 6573  de_type=op_nodes
+0000f5a0: 2c20 6865 6c70 3d22 2229 0d0a 2020 2020  , help="")..    
+0000f5b0: 6465 6620 6164 645f 6f70 6572 6174 696f  def add_operatio
+0000f5c0: 6e5f 6f75 7470 7574 286e 6f64 652c 202a  n_output(node, *
+0000f5d0: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
+0000f5e0: 2020 2061 7070 656e 645f 6f70 6572 6174     append_operat
+0000f5f0: 696f 6e5f 6f75 7470 7574 286e 6f64 652c  ion_output(node,
+0000f600: 2070 6f73 3d61 6464 5f61 6674 6572 5f69   pos=add_after_i
+0000f610: 6e64 6578 286e 6f64 6529 2c20 2a2a 6b77  ndex(node), **kw
+0000f620: 6172 6773 290d 0a0d 0a20 2020 2040 7472  args)....    @tr
+0000f630: 6565 5f73 7562 6d65 6e75 285f 2822 496e  ee_submenu(_("In
+0000f640: 7365 7274 2073 7065 6369 616c 206f 7065  sert special ope
+0000f650: 7261 7469 6f6e 2873 2922 2929 0d0a 2020  ration(s)"))..  
+0000f660: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
+0000f670: 6e28 5f28 2241 6464 2049 6e70 7574 2229  n(_("Add Input")
+0000f680: 2c20 6e6f 6465 5f74 7970 653d 6f70 5f6e  , node_type=op_n
+0000f690: 6f64 6573 2c20 6865 6c70 3d22 2229 0d0a  odes, help="")..
+0000f6a0: 2020 2020 6465 6620 6164 645f 6f70 6572      def add_oper
+0000f6b0: 6174 696f 6e5f 696e 7075 7428 6e6f 6465  ation_input(node
+0000f6c0: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+0000f6d0: 2020 2020 2020 6170 7065 6e64 5f6f 7065        append_ope
+0000f6e0: 7261 7469 6f6e 5f69 6e70 7574 286e 6f64  ration_input(nod
+0000f6f0: 652c 2070 6f73 3d61 6464 5f61 6674 6572  e, pos=add_after
+0000f700: 5f69 6e64 6578 286e 6f64 6529 2c20 2a2a  _index(node), **
+0000f710: 6b77 6172 6773 290d 0a0d 0a20 2020 2040  kwargs)....    @
+0000f720: 7472 6565 5f73 7562 6d65 6e75 285f 2822  tree_submenu(_("
+0000f730: 496e 7365 7274 2073 7065 6369 616c 206f  Insert special o
+0000f740: 7065 7261 7469 6f6e 2873 2922 2929 0d0a  peration(s)"))..
+0000f750: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
+0000f760: 696f 6e28 5f28 2241 6464 2048 6f6d 652f  ion(_("Add Home/
+0000f770: 4265 6570 2f49 6e74 6572 7275 7074 2229  Beep/Interrupt")
+0000f780: 2c20 6e6f 6465 5f74 7970 653d 6f70 5f6e  , node_type=op_n
+0000f790: 6f64 6573 2c20 6865 6c70 3d22 2229 0d0a  odes, help="")..
+0000f7a0: 2020 2020 6465 6620 6164 645f 6f70 6572      def add_oper
+0000f7b0: 6174 696f 6e5f 686f 6d65 5f62 6565 705f  ation_home_beep_
+0000f7c0: 696e 7465 7272 7570 7428 6e6f 6465 2c20  interrupt(node, 
+0000f7d0: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
+0000f7e0: 2020 2020 706f 7320 3d20 6164 645f 6166      pos = add_af
+0000f7f0: 7465 725f 696e 6465 7828 6e6f 6465 290d  ter_index(node).
+0000f800: 0a20 2020 2020 2020 2061 7070 656e 645f  .        append_
+0000f810: 6f70 6572 6174 696f 6e5f 686f 6d65 286e  operation_home(n
+0000f820: 6f64 652c 2070 6f73 3d70 6f73 2c20 2a2a  ode, pos=pos, **
+0000f830: 6b77 6172 6773 290d 0a20 2020 2020 2020  kwargs)..       
+0000f840: 2069 6620 706f 733a 0d0a 2020 2020 2020   if pos:..      
+0000f850: 2020 2020 2020 706f 7320 2b3d 2031 0d0a        pos += 1..
+0000f860: 2020 2020 2020 2020 6170 7065 6e64 5f6f          append_o
+0000f870: 7065 7261 7469 6f6e 5f62 6565 7028 6e6f  peration_beep(no
+0000f880: 6465 2c20 706f 733d 706f 732c 202a 2a6b  de, pos=pos, **k
+0000f890: 7761 7267 7329 0d0a 2020 2020 2020 2020  wargs)..        
+0000f8a0: 6966 2070 6f73 3a0d 0a20 2020 2020 2020  if pos:..       
+0000f8b0: 2020 2020 2070 6f73 202b 3d20 310d 0a20       pos += 1.. 
+0000f8c0: 2020 2020 2020 2061 7070 656e 645f 6f70         append_op
+0000f8d0: 6572 6174 696f 6e5f 696e 7465 7272 7570  eration_interrup
+0000f8e0: 7428 6e6f 6465 2c20 706f 733d 706f 732c  t(node, pos=pos,
+0000f8f0: 202a 2a6b 7761 7267 7329 0d0a 0d0a 2020   **kwargs)....  
+0000f900: 2020 4074 7265 655f 7375 626d 656e 7528    @tree_submenu(
+0000f910: 5f28 2249 6e73 6572 7420 7370 6563 6961  _("Insert specia
+0000f920: 6c20 6f70 6572 6174 696f 6e28 7329 2229  l operation(s)")
+0000f930: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
+0000f940: 7261 7469 6f6e 285f 2822 4164 6420 4f72  ration(_("Add Or
+0000f950: 6967 696e 2f42 6565 702f 496e 7465 7272  igin/Beep/Interr
+0000f960: 7570 7422 292c 206e 6f64 655f 7479 7065  upt"), node_type
+0000f970: 3d6f 705f 6e6f 6465 732c 2068 656c 703d  =op_nodes, help=
+0000f980: 2222 290d 0a20 2020 2064 6566 2061 6464  "")..    def add
+0000f990: 5f6f 7065 7261 7469 6f6e 5f6f 7269 6769  _operation_origi
+0000f9a0: 6e5f 6265 6570 5f69 6e74 6572 7275 7074  n_beep_interrupt
+0000f9b0: 286e 6f64 652c 202a 2a6b 7761 7267 7329  (node, **kwargs)
+0000f9c0: 3a0d 0a20 2020 2020 2020 2070 6f73 203d  :..        pos =
+0000f9d0: 2061 6464 5f61 6674 6572 5f69 6e64 6578   add_after_index
+0000f9e0: 286e 6f64 6529 0d0a 2020 2020 2020 2020  (node)..        
+0000f9f0: 6170 7065 6e64 5f6f 7065 7261 7469 6f6e  append_operation
+0000fa00: 5f67 6f74 6f28 6e6f 6465 2c20 706f 733d  _goto(node, pos=
+0000fa10: 706f 732c 202a 2a6b 7761 7267 7329 0d0a  pos, **kwargs)..
+0000fa20: 2020 2020 2020 2020 6966 2070 6f73 3a0d          if pos:.
+0000fa30: 0a20 2020 2020 2020 2020 2020 2070 6f73  .            pos
+0000fa40: 202b 3d20 310d 0a20 2020 2020 2020 2061   += 1..        a
+0000fa50: 7070 656e 645f 6f70 6572 6174 696f 6e5f  ppend_operation_
+0000fa60: 6265 6570 286e 6f64 652c 2070 6f73 3d70  beep(node, pos=p
+0000fa70: 6f73 2c20 2a2a 6b77 6172 6773 290d 0a20  os, **kwargs).. 
+0000fa80: 2020 2020 2020 2069 6620 706f 733a 0d0a         if pos:..
+0000fa90: 2020 2020 2020 2020 2020 2020 706f 7320              pos 
+0000faa0: 2b3d 2031 0d0a 2020 2020 2020 2020 6170  += 1..        ap
+0000fab0: 7065 6e64 5f6f 7065 7261 7469 6f6e 5f69  pend_operation_i
+0000fac0: 6e74 6572 7275 7074 286e 6f64 652c 2070  nterrupt(node, p
+0000fad0: 6f73 3d70 6f73 2c20 2a2a 6b77 6172 6773  os=pos, **kwargs
+0000fae0: 290d 0a0d 0a20 2020 2040 7472 6565 5f6f  )....    @tree_o
+0000faf0: 7065 7261 7469 6f6e 285f 2822 5265 6c6f  peration(_("Relo
+0000fb00: 6164 2027 7b6e 616d 657d 2722 292c 206e  ad '{name}'"), n
+0000fb10: 6f64 655f 7479 7065 3d22 6669 6c65 222c  ode_type="file",
+0000fb20: 2068 656c 703d 2222 290d 0a20 2020 2064   help="")..    d
+0000fb30: 6566 2072 656c 6f61 645f 6669 6c65 286e  ef reload_file(n
+0000fb40: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
+0000fb50: 0a20 2020 2020 2020 2066 696c 6570 6174  .        filepat
+0000fb60: 6820 3d20 6e6f 6465 2e66 696c 6570 6174  h = node.filepat
+0000fb70: 680d 0a20 2020 2020 2020 206e 6f64 652e  h..        node.
+0000fb80: 7265 6d6f 7665 5f6e 6f64 6528 290d 0a20  remove_node().. 
+0000fb90: 2020 2020 2020 2073 656c 662e 6c6f 6164         self.load
+0000fba0: 2866 696c 6570 6174 6829 0d0a 0d0a 2020  (filepath)....  
+0000fbb0: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
+0000fbc0: 6e28 0d0a 2020 2020 2020 2020 5f28 224f  n(..        _("O
+0000fbd0: 7065 6e20 696e 2053 7973 7465 6d3a 2027  pen in System: '
+0000fbe0: 7b6e 616d 657d 2722 292c 0d0a 2020 2020  {name}'"),..    
+0000fbf0: 2020 2020 6e6f 6465 5f74 7970 653d 2266      node_type="f
+0000fc00: 696c 6522 2c0d 0a20 2020 2020 2020 2068  ile",..        h
+0000fc10: 656c 703d 5f28 0d0a 2020 2020 2020 2020  elp=_(..        
+0000fc20: 2020 2020 224f 7065 6e20 7468 6973 2066      "Open this f
+0000fc30: 696c 6520 696e 2074 6865 2073 7973 7465  ile in the syste
+0000fc40: 6d20 6170 706c 6963 6174 696f 6e20 6173  m application as
+0000fc50: 736f 6369 6174 6564 2077 6974 6820 7468  sociated with th
+0000fc60: 6973 2074 7970 6520 6f66 2066 696c 6522  is type of file"
+0000fc70: 0d0a 2020 2020 2020 2020 292c 0d0a 2020  ..        ),..  
+0000fc80: 2020 290d 0a20 2020 2064 6566 206f 7065    )..    def ope
+0000fc90: 6e5f 7379 7374 656d 5f66 696c 6528 6e6f  n_system_file(no
+0000fca0: 6465 2c20 2a2a 6b77 6172 6773 293a 0d0a  de, **kwargs):..
+0000fcb0: 2020 2020 2020 2020 6669 6c65 7061 7468          filepath
+0000fcc0: 203d 206e 6f64 652e 6669 6c65 7061 7468   = node.filepath
+0000fcd0: 0d0a 2020 2020 2020 2020 6e6f 726d 616c  ..        normal
+0000fce0: 697a 6564 203d 206f 732e 7061 7468 2e72  ized = os.path.r
+0000fcf0: 6561 6c70 6174 6828 6669 6c65 7061 7468  ealpath(filepath
+0000fd00: 290d 0a0d 0a20 2020 2020 2020 2069 6d70  )....        imp
+0000fd10: 6f72 7420 706c 6174 666f 726d 0d0a 0d0a  ort platform....
+0000fd20: 2020 2020 2020 2020 7379 7374 656d 203d          system =
+0000fd30: 2070 6c61 7466 6f72 6d2e 7379 7374 656d   platform.system
+0000fd40: 2829 0d0a 2020 2020 2020 2020 6966 2073  ()..        if s
+0000fd50: 7973 7465 6d20 3d3d 2022 4461 7277 696e  ystem == "Darwin
+0000fd60: 223a 0d0a 2020 2020 2020 2020 2020 2020  ":..            
+0000fd70: 6672 6f6d 206f 7320 696d 706f 7274 2073  from os import s
+0000fd80: 7973 7465 6d20 6173 206f 7065 6e5f 696e  ystem as open_in
+0000fd90: 5f73 6865 6c6c 0d0a 0d0a 2020 2020 2020  _shell....      
+0000fda0: 2020 2020 2020 6f70 656e 5f69 6e5f 7368        open_in_sh
+0000fdb0: 656c 6c28 6622 6f70 656e 2027 7b6e 6f72  ell(f"open '{nor
+0000fdc0: 6d61 6c69 7a65 647d 2722 290d 0a20 2020  malized}'")..   
+0000fdd0: 2020 2020 2065 6c69 6620 7379 7374 656d       elif system
+0000fde0: 203d 3d20 2257 696e 646f 7773 223a 0d0a   == "Windows":..
+0000fdf0: 2020 2020 2020 2020 2020 2020 6672 6f6d              from
+0000fe00: 206f 7320 696d 706f 7274 2073 7461 7274   os import start
+0000fe10: 6669 6c65 2061 7320 6f70 656e 5f69 6e5f  file as open_in_
+0000fe20: 7368 656c 6c0d 0a0d 0a20 2020 2020 2020  shell....       
+0000fe30: 2020 2020 206f 7065 6e5f 696e 5f73 6865       open_in_she
+0000fe40: 6c6c 2866 2722 7b6e 6f72 6d61 6c69 7a65  ll(f'"{normalize
+0000fe50: 647d 2227 290d 0a20 2020 2020 2020 2065  d}"')..        e
+0000fe60: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+0000fe70: 2020 6672 6f6d 206f 7320 696d 706f 7274    from os import
+0000fe80: 2073 7973 7465 6d20 6173 206f 7065 6e5f   system as open_
+0000fe90: 696e 5f73 6865 6c6c 0d0a 0d0a 2020 2020  in_shell....    
+0000fea0: 2020 2020 2020 2020 6f70 656e 5f69 6e5f          open_in_
+0000feb0: 7368 656c 6c28 6622 7864 672d 6f70 656e  shell(f"xdg-open
+0000fec0: 2027 7b6e 6f72 6d61 6c69 7a65 647d 2722   '{normalized}'"
+0000fed0: 290d 0a0d 0a20 2020 2064 6566 2067 6574  )....    def get
+0000fee0: 5f76 616c 7565 7328 293a 0d0a 2020 2020  _values():..    
+0000fef0: 2020 2020 7265 7475 726e 205b 6f20 666f      return [o fo
+0000ff00: 7220 6f20 696e 2073 656c 662e 6f70 7328  r o in self.ops(
+0000ff10: 2920 6966 206f 2e74 7970 652e 7374 6172  ) if o.type.star
+0000ff20: 7473 7769 7468 2822 6f70 2229 5d0d 0a0d  tswith("op")]...
+0000ff30: 0a20 2020 2040 7472 6565 5f63 6f6e 6469  .    @tree_condi
+0000ff40: 7469 6f6e 616c 286c 616d 6264 6120 6e6f  tional(lambda no
+0000ff50: 6465 3a20 6e6f 7420 6973 5f72 6567 6d61  de: not is_regma
+0000ff60: 726b 286e 6f64 6529 290d 0a20 2020 2040  rk(node))..    @
+0000ff70: 7472 6565 5f73 7562 6d65 6e75 285f 2822  tree_submenu(_("
+0000ff80: 4173 7369 676e 204f 7065 7261 7469 6f6e  Assign Operation
+0000ff90: 2229 290d 0a20 2020 2040 7472 6565 5f76  "))..    @tree_v
+0000ffa0: 616c 7565 7328 226f 705f 6173 7369 676e  alues("op_assign
+0000ffb0: 222c 2076 616c 7565 733d 6765 745f 7661  ", values=get_va
+0000ffc0: 6c75 6573 290d 0a20 2020 2040 7472 6565  lues)..    @tree
+0000ffd0: 5f6f 7065 7261 7469 6f6e 2822 7b6f 705f  _operation("{op_
+0000ffe0: 6173 7369 676e 7d22 2c20 6e6f 6465 5f74  assign}", node_t
+0000fff0: 7970 653d 656c 656d 5f6e 6f64 6573 2c20  ype=elem_nodes, 
+00010000: 6865 6c70 3d22 2229 0d0a 2020 2020 6465  help="")..    de
+00010010: 6620 6d65 6e75 5f61 7373 6967 6e5f 6f70  f menu_assign_op
+00010020: 6572 6174 696f 6e73 286e 6f64 652c 206f  erations(node, o
+00010030: 705f 6173 7369 676e 2c20 2a2a 6b77 6172  p_assign, **kwar
+00010040: 6773 293a 0d0a 2020 2020 2020 2020 6966  gs):..        if
+00010050: 2073 656c 662e 636c 6173 7369 6679 5f69   self.classify_i
+00010060: 6e68 6572 6974 5f73 7472 6f6b 653a 0d0a  nherit_stroke:..
+00010070: 2020 2020 2020 2020 2020 2020 696d 706f              impo
+00010080: 7365 203d 2022 746f 5f6f 7022 0d0a 2020  se = "to_op"..  
+00010090: 2020 2020 2020 2020 2020 6174 7472 6962            attrib
+000100a0: 203d 2022 7374 726f 6b65 220d 0a20 2020   = "stroke"..   
+000100b0: 2020 2020 2020 2020 2073 696d 696c 6172           similar
+000100c0: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
+000100d0: 2065 6c69 6620 7365 6c66 2e63 6c61 7373   elif self.class
+000100e0: 6966 795f 696e 6865 7269 745f 6669 6c6c  ify_inherit_fill
+000100f0: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+00010100: 6d70 6f73 6520 3d20 2274 6f5f 6f70 220d  mpose = "to_op".
+00010110: 0a20 2020 2020 2020 2020 2020 2061 7474  .            att
+00010120: 7269 6220 3d20 2266 696c 6c22 0d0a 2020  rib = "fill"..  
+00010130: 2020 2020 2020 2020 2020 7369 6d69 6c61            simila
+00010140: 7220 3d20 5472 7565 0d0a 2020 2020 2020  r = True..      
+00010150: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00010160: 2020 2020 2069 6d70 6f73 6520 3d20 4e6f       impose = No
+00010170: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
+00010180: 6174 7472 6962 203d 204e 6f6e 650d 0a20  attrib = None.. 
+00010190: 2020 2020 2020 2020 2020 2073 696d 696c             simil
+000101a0: 6172 203d 2046 616c 7365 0d0a 2020 2020  ar = False..    
+000101b0: 2020 2020 6578 636c 7573 6976 6520 3d20      exclusive = 
+000101c0: 7365 6c66 2e63 6c61 7373 6966 795f 696e  self.classify_in
+000101d0: 6865 7269 745f 6578 636c 7573 6976 650d  herit_exclusive.
+000101e0: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
+000101f0: 6c69 7374 2873 656c 662e 656c 656d 7328  list(self.elems(
+00010200: 656d 7068 6173 697a 6564 3d54 7275 6529  emphasized=True)
+00010210: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00010220: 6173 7369 676e 5f6f 7065 7261 7469 6f6e  assign_operation
+00010230: 280d 0a20 2020 2020 2020 2020 2020 206f  (..            o
+00010240: 705f 6173 7369 676e 3d6f 705f 6173 7369  p_assign=op_assi
+00010250: 676e 2c0d 0a20 2020 2020 2020 2020 2020  gn,..           
+00010260: 2064 6174 613d 6461 7461 2c0d 0a20 2020   data=data,..   
+00010270: 2020 2020 2020 2020 2069 6d70 6f73 653d           impose=
+00010280: 696d 706f 7365 2c0d 0a20 2020 2020 2020  impose,..       
+00010290: 2020 2020 2061 7474 7269 623d 6174 7472       attrib=attr
+000102a0: 6962 2c0d 0a20 2020 2020 2020 2020 2020  ib,..           
+000102b0: 2073 696d 696c 6172 3d73 696d 696c 6172   similar=similar
+000102c0: 2c0d 0a20 2020 2020 2020 2020 2020 2065  ,..            e
+000102d0: 7863 6c75 7369 7665 3d65 7863 6c75 7369  xclusive=exclusi
+000102e0: 7665 2c0d 0a20 2020 2020 2020 2029 0d0a  ve,..        )..
+000102f0: 0d0a 2020 2020 6465 6620 6578 636c 7573  ..    def exclus
+00010300: 6976 655f 6d61 7463 6828 6e6f 6465 2c20  ive_match(node, 
+00010310: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
+00010320: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00010330: 636c 6173 7369 6679 5f69 6e68 6572 6974  classify_inherit
+00010340: 5f65 7863 6c75 7369 7665 0d0a 0d0a 2020  _exclusive....  
+00010350: 2020 4074 7265 655f 7365 7061 7261 746f    @tree_separato
+00010360: 725f 6265 666f 7265 2829 0d0a 2020 2020  r_before()..    
+00010370: 4074 7265 655f 7375 626d 656e 7528 5f28  @tree_submenu(_(
+00010380: 2241 7373 6967 6e20 4f70 6572 6174 696f  "Assign Operatio
+00010390: 6e22 2929 0d0a 2020 2020 4074 7265 655f  n"))..    @tree_
+000103a0: 6f70 6572 6174 696f 6e28 0d0a 2020 2020  operation(..    
+000103b0: 2020 2020 5f28 2252 656d 6f76 6520 616c      _("Remove al
+000103c0: 6c20 6173 7369 676e 6d65 6e74 7320 6672  l assignments fr
+000103d0: 6f6d 206f 7065 7261 7469 6f6e 7322 292c  om operations"),
+000103e0: 0d0a 2020 2020 2020 2020 6e6f 6465 5f74  ..        node_t
+000103f0: 7970 653d 656c 656d 5f67 726f 7570 5f6e  ype=elem_group_n
+00010400: 6f64 6573 2c0d 0a20 2020 2020 2020 2068  odes,..        h
+00010410: 656c 703d 5f28 2241 6e79 2065 7869 7374  elp=_("Any exist
+00010420: 696e 6720 6173 7369 676e 6d65 6e74 206f  ing assignment o
+00010430: 6620 7468 6973 2065 6c65 6d65 6e74 2074  f this element t
+00010440: 6f20 6f70 6572 6174 696f 6e73 2077 696c  o operations wil
+00010450: 6c20 6265 2072 656d 6f76 6564 2229 2c0d  l be removed"),.
+00010460: 0a20 2020 2029 0d0a 2020 2020 6465 6620  .    )..    def 
+00010470: 7265 6d6f 7665 5f61 7373 6967 6e6d 656e  remove_assignmen
+00010480: 7473 2873 696e 676c 656e 6f64 652c 202a  ts(singlenode, *
+00010490: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
+000104a0: 2020 2064 6566 2072 656d 5f6e 6f64 6528     def rem_node(
+000104b0: 726e 6f64 6529 3a0d 0a20 2020 2020 2020  rnode):..       
+000104c0: 2020 2020 2023 2072 6563 7572 7369 7665       # recursive
+000104d0: 6c79 2072 656d 6f76 6520 6173 7369 676e  ly remove assign
+000104e0: 6d65 6e74 732e 2e2e 0d0a 2020 2020 2020  ments.....      
+000104f0: 2020 2020 2020 6966 2072 6e6f 6465 2e74        if rnode.t
+00010500: 7970 6520 696e 2028 2266 696c 6522 2c20  ype in ("file", 
+00010510: 2267 726f 7570 2229 3a0d 0a20 2020 2020  "group"):..     
+00010520: 2020 2020 2020 2020 2020 2066 6f72 2063             for c
+00010530: 6e6f 6465 2069 6e20 6c69 7374 2872 6e6f  node in list(rno
+00010540: 6465 2e5f 6368 696c 6472 656e 293a 0d0a  de._children):..
+00010550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010560: 2020 2020 7265 6d5f 6e6f 6465 2863 6e6f      rem_node(cno
+00010570: 6465 290d 0a20 2020 2020 2020 2020 2020  de)..           
+00010580: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00010590: 2020 2020 2020 2020 666f 7220 7265 6620          for ref 
+000105a0: 696e 206c 6973 7428 726e 6f64 652e 7265  in list(rnode.re
+000105b0: 6665 7265 6e63 6573 293a 0d0a 2020 2020  ferences):..    
+000105c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000105d0: 7265 662e 7265 6d6f 7665 5f6e 6f64 6528  ref.remove_node(
+000105e0: 290d 0a0d 0a20 2020 2020 2020 2077 6974  )....        wit
+000105f0: 6820 7365 6c66 2e73 7461 7469 6328 2272  h self.static("r
+00010600: 656d 6f76 655f 6173 7369 676e 2229 3a0d  emove_assign"):.
+00010610: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00010620: 206e 6f64 6520 696e 206c 6973 7428 7365   node in list(se
+00010630: 6c66 2e65 6c65 6d73 2865 6d70 6861 7369  lf.elems(emphasi
+00010640: 7a65 643d 5472 7565 2929 3a0d 0a20 2020  zed=True)):..   
+00010650: 2020 2020 2020 2020 2020 2020 2072 656d               rem
+00010660: 5f6e 6f64 6528 6e6f 6465 290d 0a20 2020  _node(node)..   
+00010670: 2020 2020 2073 656c 662e 7369 676e 616c       self.signal
+00010680: 2822 7265 6672 6573 685f 7472 6565 2229  ("refresh_tree")
+00010690: 0d0a 0d0a 2020 2020 4074 7265 655f 7365  ....    @tree_se
+000106a0: 7061 7261 746f 725f 6265 666f 7265 2829  parator_before()
+000106b0: 0d0a 2020 2020 4074 7265 655f 7375 626d  ..    @tree_subm
+000106c0: 656e 7528 5f28 2241 7373 6967 6e20 4f70  enu(_("Assign Op
+000106d0: 6572 6174 696f 6e22 2929 0d0a 2020 2020  eration"))..    
+000106e0: 4074 7265 655f 6368 6563 6b28 6578 636c  @tree_check(excl
+000106f0: 7573 6976 655f 6d61 7463 6829 0d0a 2020  usive_match)..  
+00010700: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
+00010710: 6e28 0d0a 2020 2020 2020 2020 5f28 2245  n(..        _("E
+00010720: 7863 6c75 7369 7665 2061 7373 6967 6e6d  xclusive assignm
+00010730: 656e 7422 292c 0d0a 2020 2020 2020 2020  ent"),..        
+00010740: 6e6f 6465 5f74 7970 653d 656c 656d 5f6e  node_type=elem_n
+00010750: 6f64 6573 2c0d 0a20 2020 2020 2020 2068  odes,..        h
+00010760: 656c 703d 5f28 0d0a 2020 2020 2020 2020  elp=_(..        
+00010770: 2020 2020 2241 6e20 6173 7369 676e 6d65      "An assignme
+00010780: 6e74 2077 696c 6c20 7265 6d6f 7665 2061  nt will remove a
+00010790: 6c6c 206f 7468 6572 2063 6c61 7373 6966  ll other classif
+000107a0: 6963 6174 696f 6e73 206f 6620 7468 6973  ications of this
+000107b0: 2065 6c65 6d65 6e74 2069 6620 6368 6563   element if chec
+000107c0: 6b65 6422 0d0a 2020 2020 2020 2020 292c  ked"..        ),
+000107d0: 0d0a 2020 2020 290d 0a20 2020 2064 6566  ..    )..    def
+000107e0: 2073 6574 5f61 7373 6967 6e5f 6f70 7469   set_assign_opti
+000107f0: 6f6e 5f65 7863 6c75 7369 7665 286e 6f64  on_exclusive(nod
+00010800: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
+00010810: 2020 2020 2020 2073 656c 662e 636c 6173         self.clas
+00010820: 7369 6679 5f69 6e68 6572 6974 5f65 7863  sify_inherit_exc
+00010830: 6c75 7369 7665 203d 206e 6f74 2073 656c  lusive = not sel
+00010840: 662e 636c 6173 7369 6679 5f69 6e68 6572  f.classify_inher
+00010850: 6974 5f65 7863 6c75 7369 7665 0d0a 0d0a  it_exclusive....
+00010860: 2020 2020 6465 6620 7374 726f 6b65 5f6d      def stroke_m
+00010870: 6174 6368 286e 6f64 652c 202a 2a6b 7761  atch(node, **kwa
+00010880: 7267 7329 3a0d 0a20 2020 2020 2020 2072  rgs):..        r
+00010890: 6574 7572 6e20 7365 6c66 2e63 6c61 7373  eturn self.class
+000108a0: 6966 795f 696e 6865 7269 745f 7374 726f  ify_inherit_stro
+000108b0: 6b65 0d0a 0d0a 2020 2020 4074 7265 655f  ke....    @tree_
+000108c0: 7365 7061 7261 746f 725f 6265 666f 7265  separator_before
+000108d0: 2829 0d0a 2020 2020 4074 7265 655f 7375  ()..    @tree_su
+000108e0: 626d 656e 7528 5f28 2241 7373 6967 6e20  bmenu(_("Assign 
+000108f0: 4f70 6572 6174 696f 6e22 2929 0d0a 2020  Operation"))..  
+00010900: 2020 4074 7265 655f 6368 6563 6b28 7374    @tree_check(st
+00010910: 726f 6b65 5f6d 6174 6368 290d 0a20 2020  roke_match)..   
+00010920: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
+00010930: 280d 0a20 2020 2020 2020 205f 2822 496e  (..        _("In
+00010940: 6865 7269 7420 7374 726f 6b65 2061 6e64  herit stroke and
+00010950: 2063 6c61 7373 6966 7920 7369 6d69 6c61   classify simila
+00010960: 7222 292c 0d0a 2020 2020 2020 2020 6e6f  r"),..        no
+00010970: 6465 5f74 7970 653d 656c 656d 5f6e 6f64  de_type=elem_nod
+00010980: 6573 2c0d 0a20 2020 2020 2020 2068 656c  es,..        hel
+00010990: 703d 5f28 224f 7065 7261 7469 6f6e 2077  p=_("Operation w
+000109a0: 696c 6c20 696e 6865 7269 7420 656c 656d  ill inherit elem
+000109b0: 656e 7420 7374 726f 6b65 2063 6f6c 6f72  ent stroke color
+000109c0: 2229 2c0d 0a20 2020 2029 0d0a 2020 2020  "),..    )..    
+000109d0: 6465 6620 7365 745f 6173 7369 676e 5f6f  def set_assign_o
+000109e0: 7074 696f 6e5f 7374 726f 6b65 286e 6f64  ption_stroke(nod
+000109f0: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
+00010a00: 2020 2020 2020 2073 656c 662e 636c 6173         self.clas
+00010a10: 7369 6679 5f69 6e68 6572 6974 5f73 7472  sify_inherit_str
+00010a20: 6f6b 6520 3d20 6e6f 7420 7365 6c66 2e63  oke = not self.c
+00010a30: 6c61 7373 6966 795f 696e 6865 7269 745f  lassify_inherit_
+00010a40: 7374 726f 6b65 0d0a 2020 2020 2020 2020  stroke..        
+00010a50: 2320 506f 6f72 206d 616e 7320 7261 6469  # Poor mans radi
+00010a60: 6f0d 0a20 2020 2020 2020 2069 6620 7365  o..        if se
+00010a70: 6c66 2e63 6c61 7373 6966 795f 696e 6865  lf.classify_inhe
+00010a80: 7269 745f 7374 726f 6b65 3a0d 0a20 2020  rit_stroke:..   
+00010a90: 2020 2020 2020 2020 2073 656c 662e 636c           self.cl
+00010aa0: 6173 7369 6679 5f69 6e68 6572 6974 5f66  assify_inherit_f
+00010ab0: 696c 6c20 3d20 4661 6c73 650d 0a0d 0a20  ill = False.... 
+00010ac0: 2020 2064 6566 2066 696c 6c5f 6d61 7463     def fill_matc
+00010ad0: 6828 6e6f 6465 2c20 2a2a 6b77 6172 6773  h(node, **kwargs
+00010ae0: 293a 0d0a 2020 2020 2020 2020 7265 7475  ):..        retu
+00010af0: 726e 2073 656c 662e 636c 6173 7369 6679  rn self.classify
+00010b00: 5f69 6e68 6572 6974 5f66 696c 6c0d 0a0d  _inherit_fill...
+00010b10: 0a20 2020 2040 7472 6565 5f73 7562 6d65  .    @tree_subme
+00010b20: 6e75 285f 2822 4173 7369 676e 204f 7065  nu(_("Assign Ope
+00010b30: 7261 7469 6f6e 2229 290d 0a20 2020 2040  ration"))..    @
+00010b40: 7472 6565 5f63 6865 636b 2866 696c 6c5f  tree_check(fill_
+00010b50: 6d61 7463 6829 0d0a 2020 2020 4074 7265  match)..    @tre
+00010b60: 655f 6f70 6572 6174 696f 6e28 0d0a 2020  e_operation(..  
+00010b70: 2020 2020 2020 5f28 2249 6e68 6572 6974        _("Inherit
+00010b80: 2066 696c 6c20 616e 6420 636c 6173 7369   fill and classi
+00010b90: 6679 2073 696d 696c 6172 2229 2c0d 0a20  fy similar"),.. 
+00010ba0: 2020 2020 2020 206e 6f64 655f 7479 7065         node_type
+00010bb0: 3d65 6c65 6d5f 6e6f 6465 732c 0d0a 2020  =elem_nodes,..  
+00010bc0: 2020 2020 2020 6865 6c70 3d5f 2822 4f70        help=_("Op
+00010bd0: 6572 6174 696f 6e20 7769 6c6c 2069 6e68  eration will inh
+00010be0: 6572 6974 2065 6c65 6d65 6e74 2066 696c  erit element fil
+00010bf0: 6c20 636f 6c6f 7222 292c 0d0a 2020 2020  l color"),..    
+00010c00: 290d 0a20 2020 2064 6566 2073 6574 5f61  )..    def set_a
+00010c10: 7373 6967 6e5f 6f70 7469 6f6e 5f66 696c  ssign_option_fil
+00010c20: 6c28 6e6f 6465 2c20 2a2a 6b77 6172 6773  l(node, **kwargs
+00010c30: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
+00010c40: 2e63 6c61 7373 6966 795f 696e 6865 7269  .classify_inheri
+00010c50: 745f 6669 6c6c 203d 206e 6f74 2073 656c  t_fill = not sel
+00010c60: 662e 636c 6173 7369 6679 5f69 6e68 6572  f.classify_inher
+00010c70: 6974 5f66 696c 6c0d 0a20 2020 2020 2020  it_fill..       
+00010c80: 2023 2050 6f6f 7220 6d61 6e73 2072 6164   # Poor mans rad
+00010c90: 696f 0d0a 2020 2020 2020 2020 6966 2073  io..        if s
+00010ca0: 656c 662e 636c 6173 7369 6679 5f69 6e68  elf.classify_inh
+00010cb0: 6572 6974 5f66 696c 6c3a 0d0a 2020 2020  erit_fill:..    
+00010cc0: 2020 2020 2020 2020 7365 6c66 2e63 6c61          self.cla
+00010cd0: 7373 6966 795f 696e 6865 7269 745f 7374  ssify_inherit_st
+00010ce0: 726f 6b65 203d 2046 616c 7365 0d0a 0d0a  roke = False....
+00010cf0: 2020 2020 4074 7265 655f 636f 6e64 6974      @tree_condit
+00010d00: 696f 6e61 6c28 6c61 6d62 6461 206e 6f64  ional(lambda nod
+00010d10: 653a 206e 6f74 2069 735f 7265 676d 6172  e: not is_regmar
+00010d20: 6b28 6e6f 6465 2929 0d0a 2020 2020 4074  k(node))..    @t
+00010d30: 7265 655f 7375 626d 656e 7528 5f28 2244  ree_submenu(_("D
+00010d40: 7570 6c69 6361 7465 2065 6c65 6d65 6e74  uplicate element
+00010d50: 2873 2922 2929 0d0a 2020 2020 4074 7265  (s)"))..    @tre
+00010d60: 655f 6f70 6572 6174 696f 6e28 5f28 224d  e_operation(_("M
+00010d70: 616b 6520 3120 636f 7079 2229 2c20 6e6f  ake 1 copy"), no
+00010d80: 6465 5f74 7970 653d 656c 656d 5f67 726f  de_type=elem_gro
+00010d90: 7570 5f6e 6f64 6573 2c20 6865 6c70 3d22  up_nodes, help="
+00010da0: 2229 0d0a 2020 2020 6465 6620 6475 706c  ")..    def dupl
+00010db0: 6963 6174 655f 656c 656d 656e 745f 3128  icate_element_1(
+00010dc0: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
+00010dd0: 0d0a 2020 2020 2020 2020 6475 706c 6963  ..        duplic
+00010de0: 6174 655f 656c 656d 656e 745f 6e28 6e6f  ate_element_n(no
+00010df0: 6465 2c20 636f 7069 6573 3d31 2c20 2a2a  de, copies=1, **
+00010e00: 6b77 6172 6773 290d 0a0d 0a20 2020 2040  kwargs)....    @
+00010e10: 7472 6565 5f63 6f6e 6469 7469 6f6e 616c  tree_conditional
+00010e20: 286c 616d 6264 6120 6e6f 6465 3a20 6e6f  (lambda node: no
+00010e30: 7420 6973 5f72 6567 6d61 726b 286e 6f64  t is_regmark(nod
+00010e40: 6529 290d 0a20 2020 2040 7472 6565 5f73  e))..    @tree_s
+00010e50: 7562 6d65 6e75 285f 2822 4475 706c 6963  ubmenu(_("Duplic
+00010e60: 6174 6520 656c 656d 656e 7428 7329 2229  ate element(s)")
+00010e70: 290d 0a20 2020 2040 7472 6565 5f69 7465  )..    @tree_ite
+00010e80: 7261 7465 2822 636f 7069 6573 222c 2032  rate("copies", 2
+00010e90: 2c20 3130 290d 0a20 2020 2040 7472 6565  , 10)..    @tree
+00010ea0: 5f6f 7065 7261 7469 6f6e 285f 2822 4d61  _operation(_("Ma
+00010eb0: 6b65 207b 636f 7069 6573 7d20 636f 7069  ke {copies} copi
+00010ec0: 6573 2229 2c20 6e6f 6465 5f74 7970 653d  es"), node_type=
+00010ed0: 656c 656d 5f67 726f 7570 5f6e 6f64 6573  elem_group_nodes
+00010ee0: 2c20 6865 6c70 3d22 2229 0d0a 2020 2020  , help="")..    
+00010ef0: 6465 6620 6475 706c 6963 6174 655f 656c  def duplicate_el
+00010f00: 656d 656e 745f 6e28 6e6f 6465 2c20 636f  ement_n(node, co
+00010f10: 7069 6573 2c20 2a2a 6b77 6172 6773 293a  pies, **kwargs):
+00010f20: 0d0a 2020 2020 2020 2020 6465 6620 636f  ..        def co
+00010f30: 7079 5f73 696e 676c 655f 6e6f 6465 286f  py_single_node(o
+00010f40: 7267 6e6f 6465 2c20 6f72 6770 6172 656e  rgnode, orgparen
+00010f50: 742c 2074 696d 6573 2c20 6478 2c20 6479  t, times, dx, dy
+00010f60: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00010f70: 6465 6c74 615f 776f 7264 6c69 7374 203d  delta_wordlist =
+00010f80: 2030 0d0a 2020 2020 2020 2020 2020 2020   0..            
+00010f90: 666f 7220 6e20 696e 2072 616e 6765 2874  for n in range(t
+00010fa0: 696d 6573 293a 0d0a 2020 2020 2020 2020  imes):..        
+00010fb0: 2020 2020 2020 2020 6465 6c74 615f 776f          delta_wo
+00010fc0: 7264 6c69 7374 202b 3d20 310d 0a0d 0a20  rdlist += 1.... 
+00010fd0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00010fe0: 6f70 795f 6e6f 6465 203d 2063 6f70 7928  opy_node = copy(
+00010ff0: 6f72 676e 6f64 6529 0d0a 2020 2020 2020  orgnode)..      
+00011000: 2020 2020 2020 2020 2020 6966 2068 6173            if has
+00011010: 6174 7472 2863 6f70 795f 6e6f 6465 2c20  attr(copy_node, 
+00011020: 226d 6174 7269 7822 293a 0d0a 2020 2020  "matrix"):..    
+00011030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011040: 636f 7079 5f6e 6f64 652e 6d61 7472 6978  copy_node.matrix
+00011050: 202a 3d20 4d61 7472 6978 2e74 7261 6e73   *= Matrix.trans
+00011060: 6c61 7465 2828 6e20 2b20 3129 202a 2064  late((n + 1) * d
+00011070: 782c 2028 6e20 2b20 3129 202a 2064 7929  x, (n + 1) * dy)
+00011080: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00011090: 2020 6861 645f 6f70 7469 6f6e 616c 203d    had_optional =
+000110a0: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+000110b0: 2020 2020 2020 2020 2320 4e65 6564 2074          # Need t
+000110c0: 6f20 6164 6420 7374 726f 6b65 2061 6e64  o add stroke and
+000110d0: 2066 696c 6c2c 2061 7320 636f 7079 2077   fill, as copy w
+000110e0: 696c 6c20 7461 6b65 2074 6865 0d0a 2020  ill take the..  
+000110f0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00011100: 6465 6661 756c 7420 7661 6c75 6573 2066  default values f
+00011110: 6f72 2074 6865 7365 2061 7474 7269 6275  or these attribu
+00011120: 7465 730d 0a20 2020 2020 2020 2020 2020  tes..           
+00011130: 2020 2020 2066 6f72 206f 7074 696f 6e61       for optiona
+00011140: 6c20 696e 2028 2266 696c 6c22 2c20 2273  l in ("fill", "s
+00011150: 7472 6f6b 6522 293a 0d0a 2020 2020 2020  troke"):..      
+00011160: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00011170: 2068 6173 6174 7472 286f 7267 6e6f 6465   hasattr(orgnode
+00011180: 2c20 6f70 7469 6f6e 616c 293a 0d0a 2020  , optional):..  
+00011190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000111a0: 2020 2020 2020 7365 7461 7474 7228 636f        setattr(co
+000111b0: 7079 5f6e 6f64 652c 206f 7074 696f 6e61  py_node, optiona
+000111c0: 6c2c 2067 6574 6174 7472 286f 7267 6e6f  l, getattr(orgno
+000111d0: 6465 2c20 6f70 7469 6f6e 616c 2929 0d0a  de, optional))..
+000111e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000111f0: 666f 7220 6f70 7469 6f6e 616c 2069 6e20  for optional in 
+00011200: 2822 7778 666f 6e74 222c 2022 6d6b 7465  ("wxfont", "mkte
+00011210: 7874 222c 2022 6d6b 666f 6e74 222c 2022  xt", "mkfont", "
+00011220: 6d6b 666f 6e74 7369 7a65 2229 3a0d 0a20  mkfontsize"):.. 
+00011230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011240: 2020 2069 6620 6861 7361 7474 7228 6f72     if hasattr(or
+00011250: 676e 6f64 652c 206f 7074 696f 6e61 6c29  gnode, optional)
+00011260: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00011270: 2020 2020 2020 2020 2020 2068 6164 5f6f             had_o
+00011280: 7074 696f 6e61 6c20 3d20 5472 7565 0d0a  ptional = True..
 00011290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000112a0: 206f 6c64 7661 6c20 3d20 6765 7461 7474   oldval = getatt
-000112b0: 7228 6e6f 6465 2c20 6174 7472 6962 2c20  r(node, attrib, 
-000112c0: 4e6f 6e65 290d 0a20 2020 2020 2020 2020  None)..         
-000112d0: 2020 2020 2020 2020 2020 206f 6c64 7374             oldst
-000112e0: 7566 662e 6170 7065 6e64 285b 6174 7472  uff.append([attr
-000112f0: 6962 2c20 6f6c 6476 616c 5d29 0d0a 2020  ib, oldval])..  
-00011300: 2020 2020 2020 2020 2020 7472 793a 0d0a            try:..
-00011310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011320: 7061 7468 203d 206e 6f64 652e 6173 5f70  path = node.as_p
-00011330: 6174 6828 290d 0a20 2020 2020 2020 2020  ath()..         
-00011340: 2020 2020 2020 2023 2054 6865 7265 2061         # There a
-00011350: 7265 2073 6f6d 6520 6368 616c 6c65 6e67  re some challeng
-00011360: 6573 2061 726f 756e 6420 7468 6520 7472  es around the tr
-00011370: 6561 746d 656e 740d 0a20 2020 2020 2020  eatment..       
-00011380: 2020 2020 2020 2020 2023 206f 6620 6172           # of ar
-00011390: 6373 2077 6974 6869 6e20 7376 6765 6c65  cs within svgele
-000113a0: 6d65 6e74 732c 2073 6f20 6c65 7427 7320  ments, so let's 
-000113b0: 6369 7263 756d 7665 6e74 0d0a 2020 2020  circumvent..    
-000113c0: 2020 2020 2020 2020 2020 2020 2320 7468              # th
-000113d0: 656d 2066 6f72 2074 6865 2074 696d 6520  em for the time 
-000113e0: 6265 696e 6720 2875 6e74 696c 2072 6573  being (until res
-000113f0: 6f6c 7665 6429 0d0a 2020 2020 2020 2020  olved)..        
-00011400: 2020 2020 2020 2020 2320 6279 2072 6570          # by rep
-00011410: 6c61 6369 6e67 2061 7263 2073 6567 6d65  lacing arc segme
-00011420: 6e74 7320 7769 7468 2063 7562 6963 2062  nts with cubic b
-00011430: 657a 6965 7273 0d0a 2020 2020 2020 2020  eziers..        
-00011440: 2020 2020 2020 2020 6966 206e 6f64 652e          if node.
-00011450: 7479 7065 2069 6e20 2822 656c 656d 2070  type in ("elem p
-00011460: 6174 6822 2c20 2265 6c65 6d20 656c 6c69  ath", "elem elli
-00011470: 7073 6522 293a 0d0a 2020 2020 2020 2020  pse"):..        
-00011480: 2020 2020 2020 2020 2020 2020 7061 7468              path
-00011490: 2e61 7070 726f 7869 6d61 7465 5f61 7263  .approximate_arc
-000114a0: 735f 7769 7468 5f63 7562 6963 7328 290d  s_with_cubics().
-000114b0: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-000114c0: 6570 7420 4174 7472 6962 7574 6545 7272  ept AttributeErr
-000114d0: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
-000114e0: 2020 2020 2072 6574 7572 6e0d 0a20 2020       return..   
-000114f0: 2020 2020 2020 2020 206e 6577 6e6f 6465           newnode
-00011500: 203d 206e 6f64 652e 7265 706c 6163 655f   = node.replace_
-00011510: 6e6f 6465 2870 6174 683d 7061 7468 2c20  node(path=path, 
-00011520: 7479 7065 3d22 656c 656d 2070 6174 6822  type="elem path"
-00011530: 290d 0a20 2020 2020 2020 2020 2020 2066  )..            f
-00011540: 6f72 2069 7465 6d20 696e 206f 6c64 7374  or item in oldst
-00011550: 7566 663a 0d0a 2020 2020 2020 2020 2020  uff:..          
-00011560: 2020 2020 2020 7365 7461 7474 7228 6e65        setattr(ne
-00011570: 776e 6f64 652c 2069 7465 6d5b 305d 2c20  wnode, item[0], 
-00011580: 6974 656d 5b31 5d29 0d0a 2020 2020 2020  item[1])..      
-00011590: 2020 2020 2020 6e65 776e 6f64 652e 616c        newnode.al
-000115a0: 7465 7265 6428 290d 0a0d 0a20 2020 2040  tered()....    @
-000115b0: 7472 6565 5f73 7562 6d65 6e75 285f 2822  tree_submenu(_("
-000115c0: 466c 6970 2229 290d 0a20 2020 2040 7472  Flip"))..    @tr
-000115d0: 6565 5f73 6570 6172 6174 6f72 5f62 6566  ee_separator_bef
-000115e0: 6f72 6528 290d 0a20 2020 2040 7472 6565  ore()..    @tree
-000115f0: 5f63 6f6e 6469 7469 6f6e 616c 286c 616d  _conditional(lam
-00011600: 6264 6120 6e6f 6465 3a20 6e6f 7420 6973  bda node: not is
-00011610: 5f72 6567 6d61 726b 286e 6f64 6529 290d  _regmark(node)).
-00011620: 0a20 2020 2040 7472 6565 5f63 6f6e 6469  .    @tree_condi
-00011630: 7469 6f6e 616c 5f74 7279 286c 616d 6264  tional_try(lambd
-00011640: 6120 6e6f 6465 3a20 6e6f 7420 6e6f 6465  a node: not node
-00011650: 2e6c 6f63 6b29 0d0a 2020 2020 4074 7265  .lock)..    @tre
-00011660: 655f 6f70 6572 6174 696f 6e28 0d0a 2020  e_operation(..  
-00011670: 2020 2020 2020 5f28 2248 6f72 697a 6f6e        _("Horizon
-00011680: 7461 6c6c 7922 292c 0d0a 2020 2020 2020  tally"),..      
-00011690: 2020 6e6f 6465 5f74 7970 653d 656c 656d    node_type=elem
-000116a0: 5f67 726f 7570 5f6e 6f64 6573 2c0d 0a20  _group_nodes,.. 
-000116b0: 2020 2020 2020 2068 656c 703d 5f28 224d         help=_("M
-000116c0: 6972 726f 7220 486f 7269 7a6f 6e74 616c  irror Horizontal
-000116d0: 6c79 2229 2c0d 0a20 2020 2029 0d0a 2020  ly"),..    )..  
-000116e0: 2020 6465 6620 6d69 7272 6f72 5f65 6c65    def mirror_ele
-000116f0: 6d28 6e6f 6465 2c20 2a2a 6b77 6172 6773  m(node, **kwargs
-00011700: 293a 0d0a 2020 2020 2020 2020 626f 756e  ):..        boun
-00011710: 6473 203d 2073 656c 662e 5f65 6d70 6861  ds = self._empha
-00011720: 7369 7a65 645f 626f 756e 6473 0d0a 2020  sized_bounds..  
-00011730: 2020 2020 2020 6966 2062 6f75 6e64 7320        if bounds 
-00011740: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
-00011750: 2020 2020 2020 7265 7475 726e 0d0a 2020        return..  
-00011760: 2020 2020 2020 6365 6e74 6572 5f78 203d        center_x =
-00011770: 2028 626f 756e 6473 5b32 5d20 2b20 626f   (bounds[2] + bo
-00011780: 756e 6473 5b30 5d29 202f 2032 2e30 0d0a  unds[0]) / 2.0..
-00011790: 2020 2020 2020 2020 6365 6e74 6572 5f79          center_y
-000117a0: 203d 2028 626f 756e 6473 5b33 5d20 2b20   = (bounds[3] + 
-000117b0: 626f 756e 6473 5b31 5d29 202f 2032 2e30  bounds[1]) / 2.0
-000117c0: 0d0a 2020 2020 2020 2020 7365 6c66 2866  ..        self(f
-000117d0: 2273 6361 6c65 202d 3120 3120 7b63 656e  "scale -1 1 {cen
-000117e0: 7465 725f 787d 207b 6365 6e74 6572 5f79  ter_x} {center_y
-000117f0: 7d5c 6e22 290d 0a0d 0a20 2020 2040 7472  }\n")....    @tr
-00011800: 6565 5f63 6f6e 6469 7469 6f6e 616c 286c  ee_conditional(l
-00011810: 616d 6264 6120 6e6f 6465 3a20 6e6f 7420  ambda node: not 
-00011820: 6973 5f72 6567 6d61 726b 286e 6f64 6529  is_regmark(node)
-00011830: 290d 0a20 2020 2040 7472 6565 5f73 7562  )..    @tree_sub
-00011840: 6d65 6e75 285f 2822 466c 6970 2229 290d  menu(_("Flip")).
-00011850: 0a20 2020 2040 7472 6565 5f63 6f6e 6469  .    @tree_condi
-00011860: 7469 6f6e 616c 5f74 7279 286c 616d 6264  tional_try(lambd
-00011870: 6120 6e6f 6465 3a20 6e6f 7420 6e6f 6465  a node: not node
-00011880: 2e6c 6f63 6b29 0d0a 2020 2020 4074 7265  .lock)..    @tre
-00011890: 655f 6f70 6572 6174 696f 6e28 0d0a 2020  e_operation(..  
-000118a0: 2020 2020 2020 5f28 2256 6572 7469 6361        _("Vertica
-000118b0: 6c6c 7922 292c 0d0a 2020 2020 2020 2020  lly"),..        
-000118c0: 6e6f 6465 5f74 7970 653d 656c 656d 5f67  node_type=elem_g
-000118d0: 726f 7570 5f6e 6f64 6573 2c0d 0a20 2020  roup_nodes,..   
-000118e0: 2020 2020 2068 656c 703d 5f28 2246 6c69       help=_("Fli
-000118f0: 7020 5665 7274 6963 616c 6c79 2229 2c0d  p Vertically"),.
-00011900: 0a20 2020 2029 0d0a 2020 2020 6465 6620  .    )..    def 
-00011910: 666c 6970 5f65 6c65 6d28 6e6f 6465 2c20  flip_elem(node, 
-00011920: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
-00011930: 2020 2020 626f 756e 6473 203d 2073 656c      bounds = sel
-00011940: 662e 5f65 6d70 6861 7369 7a65 645f 626f  f._emphasized_bo
-00011950: 756e 6473 0d0a 2020 2020 2020 2020 6966  unds..        if
-00011960: 2062 6f75 6e64 7320 6973 204e 6f6e 653a   bounds is None:
-00011970: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-00011980: 7475 726e 0d0a 2020 2020 2020 2020 6365  turn..        ce
-00011990: 6e74 6572 5f78 203d 2028 626f 756e 6473  nter_x = (bounds
-000119a0: 5b32 5d20 2b20 626f 756e 6473 5b30 5d29  [2] + bounds[0])
-000119b0: 202f 2032 2e30 0d0a 2020 2020 2020 2020   / 2.0..        
-000119c0: 6365 6e74 6572 5f79 203d 2028 626f 756e  center_y = (boun
-000119d0: 6473 5b33 5d20 2b20 626f 756e 6473 5b31  ds[3] + bounds[1
-000119e0: 5d29 202f 2032 2e30 0d0a 2020 2020 2020  ]) / 2.0..      
-000119f0: 2020 7365 6c66 2866 2273 6361 6c65 2031    self(f"scale 1
-00011a00: 202d 3120 7b63 656e 7465 725f 787d 207b   -1 {center_x} {
-00011a10: 6365 6e74 6572 5f79 7d5c 6e22 290d 0a0d  center_y}\n")...
-00011a20: 0a20 2020 2040 7472 6565 5f63 6f6e 6469  .    @tree_condi
-00011a30: 7469 6f6e 616c 286c 616d 6264 6120 6e6f  tional(lambda no
-00011a40: 6465 3a20 6e6f 7420 6973 5f72 6567 6d61  de: not is_regma
-00011a50: 726b 286e 6f64 6529 290d 0a20 2020 2040  rk(node))..    @
-00011a60: 7472 6565 5f63 6f6e 6469 7469 6f6e 616c  tree_conditional
-00011a70: 5f74 7279 286c 616d 6264 6120 6e6f 6465  _try(lambda node
-00011a80: 3a20 6e6f 7420 6e6f 6465 2e6c 6f63 6b29  : not node.lock)
-00011a90: 0d0a 2020 2020 4074 7265 655f 7375 626d  ..    @tree_subm
-00011aa0: 656e 7528 5f28 2253 6361 6c65 2229 290d  enu(_("Scale")).
-00011ab0: 0a20 2020 2040 7472 6565 5f69 7465 7261  .    @tree_itera
-00011ac0: 7465 2822 7363 616c 6522 2c20 3235 2c20  te("scale", 25, 
-00011ad0: 312c 202d 3129 0d0a 2020 2020 4074 7265  1, -1)..    @tre
-00011ae0: 655f 6361 6c63 2822 7363 616c 655f 7065  e_calc("scale_pe
-00011af0: 7263 656e 7422 2c20 6c61 6d62 6461 2069  rcent", lambda i
-00011b00: 3a20 6622 7b28 3630 302e 3020 2f20 666c  : f"{(600.0 / fl
-00011b10: 6f61 7428 6929 293a 2e32 667d 2229 0d0a  oat(i)):.2f}")..
-00011b20: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
-00011b30: 696f 6e28 0d0a 2020 2020 2020 2020 5f28  ion(..        _(
-00011b40: 2253 6361 6c65 207b 7363 616c 655f 7065  "Scale {scale_pe
-00011b50: 7263 656e 747d 2522 292c 0d0a 2020 2020  rcent}%"),..    
-00011b60: 2020 2020 6e6f 6465 5f74 7970 653d 656c      node_type=el
-00011b70: 656d 5f67 726f 7570 5f6e 6f64 6573 2c0d  em_group_nodes,.
-00011b80: 0a20 2020 2020 2020 2068 656c 703d 5f28  .        help=_(
-00011b90: 2253 6361 6c65 2045 6c65 6d65 6e74 2229  "Scale Element")
-00011ba0: 2c0d 0a20 2020 2029 0d0a 2020 2020 6465  ,..    )..    de
-00011bb0: 6620 7363 616c 655f 656c 656d 5f61 6d6f  f scale_elem_amo
-00011bc0: 756e 7428 6e6f 6465 2c20 7363 616c 652c  unt(node, scale,
-00011bd0: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
-00011be0: 2020 2020 2073 6361 6c65 203d 2036 2e30       scale = 6.0
-00011bf0: 202f 2066 6c6f 6174 2873 6361 6c65 290d   / float(scale).
-00011c00: 0a20 2020 2020 2020 2062 6f75 6e64 7320  .        bounds 
-00011c10: 3d20 7365 6c66 2e5f 656d 7068 6173 697a  = self._emphasiz
-00011c20: 6564 5f62 6f75 6e64 730d 0a20 2020 2020  ed_bounds..     
-00011c30: 2020 2069 6620 626f 756e 6473 2069 7320     if bounds is 
-00011c40: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-00011c50: 2020 2072 6574 7572 6e0d 0a20 2020 2020     return..     
-00011c60: 2020 2063 656e 7465 725f 7820 3d20 2862     center_x = (b
-00011c70: 6f75 6e64 735b 325d 202b 2062 6f75 6e64  ounds[2] + bound
-00011c80: 735b 305d 2920 2f20 322e 300d 0a20 2020  s[0]) / 2.0..   
-00011c90: 2020 2020 2063 656e 7465 725f 7920 3d20       center_y = 
-00011ca0: 2862 6f75 6e64 735b 335d 202b 2062 6f75  (bounds[3] + bou
-00011cb0: 6e64 735b 315d 2920 2f20 322e 300d 0a20  nds[1]) / 2.0.. 
-00011cc0: 2020 2020 2020 2073 656c 6628 6622 7363         self(f"sc
-00011cd0: 616c 6520 7b73 6361 6c65 7d20 7b73 6361  ale {scale} {sca
-00011ce0: 6c65 7d20 7b63 656e 7465 725f 787d 207b  le} {center_x} {
-00011cf0: 6365 6e74 6572 5f79 7d5c 6e22 290d 0a0d  center_y}\n")...
-00011d00: 0a20 2020 2023 2040 7472 6565 5f63 6f6e  .    # @tree_con
-00011d10: 6469 7469 6f6e 616c 286c 616d 6264 6120  ditional(lambda 
-00011d20: 6e6f 6465 3a20 6973 696e 7374 616e 6365  node: isinstance
-00011d30: 286e 6f64 652e 6f62 6a65 6374 2c20 5356  (node.object, SV
-00011d40: 4745 6c65 6d65 6e74 2929 0d0a 2020 2020  GElement))..    
-00011d50: 4074 7265 655f 636f 6e64 6974 696f 6e61  @tree_conditiona
-00011d60: 6c28 6c61 6d62 6461 206e 6f64 653a 206e  l(lambda node: n
-00011d70: 6f74 2069 735f 7265 676d 6172 6b28 6e6f  ot is_regmark(no
-00011d80: 6465 2929 0d0a 2020 2020 4074 7265 655f  de))..    @tree_
-00011d90: 636f 6e64 6974 696f 6e61 6c5f 7472 7928  conditional_try(
-00011da0: 6c61 6d62 6461 206e 6f64 653a 206e 6f74  lambda node: not
-00011db0: 206e 6f64 652e 6c6f 636b 290d 0a20 2020   node.lock)..   
-00011dc0: 2040 7472 6565 5f73 7562 6d65 6e75 285f   @tree_submenu(_
-00011dd0: 2822 526f 7461 7465 2229 290d 0a20 2020  ("Rotate"))..   
-00011de0: 2040 7472 6565 5f76 616c 7565 7328 0d0a   @tree_values(..
-00011df0: 2020 2020 2020 2020 2261 6e67 6c65 222c          "angle",
-00011e00: 0d0a 2020 2020 2020 2020 280d 0a20 2020  ..        (..   
-00011e10: 2020 2020 2020 2020 2031 3830 2c0d 0a20           180,.. 
-00011e20: 2020 2020 2020 2020 2020 2031 3335 2c0d             135,.
-00011e30: 0a20 2020 2020 2020 2020 2020 2039 302c  .            90,
-00011e40: 0d0a 2020 2020 2020 2020 2020 2020 3630  ..            60
-00011e50: 2c0d 0a20 2020 2020 2020 2020 2020 2034  ,..            4
-00011e60: 352c 0d0a 2020 2020 2020 2020 2020 2020  5,..            
-00011e70: 3330 2c0d 0a20 2020 2020 2020 2020 2020  30,..           
-00011e80: 2032 302c 0d0a 2020 2020 2020 2020 2020   20,..          
-00011e90: 2020 3135 2c0d 0a20 2020 2020 2020 2020    15,..         
-00011ea0: 2020 2031 302c 0d0a 2020 2020 2020 2020     10,..        
-00011eb0: 2020 2020 352c 0d0a 2020 2020 2020 2020      5,..        
-00011ec0: 2020 2020 342c 0d0a 2020 2020 2020 2020      4,..        
-00011ed0: 2020 2020 332c 0d0a 2020 2020 2020 2020      3,..        
-00011ee0: 2020 2020 322c 0d0a 2020 2020 2020 2020      2,..        
-00011ef0: 2020 2020 312c 0d0a 2020 2020 2020 2020      1,..        
-00011f00: 2020 2020 2d31 2c0d 0a20 2020 2020 2020      -1,..       
-00011f10: 2020 2020 202d 322c 0d0a 2020 2020 2020       -2,..      
-00011f20: 2020 2020 2020 2d33 2c0d 0a20 2020 2020        -3,..     
-00011f30: 2020 2020 2020 202d 342c 0d0a 2020 2020         -4,..    
-00011f40: 2020 2020 2020 2020 2d35 2c0d 0a20 2020          -5,..   
-00011f50: 2020 2020 2020 2020 202d 3130 2c0d 0a20           -10,.. 
-00011f60: 2020 2020 2020 2020 2020 202d 3135 2c0d             -15,.
-00011f70: 0a20 2020 2020 2020 2020 2020 202d 3230  .            -20
-00011f80: 2c0d 0a20 2020 2020 2020 2020 2020 202d  ,..            -
-00011f90: 3330 2c0d 0a20 2020 2020 2020 2020 2020  30,..           
-00011fa0: 202d 3435 2c0d 0a20 2020 2020 2020 2020   -45,..         
-00011fb0: 2020 202d 3630 2c0d 0a20 2020 2020 2020     -60,..       
-00011fc0: 2020 2020 202d 3930 2c0d 0a20 2020 2020       -90,..     
-00011fd0: 2020 2029 2c0d 0a20 2020 2029 0d0a 2020     ),..    )..  
-00011fe0: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
-00011ff0: 6e28 5f28 2252 6f74 6174 6520 7b61 6e67  n(_("Rotate {ang
-00012000: 6c65 7dc2 b022 292c 206e 6f64 655f 7479  le}.."), node_ty
-00012010: 7065 3d65 6c65 6d5f 6772 6f75 705f 6e6f  pe=elem_group_no
-00012020: 6465 732c 2068 656c 703d 2222 290d 0a20  des, help="").. 
-00012030: 2020 2064 6566 2072 6f74 6174 655f 656c     def rotate_el
-00012040: 656d 5f61 6d6f 756e 7428 6e6f 6465 2c20  em_amount(node, 
-00012050: 616e 676c 652c 202a 2a6b 7761 7267 7329  angle, **kwargs)
-00012060: 3a0d 0a20 2020 2020 2020 2074 7572 6e73  :..        turns
-00012070: 203d 2066 6c6f 6174 2861 6e67 6c65 2920   = float(angle) 
-00012080: 2f20 3336 302e 300d 0a20 2020 2020 2020  / 360.0..       
-00012090: 2062 6f75 6e64 7320 3d20 7365 6c66 2e5f   bounds = self._
-000120a0: 656d 7068 6173 697a 6564 5f62 6f75 6e64  emphasized_bound
-000120b0: 730d 0a20 2020 2020 2020 2069 6620 626f  s..        if bo
-000120c0: 756e 6473 2069 7320 4e6f 6e65 3a0d 0a20  unds is None:.. 
-000120d0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000120e0: 6e0d 0a20 2020 2020 2020 2063 656e 7465  n..        cente
-000120f0: 725f 7820 3d20 2862 6f75 6e64 735b 325d  r_x = (bounds[2]
-00012100: 202b 2062 6f75 6e64 735b 305d 2920 2f20   + bounds[0]) / 
-00012110: 322e 300d 0a20 2020 2020 2020 2063 656e  2.0..        cen
-00012120: 7465 725f 7920 3d20 2862 6f75 6e64 735b  ter_y = (bounds[
-00012130: 335d 202b 2062 6f75 6e64 735b 315d 2920  3] + bounds[1]) 
-00012140: 2f20 322e 300d 0a20 2020 2020 2020 2073  / 2.0..        s
-00012150: 656c 6628 6622 726f 7461 7465 207b 7475  elf(f"rotate {tu
-00012160: 726e 737d 7475 726e 207b 6365 6e74 6572  rns}turn {center
-00012170: 5f78 7d20 7b63 656e 7465 725f 797d 5c6e  _x} {center_y}\n
-00012180: 2229 0d0a 2020 2020 2020 2020 7365 6c66  ")..        self
-00012190: 2e73 6967 6e61 6c28 2265 7874 2d6d 6f64  .signal("ext-mod
-000121a0: 6966 6965 6422 290d 0a0d 0a20 2020 2040  ified")....    @
-000121b0: 7472 6565 5f63 6f6e 6469 7469 6f6e 616c  tree_conditional
-000121c0: 286c 616d 6264 6120 6e6f 6465 3a20 6e6f  (lambda node: no
-000121d0: 7420 6973 5f72 6567 6d61 726b 286e 6f64  t is_regmark(nod
-000121e0: 6529 290d 0a20 2020 2040 7472 6565 5f63  e))..    @tree_c
-000121f0: 6f6e 6469 7469 6f6e 616c 286c 616d 6264  onditional(lambd
-00012200: 6120 6e6f 6465 3a20 6861 735f 6368 616e  a node: has_chan
-00012210: 6765 7328 6e6f 6465 2929 0d0a 2020 2020  ges(node))..    
-00012220: 4074 7265 655f 636f 6e64 6974 696f 6e61  @tree_conditiona
-00012230: 6c5f 7472 7928 6c61 6d62 6461 206e 6f64  l_try(lambda nod
-00012240: 653a 206e 6f74 206e 6f64 652e 6c6f 636b  e: not node.lock
-00012250: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
-00012260: 7261 7469 6f6e 285f 2822 5265 6966 7920  ration(_("Reify 
-00012270: 5573 6572 2043 6861 6e67 6573 2229 2c20  User Changes"), 
-00012280: 6e6f 6465 5f74 7970 653d 656c 656d 5f67  node_type=elem_g
-00012290: 726f 7570 5f6e 6f64 6573 2c20 6865 6c70  roup_nodes, help
-000122a0: 3d22 2229 0d0a 2020 2020 6465 6620 7265  ="")..    def re
-000122b0: 6966 795f 656c 656d 5f63 6861 6e67 6573  ify_elem_changes
-000122c0: 286e 6f64 652c 202a 2a6b 7761 7267 7329  (node, **kwargs)
-000122d0: 3a0d 0a20 2020 2020 2020 2073 656c 6628  :..        self(
-000122e0: 2272 6569 6679 5c6e 2229 0d0a 2020 2020  "reify\n")..    
-000122f0: 2020 2020 7365 6c66 2e73 6967 6e61 6c28      self.signal(
-00012300: 2265 7874 2d6d 6f64 6966 6965 6422 290d  "ext-modified").
-00012310: 0a0d 0a20 2020 2040 7472 6565 5f63 6f6e  ...    @tree_con
-00012320: 6469 7469 6f6e 616c 286c 616d 6264 6120  ditional(lambda 
-00012330: 6e6f 6465 3a20 6e6f 7420 6973 5f72 6567  node: not is_reg
-00012340: 6d61 726b 286e 6f64 6529 290d 0a20 2020  mark(node))..   
-00012350: 2040 7472 6565 5f63 6f6e 6469 7469 6f6e   @tree_condition
-00012360: 616c 5f74 7279 286c 616d 6264 6120 6e6f  al_try(lambda no
-00012370: 6465 3a20 6e6f 7420 6e6f 6465 2e6c 6f63  de: not node.loc
-00012380: 6b29 0d0a 2020 2020 4074 7265 655f 6f70  k)..    @tree_op
-00012390: 6572 6174 696f 6e28 5f28 2242 7265 616b  eration(_("Break
-000123a0: 2053 7562 7061 7468 7322 292c 206e 6f64   Subpaths"), nod
-000123b0: 655f 7479 7065 3d22 656c 656d 2070 6174  e_type="elem pat
-000123c0: 6822 2c20 6865 6c70 3d22 2229 0d0a 2020  h", help="")..  
-000123d0: 2020 6465 6620 6272 6561 6b5f 7375 6270    def break_subp
-000123e0: 6174 685f 656c 656d 286e 6f64 652c 202a  ath_elem(node, *
-000123f0: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
-00012400: 2020 2073 656c 6628 2265 6c65 6d65 6e74     self("element
-00012410: 2073 7562 7061 7468 5c6e 2229 0d0a 0d0a   subpath\n")....
-00012420: 2020 2020 4074 7265 655f 636f 6e64 6974      @tree_condit
-00012430: 696f 6e61 6c28 6c61 6d62 6461 206e 6f64  ional(lambda nod
-00012440: 653a 206e 6f74 2069 735f 7265 676d 6172  e: not is_regmar
-00012450: 6b28 6e6f 6465 2929 0d0a 2020 2020 4074  k(node))..    @t
-00012460: 7265 655f 636f 6e64 6974 696f 6e61 6c28  ree_conditional(
-00012470: 6c61 6d62 6461 206e 6f64 653a 2068 6173  lambda node: has
-00012480: 5f63 6861 6e67 6573 286e 6f64 6529 290d  _changes(node)).
-00012490: 0a20 2020 2040 7472 6565 5f63 6f6e 6469  .    @tree_condi
-000124a0: 7469 6f6e 616c 5f74 7279 286c 616d 6264  tional_try(lambd
-000124b0: 6120 6e6f 6465 3a20 6e6f 7420 6e6f 6465  a node: not node
-000124c0: 2e6c 6f63 6b29 0d0a 2020 2020 4074 7265  .lock)..    @tre
-000124d0: 655f 6f70 6572 6174 696f 6e28 5f28 2252  e_operation(_("R
-000124e0: 6573 6574 2075 7365 7220 6368 616e 6765  eset user change
-000124f0: 7322 292c 206e 6f64 655f 7479 7065 3d65  s"), node_type=e
-00012500: 6c65 6d5f 6772 6f75 705f 6e6f 6465 732c  lem_group_nodes,
-00012510: 2068 656c 703d 2222 290d 0a20 2020 2064   help="")..    d
-00012520: 6566 2072 6573 6574 5f75 7365 725f 6368  ef reset_user_ch
-00012530: 616e 6765 7328 6e6f 6465 2c20 636f 7069  anges(node, copi
-00012540: 6573 3d31 2c20 2a2a 6b77 6172 6773 293a  es=1, **kwargs):
-00012550: 0d0a 2020 2020 2020 2020 7365 6c66 2822  ..        self("
-00012560: 7265 7365 745c 6e22 290d 0a20 2020 2020  reset\n")..     
-00012570: 2020 2073 656c 662e 7369 676e 616c 2822     self.signal("
-00012580: 6578 742d 6d6f 6469 6669 6564 2229 0d0a  ext-modified")..
-00012590: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
-000125a0: 6174 696f 6e28 0d0a 2020 2020 2020 2020  ation(..        
-000125b0: 5f28 224d 6572 6765 2069 7465 6d73 2229  _("Merge items")
-000125c0: 2c0d 0a20 2020 2020 2020 206e 6f64 655f  ,..        node_
-000125d0: 7479 7065 3d22 6772 6f75 7022 2c0d 0a20  type="group",.. 
-000125e0: 2020 2020 2020 2068 656c 703d 5f28 224d         help=_("M
-000125f0: 6572 6765 2074 6869 7320 6e6f 6465 2773  erge this node's
-00012600: 2063 6869 6c64 7265 6e20 696e 746f 2031   children into 1
-00012610: 2070 6174 682e 2229 2c0d 0a20 2020 2029   path."),..    )
-00012620: 0d0a 2020 2020 6465 6620 6d65 7267 655f  ..    def merge_
-00012630: 656c 656d 656e 7473 286e 6f64 652c 202a  elements(node, *
-00012640: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
-00012650: 2020 2073 656c 6628 2265 6c65 6d65 6e74     self("element
-00012660: 206d 6572 6765 5c6e 2229 0d0a 2020 2020   merge\n")..    
-00012670: 2020 2020 2320 4973 2074 6865 2067 726f      # Is the gro
-00012680: 7570 206e 6f77 2065 6d70 7479 3f20 2d2d  up now empty? --
-00012690: 3e20 6465 6c65 7465 0d0a 2020 2020 2020  > delete..      
-000126a0: 2020 6966 206c 656e 286e 6f64 652e 6368    if len(node.ch
-000126b0: 696c 6472 656e 2920 3d3d 2030 3a0d 0a20  ildren) == 0:.. 
-000126c0: 2020 2020 2020 2020 2020 206e 6f64 652e             node.
-000126d0: 7265 6d6f 7665 5f6e 6f64 6528 290d 0a0d  remove_node()...
-000126e0: 0a20 2020 2040 7472 6565 5f63 6f6e 6469  .    @tree_condi
-000126f0: 7469 6f6e 616c 286c 616d 6264 6120 6e6f  tional(lambda no
-00012700: 6465 3a20 6e6f 6465 2e6c 6f63 6b29 0d0a  de: node.lock)..
-00012710: 2020 2020 4074 7265 655f 7365 7061 7261      @tree_separa
-00012720: 746f 725f 6265 666f 7265 2829 0d0a 2020  tor_before()..  
-00012730: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
-00012740: 6e28 0d0a 2020 2020 2020 2020 5f28 2255  n(..        _("U
-00012750: 6e6c 6f63 6b20 656c 656d 656e 742c 2061  nlock element, a
-00012760: 6c6c 6f77 7320 6d61 6e69 7075 6c61 7469  llows manipulati
-00012770: 6f6e 2229 2c20 6e6f 6465 5f74 7970 653d  on"), node_type=
-00012780: 656c 656d 5f6e 6f64 6573 2c20 6865 6c70  elem_nodes, help
-00012790: 3d22 220d 0a20 2020 2029 0d0a 2020 2020  =""..    )..    
-000127a0: 6465 6620 656c 656d 656e 745f 756e 6c6f  def element_unlo
-000127b0: 636b 5f6d 616e 6970 756c 6174 696f 6e73  ck_manipulations
-000127c0: 286e 6f64 652c 202a 2a6b 7761 7267 7329  (node, **kwargs)
-000127d0: 3a0d 0a20 2020 2020 2020 2073 656c 6628  :..        self(
-000127e0: 2265 6c65 6d65 6e74 2075 6e6c 6f63 6b5c  "element unlock\
-000127f0: 6e22 290d 0a0d 0a20 2020 2040 7472 6565  n")....    @tree
-00012800: 5f63 6f6e 6469 7469 6f6e 616c 286c 616d  _conditional(lam
-00012810: 6264 6120 6e6f 6465 3a20 6e6f 7420 6e6f  bda node: not no
-00012820: 6465 2e6c 6f63 6b29 0d0a 2020 2020 4074  de.lock)..    @t
-00012830: 7265 655f 7365 7061 7261 746f 725f 6265  ree_separator_be
-00012840: 666f 7265 2829 0d0a 2020 2020 4074 7265  fore()..    @tre
-00012850: 655f 6f70 6572 6174 696f 6e28 0d0a 2020  e_operation(..  
-00012860: 2020 2020 2020 5f28 224c 6f63 6b20 656c        _("Lock el
-00012870: 656d 656e 7473 2c20 7072 6576 656e 7473  ements, prevents
-00012880: 206d 616e 6970 756c 6174 696f 6e73 2229   manipulations")
-00012890: 2c20 6e6f 6465 5f74 7970 653d 656c 656d  , node_type=elem
-000128a0: 5f6e 6f64 6573 2c20 6865 6c70 3d22 220d  _nodes, help="".
-000128b0: 0a20 2020 2029 0d0a 2020 2020 6465 6620  .    )..    def 
-000128c0: 656c 656d 656e 745f 6c6f 636b 5f6d 616e  element_lock_man
-000128d0: 6970 756c 6174 696f 6e73 286e 6f64 652c  ipulations(node,
-000128e0: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
-000128f0: 2020 2020 2073 656c 6628 2265 6c65 6d65       self("eleme
-00012900: 6e74 206c 6f63 6b5c 6e22 290d 0a0d 0a20  nt lock\n").... 
-00012910: 2020 2040 7472 6565 5f63 6f6e 6469 7469     @tree_conditi
-00012920: 6f6e 616c 286c 616d 6264 6120 6e6f 6465  onal(lambda node
-00012930: 3a20 6e6f 6465 2e74 7970 6520 3d3d 2022  : node.type == "
-00012940: 6272 616e 6368 2072 6567 2229 0d0a 2020  branch reg")..  
-00012950: 2020 4074 7265 655f 7365 7061 7261 746f    @tree_separato
-00012960: 725f 6265 666f 7265 2829 0d0a 2020 2020  r_before()..    
-00012970: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
-00012980: 5f28 2254 6f67 676c 6520 7669 7369 6269  _("Toggle visibi
-00012990: 6c69 7479 206f 6620 7265 676d 6172 6b73  lity of regmarks
-000129a0: 2229 2c20 6e6f 6465 5f74 7970 653d 2262  "), node_type="b
-000129b0: 7261 6e63 6820 7265 6722 2c20 6865 6c70  ranch reg", help
-000129c0: 3d22 2229 0d0a 2020 2020 6465 6620 746f  ="")..    def to
-000129d0: 6767 6c65 5f76 6973 6962 696c 6974 7928  ggle_visibility(
-000129e0: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
-000129f0: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
-00012a00: 6967 6e61 6c28 2274 6f67 676c 655f 7265  ignal("toggle_re
-00012a10: 676d 6172 6b73 2229 0d0a 0d0a 2020 2020  gmarks")....    
-00012a20: 4074 7265 655f 636f 6e64 6974 696f 6e61  @tree_conditiona
-00012a30: 6c28 6c61 6d62 6461 206e 6f64 653a 2069  l(lambda node: i
-00012a40: 735f 7265 676d 6172 6b28 6e6f 6465 2929  s_regmark(node))
-00012a50: 0d0a 2020 2020 4074 7265 655f 7365 7061  ..    @tree_sepa
-00012a60: 7261 746f 725f 6265 666f 7265 2829 0d0a  rator_before()..
-00012a70: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
-00012a80: 696f 6e28 5f28 224d 6f76 6520 6261 636b  ion(_("Move back
-00012a90: 2074 6f20 656c 656d 656e 7473 2229 2c20   to elements"), 
-00012aa0: 6e6f 6465 5f74 7970 653d 656c 656d 5f67  node_type=elem_g
-00012ab0: 726f 7570 5f6e 6f64 6573 2c20 6865 6c70  roup_nodes, help
-00012ac0: 3d22 2229 0d0a 2020 2020 6465 6620 6d6f  ="")..    def mo
-00012ad0: 7665 5f62 6163 6b28 6e6f 6465 2c20 2a2a  ve_back(node, **
-00012ae0: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
-00012af0: 2020 2320 4472 6167 2061 6e64 2044 726f    # Drag and Dro
-00012b00: 700d 0a20 2020 2020 2020 2077 6974 6820  p..        with 
-00012b10: 7365 6c66 2e73 7461 7469 6328 226d 6f76  self.static("mov
-00012b20: 655f 6261 636b 2229 3a0d 0a20 2020 2020  e_back"):..     
-00012b30: 2020 2020 2020 2073 6967 6e61 6c5f 6e65         signal_ne
-00012b40: 6564 6564 203d 2046 616c 7365 0d0a 2020  eded = False..  
-00012b50: 2020 2020 2020 2020 2020 6472 6f70 5f6e            drop_n
-00012b60: 6f64 6520 3d20 7365 6c66 2e65 6c65 6d5f  ode = self.elem_
-00012b70: 6272 616e 6368 0d0a 2020 2020 2020 2020  branch..        
-00012b80: 2020 2020 6461 7461 203d 206c 6973 7428      data = list(
-00012b90: 290d 0a20 2020 2020 2020 2020 2020 2066  )..            f
-00012ba0: 6f72 2069 7465 6d20 696e 206c 6973 7428  or item in list(
-00012bb0: 7365 6c66 2e72 6567 6d61 726b 7328 2929  self.regmarks())
-00012bc0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00012bd0: 2020 2069 6620 6974 656d 2e73 656c 6563     if item.selec
-00012be0: 7465 643a 0d0a 2020 2020 2020 2020 2020  ted:..          
-00012bf0: 2020 2020 2020 2020 2020 6461 7461 2e61            data.a
-00012c00: 7070 656e 6428 6974 656d 290d 0a20 2020  ppend(item)..   
-00012c10: 2020 2020 2020 2020 2066 6f72 2069 7465           for ite
-00012c20: 6d20 696e 2064 6174 613a 0d0a 2020 2020  m in data:..    
-00012c30: 2020 2020 2020 2020 2020 2020 6472 6f70              drop
-00012c40: 5f6e 6f64 652e 6472 6f70 2869 7465 6d29  _node.drop(item)
-00012c50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00012c60: 2020 7369 676e 616c 5f6e 6565 6465 6420    signal_needed 
-00012c70: 3d20 5472 7565 0d0a 0d0a 2020 2020 4074  = True....    @t
-00012c80: 7265 655f 636f 6e64 6974 696f 6e61 6c28  ree_conditional(
-00012c90: 6c61 6d62 6461 206e 6f64 653a 206e 6f74  lambda node: not
-00012ca0: 2069 735f 7265 676d 6172 6b28 6e6f 6465   is_regmark(node
-00012cb0: 2929 0d0a 2020 2020 4074 7265 655f 7365  ))..    @tree_se
-00012cc0: 7061 7261 746f 725f 6265 666f 7265 2829  parator_before()
-00012cd0: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
-00012ce0: 6174 696f 6e28 5f28 224d 6f76 6520 746f  ation(_("Move to
-00012cf0: 2072 6567 6d61 726b 7322 292c 206e 6f64   regmarks"), nod
-00012d00: 655f 7479 7065 3d65 6c65 6d5f 6772 6f75  e_type=elem_grou
-00012d10: 705f 6e6f 6465 732c 2068 656c 703d 2222  p_nodes, help=""
-00012d20: 290d 0a20 2020 2064 6566 206d 6f76 655f  )..    def move_
-00012d30: 746f 5f72 6567 6d61 726b 286e 6f64 652c  to_regmark(node,
-00012d40: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
-00012d50: 2020 2020 2023 2044 7261 6720 616e 6420       # Drag and 
-00012d60: 4472 6f70 0d0a 2020 2020 2020 2020 7769  Drop..        wi
-00012d70: 7468 2073 656c 662e 7374 6174 6963 2822  th self.static("
-00012d80: 6d6f 7665 5f74 6f5f 7265 6722 293a 0d0a  move_to_reg"):..
-00012d90: 2020 2020 2020 2020 2020 2020 6472 6f70              drop
-00012da0: 5f6e 6f64 6520 3d20 7365 6c66 2e72 6567  _node = self.reg
-00012db0: 5f62 7261 6e63 680d 0a20 2020 2020 2020  _branch..       
-00012dc0: 2020 2020 2064 6174 6120 3d20 6c69 7374       data = list
-00012dd0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-00012de0: 666f 7220 6974 656d 2069 6e20 6c69 7374  for item in list
-00012df0: 2873 656c 662e 656c 656d 735f 6e6f 6465  (self.elems_node
-00012e00: 7328 2929 3a0d 0a20 2020 2020 2020 2020  s()):..         
-00012e10: 2020 2020 2020 2069 6620 6974 656d 2e73         if item.s
-00012e20: 656c 6563 7465 643a 0d0a 2020 2020 2020  elected:..      
-00012e30: 2020 2020 2020 2020 2020 2020 2020 6461                da
-00012e40: 7461 2e61 7070 656e 6428 6974 656d 290d  ta.append(item).
-00012e50: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00012e60: 2069 7465 6d20 696e 2064 6174 613a 0d0a   item in data:..
-00012e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e80: 2320 4e6f 2075 7365 6361 7365 2066 6f72  # No usecase for
-00012e90: 2068 6176 696e 6720 6120 6c6f 636b 6564   having a locked
-00012ea0: 2072 6567 6d61 726b 2065 6c65 6d65 6e74   regmark element
-00012eb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00012ec0: 2020 6966 2068 6173 6174 7472 2869 7465    if hasattr(ite
-00012ed0: 6d2c 2022 6c6f 636b 2229 3a0d 0a20 2020  m, "lock"):..   
-00012ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ef0: 2069 7465 6d2e 6c6f 636b 203d 2046 616c   item.lock = Fal
-00012f00: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
-00012f10: 2020 2020 6472 6f70 5f6e 6f64 652e 6472      drop_node.dr
-00012f20: 6f70 2869 7465 6d29 0d0a 2020 2020 230d  op(item)..    #.
-00012f30: 0a20 2020 2023 2040 7472 6565 5f63 6f6e  .    # @tree_con
-00012f40: 6469 7469 6f6e 616c 286c 616d 6264 6120  ditional(lambda 
-00012f50: 6e6f 6465 3a20 6e6f 7420 6e6f 6465 2e6c  node: not node.l
-00012f60: 6f63 6b29 0d0a 2020 2020 2320 4074 7265  ock)..    # @tre
-00012f70: 655f 636f 6e64 6974 696f 6e61 6c5f 7472  e_conditional_tr
-00012f80: 7928 6c61 6d62 6461 206e 6f64 653a 206e  y(lambda node: n
-00012f90: 6f74 206e 6f64 652e 6c6f 636b 290d 0a20  ot node.lock).. 
-00012fa0: 2020 2023 2040 7472 6565 5f6f 7065 7261     # @tree_opera
-00012fb0: 7469 6f6e 285f 2822 4163 7475 616c 697a  tion(_("Actualiz
-00012fc0: 6520 7069 7865 6c73 2229 2c20 6e6f 6465  e pixels"), node
-00012fd0: 5f74 7970 653d 2265 6c65 6d20 696d 6167  _type="elem imag
-00012fe0: 6522 2c20 6865 6c70 3d22 2229 0d0a 2020  e", help="")..  
-00012ff0: 2020 2320 6465 6620 696d 6167 655f 6163    # def image_ac
-00013000: 7475 616c 697a 655f 7069 7865 6c73 286e  tualize_pixels(n
-00013010: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
-00013020: 0a20 2020 2023 2020 2020 2073 656c 6628  .    #     self(
-00013030: 2269 6d61 6765 2072 6573 616d 706c 655c  "image resample\
+000112a0: 2020 2020 2020 2020 7365 7461 7474 7228          setattr(
+000112b0: 636f 7079 5f6e 6f64 652c 206f 7074 696f  copy_node, optio
+000112c0: 6e61 6c2c 2067 6574 6174 7472 286f 7267  nal, getattr(org
+000112d0: 6e6f 6465 2c20 6f70 7469 6f6e 616c 2929  node, optional))
+000112e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000112f0: 2020 6966 2073 656c 662e 636f 7079 5f69    if self.copy_i
+00011300: 6e63 7265 6173 6573 5f77 6f72 646c 6973  ncreases_wordlis
+00011310: 745f 7265 6665 7265 6e63 6573 2061 6e64  t_references and
+00011320: 2068 6173 6174 7472 286f 7267 6e6f 6465   hasattr(orgnode
+00011330: 2c20 2274 6578 7422 293a 0d0a 2020 2020  , "text"):..    
+00011340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011350: 636f 7079 5f6e 6f64 652e 7465 7874 203d  copy_node.text =
+00011360: 2073 656c 662e 776f 7264 6c69 7374 5f64   self.wordlist_d
+00011370: 656c 7461 286f 7267 6e6f 6465 2e74 6578  elta(orgnode.tex
+00011380: 742c 2064 656c 7461 5f77 6f72 646c 6973  t, delta_wordlis
+00011390: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
+000113a0: 2020 2020 656c 6966 2073 656c 662e 636f      elif self.co
+000113b0: 7079 5f69 6e63 7265 6173 6573 5f77 6f72  py_increases_wor
+000113c0: 646c 6973 745f 7265 6665 7265 6e63 6573  dlist_references
+000113d0: 2061 6e64 2068 6173 6174 7472 2865 2c20   and hasattr(e, 
+000113e0: 226d 6b74 6578 7422 293a 0d0a 2020 2020  "mktext"):..    
+000113f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011400: 636f 7079 5f6e 6f64 652e 6d6b 7465 7874  copy_node.mktext
+00011410: 203d 2073 656c 662e 776f 7264 6c69 7374   = self.wordlist
+00011420: 5f64 656c 7461 2865 2e6d 6b74 6578 742c  _delta(e.mktext,
+00011430: 2064 656c 7461 5f77 6f72 646c 6973 7429   delta_wordlist)
+00011440: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00011450: 2020 6f72 6770 6172 656e 742e 6164 645f    orgparent.add_
+00011460: 6e6f 6465 2863 6f70 795f 6e6f 6465 290d  node(copy_node).
+00011470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011480: 2069 6620 6861 645f 6f70 7469 6f6e 616c   if had_optional
+00011490: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000114a0: 2020 2020 2020 2066 6f72 2070 726f 7065         for prope
+000114b0: 7274 795f 6f70 2069 6e20 7365 6c66 2e6b  rty_op in self.k
+000114c0: 6572 6e65 6c2e 6c6f 6f6b 7570 5f61 6c6c  ernel.lookup_all
+000114d0: 2822 7061 7468 5f75 7064 6174 6572 2f2e  ("path_updater/.
+000114e0: 2a22 293a 0d0a 2020 2020 2020 2020 2020  *"):..          
+000114f0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00011500: 6f70 6572 7479 5f6f 7028 7365 6c66 2e6b  operty_op(self.k
+00011510: 6572 6e65 6c2e 726f 6f74 2c20 636f 7079  ernel.root, copy
+00011520: 5f6e 6f64 6529 0d0a 0d0a 2020 2020 2020  _node)....      
+00011530: 2020 2020 2020 2020 2020 636f 7079 5f6e            copy_n
+00011540: 6f64 6573 2e61 7070 656e 6428 636f 7079  odes.append(copy
+00011550: 5f6e 6f64 6529 0d0a 0d0a 2020 2020 2020  _node)....      
+00011560: 2020 2020 2020 2020 2020 6966 206f 7267            if org
+00011570: 6e6f 6465 2e74 7970 6520 696e 2028 2266  node.type in ("f
+00011580: 696c 6522 2c20 2267 726f 7570 2229 3a0d  ile", "group"):.
+00011590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000115a0: 2020 2020 206e 6577 7061 7265 6e74 203d       newparent =
+000115b0: 2063 6f70 795f 6e6f 6465 0d0a 2020 2020   copy_node..    
+000115c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000115d0: 666f 7220 636e 6f64 6520 696e 206f 7267  for cnode in org
+000115e0: 6e6f 6465 2e63 6869 6c64 7265 6e3a 0d0a  node.children:..
+000115f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011600: 2020 2020 2020 2020 636f 7079 5f73 696e          copy_sin
+00011610: 676c 655f 6e6f 6465 280d 0a20 2020 2020  gle_node(..     
+00011620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011630: 2020 2020 2020 2063 6e6f 6465 2c20 6e65         cnode, ne
+00011640: 7770 6172 656e 742c 2031 2c20 286e 202b  wparent, 1, (n +
+00011650: 2031 2920 2a20 6478 2c20 286e 202b 2031   1) * dx, (n + 1
+00011660: 2920 2a20 6479 0d0a 2020 2020 2020 2020  ) * dy..        
+00011670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011680: 290d 0a0d 0a20 2020 2020 2020 2063 6f70  )....        cop
+00011690: 795f 6e6f 6465 7320 3d20 6c69 7374 2829  y_nodes = list()
+000116a0: 0d0a 2020 2020 2020 2020 6478 203d 2073  ..        dx = s
+000116b0: 656c 662e 6c65 6e67 7468 5f78 2822 336d  elf.length_x("3m
+000116c0: 6d22 290d 0a20 2020 2020 2020 2064 7920  m")..        dy 
+000116d0: 3d20 7365 6c66 2e6c 656e 6774 685f 7928  = self.length_y(
+000116e0: 2233 6d6d 2229 0d0a 2020 2020 2020 2020  "3mm")..        
+000116f0: 616c 6c64 6174 6120 3d20 6c69 7374 2873  alldata = list(s
+00011700: 656c 662e 656c 656d 7328 656d 7068 6173  elf.elems(emphas
+00011710: 697a 6564 3d54 7275 6529 290d 0a20 2020  ized=True))..   
+00011720: 2020 2020 206d 696e 696d 616c 6461 7461       minimaldata
+00011730: 203d 2073 656c 662e 636f 6e64 656e 7365   = self.condense
+00011740: 5f65 6c65 6d65 6e74 7328 616c 6c64 6174  _elements(alldat
+00011750: 612c 2065 7870 616e 645f 6174 5f65 6e64  a, expand_at_end
+00011760: 3d46 616c 7365 290d 0a20 2020 2020 2020  =False)..       
+00011770: 2066 6f72 2065 2069 6e20 6d69 6e69 6d61   for e in minima
+00011780: 6c64 6174 613a 0d0a 2020 2020 2020 2020  ldata:..        
+00011790: 2020 2020 7061 7265 6e74 203d 2065 2e70      parent = e.p
+000117a0: 6172 656e 740d 0a20 2020 2020 2020 2020  arent..         
+000117b0: 2020 2063 6f70 795f 7369 6e67 6c65 5f6e     copy_single_n
+000117c0: 6f64 6528 652c 2070 6172 656e 742c 2063  ode(e, parent, c
+000117d0: 6f70 6965 732c 2064 782c 2064 7929 0d0a  opies, dx, dy)..
+000117e0: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+000117f0: 662e 636c 6173 7369 6679 5f6e 6577 3a0d  f.classify_new:.
+00011800: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00011810: 662e 636c 6173 7369 6679 2863 6f70 795f  f.classify(copy_
+00011820: 6e6f 6465 7329 0d0a 0d0a 2020 2020 2020  nodes)....      
+00011830: 2020 7365 6c66 2e73 6574 5f65 6d70 6861    self.set_empha
+00011840: 7369 7328 4e6f 6e65 290d 0a0d 0a20 2020  sis(None)....   
+00011850: 2064 6566 2068 6173 5f77 6f72 646c 6973   def has_wordlis
+00011860: 7428 6e6f 6465 293a 0d0a 2020 2020 2020  t(node):..      
+00011870: 2020 7265 7375 6c74 203d 2046 616c 7365    result = False
+00011880: 0d0a 2020 2020 2020 2020 7478 7420 3d20  ..        txt = 
+00011890: 2222 0d0a 2020 2020 2020 2020 6966 2068  ""..        if h
+000118a0: 6173 6174 7472 286e 6f64 652c 2022 7465  asattr(node, "te
+000118b0: 7874 2229 2061 6e64 206e 6f64 652e 7465  xt") and node.te
+000118c0: 7874 2069 7320 6e6f 7420 4e6f 6e65 3a0d  xt is not None:.
+000118d0: 0a20 2020 2020 2020 2020 2020 2074 7874  .            txt
+000118e0: 203d 2073 7472 286e 6f64 652e 7465 7874   = str(node.text
+000118f0: 290d 0a20 2020 2020 2020 2069 6620 6861  )..        if ha
+00011900: 7361 7474 7228 6e6f 6465 2c20 226d 6b74  sattr(node, "mkt
+00011910: 6578 7422 2920 616e 6420 6e6f 6465 2e6d  ext") and node.m
+00011920: 6b74 6578 7420 6973 206e 6f74 204e 6f6e  ktext is not Non
+00011930: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00011940: 7478 7420 3d20 7374 7228 6e6f 6465 2e6d  txt = str(node.m
+00011950: 6b74 6578 7429 0d0a 2020 2020 2020 2020  ktext)..        
+00011960: 2320 5665 7279 2073 7475 7069 642c 2062  # Very stupid, b
+00011970: 7574 2067 6f6f 6420 656e 6f75 6768 0d0a  ut good enough..
+00011980: 2020 2020 2020 2020 6966 2022 7b22 2069          if "{" i
+00011990: 6e20 7478 7420 616e 6420 227d 2220 696e  n txt and "}" in
+000119a0: 2074 7874 3a0d 0a20 2020 2020 2020 2020   txt:..         
+000119b0: 2020 2072 6573 756c 7420 3d20 5472 7565     result = True
+000119c0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+000119d0: 2072 6573 756c 740d 0a0d 0a20 2020 2040   result....    @
+000119e0: 7472 6565 5f63 6f6e 6469 7469 6f6e 616c  tree_conditional
+000119f0: 286c 616d 6264 6120 6e6f 6465 3a20 6861  (lambda node: ha
+00011a00: 735f 776f 7264 6c69 7374 286e 6f64 6529  s_wordlist(node)
+00011a10: 290d 0a20 2020 2040 7472 6565 5f6f 7065  )..    @tree_ope
+00011a20: 7261 7469 6f6e 280d 0a20 2020 2020 2020  ration(..       
+00011a30: 205f 2822 496e 6372 6561 7365 2057 6f72   _("Increase Wor
+00011a40: 646c 6973 742d 5265 6665 7265 6e63 6522  dlist-Reference"
+00011a50: 292c 0d0a 2020 2020 2020 2020 6e6f 6465  ),..        node
+00011a60: 5f74 7970 653d 280d 0a20 2020 2020 2020  _type=(..       
+00011a70: 2020 2020 2022 656c 656d 2074 6578 7422       "elem text"
+00011a80: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
+00011a90: 656c 656d 2070 6174 6822 2c0d 0a20 2020  elem path",..   
+00011aa0: 2020 2020 2029 2c0d 0a20 2020 2020 2020       ),..       
+00011ab0: 2068 656c 703d 5f28 2241 646a 7573 7473   help=_("Adjusts
+00011ac0: 2074 6865 2072 6566 6572 656e 6365 2076   the reference v
+00011ad0: 616c 7565 2066 6f72 2061 2077 6f72 646c  alue for a wordl
+00011ae0: 6973 742c 2069 6520 7b6e 616d 657d 2074  ist, ie {name} t
+00011af0: 6f20 7b6e 616d 6523 2b31 7d22 292c 0d0a  o {name#+1}"),..
+00011b00: 2020 2020 290d 0a20 2020 2064 6566 2077      )..    def w
+00011b10: 6c69 7374 5f70 6c75 7328 7369 6e67 6c65  list_plus(single
+00011b20: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
+00011b30: 0d0a 2020 2020 2020 2020 6461 7461 203d  ..        data =
+00011b40: 206c 6973 7428 290d 0a20 2020 2020 2020   list()..       
+00011b50: 2066 6f72 206e 6f64 6520 696e 206c 6973   for node in lis
+00011b60: 7428 7365 6c66 2e65 6c65 6d73 2865 6d70  t(self.elems(emp
+00011b70: 6861 7369 7a65 643d 5472 7565 2929 3a0d  hasized=True)):.
+00011b80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00011b90: 6e6f 7420 6861 735f 776f 7264 6c69 7374  not has_wordlist
+00011ba0: 286e 6f64 6529 3a0d 0a20 2020 2020 2020  (node):..       
+00011bb0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+00011bc0: 650d 0a20 2020 2020 2020 2020 2020 2064  e..            d
+00011bd0: 656c 7461 5f77 6f72 646c 6973 7420 3d20  elta_wordlist = 
+00011be0: 310d 0a20 2020 2020 2020 2020 2020 2069  1..            i
+00011bf0: 6620 6861 7361 7474 7228 6e6f 6465 2c20  f hasattr(node, 
+00011c00: 2274 6578 7422 293a 0d0a 2020 2020 2020  "text"):..      
+00011c10: 2020 2020 2020 2020 2020 6e6f 6465 2e74            node.t
+00011c20: 6578 7420 3d20 7365 6c66 2e77 6f72 646c  ext = self.wordl
+00011c30: 6973 745f 6465 6c74 6128 6e6f 6465 2e74  ist_delta(node.t
+00011c40: 6578 742c 2064 656c 7461 5f77 6f72 646c  ext, delta_wordl
+00011c50: 6973 7429 0d0a 2020 2020 2020 2020 2020  ist)..          
+00011c60: 2020 2020 2020 6e6f 6465 2e61 6c74 6572        node.alter
+00011c70: 6564 2829 0d0a 2020 2020 2020 2020 2020  ed()..          
+00011c80: 2020 2020 2020 6461 7461 2e61 7070 656e        data.appen
+00011c90: 6428 6e6f 6465 290d 0a20 2020 2020 2020  d(node)..       
+00011ca0: 2020 2020 2065 6c69 6620 6861 7361 7474       elif hasatt
+00011cb0: 7228 6e6f 6465 2c20 226d 6b74 6578 7422  r(node, "mktext"
+00011cc0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00011cd0: 2020 2020 6e6f 6465 2e6d 6b74 6578 7420      node.mktext 
+00011ce0: 3d20 7365 6c66 2e77 6f72 646c 6973 745f  = self.wordlist_
+00011cf0: 6465 6c74 6128 6e6f 6465 2e6d 6b74 6578  delta(node.mktex
+00011d00: 742c 2064 656c 7461 5f77 6f72 646c 6973  t, delta_wordlis
+00011d10: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
+00011d20: 2020 2020 666f 7220 7072 6f70 6572 7479      for property
+00011d30: 5f6f 7020 696e 2073 656c 662e 6b65 726e  _op in self.kern
+00011d40: 656c 2e6c 6f6f 6b75 705f 616c 6c28 2270  el.lookup_all("p
+00011d50: 6174 685f 7570 6461 7465 722f 2e2a 2229  ath_updater/.*")
+00011d60: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00011d70: 2020 2020 2020 2070 726f 7065 7274 795f         property_
+00011d80: 6f70 2873 656c 662e 6b65 726e 656c 2e72  op(self.kernel.r
+00011d90: 6f6f 742c 206e 6f64 6529 0d0a 2020 2020  oot, node)..    
+00011da0: 2020 2020 2020 2020 2020 2020 6461 7461              data
+00011db0: 2e61 7070 656e 6428 6e6f 6465 290d 0a20  .append(node).. 
+00011dc0: 2020 2020 2020 2073 656c 662e 7369 676e         self.sign
+00011dd0: 616c 2822 656c 656d 656e 745f 7072 6f70  al("element_prop
+00011de0: 6572 7479 5f75 7064 6174 6522 2c20 6461  erty_update", da
+00011df0: 7461 290d 0a0d 0a20 2020 2040 7472 6565  ta)....    @tree
+00011e00: 5f63 6f6e 6469 7469 6f6e 616c 286c 616d  _conditional(lam
+00011e10: 6264 6120 6e6f 6465 3a20 6861 735f 776f  bda node: has_wo
+00011e20: 7264 6c69 7374 286e 6f64 6529 290d 0a20  rdlist(node)).. 
+00011e30: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
+00011e40: 6f6e 280d 0a20 2020 2020 2020 205f 2822  on(..        _("
+00011e50: 4465 6372 6561 7365 2057 6f72 646c 6973  Decrease Wordlis
+00011e60: 742d 5265 6665 7265 6e63 6522 292c 0d0a  t-Reference"),..
+00011e70: 2020 2020 2020 2020 6e6f 6465 5f74 7970          node_typ
+00011e80: 653d 280d 0a20 2020 2020 2020 2020 2020  e=(..           
+00011e90: 2022 656c 656d 2074 6578 7422 2c0d 0a20   "elem text",.. 
+00011ea0: 2020 2020 2020 2020 2020 2022 656c 656d             "elem
+00011eb0: 2070 6174 6822 2c0d 0a20 2020 2020 2020   path",..       
+00011ec0: 2029 2c0d 0a20 2020 2020 2020 2068 656c   ),..        hel
+00011ed0: 703d 5f28 2241 646a 7573 7473 2074 6865  p=_("Adjusts the
+00011ee0: 2072 6566 6572 656e 6365 2076 616c 7565   reference value
+00011ef0: 2066 6f72 2061 2077 6f72 646c 6973 742c   for a wordlist,
+00011f00: 2069 6520 7b6e 616d 6523 2b33 7d20 746f   ie {name#+3} to
+00011f10: 207b 6e61 6d65 232b 327d 2229 2c0d 0a20   {name#+2}"),.. 
+00011f20: 2020 2029 0d0a 2020 2020 6465 6620 776c     )..    def wl
+00011f30: 6973 745f 6d69 6e75 7328 7369 6e67 6c65  ist_minus(single
+00011f40: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
+00011f50: 0d0a 2020 2020 2020 2020 6461 7461 203d  ..        data =
+00011f60: 206c 6973 7428 290d 0a20 2020 2020 2020   list()..       
+00011f70: 2066 6f72 206e 6f64 6520 696e 206c 6973   for node in lis
+00011f80: 7428 7365 6c66 2e65 6c65 6d73 2865 6d70  t(self.elems(emp
+00011f90: 6861 7369 7a65 643d 5472 7565 2929 3a0d  hasized=True)):.
+00011fa0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00011fb0: 6e6f 7420 6861 735f 776f 7264 6c69 7374  not has_wordlist
+00011fc0: 286e 6f64 6529 3a0d 0a20 2020 2020 2020  (node):..       
+00011fd0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+00011fe0: 650d 0a20 2020 2020 2020 2020 2020 2064  e..            d
+00011ff0: 656c 7461 5f77 6f72 646c 6973 7420 3d20  elta_wordlist = 
+00012000: 2d31 0d0a 2020 2020 2020 2020 2020 2020  -1..            
+00012010: 6966 2068 6173 6174 7472 286e 6f64 652c  if hasattr(node,
+00012020: 2022 7465 7874 2229 3a0d 0a20 2020 2020   "text"):..     
+00012030: 2020 2020 2020 2020 2020 206e 6f64 652e             node.
+00012040: 7465 7874 203d 2073 656c 662e 776f 7264  text = self.word
+00012050: 6c69 7374 5f64 656c 7461 286e 6f64 652e  list_delta(node.
+00012060: 7465 7874 2c20 6465 6c74 615f 776f 7264  text, delta_word
+00012070: 6c69 7374 290d 0a20 2020 2020 2020 2020  list)..         
+00012080: 2020 2020 2020 206e 6f64 652e 616c 7465         node.alte
+00012090: 7265 6428 290d 0a20 2020 2020 2020 2020  red()..         
+000120a0: 2020 2020 2020 2064 6174 612e 6170 7065         data.appe
+000120b0: 6e64 286e 6f64 6529 0d0a 2020 2020 2020  nd(node)..      
+000120c0: 2020 2020 2020 656c 6966 2068 6173 6174        elif hasat
+000120d0: 7472 286e 6f64 652c 2022 6d6b 7465 7874  tr(node, "mktext
+000120e0: 2229 3a0d 0a20 2020 2020 2020 2020 2020  "):..           
+000120f0: 2020 2020 206e 6f64 652e 6d6b 7465 7874       node.mktext
+00012100: 203d 2073 656c 662e 776f 7264 6c69 7374   = self.wordlist
+00012110: 5f64 656c 7461 286e 6f64 652e 6d6b 7465  _delta(node.mkte
+00012120: 7874 2c20 6465 6c74 615f 776f 7264 6c69  xt, delta_wordli
+00012130: 7374 290d 0a20 2020 2020 2020 2020 2020  st)..           
+00012140: 2020 2020 2066 6f72 2070 726f 7065 7274       for propert
+00012150: 795f 6f70 2069 6e20 7365 6c66 2e6b 6572  y_op in self.ker
+00012160: 6e65 6c2e 6c6f 6f6b 7570 5f61 6c6c 2822  nel.lookup_all("
+00012170: 7061 7468 5f75 7064 6174 6572 2f2e 2a22  path_updater/.*"
+00012180: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00012190: 2020 2020 2020 2020 7072 6f70 6572 7479          property
+000121a0: 5f6f 7028 7365 6c66 2e6b 6572 6e65 6c2e  _op(self.kernel.
+000121b0: 726f 6f74 2c20 6e6f 6465 290d 0a20 2020  root, node)..   
+000121c0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+000121d0: 612e 6170 7065 6e64 286e 6f64 6529 0d0a  a.append(node)..
+000121e0: 2020 2020 2020 2020 7365 6c66 2e73 6967          self.sig
+000121f0: 6e61 6c28 2265 6c65 6d65 6e74 5f70 726f  nal("element_pro
+00012200: 7065 7274 795f 7570 6461 7465 222c 2064  perty_update", d
+00012210: 6174 6129 0d0a 0d0a 2020 2020 4074 7265  ata)....    @tre
+00012220: 655f 636f 6e64 6974 696f 6e61 6c28 6c61  e_conditional(la
+00012230: 6d62 6461 206e 6f64 653a 2068 6173 5f76  mbda node: has_v
+00012240: 6563 746f 7269 7a65 286e 6f64 6529 290d  ectorize(node)).
+00012250: 0a20 2020 2040 7472 6565 5f73 7562 6d65  .    @tree_subme
+00012260: 6e75 285f 2822 4f75 746c 696e 6520 656c  nu(_("Outline el
+00012270: 656d 656e 7428 7329 2e2e 2e22 2929 0d0a  ement(s)..."))..
+00012280: 2020 2020 4074 7265 655f 6974 6572 6174      @tree_iterat
+00012290: 6528 226f 6666 7365 7422 2c20 312c 2031  e("offset", 1, 1
+000122a0: 3029 0d0a 2020 2020 4074 7265 655f 6f70  0)..    @tree_op
+000122b0: 6572 6174 696f 6e28 0d0a 2020 2020 2020  eration(..      
+000122c0: 2020 5f28 222e 2e2e 7769 7468 207b 6f66    _("...with {of
+000122d0: 6673 6574 7d6d 6d20 6469 7374 616e 6365  fset}mm distance
+000122e0: 2229 2c0d 0a20 2020 2020 2020 206e 6f64  "),..        nod
+000122f0: 655f 7479 7065 3d65 6c65 6d5f 6e6f 6465  e_type=elem_node
+00012300: 732c 0d0a 2020 2020 2020 2020 6865 6c70  s,..        help
+00012310: 3d22 222c 0d0a 2020 2020 290d 0a20 2020  ="",..    )..   
+00012320: 2064 6566 206d 616b 655f 6f75 746c 696e   def make_outlin
+00012330: 6573 286e 6f64 652c 206f 6666 7365 743d  es(node, offset=
+00012340: 312c 202a 2a6b 7761 7267 7329 3a0d 0a20  1, **kwargs):.. 
+00012350: 2020 2020 2020 2073 656c 6628 6622 6f75         self(f"ou
+00012360: 746c 696e 6520 7b6f 6666 7365 747d 6d6d  tline {offset}mm
+00012370: 5c6e 2229 0d0a 2020 2020 2020 2020 7365  \n")..        se
+00012380: 6c66 2e73 6967 6e61 6c28 2272 6566 7265  lf.signal("refre
+00012390: 7368 5f74 7265 6522 290d 0a0d 0a20 2020  sh_tree")....   
+000123a0: 2064 6566 2068 6173 5f76 6563 746f 7269   def has_vectori
+000123b0: 7a65 286e 6f64 6529 3a0d 0a20 2020 2020  ze(node):..     
+000123c0: 2020 2072 6573 756c 7420 3d20 4661 6c73     result = Fals
+000123d0: 650d 0a20 2020 2020 2020 206d 616b 655f  e..        make_
+000123e0: 7665 6374 6f72 203d 2073 656c 662e 6c6f  vector = self.lo
+000123f0: 6f6b 7570 2822 7265 6e64 6572 2d6f 702f  okup("render-op/
+00012400: 6d61 6b65 5f76 6563 746f 7222 290d 0a20  make_vector").. 
+00012410: 2020 2020 2020 2069 6620 6d61 6b65 5f76         if make_v
+00012420: 6563 746f 723a 0d0a 2020 2020 2020 2020  ector:..        
+00012430: 2020 2020 7265 7375 6c74 203d 2054 7275      result = Tru
+00012440: 650d 0a20 2020 2020 2020 2072 6574 7572  e..        retur
+00012450: 6e20 7265 7375 6c74 0d0a 0d0a 2020 2020  n result....    
+00012460: 4074 7265 655f 636f 6e64 6974 696f 6e61  @tree_conditiona
+00012470: 6c28 6c61 6d62 6461 206e 6f64 653a 2068  l(lambda node: h
+00012480: 6173 5f76 6563 746f 7269 7a65 286e 6f64  as_vectorize(nod
+00012490: 6529 290d 0a20 2020 2040 7472 6565 5f6f  e))..    @tree_o
+000124a0: 7065 7261 7469 6f6e 280d 0a20 2020 2020  peration(..     
+000124b0: 2020 205f 2822 5472 6163 6520 6269 746d     _("Trace bitm
+000124c0: 6170 2229 2c0d 0a20 2020 2020 2020 206e  ap"),..        n
+000124d0: 6f64 655f 7479 7065 3d28 0d0a 2020 2020  ode_type=(..    
+000124e0: 2020 2020 2020 2020 2265 6c65 6d20 7465          "elem te
+000124f0: 7874 222c 0d0a 2020 2020 2020 2020 2020  xt",..          
+00012500: 2020 2265 6c65 6d20 696d 6167 6522 2c0d    "elem image",.
+00012510: 0a20 2020 2020 2020 2029 2c0d 0a20 2020  .        ),..   
+00012520: 2020 2020 2068 656c 703d 5f28 2256 6563       help=_("Vec
+00012530: 746f 7269 7a65 2074 6865 2067 6976 656e  torize the given
+00012540: 2065 6c65 6d65 6e74 2229 2c0d 0a20 2020   element"),..   
+00012550: 2029 0d0a 2020 2020 6465 6620 7472 6163   )..    def trac
+00012560: 655f 6269 746d 6170 286e 6f64 652c 202a  e_bitmap(node, *
+00012570: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
+00012580: 2020 2073 656c 6628 2276 6563 746f 7269     self("vectori
+00012590: 7a65 5c6e 2229 0d0a 0d0a 2020 2020 4074  ze\n")....    @t
+000125a0: 7265 655f 636f 6e64 6974 696f 6e61 6c28  ree_conditional(
+000125b0: 6c61 6d62 6461 206e 6f64 653a 206e 6f74  lambda node: not
+000125c0: 2069 735f 7265 676d 6172 6b28 6e6f 6465   is_regmark(node
+000125d0: 2929 0d0a 2020 2020 4074 7265 655f 6f70  ))..    @tree_op
+000125e0: 6572 6174 696f 6e28 0d0a 2020 2020 2020  eration(..      
+000125f0: 2020 5f28 2243 6f6e 7665 7274 2074 6f20    _("Convert to 
+00012600: 7061 7468 2229 2c0d 0a20 2020 2020 2020  path"),..       
+00012610: 206e 6f64 655f 7479 7065 3d28 0d0a 2020   node_type=(..  
+00012620: 2020 2020 2020 2020 2020 2265 6c65 6d20            "elem 
+00012630: 656c 6c69 7073 6522 2c0d 0a20 2020 2020  ellipse",..     
+00012640: 2020 2020 2020 2022 656c 656d 2070 6174         "elem pat
+00012650: 6822 2c0d 0a20 2020 2020 2020 2020 2020  h",..           
+00012660: 2022 656c 656d 2070 6f6c 796c 696e 6522   "elem polyline"
+00012670: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
+00012680: 656c 656d 2072 6563 7422 2c0d 0a20 2020  elem rect",..   
+00012690: 2020 2020 2020 2020 2022 656c 656d 206c           "elem l
+000126a0: 696e 6522 2c0d 0a20 2020 2020 2020 2029  ine",..        )
+000126b0: 2c0d 0a20 2020 2020 2020 2068 656c 703d  ,..        help=
+000126c0: 2222 2c0d 0a20 2020 2029 0d0a 2020 2020  "",..    )..    
+000126d0: 6465 6620 636f 6e76 6572 745f 746f 5f70  def convert_to_p
+000126e0: 6174 6828 7369 6e67 6c65 6e6f 6465 2c20  ath(singlenode, 
+000126f0: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
+00012700: 2020 2020 666f 7220 6e6f 6465 2069 6e20      for node in 
+00012710: 6c69 7374 2873 656c 662e 656c 656d 7328  list(self.elems(
+00012720: 656d 7068 6173 697a 6564 3d54 7275 6529  emphasized=True)
+00012730: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00012740: 6966 206e 6f74 206e 6f64 6520 6e6f 7420  if not node not 
+00012750: 696e 2028 0d0a 2020 2020 2020 2020 2020  in (..          
+00012760: 2020 2020 2020 2265 6c65 6d20 656c 6c69        "elem elli
+00012770: 7073 6522 2c0d 0a20 2020 2020 2020 2020  pse",..         
+00012780: 2020 2020 2020 2022 656c 656d 2070 6174         "elem pat
+00012790: 6822 2c0d 0a20 2020 2020 2020 2020 2020  h",..           
+000127a0: 2020 2020 2022 656c 656d 2070 6f6c 796c       "elem polyl
+000127b0: 696e 6522 2c0d 0a20 2020 2020 2020 2020  ine",..         
+000127c0: 2020 2020 2020 2022 656c 656d 2072 6563         "elem rec
+000127d0: 7422 2c0d 0a20 2020 2020 2020 2020 2020  t",..           
+000127e0: 2020 2020 2022 656c 656d 206c 696e 6522       "elem line"
+000127f0: 2c0d 0a20 2020 2020 2020 2020 2020 2029  ,..            )
+00012800: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00012810: 2020 2063 6f6e 7469 6e75 650d 0a20 2020     continue..   
+00012820: 2020 2020 2020 2020 206f 6c64 7374 7566           oldstuf
+00012830: 6620 3d20 5b5d 0d0a 2020 2020 2020 2020  f = []..        
+00012840: 2020 2020 666f 7220 6174 7472 6962 2069      for attrib i
+00012850: 6e20 2822 7374 726f 6b65 222c 2022 6669  n ("stroke", "fi
+00012860: 6c6c 222c 2022 7374 726f 6b65 5f77 6964  ll", "stroke_wid
+00012870: 7468 222c 2022 7374 726f 6b65 5f73 6361  th", "stroke_sca
+00012880: 6c65 6422 293a 0d0a 2020 2020 2020 2020  led"):..        
+00012890: 2020 2020 2020 2020 6966 2068 6173 6174          if hasat
+000128a0: 7472 286e 6f64 652c 2061 7474 7269 6229  tr(node, attrib)
+000128b0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000128c0: 2020 2020 2020 206f 6c64 7661 6c20 3d20         oldval = 
+000128d0: 6765 7461 7474 7228 6e6f 6465 2c20 6174  getattr(node, at
+000128e0: 7472 6962 2c20 4e6f 6e65 290d 0a20 2020  trib, None)..   
+000128f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012900: 206f 6c64 7374 7566 662e 6170 7065 6e64   oldstuff.append
+00012910: 285b 6174 7472 6962 2c20 6f6c 6476 616c  ([attrib, oldval
+00012920: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+00012930: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
+00012940: 2020 2020 2020 7061 7468 203d 206e 6f64        path = nod
+00012950: 652e 6173 5f70 6174 6828 290d 0a20 2020  e.as_path()..   
+00012960: 2020 2020 2020 2020 2020 2020 2023 2054               # T
+00012970: 6865 7265 2061 7265 2073 6f6d 6520 6368  here are some ch
+00012980: 616c 6c65 6e67 6573 2061 726f 756e 6420  allenges around 
+00012990: 7468 6520 7472 6561 746d 656e 740d 0a20  the treatment.. 
+000129a0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+000129b0: 206f 6620 6172 6373 2077 6974 6869 6e20   of arcs within 
+000129c0: 7376 6765 6c65 6d65 6e74 732c 2073 6f20  svgelements, so 
+000129d0: 6c65 7427 7320 6369 7263 756d 7665 6e74  let's circumvent
+000129e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000129f0: 2020 2320 7468 656d 2066 6f72 2074 6865    # them for the
+00012a00: 2074 696d 6520 6265 696e 6720 2875 6e74   time being (unt
+00012a10: 696c 2072 6573 6f6c 7665 6429 0d0a 2020  il resolved)..  
+00012a20: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00012a30: 6279 2072 6570 6c61 6369 6e67 2061 7263  by replacing arc
+00012a40: 2073 6567 6d65 6e74 7320 7769 7468 2063   segments with c
+00012a50: 7562 6963 2062 657a 6965 7273 0d0a 2020  ubic beziers..  
+00012a60: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00012a70: 206e 6f64 652e 7479 7065 2069 6e20 2822   node.type in ("
+00012a80: 656c 656d 2070 6174 6822 2c20 2265 6c65  elem path", "ele
+00012a90: 6d20 656c 6c69 7073 6522 293a 0d0a 2020  m ellipse"):..  
+00012aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ab0: 2020 7061 7468 2e61 7070 726f 7869 6d61    path.approxima
+00012ac0: 7465 5f61 7263 735f 7769 7468 5f63 7562  te_arcs_with_cub
+00012ad0: 6963 7328 290d 0a20 2020 2020 2020 2020  ics()..         
+00012ae0: 2020 2065 7863 6570 7420 4174 7472 6962     except Attrib
+00012af0: 7574 6545 7272 6f72 3a0d 0a20 2020 2020  uteError:..     
+00012b00: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00012b10: 6e0d 0a20 2020 2020 2020 2020 2020 206e  n..            n
+00012b20: 6577 6e6f 6465 203d 206e 6f64 652e 7265  ewnode = node.re
+00012b30: 706c 6163 655f 6e6f 6465 2870 6174 683d  place_node(path=
+00012b40: 7061 7468 2c20 7479 7065 3d22 656c 656d  path, type="elem
+00012b50: 2070 6174 6822 290d 0a20 2020 2020 2020   path")..       
+00012b60: 2020 2020 2066 6f72 2069 7465 6d20 696e       for item in
+00012b70: 206f 6c64 7374 7566 663a 0d0a 2020 2020   oldstuff:..    
+00012b80: 2020 2020 2020 2020 2020 2020 7365 7461              seta
+00012b90: 7474 7228 6e65 776e 6f64 652c 2069 7465  ttr(newnode, ite
+00012ba0: 6d5b 305d 2c20 6974 656d 5b31 5d29 0d0a  m[0], item[1])..
+00012bb0: 2020 2020 2020 2020 2020 2020 6e65 776e              newn
+00012bc0: 6f64 652e 616c 7465 7265 6428 290d 0a0d  ode.altered()...
+00012bd0: 0a20 2020 2040 7472 6565 5f73 7562 6d65  .    @tree_subme
+00012be0: 6e75 285f 2822 466c 6970 2229 290d 0a20  nu(_("Flip")).. 
+00012bf0: 2020 2040 7472 6565 5f73 6570 6172 6174     @tree_separat
+00012c00: 6f72 5f62 6566 6f72 6528 290d 0a20 2020  or_before()..   
+00012c10: 2040 7472 6565 5f63 6f6e 6469 7469 6f6e   @tree_condition
+00012c20: 616c 286c 616d 6264 6120 6e6f 6465 3a20  al(lambda node: 
+00012c30: 6e6f 7420 6973 5f72 6567 6d61 726b 286e  not is_regmark(n
+00012c40: 6f64 6529 290d 0a20 2020 2040 7472 6565  ode))..    @tree
+00012c50: 5f63 6f6e 6469 7469 6f6e 616c 5f74 7279  _conditional_try
+00012c60: 286c 616d 6264 6120 6e6f 6465 3a20 6e6f  (lambda node: no
+00012c70: 7420 6e6f 6465 2e6c 6f63 6b29 0d0a 2020  t node.lock)..  
+00012c80: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
+00012c90: 6e28 0d0a 2020 2020 2020 2020 5f28 2248  n(..        _("H
+00012ca0: 6f72 697a 6f6e 7461 6c6c 7922 292c 0d0a  orizontally"),..
+00012cb0: 2020 2020 2020 2020 6e6f 6465 5f74 7970          node_typ
+00012cc0: 653d 656c 656d 5f67 726f 7570 5f6e 6f64  e=elem_group_nod
+00012cd0: 6573 2c0d 0a20 2020 2020 2020 2068 656c  es,..        hel
+00012ce0: 703d 5f28 224d 6972 726f 7220 486f 7269  p=_("Mirror Hori
+00012cf0: 7a6f 6e74 616c 6c79 2229 2c0d 0a20 2020  zontally"),..   
+00012d00: 2029 0d0a 2020 2020 6465 6620 6d69 7272   )..    def mirr
+00012d10: 6f72 5f65 6c65 6d28 6e6f 6465 2c20 2a2a  or_elem(node, **
+00012d20: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
+00012d30: 2020 626f 756e 6473 203d 2073 656c 662e    bounds = self.
+00012d40: 5f65 6d70 6861 7369 7a65 645f 626f 756e  _emphasized_boun
+00012d50: 6473 0d0a 2020 2020 2020 2020 6966 2062  ds..        if b
+00012d60: 6f75 6e64 7320 6973 204e 6f6e 653a 0d0a  ounds is None:..
+00012d70: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00012d80: 726e 0d0a 2020 2020 2020 2020 6365 6e74  rn..        cent
+00012d90: 6572 5f78 203d 2028 626f 756e 6473 5b32  er_x = (bounds[2
+00012da0: 5d20 2b20 626f 756e 6473 5b30 5d29 202f  ] + bounds[0]) /
+00012db0: 2032 2e30 0d0a 2020 2020 2020 2020 6365   2.0..        ce
+00012dc0: 6e74 6572 5f79 203d 2028 626f 756e 6473  nter_y = (bounds
+00012dd0: 5b33 5d20 2b20 626f 756e 6473 5b31 5d29  [3] + bounds[1])
+00012de0: 202f 2032 2e30 0d0a 2020 2020 2020 2020   / 2.0..        
+00012df0: 7365 6c66 2866 2273 6361 6c65 202d 3120  self(f"scale -1 
+00012e00: 3120 7b63 656e 7465 725f 787d 207b 6365  1 {center_x} {ce
+00012e10: 6e74 6572 5f79 7d5c 6e22 290d 0a0d 0a20  nter_y}\n").... 
+00012e20: 2020 2040 7472 6565 5f63 6f6e 6469 7469     @tree_conditi
+00012e30: 6f6e 616c 286c 616d 6264 6120 6e6f 6465  onal(lambda node
+00012e40: 3a20 6e6f 7420 6973 5f72 6567 6d61 726b  : not is_regmark
+00012e50: 286e 6f64 6529 290d 0a20 2020 2040 7472  (node))..    @tr
+00012e60: 6565 5f73 7562 6d65 6e75 285f 2822 466c  ee_submenu(_("Fl
+00012e70: 6970 2229 290d 0a20 2020 2040 7472 6565  ip"))..    @tree
+00012e80: 5f63 6f6e 6469 7469 6f6e 616c 5f74 7279  _conditional_try
+00012e90: 286c 616d 6264 6120 6e6f 6465 3a20 6e6f  (lambda node: no
+00012ea0: 7420 6e6f 6465 2e6c 6f63 6b29 0d0a 2020  t node.lock)..  
+00012eb0: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
+00012ec0: 6e28 0d0a 2020 2020 2020 2020 5f28 2256  n(..        _("V
+00012ed0: 6572 7469 6361 6c6c 7922 292c 0d0a 2020  ertically"),..  
+00012ee0: 2020 2020 2020 6e6f 6465 5f74 7970 653d        node_type=
+00012ef0: 656c 656d 5f67 726f 7570 5f6e 6f64 6573  elem_group_nodes
+00012f00: 2c0d 0a20 2020 2020 2020 2068 656c 703d  ,..        help=
+00012f10: 5f28 2246 6c69 7020 5665 7274 6963 616c  _("Flip Vertical
+00012f20: 6c79 2229 2c0d 0a20 2020 2029 0d0a 2020  ly"),..    )..  
+00012f30: 2020 6465 6620 666c 6970 5f65 6c65 6d28    def flip_elem(
+00012f40: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
+00012f50: 0d0a 2020 2020 2020 2020 626f 756e 6473  ..        bounds
+00012f60: 203d 2073 656c 662e 5f65 6d70 6861 7369   = self._emphasi
+00012f70: 7a65 645f 626f 756e 6473 0d0a 2020 2020  zed_bounds..    
+00012f80: 2020 2020 6966 2062 6f75 6e64 7320 6973      if bounds is
+00012f90: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00012fa0: 2020 2020 7265 7475 726e 0d0a 2020 2020      return..    
+00012fb0: 2020 2020 6365 6e74 6572 5f78 203d 2028      center_x = (
+00012fc0: 626f 756e 6473 5b32 5d20 2b20 626f 756e  bounds[2] + boun
+00012fd0: 6473 5b30 5d29 202f 2032 2e30 0d0a 2020  ds[0]) / 2.0..  
+00012fe0: 2020 2020 2020 6365 6e74 6572 5f79 203d        center_y =
+00012ff0: 2028 626f 756e 6473 5b33 5d20 2b20 626f   (bounds[3] + bo
+00013000: 756e 6473 5b31 5d29 202f 2032 2e30 0d0a  unds[1]) / 2.0..
+00013010: 2020 2020 2020 2020 7365 6c66 2866 2273          self(f"s
+00013020: 6361 6c65 2031 202d 3120 7b63 656e 7465  cale 1 -1 {cente
+00013030: 725f 787d 207b 6365 6e74 6572 5f79 7d5c  r_x} {center_y}\
 00013040: 6e22 290d 0a0d 0a20 2020 2040 7472 6565  n")....    @tree
 00013050: 5f63 6f6e 6469 7469 6f6e 616c 286c 616d  _conditional(lam
-00013060: 6264 6120 6e6f 6465 3a20 6e6f 7420 6e6f  bda node: not no
-00013070: 6465 2e6c 6f63 6b29 0d0a 2020 2020 4074  de.lock)..    @t
-00013080: 7265 655f 7375 626d 656e 7528 5f28 225a  ree_submenu(_("Z
-00013090: 2d64 6570 7468 2064 6976 6964 6522 2929  -depth divide"))
-000130a0: 0d0a 2020 2020 4074 7265 655f 6974 6572  ..    @tree_iter
-000130b0: 6174 6528 2264 6976 6964 6522 2c20 322c  ate("divide", 2,
-000130c0: 2031 3029 0d0a 2020 2020 4074 7265 655f   10)..    @tree_
-000130d0: 6f70 6572 6174 696f 6e28 5f28 2244 6976  operation(_("Div
-000130e0: 6964 6520 696e 746f 207b 6469 7669 6465  ide into {divide
-000130f0: 7d20 696d 6167 6573 2229 2c20 6e6f 6465  } images"), node
-00013100: 5f74 7970 653d 2265 6c65 6d20 696d 6167  _type="elem imag
-00013110: 6522 2c20 6865 6c70 3d22 2229 0d0a 2020  e", help="")..  
-00013120: 2020 6465 6620 696d 6167 655f 7a64 6570    def image_zdep
-00013130: 7468 286e 6f64 652c 2064 6976 6964 653d  th(node, divide=
-00013140: 312c 202a 2a6b 7761 7267 7329 3a0d 0a20  1, **kwargs):.. 
-00013150: 2020 2020 2020 2069 6620 6e6f 6465 2e69         if node.i
-00013160: 6d61 6765 2e6d 6f64 6520 213d 2022 5247  mage.mode != "RG
-00013170: 4241 223a 0d0a 2020 2020 2020 2020 2020  BA":..          
-00013180: 2020 6e6f 6465 2e69 6d61 6765 203d 206e    node.image = n
-00013190: 6f64 652e 696d 6167 652e 636f 6e76 6572  ode.image.conver
-000131a0: 7428 2252 4742 4122 290d 0a20 2020 2020  t("RGBA")..     
-000131b0: 2020 2062 616e 6420 3d20 3235 3520 2f20     band = 255 / 
-000131c0: 6469 7669 6465 0d0a 2020 2020 2020 2020  divide..        
-000131d0: 666f 7220 6920 696e 2072 616e 6765 2830  for i in range(0
-000131e0: 2c20 6469 7669 6465 293a 0d0a 2020 2020  , divide):..    
-000131f0: 2020 2020 2020 2020 7468 7265 7368 6f6c          threshol
-00013200: 645f 6d69 6e20 3d20 6920 2a20 6261 6e64  d_min = i * band
-00013210: 0d0a 2020 2020 2020 2020 2020 2020 7468  ..            th
-00013220: 7265 7368 6f6c 645f 6d61 7820 3d20 7468  reshold_max = th
-00013230: 7265 7368 6f6c 645f 6d69 6e20 2b20 6261  reshold_min + ba
-00013240: 6e64 0d0a 2020 2020 2020 2020 2020 2020  nd..            
-00013250: 7365 6c66 2866 2269 6d61 6765 2074 6872  self(f"image thr
-00013260: 6573 686f 6c64 207b 7468 7265 7368 6f6c  eshold {threshol
-00013270: 645f 6d69 6e7d 207b 7468 7265 7368 6f6c  d_min} {threshol
-00013280: 645f 6d61 787d 5c6e 2229 0d0a 0d0a 2020  d_max}\n")....  
-00013290: 2020 4074 7265 655f 636f 6e64 6974 696f    @tree_conditio
-000132a0: 6e61 6c28 6c61 6d62 6461 206e 6f64 653a  nal(lambda node:
-000132b0: 206e 6f64 652e 6c6f 636b 290d 0a20 2020   node.lock)..   
-000132c0: 2040 7472 6565 5f73 7562 6d65 6e75 285f   @tree_submenu(_
-000132d0: 2822 496d 6167 6522 2929 0d0a 2020 2020  ("Image"))..    
-000132e0: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
-000132f0: 5f28 2255 6e6c 6f63 6b20 6d61 6e69 7075  _("Unlock manipu
-00013300: 6c61 7469 6f6e 7322 292c 206e 6f64 655f  lations"), node_
-00013310: 7479 7065 3d22 656c 656d 2069 6d61 6765  type="elem image
-00013320: 222c 2068 656c 703d 2222 290d 0a20 2020  ", help="")..   
-00013330: 2064 6566 2069 6d61 6765 5f75 6e6c 6f63   def image_unloc
-00013340: 6b5f 6d61 6e69 7075 6c61 7469 6f6e 7328  k_manipulations(
-00013350: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
-00013360: 0d0a 2020 2020 2020 2020 7365 6c66 2822  ..        self("
-00013370: 696d 6167 6520 756e 6c6f 636b 5c6e 2229  image unlock\n")
-00013380: 0d0a 0d0a 2020 2020 4074 7265 655f 636f  ....    @tree_co
-00013390: 6e64 6974 696f 6e61 6c28 6c61 6d62 6461  nditional(lambda
-000133a0: 206e 6f64 653a 206e 6f74 206e 6f64 652e   node: not node.
-000133b0: 6c6f 636b 290d 0a20 2020 2040 7472 6565  lock)..    @tree
-000133c0: 5f73 7562 6d65 6e75 285f 2822 496d 6167  _submenu(_("Imag
-000133d0: 6522 2929 0d0a 2020 2020 4074 7265 655f  e"))..    @tree_
-000133e0: 6f70 6572 6174 696f 6e28 5f28 224c 6f63  operation(_("Loc
-000133f0: 6b20 6d61 6e69 7075 6c61 7469 6f6e 7322  k manipulations"
-00013400: 292c 206e 6f64 655f 7479 7065 3d22 656c  ), node_type="el
-00013410: 656d 2069 6d61 6765 222c 2068 656c 703d  em image", help=
-00013420: 2222 290d 0a20 2020 2064 6566 2069 6d61  "")..    def ima
-00013430: 6765 5f6c 6f63 6b5f 6d61 6e69 7075 6c61  ge_lock_manipula
-00013440: 7469 6f6e 7328 6e6f 6465 2c20 2a2a 6b77  tions(node, **kw
-00013450: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
-00013460: 7365 6c66 2822 696d 6167 6520 6c6f 636b  self("image lock
-00013470: 5c6e 2229 0d0a 0d0a 2020 2020 4074 7265  \n")....    @tre
-00013480: 655f 636f 6e64 6974 696f 6e61 6c28 6c61  e_conditional(la
-00013490: 6d62 6461 206e 6f64 653a 206e 6f74 206e  mbda node: not n
-000134a0: 6f64 652e 6c6f 636b 290d 0a20 2020 2040  ode.lock)..    @
-000134b0: 7472 6565 5f73 7562 6d65 6e75 285f 2822  tree_submenu(_("
-000134c0: 496d 6167 6522 2929 0d0a 2020 2020 4074  Image"))..    @t
-000134d0: 7265 655f 6f70 6572 6174 696f 6e28 5f28  ree_operation(_(
-000134e0: 2244 6974 6865 7220 746f 2031 2062 6974  "Dither to 1 bit
-000134f0: 2229 2c20 6e6f 6465 5f74 7970 653d 2265  "), node_type="e
-00013500: 6c65 6d20 696d 6167 6522 2c20 6865 6c70  lem image", help
-00013510: 3d22 2229 0d0a 2020 2020 6465 6620 696d  ="")..    def im
-00013520: 6167 655f 6469 7468 6572 286e 6f64 652c  age_dither(node,
-00013530: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
-00013540: 2020 2020 2073 656c 6628 2269 6d61 6765       self("image
-00013550: 2064 6974 6865 725c 6e22 290d 0a0d 0a20   dither\n").... 
-00013560: 2020 2040 7472 6565 5f63 6f6e 6469 7469     @tree_conditi
-00013570: 6f6e 616c 286c 616d 6264 6120 6e6f 6465  onal(lambda node
-00013580: 3a20 6e6f 7420 6e6f 6465 2e6c 6f63 6b29  : not node.lock)
-00013590: 0d0a 2020 2020 4074 7265 655f 7375 626d  ..    @tree_subm
-000135a0: 656e 7528 5f28 2249 6d61 6765 2229 290d  enu(_("Image")).
-000135b0: 0a20 2020 2040 7472 6565 5f6f 7065 7261  .    @tree_opera
-000135c0: 7469 6f6e 285f 2822 496e 7665 7274 2069  tion(_("Invert i
-000135d0: 6d61 6765 2229 2c20 6e6f 6465 5f74 7970  mage"), node_typ
-000135e0: 653d 2265 6c65 6d20 696d 6167 6522 2c20  e="elem image", 
-000135f0: 6865 6c70 3d22 2229 0d0a 2020 2020 6465  help="")..    de
-00013600: 6620 696d 6167 655f 696e 7665 7274 286e  f image_invert(n
-00013610: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
-00013620: 0a20 2020 2020 2020 2073 656c 6628 2269  .        self("i
-00013630: 6d61 6765 2069 6e76 6572 745c 6e22 290d  mage invert\n").
-00013640: 0a0d 0a20 2020 2040 7472 6565 5f63 6f6e  ...    @tree_con
-00013650: 6469 7469 6f6e 616c 286c 616d 6264 6120  ditional(lambda 
-00013660: 6e6f 6465 3a20 6e6f 7420 6e6f 6465 2e6c  node: not node.l
-00013670: 6f63 6b29 0d0a 2020 2020 4074 7265 655f  ock)..    @tree_
-00013680: 7375 626d 656e 7528 5f28 2249 6d61 6765  submenu(_("Image
-00013690: 2229 290d 0a20 2020 2040 7472 6565 5f6f  "))..    @tree_o
-000136a0: 7065 7261 7469 6f6e 285f 2822 4d69 7272  peration(_("Mirr
-000136b0: 6f72 2068 6f72 697a 6f6e 7461 6c22 292c  or horizontal"),
-000136c0: 206e 6f64 655f 7479 7065 3d22 656c 656d   node_type="elem
-000136d0: 2069 6d61 6765 222c 2068 656c 703d 2222   image", help=""
-000136e0: 290d 0a20 2020 2064 6566 2069 6d61 6765  )..    def image
-000136f0: 5f6d 6972 726f 7228 6e6f 6465 2c20 2a2a  _mirror(node, **
-00013700: 6b77 6172 6773 293a 0d0a 2020 2020 2020  kwargs):..      
-00013710: 2020 7365 6c66 2822 696d 6167 6520 6d69    self("image mi
-00013720: 7272 6f72 5c6e 2229 0d0a 0d0a 2020 2020  rror\n")....    
-00013730: 4074 7265 655f 636f 6e64 6974 696f 6e61  @tree_conditiona
-00013740: 6c28 6c61 6d62 6461 206e 6f64 653a 206e  l(lambda node: n
-00013750: 6f74 206e 6f64 652e 6c6f 636b 290d 0a20  ot node.lock).. 
-00013760: 2020 2040 7472 6565 5f73 7562 6d65 6e75     @tree_submenu
-00013770: 285f 2822 496d 6167 6522 2929 0d0a 2020  (_("Image"))..  
-00013780: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
-00013790: 6e28 5f28 2246 6c69 7020 7665 7274 6963  n(_("Flip vertic
-000137a0: 616c 2229 2c20 6e6f 6465 5f74 7970 653d  al"), node_type=
-000137b0: 2265 6c65 6d20 696d 6167 6522 2c20 6865  "elem image", he
-000137c0: 6c70 3d22 2229 0d0a 2020 2020 6465 6620  lp="")..    def 
-000137d0: 696d 6167 655f 666c 6970 286e 6f64 652c  image_flip(node,
-000137e0: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
-000137f0: 2020 2020 2073 656c 6628 2269 6d61 6765       self("image
-00013800: 2066 6c69 705c 6e22 290d 0a0d 0a20 2020   flip\n")....   
-00013810: 2040 7472 6565 5f63 6f6e 6469 7469 6f6e   @tree_condition
-00013820: 616c 286c 616d 6264 6120 6e6f 6465 3a20  al(lambda node: 
-00013830: 6e6f 7420 6e6f 6465 2e6c 6f63 6b29 0d0a  not node.lock)..
-00013840: 2020 2020 4074 7265 655f 7375 626d 656e      @tree_submen
-00013850: 7528 5f28 2249 6d61 6765 2229 290d 0a20  u(_("Image")).. 
-00013860: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
-00013870: 6f6e 285f 2822 526f 7461 7465 2039 30c2  on(_("Rotate 90.
-00013880: b020 4357 2229 2c20 6e6f 6465 5f74 7970  . CW"), node_typ
-00013890: 653d 2265 6c65 6d20 696d 6167 6522 2c20  e="elem image", 
-000138a0: 6865 6c70 3d22 2229 0d0a 2020 2020 6465  help="")..    de
-000138b0: 6620 696d 6167 655f 6377 286e 6f64 652c  f image_cw(node,
-000138c0: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
-000138d0: 2020 2020 2073 656c 6628 2269 6d61 6765       self("image
-000138e0: 2063 775c 6e22 290d 0a0d 0a20 2020 2040   cw\n")....    @
-000138f0: 7472 6565 5f63 6f6e 6469 7469 6f6e 616c  tree_conditional
-00013900: 286c 616d 6264 6120 6e6f 6465 3a20 6e6f  (lambda node: no
-00013910: 7420 6e6f 6465 2e6c 6f63 6b29 0d0a 2020  t node.lock)..  
-00013920: 2020 4074 7265 655f 7375 626d 656e 7528    @tree_submenu(
-00013930: 5f28 2249 6d61 6765 2229 290d 0a20 2020  _("Image"))..   
-00013940: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
-00013950: 285f 2822 526f 7461 7465 2039 30c2 b020  (_("Rotate 90.. 
-00013960: 4343 5722 292c 206e 6f64 655f 7479 7065  CCW"), node_type
-00013970: 3d22 656c 656d 2069 6d61 6765 222c 2068  ="elem image", h
-00013980: 656c 703d 2222 290d 0a20 2020 2064 6566  elp="")..    def
-00013990: 2069 6d61 6765 5f63 6377 286e 6f64 652c   image_ccw(node,
-000139a0: 202a 2a6b 7761 7267 7329 3a0d 0a20 2020   **kwargs):..   
-000139b0: 2020 2020 2073 656c 6628 2269 6d61 6765       self("image
-000139c0: 2063 6377 5c6e 2229 0d0a 0d0a 2020 2020   ccw\n")....    
-000139d0: 4074 7265 655f 7375 626d 656e 7528 5f28  @tree_submenu(_(
-000139e0: 2249 6d61 6765 2229 290d 0a20 2020 2040  "Image"))..    @
-000139f0: 7472 6565 5f6f 7065 7261 7469 6f6e 280d  tree_operation(.
-00013a00: 0a20 2020 2020 2020 205f 2822 5361 7665  .        _("Save
-00013a10: 206f 7269 6769 6e61 6c20 696d 6167 6520   original image 
-00013a20: 746f 206f 7574 7075 742e 706e 6722 292c  to output.png"),
-00013a30: 206e 6f64 655f 7479 7065 3d22 656c 656d   node_type="elem
-00013a40: 2069 6d61 6765 222c 2068 656c 703d 2222   image", help=""
-00013a50: 0d0a 2020 2020 290d 0a20 2020 2064 6566  ..    )..    def
-00013a60: 2069 6d61 6765 5f73 6176 6528 6e6f 6465   image_save(node
-00013a70: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
-00013a80: 2020 2020 2020 7365 6c66 2822 696d 6167        self("imag
-00013a90: 6520 7361 7665 206f 7574 7075 742e 706e  e save output.pn
-00013aa0: 675c 6e22 290d 0a0d 0a20 2020 2040 7472  g\n")....    @tr
-00013ab0: 6565 5f73 7562 6d65 6e75 285f 2822 496d  ee_submenu(_("Im
-00013ac0: 6167 6522 2929 0d0a 2020 2020 4074 7265  age"))..    @tre
-00013ad0: 655f 6f70 6572 6174 696f 6e28 0d0a 2020  e_operation(..  
-00013ae0: 2020 2020 2020 5f28 2253 6176 6520 7072        _("Save pr
-00013af0: 6f63 6573 7365 6420 696d 6167 6520 746f  ocessed image to
-00013b00: 206f 7574 7075 742e 706e 6722 292c 206e   output.png"), n
-00013b10: 6f64 655f 7479 7065 3d22 656c 656d 2069  ode_type="elem i
-00013b20: 6d61 6765 222c 2068 656c 703d 2222 0d0a  mage", help=""..
-00013b30: 2020 2020 290d 0a20 2020 2064 6566 2069      )..    def i
-00013b40: 6d61 6765 5f73 6176 655f 7072 6f63 6573  mage_save_proces
-00013b50: 7365 6428 6e6f 6465 2c20 2a2a 6b77 6172  sed(node, **kwar
-00013b60: 6773 293a 0d0a 2020 2020 2020 2020 7365  gs):..        se
-00013b70: 6c66 2822 696d 6167 6520 7361 7665 206f  lf("image save o
-00013b80: 7574 7075 742e 706e 6720 2d2d 7072 6f63  utput.png --proc
-00013b90: 6573 7365 645c 6e22 290d 0a0d 0a20 2020  essed\n")....   
-00013ba0: 2040 7472 6565 5f63 6f6e 6469 7469 6f6e   @tree_condition
-00013bb0: 616c 286c 616d 6264 6120 6e6f 6465 3a20  al(lambda node: 
-00013bc0: 6c65 6e28 6e6f 6465 2e63 6869 6c64 7265  len(node.childre
-00013bd0: 6e29 203e 2030 290d 0a20 2020 2040 7472  n) > 0)..    @tr
-00013be0: 6565 5f73 6570 6172 6174 6f72 5f62 6566  ee_separator_bef
-00013bf0: 6f72 6528 290d 0a20 2020 2040 7472 6565  ore()..    @tree
-00013c00: 5f6f 7065 7261 7469 6f6e 280d 0a20 2020  _operation(..   
-00013c10: 2020 2020 205f 2822 4578 7061 6e64 2061       _("Expand a
-00013c20: 6c6c 2063 6869 6c64 7265 6e22 292c 0d0a  ll children"),..
-00013c30: 2020 2020 2020 2020 6e6f 6465 5f74 7970          node_typ
-00013c40: 653d 280d 0a20 2020 2020 2020 2020 2020  e=(..           
-00013c50: 2022 6f70 2063 7574 222c 0d0a 2020 2020   "op cut",..    
-00013c60: 2020 2020 2020 2020 226f 7020 7261 7374          "op rast
-00013c70: 6572 222c 0d0a 2020 2020 2020 2020 2020  er",..          
-00013c80: 2020 226f 7020 696d 6167 6522 2c0d 0a20    "op image",.. 
-00013c90: 2020 2020 2020 2020 2020 2022 6f70 2065             "op e
-00013ca0: 6e67 7261 7665 222c 0d0a 2020 2020 2020  ngrave",..      
-00013cb0: 2020 2020 2020 226f 7020 646f 7473 222c        "op dots",
-00013cc0: 0d0a 2020 2020 2020 2020 2020 2020 226f  ..            "o
-00013cd0: 7020 6861 7463 6822 2c0d 0a20 2020 2020  p hatch",..     
-00013ce0: 2020 2020 2020 2022 6272 616e 6368 2065         "branch e
-00013cf0: 6c65 6d73 222c 0d0a 2020 2020 2020 2020  lems",..        
-00013d00: 2020 2020 2262 7261 6e63 6820 6f70 7322      "branch ops"
-00013d10: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
-00013d20: 6272 616e 6368 2072 6567 222c 0d0a 2020  branch reg",..  
-00013d30: 2020 2020 2020 2020 2020 2267 726f 7570            "group
-00013d40: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
-00013d50: 2266 696c 6522 2c0d 0a20 2020 2020 2020  "file",..       
-00013d60: 2020 2020 2022 726f 6f74 222c 0d0a 2020       "root",..  
-00013d70: 2020 2020 2020 292c 0d0a 2020 2020 2020        ),..      
-00013d80: 2020 6865 6c70 3d5f 2822 4578 7061 6e64    help=_("Expand
-00013d90: 2061 6c6c 2063 6869 6c64 7265 6e20 6f66   all children of
-00013da0: 2074 6869 7320 6769 7665 6e20 6e6f 6465   this given node
-00013db0: 2e22 292c 0d0a 2020 2020 290d 0a20 2020  ."),..    )..   
-00013dc0: 2064 6566 2065 7870 616e 645f 616c 6c5f   def expand_all_
-00013dd0: 6368 696c 6472 656e 286e 6f64 652c 202a  children(node, *
-00013de0: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
-00013df0: 2020 206e 6f64 652e 6e6f 7469 6679 5f65     node.notify_e
-00013e00: 7870 616e 6428 290d 0a0d 0a20 2020 2040  xpand()....    @
-00013e10: 7472 6565 5f63 6f6e 6469 7469 6f6e 616c  tree_conditional
-00013e20: 286c 616d 6264 6120 6e6f 6465 3a20 6c65  (lambda node: le
-00013e30: 6e28 6e6f 6465 2e63 6869 6c64 7265 6e29  n(node.children)
-00013e40: 203e 2030 290d 0a20 2020 2040 7472 6565   > 0)..    @tree
-00013e50: 5f6f 7065 7261 7469 6f6e 280d 0a20 2020  _operation(..   
-00013e60: 2020 2020 205f 2822 436f 6c6c 6170 7365       _("Collapse
-00013e70: 2061 6c6c 2063 6869 6c64 7265 6e22 292c   all children"),
-00013e80: 0d0a 2020 2020 2020 2020 6e6f 6465 5f74  ..        node_t
-00013e90: 7970 653d 280d 0a20 2020 2020 2020 2020  ype=(..         
-00013ea0: 2020 2022 6f70 2063 7574 222c 0d0a 2020     "op cut",..  
-00013eb0: 2020 2020 2020 2020 2020 226f 7020 7261            "op ra
-00013ec0: 7374 6572 222c 0d0a 2020 2020 2020 2020  ster",..        
-00013ed0: 2020 2020 226f 7020 696d 6167 6522 2c0d      "op image",.
-00013ee0: 0a20 2020 2020 2020 2020 2020 2022 6f70  .            "op
-00013ef0: 2065 6e67 7261 7665 222c 0d0a 2020 2020   engrave",..    
-00013f00: 2020 2020 2020 2020 226f 7020 646f 7473          "op dots
-00013f10: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
-00013f20: 226f 7020 6861 7463 6822 2c0d 0a20 2020  "op hatch",..   
-00013f30: 2020 2020 2020 2020 2022 6272 616e 6368           "branch
-00013f40: 2065 6c65 6d73 222c 0d0a 2020 2020 2020   elems",..      
-00013f50: 2020 2020 2020 2262 7261 6e63 6820 6f70        "branch op
-00013f60: 7322 2c0d 0a20 2020 2020 2020 2020 2020  s",..           
-00013f70: 2022 6272 616e 6368 2072 6567 222c 0d0a   "branch reg",..
-00013f80: 2020 2020 2020 2020 2020 2020 2267 726f              "gro
-00013f90: 7570 222c 0d0a 2020 2020 2020 2020 2020  up",..          
-00013fa0: 2020 2266 696c 6522 2c0d 0a20 2020 2020    "file",..     
-00013fb0: 2020 2020 2020 2022 726f 6f74 222c 0d0a         "root",..
-00013fc0: 2020 2020 2020 2020 292c 0d0a 2020 2020          ),..    
-00013fd0: 2020 2020 6865 6c70 3d5f 2822 436f 6c6c      help=_("Coll
-00013fe0: 6170 7365 2061 6c6c 2063 6869 6c64 7265  apse all childre
-00013ff0: 6e20 6f66 2074 6869 7320 6769 7665 6e20  n of this given 
-00014000: 6e6f 6465 2e22 292c 0d0a 2020 2020 290d  node."),..    ).
-00014010: 0a20 2020 2064 6566 2063 6f6c 6c61 7073  .    def collaps
-00014020: 655f 616c 6c5f 6368 696c 6472 656e 286e  e_all_children(n
-00014030: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
-00014040: 0a20 2020 2020 2020 206e 6f64 652e 6e6f  .        node.no
-00014050: 7469 6679 5f63 6f6c 6c61 7073 6528 290d  tify_collapse().
-00014060: 0a                                       .
+00013060: 6264 6120 6e6f 6465 3a20 6e6f 7420 6973  bda node: not is
+00013070: 5f72 6567 6d61 726b 286e 6f64 6529 290d  _regmark(node)).
+00013080: 0a20 2020 2040 7472 6565 5f63 6f6e 6469  .    @tree_condi
+00013090: 7469 6f6e 616c 5f74 7279 286c 616d 6264  tional_try(lambd
+000130a0: 6120 6e6f 6465 3a20 6e6f 7420 6e6f 6465  a node: not node
+000130b0: 2e6c 6f63 6b29 0d0a 2020 2020 4074 7265  .lock)..    @tre
+000130c0: 655f 7375 626d 656e 7528 5f28 2253 6361  e_submenu(_("Sca
+000130d0: 6c65 2229 290d 0a20 2020 2040 7472 6565  le"))..    @tree
+000130e0: 5f69 7465 7261 7465 2822 7363 616c 6522  _iterate("scale"
+000130f0: 2c20 3235 2c20 312c 202d 3129 0d0a 2020  , 25, 1, -1)..  
+00013100: 2020 4074 7265 655f 6361 6c63 2822 7363    @tree_calc("sc
+00013110: 616c 655f 7065 7263 656e 7422 2c20 6c61  ale_percent", la
+00013120: 6d62 6461 2069 3a20 6622 7b28 3630 302e  mbda i: f"{(600.
+00013130: 3020 2f20 666c 6f61 7428 6929 293a 2e32  0 / float(i)):.2
+00013140: 667d 2229 0d0a 2020 2020 4074 7265 655f  f}")..    @tree_
+00013150: 6f70 6572 6174 696f 6e28 0d0a 2020 2020  operation(..    
+00013160: 2020 2020 5f28 2253 6361 6c65 207b 7363      _("Scale {sc
+00013170: 616c 655f 7065 7263 656e 747d 2522 292c  ale_percent}%"),
+00013180: 0d0a 2020 2020 2020 2020 6e6f 6465 5f74  ..        node_t
+00013190: 7970 653d 656c 656d 5f67 726f 7570 5f6e  ype=elem_group_n
+000131a0: 6f64 6573 2c0d 0a20 2020 2020 2020 2068  odes,..        h
+000131b0: 656c 703d 5f28 2253 6361 6c65 2045 6c65  elp=_("Scale Ele
+000131c0: 6d65 6e74 2229 2c0d 0a20 2020 2029 0d0a  ment"),..    )..
+000131d0: 2020 2020 6465 6620 7363 616c 655f 656c      def scale_el
+000131e0: 656d 5f61 6d6f 756e 7428 6e6f 6465 2c20  em_amount(node, 
+000131f0: 7363 616c 652c 202a 2a6b 7761 7267 7329  scale, **kwargs)
+00013200: 3a0d 0a20 2020 2020 2020 2073 6361 6c65  :..        scale
+00013210: 203d 2036 2e30 202f 2066 6c6f 6174 2873   = 6.0 / float(s
+00013220: 6361 6c65 290d 0a20 2020 2020 2020 2062  cale)..        b
+00013230: 6f75 6e64 7320 3d20 7365 6c66 2e5f 656d  ounds = self._em
+00013240: 7068 6173 697a 6564 5f62 6f75 6e64 730d  phasized_bounds.
+00013250: 0a20 2020 2020 2020 2069 6620 626f 756e  .        if boun
+00013260: 6473 2069 7320 4e6f 6e65 3a0d 0a20 2020  ds is None:..   
+00013270: 2020 2020 2020 2020 2072 6574 7572 6e0d           return.
+00013280: 0a20 2020 2020 2020 2063 656e 7465 725f  .        center_
+00013290: 7820 3d20 2862 6f75 6e64 735b 325d 202b  x = (bounds[2] +
+000132a0: 2062 6f75 6e64 735b 305d 2920 2f20 322e   bounds[0]) / 2.
+000132b0: 300d 0a20 2020 2020 2020 2063 656e 7465  0..        cente
+000132c0: 725f 7920 3d20 2862 6f75 6e64 735b 335d  r_y = (bounds[3]
+000132d0: 202b 2062 6f75 6e64 735b 315d 2920 2f20   + bounds[1]) / 
+000132e0: 322e 300d 0a20 2020 2020 2020 2073 656c  2.0..        sel
+000132f0: 6628 6622 7363 616c 6520 7b73 6361 6c65  f(f"scale {scale
+00013300: 7d20 7b73 6361 6c65 7d20 7b63 656e 7465  } {scale} {cente
+00013310: 725f 787d 207b 6365 6e74 6572 5f79 7d5c  r_x} {center_y}\
+00013320: 6e22 290d 0a0d 0a20 2020 2023 2040 7472  n")....    # @tr
+00013330: 6565 5f63 6f6e 6469 7469 6f6e 616c 286c  ee_conditional(l
+00013340: 616d 6264 6120 6e6f 6465 3a20 6973 696e  ambda node: isin
+00013350: 7374 616e 6365 286e 6f64 652e 6f62 6a65  stance(node.obje
+00013360: 6374 2c20 5356 4745 6c65 6d65 6e74 2929  ct, SVGElement))
+00013370: 0d0a 2020 2020 4074 7265 655f 636f 6e64  ..    @tree_cond
+00013380: 6974 696f 6e61 6c28 6c61 6d62 6461 206e  itional(lambda n
+00013390: 6f64 653a 206e 6f74 2069 735f 7265 676d  ode: not is_regm
+000133a0: 6172 6b28 6e6f 6465 2929 0d0a 2020 2020  ark(node))..    
+000133b0: 4074 7265 655f 636f 6e64 6974 696f 6e61  @tree_conditiona
+000133c0: 6c5f 7472 7928 6c61 6d62 6461 206e 6f64  l_try(lambda nod
+000133d0: 653a 206e 6f74 206e 6f64 652e 6c6f 636b  e: not node.lock
+000133e0: 290d 0a20 2020 2040 7472 6565 5f73 7562  )..    @tree_sub
+000133f0: 6d65 6e75 285f 2822 526f 7461 7465 2229  menu(_("Rotate")
+00013400: 290d 0a20 2020 2040 7472 6565 5f76 616c  )..    @tree_val
+00013410: 7565 7328 0d0a 2020 2020 2020 2020 2261  ues(..        "a
+00013420: 6e67 6c65 222c 0d0a 2020 2020 2020 2020  ngle",..        
+00013430: 280d 0a20 2020 2020 2020 2020 2020 2031  (..            1
+00013440: 3830 2c0d 0a20 2020 2020 2020 2020 2020  80,..           
+00013450: 2031 3335 2c0d 0a20 2020 2020 2020 2020   135,..         
+00013460: 2020 2039 302c 0d0a 2020 2020 2020 2020     90,..        
+00013470: 2020 2020 3630 2c0d 0a20 2020 2020 2020      60,..       
+00013480: 2020 2020 2034 352c 0d0a 2020 2020 2020       45,..      
+00013490: 2020 2020 2020 3330 2c0d 0a20 2020 2020        30,..     
+000134a0: 2020 2020 2020 2032 302c 0d0a 2020 2020         20,..    
+000134b0: 2020 2020 2020 2020 3135 2c0d 0a20 2020          15,..   
+000134c0: 2020 2020 2020 2020 2031 302c 0d0a 2020           10,..  
+000134d0: 2020 2020 2020 2020 2020 352c 0d0a 2020            5,..  
+000134e0: 2020 2020 2020 2020 2020 342c 0d0a 2020            4,..  
+000134f0: 2020 2020 2020 2020 2020 332c 0d0a 2020            3,..  
+00013500: 2020 2020 2020 2020 2020 322c 0d0a 2020            2,..  
+00013510: 2020 2020 2020 2020 2020 312c 0d0a 2020            1,..  
+00013520: 2020 2020 2020 2020 2020 2d31 2c0d 0a20            -1,.. 
+00013530: 2020 2020 2020 2020 2020 202d 322c 0d0a             -2,..
+00013540: 2020 2020 2020 2020 2020 2020 2d33 2c0d              -3,.
+00013550: 0a20 2020 2020 2020 2020 2020 202d 342c  .            -4,
+00013560: 0d0a 2020 2020 2020 2020 2020 2020 2d35  ..            -5
+00013570: 2c0d 0a20 2020 2020 2020 2020 2020 202d  ,..            -
+00013580: 3130 2c0d 0a20 2020 2020 2020 2020 2020  10,..           
+00013590: 202d 3135 2c0d 0a20 2020 2020 2020 2020   -15,..         
+000135a0: 2020 202d 3230 2c0d 0a20 2020 2020 2020     -20,..       
+000135b0: 2020 2020 202d 3330 2c0d 0a20 2020 2020       -30,..     
+000135c0: 2020 2020 2020 202d 3435 2c0d 0a20 2020         -45,..   
+000135d0: 2020 2020 2020 2020 202d 3630 2c0d 0a20           -60,.. 
+000135e0: 2020 2020 2020 2020 2020 202d 3930 2c0d             -90,.
+000135f0: 0a20 2020 2020 2020 2029 2c0d 0a20 2020  .        ),..   
+00013600: 2029 0d0a 2020 2020 4074 7265 655f 6f70   )..    @tree_op
+00013610: 6572 6174 696f 6e28 5f28 2252 6f74 6174  eration(_("Rotat
+00013620: 6520 7b61 6e67 6c65 7dc2 b022 292c 206e  e {angle}.."), n
+00013630: 6f64 655f 7479 7065 3d65 6c65 6d5f 6772  ode_type=elem_gr
+00013640: 6f75 705f 6e6f 6465 732c 2068 656c 703d  oup_nodes, help=
+00013650: 2222 290d 0a20 2020 2064 6566 2072 6f74  "")..    def rot
+00013660: 6174 655f 656c 656d 5f61 6d6f 756e 7428  ate_elem_amount(
+00013670: 6e6f 6465 2c20 616e 676c 652c 202a 2a6b  node, angle, **k
+00013680: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
+00013690: 2074 7572 6e73 203d 2066 6c6f 6174 2861   turns = float(a
+000136a0: 6e67 6c65 2920 2f20 3336 302e 300d 0a20  ngle) / 360.0.. 
+000136b0: 2020 2020 2020 2062 6f75 6e64 7320 3d20         bounds = 
+000136c0: 7365 6c66 2e5f 656d 7068 6173 697a 6564  self._emphasized
+000136d0: 5f62 6f75 6e64 730d 0a20 2020 2020 2020  _bounds..       
+000136e0: 2069 6620 626f 756e 6473 2069 7320 4e6f   if bounds is No
+000136f0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+00013700: 2072 6574 7572 6e0d 0a20 2020 2020 2020   return..       
+00013710: 2063 656e 7465 725f 7820 3d20 2862 6f75   center_x = (bou
+00013720: 6e64 735b 325d 202b 2062 6f75 6e64 735b  nds[2] + bounds[
+00013730: 305d 2920 2f20 322e 300d 0a20 2020 2020  0]) / 2.0..     
+00013740: 2020 2063 656e 7465 725f 7920 3d20 2862     center_y = (b
+00013750: 6f75 6e64 735b 335d 202b 2062 6f75 6e64  ounds[3] + bound
+00013760: 735b 315d 2920 2f20 322e 300d 0a20 2020  s[1]) / 2.0..   
+00013770: 2020 2020 2073 656c 6628 6622 726f 7461       self(f"rota
+00013780: 7465 207b 7475 726e 737d 7475 726e 207b  te {turns}turn {
+00013790: 6365 6e74 6572 5f78 7d20 7b63 656e 7465  center_x} {cente
+000137a0: 725f 797d 5c6e 2229 0d0a 2020 2020 2020  r_y}\n")..      
+000137b0: 2020 7365 6c66 2e73 6967 6e61 6c28 2265    self.signal("e
+000137c0: 7874 2d6d 6f64 6966 6965 6422 290d 0a0d  xt-modified")...
+000137d0: 0a20 2020 2040 7472 6565 5f63 6f6e 6469  .    @tree_condi
+000137e0: 7469 6f6e 616c 286c 616d 6264 6120 6e6f  tional(lambda no
+000137f0: 6465 3a20 6e6f 7420 6973 5f72 6567 6d61  de: not is_regma
+00013800: 726b 286e 6f64 6529 290d 0a20 2020 2040  rk(node))..    @
+00013810: 7472 6565 5f63 6f6e 6469 7469 6f6e 616c  tree_conditional
+00013820: 286c 616d 6264 6120 6e6f 6465 3a20 6861  (lambda node: ha
+00013830: 735f 6368 616e 6765 7328 6e6f 6465 2929  s_changes(node))
+00013840: 0d0a 2020 2020 4074 7265 655f 636f 6e64  ..    @tree_cond
+00013850: 6974 696f 6e61 6c5f 7472 7928 6c61 6d62  itional_try(lamb
+00013860: 6461 206e 6f64 653a 206e 6f74 206e 6f64  da node: not nod
+00013870: 652e 6c6f 636b 290d 0a20 2020 2040 7472  e.lock)..    @tr
+00013880: 6565 5f6f 7065 7261 7469 6f6e 285f 2822  ee_operation(_("
+00013890: 5265 6966 7920 5573 6572 2043 6861 6e67  Reify User Chang
+000138a0: 6573 2229 2c20 6e6f 6465 5f74 7970 653d  es"), node_type=
+000138b0: 656c 656d 5f67 726f 7570 5f6e 6f64 6573  elem_group_nodes
+000138c0: 2c20 6865 6c70 3d22 2229 0d0a 2020 2020  , help="")..    
+000138d0: 6465 6620 7265 6966 795f 656c 656d 5f63  def reify_elem_c
+000138e0: 6861 6e67 6573 286e 6f64 652c 202a 2a6b  hanges(node, **k
+000138f0: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
+00013900: 2073 656c 6628 2272 6569 6679 5c6e 2229   self("reify\n")
+00013910: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+00013920: 6967 6e61 6c28 2265 7874 2d6d 6f64 6966  ignal("ext-modif
+00013930: 6965 6422 290d 0a0d 0a20 2020 2040 7472  ied")....    @tr
+00013940: 6565 5f63 6f6e 6469 7469 6f6e 616c 286c  ee_conditional(l
+00013950: 616d 6264 6120 6e6f 6465 3a20 6e6f 7420  ambda node: not 
+00013960: 6973 5f72 6567 6d61 726b 286e 6f64 6529  is_regmark(node)
+00013970: 290d 0a20 2020 2040 7472 6565 5f63 6f6e  )..    @tree_con
+00013980: 6469 7469 6f6e 616c 5f74 7279 286c 616d  ditional_try(lam
+00013990: 6264 6120 6e6f 6465 3a20 6e6f 7420 6e6f  bda node: not no
+000139a0: 6465 2e6c 6f63 6b29 0d0a 2020 2020 4074  de.lock)..    @t
+000139b0: 7265 655f 6f70 6572 6174 696f 6e28 5f28  ree_operation(_(
+000139c0: 2242 7265 616b 2053 7562 7061 7468 7322  "Break Subpaths"
+000139d0: 292c 206e 6f64 655f 7479 7065 3d22 656c  ), node_type="el
+000139e0: 656d 2070 6174 6822 2c20 6865 6c70 3d22  em path", help="
+000139f0: 2229 0d0a 2020 2020 6465 6620 6272 6561  ")..    def brea
+00013a00: 6b5f 7375 6270 6174 685f 656c 656d 286e  k_subpath_elem(n
+00013a10: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
+00013a20: 0a20 2020 2020 2020 2073 656c 6628 2265  .        self("e
+00013a30: 6c65 6d65 6e74 2073 7562 7061 7468 5c6e  lement subpath\n
+00013a40: 2229 0d0a 0d0a 2020 2020 4074 7265 655f  ")....    @tree_
+00013a50: 636f 6e64 6974 696f 6e61 6c28 6c61 6d62  conditional(lamb
+00013a60: 6461 206e 6f64 653a 206e 6f74 2069 735f  da node: not is_
+00013a70: 7265 676d 6172 6b28 6e6f 6465 2929 0d0a  regmark(node))..
+00013a80: 2020 2020 4074 7265 655f 636f 6e64 6974      @tree_condit
+00013a90: 696f 6e61 6c28 6c61 6d62 6461 206e 6f64  ional(lambda nod
+00013aa0: 653a 2068 6173 5f63 6861 6e67 6573 286e  e: has_changes(n
+00013ab0: 6f64 6529 290d 0a20 2020 2040 7472 6565  ode))..    @tree
+00013ac0: 5f63 6f6e 6469 7469 6f6e 616c 5f74 7279  _conditional_try
+00013ad0: 286c 616d 6264 6120 6e6f 6465 3a20 6e6f  (lambda node: no
+00013ae0: 7420 6e6f 6465 2e6c 6f63 6b29 0d0a 2020  t node.lock)..  
+00013af0: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
+00013b00: 6e28 5f28 2252 6573 6574 2075 7365 7220  n(_("Reset user 
+00013b10: 6368 616e 6765 7322 292c 206e 6f64 655f  changes"), node_
+00013b20: 7479 7065 3d65 6c65 6d5f 6772 6f75 705f  type=elem_group_
+00013b30: 6e6f 6465 732c 2068 656c 703d 2222 290d  nodes, help="").
+00013b40: 0a20 2020 2064 6566 2072 6573 6574 5f75  .    def reset_u
+00013b50: 7365 725f 6368 616e 6765 7328 6e6f 6465  ser_changes(node
+00013b60: 2c20 636f 7069 6573 3d31 2c20 2a2a 6b77  , copies=1, **kw
+00013b70: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
+00013b80: 7365 6c66 2822 7265 7365 745c 6e22 290d  self("reset\n").
+00013b90: 0a20 2020 2020 2020 2073 656c 662e 7369  .        self.si
+00013ba0: 676e 616c 2822 6578 742d 6d6f 6469 6669  gnal("ext-modifi
+00013bb0: 6564 2229 0d0a 0d0a 2020 2020 4074 7265  ed")....    @tre
+00013bc0: 655f 6f70 6572 6174 696f 6e28 0d0a 2020  e_operation(..  
+00013bd0: 2020 2020 2020 5f28 224d 6572 6765 2069        _("Merge i
+00013be0: 7465 6d73 2229 2c0d 0a20 2020 2020 2020  tems"),..       
+00013bf0: 206e 6f64 655f 7479 7065 3d22 6772 6f75   node_type="grou
+00013c00: 7022 2c0d 0a20 2020 2020 2020 2068 656c  p",..        hel
+00013c10: 703d 5f28 224d 6572 6765 2074 6869 7320  p=_("Merge this 
+00013c20: 6e6f 6465 2773 2063 6869 6c64 7265 6e20  node's children 
+00013c30: 696e 746f 2031 2070 6174 682e 2229 2c0d  into 1 path."),.
+00013c40: 0a20 2020 2029 0d0a 2020 2020 6465 6620  .    )..    def 
+00013c50: 6d65 7267 655f 656c 656d 656e 7473 286e  merge_elements(n
+00013c60: 6f64 652c 202a 2a6b 7761 7267 7329 3a0d  ode, **kwargs):.
+00013c70: 0a20 2020 2020 2020 2073 656c 6628 2265  .        self("e
+00013c80: 6c65 6d65 6e74 206d 6572 6765 5c6e 2229  lement merge\n")
+00013c90: 0d0a 2020 2020 2020 2020 2320 4973 2074  ..        # Is t
+00013ca0: 6865 2067 726f 7570 206e 6f77 2065 6d70  he group now emp
+00013cb0: 7479 3f20 2d2d 3e20 6465 6c65 7465 0d0a  ty? --> delete..
+00013cc0: 2020 2020 2020 2020 6966 206c 656e 286e          if len(n
+00013cd0: 6f64 652e 6368 696c 6472 656e 2920 3d3d  ode.children) ==
+00013ce0: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
+00013cf0: 206e 6f64 652e 7265 6d6f 7665 5f6e 6f64   node.remove_nod
+00013d00: 6528 290d 0a0d 0a20 2020 2040 7472 6565  e()....    @tree
+00013d10: 5f63 6f6e 6469 7469 6f6e 616c 286c 616d  _conditional(lam
+00013d20: 6264 6120 6e6f 6465 3a20 6e6f 6465 2e6c  bda node: node.l
+00013d30: 6f63 6b29 0d0a 2020 2020 4074 7265 655f  ock)..    @tree_
+00013d40: 7365 7061 7261 746f 725f 6265 666f 7265  separator_before
+00013d50: 2829 0d0a 2020 2020 4074 7265 655f 6f70  ()..    @tree_op
+00013d60: 6572 6174 696f 6e28 0d0a 2020 2020 2020  eration(..      
+00013d70: 2020 5f28 2255 6e6c 6f63 6b20 656c 656d    _("Unlock elem
+00013d80: 656e 742c 2061 6c6c 6f77 7320 6d61 6e69  ent, allows mani
+00013d90: 7075 6c61 7469 6f6e 2229 2c20 6e6f 6465  pulation"), node
+00013da0: 5f74 7970 653d 656c 656d 5f6e 6f64 6573  _type=elem_nodes
+00013db0: 2c20 6865 6c70 3d22 220d 0a20 2020 2029  , help=""..    )
+00013dc0: 0d0a 2020 2020 6465 6620 656c 656d 656e  ..    def elemen
+00013dd0: 745f 756e 6c6f 636b 5f6d 616e 6970 756c  t_unlock_manipul
+00013de0: 6174 696f 6e73 286e 6f64 652c 202a 2a6b  ations(node, **k
+00013df0: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
+00013e00: 2073 656c 6628 2265 6c65 6d65 6e74 2075   self("element u
+00013e10: 6e6c 6f63 6b5c 6e22 290d 0a0d 0a20 2020  nlock\n")....   
+00013e20: 2040 7472 6565 5f63 6f6e 6469 7469 6f6e   @tree_condition
+00013e30: 616c 286c 616d 6264 6120 6e6f 6465 3a20  al(lambda node: 
+00013e40: 6e6f 7420 6e6f 6465 2e6c 6f63 6b29 0d0a  not node.lock)..
+00013e50: 2020 2020 4074 7265 655f 7365 7061 7261      @tree_separa
+00013e60: 746f 725f 6265 666f 7265 2829 0d0a 2020  tor_before()..  
+00013e70: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
+00013e80: 6e28 0d0a 2020 2020 2020 2020 5f28 224c  n(..        _("L
+00013e90: 6f63 6b20 656c 656d 656e 7473 2c20 7072  ock elements, pr
+00013ea0: 6576 656e 7473 206d 616e 6970 756c 6174  events manipulat
+00013eb0: 696f 6e73 2229 2c20 6e6f 6465 5f74 7970  ions"), node_typ
+00013ec0: 653d 656c 656d 5f6e 6f64 6573 2c20 6865  e=elem_nodes, he
+00013ed0: 6c70 3d22 220d 0a20 2020 2029 0d0a 2020  lp=""..    )..  
+00013ee0: 2020 6465 6620 656c 656d 656e 745f 6c6f    def element_lo
+00013ef0: 636b 5f6d 616e 6970 756c 6174 696f 6e73  ck_manipulations
+00013f00: 286e 6f64 652c 202a 2a6b 7761 7267 7329  (node, **kwargs)
+00013f10: 3a0d 0a20 2020 2020 2020 2073 656c 6628  :..        self(
+00013f20: 2265 6c65 6d65 6e74 206c 6f63 6b5c 6e22  "element lock\n"
+00013f30: 290d 0a0d 0a20 2020 2040 7472 6565 5f63  )....    @tree_c
+00013f40: 6f6e 6469 7469 6f6e 616c 286c 616d 6264  onditional(lambd
+00013f50: 6120 6e6f 6465 3a20 6e6f 6465 2e74 7970  a node: node.typ
+00013f60: 6520 3d3d 2022 6272 616e 6368 2072 6567  e == "branch reg
+00013f70: 2229 0d0a 2020 2020 4074 7265 655f 7365  ")..    @tree_se
+00013f80: 7061 7261 746f 725f 6265 666f 7265 2829  parator_before()
+00013f90: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
+00013fa0: 6174 696f 6e28 5f28 2254 6f67 676c 6520  ation(_("Toggle 
+00013fb0: 7669 7369 6269 6c69 7479 206f 6620 7265  visibility of re
+00013fc0: 676d 6172 6b73 2229 2c20 6e6f 6465 5f74  gmarks"), node_t
+00013fd0: 7970 653d 2262 7261 6e63 6820 7265 6722  ype="branch reg"
+00013fe0: 2c20 6865 6c70 3d22 2229 0d0a 2020 2020  , help="")..    
+00013ff0: 6465 6620 746f 6767 6c65 5f76 6973 6962  def toggle_visib
+00014000: 696c 6974 7928 6e6f 6465 2c20 2a2a 6b77  ility(node, **kw
+00014010: 6172 6773 293a 0d0a 2020 2020 2020 2020  args):..        
+00014020: 7365 6c66 2e73 6967 6e61 6c28 2274 6f67  self.signal("tog
+00014030: 676c 655f 7265 676d 6172 6b73 2229 0d0a  gle_regmarks")..
+00014040: 0d0a 2020 2020 4074 7265 655f 636f 6e64  ..    @tree_cond
+00014050: 6974 696f 6e61 6c28 6c61 6d62 6461 206e  itional(lambda n
+00014060: 6f64 653a 2069 735f 7265 676d 6172 6b28  ode: is_regmark(
+00014070: 6e6f 6465 2929 0d0a 2020 2020 4074 7265  node))..    @tre
+00014080: 655f 7365 7061 7261 746f 725f 6265 666f  e_separator_befo
+00014090: 7265 2829 0d0a 2020 2020 4074 7265 655f  re()..    @tree_
+000140a0: 6f70 6572 6174 696f 6e28 5f28 224d 6f76  operation(_("Mov
+000140b0: 6520 6261 636b 2074 6f20 656c 656d 656e  e back to elemen
+000140c0: 7473 2229 2c20 6e6f 6465 5f74 7970 653d  ts"), node_type=
+000140d0: 656c 656d 5f67 726f 7570 5f6e 6f64 6573  elem_group_nodes
+000140e0: 2c20 6865 6c70 3d22 2229 0d0a 2020 2020  , help="")..    
+000140f0: 6465 6620 6d6f 7665 5f62 6163 6b28 6e6f  def move_back(no
+00014100: 6465 2c20 2a2a 6b77 6172 6773 293a 0d0a  de, **kwargs):..
+00014110: 2020 2020 2020 2020 2320 4472 6167 2061          # Drag a
+00014120: 6e64 2044 726f 700d 0a20 2020 2020 2020  nd Drop..       
+00014130: 2077 6974 6820 7365 6c66 2e73 7461 7469   with self.stati
+00014140: 6328 226d 6f76 655f 6261 636b 2229 3a0d  c("move_back"):.
+00014150: 0a20 2020 2020 2020 2020 2020 2073 6967  .            sig
+00014160: 6e61 6c5f 6e65 6564 6564 203d 2046 616c  nal_needed = Fal
+00014170: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
+00014180: 6472 6f70 5f6e 6f64 6520 3d20 7365 6c66  drop_node = self
+00014190: 2e65 6c65 6d5f 6272 616e 6368 0d0a 2020  .elem_branch..  
+000141a0: 2020 2020 2020 2020 2020 6461 7461 203d            data =
+000141b0: 206c 6973 7428 290d 0a20 2020 2020 2020   list()..       
+000141c0: 2020 2020 2066 6f72 2069 7465 6d20 696e       for item in
+000141d0: 206c 6973 7428 7365 6c66 2e72 6567 6d61   list(self.regma
+000141e0: 726b 7328 2929 3a0d 0a20 2020 2020 2020  rks()):..       
+000141f0: 2020 2020 2020 2020 2069 6620 6974 656d           if item
+00014200: 2e73 656c 6563 7465 643a 0d0a 2020 2020  .selected:..    
+00014210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014220: 6461 7461 2e61 7070 656e 6428 6974 656d  data.append(item
+00014230: 290d 0a20 2020 2020 2020 2020 2020 2066  )..            f
+00014240: 6f72 2069 7465 6d20 696e 2064 6174 613a  or item in data:
+00014250: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00014260: 2020 6472 6f70 5f6e 6f64 652e 6472 6f70    drop_node.drop
+00014270: 2869 7465 6d29 0d0a 2020 2020 2020 2020  (item)..        
+00014280: 2020 2020 2020 2020 7369 676e 616c 5f6e          signal_n
+00014290: 6565 6465 6420 3d20 5472 7565 0d0a 0d0a  eeded = True....
+000142a0: 2020 2020 4074 7265 655f 636f 6e64 6974      @tree_condit
+000142b0: 696f 6e61 6c28 6c61 6d62 6461 206e 6f64  ional(lambda nod
+000142c0: 653a 206e 6f74 2069 735f 7265 676d 6172  e: not is_regmar
+000142d0: 6b28 6e6f 6465 2929 0d0a 2020 2020 4074  k(node))..    @t
+000142e0: 7265 655f 7365 7061 7261 746f 725f 6265  ree_separator_be
+000142f0: 666f 7265 2829 0d0a 2020 2020 4074 7265  fore()..    @tre
+00014300: 655f 6f70 6572 6174 696f 6e28 5f28 224d  e_operation(_("M
+00014310: 6f76 6520 746f 2072 6567 6d61 726b 7322  ove to regmarks"
+00014320: 292c 206e 6f64 655f 7479 7065 3d65 6c65  ), node_type=ele
+00014330: 6d5f 6772 6f75 705f 6e6f 6465 732c 2068  m_group_nodes, h
+00014340: 656c 703d 2222 290d 0a20 2020 2064 6566  elp="")..    def
+00014350: 206d 6f76 655f 746f 5f72 6567 6d61 726b   move_to_regmark
+00014360: 286e 6f64 652c 202a 2a6b 7761 7267 7329  (node, **kwargs)
+00014370: 3a0d 0a20 2020 2020 2020 2023 2044 7261  :..        # Dra
+00014380: 6720 616e 6420 4472 6f70 0d0a 2020 2020  g and Drop..    
+00014390: 2020 2020 7769 7468 2073 656c 662e 7374      with self.st
+000143a0: 6174 6963 2822 6d6f 7665 5f74 6f5f 7265  atic("move_to_re
+000143b0: 6722 293a 0d0a 2020 2020 2020 2020 2020  g"):..          
+000143c0: 2020 6472 6f70 5f6e 6f64 6520 3d20 7365    drop_node = se
+000143d0: 6c66 2e72 6567 5f62 7261 6e63 680d 0a20  lf.reg_branch.. 
+000143e0: 2020 2020 2020 2020 2020 2064 6174 6120             data 
+000143f0: 3d20 6c69 7374 2829 0d0a 2020 2020 2020  = list()..      
+00014400: 2020 2020 2020 666f 7220 6974 656d 2069        for item i
+00014410: 6e20 6c69 7374 2873 656c 662e 656c 656d  n list(self.elem
+00014420: 735f 6e6f 6465 7328 2929 3a0d 0a20 2020  s_nodes()):..   
+00014430: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00014440: 6974 656d 2e73 656c 6563 7465 643a 0d0a  item.selected:..
+00014450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014460: 2020 2020 6461 7461 2e61 7070 656e 6428      data.append(
+00014470: 6974 656d 290d 0a20 2020 2020 2020 2020  item)..         
+00014480: 2020 2066 6f72 2069 7465 6d20 696e 2064     for item in d
+00014490: 6174 613a 0d0a 2020 2020 2020 2020 2020  ata:..          
+000144a0: 2020 2020 2020 2320 4e6f 2075 7365 6361        # No useca
+000144b0: 7365 2066 6f72 2068 6176 696e 6720 6120  se for having a 
+000144c0: 6c6f 636b 6564 2072 6567 6d61 726b 2065  locked regmark e
+000144d0: 6c65 6d65 6e74 0d0a 2020 2020 2020 2020  lement..        
+000144e0: 2020 2020 2020 2020 6966 2068 6173 6174          if hasat
+000144f0: 7472 2869 7465 6d2c 2022 6c6f 636b 2229  tr(item, "lock")
+00014500: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00014510: 2020 2020 2020 2069 7465 6d2e 6c6f 636b         item.lock
+00014520: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
+00014530: 2020 2020 2020 2020 2020 6472 6f70 5f6e            drop_n
+00014540: 6f64 652e 6472 6f70 2869 7465 6d29 0d0a  ode.drop(item)..
+00014550: 0d0a 2020 2020 2320 4074 7265 655f 636f  ..    # @tree_co
+00014560: 6e64 6974 696f 6e61 6c28 6c61 6d62 6461  nditional(lambda
+00014570: 206e 6f64 653a 206e 6f74 206e 6f64 652e   node: not node.
+00014580: 6c6f 636b 290d 0a20 2020 2023 2040 7472  lock)..    # @tr
+00014590: 6565 5f63 6f6e 6469 7469 6f6e 616c 5f74  ee_conditional_t
+000145a0: 7279 286c 616d 6264 6120 6e6f 6465 3a20  ry(lambda node: 
+000145b0: 6e6f 7420 6e6f 6465 2e6c 6f63 6b29 0d0a  not node.lock)..
+000145c0: 2020 2020 2320 4074 7265 655f 6f70 6572      # @tree_oper
+000145d0: 6174 696f 6e28 5f28 2241 6374 7561 6c69  ation(_("Actuali
+000145e0: 7a65 2070 6978 656c 7322 292c 206e 6f64  ze pixels"), nod
+000145f0: 655f 7479 7065 3d22 656c 656d 2069 6d61  e_type="elem ima
+00014600: 6765 222c 2068 656c 703d 2222 290d 0a20  ge", help="").. 
+00014610: 2020 2023 2064 6566 2069 6d61 6765 5f61     # def image_a
+00014620: 6374 7561 6c69 7a65 5f70 6978 656c 7328  ctualize_pixels(
+00014630: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
+00014640: 0d0a 2020 2020 2320 2020 2020 7365 6c66  ..    #     self
+00014650: 2822 696d 6167 6520 7265 7361 6d70 6c65  ("image resample
+00014660: 5c6e 2229 0d0a 0d0a 2020 2020 4074 7265  \n")....    @tre
+00014670: 655f 636f 6e64 6974 696f 6e61 6c28 6c61  e_conditional(la
+00014680: 6d62 6461 206e 6f64 653a 206e 6f74 206e  mbda node: not n
+00014690: 6f64 652e 6c6f 636b 290d 0a20 2020 2040  ode.lock)..    @
+000146a0: 7472 6565 5f73 7562 6d65 6e75 285f 2822  tree_submenu(_("
+000146b0: 5a2d 6465 7074 6820 6469 7669 6465 2229  Z-depth divide")
+000146c0: 290d 0a20 2020 2040 7472 6565 5f69 7465  )..    @tree_ite
+000146d0: 7261 7465 2822 6469 7669 6465 222c 2032  rate("divide", 2
+000146e0: 2c20 3130 290d 0a20 2020 2040 7472 6565  , 10)..    @tree
+000146f0: 5f6f 7065 7261 7469 6f6e 285f 2822 4469  _operation(_("Di
+00014700: 7669 6465 2069 6e74 6f20 7b64 6976 6964  vide into {divid
+00014710: 657d 2069 6d61 6765 7322 292c 206e 6f64  e} images"), nod
+00014720: 655f 7479 7065 3d22 656c 656d 2069 6d61  e_type="elem ima
+00014730: 6765 222c 2068 656c 703d 2222 290d 0a20  ge", help="").. 
+00014740: 2020 2064 6566 2069 6d61 6765 5f7a 6465     def image_zde
+00014750: 7074 6828 6e6f 6465 2c20 6469 7669 6465  pth(node, divide
+00014760: 3d31 2c20 2a2a 6b77 6172 6773 293a 0d0a  =1, **kwargs):..
+00014770: 2020 2020 2020 2020 6966 206e 6f64 652e          if node.
+00014780: 696d 6167 652e 6d6f 6465 2021 3d20 2252  image.mode != "R
+00014790: 4742 4122 3a0d 0a20 2020 2020 2020 2020  GBA":..         
+000147a0: 2020 206e 6f64 652e 696d 6167 6520 3d20     node.image = 
+000147b0: 6e6f 6465 2e69 6d61 6765 2e63 6f6e 7665  node.image.conve
+000147c0: 7274 2822 5247 4241 2229 0d0a 2020 2020  rt("RGBA")..    
+000147d0: 2020 2020 6261 6e64 203d 2032 3535 202f      band = 255 /
+000147e0: 2064 6976 6964 650d 0a20 2020 2020 2020   divide..       
+000147f0: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+00014800: 302c 2064 6976 6964 6529 3a0d 0a20 2020  0, divide):..   
+00014810: 2020 2020 2020 2020 2074 6872 6573 686f           thresho
+00014820: 6c64 5f6d 696e 203d 2069 202a 2062 616e  ld_min = i * ban
+00014830: 640d 0a20 2020 2020 2020 2020 2020 2074  d..            t
+00014840: 6872 6573 686f 6c64 5f6d 6178 203d 2074  hreshold_max = t
+00014850: 6872 6573 686f 6c64 5f6d 696e 202b 2062  hreshold_min + b
+00014860: 616e 640d 0a20 2020 2020 2020 2020 2020  and..           
+00014870: 2073 656c 6628 6622 696d 6167 6520 7468   self(f"image th
+00014880: 7265 7368 6f6c 6420 7b74 6872 6573 686f  reshold {thresho
+00014890: 6c64 5f6d 696e 7d20 7b74 6872 6573 686f  ld_min} {thresho
+000148a0: 6c64 5f6d 6178 7d5c 6e22 290d 0a0d 0a20  ld_max}\n").... 
+000148b0: 2020 2040 7472 6565 5f63 6f6e 6469 7469     @tree_conditi
+000148c0: 6f6e 616c 286c 616d 6264 6120 6e6f 6465  onal(lambda node
+000148d0: 3a20 6e6f 6465 2e6c 6f63 6b29 0d0a 2020  : node.lock)..  
+000148e0: 2020 4074 7265 655f 7375 626d 656e 7528    @tree_submenu(
+000148f0: 5f28 2249 6d61 6765 2229 290d 0a20 2020  _("Image"))..   
+00014900: 2040 7472 6565 5f6f 7065 7261 7469 6f6e   @tree_operation
+00014910: 285f 2822 556e 6c6f 636b 206d 616e 6970  (_("Unlock manip
+00014920: 756c 6174 696f 6e73 2229 2c20 6e6f 6465  ulations"), node
+00014930: 5f74 7970 653d 2265 6c65 6d20 696d 6167  _type="elem imag
+00014940: 6522 2c20 6865 6c70 3d22 2229 0d0a 2020  e", help="")..  
+00014950: 2020 6465 6620 696d 6167 655f 756e 6c6f    def image_unlo
+00014960: 636b 5f6d 616e 6970 756c 6174 696f 6e73  ck_manipulations
+00014970: 286e 6f64 652c 202a 2a6b 7761 7267 7329  (node, **kwargs)
+00014980: 3a0d 0a20 2020 2020 2020 2073 656c 6628  :..        self(
+00014990: 2269 6d61 6765 2075 6e6c 6f63 6b5c 6e22  "image unlock\n"
+000149a0: 290d 0a0d 0a20 2020 2040 7472 6565 5f63  )....    @tree_c
+000149b0: 6f6e 6469 7469 6f6e 616c 286c 616d 6264  onditional(lambd
+000149c0: 6120 6e6f 6465 3a20 6e6f 7420 6e6f 6465  a node: not node
+000149d0: 2e6c 6f63 6b29 0d0a 2020 2020 4074 7265  .lock)..    @tre
+000149e0: 655f 7375 626d 656e 7528 5f28 2249 6d61  e_submenu(_("Ima
+000149f0: 6765 2229 290d 0a20 2020 2040 7472 6565  ge"))..    @tree
+00014a00: 5f6f 7065 7261 7469 6f6e 285f 2822 4c6f  _operation(_("Lo
+00014a10: 636b 206d 616e 6970 756c 6174 696f 6e73  ck manipulations
+00014a20: 2229 2c20 6e6f 6465 5f74 7970 653d 2265  "), node_type="e
+00014a30: 6c65 6d20 696d 6167 6522 2c20 6865 6c70  lem image", help
+00014a40: 3d22 2229 0d0a 2020 2020 6465 6620 696d  ="")..    def im
+00014a50: 6167 655f 6c6f 636b 5f6d 616e 6970 756c  age_lock_manipul
+00014a60: 6174 696f 6e73 286e 6f64 652c 202a 2a6b  ations(node, **k
+00014a70: 7761 7267 7329 3a0d 0a20 2020 2020 2020  wargs):..       
+00014a80: 2073 656c 6628 2269 6d61 6765 206c 6f63   self("image loc
+00014a90: 6b5c 6e22 290d 0a0d 0a20 2020 2040 7472  k\n")....    @tr
+00014aa0: 6565 5f63 6f6e 6469 7469 6f6e 616c 286c  ee_conditional(l
+00014ab0: 616d 6264 6120 6e6f 6465 3a20 6e6f 7420  ambda node: not 
+00014ac0: 6e6f 6465 2e6c 6f63 6b29 0d0a 2020 2020  node.lock)..    
+00014ad0: 4074 7265 655f 7375 626d 656e 7528 5f28  @tree_submenu(_(
+00014ae0: 2249 6d61 6765 2229 290d 0a20 2020 2040  "Image"))..    @
+00014af0: 7472 6565 5f6f 7065 7261 7469 6f6e 285f  tree_operation(_
+00014b00: 2822 4469 7468 6572 2074 6f20 3120 6269  ("Dither to 1 bi
+00014b10: 7422 292c 206e 6f64 655f 7479 7065 3d22  t"), node_type="
+00014b20: 656c 656d 2069 6d61 6765 222c 2068 656c  elem image", hel
+00014b30: 703d 2222 290d 0a20 2020 2064 6566 2069  p="")..    def i
+00014b40: 6d61 6765 5f64 6974 6865 7228 6e6f 6465  mage_dither(node
+00014b50: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+00014b60: 2020 2020 2020 7365 6c66 2822 696d 6167        self("imag
+00014b70: 6520 6469 7468 6572 5c6e 2229 0d0a 0d0a  e dither\n")....
+00014b80: 2020 2020 4074 7265 655f 636f 6e64 6974      @tree_condit
+00014b90: 696f 6e61 6c28 6c61 6d62 6461 206e 6f64  ional(lambda nod
+00014ba0: 653a 206e 6f74 206e 6f64 652e 6c6f 636b  e: not node.lock
+00014bb0: 290d 0a20 2020 2040 7472 6565 5f73 7562  )..    @tree_sub
+00014bc0: 6d65 6e75 285f 2822 496d 6167 6522 2929  menu(_("Image"))
+00014bd0: 0d0a 2020 2020 4074 7265 655f 6f70 6572  ..    @tree_oper
+00014be0: 6174 696f 6e28 5f28 2249 6e76 6572 7420  ation(_("Invert 
+00014bf0: 696d 6167 6522 292c 206e 6f64 655f 7479  image"), node_ty
+00014c00: 7065 3d22 656c 656d 2069 6d61 6765 222c  pe="elem image",
+00014c10: 2068 656c 703d 2222 290d 0a20 2020 2064   help="")..    d
+00014c20: 6566 2069 6d61 6765 5f69 6e76 6572 7428  ef image_invert(
+00014c30: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
+00014c40: 0d0a 2020 2020 2020 2020 7365 6c66 2822  ..        self("
+00014c50: 696d 6167 6520 696e 7665 7274 5c6e 2229  image invert\n")
+00014c60: 0d0a 0d0a 2020 2020 4074 7265 655f 636f  ....    @tree_co
+00014c70: 6e64 6974 696f 6e61 6c28 6c61 6d62 6461  nditional(lambda
+00014c80: 206e 6f64 653a 206e 6f74 206e 6f64 652e   node: not node.
+00014c90: 6c6f 636b 290d 0a20 2020 2040 7472 6565  lock)..    @tree
+00014ca0: 5f73 7562 6d65 6e75 285f 2822 496d 6167  _submenu(_("Imag
+00014cb0: 6522 2929 0d0a 2020 2020 4074 7265 655f  e"))..    @tree_
+00014cc0: 6f70 6572 6174 696f 6e28 5f28 224d 6972  operation(_("Mir
+00014cd0: 726f 7220 686f 7269 7a6f 6e74 616c 2229  ror horizontal")
+00014ce0: 2c20 6e6f 6465 5f74 7970 653d 2265 6c65  , node_type="ele
+00014cf0: 6d20 696d 6167 6522 2c20 6865 6c70 3d22  m image", help="
+00014d00: 2229 0d0a 2020 2020 6465 6620 696d 6167  ")..    def imag
+00014d10: 655f 6d69 7272 6f72 286e 6f64 652c 202a  e_mirror(node, *
+00014d20: 2a6b 7761 7267 7329 3a0d 0a20 2020 2020  *kwargs):..     
+00014d30: 2020 2073 656c 6628 2269 6d61 6765 206d     self("image m
+00014d40: 6972 726f 725c 6e22 290d 0a0d 0a20 2020  irror\n")....   
+00014d50: 2040 7472 6565 5f63 6f6e 6469 7469 6f6e   @tree_condition
+00014d60: 616c 286c 616d 6264 6120 6e6f 6465 3a20  al(lambda node: 
+00014d70: 6e6f 7420 6e6f 6465 2e6c 6f63 6b29 0d0a  not node.lock)..
+00014d80: 2020 2020 4074 7265 655f 7375 626d 656e      @tree_submen
+00014d90: 7528 5f28 2249 6d61 6765 2229 290d 0a20  u(_("Image")).. 
+00014da0: 2020 2040 7472 6565 5f6f 7065 7261 7469     @tree_operati
+00014db0: 6f6e 285f 2822 466c 6970 2076 6572 7469  on(_("Flip verti
+00014dc0: 6361 6c22 292c 206e 6f64 655f 7479 7065  cal"), node_type
+00014dd0: 3d22 656c 656d 2069 6d61 6765 222c 2068  ="elem image", h
+00014de0: 656c 703d 2222 290d 0a20 2020 2064 6566  elp="")..    def
+00014df0: 2069 6d61 6765 5f66 6c69 7028 6e6f 6465   image_flip(node
+00014e00: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+00014e10: 2020 2020 2020 7365 6c66 2822 696d 6167        self("imag
+00014e20: 6520 666c 6970 5c6e 2229 0d0a 0d0a 2020  e flip\n")....  
+00014e30: 2020 4074 7265 655f 636f 6e64 6974 696f    @tree_conditio
+00014e40: 6e61 6c28 6c61 6d62 6461 206e 6f64 653a  nal(lambda node:
+00014e50: 206e 6f74 206e 6f64 652e 6c6f 636b 290d   not node.lock).
+00014e60: 0a20 2020 2040 7472 6565 5f73 7562 6d65  .    @tree_subme
+00014e70: 6e75 285f 2822 496d 6167 6522 2929 0d0a  nu(_("Image"))..
+00014e80: 2020 2020 4074 7265 655f 6f70 6572 6174      @tree_operat
+00014e90: 696f 6e28 5f28 2252 6f74 6174 6520 3930  ion(_("Rotate 90
+00014ea0: c2b0 2043 5722 292c 206e 6f64 655f 7479  .. CW"), node_ty
+00014eb0: 7065 3d22 656c 656d 2069 6d61 6765 222c  pe="elem image",
+00014ec0: 2068 656c 703d 2222 290d 0a20 2020 2064   help="")..    d
+00014ed0: 6566 2069 6d61 6765 5f63 7728 6e6f 6465  ef image_cw(node
+00014ee0: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+00014ef0: 2020 2020 2020 7365 6c66 2822 696d 6167        self("imag
+00014f00: 6520 6377 5c6e 2229 0d0a 0d0a 2020 2020  e cw\n")....    
+00014f10: 4074 7265 655f 636f 6e64 6974 696f 6e61  @tree_conditiona
+00014f20: 6c28 6c61 6d62 6461 206e 6f64 653a 206e  l(lambda node: n
+00014f30: 6f74 206e 6f64 652e 6c6f 636b 290d 0a20  ot node.lock).. 
+00014f40: 2020 2040 7472 6565 5f73 7562 6d65 6e75     @tree_submenu
+00014f50: 285f 2822 496d 6167 6522 2929 0d0a 2020  (_("Image"))..  
+00014f60: 2020 4074 7265 655f 6f70 6572 6174 696f    @tree_operatio
+00014f70: 6e28 5f28 2252 6f74 6174 6520 3930 c2b0  n(_("Rotate 90..
+00014f80: 2043 4357 2229 2c20 6e6f 6465 5f74 7970   CCW"), node_typ
+00014f90: 653d 2265 6c65 6d20 696d 6167 6522 2c20  e="elem image", 
+00014fa0: 6865 6c70 3d22 2229 0d0a 2020 2020 6465  help="")..    de
+00014fb0: 6620 696d 6167 655f 6363 7728 6e6f 6465  f image_ccw(node
+00014fc0: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+00014fd0: 2020 2020 2020 7365 6c66 2822 696d 6167        self("imag
+00014fe0: 6520 6363 775c 6e22 290d 0a0d 0a20 2020  e ccw\n")....   
+00014ff0: 2040 7472 6565 5f73 7562 6d65 6e75 285f   @tree_submenu(_
+00015000: 2822 496d 6167 6522 2929 0d0a 2020 2020  ("Image"))..    
+00015010: 4074 7265 655f 6f70 6572 6174 696f 6e28  @tree_operation(
+00015020: 0d0a 2020 2020 2020 2020 5f28 2253 6176  ..        _("Sav
+00015030: 6520 6f72 6967 696e 616c 2069 6d61 6765  e original image
+00015040: 2074 6f20 6f75 7470 7574 2e70 6e67 2229   to output.png")
+00015050: 2c20 6e6f 6465 5f74 7970 653d 2265 6c65  , node_type="ele
+00015060: 6d20 696d 6167 6522 2c20 6865 6c70 3d22  m image", help="
+00015070: 220d 0a20 2020 2029 0d0a 2020 2020 6465  "..    )..    de
+00015080: 6620 696d 6167 655f 7361 7665 286e 6f64  f image_save(nod
+00015090: 652c 202a 2a6b 7761 7267 7329 3a0d 0a20  e, **kwargs):.. 
+000150a0: 2020 2020 2020 2073 656c 6628 2269 6d61         self("ima
+000150b0: 6765 2073 6176 6520 6f75 7470 7574 2e70  ge save output.p
+000150c0: 6e67 5c6e 2229 0d0a 0d0a 2020 2020 4074  ng\n")....    @t
+000150d0: 7265 655f 7375 626d 656e 7528 5f28 2249  ree_submenu(_("I
+000150e0: 6d61 6765 2229 290d 0a20 2020 2040 7472  mage"))..    @tr
+000150f0: 6565 5f6f 7065 7261 7469 6f6e 280d 0a20  ee_operation(.. 
+00015100: 2020 2020 2020 205f 2822 5361 7665 2070         _("Save p
+00015110: 726f 6365 7373 6564 2069 6d61 6765 2074  rocessed image t
+00015120: 6f20 6f75 7470 7574 2e70 6e67 2229 2c20  o output.png"), 
+00015130: 6e6f 6465 5f74 7970 653d 2265 6c65 6d20  node_type="elem 
+00015140: 696d 6167 6522 2c20 6865 6c70 3d22 220d  image", help="".
+00015150: 0a20 2020 2029 0d0a 2020 2020 6465 6620  .    )..    def 
+00015160: 696d 6167 655f 7361 7665 5f70 726f 6365  image_save_proce
+00015170: 7373 6564 286e 6f64 652c 202a 2a6b 7761  ssed(node, **kwa
+00015180: 7267 7329 3a0d 0a20 2020 2020 2020 2073  rgs):..        s
+00015190: 656c 6628 2269 6d61 6765 2073 6176 6520  elf("image save 
+000151a0: 6f75 7470 7574 2e70 6e67 202d 2d70 726f  output.png --pro
+000151b0: 6365 7373 6564 5c6e 2229 0d0a 0d0a 2020  cessed\n")....  
+000151c0: 2020 4074 7265 655f 636f 6e64 6974 696f    @tree_conditio
+000151d0: 6e61 6c28 6c61 6d62 6461 206e 6f64 653a  nal(lambda node:
+000151e0: 206c 656e 286e 6f64 652e 6368 696c 6472   len(node.childr
+000151f0: 656e 2920 3e20 3029 0d0a 2020 2020 4074  en) > 0)..    @t
+00015200: 7265 655f 7365 7061 7261 746f 725f 6265  ree_separator_be
+00015210: 666f 7265 2829 0d0a 2020 2020 4074 7265  fore()..    @tre
+00015220: 655f 6f70 6572 6174 696f 6e28 0d0a 2020  e_operation(..  
+00015230: 2020 2020 2020 5f28 2245 7870 616e 6420        _("Expand 
+00015240: 616c 6c20 6368 696c 6472 656e 2229 2c0d  all children"),.
+00015250: 0a20 2020 2020 2020 206e 6f64 655f 7479  .        node_ty
+00015260: 7065 3d28 0d0a 2020 2020 2020 2020 2020  pe=(..          
+00015270: 2020 226f 7020 6375 7422 2c0d 0a20 2020    "op cut",..   
+00015280: 2020 2020 2020 2020 2022 6f70 2072 6173           "op ras
+00015290: 7465 7222 2c0d 0a20 2020 2020 2020 2020  ter",..         
+000152a0: 2020 2022 6f70 2069 6d61 6765 222c 0d0a     "op image",..
+000152b0: 2020 2020 2020 2020 2020 2020 226f 7020              "op 
+000152c0: 656e 6772 6176 6522 2c0d 0a20 2020 2020  engrave",..     
+000152d0: 2020 2020 2020 2022 6f70 2064 6f74 7322         "op dots"
+000152e0: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
+000152f0: 6f70 2068 6174 6368 222c 0d0a 2020 2020  op hatch",..    
+00015300: 2020 2020 2020 2020 2262 7261 6e63 6820          "branch 
+00015310: 656c 656d 7322 2c0d 0a20 2020 2020 2020  elems",..       
+00015320: 2020 2020 2022 6272 616e 6368 206f 7073       "branch ops
+00015330: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+00015340: 2262 7261 6e63 6820 7265 6722 2c0d 0a20  "branch reg",.. 
+00015350: 2020 2020 2020 2020 2020 2022 6772 6f75             "grou
+00015360: 7022 2c0d 0a20 2020 2020 2020 2020 2020  p",..           
+00015370: 2022 6669 6c65 222c 0d0a 2020 2020 2020   "file",..      
+00015380: 2020 2020 2020 2272 6f6f 7422 2c0d 0a20        "root",.. 
+00015390: 2020 2020 2020 2029 2c0d 0a20 2020 2020         ),..     
+000153a0: 2020 2068 656c 703d 5f28 2245 7870 616e     help=_("Expan
+000153b0: 6420 616c 6c20 6368 696c 6472 656e 206f  d all children o
+000153c0: 6620 7468 6973 2067 6976 656e 206e 6f64  f this given nod
+000153d0: 652e 2229 2c0d 0a20 2020 2029 0d0a 2020  e."),..    )..  
+000153e0: 2020 6465 6620 6578 7061 6e64 5f61 6c6c    def expand_all
+000153f0: 5f63 6869 6c64 7265 6e28 6e6f 6465 2c20  _children(node, 
+00015400: 2a2a 6b77 6172 6773 293a 0d0a 2020 2020  **kwargs):..    
+00015410: 2020 2020 6e6f 6465 2e6e 6f74 6966 795f      node.notify_
+00015420: 6578 7061 6e64 2829 0d0a 0d0a 2020 2020  expand()....    
+00015430: 4074 7265 655f 636f 6e64 6974 696f 6e61  @tree_conditiona
+00015440: 6c28 6c61 6d62 6461 206e 6f64 653a 206c  l(lambda node: l
+00015450: 656e 286e 6f64 652e 6368 696c 6472 656e  en(node.children
+00015460: 2920 3e20 3029 0d0a 2020 2020 4074 7265  ) > 0)..    @tre
+00015470: 655f 6f70 6572 6174 696f 6e28 0d0a 2020  e_operation(..  
+00015480: 2020 2020 2020 5f28 2243 6f6c 6c61 7073        _("Collaps
+00015490: 6520 616c 6c20 6368 696c 6472 656e 2229  e all children")
+000154a0: 2c0d 0a20 2020 2020 2020 206e 6f64 655f  ,..        node_
+000154b0: 7479 7065 3d28 0d0a 2020 2020 2020 2020  type=(..        
+000154c0: 2020 2020 226f 7020 6375 7422 2c0d 0a20      "op cut",.. 
+000154d0: 2020 2020 2020 2020 2020 2022 6f70 2072             "op r
+000154e0: 6173 7465 7222 2c0d 0a20 2020 2020 2020  aster",..       
+000154f0: 2020 2020 2022 6f70 2069 6d61 6765 222c       "op image",
+00015500: 0d0a 2020 2020 2020 2020 2020 2020 226f  ..            "o
+00015510: 7020 656e 6772 6176 6522 2c0d 0a20 2020  p engrave",..   
+00015520: 2020 2020 2020 2020 2022 6f70 2064 6f74           "op dot
+00015530: 7322 2c0d 0a20 2020 2020 2020 2020 2020  s",..           
+00015540: 2022 6f70 2068 6174 6368 222c 0d0a 2020   "op hatch",..  
+00015550: 2020 2020 2020 2020 2020 2262 7261 6e63            "branc
+00015560: 6820 656c 656d 7322 2c0d 0a20 2020 2020  h elems",..     
+00015570: 2020 2020 2020 2022 6272 616e 6368 206f         "branch o
+00015580: 7073 222c 0d0a 2020 2020 2020 2020 2020  ps",..          
+00015590: 2020 2262 7261 6e63 6820 7265 6722 2c0d    "branch reg",.
+000155a0: 0a20 2020 2020 2020 2020 2020 2022 6772  .            "gr
+000155b0: 6f75 7022 2c0d 0a20 2020 2020 2020 2020  oup",..         
+000155c0: 2020 2022 6669 6c65 222c 0d0a 2020 2020     "file",..    
+000155d0: 2020 2020 2020 2020 2272 6f6f 7422 2c0d          "root",.
+000155e0: 0a20 2020 2020 2020 2029 2c0d 0a20 2020  .        ),..   
+000155f0: 2020 2020 2068 656c 703d 5f28 2243 6f6c       help=_("Col
+00015600: 6c61 7073 6520 616c 6c20 6368 696c 6472  lapse all childr
+00015610: 656e 206f 6620 7468 6973 2067 6976 656e  en of this given
+00015620: 206e 6f64 652e 2229 2c0d 0a20 2020 2029   node."),..    )
+00015630: 0d0a 2020 2020 6465 6620 636f 6c6c 6170  ..    def collap
+00015640: 7365 5f61 6c6c 5f63 6869 6c64 7265 6e28  se_all_children(
+00015650: 6e6f 6465 2c20 2a2a 6b77 6172 6773 293a  node, **kwargs):
+00015660: 0d0a 2020 2020 2020 2020 6e6f 6465 2e6e  ..        node.n
+00015670: 6f74 6966 795f 636f 6c6c 6170 7365 2829  otify_collapse()
+00015680: 0d0a                                     ..
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/element_types.py` & `meerk40t-0.8.3000/meerk40t/core/elements/element_types.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,7 +1,14 @@
+"""
+Helper list to define node types according to some criteria. For example, you'd likely want to delete
+to only show up for the non-structural nodes. However, there's not a simple method for specifying that
+and listing all the nodes a tree-op would apply to can result in a very long list.
+These are those long list.
+"""
+
 from meerk40t.svgelements import (
     Circle,
     Ellipse,
     Path,
     Point,
     Polygon,
     Polyline,
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/elements.py` & `meerk40t-0.8.3000/meerk40t/core/elements/elements.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,33 +1,68 @@
+"""
+The elements module governs all the interactions with the various nodes, as well as dealing with tree information.
+This serves effectively as the datastructure that stores all information about any active project. This includes
+several smaller functional pieces like Penbox and Wordlists.
+"""
+
+
 import contextlib
 import os.path
 from time import time
 
 from meerk40t.core.exceptions import BadFileError
+from meerk40t.core.node.op_cut import CutOpNode
+from meerk40t.core.node.op_dots import DotsOpNode
+from meerk40t.core.node.op_engrave import EngraveOpNode
+from meerk40t.core.node.op_image import ImageOpNode
+from meerk40t.core.node.op_raster import RasterOpNode
+from meerk40t.core.node.rootnode import RootNode
+from meerk40t.core.undos import Undo
+from meerk40t.core.units import UNITS_PER_MIL, Length
+from meerk40t.core.wordlist import Wordlist
 from meerk40t.kernel import ConsoleFunction, Service, Settings
+from meerk40t.svgelements import Close, Color, Line, Move, SVGElement
 
-from ..svgelements import Close, Color, Line, Move, SVGElement
 from .element_types import *
-from .node.op_cut import CutOpNode
-from .node.op_dots import DotsOpNode
-from .node.op_engrave import EngraveOpNode
-from .node.op_image import ImageOpNode
-from .node.op_raster import RasterOpNode
-from .node.rootnode import RootNode
-from .undos import Undo
-from .units import UNITS_PER_MIL, Length
-from .wordlist import Wordlist
 
 
 def plugin(kernel, lifecycle=None):
     _ = kernel.translation
     if lifecycle == "plugins":
-        from meerk40t.core import element_commands, element_treeops
+        from . import (
+            align,
+            branches,
+            clipboard,
+            element_treeops,
+            grid,
+            materials,
+            notes,
+            render,
+            shapes,
+            trace,
+            tree_commands,
+            undo_redo,
+            wordlist,
+        )
 
-        return [element_commands.plugin, element_treeops.plugin]
+        return [
+            element_treeops.plugin,
+            branches.plugin,
+            trace.plugin,
+            align.plugin,
+            wordlist.plugin,
+            materials.plugin,
+            shapes.plugin,
+            tree_commands.plugin,
+            undo_redo.plugin,
+            clipboard.plugin,
+            grid.plugin,
+            render.plugin,
+            notes.plugin,
+        ]
     elif lifecycle == "preregister":
         kernel.register(
             "format/op cut",
             "{danger}{defop}{enabled}{pass}{element_type} {speed}mm/s @{power} {colcode} {opstop}",
         )
         kernel.register(
             "format/op engrave",
@@ -378,23 +413,14 @@
 #     if len(path) == 2 and isinstance(path[0], Move):
 #         if isinstance(path[1], Line) and path[1].length() > 0:
 #             return True
 #     return False
 
 
 class Elemental(Service):
-    """
-    The elemental service is governs all the interactions with the various elements,
-    operations, and filenodes. Handling structure change and selection, emphasis, and
-    highlighting changes. The goal of this module is to make sure that the life cycle
-    of the elements is strictly enforced. For example, every element that is removed
-    must have had the .cache deleted. And anything selecting an element must propagate
-    that information out to inform other interested modules.
-    """
-
     def __init__(self, kernel, index=None, *args, **kwargs):
         Service.__init__(
             self, kernel, "elements" if index is None else f"elements{index}"
         )
         self._clipboard = {}
         self._clipboard_default = "0"
 
@@ -425,18 +451,14 @@
         self.setting(bool, "lock_allows_move", True)
         self.setting(bool, "auto_note", True)
         self.setting(bool, "uniform_svg", False)
         self.setting(float, "svg_ppi", 96.0)
         self.setting(bool, "operation_default_empty", True)
 
         self.op_data = Settings(self.kernel.name, "operations.cfg")
-        self.pen_data = Settings(self.kernel.name, "penbox.cfg")
-
-        self.penbox = {}
-        self.load_persistent_penbox()
 
         self.wordlists = {"version": [1, self.kernel.version]}
 
         direct = os.path.dirname(self.op_data._config_file)
         self.mywordlist = Wordlist(self.kernel.version, direct)
         self.load_persistent_operations("previous")
 
@@ -591,57 +613,14 @@
         emptyset = False
         for node in self.elems():
             if len(node._references) == 0 and node.type not in ("file", "group"):
                 emptyset = True
                 break
         return emptyset
 
-    def load_persistent_penbox(self):
-        settings = self.pen_data
-        pens = settings.read_persistent_string_dict("pens", suffix=True)
-        for pen in pens:
-            length = int(pens[pen])
-            box = list()
-            for i in range(length):
-                penbox = dict()
-                settings.read_persistent_string_dict(f"{pen} {i}", penbox, suffix=True)
-                box.append(penbox)
-            self.penbox[pen] = box
-
-    def save_persistent_penbox(self):
-        sections = {}
-        for section in self.penbox:
-            sections[section] = len(self.penbox[section])
-        self.pen_data.write_persistent_dict("pens", sections)
-        for section in self.penbox:
-            for i, p in enumerate(self.penbox[section]):
-                self.pen_data.write_persistent_dict(f"{section} {i}", p)
-
-    def index_range(self, index_string):
-        """
-        Parses index ranges in the form <idx>,<idx>-<idx>,<idx>
-        @param index_string:
-        @return:
-        """
-        indexes = list()
-        for s in index_string.split(","):
-            q = list(s.split("-"))
-            if len(q) == 1:
-                indexes.append(int(q[0]))
-            else:
-                start = int(q[0])
-                end = int(q[1])
-                if start > end:
-                    for q in range(end, start + 1):
-                        indexes.append(q)
-                else:
-                    for q in range(start, end + 1):
-                        indexes.append(q)
-        return indexes
-
     def length(self, v):
         return float(Length(v))
 
     def length_x(self, v):
         return float(Length(v, relative_length=self.device.width))
 
     def length_y(self, v):
@@ -875,14 +854,127 @@
                     area_y_x += last_y * pt.x
                 last_x = pt.x
                 last_y = pt.y
             this_area = 0.5 * abs(area_x_y - area_y_x)
 
         return this_area, this_length
 
+    def condense_elements(self, data, expand_at_end=True):
+        """
+        This routine looks at a given dataset and will condense
+        it in the sense that if all elements of a given hierarchy
+        (ie group or file) are in this set, then they will be
+        replaced and represented by this parent element
+        """
+
+        def remove_children_from_list(list_to_deal, parent_node):
+            for idx, node in enumerate(list_to_deal):
+                if node is None:
+                    continue
+                if node.parent is parent_node:
+                    list_to_deal[idx] = None
+                    if len(node.children) > 0:
+                        remove_children_from_list(list_to_deal, node)
+
+        align_data = [e for e in data]
+        needs_repetition = True
+        while needs_repetition:
+            # Will be set only if we add a parent, as the process needs then to be repeated
+            needs_repetition = False
+
+            data_to_align = []
+            # We need to iterate through all the elements
+            # to establish if they belong to a group,
+            # if all the elements in this group are in
+            # the dataset too, then we just take the group
+            # as a representative.
+            data_len = len(align_data)
+
+            for idx1, node_1 in enumerate(align_data):
+                if node_1 is None:
+                    # Has been dealt with already
+                    # print ("Eliminated node")
+                    continue
+                # Is this a group? Then we just take this node
+                # and remove all children nodes
+                if node_1.type in ("file", "group"):
+                    # print (f"Group node ({node_1.label}), eliminate children")
+                    remove_children_from_list(align_data, node_1)
+                    # No continue, as we still need to
+                    # assess the parent case
+
+                parent = node_1.parent
+                if parent is None:
+                    data_to_align.append(node_1)
+                    align_data[idx1] = None
+                    # print (f"Adding {node_1.type}, no parent")
+                    continue
+                if parent.type not in ("file", "group"):
+                    # That should not happen per se,
+                    # only for root objects which parent
+                    # is elem_branch
+                    # print (f"Adding {node_1.type}, parent was: {parent.type}")
+                    data_to_align.append(node_1)
+                    align_data[idx1] = None
+                    continue
+                # How many children are contained?
+                candidates = len(parent.children)
+                identified = 0
+                if candidates > 0:
+                    # We only need to look to elements not yet dealt with,
+                    # but we start with the current index to include
+                    # node_1 in the count
+                    for idx2 in range(idx1, data_len, 1):
+                        node_2 = align_data[idx2]
+                        if node_2 is not None:
+                            if node_2.parent is parent:
+                                identified += 1
+                if identified == candidates:
+                    # All children of the parent object are contained
+                    # So we add the parent instead...
+                    data_to_align.append(parent)
+                    remove_children_from_list(align_data, parent)
+                    # print (f"Adding parent for {node_1.type}, all children inside")
+                    needs_repetition = True
+
+                else:
+                    data_to_align.append(node_1)
+                    align_data[idx1] = None
+                    # print (f"Adding {node_1.type}, not all children of parent {identified} vs {candidates}")
+            if needs_repetition:
+                # We copy the data and do it again....
+                # print ("Repetition required")
+                align_data = [e for e in data_to_align]
+        # One special case though: if we have selected all
+        # elements within a single group then we still deal
+        # with all children
+        if expand_at_end:
+            while len(data_to_align) == 1:
+                node = data_to_align[0]
+                if node is not None and node.type in ("file", "group"):
+                    data_to_align = [e for e in node.children]
+                else:
+                    break
+        return data_to_align
+
+    def translate_node(self, node, dx, dy):
+        if hasattr(node, "lock") and node.lock and not self.lock_allows_move:
+            return
+        else:
+            if node.type in ("group", "file"):
+                for c in node.children:
+                    self.translate_node(c, dx, dy)
+                node.translated(dx, dy)
+            else:
+                try:
+                    node.matrix.post_translate(dx, dy)
+                    node.translated(dx, dy)
+                except AttributeError:
+                    pass
+
     def align_elements(self, data, alignbounds, positionx, positiony, as_group):
         """
 
         @param data: elements to align
         @param alignbounds: boundary tuple (left, top, right, bottom)
                             to which data needs to be aligned to
         @param positionx:   one of "min", "max", "center"
@@ -910,98 +1002,50 @@
                 dy = alignbounds[3] - bottom_edge
             elif positiony == "center":
                 dy = (alignbounds[3] + alignbounds[1]) / 2 - (
                     bottom_edge + top_edge
                 ) / 2
             return dx, dy
 
-        if as_group != 0:
-            individually = 2  # all elements as a total
-        else:
-            individually = 0
-            for n in data:
-                if n.type == "group":
-                    individually = 1
-                    break
+        data_to_align = self.condense_elements(data)
         # Selection boundaries
         boundary_points = []
-        for node in data:
+        for node in data_to_align:
             if node.bounds is not None:
                 boundary_points.append(node.bounds)
         if len(boundary_points) == 0:
             return
         left_edge = min([e[0] for e in boundary_points])
         top_edge = min([e[1] for e in boundary_points])
         right_edge = max([e[2] for e in boundary_points])
         bottom_edge = max([e[3] for e in boundary_points])
         if alignbounds is None:
+            # print ("Alignbounds were not set...")
             alignbounds = (left_edge, top_edge, right_edge, bottom_edge)
         # print(f"Alignbounds: {alignbounds[0]:.1f},{alignbounds[1]:.1f},{alignbounds[2]:.1f},{alignbounds[3]:.1f}")
 
-        if individually in (0, 1):
-            groupmatrix = ""
+        if as_group == 0:
             groupdx = 0
             groupdy = 0
         else:
             groupdx, groupdy = calc_dx_dy()
             # print (f"Group move: {groupdx:.2f}, {groupdy:.2f}")
-            groupmatrix = f"translate({groupdx}, {groupdy})"
 
-        # Looping through all nodes with node.flat can provide
-        # multiple times a single node, as you may loop through
-        # files and groups nested into each other.
-        # To avoid this we create a temporary set which by definition
-        # can only contain unique members
-        if individually == 0:
-            s = set()
-            for n in data:
-                # print(f"Node to be resolved: {node.type}")
-                s = s.union(n.flat(emphasized=True, types=elem_nodes))
-        else:
-            s = set()
-            for n in data:
-                # print(f"Node to be resolved: {node.type}")
-                s = s.union(list([n]))
-        for q in s:
+        for q in data_to_align:
             # print(f"Node to be treated: {q.type}")
-            if individually in (0, 1):
+            if as_group == 0:
                 left_edge = q.bounds[0]
                 top_edge = q.bounds[1]
                 right_edge = q.bounds[2]
                 bottom_edge = q.bounds[3]
                 dx, dy = calc_dx_dy()
-                matrix = f"translate({dx}, {dy})"
-                # print (f"{individually} - {dx:.2f}, {dy:.2f}")
             else:
                 dx = groupdx
                 dy = groupdy
-                matrix = groupmatrix
-            if hasattr(q, "lock") and q.lock and not self.lock_allows_move:
-                continue
-            else:
-                if q.type in ("group", "file"):
-                    for c in q.flat(emphasized=True, types=elem_nodes):
-                        if hasattr(c, "lock") and c.lock and not self.lock_allows_move:
-                            continue
-                        try:
-                            c.matrix.post_translate(dx, dy)
-                            # c.modified()
-                            c.translated(dx, dy)
-                        except AttributeError:
-                            pass
-                            # print(f"Attribute Error for node {c.type} trying to assign {dx:.2f}, {dy:.2f}")
-                else:
-                    try:
-                        # q.matrix *= matrix
-                        q.matrix.post_translate(dx, dy)
-                        # q.modified()
-                        q.translated(dx, dy)
-                    except AttributeError:
-                        pass
-                        # print(f"Attribute Error for node {q.type} trying to assign {dx:.2f}, {dy:.2f}")
+            self.translate_node(q, dx, dy)
         self.signal("refresh_scene", "Scene")
 
     def wordlist_delta(self, orgtext, increase):
         newtext = self.mywordlist.wordlist_delta(orgtext, increase)
         return newtext
 
     def wordlist_fetch(self, key):
@@ -1077,16 +1121,14 @@
         self.unlisten_tree(self)
 
     def service_attach(self, *args, **kwargs):
         self.listen_tree(self)
 
     def shutdown(self, *args, **kwargs):
         self.save_persistent_operations("previous")
-        self.save_persistent_penbox()
-        self.pen_data.write_configuration()
         self.op_data.write_configuration()
         for e in self.flat():
             e.unregister()
 
     def save_persistent_operations(self, name):
         settings = self.op_data
         subitems = list(settings.derivable(name))
@@ -1474,29 +1516,30 @@
         #                     if n.fill == first_color_fill:
         #                         addit = True
         #             # print ("Checked %s and will addit=%s" % (n.type, addit))
         #             if addit and n not in data:
         #                 data.append(n)
         for drag_node in data:
             if drop_node is drag_node:
-                print(f"Drag {drag_node.type} to {drop_node.type} - Drop node was drag node")
+                # print(f"Drag {drag_node.type} to {drop_node.type} - Drop node was drag node")
                 continue
             if drop_node.drop(drag_node, modify=False):
                 # Is the drag node coming from the regmarks branch?
                 # If yes then we might need to classify.
                 if drag_node._parent.type == "branch reg":
                     if drag_node.type in ("file", "group"):
                         for e in drag_node.flat(elem_nodes):
                             to_classify.append(e)
                     else:
                         to_classify.append(drag_node)
                 drop_node.drop(drag_node, modify=True)
                 success = True
             else:
-                print(f"Drag {drag_node.type} to {drop_node.type} - Drop node vetoed")
+                # print(f"Drag {drag_node.type} to {drop_node.type} - Drop node vetoed")
+                pass
         if self.classify_new and len(to_classify) > 0:
             self.classify(to_classify)
         # Refresh the target node so any changes like color materialize...
         self.signal("element_property_reload", drop_node)
         return success
 
     def remove_nodes(self, node_list):
@@ -1808,14 +1851,38 @@
             self._emphasized_bounds_painted = bounds_painted
             self.set_emphasis(e_list)
         else:
             self._emphasized_bounds = None
             self._emphasized_bounds_painted = None
             self.set_emphasis(None)
 
+    def post_classify(self, data):
+        """
+        Provides a post_classification algorithm.
+
+        Why are we doing it here? An immediate classification
+        at the end of the element creation might not provide
+        the right assignment as additional commands might be
+        chained to it:
+
+        e.g. "circle 1cm 1cm 1cm" will classify differently than
+        "circle 1cm 1cm 1cm stroke red"
+
+        So we apply the classify_new to the post commands.
+
+        @return: post classification function.
+        """
+
+        def post_classify_function(**kwargs):
+            if self.classify_new and len(data) > 0:
+                self.classify(data)
+                self.signal("tree_changed")
+
+        return post_classify_function
+
     def classify(self, elements, operations=None, add_op_function=None):
         """
         @param elements: list of elements to classify.
         @param operations: operations list to classify into.
         @param add_op_function: function to add a new operation,
                 because of a lack of classification options.
         @return:
@@ -2902,28 +2969,44 @@
         if element_color is None or element_color.rgb is None:
             element_color = element.fill
         return element_color
 
     def load(self, pathname, **kwargs):
         kernel = self.kernel
         _ = kernel.translation
+        filename_to_process = pathname
+        # Lets check first if we have a preprocessor
+        # Use-case: if we identify functionalities in the file
+        # which aren't supported by mk yet, we could ask a program
+        # to convert these elements into supported artifacts
+        # This may change the fileformat (and filename)
+
+        fn_name, fn_extension = os.path.splitext(filename_to_process)
+        if fn_extension:
+            preproc = self.lookup(f"preprocessor/{fn_extension}")
+            # print (f"Preprocessor routine for preprocessor/{fn_extension}: {preproc}")
+            if preproc is not None:
+                filename_to_process = preproc(pathname)
+                # print (f"Gave: {pathname}, received: {filename_to_process}")
         for loader, loader_name, sname in kernel.find("load"):
             for description, extensions, mimetype in loader.load_types():
-                if str(pathname).lower().endswith(extensions):
+                if str(filename_to_process).lower().endswith(extensions):
                     self.set_start_time("load")
                     self.set_start_time("full_load")
                     with self.static("load elements"):
                         try:
                             # We could stop the attachment to shadowtree for the duration
-                            # of the load to avoid unnecessary actions, will provide
+                            # of the load to avoid unnecessary actions, this will provide
                             # about 8% speed increase, but probably not worth the risk
                             # with attachment: 77.2 sec
                             # without attachm: 72.1 sec
                             # self.unlisten_tree(self)
-                            results = loader.load(self, self, pathname, **kwargs)
+                            results = loader.load(
+                                self, self, filename_to_process, **kwargs
+                            )
                             self.remove_empty_groups()
                             # self.listen_tree(self)
                             end_time = time()
                             self._filename = pathname
                             self.set_end_time("load", display=True)
                             self.signal("file;loaded")
                             return True
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/laserjob.py` & `meerk40t-0.8.3000/meerk40t/core/laserjob.py`

 * *Files 9% similar despite different names*

```diff
@@ -1,15 +1,24 @@
+"""
+LaserJob is the basic Spooler Job. It stores a list of items that are merely called in order on the driver. Between
+each call a cycle is returned with False until the processing is finished and True is returned.
+
+The LaserJob itself permits looping. This will send the list of items that many times until the job is completed.
+This could be an infinite number of times.
+"""
+
+
 import time
 from math import isinf
 
 from meerk40t.core.cutcode.cutcode import CutCode
 
 
 class LaserJob:
-    def __init__(self, label, items, driver=None, priority=0, loops=1):
+    def __init__(self, label, items, driver=None, priority=0, loops=1, outline=None):
         self.items = items
         self.label = label
         self.priority = priority
         self.time_submitted = time.time()
         self.time_started = None
         self.runtime = 0
         self.time_pass_started = None
@@ -28,18 +37,37 @@
 
         for item in self.items:
             if isinstance(item, CutCode):
                 time_travel = item.duration_travel()
                 time_cuts = item.duration_cut()
                 time_extra = item.extra_time()
                 self._estimate += time_travel + time_cuts + time_extra
+        self.outline = outline
 
     def __str__(self):
         return f"{self.__class__.__name__}({self.label}: {self.loops_executed}/{self.loops})"
 
+    def bounds(self):
+        if self.outline is None:
+            return None
+        max_x = float("-inf")
+        max_y = float("-inf")
+        min_x = float("inf")
+        min_y = float("inf")
+        for x, y in self.outline:
+            if x > max_x:
+                max_x = x
+            if y > max_y:
+                max_y = y
+            if x < min_x:
+                min_x = x
+            if y < min_y:
+                min_y = y
+        return min_x, min_y, max_x, max_y
+
     @property
     def status(self):
         if self.is_running and self.time_started is not None:
             return "Running"
         elif not self.is_running:
             return "Disabled"
         else:
@@ -171,14 +199,15 @@
         # but we have some ideas, if and only if the job is_running:
         # a) we know the elapsed time
         # b) we know current and total steps (if the driver has such a property)
         if isinf(self.loops):
             return float("inf")
         result = 0
         time_for_past_passes = 0
+        time_for_current_pass = 0
         time_for_future_passes = self.loops * self._estimate
         if self.is_running and self.time_started is not None:
             # We fall back on elapsed and some info from the driver...
             elapsed = time.time() - self.time_started
             ratio = 1
             # As we have mainly disabled the driver preview, we do something simpler:
             # We know the pass of passes and we know the steps of total steps...
@@ -188,38 +217,43 @@
                     max(self.loops - self.loops_executed - 1, 0) * self._estimate
                 )
             else:
                 time_for_past_passes = self.time_pass_started - self.time_started
                 time_for_future_passes = self.avg_time_per_pass * max(
                     self.loops - self.loops_executed - 1, 0
                 )
-
-            if self.time_pass_started is not None:
+            still_running = False
+            if isinf(self.loops) or self.loops_executed < self.loops:
+                still_running = True
+            if self.time_pass_started is not None and still_running:
                 this_pass_seconds = time.time() - self.time_pass_started
                 if this_pass_seconds >= 5:
-                    result = max(
+                    time_for_current_pass = max(
                         self._estimate,
                         this_pass_seconds / max(self.steps_done, 1) * self.steps_total,
                     )
                 else:
-                    result = self._estimate
-            # print (f"Passes: {self.loops_executed} / {self.loops}")
-            # print (f"Past: {time_for_past_passes:.1f}, Current: {result:.1f}, Future: {time_for_future_passes:.1f}")
-            # print (f"Steps: {self.steps_done} / {self.steps_total}, Pass-Estimate: {self._estimate:.1f}")
+                    time_for_current_pass = self._estimate
             # if hasattr(self._driver, "total_steps"):
             #     total = self._driver.total_steps
             #     current = self._driver.current_steps
             #     # Safety belt, as we have disabled the logic partially
             #     if total < current:
             #         total = current + 1
             #     if current > 10 and total > 0:
             #         # Arbitrary minimum steps (if too low, value is erratic)
             #         ratio = total / current
             # result = elapsed * ratio
-        if result == 0:
+        if time_for_current_pass == time_for_past_passes == time_for_future_passes == 0:
             # Nothing useful came out, so we fall back on the initial value
             result = self._estimate
         else:
             # Acknowledge previous + future passes
-            result += time_for_past_passes + time_for_future_passes
+            result = (
+                time_for_current_pass + time_for_past_passes + time_for_future_passes
+            )
+        # print (f"Passes: {self.loops_executed} / {self.loops}")
+        # print (f"Past: {time_for_past_passes:.1f}, Current: {time_for_current_pass:.1f}, Future: {time_for_future_passes:.1f}")
+        # print (f"Steps: {self.steps_done} / {self.steps_total}, Pass-Estimate: {self._estimate:.1f}")
+        # print (f"Result={result:.1f}")
 
         return result
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/logging.py` & `meerk40t-0.8.3000/meerk40t/core/logging.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,9 +1,14 @@
 from meerk40t.kernel import Service, Settings
 
+"""
+Logging is used by the spooler and could be used by other services. It provides a service for log information.
+Currently this mostly logs spooler jobs that are completed.
+"""
+
 
 def plugin(kernel, lifecycle=None):
     _ = kernel.translation
     if lifecycle == "register":
         kernel.add_service("logging", Logging(kernel))
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/blobnode.py` & `meerk40t-0.8.3000/meerk40t/core/node/blobnode.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/bootstrap.py` & `meerk40t-0.8.3000/meerk40t/core/node/bootstrap.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/branch_elems.py` & `meerk40t-0.8.3000/meerk40t/core/node/branch_elems.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/branch_ops.py` & `meerk40t-0.8.3000/meerk40t/core/node/branch_ops.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/branch_regmark.py` & `meerk40t-0.8.3000/meerk40t/core/node/branch_regmark.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/cutnode.py` & `meerk40t-0.8.3000/meerk40t/core/node/cutnode.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/elem_ellipse.py` & `meerk40t-0.8.3000/meerk40t/core/node/elem_line.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,42 +1,41 @@
 from copy import copy
 from math import sqrt
 
 from meerk40t.core.node.mixins import Stroked
-from meerk40t.core.node.node import Fillrule, Node
+from meerk40t.core.node.node import Fillrule, Linecap, Linejoin, Node
 from meerk40t.svgelements import (
     SVG_ATTR_VECTOR_EFFECT,
     SVG_VALUE_NON_SCALING_STROKE,
-    Circle,
-    Ellipse,
     Matrix,
     Path,
     Point,
+    SimpleLine,
 )
 
 
-class EllipseNode(Node, Stroked):
+class LineNode(Node, Stroked):
     """
-    EllipseNode is the bootstrapped node type for the 'elem ellipse' type.
+    LineNode is the bootstrapped node type for the 'elem line' type.
     """
 
     def __init__(self, **kwargs):
         self.shape = None
         self.matrix = None
         self.fill = None
         self.stroke = None
         self.stroke_width = None
         self.stroke_scale = None
         self._stroke_zero = None
+        self.linecap = Linecap.CAP_BUTT
+        self.linejoin = Linejoin.JOIN_MITER
         self.fillrule = Fillrule.FILLRULE_EVENODD
-
-        super().__init__(type="elem ellipse", **kwargs)
-        self.__formatter = "{element_type} {id} {stroke}"
-        assert isinstance(self.shape, (Ellipse, Circle))
-
+        super().__init__(type="elem line", **kwargs)
+        self._formatter = "{element_type} {id} {stroke}"
+        assert isinstance(self.shape, SimpleLine)
         if self.matrix is None:
             self.matrix = self.shape.transform
         if self.fill is None:
             self.fill = self.shape.fill
         if self.stroke is None:
             self.stroke = self.shape.stroke
         if self.stroke_width is None:
@@ -48,24 +47,24 @@
             )
         if self._stroke_zero is None:
             # This defines the stroke-width zero point scale
             self.stroke_width_zero()
 
         self.set_dirty_bounds()
 
-    def __repr__(self):
-        return f"{self.__class__.__name__}('{self.type}', {str(self.shape)}, {str(self._parent)})"
-
     def __copy__(self):
         nd = self.node_dict
         nd["shape"] = copy(self.shape)
         nd["matrix"] = copy(self.matrix)
         nd["fill"] = copy(self.fill)
         nd["stroke_width"] = copy(self.stroke_width)
-        return EllipseNode(**nd)
+        return LineNode(**nd)
+
+    def __repr__(self):
+        return f"{self.__class__.__name__}('{self.type}', {str(self.shape)}, {str(self._parent)})"
 
     def scaled(self, sx, sy, ox, oy):
         """
         This is a special case of the modified call, we are scaling
         the node without fundamentally altering it's properties
         """
 
@@ -93,21 +92,24 @@
         delta = float(self.implied_stroke_width) / 2.0
         self._paint_bounds = (
             self._bounds[0] - delta,
             self._bounds[1] - delta,
             self._bounds[2] + delta,
             self._bounds[3] + delta,
         )
+        self._points_dirty = True
         self.notify_scaled(self, sx=sx, sy=sy, ox=ox, oy=oy)
 
     def bbox(self, transformed=True, with_stroke=False):
         self._sync_svg()
-        xmin, ymin, xmax, ymax = self.shape.bbox(
-            transformed=transformed, with_stroke=False
-        )
+        bounds = self.shape.bbox(transformed=transformed, with_stroke=False)
+        if bounds is None:
+            # degenerate paths can have no bounds.
+            return None
+        xmin, ymin, xmax, ymax = bounds
         if with_stroke:
             delta = float(self.implied_stroke_width) / 2.0
             return (
                 xmin - delta,
                 ymin - delta,
                 xmax + delta,
                 ymax + delta,
@@ -120,15 +122,15 @@
         self.matrix *= matrix
         self.stroke_scaled = False
         self._sync_svg()
         self.set_dirty_bounds()
 
     def default_map(self, default_map=None):
         default_map = super().default_map(default_map=default_map)
-        default_map["element_type"] = "Ellipse"
+        default_map["element_type"] = "Line"
         default_map.update(self.__dict__)
         return default_map
 
     def drop(self, drag_node, modify=True):
         # Dragging element into element.
         if drag_node.type.startswith("elem"):
             if modify:
@@ -149,43 +151,39 @@
         # self._points.append([bounds[2], bounds[3], "bounds bottom_right"])
         # self._points.append([cx, cy, "bounds center_center"])
         # self._points.append([cx, bounds[1], "bounds top_center"])
         # self._points.append([cx, bounds[3], "bounds bottom_center"])
         # self._points.append([bounds[0], cy, "bounds center_left"])
         # self._points.append([bounds[2], cy, "bounds center_right"])
         obj = self.shape
-        npoints = [
-            Point(obj.cx - obj.rx, obj.cy),
-            Point(obj.cx, obj.cy - obj.ry),
-            Point(obj.cx + obj.rx, obj.cy),
-            Point(obj.cx, obj.cy + obj.ry),
-        ]
-        p1 = Point(obj.cx, obj.cy)
+        p1 = Point(obj.x1, obj.y1)
+        p2 = Point(obj.x2, obj.y2)
+        p3 = Point(obj.x1 + obj.x2, obj.y1 + obj.y2)
         if not obj.transform.is_identity():
-            points = list(map(obj.transform.point_in_matrix_space, npoints))
             p1 = obj.transform.point_in_matrix_space(p1)
-        else:
-            points = npoints
-        for pt in points:
-            self._points.append([pt.x, pt.y, "point"])
-        self._points.append([p1.x, p1.y, "bounds center_center"])
+            p2 = obj.transform.point_in_matrix_space(p2)
+            p3 = obj.transform.point_in_matrix_space(p3)
+
+        self._points.append([p1.x, p1.y, "endpoint"])
+        self._points.append([p2.x, p2.y, "endpoint"])
+        self._points.append([p3.x, p3.y, "midpoint"])
 
     def update_point(self, index, point):
         return False
 
     def add_point(self, point, index=None):
         return False
 
     def _sync_svg(self):
         self.shape.values[SVG_ATTR_VECTOR_EFFECT] = (
             SVG_VALUE_NON_SCALING_STROKE if not self.stroke_scale else ""
         )
+        self.shape.stroke = self.stroke
         self.shape.transform = self.matrix
         self.shape.stroke_width = self.stroke_width
-        self.shape.stroke = self.stroke
         try:
             del self.shape.values["viewport_transform"]
             # If we had transforming viewport that is no longer relevant
         except KeyError:
             pass
 
     def as_path(self):
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/elem_geomstr.py` & `meerk40t-0.8.3000/meerk40t/core/node/elem_geomstr.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/elem_image.py` & `meerk40t-0.8.3000/meerk40t/core/node/elem_image.py`

 * *Files 1% similar despite different names*

```diff
@@ -53,14 +53,18 @@
         self.__formatter = "{element_type} {id} {width}x{height}"
         if self.matrix is None:
             self.matrix = Matrix()
         if hasattr(self, "href"):
             try:
                 from PIL import Image as PILImage
 
+                if not isinstance(self.href, str):
+                    # Error caused by href being int value
+                    raise ImportError
+
                 self.image = PILImage.open(self.href)
                 if hasattr(self, "x"):
                     self.matrix.post_translate_x(self.x)
                 if hasattr(self, "y"):
                     self.matrix.post_translate_x(self.y)
                 real_width, real_height = self.image.size
                 declared_width, declared_height = real_width, real_height
@@ -283,15 +287,18 @@
             inverted_main_matrix = Matrix(self.matrix).inverse()
             self._processed_matrix = actualized_matrix * inverted_main_matrix
             self._processed_image = image
             self._process_image_failed = False
             bb = self.bbox()
             self._bounds = bb
             self._paint_bounds = bb
-        except (MemoryError, Image.DecompressionBombError):
+        except (MemoryError, Image.DecompressionBombError, ValueError):
+            # Memory error if creating requires too much memory.
+            # DecompressionBomb if over 272 megapixels.
+            # ValueError if bounds are NaN.
             self._process_image_failed = True
         self.updated()
 
     @property
     def opaque_image(self):
         from PIL import Image
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/elem_line.py` & `meerk40t-0.8.3000/meerk40t/core/node/elem_polyline.py`

 * *Files 6% similar despite different names*

```diff
@@ -4,38 +4,39 @@
 from meerk40t.core.node.mixins import Stroked
 from meerk40t.core.node.node import Fillrule, Linecap, Linejoin, Node
 from meerk40t.svgelements import (
     SVG_ATTR_VECTOR_EFFECT,
     SVG_VALUE_NON_SCALING_STROKE,
     Matrix,
     Path,
-    Point,
-    SimpleLine,
+    Polygon,
+    Polyline,
 )
 
 
-class LineNode(Node, Stroked):
+class PolylineNode(Node, Stroked):
     """
-    LineNode is the bootstrapped node type for the 'elem line' type.
+    PolylineNode is the bootstrapped node type for the 'elem polyline' type.
     """
 
     def __init__(self, **kwargs):
         self.shape = None
         self.matrix = None
         self.fill = None
         self.stroke = None
         self.stroke_width = None
         self.stroke_scale = None
         self._stroke_zero = None
         self.linecap = Linecap.CAP_BUTT
         self.linejoin = Linejoin.JOIN_MITER
         self.fillrule = Fillrule.FILLRULE_EVENODD
-        super().__init__(type="elem line", **kwargs)
+
+        super().__init__(type="elem polyline", **kwargs)
         self._formatter = "{element_type} {id} {stroke}"
-        assert isinstance(self.shape, SimpleLine)
+        assert isinstance(self.shape, (Polyline, Polygon))
         if self.matrix is None:
             self.matrix = self.shape.transform
         if self.fill is None:
             self.fill = self.shape.fill
         if self.stroke is None:
             self.stroke = self.shape.stroke
         if self.stroke_width is None:
@@ -53,15 +54,15 @@
 
     def __copy__(self):
         nd = self.node_dict
         nd["shape"] = copy(self.shape)
         nd["matrix"] = copy(self.matrix)
         nd["fill"] = copy(self.fill)
         nd["stroke_width"] = copy(self.stroke_width)
-        return LineNode(**nd)
+        return PolylineNode(**nd)
 
     def __repr__(self):
         return f"{self.__class__.__name__}('{self.type}', {str(self.shape)}, {str(self._parent)})"
 
     def scaled(self, sx, sy, ox, oy):
         """
         This is a special case of the modified call, we are scaling
@@ -97,17 +98,19 @@
             self._bounds[3] + delta,
         )
         self._points_dirty = True
         self.notify_scaled(self, sx=sx, sy=sy, ox=ox, oy=oy)
 
     def bbox(self, transformed=True, with_stroke=False):
         self._sync_svg()
-        xmin, ymin, xmax, ymax = self.shape.bbox(
-            transformed=transformed, with_stroke=False
-        )
+        bounds = self.shape.bbox(transformed=transformed, with_stroke=False)
+        if bounds is None:
+            # degenerate paths can have no bounds.
+            return None
+        xmin, ymin, xmax, ymax = bounds
         if with_stroke:
             delta = float(self.implied_stroke_width) / 2.0
             return (
                 xmin - delta,
                 ymin - delta,
                 xmax + delta,
                 ymax + delta,
@@ -120,15 +123,15 @@
         self.matrix *= matrix
         self.stroke_scaled = False
         self._sync_svg()
         self.set_dirty_bounds()
 
     def default_map(self, default_map=None):
         default_map = super().default_map(default_map=default_map)
-        default_map["element_type"] = "Line"
+        default_map["element_type"] = "Polyline"
         default_map.update(self.__dict__)
         return default_map
 
     def drop(self, drag_node, modify=True):
         # Dragging element into element.
         if drag_node.type.startswith("elem"):
             if modify:
@@ -149,39 +152,46 @@
         # self._points.append([bounds[2], bounds[3], "bounds bottom_right"])
         # self._points.append([cx, cy, "bounds center_center"])
         # self._points.append([cx, bounds[1], "bounds top_center"])
         # self._points.append([cx, bounds[3], "bounds bottom_center"])
         # self._points.append([bounds[0], cy, "bounds center_left"])
         # self._points.append([bounds[2], cy, "bounds center_right"])
         obj = self.shape
-        p1 = Point(obj.x1, obj.y1)
-        p2 = Point(obj.x2, obj.y2)
-        p3 = Point(obj.x1 + obj.x2, obj.y1 + obj.y2)
+        lastpt = None
         if not obj.transform.is_identity():
-            p1 = obj.transform.point_in_matrix_space(p1)
-            p2 = obj.transform.point_in_matrix_space(p2)
-            p3 = obj.transform.point_in_matrix_space(p3)
-
-        self._points.append([p1.x, p1.y, "endpoint"])
-        self._points.append([p2.x, p2.y, "endpoint"])
-        self._points.append([p3.x, p3.y, "midpoint"])
+            points = list(map(obj.transform.point_in_matrix_space, obj.points))
+        else:
+            points = obj.points
+        maxidx = len(points) - 1
+        for idx, pt in enumerate(points):
+            if idx == 0:
+                self._points.append([pt.x, pt.y, "endpoint"])
+            elif idx == maxidx:
+                self._points.append([pt.x, pt.y, "endpoint"])
+            else:
+                self._points.append([pt.x, pt.y, "point"])
+            if idx > 0:
+                self._points.append(
+                    [0.5 * (pt.x + lastpt.x), 0.5 * (pt.y + lastpt.y), "midpoint"]
+                )
+            lastpt = pt
 
     def update_point(self, index, point):
         return False
 
     def add_point(self, point, index=None):
         return False
 
     def _sync_svg(self):
         self.shape.values[SVG_ATTR_VECTOR_EFFECT] = (
             SVG_VALUE_NON_SCALING_STROKE if not self.stroke_scale else ""
         )
-        self.shape.stroke = self.stroke
         self.shape.transform = self.matrix
         self.shape.stroke_width = self.stroke_width
+        self.shape.stroke = self.stroke
         try:
             del self.shape.values["viewport_transform"]
             # If we had transforming viewport that is no longer relevant
         except KeyError:
             pass
 
     def as_path(self):
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/elem_path.py` & `meerk40t-0.8.3000/meerk40t/core/node/elem_path.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/elem_point.py` & `meerk40t-0.8.3000/meerk40t/core/node/elem_point.py`

 * *Files 7% similar despite different names*

```diff
@@ -34,14 +34,16 @@
         if self.point is None:
             x = float(self.x)
             y = float(self.y)
             self.matrix.pre_translate(x, y)
             self.point = Point(0, 0)
 
     def preprocess(self, context, matrix, plan):
+        if self.point is None:
+            self.validate()
         self.matrix *= matrix
         self.set_dirty_bounds()
         if not self.matrix.is_identity():
             self.point = matrix.point_in_matrix_space(self.point)
             self.matrix.reset()
 
     def bbox(self, transformed=True, with_stroke=False):
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/elem_polyline.py` & `meerk40t-0.8.3000/meerk40t/core/node/elem_rect.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,42 +1,41 @@
 from copy import copy
 from math import sqrt
 
 from meerk40t.core.node.mixins import Stroked
-from meerk40t.core.node.node import Fillrule, Linecap, Linejoin, Node
+from meerk40t.core.node.node import Fillrule, Linejoin, Node
 from meerk40t.svgelements import (
     SVG_ATTR_VECTOR_EFFECT,
     SVG_VALUE_NON_SCALING_STROKE,
     Matrix,
     Path,
-    Polygon,
-    Polyline,
+    Point,
+    Rect,
 )
 
 
-class PolylineNode(Node, Stroked):
+class RectNode(Node, Stroked):
     """
-    PolylineNode is the bootstrapped node type for the 'elem polyline' type.
+    RectNode is the bootstrapped node type for the 'elem rect' type.
     """
 
     def __init__(self, **kwargs):
         self.shape = None
         self.matrix = None
         self.fill = None
         self.stroke = None
         self.stroke_width = None
         self.stroke_scale = None
         self._stroke_zero = None
-        self.linecap = Linecap.CAP_BUTT
         self.linejoin = Linejoin.JOIN_MITER
         self.fillrule = Fillrule.FILLRULE_EVENODD
-
-        super().__init__(type="elem polyline", **kwargs)
+        super().__init__(type="elem rect", **kwargs)
         self._formatter = "{element_type} {id} {stroke}"
-        assert isinstance(self.shape, (Polyline, Polygon))
+        assert isinstance(self.shape, Rect)
+
         if self.matrix is None:
             self.matrix = self.shape.transform
         if self.fill is None:
             self.fill = self.shape.fill
         if self.stroke is None:
             self.stroke = self.shape.stroke
         if self.stroke_width is None:
@@ -48,24 +47,24 @@
             )
         if self._stroke_zero is None:
             # This defines the stroke-width zero point scale
             self.stroke_width_zero()
 
         self.set_dirty_bounds()
 
+    def __repr__(self):
+        return f"{self.__class__.__name__}('{self.type}', {str(self.shape)}, {str(self._parent)})"
+
     def __copy__(self):
         nd = self.node_dict
         nd["shape"] = copy(self.shape)
         nd["matrix"] = copy(self.matrix)
         nd["fill"] = copy(self.fill)
         nd["stroke_width"] = copy(self.stroke_width)
-        return PolylineNode(**nd)
-
-    def __repr__(self):
-        return f"{self.__class__.__name__}('{self.type}', {str(self.shape)}, {str(self._parent)})"
+        return RectNode(**nd)
 
     def scaled(self, sx, sy, ox, oy):
         """
         This is a special case of the modified call, we are scaling
         the node without fundamentally altering it's properties
         """
 
@@ -98,17 +97,19 @@
             self._bounds[3] + delta,
         )
         self._points_dirty = True
         self.notify_scaled(self, sx=sx, sy=sy, ox=ox, oy=oy)
 
     def bbox(self, transformed=True, with_stroke=False):
         self._sync_svg()
-        xmin, ymin, xmax, ymax = self.shape.bbox(
-            transformed=transformed, with_stroke=False
-        )
+        bounds = self.shape.bbox(transformed=transformed, with_stroke=False)
+        if bounds is None:
+            # degenerate paths can have no bounds.
+            return None
+        xmin, ymin, xmax, ymax = bounds
         if with_stroke:
             delta = float(self.implied_stroke_width) / 2.0
             return (
                 xmin - delta,
                 ymin - delta,
                 xmax + delta,
                 ymax + delta,
@@ -121,15 +122,15 @@
         self.matrix *= matrix
         self.stroke_scaled = False
         self._sync_svg()
         self.set_dirty_bounds()
 
     def default_map(self, default_map=None):
         default_map = super().default_map(default_map=default_map)
-        default_map["element_type"] = "Polyline"
+        default_map["element_type"] = "Rect"
         default_map.update(self.__dict__)
         return default_map
 
     def drop(self, drag_node, modify=True):
         # Dragging element into element.
         if drag_node.type.startswith("elem"):
             if modify:
@@ -150,32 +151,29 @@
         # self._points.append([bounds[2], bounds[3], "bounds bottom_right"])
         # self._points.append([cx, cy, "bounds center_center"])
         # self._points.append([cx, bounds[1], "bounds top_center"])
         # self._points.append([cx, bounds[3], "bounds bottom_center"])
         # self._points.append([bounds[0], cy, "bounds center_left"])
         # self._points.append([bounds[2], cy, "bounds center_right"])
         obj = self.shape
-        lastpt = None
+        npoints = [
+            Point(obj.x, obj.y),
+            Point(obj.x + obj.width, obj.y),
+            Point(obj.x + obj.width, obj.y + obj.height),
+            Point(obj.x, obj.y + obj.height),
+        ]
         if not obj.transform.is_identity():
-            points = list(map(obj.transform.point_in_matrix_space, obj.points))
+            points = list(map(obj.transform.point_in_matrix_space, npoints))
+        else:
+            points = npoints
+        if not self.matrix.is_identity():
+            points2 = list(map(self.matrix.point_in_matrix_space, npoints))
         else:
-            points = obj.points
-        maxidx = len(points) - 1
-        for idx, pt in enumerate(points):
-            if idx == 0:
-                self._points.append([pt.x, pt.y, "endpoint"])
-            elif idx == maxidx:
-                self._points.append([pt.x, pt.y, "endpoint"])
-            else:
-                self._points.append([pt.x, pt.y, "point"])
-            if idx > 0:
-                self._points.append(
-                    [0.5 * (pt.x + lastpt.x), 0.5 * (pt.y + lastpt.y), "midpoint"]
-                )
-            lastpt = pt
+            points2 = npoints
+        self._points_dirty = False
 
     def update_point(self, index, point):
         return False
 
     def add_point(self, point, index=None):
         return False
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/elem_rect.py` & `meerk40t-0.8.3000/meerk40t/core/node/elem_ellipse.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,40 +1,41 @@
 from copy import copy
 from math import sqrt
 
 from meerk40t.core.node.mixins import Stroked
-from meerk40t.core.node.node import Fillrule, Linejoin, Node
+from meerk40t.core.node.node import Fillrule, Node
 from meerk40t.svgelements import (
     SVG_ATTR_VECTOR_EFFECT,
     SVG_VALUE_NON_SCALING_STROKE,
+    Circle,
+    Ellipse,
     Matrix,
     Path,
     Point,
-    Rect,
 )
 
 
-class RectNode(Node, Stroked):
+class EllipseNode(Node, Stroked):
     """
-    RectNode is the bootstrapped node type for the 'elem rect' type.
+    EllipseNode is the bootstrapped node type for the 'elem ellipse' type.
     """
 
     def __init__(self, **kwargs):
         self.shape = None
         self.matrix = None
         self.fill = None
         self.stroke = None
         self.stroke_width = None
         self.stroke_scale = None
         self._stroke_zero = None
-        self.linejoin = Linejoin.JOIN_MITER
         self.fillrule = Fillrule.FILLRULE_EVENODD
-        super().__init__(type="elem rect", **kwargs)
-        self._formatter = "{element_type} {id} {stroke}"
-        assert isinstance(self.shape, Rect)
+
+        super().__init__(type="elem ellipse", **kwargs)
+        self.__formatter = "{element_type} {id} {stroke}"
+        assert isinstance(self.shape, (Ellipse, Circle))
 
         if self.matrix is None:
             self.matrix = self.shape.transform
         if self.fill is None:
             self.fill = self.shape.fill
         if self.stroke is None:
             self.stroke = self.shape.stroke
@@ -56,15 +57,15 @@
 
     def __copy__(self):
         nd = self.node_dict
         nd["shape"] = copy(self.shape)
         nd["matrix"] = copy(self.matrix)
         nd["fill"] = copy(self.fill)
         nd["stroke_width"] = copy(self.stroke_width)
-        return RectNode(**nd)
+        return EllipseNode(**nd)
 
     def scaled(self, sx, sy, ox, oy):
         """
         This is a special case of the modified call, we are scaling
         the node without fundamentally altering it's properties
         """
 
@@ -92,22 +93,23 @@
         delta = float(self.implied_stroke_width) / 2.0
         self._paint_bounds = (
             self._bounds[0] - delta,
             self._bounds[1] - delta,
             self._bounds[2] + delta,
             self._bounds[3] + delta,
         )
-        self._points_dirty = True
         self.notify_scaled(self, sx=sx, sy=sy, ox=ox, oy=oy)
 
     def bbox(self, transformed=True, with_stroke=False):
         self._sync_svg()
-        xmin, ymin, xmax, ymax = self.shape.bbox(
-            transformed=transformed, with_stroke=False
-        )
+        bounds = self.shape.bbox(transformed=transformed, with_stroke=False)
+        if bounds is None:
+            # degenerate paths can have no bounds.
+            return None
+        xmin, ymin, xmax, ymax = bounds
         if with_stroke:
             delta = float(self.implied_stroke_width) / 2.0
             return (
                 xmin - delta,
                 ymin - delta,
                 xmax + delta,
                 ymax + delta,
@@ -120,15 +122,15 @@
         self.matrix *= matrix
         self.stroke_scaled = False
         self._sync_svg()
         self.set_dirty_bounds()
 
     def default_map(self, default_map=None):
         default_map = super().default_map(default_map=default_map)
-        default_map["element_type"] = "Rect"
+        default_map["element_type"] = "Ellipse"
         default_map.update(self.__dict__)
         return default_map
 
     def drop(self, drag_node, modify=True):
         # Dragging element into element.
         if drag_node.type.startswith("elem"):
             if modify:
@@ -150,28 +152,28 @@
         # self._points.append([cx, cy, "bounds center_center"])
         # self._points.append([cx, bounds[1], "bounds top_center"])
         # self._points.append([cx, bounds[3], "bounds bottom_center"])
         # self._points.append([bounds[0], cy, "bounds center_left"])
         # self._points.append([bounds[2], cy, "bounds center_right"])
         obj = self.shape
         npoints = [
-            Point(obj.x, obj.y),
-            Point(obj.x + obj.width, obj.y),
-            Point(obj.x + obj.width, obj.y + obj.height),
-            Point(obj.x, obj.y + obj.height),
+            Point(obj.cx - obj.rx, obj.cy),
+            Point(obj.cx, obj.cy - obj.ry),
+            Point(obj.cx + obj.rx, obj.cy),
+            Point(obj.cx, obj.cy + obj.ry),
         ]
+        p1 = Point(obj.cx, obj.cy)
         if not obj.transform.is_identity():
             points = list(map(obj.transform.point_in_matrix_space, npoints))
+            p1 = obj.transform.point_in_matrix_space(p1)
         else:
             points = npoints
-        if not self.matrix.is_identity():
-            points2 = list(map(self.matrix.point_in_matrix_space, npoints))
-        else:
-            points2 = npoints
-        self._points_dirty = False
+        for pt in points:
+            self._points.append([pt.x, pt.y, "point"])
+        self._points.append([p1.x, p1.y, "bounds center_center"])
 
     def update_point(self, index, point):
         return False
 
     def add_point(self, point, index=None):
         return False
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/elem_text.py` & `meerk40t-0.8.3000/meerk40t/core/node/elem_text.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/filenode.py` & `meerk40t-0.8.3000/meerk40t/core/node/filenode.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/groupnode.py` & `meerk40t-0.8.3000/meerk40t/core/node/groupnode.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/lasercodenode.py` & `meerk40t-0.8.3000/meerk40t/core/node/lasercodenode.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-from meerk40t.core.element_types import op_nodes
+from meerk40t.core.elements.element_types import op_nodes
 from meerk40t.core.node.node import Node
 
 
 class LaserCodeNode(Node):
     """
     LaserCode is basic command operations. It contains nothing except a list of commands to be executed.
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/layernode.py` & `meerk40t-0.8.3000/meerk40t/core/node/layernode.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/mixins.py` & `meerk40t-0.8.3000/meerk40t/core/node/mixins.py`

 * *Files 20% similar despite different names*

```diff
@@ -28,17 +28,24 @@
     def implied_stroke_width(self):
         """
         The implied stroke width is stroke_width if not scaled or the scaled stroke_width if scaled.
 
         @return:
         """
         if self.stroke_scale:
-            return self.stroke_width * self.stroke_factor
+            factor = self.stroke_factor
         else:
-            return self.stroke_width
+            factor = 1
+        if hasattr(self, "stroke"):
+            # print (f"Have stroke {self.stroke}, {type(self.stroke).__name__}")
+            if self.stroke is None or self.stroke.argb is None:
+                # print ("set to zero")
+                factor = 0
+
+        return self.stroke_width * factor
 
     @property
     def stroke_factor(self):
         """
         The stroke factor is the ratio of the new to old stroke-width scale.
 
         @return:
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/node.py` & `meerk40t-0.8.3000/meerk40t/core/node/node.py`

 * *Files 0% similar despite different names*

```diff
@@ -338,16 +338,20 @@
 
     @property
     def paint_bounds(self):
         # Make sure that bounds is valid
         if not self._paint_bounds_dirty:
             return self._paint_bounds
 
+        flag = True
+        if hasattr(self, "stroke"):
+            if self.stroke is None or self.stroke.argb is None:
+                flag = False
         try:
-            self._paint_bounds = self.bbox(with_stroke=True)
+            self._paint_bounds = self.bbox(with_stroke=flag)
         except AttributeError:
             self._paint_bounds = None
 
         if self._children:
             self._paint_bounds = Node.union_bounds(
                 self._children, bounds=self._paint_bounds, attr="paint_bounds"
             )
@@ -1125,15 +1129,15 @@
             xmin = float("inf")
             ymin = float("inf")
             xmax = -xmin
             ymax = -ymin
         else:
             xmin, ymin, xmax, ymax = bounds
         for e in nodes:
-            box = getattr(e, attr)
+            box = getattr(e, attr, None)
             if box is None:
                 continue
             if box[0] < xmin:
                 xmin = box[0]
             if box[2] > xmax:
                 xmax = box[2]
             if box[1] < ymin:
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/nutils.py` & `meerk40t-0.8.3000/meerk40t/core/node/nutils.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/op_cut.py` & `meerk40t-0.8.3000/meerk40t/core/node/op_cut.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,11 +1,11 @@
 from copy import copy
 from math import isnan
 
-from meerk40t.core.element_types import *
+from meerk40t.core.elements.element_types import *
 from meerk40t.core.node.node import Node
 from meerk40t.core.node.nutils import path_to_cutobjects
 from meerk40t.core.parameters import Parameters
 from meerk40t.core.units import UNITS_PER_MM
 from meerk40t.svgelements import Color, Path, Polygon
 
 
@@ -294,15 +294,20 @@
                 path.approximate_arcs_with_cubics()
             elif node.type not in self._allowed_elements_dnd:
                 # These aren't valid.
                 continue
             else:
                 path = abs(Path(node.shape))
                 path.approximate_arcs_with_cubics()
+            try:
+                stroke = node.stroke
+            except AttributeError:
+                # ImageNode does not have a stroke.
+                stroke = None
             yield from path_to_cutobjects(
                 path,
                 settings=settings,
                 closed_distance=closed_distance,
                 passes=passes,
                 original_op=self.type,
-                color=node.stroke,
+                color=stroke,
             )
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/op_dots.py` & `meerk40t-0.8.3000/meerk40t/core/node/op_dots.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 from copy import copy
 from math import isnan
 
 from meerk40t.core.cutcode.dwellcut import DwellCut
-from meerk40t.core.element_types import *
+from meerk40t.core.elements.element_types import *
 from meerk40t.core.node.node import Node
 from meerk40t.core.parameters import Parameters
 from meerk40t.core.units import UNITS_PER_MM
 from meerk40t.svgelements import Color
 
 
 class DotsOpNode(Node, Parameters):
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/op_engrave.py` & `meerk40t-0.8.3000/meerk40t/core/node/op_engrave.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,11 +1,11 @@
 from copy import copy
 from math import isnan
 
-from meerk40t.core.element_types import *
+from meerk40t.core.elements.element_types import *
 from meerk40t.core.node.node import Node
 from meerk40t.core.node.nutils import path_to_cutobjects
 from meerk40t.core.parameters import Parameters
 from meerk40t.core.units import UNITS_PER_MM
 from meerk40t.svgelements import Color, Path, Polygon
 
 
@@ -292,15 +292,20 @@
                 path.approximate_arcs_with_cubics()
             elif node.type not in self._allowed_elements_dnd:
                 # These aren't valid.
                 continue
             else:
                 path = abs(Path(node.shape))
                 path.approximate_arcs_with_cubics()
+            try:
+                stroke = node.stroke
+            except AttributeError:
+                # ImageNode does not have a stroke.
+                stroke = None
             yield from path_to_cutobjects(
                 path,
                 settings=settings,
                 closed_distance=closed_distance,
                 passes=passes,
                 original_op=self.type,
-                color=node.stroke,
+                color=stroke,
             )
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/op_hatch.py` & `meerk40t-0.8.3000/meerk40t/core/node/op_hatch.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 from copy import copy
 from math import isnan
 
 from meerk40t.core.cutcode.plotcut import PlotCut
-from meerk40t.core.element_types import *
+from meerk40t.core.elements.element_types import *
 from meerk40t.core.node.elem_polyline import PolylineNode
 from meerk40t.core.node.node import Node
 from meerk40t.core.parameters import Parameters
 from meerk40t.core.units import UNITS_PER_MM
 from meerk40t.svgelements import Color, Path
 
 
@@ -312,15 +312,15 @@
                     points = [sp.point(i / 100.0, error=1e-4) for i in range(101)]
                     outlines.append(points)
             self.remove_all_children()
             fills = list(context.match("hatch", suffix=True))
             penbox_pass = self.settings.get("penbox_pass")
             if penbox_pass is not None:
                 try:
-                    penbox_pass = context.elements.penbox[penbox_pass]
+                    penbox_pass = context.penbox.pens[penbox_pass]
                 except KeyError:
                     penbox_pass = None
             hatch_cache = dict()
             for p in range(self.implicit_passes):
                 chain_settings = dict(settings)
                 if "type" in chain_settings:
                     del chain_settings["type"]
@@ -373,11 +373,11 @@
         for node in self.children:
             if node.type != "elem polyline":
                 continue
             settings = node.settings
             plot = PlotCut(settings=settings, color=node.stroke)
             for p in node.shape:
                 x, y = p
-                if plot:
+                if not plot:
                     plot.plot_init(int(round(x)), int(round(y)))
                 plot.plot_append(int(round(x)), int(round(y)), 1)
             yield plot
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/op_image.py` & `meerk40t-0.8.3000/meerk40t/core/node/op_image.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 from copy import copy
 from math import isnan
 
 from meerk40t.core.cutcode.rastercut import RasterCut
-from meerk40t.core.element_types import *
+from meerk40t.core.elements.element_types import *
 from meerk40t.core.node.node import Node
 from meerk40t.core.parameters import Parameters
 from meerk40t.core.units import MM_PER_INCH, UNITS_PER_INCH, Length
 from meerk40t.svgelements import Color, Path, Polygon
 
 
 class ImageOpNode(Node, Parameters):
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/op_raster.py` & `meerk40t-0.8.3000/meerk40t/core/node/op_raster.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,13 +1,13 @@
 from copy import copy
 from math import isnan
 
 from meerk40t.core.cutcode.rastercut import RasterCut
 from meerk40t.core.cutplan import CutPlanningFailedError
-from meerk40t.core.element_types import *
+from meerk40t.core.elements.element_types import *
 from meerk40t.core.node.elem_image import ImageNode
 from meerk40t.core.node.node import Node
 from meerk40t.core.parameters import Parameters
 from meerk40t.core.units import MM_PER_INCH, UNITS_PER_INCH, UNITS_PER_MM, Length
 from meerk40t.svgelements import Color, Matrix, Path, Polygon
 
 
@@ -230,15 +230,15 @@
                                     # Have classified but more classification might be needed
                                     feedback.append(attribute)
                     if result:
                         return True, self.stopop, feedback
                 else:  # empty ? Anything with either a solid fill or a plain white stroke goes
                     if self.valid_node_for_reference(node):
                         addit = False
-                        if node.type == "elem image":
+                        if node.type in ("elem image", "elem text"):
                             addit = True
                         if hasattr(node, "fill"):
                             if node.fill is not None and node.fill.argb is not None:
                                 # if matching_color(node.fill, Color("white")):
                                 #     addit = True
                                 # if matching_color(node.fill, Color("black")):
                                 #     addit = True
@@ -352,14 +352,16 @@
 
         def make_image():
             """
             Nested function to be added to commands and to call make_raster on the given elements.
             @return:
             """
             # Calculate raster steps from DPI device context
+            self.set_dirty_bounds()
+
             step_x, step_y = context.device.dpi_to_steps(self.dpi, matrix=matrix)
             bounds = self.paint_bounds
             img_mx = Matrix.scale(step_x, step_y)
             data = list(self.flat())
             reverse = context.elements.classify_reverse
             if reverse:
                 data = list(reversed(data))
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/refnode.py` & `meerk40t-0.8.3000/meerk40t/core/node/refnode.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/rootnode.py` & `meerk40t-0.8.3000/meerk40t/core/node/rootnode.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/util_console.py` & `meerk40t-0.8.3000/meerk40t/core/node/util_console.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-from meerk40t.core.element_types import *
+from meerk40t.core.elements.element_types import *
 from meerk40t.core.node.node import Node
 
 
 class ConsoleOperation(Node):
     """
     ConsoleOperation contains a console command (as a string) to be run.
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/util_goto.py` & `meerk40t-0.8.3000/meerk40t/core/node/util_goto.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 from meerk40t.core.cutcode.gotocut import GotoCut
-from meerk40t.core.element_types import *
+from meerk40t.core.elements.element_types import *
 from meerk40t.core.node.node import Node
 
 
 class GotoOperation(Node):
     """
     GotoOperation tells the controller to return to origin.
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/util_home.py` & `meerk40t-0.8.3000/meerk40t/core/node/util_home.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 from meerk40t.core.cutcode.homecut import HomeCut
-from meerk40t.core.element_types import *
+from meerk40t.core.elements.element_types import *
 from meerk40t.core.node.node import Node
 
 
 class HomeOperation(Node):
     """
     HomeOperation tells the controller to perform homing.
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/util_input.py` & `meerk40t-0.8.3000/meerk40t/core/node/util_input.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 from meerk40t.core.cutcode.inputcut import InputCut
-from meerk40t.core.element_types import *
+from meerk40t.core.elements.element_types import *
 from meerk40t.core.node.node import Node
 
 
 class InputOperation(Node):
     """
     InputOperation sets GPIO values.
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/util_origin.py` & `meerk40t-0.8.3000/meerk40t/core/node/util_origin.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 from meerk40t.core.cutcode.setorigincut import SetOriginCut
-from meerk40t.core.element_types import *
+from meerk40t.core.elements.element_types import *
 from meerk40t.core.node.node import Node
 
 
 class SetOriginOperation(Node):
     """
     SetOriginOperation tells the controller to return to origin.
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/util_output.py` & `meerk40t-0.8.3000/meerk40t/core/node/util_output.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 from meerk40t.core.cutcode.outputcut import OutputCut
-from meerk40t.core.element_types import *
+from meerk40t.core.elements.element_types import *
 from meerk40t.core.node.node import Node
 
 
 class OutputOperation(Node):
     """
     OutputOperation sets GPIO values.
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/node/util_wait.py` & `meerk40t-0.8.3000/meerk40t/core/node/util_wait.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 from meerk40t.core.cutcode.waitcut import WaitCut
-from meerk40t.core.element_types import *
+from meerk40t.core.elements.element_types import *
 from meerk40t.core.node.node import Node
 
 
 class WaitOperation(Node):
     """
     WaitOperation tells the controller to wait for a specified period of time.
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/parameters.py` & `meerk40t-0.8.3000/meerk40t/core/parameters.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/core/planner.py` & `meerk40t-0.8.3000/meerk40t/core/planner.py`

 * *Files 17% similar despite different names*

```diff
@@ -14,14 +14,20 @@
 from .node.util_goto import GotoOperation
 from .node.util_home import HomeOperation
 from .node.util_origin import SetOriginOperation
 from .node.util_output import OutputOperation
 from .node.util_wait import WaitOperation
 from .units import Length
 
+"""
+The planner module provides cut planning services. This provides a method of going from operations + elements into
+cutcode which is then put inside a laserjob and sent to a spooler. Most of these operations are called on the
+individual CutPlan objects.
+"""
+
 
 def plugin(kernel, lifecycle=None):
     if lifecycle == "register":
         kernel.add_service("planner", Planner(kernel))
 
     elif lifecycle == "boot":
         context = kernel.get_context("planner")  # specifically get this planner context
@@ -326,177 +332,26 @@
                 for i, cmd_name in enumerate(cutplan.commands):
                     channel(f"{i}: {cmd_name}")
                 channel(_("----------"))
 
             return "plan", cutplan
 
         @self.console_command(
-            "copy-selected",
-            help=_("plan<?> copy-selected"),
-            input_type="plan",
-            output_type="plan",
-        )
-        def plan_copy_selected(command, channel, _, data_type=None, data=None, **kwgs):
-            def init_settings():
-                for prefix in ("prepend", "append"):
-                    str_count = f"{prefix}_op_count"
-                    self.device.setting(int, str_count, 0)
-                    value = getattr(self.device, str_count, 0)
-                    if value > 0:
-                        for idx in range(value):
-                            attr1 = f"{prefix}_op_{idx:02d}"
-                            attr2 = f"{prefix}_op_param_{idx:02d}"
-                            self.device.setting(str, attr1, "")
-                            self.device.setting(str, attr2, "")
-
-            def add_ops(is_prepend):
-                # Do we have any default actions to include first?
-                if is_prepend:
-                    prefix = "prepend"
-                else:
-                    prefix = "append"
-                try:
-                    if is_prepend:
-                        count = self.device.prepend_op_count
-                    else:
-                        count = self.device.append_op_count
-                except AttributeError:
-                    count = 0
-                idx = 0
-                while idx <= count - 1:
-                    addop = None
-                    attr1 = f"{prefix}_op_{idx:02d}"
-                    attr2 = f"{prefix}_op_param_{idx:02d}"
-                    if hasattr(self.device, attr1):
-                        optype = getattr(self.device, attr1, None)
-                        opparam = getattr(self.device, attr2, None)
-                        if optype is not None:
-                            if optype == "util console":
-                                addop = ConsoleOperation(command=opparam)
-                            elif optype == "util home":
-                                addop = HomeOperation()
-                            elif optype == "util output":
-                                if opparam is not None:
-                                    params = opparam.split(",")
-                                    mask = 0
-                                    setvalue = 0
-                                    if len(params) > 0:
-                                        try:
-                                            mask = int(params[0])
-                                        except ValueError:
-                                            mask = 0
-                                    if len(params) > 1:
-                                        try:
-                                            setvalue = int(params[1])
-                                        except ValueError:
-                                            setvalue = 0
-                                    if mask != 0 or setvalue != 0:
-                                        addop = OutputOperation(mask, setvalue)
-                            elif optype == "util goto":
-                                if opparam is not None:
-                                    params = opparam.split(",")
-                                    x = 0
-                                    y = 0
-                                    if len(params) > 0:
-                                        try:
-                                            x = float(Length(params[0]))
-                                        except ValueError:
-                                            x = 0
-                                    if len(params) > 1:
-                                        try:
-                                            y = float(Length(params[1]))
-                                        except ValueError:
-                                            y = 0
-                                    addop = GotoOperation(x=x, y=y)
-                            elif optype == "util origin":
-                                if opparam is not None and opparam != "":
-                                    params = opparam.split(",")
-                                    x = 0
-                                    y = 0
-                                    if len(params) > 0:
-                                        try:
-                                            x = float(Length(params[0]))
-                                        except ValueError:
-                                            x = 0
-                                    if len(params) > 1:
-                                        try:
-                                            y = float(Length(params[1]))
-                                        except ValueError:
-                                            y = 0
-                                    addop = SetOriginOperation(x=x, y=y)
-                                else:
-                                    addop = SetOriginOperation(x=None, y=None)
-                            elif optype == "util wait":
-                                if opparam is not None:
-                                    try:
-                                        opparam = float(opparam)
-                                    except ValueError:
-                                        opparam = None
-                                if opparam is not None:
-                                    addop = WaitOperation(wait=opparam)
-                    if addop is not None:
-                        try:
-                            if not addop.output:
-                                continue
-                        except AttributeError:
-                            pass
-                        try:
-                            if len(addop) == 0:
-                                continue
-                        except TypeError:
-                            pass
-                        if addop.type == "cutcode":
-                            # CutNodes are denuded into normal objects.
-                            addop = addop.cutcode
-                        copy_c = copy(addop)
-                        try:
-                            copy_c.copy_children_as_real(addop)
-                        except AttributeError:
-                            pass
-                        data.plan.append(copy_c)
-
-                    idx += 1
-
-            init_settings()
-            # Add default start ops
-            add_ops(True)
-
-            for c in self.elements.ops(emphasized=True):
-                if c.type == "cutcode":
-                    # CutNodes are denuded into normal objects.
-                    c = c.cutcode
-                elif c.type == "blob":
-                    # BlobNodes are denuded into normal objects.
-                    c = c.blob
-                copy_c = copy(c)
-                try:
-                    copy_c.copy_children_as_real(c)
-                except AttributeError:
-                    pass
-                try:
-                    if not copy_c.output:
-                        copy_c.output = True
-                except AttributeError:
-                    pass
-                data.plan.append(copy_c)
-
-            # Add default start ops
-            add_ops(False)
-
-            channel(_("Copied Operations."))
-            self.signal("plan", data.name, 1)
-            return data_type, data
-
-        @self.console_command(
-            "copy",
-            help=_("plan<?> copy"),
+            ("copy", "copy-selected"),
+            help=_("plan(-selected)<?> copy"),
             input_type="plan",
             output_type="plan",
         )
         def plan_copy(command, channel, _, data_type=None, data=None, **kwgs):
+            operations = data  # unused.
+            if command == "copy-selected":
+                operations = list(self.elements.ops(emphasized=True))
+            else:
+                operations = list(self.elements.ops())
+
             def init_settings():
                 for prefix in ("prepend", "append"):
                     str_count = f"{prefix}_op_count"
                     self.device.setting(int, str_count, 0)
                     value = getattr(self.device, str_count, 0)
                     if value > 0:
                         for idx in range(value):
@@ -610,58 +465,61 @@
                         except AttributeError:
                             pass
                         data.plan.append(copy_c)
 
                     idx += 1
 
             init_settings()
-            operations = self.elements.get(type="branch ops")
 
             # Add default start ops
             add_ops(True)
-            for c in operations.flat(
-                types=(
-                    "op cut",
-                    "op raster",
-                    "op image",
-                    "op engrave",
-                    "op dots",
-                    "op hatch",
-                    "cutcode",
-                    "util console",
-                    "util wait",
-                    "util home",
-                    "util goto",
-                    "util origin",
-                    "util input",
-                    "util output",
-                    "lasercode",
-                    "blob",
-                ),
-                depth=1,
-            ):
+            # types = (
+            #     "op cut",
+            #     "op raster",
+            #     "op image",
+            #     "op engrave",
+            #     "op dots",
+            #     "op hatch",
+            #     "cutcode",
+            #     "util console",
+            #     "util wait",
+            #     "util home",
+            #     "util goto",
+            #     "util origin",
+            #     "util input",
+            #     "util output",
+            #     "place point"
+            #     "lasercode",
+            #     "blob",
+            # )
+            for c in operations:
                 try:
                     if not c.output:
                         continue
                 except AttributeError:
                     pass
-                try:
-                    if c.type.startswith("op") and len(c.children) == 0:
-                        continue
-                except TypeError:
-                    pass
+                if not hasattr(c, "type") or c.type is None:
+                    # Node must be a type of node.
+                    continue
+                if c.type.startswith("op ") and len(c.children) == 0:
+                    # We don't need empty operations.
+                    continue
                 if c.type == "cutcode":
                     # CutNodes are denuded into normal objects.
                     c = c.cutcode
+
+                # Make copy of node.
                 copy_c = copy(c)
                 try:
+                    # Make copy of real (non-referenced) children if that is permitted.
                     copy_c.copy_children_as_real(c)
                 except AttributeError:
                     pass
                 data.plan.append(copy_c)
+
             # Add default trailing ops
             add_ops(False)
             channel(_("Copied Operations."))
             self.signal("plan", data.name, 1)
             return data_type, data
 
         @self.console_option(
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/plotplanner.py` & `meerk40t-0.8.3000/meerk40t/core/plotplanner.py`

 * *Files 1% similar despite different names*

```diff
@@ -10,16 +10,15 @@
     PLOT_RIGHT_LOWER,
     PLOT_SETTING,
     PLOT_START,
 )
 from .parameters import Parameters
 
 """
-
-The PlotPlanner simplifies the plotting and pulsing  modifications routines. These are buffered with plottable elements.
+The PlotPlanner simplifies the plotting and pulsing modifications routines. These are buffered with plottable elements.
 These can be submitted as destination graphics commands, or by submitting a plot routine. Which may yield either 2 or
 3 value coordinates. These are x, y, and on. Where on is a number between 0 and 1 which designates the on-value. In the
 graphics commands the move is given a 0 and all other plots are given a 1. All graphics commands take an optional
 on-value. If PPI is enabled, fractional on values are made non-fractional by carrying forward the value of on as a
 factor applied of the total value.
 
 All plots are queued and processed in order. This queueing scheme is threadsafe, and should permit one thread reading
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/spoolers.py` & `meerk40t-0.8.3000/meerk40t/core/spoolers.py`

 * *Files 13% similar despite different names*

```diff
@@ -2,14 +2,22 @@
 from math import isinf
 from threading import Condition
 
 from meerk40t.core.laserjob import LaserJob
 from meerk40t.core.units import Length
 from meerk40t.kernel import CommandSyntaxError
 
+"""
+This module defines a set of commands that usually send a single easy command to the spooler. Basic jogging, home, 
+unlock rail commands. And it provides the the spooler class which should be provided by each driver.
+
+Spoolers process different jobs in order. A spooler job can be anything, but usually is a LaserJob which is a simple
+list of commands.
+"""
+
 
 def plugin(kernel, lifecycle):
     if lifecycle == "register":
         _ = kernel.translation
 
         @kernel.console_command(
             "spool",
@@ -33,15 +41,17 @@
                 e = elements.op_branch
 
                 if e.loop_continuous:
                     loops = float("inf")
                 else:
                     if e.loop_enabled:
                         loops = e.loop_n
-                spooler.laserjob(data.plan, loops=loops, label=label)
+                spooler.laserjob(
+                    data.plan, loops=loops, label=label, outline=data.outline
+                )
                 channel(_("Spooled Plan."))
                 kernel.root.signal("plan", data.name, 6)
 
             if remainder is None:
                 channel(_("----------"))
                 channel(_("Spoolers:"))
                 for d, d_name in enumerate(device.match("device", suffix=True)):
@@ -367,35 +377,91 @@
 
             spooler.laserjob(
                 list(home_dot_test()), label=f"Dot and Home Test", helper=True
             )
             return "spooler", spooler
 
 
-class Spooler:
+class SpoolerJob:
     """
-    Spoolers store spoolable events in a two synchronous queue, and a single idle job that
-    will be executed in a loop, if the synchronous queues are empty. The two queues are the
-    realtime and the regular queue.
-
-    Spooler should be registered as a service_delegate of the device service running the driver
-    to process data.
-
-    Spoolers have threads that process and run each set of commands. Ultimately all commands are
-    executed against the given driver. So if the command within the spooled element is "unicorn"
-    then driver.unicorn() is called with the given arguments. This permits arbitrary execution of
-    specifically spooled elements in the correct sequence.
-
-    The two queues are the realtime and the regular queue. The realtime queue tries to execute
-    particular events as soon as possible. And will execute even if there is a hold on the current
-    work.
+    Example of Spooler Job.
 
-    When the queues are empty the idle job is repeatedly executed in a loop. If there is no idle job
-    then the spooler is inactive.
+    The primary methodology of a spoolerjob is that it has an `execute` function that takes the driver as an argument
+    it should then perform driver-like commands on the given driver to perform whatever actions the job should
+    execute.
 
+    The `priority` attribute is required.
+
+    The job should be permitted to `stop()` and respond to `is_running()`, and other checks as to elapsed_time(),
+    estimate_time(), and status.
+    """
+
+    def __init__(
+        self,
+        service,
+    ):
+        self.stopped = False
+        self.service = service
+        self.runtime = 0
+        self.priority = 0
+
+    @property
+    def status(self):
+        """
+        Status is simply a status as to the job. This will be relayed by things that check the job status of jobs
+        in the spooler.
+
+        @return:
+        """
+        if self.is_running:
+            return "Running"
+        else:
+            return "Queued"
+
+    def execute(self, driver):
+        """
+        This is the primary method of the SpoolerJob. In this example we call the "home()" function.
+        @param driver:
+        @return:
+        """
+        try:
+            driver.home()
+        except AttributeError:
+            pass
+
+        return True
+
+    def stop(self):
+        self.stopped = True
+
+    def is_running(self):
+        return not self.stopped
+
+    def elapsed_time(self):
+        """
+        How long is this job already running...
+        """
+        result = 0
+        return result
+
+    def estimate_time(self):
+        return 0
+
+
+class Spooler:
+    """
+    Spoolers are threaded job processors. A series of jobs is added to the spooler and these jobs are
+    processed in order. The driver is checked for any holds it may have preventing new commands from being
+    executed. If that isn't the case, the highest priority job is executed by calling the job's required
+    `execute()` function passing the relevant driver as the one variable. The job itself is agnostic, and will
+    execute whatever it wants calling the driver-like functions that may or may not exist on the driver.
+
+    If execute() returns true then it is fully executed and will be removed. Otherwise it will be repeatedly
+    called until whatever work it is doing is finished. This also means the driver itself is checked for holds
+    (usually pausing or busy) each cycle.
     """
 
     def __init__(self, context, driver=None, **kwargs):
         self.context = context
         self.driver = driver
         self._current = None
 
@@ -465,19 +531,19 @@
             )
             self._thread.stop = clear_thread
 
     def run(self):
         """
         Run thread for the spooler.
 
-        Process the real time queue.
-        Hold work queue if driver requires a hold
-        Process work queue.
-        Hold idle if driver requires idle to be held.
-        Process idle work
+        The thread runs while the spooler is not shutdown. This executes in the spooler thread. It waits, while
+        the queue is empty and is notified when items are added to the queue. Each job in the spooler is called
+        with execute(). If the function returns True, the job is finished and removed. We then move on to the next
+        spooler item. If execute() returns False the job is not finished and will be reattempted. Each spooler
+        cycle checks the priority and whether there's a wait/hold for jobs at that priority level.
 
         @return:
         """
         while not self._shutdown:
             if self.context.kernel.is_shutdown:
                 return  # Kernel shutdown spooler threads should die off.
             with self._lock:
@@ -489,14 +555,19 @@
                     continue
             priority = program.priority
 
             # Check if the driver holds work at this priority level.
             if self.driver.hold_work(priority):
                 time.sleep(0.01)
                 continue
+            if program != self._current:
+                # A different job is loaded. If it has a job_start, we call that.
+                if hasattr(self.driver, "job_start"):
+                    function = getattr(self.driver, "job_start")
+                    function(program)
             self._current = program
             try:
                 fully_executed = program.execute(self.driver)
             except ConnectionAbortedError:
                 # Driver could no longer connect to where it was told to send the data.
                 return
             except ConnectionRefusedError:
@@ -506,65 +577,84 @@
                 with self._lock:
                     self._lock.wait()
                 continue
             if fully_executed:
                 # all work finished
                 self.remove(program)
 
+                # If we finished this work we call job_finished.
+                if hasattr(self.driver, "job_finish"):
+                    function = getattr(self.driver, "job_finish")
+                    function(program)
+
     @property
     def is_idle(self):
         return len(self._queue) == 0 or self._queue[0].priority < 0
 
     @property
     def current(self):
         return self._current
 
     @property
     def queue(self):
         return self._queue
 
-    def laserjob(self, job, priority=0, loops=1, label=None, helper=False):
+    def laserjob(
+        self, job, priority=0, loops=1, label=None, helper=False, outline=None
+    ):
         """
         send a wrapped laser job to the spooler.
         """
         if label is None:
             label = f"{self.__class__.__name__}:{len(job)} items"
         # label = str(job)
         ljob = LaserJob(
-            label, list(job), driver=self.driver, priority=priority, loops=loops
+            label,
+            list(job),
+            driver=self.driver,
+            priority=priority,
+            loops=loops,
+            outline=outline,
         )
         ljob.helper = helper
         ljob.uid = self.context.logging.uid("job")
         with self._lock:
             self._stop_lower_priority_running_jobs(priority)
             self._queue.append(ljob)
             self._queue.sort(key=lambda e: e.priority, reverse=True)
             self._lock.notify()
         self.context.signal("spooler;queue", len(self._queue))
 
-    def command(self, *job, priority=0, helper=True):
-        ljob = LaserJob(str(job), [job], driver=self.driver, priority=priority)
+    def command(self, *job, priority=0, helper=True, outline=None):
+        ljob = LaserJob(
+            str(job), [job], driver=self.driver, priority=priority, outline=outline
+        )
         ljob.helper = helper
         ljob.uid = self.context.logging.uid("job")
         with self._lock:
             self._stop_lower_priority_running_jobs(priority)
             self._queue.append(ljob)
             self._queue.sort(key=lambda e: e.priority, reverse=True)
             self._lock.notify()
         self.context.signal("spooler;queue", len(self._queue))
 
-    def send(self, job):
+    def send(self, job, prevent_duplicate=False):
         """
         Send a job to the spooler queue
 
         @param job: job to send to the spooler.
+        @param prevent_duplicate: prevents the same job from being added again.
         @return:
         """
         job.uid = self.context.logging.uid("job")
         with self._lock:
+            if prevent_duplicate:
+                for q in self._queue:
+                    if q is job:
+                        return
             self._stop_lower_priority_running_jobs(job.priority)
             self._queue.append(job)
             self._queue.sort(key=lambda e: e.priority, reverse=True)
             self._lock.notify()
         self.context.signal("spooler;queue", len(self._queue))
 
     def _stop_lower_priority_running_jobs(self, priority):
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/svg_io.py` & `meerk40t-0.8.3000/meerk40t/core/svg_io.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,7 +1,11 @@
+"""
+This modeu
+"""
+
 import ast
 import gzip
 import math
 import os
 from base64 import b64encode
 from io import BytesIO
 from xml.etree.ElementTree import Element, ElementTree, ParseError, SubElement
@@ -197,15 +201,15 @@
                 "xmlns:inkscape",
                 "http://www.inkscape.org/namespaces/inkscape",
             )
         if version != "plain":
             # If there is a note set then we save the note with the project.
             if elements.note is not None:
                 subelement = SubElement(root, "note")
-                subelement.set(SVG_TAG_TEXT, elements.note)
+                subelement.set(SVG_TAG_TEXT, str(elements.note))
 
         SVGWriter._write_tree(root, elements._tree, version)
 
         SVGWriter._pretty_print(root)
         tree = ElementTree(root)
         if f.lower().endswith("svgz"):
             f = gzip.open(f, "wb")
@@ -355,29 +359,29 @@
                 if not t.is_identity():
                     subelement.set(
                         SVG_ATTR_TRANSFORM,
                         f"matrix({t.a}, {t.b}, {t.c}, {t.d}, {t.e}, {t.f})",
                     )
                 # Font features are covered by the `font` value shorthand
                 if c.font_family:
-                    subelement.set(SVG_ATTR_FONT_FAMILY, c.font_family)
+                    subelement.set(SVG_ATTR_FONT_FAMILY, str(c.font_family))
                 if c.font_style:
-                    subelement.set(SVG_ATTR_FONT_STYLE, c.font_style)
+                    subelement.set(SVG_ATTR_FONT_STYLE, str(c.font_style))
                 if c.font_variant:
-                    subelement.set(SVG_ATTR_FONT_VARIANT, c.font_variant)
+                    subelement.set(SVG_ATTR_FONT_VARIANT, str(c.font_variant))
                 if c.font_stretch:
-                    subelement.set(SVG_ATTR_FONT_STRETCH, c.font_stretch)
+                    subelement.set(SVG_ATTR_FONT_STRETCH, str(c.font_stretch))
                 if c.font_size:
                     subelement.set(SVG_ATTR_FONT_SIZE, str(c.font_size))
                 if c.line_height:
                     subelement.set("line_height", str(c.line_height))
                 if c.anchor:
-                    subelement.set(SVG_ATTR_TEXT_ANCHOR, c.anchor)
+                    subelement.set(SVG_ATTR_TEXT_ANCHOR, str(c.anchor))
                 if c.baseline:
-                    subelement.set(SVG_ATTR_TEXT_DOMINANT_BASELINE, c.baseline)
+                    subelement.set(SVG_ATTR_TEXT_DOMINANT_BASELINE, str(c.baseline))
                 decor = ""
                 if c.underline:
                     decor += " underline"
                 if c.overline:
                     decor += " overline"
                 if c.strikethrough:
                     decor += " line-through"
@@ -385,26 +389,26 @@
                 if decor:
                     subelement.set("text-decoration", decor)
                 element = c
             elif c.type == "group":
                 # This is a structural group node of elements. Recurse call to write values.
                 group_element = SubElement(xml_tree, SVG_TAG_GROUP)
                 if hasattr(c, "label") and c.label is not None and c.label != "":
-                    group_element.set("inkscape:label", c.label)
+                    group_element.set("inkscape:label", str(c.label))
                 SVGWriter._write_elements(group_element, c, version)
                 continue
             elif c.type == "file":
                 # This is a structural group node of elements. Recurse call to write values.
                 # is this the only file node? If yes then no need to generate an additional group
                 if single_file_node():
                     SVGWriter._write_elements(xml_tree, c, version)
                 else:
                     group_element = SubElement(xml_tree, SVG_TAG_GROUP)
                     if hasattr(c, "name") and c.name is not None and c.name != "":
-                        group_element.set("inkscape:label", c.name)
+                        group_element.set("inkscape:label", str(c.name))
                     SVGWriter._write_elements(group_element, c, version)
                 continue
             else:
                 if version != "plain":
                     # This is a non-standard element. Save custom.
                     subelement = SubElement(xml_tree, "element")
                     SVGWriter._write_custom(subelement, c)
@@ -476,16 +480,17 @@
                             factor = c.stroke_factor
                     except AttributeError:
                         pass
                     if c.matrix.determinant == 0:
                         c_m_d = 1
                     else:
                         c_m_d = math.sqrt(abs(c.matrix.determinant))
-                    stroke_width = str(factor * c.stroke_width / c_m_d)
-                    subelement.set(SVG_ATTR_STROKE_WIDTH, stroke_width)
+                    if c.stroke_width is not None:
+                        stroke_width = str(factor * c.stroke_width / c_m_d)
+                        subelement.set(SVG_ATTR_STROKE_WIDTH, stroke_width)
                 except AttributeError:
                     pass
 
             ###############
             # SAVE FILL
             ###############
             if hasattr(c, "fill"):
@@ -740,34 +745,43 @@
         if element.values.get("visibility") == "hidden":
             # This does not allow substructures...
             # Are we already underneath regmark?
             if not is_child(context_node, self.regmark):
                 context_node = self.regmark
             e_list = self.regmark_list
         ident = element.id
+
+        tag_label = None
         # Let's see whether we can get the label from an inkscape save
-        _label = None
-        if uselabel is not None and uselabel != "":
+        # We only want the 'label' attribute from the current tag, so
+        # we look at element.values["attributes"]
+        if "attributes" in element.values:
+            local_dict = element.values["attributes"]
+        else:
+            local_dict = element.values
+        ink_tag = "inkscape:label"
+        try:
+            inkscape = element.values.get("inkscape")
+            if inkscape is not None and inkscape != "":
+                ink_tag = "{" + inkscape + "}label"
+        except (AttributeError, KeyError):
+            pass
+        try:
+            tag_label = local_dict.get(ink_tag)
+            if tag_label == "":
+                tag_label = None
+            # print ("Found label: %s" %_label)
+        except (AttributeError, KeyError):
+            # Label might simply be "label"
+            tag_label = local_dict.get("label")
+        if uselabel:
             _label = uselabel
-        if _label is None:
-            ink_tag = "inkscape:label"
-            try:
-                inkscape = element.values.get("inkscape")
-                if inkscape is not None and inkscape != "":
-                    ink_tag = "{" + inkscape + "}label"
-            except (AttributeError, KeyError):
-                pass
-            try:
-                _label = element.values.get(ink_tag)
-                if _label == "":
-                    _label = None
-                # print ("Found label: %s" % my_label)
-            except (AttributeError, KeyError):
-                # Label might simply be "label"
-                _label = element.values.get("label")
+        else:
+            _label = tag_label
+
         _lock = None
         try:
             _lock = bool(element.values.get("lock") == "True")
         except (ValueError, TypeError):
             pass
         is_dot, dot_point = SVGProcessor.is_dot(element)
         if is_dot:
@@ -1109,26 +1123,27 @@
             if tag == "operation":
                 # Check if SVGElement: operation
                 if not self.operations_cleared:
                     self.elements.clear_operations()
                     self.operations_cleared = True
 
                 try:
-                    op = self.elements.op_branch.add(type=node_type, **attrs)
+                    node = self.elements.op_branch.create(type=node_type, **attrs)
+                    node.validate()
+                    node.id = node_id
+                    op = self.elements.op_branch.add_node(node)
                     overlooked_attributes = [
                         "output",
                     ]
                     for overlooked in overlooked_attributes:
                         if overlooked in element.values and hasattr(op, overlooked):
                             setattr(op, overlooked, element.values.get(overlooked))
-                    op.validate()
-                    op.id = node_id
                 except AttributeError:
                     # This operation is invalid.
-                    pass
+                    return
             elif tag == "element":
                 # Check if SVGElement: element
                 if "settings" in attrs:
                     del attrs[
                         "settings"
                     ]  # If settings was set, delete it or it will mess things up
                 elem = context_node.add(type=node_type, **attrs)
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/treeop.py` & `meerk40t-0.8.3000/meerk40t/core/treeop.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,7 +1,13 @@
+"""
+Tree Operation decorators help define the Tree Operations found mostly in element_treeop class. We create dynamic menus
+and thus need to classify the various different methods to access a node, without actually creating giant and
+redundant code for each command on each code type.
+"""
+
 import functools
 
 
 def tree_calc(value_name, calc_func):
     def decor(func):
         func.calcs.append((value_name, calc_func))
         return func
@@ -152,14 +158,16 @@
             registration, name, node_type=node_type, help=help, enable=enable, **kwargs
         )
 
     return treeop
 
 
 def tree_operations_for_node(registration, node):
+    if node.type is None:
+        return
     for func, m, sname in registration.find("tree", node.type, ".*"):
         reject = False
         for cond in func.conditionals:
             if not cond(node):
                 reject = True
                 break
         if reject:
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/undos.py` & `meerk40t-0.8.3000/meerk40t/core/undos.py`

 * *Files 12% similar despite different names*

```diff
@@ -57,14 +57,17 @@
         Note: because the undo.state is used directly, the UndoState's state must be
         given a fresh copy.
         @return:
         """
         if self._undo_index == 0:
             # At bottom of stack.
             return False
+        if len(self._undo_stack) == 0:
+            # Stack is entirely empty.
+            return False
         self._undo_index -= 1
         undo = self._undo_stack[self._undo_index]
         self.tree.restore_tree(undo.state)
         try:
             undo.state = self.tree.backup_tree()  # Get unused copy
         except KeyError:
             pass
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/units.py` & `meerk40t-0.8.3000/meerk40t/core/units.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,7 +1,22 @@
+"""
+Device Specific Unit Conversion Objects
+
+This defines a Viewport which all .device services are expected to implement. This provides the core functionality for
+establishing the scene and mapping points from scene locations to device locations. This also provides functionality
+for converting different length or angle units into other length or angle units.
+
+The fundamental unit used for all the elements objects is that 1 inch is equal to 65535 native units called a Tat for
+Tiger and Tatarize. This is basically a solid middle ground for providing significant rendering detail while not
+overflowing the buffer in linux which starts react poorly for values greater than 16,777,216 (2^24). This should provide
+enough detail for even the smallest lensed galvo laser while also allowing us to define objects as large as a football
+stadium.
+"""
+
+
 import re
 from copy import copy
 from math import tau
 
 from meerk40t.svgelements import Matrix
 
 PATTERN_FLOAT = r"[-+]?[0-9]*\.?[0-9]+(?:[eE][-+]?[0-9]+)?"
@@ -47,22 +62,14 @@
 UNITS_NANOMETER = 0
 UNITS_MM = 1
 UNITS_CM = 2
 UNITS_MILS = 3
 UNITS_INCH = 4
 UNITS_PERCENT = 100
 
-"""
-Device Specific Unit Conversion Objects
-
-This should exist on any device located at .length accepting coordinate and axis. This is callable with any str length
-and should convert the given length relative to the viewport provided by the native values of the device into
-nanometers.
-"""
-
 
 class ViewPort:
     """
     The width and height are of the viewport are stored in MK native units (1/65535) in.
     Origin_x and origin_y are the location of the machine home position in factors of 1.
     This is to say 1,1 is the bottom left, and 0.5 0.5 is the middle of the bed.
     * user_scale is a scale factor for applied by the user rather than the driver.
@@ -85,14 +92,19 @@
         flip_x=False,
         flip_y=False,
         swap_xy=False,
         show_origin_x=None,
         show_origin_y=None,
         show_flip_x=None,
         show_flip_y=None,
+        rotary_active=False,
+        rotary_scale_x=1.0,
+        rotary_scale_y=1.0,
+        rotary_flip_x=False,
+        rotary_flip_y=False,
     ):
         self._device_to_scene_matrix = None
         self._device_to_show_matrix = None
         self._scene_to_device_matrix = None
         self._scene_to_show_matrix = None
         self._show_to_device_matrix = None
         self._show_to_scene_matrix = None
@@ -103,14 +115,19 @@
         self.origin_y = origin_y
         self.user_scale_x = user_scale_x
         self.user_scale_y = user_scale_y
         self.native_scale_x = native_scale_x
         self.native_scale_y = native_scale_y
         self.flip_x = flip_x
         self.flip_y = flip_y
+        self.rotary_active = rotary_active
+        self.rotary_flip_x = rotary_flip_x
+        self.rotary_flip_y = rotary_flip_y
+        self.rotary_scale_x = rotary_scale_x
+        self.rotary_scale_y = rotary_scale_y
         self.swap_xy = swap_xy
         if show_origin_x is None:
             show_origin_x = origin_x
         if show_origin_y is None:
             show_origin_y = origin_y
         if show_flip_x is None:
             show_flip_x = flip_x
@@ -278,14 +295,18 @@
         if vector:
             point = self.show_to_scene_matrix().transform_vector((x, y))
             return point.x, point.y
         else:
             point = self.show_to_scene_matrix().point_in_matrix_space((x, y))
             return point.x, point.y
 
+    def device_position(self, x, y):
+        m = self.scene_to_device_matrix()
+        return m.point_in_matrix_space((x, y))
+
     def _calculate_matrices(self):
         """
         Calculate the matrices between the scene and device units.
         """
         self._scene_to_device_matrix = Matrix(self._scene_to_device_transform())
         self._device_to_scene_matrix = Matrix(self._scene_to_device_matrix)
         self._device_to_scene_matrix.inverse()
@@ -351,26 +372,34 @@
         Transform for moving from scene units to device units. This takes into account the user and native scaling, the
         shift in origin point, flips to the y-axis, flips to the x-axis, and axis_swapping.
 
         @return:
         """
         sx = self.user_scale_x * self.native_scale_x
         sy = self.user_scale_y * self.native_scale_y
+        if self.rotary_active:
+            sx *= self.rotary_scale_x
+            sy *= self.rotary_scale_y
         dx = self.unit_width * self.origin_x
         dy = self.unit_height * self.origin_y
         ops = []
         if sx != 1.0 or sy != 1.0:
             try:
                 ops.append(f"scale({1.0 / sx:.13f}, {1.0 / sy:.13f})")
             except ZeroDivisionError:
                 pass
         if self.flip_y:
             ops.append("scale(1.0, -1.0)")
+        if self.rotary_active and self.rotary_flip_y:
+            ops.append("scale(1.0, -1.0)")
+
         if self.flip_x:
             ops.append("scale(-1.0, 1.0)")
+        if self.rotary_active and self.rotary_flip_x:
+            ops.append("scale(-1.0, 1.0)")
         if dx != 0 or dy != 0:
             ops.append(f"translate({-dx:.13f}, {-dy:.13f})")
         if self.swap_xy:
             ops.append("scale(-1.0, 1.0) rotate(90deg)")
         return " ".join(ops)
 
     def _scene_to_show_transform(self):
@@ -520,113 +549,14 @@
         return float(Length(self.width))
 
     @property
     def unit_height(self):
         return float(Length(self.height))
 
     @staticmethod
-    def viewbox_transform(
-        e_x, e_y, e_width, e_height, vb_x, vb_y, vb_width, vb_height, aspect
-    ):
-        """
-        SVG 1.1 7.2, SVG 2.0 8.2 equivalent transform of an SVG viewport.
-        With regards to https://github.com/w3c/svgwg/issues/215 use 8.2 version.
-
-        It creates transform commands equal to that viewport expected.
-
-        Let e-x, e-y, e-width, e-height be the position and size of the element respectively.
-        Let vb-x, vb-y, vb-width, vb-height be the min-x, min-y, width and height values of the viewBox attribute
-        respectively.
-
-        Let align be align value of preserveAspectRatio, or 'xMidYMid' if preserveAspectRatio is not defined.
-        Let meetOrSlice be the meetOrSlice value of preserveAspectRatio, or 'meet' if preserveAspectRatio is not defined
-        or if meetOrSlice is missing from this value.
-
-        @param e_x: element_x value
-        @param e_y: element_y value
-        @param e_width: element_width value
-        @param e_height: element_height value
-        @param vb_x: viewbox_x value
-        @param vb_y: viewbox_y value
-        @param vb_width: viewbox_width value
-        @param vb_height: viewbox_height value
-        @param aspect: preserve aspect ratio value
-        @return: string of the SVG transform commands to account for the viewbox.
-        """
-        if (
-            e_x is None
-            or e_y is None
-            or e_width is None
-            or e_height is None
-            or vb_x is None
-            or vb_y is None
-            or vb_width is None
-            or vb_height is None
-        ):
-            return ""
-        if aspect is not None:
-            aspect_slice = aspect.split(" ")
-            try:
-                align = aspect_slice[0]
-            except IndexError:
-                align = "xMidyMid"
-            try:
-                meet_or_slice = aspect_slice[1]
-            except IndexError:
-                meet_or_slice = "meet"
-        else:
-            align = "xMidyMid"
-            meet_or_slice = "meet"
-        # Initialize scale-x to e-width/vb-width.
-        scale_x = e_width / vb_width
-        # Initialize scale-y to e-height/vb-height.
-        scale_y = e_height / vb_height
-
-        # If align is not 'none' and meetOrSlice is 'meet', set the larger of scale-x and scale-y to the smaller.
-        if align != "none" and meet_or_slice == "meet":
-            scale_x = scale_y = min(scale_x, scale_y)
-        # Otherwise, if align is not 'none' and meetOrSlice is 'slice', set the smaller of scale-x and scale-y to the larger
-        elif align != "none" and meet_or_slice == "slice":
-            scale_x = scale_y = max(scale_x, scale_y)
-        # Initialize translate-x to e-x - (vb-x * scale-x).
-        translate_x = e_x - (vb_x * scale_x)
-        # Initialize translate-y to e-y - (vb-y * scale-y)
-        translate_y = e_y - (vb_y * scale_y)
-        # If align contains 'xMid', add (e-width - vb-width * scale-x) / 2 to translate-x.
-        align = align.lower()
-        if "xmid" in align:
-            translate_x += (e_width - vb_width * scale_x) / 2.0
-        # If align contains 'xMax', add (e-width - vb-width * scale-x) to translate-x.
-        if "xmax" in align:
-            translate_x += e_width - vb_width * scale_x
-        # If align contains 'yMid', add (e-height - vb-height * scale-y) / 2 to translate-y.
-        if "ymid" in align:
-            translate_y += (e_height - vb_height * scale_y) / 2.0
-        # If align contains 'yMax', add (e-height - vb-height * scale-y) to translate-y.
-        if "ymax" in align:
-            translate_y += e_height - vb_height * scale_y
-        # The transform applied to content contained by the element is given by:
-        # translate(translate-x, translate-y) scale(scale-x, scale-y)
-        if isinstance(scale_x, Length) or isinstance(scale_y, Length):
-            raise ValueError
-        if translate_x == 0 and translate_y == 0:
-            if scale_x == 1 and scale_y == 1:
-                return ""  # Nothing happens.
-            else:
-                return f"scale({scale_x:.12f}, {scale_y:.12f})"
-        else:
-            if scale_x == 1 and scale_y == 1:
-                return f"translate({translate_x:.12f}, {translate_y:.12f})"
-            else:
-                return (
-                    f"translate({translate_x:.12f}, {translate_y:.12f}) "
-                    f"scale({scale_x:.12f}, {scale_y:.12f})"
-                )
-
-    @staticmethod
     def conversion(units, amount=1):
         return Length(f"{amount}{units}").preferred
 
 
 ACCEPTED_UNITS = (
     "",
     "cm",
@@ -830,15 +760,19 @@
 
     def __eq__(self, other):
         if other is None:
             return False
         if isinstance(other, (int, float)):
             return self._amount == other
         if not isinstance(other, Length):
-            other = Length(other)
+            try:
+                other = Length(other)
+            except ValueError:
+                # Not a length, we do not equal this.
+                return False
         return abs(self._amount - other._amount) <= ERROR
 
     @property
     def preferred(self):
         if self._preferred_units == "px":
             return self.pixels
         elif self._preferred_units == "in":
@@ -1098,8 +1032,107 @@
     def angle_turns(self):
         return f"{self.turns}turn"
 
     def is_orthogonal(self):
         return (self.angle % (tau / 4.0)) == 0
 
 
+def viewbox_transform(
+    e_x, e_y, e_width, e_height, vb_x, vb_y, vb_width, vb_height, aspect
+):
+    """
+    SVG 1.1 7.2, SVG 2.0 8.2 equivalent transform of an SVG viewport.
+    With regards to https://github.com/w3c/svgwg/issues/215 use 8.2 version.
+
+    It creates transform commands equal to that viewport expected.
+
+    Let e-x, e-y, e-width, e-height be the position and size of the element respectively.
+    Let vb-x, vb-y, vb-width, vb-height be the min-x, min-y, width and height values of the viewBox attribute
+    respectively.
+
+    Let align be align value of preserveAspectRatio, or 'xMidYMid' if preserveAspectRatio is not defined.
+    Let meetOrSlice be the meetOrSlice value of preserveAspectRatio, or 'meet' if preserveAspectRatio is not defined
+    or if meetOrSlice is missing from this value.
+
+    @param e_x: element_x value
+    @param e_y: element_y value
+    @param e_width: element_width value
+    @param e_height: element_height value
+    @param vb_x: viewbox_x value
+    @param vb_y: viewbox_y value
+    @param vb_width: viewbox_width value
+    @param vb_height: viewbox_height value
+    @param aspect: preserve aspect ratio value
+    @return: string of the SVG transform commands to account for the viewbox.
+    """
+    if (
+        e_x is None
+        or e_y is None
+        or e_width is None
+        or e_height is None
+        or vb_x is None
+        or vb_y is None
+        or vb_width is None
+        or vb_height is None
+    ):
+        return ""
+    if aspect is not None:
+        aspect_slice = aspect.split(" ")
+        try:
+            align = aspect_slice[0]
+        except IndexError:
+            align = "xMidyMid"
+        try:
+            meet_or_slice = aspect_slice[1]
+        except IndexError:
+            meet_or_slice = "meet"
+    else:
+        align = "xMidyMid"
+        meet_or_slice = "meet"
+    # Initialize scale-x to e-width/vb-width.
+    scale_x = e_width / vb_width
+    # Initialize scale-y to e-height/vb-height.
+    scale_y = e_height / vb_height
+
+    # If align is not 'none' and meetOrSlice is 'meet', set the larger of scale-x and scale-y to the smaller.
+    if align != "none" and meet_or_slice == "meet":
+        scale_x = scale_y = min(scale_x, scale_y)
+    # Otherwise, if align is not 'none' and meetOrSlice is 'slice', set the smaller of scale-x and scale-y to the larger
+    elif align != "none" and meet_or_slice == "slice":
+        scale_x = scale_y = max(scale_x, scale_y)
+    # Initialize translate-x to e-x - (vb-x * scale-x).
+    translate_x = e_x - (vb_x * scale_x)
+    # Initialize translate-y to e-y - (vb-y * scale-y)
+    translate_y = e_y - (vb_y * scale_y)
+    # If align contains 'xMid', add (e-width - vb-width * scale-x) / 2 to translate-x.
+    align = align.lower()
+    if "xmid" in align:
+        translate_x += (e_width - vb_width * scale_x) / 2.0
+    # If align contains 'xMax', add (e-width - vb-width * scale-x) to translate-x.
+    if "xmax" in align:
+        translate_x += e_width - vb_width * scale_x
+    # If align contains 'yMid', add (e-height - vb-height * scale-y) / 2 to translate-y.
+    if "ymid" in align:
+        translate_y += (e_height - vb_height * scale_y) / 2.0
+    # If align contains 'yMax', add (e-height - vb-height * scale-y) to translate-y.
+    if "ymax" in align:
+        translate_y += e_height - vb_height * scale_y
+    # The transform applied to content contained by the element is given by:
+    # translate(translate-x, translate-y) scale(scale-x, scale-y)
+    if isinstance(scale_x, Length) or isinstance(scale_y, Length):
+        raise ValueError
+    if translate_x == 0 and translate_y == 0:
+        if scale_x == 1 and scale_y == 1:
+            return ""  # Nothing happens.
+        else:
+            return f"scale({scale_x:.12f}, {scale_y:.12f})"
+    else:
+        if scale_x == 1 and scale_y == 1:
+            return f"translate({translate_x:.12f}, {translate_y:.12f})"
+        else:
+            return (
+                f"translate({translate_x:.12f}, {translate_y:.12f}) "
+                f"scale({scale_x:.12f}, {scale_y:.12f})"
+            )
+
+
 # TODO: Add in speed for units. mm/s in/s mm/minute.
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/webhelp.py` & `meerk40t-0.8.3000/meerk40t/core/webhelp.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,7 +1,12 @@
+"""
+Webhelp is a list of websites relevant to the program. This registers a `webhelp` command that will launch a browser
+point to the relvant sites.
+"""
+
 MEERK40T_ISSUES = "https://github.com/meerk40t/meerk40t/issues"
 MEERK40T_HELP = "https://github.com/meerk40t/meerk40t/wiki"
 MEERK40T_BEGINNERS = "https://github.com/meerk40t/meerk40t/wiki/Beginners:-0.-Index"
 MEERK40T_WEBSITE = "https://github.com/meerk40t/meerk40t"
 MEERK40T_RELEASES = "https://github.com/meerk40t/meerk40t/releases"
 FACEBOOK_MEERK40T = "https://www.facebook.com/groups/716000085655097"
 DISCORD_MEERK40T = "https://discord.gg/vkDD3HdQq6"
```

### Comparing `meerk40t-0.8.2000/meerk40t/core/wordlist.py` & `meerk40t-0.8.3000/meerk40t/core/wordlist.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,7 +1,12 @@
+"""
+Base wordlist class that holds some wordlist logic. Most of the interactions with wordlists are done in the
+elements service.
+"""
+
 import csv
 import json
 import os
 import re
 from copy import copy
 from datetime import datetime
 
@@ -414,20 +419,20 @@
         except (csv.Error, PermissionError, OSError, FileNotFoundError):
             ct = 0
             headers = []
         colcount = len(headers)
         return ct, colcount, headers
 
     def wordlist_delta(self, orgtext, increase):
-        newtext = orgtext
+        newtext = str(orgtext)
         toreplace = []
         # list of tuples, (index found, old, new )
         # Lets gather the {} first...
         brackets = re.compile(r"\{[^}]+\}")
-        for bracketed_key in brackets.findall(orgtext):
+        for bracketed_key in brackets.findall(str(orgtext)):
             #            print(f"Key found: {bracketed_key}")
             newpattern = ""
             key = bracketed_key[1:-1].lower().strip()
             relative = 0
             pos = key.find("#")
             if pos > 0:  # Needs to be after first character
                 # Process offset modification.
```

### Comparing `meerk40t-0.8.2000/meerk40t/device/ch341/ch341.py` & `meerk40t-0.8.3000/meerk40t/device/ch341/ch341.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/device/ch341/ch341libusbdriver.py` & `meerk40t-0.8.3000/meerk40t/device/ch341/ch341libusbdriver.py`

 * *Files 2% similar despite different names*

```diff
@@ -364,14 +364,18 @@
                 endpoint=BULK_READ_ENDPOINT, size_or_buffer=6, timeout=self.timeout
             )
         except usb.core.USBError as e:
             self.backend_error_code = e.backend_error_code
 
             self.channel(str(e))
             raise ConnectionError
+        except ValueError as e:
+            raise ConnectionError(
+                "This hardware device is unrecognized. Required endpoint does not exist.."
+            ) from e
         return status[0]
         # 48, reads 0xc0, 95, 0, 0 (30,00? = 48)
 
     def CH341GetVerIC(self, index=0):
         device = self.devices[index]
         try:
             buffer = device.ctrl_transfer(
```

### Comparing `meerk40t-0.8.2000/meerk40t/device/ch341/libusb.py` & `meerk40t-0.8.3000/meerk40t/device/ch341/libusb.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/device/ch341/mock.py` & `meerk40t-0.8.3000/meerk40t/device/ch341/mock.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/device/ch341/windll.py` & `meerk40t-0.8.3000/meerk40t/device/ch341/windll.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/device/gui/defaultactions.py` & `meerk40t-0.8.3000/meerk40t/device/gui/defaultactions.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/device/gui/formatterpanel.py` & `meerk40t-0.8.3000/meerk40t/device/gui/formatterpanel.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 import wx
 
-from meerk40t.core.element_types import elem_group_nodes, op_nodes
+from meerk40t.core.elements.element_types import elem_group_nodes, op_nodes
 from meerk40t.gui.choicepropertypanel import ChoicePropertyPanel
 from meerk40t.gui.icons import (
     icons8_diagonal_20,
     icons8_direction_20,
     icons8_file_20,
     icons8_group_objects_20,
     icons8_home_20,
@@ -92,15 +92,15 @@
             elif node in op_nodes:
                 sectname = "Operations"
             else:
                 sectname = ""
             lbl = node.replace(" ", "_")
             default = self.context.elements.lookup(f"format/{node}")
             if default is None:
-                default == ""
+                default = ""
             self.context.setting(bool, f"formatter_{lbl}_active", False)
             self.context.setting(str, f"formatter_{lbl}", default)
             # We have a pair of a checkbox and a textinput
             available = self.get_node_patterns(node)
             choices.append(
                 {
                     "object": self.context,
```

### Comparing `meerk40t-0.8.2000/meerk40t/device/gui/warningpanel.py` & `meerk40t-0.8.3000/meerk40t/device/gui/warningpanel.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/dxf/dxf_io.py` & `meerk40t-0.8.3000/meerk40t/dxf/dxf_io.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/dxf/plugin.py` & `meerk40t-0.8.3000/meerk40t/dxf/plugin.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/extra/cag.py` & `meerk40t-0.8.3000/meerk40t/extra/cag.py`

 * *Files 3% similar despite different names*

```diff
@@ -4,15 +4,15 @@
 def plugin(kernel, lifecycle):
     if lifecycle == "invalidate":
         try:
             import numpy as np  # pylint: disable=unused-import
         except ImportError:
             return True
     elif lifecycle == "register":
-        from ..core.elements import linearize_path
+        from ..core.elements.elements import linearize_path
         from ..tools import polybool as pb
 
         _ = kernel.translation
         context = kernel.root
 
         @context.console_option(
             "keep", "k", type=bool, action="store_true", help="keep original elements"
@@ -47,17 +47,20 @@
             for i in range(len(data)):
                 node = data[i]
                 try:
                     path = node.as_path()
                 except AttributeError:
                     return "elements", data
                 c = linearize_path(path)
-                c = pb.Polygon(c)
-                c = pb.segments(c)
-                segment_list.append(c)
+                try:
+                    c = pb.Polygon(c)
+                    c = pb.segments(c)
+                    segment_list.append(c)
+                except pb.PolyBoolException:
+                    channel(_("Polybool could not solve."))
             if len(segment_list) == 0:
                 return "elements", data
             if not keep:
                 for node in data:
                     node.remove_node()
             segs = segment_list[0]
             for s in segment_list[1:]:
```

### Comparing `meerk40t-0.8.2000/meerk40t/extra/embroider.py` & `meerk40t-0.8.3000/meerk40t/extra/embroider.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/extra/hershey.py` & `meerk40t-0.8.3000/meerk40t/extra/hershey.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 from glob import glob
-from os.path import exists, join, realpath, splitext
+from os.path import basename, exists, join, realpath, splitext
 
 from meerk40t.core.node.elem_path import PathNode
 from meerk40t.core.units import UNITS_PER_PIXEL, Length
 from meerk40t.kernel import get_safe_path
 from meerk40t.svgelements import Arc, Color, Matrix, Path
 from meerk40t.tools.jhfparser import JhfFont
 from meerk40t.tools.shxparser import ShxFont, ShxFontParseError
@@ -156,60 +156,88 @@
     if font_size is None:
         font_size = Length("20px")
 
     context.setting(str, "shx_preferred", None)
     safe_dir = realpath(get_safe_path(context.kernel.name))
     context.setting(str, "font_directory", safe_dir)
     font_dir = context.font_directory
-    if font is not None:
-        context.shx_preferred = font
-    font = context.shx_preferred
+    # Check whether the default is still valid
+    if context.shx_preferred is not None and context.shx_preferred != "":
+        font_path = join(font_dir, context.shx_preferred)
+        if not exists(font_path):
+            context.shx_preferred = None
+    # Valid font?
     if font is not None and font != "":
         font_path = join(font_dir, font)
         if not exists(font_path):
-            # print (f"Font {font} could'nt be found, fallback to candidates")
             font = None
-
+    if font is not None:
+        context.shx_preferred = font
+    else:
+        if context.shx_preferred is not None:
+            #  print (f"Fallback to {context.shx_preferred}")
+            font = context.shx_preferred
+    # Still not valid?
     if font is None or font == "":
+        font = ""
         # No preferred font set, let's try a couple of candidates...
         candidates = (
             "timesr.jhf",
             "romant.shx",
             "rowmans.jhf",
             "FUTURA.SHX",
+            "arial.ttf",
         )
         for fname in candidates:
             fullfname = join(font_dir, fname)
             if exists(fullfname):
                 # print (f"Taking font {fname} instead")
                 font = fname
                 context.shx_preferred = font
                 break
+        if font == "":
+            # You know, I take anything at this point...
+            for extension in registered_fonts:
+                ext = "*." + extension
+                if font == "":
+                    for p in glob(join(font_dir, ext.lower())):
+                        font = basename(p)
+                        # print (f"Fallback to first file found: {font}")
+                        context.shx_preferred = font
+                        break
+                if font == "":
+                    for p in glob(join(font_dir, ext.upper())):
+                        font = basename(p)
+                        # print (f"Fallback to first file found: {font}")
+                        context.shx_preferred = font
+                        break
+
     if font is None or font == "":
+        # print ("Font was empty")
         return None
     font_path = join(font_dir, font)
     try:
         filename, file_extension = splitext(font_path)
         if len(file_extension) > 0:
             # Remove dot...
             file_extension = file_extension[1:].lower()
         item = registered_fonts[file_extension]
         fontclass = item[1]
     except (KeyError, IndexError):
-        # channel(_("Unknown fonttype {ext}").format(ext=file_extension))
+        # print(f"Unknown fonttype {file_extension}")
         return None
     horizontal = True
     try:
         cfont = fontclass(font_path)
         path = FontPath()
         # print (f"Path={path}, text={remainder}, font-size={font_size}")
         mytext = context.elements.wordlist_translate(text)
         cfont.render(path, mytext, horizontal, float(font_size))
     except ShxFontParseError as e:
-        # channel(f"{e.args}")
+        # print(f"FontParseError {e.args}")
         return
     #  print (f"Pathlen={len(path.path)}")
     # if len(path.path) == 0:
     #     print("Empty path...")
     #     return None
 
     path_node = PathNode(
```

### Comparing `meerk40t-0.8.2000/meerk40t/extra/imageactions.py` & `meerk40t-0.8.3000/meerk40t/extra/imageactions.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/extra/pathoptimize.py` & `meerk40t-0.8.3000/meerk40t/extra/pathoptimize.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/extra/potrace.py` & `meerk40t-0.8.3000/meerk40t/extra/potrace.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/extra/vectrace.py` & `meerk40t-0.8.3000/meerk40t/extra/vectrace.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/extra/winsleep.py` & `meerk40t-0.8.3000/meerk40t/extra/winsleep.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/fill/fills.py` & `meerk40t-0.8.3000/meerk40t/fill/fills.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/fill/patternfill.py` & `meerk40t-0.8.3000/meerk40t/fill/patternfill.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/fill/patterns.py` & `meerk40t-0.8.3000/meerk40t/fill/patterns.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/grbl/control.py` & `meerk40t-0.8.3000/meerk40t/grbl/control.py`

 * *Files 8% similar despite different names*

```diff
@@ -53,17 +53,15 @@
 
             channel(_("GRBL Mode."))
             if verbose:
                 console = root.channel("console")
                 root.channel("grbl").watch(console)
                 server.events_channel.watch(console)
 
-            emulator = GRBLEmulator(
-                root.device.driver, root.device.scene_to_device_matrix()
-            )
+            emulator = GRBLEmulator(root.device, root.device.scene_to_device_matrix())
             self.emulator = emulator
 
             # Link emulator and server.
             tcp_recv_channel = root.channel("grbl/recv", pure=True)
             tcp_recv_channel.watch(self.add_queue)
             tcp_send_channel = root.channel("grbl/send", pure=True)
             emulator.reply = tcp_send_channel
```

### Comparing `meerk40t-0.8.2000/meerk40t/grbl/controller.py` & `meerk40t-0.8.3000/meerk40t/grbl/controller.py`

 * *Files 0% similar despite different names*

```diff
@@ -484,11 +484,11 @@
             if self.service.buffer_mode == "sync":
                 self._sending_sync()
             else:
                 self._sending_buffered()
         self.service.signal("pipe;running", False)
 
     def __repr__(self):
-        return f"GRBLSerial('{self.service.serial_port}:{str(self.service.serial_baud_rate)}')"
+        return f"GRBLSerial('{self.service.serial_port}:{str(self.service.baud_rate)}')"
 
     def __len__(self):
         return len(self._sending_queue) + len(self._realtime_queue)
```

### Comparing `meerk40t-0.8.2000/meerk40t/grbl/device.py` & `meerk40t-0.8.3000/meerk40t/grbl/device.py`

 * *Files 12% similar despite different names*

```diff
@@ -18,18 +18,25 @@
 
 
 class GRBLDevice(Service, ViewPort):
     """
     GRBLDevice is driver for the Gcode Controllers
     """
 
-    def __init__(self, kernel, path, *args, **kwargs):
+    def __init__(self, kernel, path, *args, choices=None, **kwargs):
         Service.__init__(self, kernel, path)
         self.name = "GRBLDevice"
         self.extension = "gcode"
+        if choices is not None:
+            for c in choices:
+                attr = c.get("attr")
+                default = c.get("default")
+                if attr is not None and default is not None:
+                    setattr(self, attr, default)
+
         # self.redlight_preferred = False
 
         self.setting(str, "label", path)
         _ = self._
         choices = [
             {
                 "attr": "bedwidth",
@@ -129,14 +136,74 @@
                 "label": _("Home Right"),
                 "tip": _("Indicates the device Home is at the right side"),
                 "subsection": "_30_Home position",
                 "signals": "bedsize",
             },
         ]
         self.register_choices("bed_dim", choices)
+        choices = [
+            {
+                "attr": "rotary_active",
+                "object": self,
+                "default": False,
+                "type": bool,
+                "label": _("Rotary-Mode active"),
+                "tip": _("Is the rotary mode active for this device"),
+            },
+            {
+                "attr": "rotary_scale_x",
+                "object": self,
+                "default": 1.0,
+                "type": float,
+                "label": _("X-Scale"),
+                "tip": _("Scale that needs to be applied to the X-Axis"),
+                "conditional": (self, "rotary_active"),
+                "subsection": _("Scale"),
+            },
+            {
+                "attr": "rotary_scale_y",
+                "object": self,
+                "default": 1.0,
+                "type": float,
+                "label": _("Y-Scale"),
+                "tip": _("Scale that needs to be applied to the Y-Axis"),
+                "conditional": (self, "rotary_active"),
+                "subsection": _("Scale"),
+            },
+            {
+                "attr": "rotary_supress_home",
+                "object": self,
+                "default": False,
+                "type": bool,
+                "label": _("Ignore Home"),
+                "tip": _("Ignore Home-Command"),
+                "conditional": (self, "rotary_active"),
+            },
+            {
+                "attr": "rotary_mirror_x",
+                "object": self,
+                "default": False,
+                "type": bool,
+                "label": _("Mirror X"),
+                "tip": _("Mirror the elements on the X-Axis"),
+                "conditional": (self, "rotary_active"),
+                "subsection": _("Mirror Output"),
+            },
+            {
+                "attr": "rotary_mirror_y",
+                "object": self,
+                "default": False,
+                "type": bool,
+                "label": _("Mirror Y"),
+                "tip": _("Mirror the elements on the Y-Axis"),
+                "conditional": (self, "rotary_active"),
+                "subsection": _("Mirror Output"),
+            },
+        ]
+        self.register_choices("rotary", choices)
         # Tuple contains 4 value pairs: Speed Low, Speed High, Power Low, Power High, each with enabled, value
         self.setting(
             list, "dangerlevel_op_cut", (False, 0, False, 0, False, 0, False, 0)
         )
         self.setting(
             list, "dangerlevel_op_engrave", (False, 0, False, 0, False, 0, False, 0)
         )
@@ -188,14 +255,15 @@
                 "attr": "label",
                 "object": self,
                 "default": "grbl",
                 "type": str,
                 "label": _("Label"),
                 "tip": _("What is this device called."),
                 "width": 250,
+                "signals": "device;renamed",
             },
             {
                 "attr": "serial_port",
                 "object": self,
                 "default": "UNCONFIGURED",
                 "type": str,
                 "style": "option",
@@ -458,29 +526,29 @@
                     channel(f"Laser strength for red dot is now: {self.red_dot_level}%")
             if off == "off":
                 self.driver.laser_off()
                 # self.driver.grbl("G0")
                 self.driver.move_mode = 0
                 # self.redlight_preferred = False
                 channel("Turning off redlight.")
-                self.signal("grbl_red_dot", True)
+                self.signal("grbl_red_dot", False)
             else:
                 # self.redlight_preferred = True
                 # self.driver.set("power", int(self.red_dot_level / 100 * 1000))
                 self.driver._clean()
                 self.driver.laser_on(
                     power=int(self.red_dot_level / 100 * 1000), speed=1000
                 )
                 # By default any move is a G0 move which will not activate the laser,
                 # so we need to switch to G1 mode:
                 self.driver.move_mode = 1
                 # An arbitrary move to turn the laser really on!
                 # self.driver.grbl("G1")
                 channel("Turning on redlight.")
-                self.signal("grbl_red_dot", False)
+                self.signal("grbl_red_dot", True)
 
         @self.console_option(
             "idonotlovemyhouse",
             type=bool,
             action="store_true",
             help=_("override one second laser fire pulse duration"),
         )
@@ -563,13 +631,13 @@
     @property
     def native(self):
         """
         @return: the location in device native units for the current known position.
         """
         return self.driver.native_x, self.driver.native_y
 
-    def realize(self):
+    def realize(self, origin=None):
         self.width = self.bedwidth
         self.height = self.bedheight
         self.origin_x = 1.0 if self.home_right else 0.0
         self.origin_y = 1.0 if self.home_bottom else 0.0
         super().realize()
```

### Comparing `meerk40t-0.8.2000/meerk40t/grbl/driver.py` & `meerk40t-0.8.3000/meerk40t/grbl/driver.py`

 * *Files 5% similar despite different names*

```diff
@@ -64,14 +64,16 @@
 
         self.grbl = self.service.channel("grbl", pure=True)
         self.grbl_realtime = self.service.channel("grbl-realtime", pure=True)
 
         self.move_mode = 0
         self.reply = None
         self.elements = None
+        self.power_scale = 1.0
+        self.speed_scale = 1.0
 
     def __repr__(self):
         return f"GRBLDriver({self.name})"
 
     @signal_listener("line_end")
     def _set_line_end(self, origin=None, *args):
         line_end = self.service.setting(str, "line_end", "CR")
@@ -397,14 +399,16 @@
         """
         Home the laser (ie goto defined origin)
 
         @return:
         """
         self.native_x = 0
         self.native_y = 0
+        if self.service.rotary_active and self.service.rotary_supress_home:
+            return
         self.grbl(f"G28{self.line_end}")
 
     def rapid_mode(self, *values):
         """
         Rapid mode sets the laser to rapid state. This is usually moving the laser around without it executing a large
         batch of commands.
 
@@ -646,7 +650,47 @@
         self.unit_scale = UNITS_PER_INCH / self.stepper_step_size  # g20 is inch mode.
         self.units_dirty = True
 
     def _g21_units_mm(self):
         self.units = 21
         self.unit_scale = UNITS_PER_MM / self.stepper_step_size  # g21 is mm mode.
         self.units_dirty = True
+
+    def set_power_scale(self, factor):
+        if 0 < factor < 100:
+            self.power_scale = factor
+        else:
+            self.power_scale = 1.0
+        # Grbl can only deal with factors between 10% and 200%
+        ifactor = int(self.power_scale * 10 + 10)
+        ifactor = min(20, max(1, ifactor))
+        self.grbl_realtime("\x99")
+        if ifactor < 10:
+            for idx in range(10 - ifactor):
+                self.grbl_realtime("\x9A")
+        elif ifactor > 10:
+            for idx in range(ifactor - 10):
+                self.grbl_realtime("\x9B")
+
+    def set_speed_scale(self, factor):
+        if 0 < factor < 100:
+            self.speed_scale = factor
+        else:
+            self.speed_scale = 1.0
+        # Grbl can only deal with factors between 10% and 200%
+        ifactor = int(self.speed_scale * 10 + 10)
+        ifactor = min(20, max(1, ifactor))
+        self.grbl_realtime("\x90")
+        if ifactor < 10:
+            for idx in range(10 - ifactor):
+                self.grbl_realtime("\x92")
+        elif ifactor > 10:
+            for idx in range(ifactor - 10):
+                self.grbl_realtime("\x91")
+
+    @staticmethod
+    def has_adjustable_power():
+        return True
+
+    @staticmethod
+    def has_adjustable_speed():
+        return True
```

### Comparing `meerk40t-0.8.2000/meerk40t/grbl/emulator.py` & `meerk40t-0.8.3000/meerk40t/gui/scene/scene.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,915 +1,870 @@
-"""
-GRBL Emulator
+import platform
+import threading
+import time
+
+import wx
+
+from meerk40t.gui.laserrender import (
+    DRAW_MODE_ANIMATE,
+    DRAW_MODE_FLIPXY,
+    DRAW_MODE_INVERT,
+    DRAW_MODE_REFRESH,
+)
+from meerk40t.gui.scene.guicolors import GuiColors
+from meerk40t.gui.scene.sceneconst import (
+    HITCHAIN_DELEGATE,
+    HITCHAIN_DELEGATE_AND_HIT,
+    HITCHAIN_HIT,
+    HITCHAIN_HIT_AND_DELEGATE,
+    ORIENTATION_RELATIVE,
+    RESPONSE_ABORT,
+    RESPONSE_CHAIN,
+    RESPONSE_CONSUME,
+    RESPONSE_DROP,
+)
+from meerk40t.gui.scene.scenespacewidget import SceneSpaceWidget
+from meerk40t.kernel import Job, Module
+from meerk40t.svgelements import Matrix, Point
+
+# TODO: _buffer can be updated partially rather than fully rewritten, especially with some layering.
+
+
+_reused_identity_widget = Matrix()
+XCELLS = 15
+YCELLS = 15
+
+
+class SceneToast:
+    """
+    SceneToast is drawn directly by the Scene. It creates a text message in a box that animates a fade.
+    """
+
+    def __init__(self, scene, left, top, right, bottom):
+        self.scene = scene
+        self.left = left
+        self.top = top
+        self.right = right
+        self.bottom = bottom
+        self.countdown = 0
+        self.message = None
+        self.token = None
+
+        self.brush = wx.Brush()
+        self.pen = wx.Pen()
+        self.font = wx.Font()
+        self.brush_color = wx.Colour()
+        self.pen_color = wx.Colour()
+        self.font_color = wx.Colour()
+
+        self.pen.SetWidth(10)
+        self.text_height = float("inf")
+        self.text_width = float("inf")
 
-The GRBL Emulator converts our parsed Grbl/Gcode data into Driver-like calls.
-"""
+        self.alpha = None
+        self.set_alpha(255)
 
-import re
-
-from meerk40t.core.cutcode.plotcut import PlotCut
-from meerk40t.core.cutcode.waitcut import WaitCut
-from meerk40t.core.units import UNITS_PER_INCH, UNITS_PER_MM
-from meerk40t.svgelements import Arc
-
-GRBL_SET_RE = re.compile(r"\$(\d+)=([-+]?[0-9]*\.?[0-9]*)")
-CODE_RE = re.compile(r"([A-Za-z])")
-FLOAT_RE = re.compile(r"[-+]?[0-9]*\.?[0-9]*")
-
-
-def _tokenize_code(code_line):
-    pos = code_line.find("(")
-    while pos != -1:
-        end = code_line.find(")")
-        yield ["comment", code_line[pos + 1 : end]]
-        code_line = code_line[:pos] + code_line[end + 1 :]
-        pos = code_line.find("(")
-    pos = code_line.find(";")
-    if pos != -1:
-        yield ["comment", code_line[pos + 1 :]]
-        code_line = code_line[:pos]
-
-    code = None
-    for x in CODE_RE.split(code_line):
-        x = x.strip()
-        if len(x) == 0:
-            continue
-        if len(x) == 1 and x.isalpha():
-            if code is not None:
-                yield code
-            code = [x.lower()]
-            continue
-        if code is not None:
-            code.extend([float(v) for v in FLOAT_RE.findall(x) if len(v) != 0])
-            yield code
-        code = None
-    if code is not None:
-        yield code
-
-
-step_pulse_microseconds = 0
-step_idle_delay = 25
-step_pulse_invert = 2
-step_direction_invert = 3
-invert_step_enable_pin = 4
-invert_limit_pins = 5
-invert_probe_pin = 6
-status_report_options = 10
-junction_deviation = 11
-arc_tolerance = 12
-report_in_inches = 13
-soft_limits_enabled = 20
-hard_limits_enabled = 21
-homing_cycle_enable = 22
-homing_direction_invert = 23
-homing_locate_feed_rate = 24
-homing_search_seek_rate = 25
-homing_switch_debounce_delay = 26
-homing_switch_pulloff_distance = 27
-maximum_spindle_speed = 30
-minimum_spindle_speed = 31
-laser_mode_enable = 32
-x_axis_steps_per_millimeter = 100
-y_axis_steps_per_millimeter = 101
-z_axis_steps_per_millimeter = 102
-x_axis_max_rate = 110
-y_axis_max_rate = 111
-z_axis_max_rate = 112
-x_axis_acceleration = 120
-y_axis_acceleration = 121
-z_axis_acceleration = 122
-x_axis_max_travel = 130
-y_axis_max_travel = 131
-z_axis_max_travel = 132
-
-lookup = {
-    step_pulse_microseconds: "step_pulse_microseconds",
-    step_idle_delay: "step_idle_delay",
-    step_pulse_invert: "step_pulse_invert",
-    step_direction_invert: "step_direction_invert",
-    invert_step_enable_pin: "invert_step_enable_pin",
-    invert_limit_pins: "invert_limit_pins",
-    invert_probe_pin: "invert_probe_pin",
-    status_report_options: "status_report_options",
-    junction_deviation: "junction_deviation",
-    arc_tolerance: "arc_tolerance",
-    report_in_inches: "report_in_inches",
-    soft_limits_enabled: "soft_limits_enabled",
-    hard_limits_enabled: "hard_limits_enabled",
-    homing_cycle_enable: "homing_cycle_enable",
-    homing_direction_invert: "homing_direction_invert",
-    homing_locate_feed_rate: "homing_locate_feed_rate,",
-    homing_search_seek_rate: "homing_search_seek_rate",
-    homing_switch_debounce_delay: "homing_switch_debounce_delay,",
-    homing_switch_pulloff_distance: "homing_switch_pulloff_distance",
-    maximum_spindle_speed: "maximum_spindle_speed,",
-    minimum_spindle_speed: "minimum_spindle_speed,",
-    laser_mode_enable: "laser_mode_enable,",
-    x_axis_steps_per_millimeter: "x_axis_steps_per_millimeter",
-    y_axis_steps_per_millimeter: "y_axis_steps_per_millimeter",
-    z_axis_steps_per_millimeter: "z_axis_steps_per_millimeter",
-    x_axis_max_rate: "x_axis_max_rate",
-    y_axis_max_rate: "y_axis_max_rate",
-    z_axis_max_rate: "z_axis_max_rate",
-    x_axis_acceleration: "x_axis_acceleration",
-    y_axis_acceleration: "y_axis_acceleration",
-    z_axis_acceleration: "z_axis_acceleration",
-    x_axis_max_travel: "x_axis_max_travel",
-    y_axis_max_travel: "y_axis_max_travel",
-    z_axis_max_travel: "z_axis_max_travel",
-}
-
-
-class GRBLEmulator:
-    def __init__(self, driver, units_to_device_matrix):
-        self.driver = driver
-        self.units_to_device_matrix = units_to_device_matrix
-        self.settings = {
-            "step_pulse_microseconds": 10,  # step pulse microseconds
-            "step_idle_delay": 25,  # step idle delay
-            "step_pulse_invert": 0,  # step pulse invert
-            "step_direction_invert": 0,  # step direction invert
-            "invert_step_enable_pin": 0,  # invert step enable pin, boolean
-            "invert_limit_pins": 0,  # invert limit pins, boolean
-            "invert_probe_pin": 0,  # invert probe pin
-            "status_report_options": 255,  # status report options
-            "junction_deviation": 0.010,  # Junction deviation, mm
-            "arc_tolerance": 0.002,  # arc tolerance, mm
-            "report_in_inches": 0,  # Report in inches
-            "soft_limits_enabled": 0,  # Soft limits enabled.
-            "hard_limits_enabled": 0,  # hard limits enabled
-            "homing_cycle_enable": 1,  # Homing cycle enable
-            "homing_direction_invert": 0,  # Homing direction invert
-            "homing_locate_feed_rate": 25.000,  # Homing locate feed rate, mm/min
-            "homing_search_seek_rate": 500.000,  # Homing search seek rate, mm/min
-            "homing_switch_debounce_delay": 250,  # Homing switch debounce delay, ms
-            "homing_switch_pulloff_distance": 1.000,  # Homing switch pull-off distance, mm
-            "maximum_spindle_speed": 1000,  # Maximum spindle speed, RPM
-            "minimum_spindle_speed": 0,  # Minimum spindle speed, RPM
-            "laser_mode_enable": 1,  # Laser mode enable, boolean
-            "x_axis_steps_per_millimeter": 250.000,  # X-axis steps per millimeter
-            "y_axis_steps_per_millimeter": 250.000,  # Y-axis steps per millimeter
-            "z_axis_steps_per_millimeter": 250.000,  # Z-axis steps per millimeter
-            "x_axis_max_rate": 500.000,  # X-axis max rate mm/min
-            "y_axis_max_rate": 500.000,  # Y-axis max rate mm/min
-            "z_axis_max_rate": 500.000,  # Z-axis max rate mm/min
-            "x_axis_acceleration": 10.000,  # X-axis acceleration, mm/s^2
-            "y_axis_acceleration": 10.000,  # Y-axis acceleration, mm/s^2
-            "z_axis_acceleration": 10.000,  # Z-axis acceleration, mm/s^2
-            "x_axis_max_travel": 200.000,  # X-axis max travel mm.
-            "y_axis_max_travel": 200.000,  # Y-axis max travel mm
-            "z_axis_max_travel": 200.000,  # Z-axis max travel mm.
-            "speed": 0,
-            "power": 0,
-        }
-
-        self.compensation = False
-        self.feed_convert = None
-        self.feed_invert = None
-
-        self.speed_scale = 1.0
-        self.rapid_scale = 1.0
-        self.power_scale = 1.0
-        self.move_mode = 0
-        self.x = 0
-        self.y = 0
-        self.z = 0
-
-        # Initially assume mm mode. G21 mm DEFAULT
-        self.scale = UNITS_PER_MM
-
-        # G94 feedrate default, mm mode
-        self.g94_feedrate()
-
-        # G90 default.
-        self.relative = False
-
-        self.reply = None
-        self.channel = None
-
-        self._buffer = list()
-        self._grbl_specific = False
-        self._interpolate = 50
-        self.program_mode = False
-        self.plotcut = None
-
-    def __repr__(self):
-        return "GRBLInterpreter()"
-
-    def grbl_write(self, data):
-        if self.reply:
-            self.reply(data)
-
-    def status_update(self):
-        # Idle, Run, Hold, Jog, Alarm, Door, Check, Home, Sleep
-        pos, state, minor = self.driver.status()
-        x, y = self.units_to_device_matrix.point_in_inverse_space(pos)
-        x /= self.scale
-        y /= self.scale
-        z = 0.0
-        self.x = x
-        self.y = y
-
-        if state == "busy":
-            state = "Run"
-        elif state == "hold":
-            state = "Hold"
-        else:
-            state = "Idle"
-        f = self.feed_invert(self.settings.get("speed", 0))
-        s = self.settings.get("power", 0)
-        return f"<{state}|MPos:{x:.3f},{y:.3f},{z:.3f}|FS:{f},{s}>\r\n"
+    def tick(self):
+        """
+        Each tick reduces countdown by 1. Once countdown is below 20 we call requests for animation.
+        @return:
+        """
+        self.countdown -= 1
+        if self.countdown <= 20:
+            self.scene.request_refresh_for_animation()
+        if self.countdown <= 0:
+            self.scene.request_refresh()
+            self.message = None
+            self.token = None
+        return self.countdown > 0
 
-    def write(self, data):
+    def set_alpha(self, alpha):
         """
-        Process data written to the parser. This is any gcode data realtime commands, grbl-specific commands,
-        or gcode itself.
+        We set the alpha for all the colors.
 
-        @param data:
+        @param alpha:
         @return:
         """
-        if isinstance(data, str):
-            data = data.encode()
-        for c in data:
-            # Process and extract any realtime grbl commands.
-            if c == ord("?"):
-                self.grbl_write(self.status_update())
-            elif c == ord("~"):
-                try:
-                    self.driver.resume()
-                except AttributeError:
-                    pass
-            elif c == ord("!"):
-                try:
-                    self.driver.pause()
-                except AttributeError:
-                    pass
-            elif c in (ord("\r"), ord("\n")):
-                # Process CRLF endlines
-                line = "".join(self._buffer)
-                if self._grbl_specific:
-                    self._grbl_specific = False
-                    cmd = self._grbl_special(line)
-                else:
-                    cmd = self._process_gcode(line)
-                self._buffer.clear()
-                if cmd == 0:  # Execute GCode.
-                    self.grbl_write("ok\r\n")
-                else:
-                    self.grbl_write("error:%d\r\n" % cmd)
-            elif c == 0x08:
-                # Process Backspaces.
-                if self._buffer:
-                    del self._buffer[-1]
-            elif c == 0x18:
-                try:
-                    self.driver.reset()
-                except AttributeError:
-                    pass
-            elif c > 0x80:
-                if c == 0x84:
-                    # Safety Door
-                    pass
-                elif c == 0x85:
-                    try:
-                        self.driver.jog_abort()
-                    except AttributeError:
-                        pass
-                elif c == 0x90:
-                    self.speed_scale = 1.0
-                    try:
-                        self.driver.set("speed_factor", self.speed_scale)
-                    except AttributeError:
-                        pass
-                elif c == 0x91:
-                    self.speed_scale *= 1.1
-                    try:
-                        self.driver.set("speed_factor", self.speed_scale)
-                    except AttributeError:
-                        pass
-                elif c == 0x92:
-                    self.speed_scale *= 0.9
-                    try:
-                        self.driver.set("speed_factor", self.speed_scale)
-                    except AttributeError:
-                        pass
-                elif c == 0x93:
-                    self.speed_scale *= 1.01
-                    try:
-                        self.driver.set("speed_factor", self.speed_scale)
-                    except AttributeError:
-                        pass
-                elif c == 0x94:
-                    self.speed_scale *= 0.99
-                    try:
-                        self.driver.set("speed_factor", self.speed_scale)
-                    except AttributeError:
-                        pass
-                elif c == 0x95:
-                    self.rapid_scale = 1.0
-                    try:
-                        self.driver.set("rapid_factor", self.rapid_scale)
-                    except AttributeError:
-                        pass
-                elif c == 0x96:
-                    self.rapid_scale = 0.5
-                    try:
-                        self.driver.set("rapid_factor", self.rapid_scale)
-                    except AttributeError:
-                        pass
-                elif c == 0x97:
-                    self.rapid_scale = 0.25
-                    try:
-                        self.driver.set("rapid_factor", self.rapid_scale)
-                    except AttributeError:
-                        pass
-                elif c == 0x99:
-                    self.power_scale = 1.0
-                    try:
-                        self.driver.set("power_factor", self.power_scale)
-                    except AttributeError:
-                        pass
-                elif c == 0x9A:
-                    self.power_scale *= 1.1
-                    try:
-                        self.driver.set("power_factor", self.power_scale)
-                    except AttributeError:
-                        pass
-                elif c == 0x9B:
-                    self.power_scale *= 0.9
-                    try:
-                        self.driver.set("power_factor", self.power_scale)
-                    except AttributeError:
-                        pass
-                elif c == 0x9C:
-                    self.power_scale *= 1.01
-                    try:
-                        self.driver.set("power_factor", self.power_scale)
-                    except AttributeError:
-                        pass
-                elif c == 0x9D:
-                    self.power_scale *= 0.99
-                    try:
-                        self.driver.set("power_factor", self.power_scale)
-                    except AttributeError:
-                        pass
-                elif c == 0x9E:
-                    # Toggle Spindle Stop
-                    pass
-                elif c == 0xA0:
-                    # Toggle Flood Coolant
-                    pass
-                elif c == 0xA1:
-                    # Toggle Mist Coolant
-                    pass
-            elif c == ord("$"):
-                if not self._buffer:
-                    # First character is "$" this is special grbl.
-                    self._grbl_specific = True
-                self._buffer.append(chr(c))
-            else:
-                self._buffer.append(chr(c))
+        if alpha != self.alpha:
+            self.alpha = alpha
+            self.brush_color.SetRGBA(0xFFFFFF | alpha << 24)
+            self.pen_color.SetRGBA(0x70FF70 | alpha << 24)
+            self.font_color.SetRGBA(0x000000 | alpha << 24)
+            self.brush.SetColour(self.brush_color)
+            self.pen.SetColour(self.pen_color)
 
-    def _grbl_special(self, data):
+    def draw(self, gc: wx.GraphicsContext):
+        if not self.message:
+            return
+        alpha = 255
+        if self.countdown <= 20:
+            alpha = int(self.countdown * 12.5)
+        self.set_alpha(alpha)
+
+        width = self.right - self.left
+        height = self.bottom - self.top
+        text_size = height
+
+        while self.text_height > height or self.text_width > width:
+            # If we do not fit in the box, decrease size
+            text_size *= 0.9
+            try:
+                self.font.SetFractionalPointSize(text_size)
+            except AttributeError:
+                self.font.SetPointSize(int(text_size))
+            gc.SetFont(self.font, self.font_color)
+            self.text_width, self.text_height = gc.GetTextExtent(self.message)
+        if text_size == height:
+            gc.SetFont(self.font, self.font_color)
+        gc.SetPen(self.pen)
+        gc.SetBrush(self.brush)
+        gc.DrawRectangle(
+            self.left, self.top, self.right - self.left, self.bottom - self.top
+        )
+
+        toast_x = self.left + (width - self.text_width) / 2.0
+        toast_y = self.top
+        gc.DrawText(self.message, toast_x, toast_y)
+
+    def start_threaded(self):
+        """
+        First start of threaded animate. Refresh to draw.
+        @return:
         """
-        GRBL special commands are commands beginning with $ that do purely grbl specific things.
+        self.scene.request_refresh()
 
-        @param data:
+    def stop_threaded(self):
+        """
+        Stop of threaded animate. Unset text dims and delete the toast.
         @return:
         """
-        if data == "$":
-            self.grbl_write(
-                "[HLP:$$ $# $G $I $N $x=val $Nx=line $J=line $SLP $C $X $H ~ ! ? ctrl-x]\r\n"
-            )
-            return 0
-        elif data == "$$":
-            for s in lookup:
-                v = self.settings.get(lookup[s], 0)
-                if isinstance(v, int):
-                    self.grbl_write("$%d=%d\r\n" % (s, v))
-                elif isinstance(v, float):
-                    self.grbl_write("$%d=%.3f\r\n" % (s, v))
-            return 0
-        if GRBL_SET_RE.match(data):
-            settings = list(GRBL_SET_RE.findall(data))[0]
-            index = settings[0]
-            value = settings[1]
-            try:
-                name = lookup[index]
-                c = self.settings[name]
-            except KeyError:
-                return 3
-            if isinstance(c, float):
-                self.settings[name] = float(value)
-            else:
-                self.settings[name] = int(value)
-            return 0
-        elif data == "$I":
-            # View Build Info
-            return 0
-        elif data == "$G":
-            # View GCode Parser state
-            return 3
-        elif data == "$N":
-            # View saved start up code.
-            return 3
-        elif data == "$H":
-            if self.settings["homing_cycle_enable"]:
-                try:
-                    self.driver.physical_home()
-                except AttributeError:
-                    pass
-                try:
-                    self.driver.move_abs(0, 0)
-                except AttributeError:
-                    pass
-                self.x = 0
-                self.y = 0
-                return 0
-            else:
-                return 5  # Homing cycle not enabled by settings.
-        elif data.startswith("$J="):
-            """
-            $Jx=line - Run jogging motion
-
-            New to Grbl v1.1, this command will execute a special jogging motion. There are three main
-            differences between a jogging motion and a motion commanded by a g-code line.
-
-                Like normal g-code commands, several jog motions may be queued into the planner buffer,
-                but the jogging can be easily canceled by a jog-cancel or feed-hold real-time command.
-                Grbl will immediately hold the current jog and then automatically purge the buffers
-                of any remaining commands.
-                Jog commands are completely independent of the g-code parser state. It will not change
-                any modes like G91 incremental distance mode. So, you no longer have to make sure
-                that you change it back to G90 absolute distance mode afterwards. This helps reduce
-                the chance of starting with the wrong g-code modes enabled.
-                If soft-limits are enabled, any jog command that exceeds a soft-limit will simply
-                return an error. It will not throw an alarm as it would with a normal g-code command.
-                This allows for a much more enjoyable and fluid GUI or joystick interaction.
-
-            Executing a jog requires a specific command structure, as described below:
-
-                The first three characters must be '$J=' to indicate the jog.
-
-                The jog command follows immediate after the '=' and works like a normal G1 command.
-
-                Feed rate is only interpreted in G94 units per minute. A prior G93 state is
-                ignored during jog.
-
-                Required words:
-                    XYZ: One or more axis words with target value.
-                    F - Feed rate value. NOTE: Each jog requires this value and is not treated as modal.
-
-                Optional words: Jog executes based on current G20/G21 and G90/G91 g-code parser state.
-                If one of the following optional words is passed, that state is overridden for one command only.
-                    G20 or G21 - Inch and millimeter mode
-                    G90 or G91 - Absolute and incremental distances
-                    G53 - Move in machine coordinates
-
-                All other g-codes, m-codes, and value words are not accepted in the jog command.
-
-                Spaces and comments are allowed in the command. These are removed by the pre-parser.
-
-                Example: G21 and G90 are active modal states prior to jogging. These are sequential commands.
-                    $J=X10.0 Y-1.5 will move to X=10.0mm and Y=-1.5mm in work coordinate frame (WPos).
-                    $J=G91 G20 X0.5 will move +0.5 inches (12.7mm) to X=22.7mm (WPos).
-                    Note that G91 and G20 are only applied to this jog command.
-                    $J=G53 Y5.0 will move the machine to Y=5.0mm in the machine coordinate frame (MPos).
-                    If the work coordinate offset for the y-axis is 2.0mm, then Y is 3.0mm in (WPos).
-
-            Jog commands behave almost identically to normal g-code streaming. Every jog command
-            will return an 'ok' when the jogging motion has been parsed and is setup for execution.
-            If a command is not valid or exceeds a soft-limit, Grbl will return an 'error:'.
-            Multiple jogging commands may be queued in sequence.
-            """
-            data = data[3:]
-            # self._process_gcode(data, jog=True)
-            return 3  # not yet supported
-        else:
-            return 3  # GRBL '$' system command was not recognized or supported.
+        self.scene._toast = None
+        self.text_height = float("inf")
+        self.text_width = float("inf")
 
-    def _process_gcode(self, data, jog=False):
+    def set_message(self, message, token=-1, duration=100):
         """
-        Processes the gcode commands which are parsed into different dictionary objects.
+        Sets the message. If the token is different, we reset the text position.
 
-        @param data: gcode line to process
-        @param jog: indicate this gcode line is operated as a jog.
+        We always reset the duration.
+
+        @param message:
+        @param token:
+        @param duration:
         @return:
         """
-        gc = {}
-        for c in _tokenize_code(data):
-            g = c[0]
-            if g not in gc:
-                gc[g] = []
-            if len(c) >= 2:
-                gc[g].append(c[1])
-            else:
-                gc[g].append(None)
-        if "m" in gc:
-            for v in gc["m"]:
-                if v in (0, 1):
-                    # Stop or Unconditional Stop
-                    try:
-                        self.driver.rapid_mode()
-                    except AttributeError:
-                        pass
-                elif v == 2:
-                    # Program End
-                    try:
-                        self.driver.plot_start()
-                    except AttributeError:
-                        pass
-                    try:
-                        self.driver.rapid_mode()
-                    except AttributeError:
-                        pass
-                    return 0
-                elif v == 30:
-                    # Program Stop
-                    try:
-                        self.driver.rapid_mode()
-                    except AttributeError:
-                        pass
-                    return 0
-                elif v in (3, 4):
-                    # Spindle On - Clockwise/CCW Laser Mode
-                    self.program_mode = True
-                elif v == 5:
-                    # Spindle Off - Laser Mode
-                    if self.program_mode:
-                        try:
-                            self.plot_commit()
-                            self.driver.plot_start()
-                        except AttributeError:
-                            pass
-                    try:
-                        self.driver.rapid_mode()
-                    except AttributeError:
-                        pass
-                    self.program_mode = False
-                elif v == 7:
-                    #  Mist coolant control.
+        if token != self.token or token == -1:
+            self.text_height = float("inf")
+            self.text_width = float("inf")
+        self.message = message
+        self.token = token
+        self.countdown = duration
+
+
+class Scene(Module, Job):
+    """
+    The Scene Module holds all the needed references to widgets and catches the events from the ScenePanel which
+    stores this object primarily.
+
+    Scene overloads both Module being registered in "module/Scene" and the Job to handle the refresh.
+
+    The Scene is the infinite space of the scene as seen through the panel's viewpoint. It serves to zoom, pan, and
+    manipulate various elements. This is done through a matrix which translates the scene space to window space. The
+    scene space to window space. The widgets are stored in a tree within the scene. The primary widget is the
+    SceneSpaceWidget which draws elements in two different forms. It first draws the scene and all scenewidgets added
+    to the scene and then the interface widget which contains all the non-scene widget elements.
+    """
+
+    def __init__(self, context, path, gui, pane=None, **kwargs):
+        Module.__init__(self, context, path)
+        Job.__init__(
+            self,
+            job_name=f"Scene-{path}",
+            process=self.refresh_scene,
+            conditional=lambda: self.screen_refresh_is_requested,
+            run_main=True,
+        )
+        self.log = context.channel("scene")
+        self.log_events = context.channel("scene-events")
+        self.gui = gui
+        self.pane = pane
+        self.hittable_elements = list()
+        self.hit_chain = list()
+        self.widget_root = SceneSpaceWidget(self)
+        self.screen_refresh_lock = threading.Lock()
+        self.interval = 1.0 / 60.0  # 60fps
+        self.last_position = None
+        self._down_start_time = None
+        self._down_start_pos = None
+        self._cursor = None
+        self.suppress_changes = True
+
+        self.colors = GuiColors(self.context)
+
+        self.screen_refresh_is_requested = True
+        self.background_brush = wx.Brush(self.colors.color_background)
+        self.has_background = False
+        # If set this color will be used for the scene background (used during burn)
+        self.overrule_background = None
+
+        self._animating = list()
+        self._animate_lock = threading.Lock()
+        self._adding_widgets = list()
+        self._animate_job = Job(
+            self._animate_scene,
+            job_name=f"Animate-Scene{path}",
+            run_main=True,
+            interval=1.0 / 60.0,
+        )
+        self._toast = None
+
+    def module_open(self, *args, **kwargs):
+        context = self.context
+        context.schedule(self)
+        context.setting(int, "draw_mode", 0)
+        context.setting(bool, "mouse_zoom_invert", False)
+        context.setting(bool, "mouse_pan_invert", False)
+        context.setting(bool, "mouse_wheel_pan", False)
+        context.setting(float, "zoom_factor", 0.1)
+        context.setting(float, "pan_factor", 25.0)
+        context.setting(int, "fps", 40)
+        if context.fps <= 0:
+            context.fps = 60
+        self.interval = 1.0 / float(context.fps)
+        self.commit()
+
+    def commit(self):
+        context = self.context
+        self._init_widget(self.widget_root, context)
+
+    def module_close(self, *args, **kwargs):
+        self._final_widget(self.widget_root, self.context)
+        self.screen_refresh_lock.acquire()  # calling shutdown live locks here since it's already shutting down.
+        self.context.unschedule(self)
+
+    def _init_widget(self, widget, context):
+        try:
+            widget.init(context)
+        except AttributeError:
+            pass
+        for w in widget:
+            if w is None:
+                continue
+            self._init_widget(w, context)
+
+    def _final_widget(self, widget, context):
+        try:
+            widget.final(context)
+        except AttributeError:
+            pass
+        for w in widget:
+            if w is None:
+                continue
+            self._final_widget(w, context)
+
+    def set_fps(self, fps):
+        """
+        Set the scene frames per second which sets the interval for the Job.
+        """
+        if fps == 0:
+            fps = 1
+        self.context.fps = fps
+        self.interval = 1.0 / float(self.context.fps)
+
+    def request_refresh_for_animation(self):
+        """Called on the various signals trying to animate the screen."""
+        try:
+            if self.context.draw_mode & DRAW_MODE_ANIMATE == 0:
+                self.request_refresh()
+        except AttributeError:
+            pass
+
+    def request_refresh(self, origin=None, *args):
+        """Request an update to the scene."""
+        try:
+            if self.context.draw_mode & DRAW_MODE_REFRESH == 0:
+                self.screen_refresh_is_requested = True
+        except AttributeError:
+            pass
+
+    def animate(self, widget):
+        with self._animate_lock:
+            if widget not in self._adding_widgets:
+                self._adding_widgets.append(widget)
+        if self.log:
+            self.log("Start Animation...")
+        self.context.schedule(self._animate_job)
+
+    def _animate_scene(self, *args, **kwargs):
+        if self.log:
+            self.log("Animating Scene...")
+        if self._adding_widgets:
+            with self._animate_lock:
+                animate_add = list(self._adding_widgets)
+                self._adding_widgets.clear()
+            for widget in animate_add:
+                self._animating.append(widget)
+                try:
+                    widget.start_threaded()
+                except AttributeError:
                     pass
-                elif v == 8:
-                    # Flood coolant On
-                    try:
-                        self.driver.signal("coolant", True)
-                    except AttributeError:
-                        pass
-                elif v == 9:
-                    # Flood coolant Off
-                    try:
-                        self.driver.signal("coolant", False)
-                    except AttributeError:
-                        pass
-                elif v == 56:
-                    pass  # Parking motion override control.
-                elif v == 911:
-                    pass  # Set TMC2130 holding currents
-                elif v == 912:
-                    pass  # M912: Set TMC2130 running currents
-                else:
-                    return 20
-            del gc["m"]
-        if "g" in gc:
-            for v in gc["g"]:
-                if v is None:
-                    return 2
-                elif v == 0:
-                    # G0 Rapid Move.
-                    self.move_mode = 0
-                elif v == 1:
-                    # G1 Cut Move.
-                    self.move_mode = 1
-                elif v == 2:
-                    # G2 CW_ARC
-                    self.move_mode = 2
-                elif v == 3:
-                    # G3 CCW_ARC
-                    self.move_mode = 3
-                elif v == 4:
-                    # DWELL
-                    t = 0
-                    if "p" in gc:
-                        t = float(gc["p"].pop()) / 1000.0
-                        if len(gc["p"]) == 0:
-                            del gc["p"]
-                    if "s" in gc:
-                        t = float(gc["s"].pop())
-                        if len(gc["s"]) == 0:
-                            del gc["s"]
-                    if self.program_mode:
-                        self.plot_commit()
-                        self.plot(WaitCut(t))
-                    else:
+        if self._animating:
+            for idx in range(len(self._animating) - 1, -1, -1):
+                widget = self._animating[idx]
+                try:
+                    more = widget.tick()
+                    if not more:
                         try:
-                            self.driver.wait(t)
+                            widget.stop_threaded()
                         except AttributeError:
                             pass
-                elif v == 17:
-                    # Set XY coords.
-                    pass
-                elif v == 18:
-                    # Set the XZ plane for arc.
-                    return 2
-                elif v == 19:
-                    # Set the YZ plane for arc.
-                    return 2
-                elif v in (20, 70):
-                    # g20 is inch mode.
-                    self.scale = UNITS_PER_INCH
-                elif v in (21, 71):
-                    # g21 is mm mode. 39.3701 mils in a mm
-                    self.scale = UNITS_PER_MM
-                elif v == 28:
-                    # Move to Origin (Home)
-                    try:
-                        self.driver.home()
-                    except AttributeError:
-                        pass
-                    try:
-                        self.driver.move_abs(0, 0)
-                    except AttributeError:
-                        pass
-                    self.x = 0
-                    self.y = 0
-                    self.z = 0
-                elif v == 38.1:
-                    # Touch Plate
-                    pass
-                elif v == 38.2:
-                    # Probe towards workpiece, stop on contact. Signal error.
-                    pass
-                elif v == 38.3:
-                    # Probe towards workpiece, stop on contact.
-                    pass
-                elif v == 38.4:
-                    # Probe away from workpiece, signal error
-                    pass
-                elif v == 38.5:
-                    # Probe away from workpiece.
-                    pass
-                elif v == 40.0:
-                    # Compensation Off
-                    self.compensation = False
-                elif v == 43.1:
-                    pass  # Dynamic tool Length offsets
-                elif v == 49:
-                    # Cancel tool offset.
-                    pass  # Dynamic tool length offsets
-                elif v == 53:
-                    # Absolute movement non-modal command.
-                    pass
-                elif 54 <= v <= 59:
-                    # Coord System Select
-                    pass  # Work Coordinate Systems
-                elif v == 61:
-                    # Exact path control mode. GRBL required
-                    pass
-                elif v == 80:
-                    # Motion mode cancel. Canned cycle.
-                    pass
-                elif v == 90:
-                    # Set to Absolute Positioning
-                    self.relative = False
-                elif v == 91:
-                    # Set to Relative Positioning
-                    self.relative = True
-                elif v == 92:
-                    # Set Position.
-                    # Change the current coords without moving.
-                    pass  # Coordinate Offset TODO: Implement
-                elif v == 92.1:
-                    # Clear Coordinate offset set by 92.
-                    pass  # Clear Coordinate offset TODO: Implement
-                elif v == 93:
-                    # Feed Rate Mode (Inverse Time Mode)
-                    self.g93_feedrate()
-                elif v == 94:
-                    # Feed Rate Mode (Units Per Minute)
-                    self.g94_feedrate()
-                else:
-                    return 20  # Unsupported or invalid g-code command found in block.
-            del gc["g"]
-
-        if "comment" in gc:
-            if self.channel:
-                self.channel(f'Comment: {gc["comment"]}')
-            del gc["comment"]
-
-        if "f" in gc:  # Feed_rate
-            for v in gc["f"]:
-                if v is None:
-                    return 2  # Numeric value format is not valid or missing an expected value.
-                feed_rate = self.feed_convert(v)
-                if self.settings.get("speed", 0) != feed_rate:
-                    self.settings["speed"] = feed_rate
-                    try:
-                        self.driver.set("speed", v)
-                    except AttributeError:
-                        pass
-                    self.plot_commit()  # Speed change means plot change
-            del gc["f"]
-        if "s" in gc:
-            for v in gc["s"]:
-                if v is None:
-                    return 2  # Numeric value format is not valid or missing an expected value.
-                if 0.0 < v <= 1.0:
-                    v *= 1000  # numbers between 0-1 are taken to be in range 0-1.
-                if self.settings["power"] != v:
-                    try:
-                        self.driver.set("power", v)
-                    except AttributeError:
-                        pass
-                    self.settings["power"] = v
-            del gc["s"]
-        if "z" in gc:
-            oz = self.z
-            v = gc["z"].pop(0)
-            if v is None:
-                z = 0
-            else:
-                z = self.scale * v
-            if len(gc["z"]) == 0:
-                del gc["z"]
-            self.z = z
-            if oz != self.z:
-                try:
-                    self.plot_commit()  # We plot commit on z level change
-                    self.driver.axis("z", self.z)
+                        del self._animating[idx]
                 except AttributeError:
                     pass
+        if not self._animating:
+            self._animate_job.cancel()
+            if self.log:
+                self.log("Removing Animation...")
 
-        if (
-            "x" in gc
-            or "y" in gc
-            or ("i" in gc or "j" in gc and self.move_mode in (2, 3))
-        ):
-            ox = self.x
-            oy = self.y
-            if "x" in gc:
-                x = gc["x"].pop(0)
-                if x is None:
-                    x = 0
-                else:
-                    x *= self.scale
-                if len(gc["x"]) == 0:
-                    del gc["x"]
-            else:
-                if self.relative:
-                    x = 0
-                else:
-                    x = self.x
-            if "y" in gc:
-                y = gc["y"].pop(0)
-                if y is None:
-                    y = 0
-                else:
-                    y *= self.scale
-                if len(gc["y"]) == 0:
-                    del gc["y"]
-            else:
-                if self.relative:
-                    y = 0
-                else:
-                    y = self.y
-
-            if self.relative:
-                nx = self.x + x
-                ny = self.y + y
+    def refresh_scene(self, *args, **kwargs):
+        """
+        Called by the Scheduler at a given the specified framerate.
+        Called in the UI thread.
+        """
+        if self.screen_refresh_is_requested:
+            if self.screen_refresh_lock.acquire(timeout=0.2):
+                try:
+                    self.update_buffer_ui_thread()  # May hit runtime error.
+                    self.gui.Refresh()
+                    self.gui.Update()
+                except RuntimeError:
+                    pass
+                self.screen_refresh_is_requested = False
+                self.screen_refresh_lock.release()
             else:
-                nx = x
-                ny = y
-            if self.move_mode == 0:
-                self.plot_commit()
-                if self.program_mode:
-                    self.plot_location(nx, ny, 0)
-                else:
-                    try:
-                        self.driver.move_abs(nx, ny)
-                        self.x = nx
-                        self.y = ny
-                    except AttributeError:
-                        pass
-            elif self.move_mode == 1:
-                self.plot_location(nx, ny, self.settings["power"])
-            elif self.move_mode in (2, 3):
-                # 2 = CW ARC
-                # 3 = CCW ARC
-
-                cx = ox
-                cy = oy
-                if "i" in gc:
-                    ix = gc["i"].pop(0)  # * self.scale
-                    cx += ix
-                if "j" in gc:
-                    jy = gc["j"].pop(0)  # * self.scale
-                    cy += jy
-                if "r" in gc:
-                    # Strictly speaking this uses the R parameter, but that wasn't coded.
-                    arc = Arc(
-                        start=(ox, oy),
-                        center=(cx, cy),
-                        end=(nx, ny),
-                        ccw=self.move_mode == 3,
-                    )
-                    power = self.settings["power"]
-                    for p in range(self._interpolate + 1):
-                        x, y = arc.point(p / self._interpolate)
-                        self.plot_location(x, y, power)
-                else:
-                    arc = Arc(
-                        start=(ox, oy),
-                        center=(cx, cy),
-                        end=(nx, ny),
-                        ccw=self.move_mode == 3,
-                    )
-                    power = self.settings["power"]
-                    for p in range(self._interpolate + 1):
-                        x, y = arc.point(p / self._interpolate)
-                        self.plot_location(x, y, power)
-        return 0
+                self.screen_refresh_is_requested = False
 
-    def plot_location(self, x, y, power):
-        """
-        Adds this particular location to the current plotcut.
+    def update_buffer_ui_thread(self):
+        """Performs redrawing of the data in the UI thread."""
+        dm = self.context.draw_mode
+        buf = self.gui._Buffer
+        if buf is None or buf.GetSize() != self.gui.ClientSize or not buf.IsOk():
+            self.gui.set_buffer()
+            buf = self.gui._Buffer
+        dc = wx.MemoryDC()
+        dc.SelectObject(buf)
+        if self.overrule_background is None:
+            self.background_brush.SetColour(self.colors.color_background)
+        else:
+            self.background_brush.SetColour(self.overrule_background)
+        dc.SetBackground(self.background_brush)
+        dc.Clear()
+        w, h = dc.Size
+        if dm & DRAW_MODE_FLIPXY != 0:
+            dc.SetUserScale(-1, -1)
+            dc.SetLogicalOrigin(w, h)
+        gc = wx.GraphicsContext.Create(dc)
+        gc.dc = dc
+        gc.Size = dc.Size
+
+        font = wx.Font(14, wx.FONTFAMILY_SWISS, wx.FONTSTYLE_NORMAL, wx.FONTWEIGHT_BOLD)
+        gc.SetFont(font, wx.BLACK)
+        self.draw(gc)
+        if dm & DRAW_MODE_INVERT != 0:
+            dc.Blit(0, 0, w, h, dc, 0, 0, wx.SRC_INVERT)
+        gc.Destroy()
+        dc.SelectObject(wx.NullBitmap)
+        del gc.dc
+        del dc
+
+    def toast(self, message, token=-1):
+        if self._toast is None:
+            self._toast = SceneToast(
+                self, self.x(0.1), self.y(0.8), self.x(0.9), self.y(0.9)
+            )
+            self._toast.set_message(message, token)
+            self.animate(self._toast)
+        else:
+            self._toast.set_message(message, token)
+            self.animate(self._toast)
 
-        Or, starts a new plotcut if one is not already started.
+    def x(self, v):
+        width, height = self.gui.ClientSize
+        return width * v
 
-        First plotcut is a 0-power move to the current position. X and Y are set to plotted location
+    def y(self, v):
+        width, height = self.gui.ClientSize
+        return height * v
 
-        @param x:
-        @param y:
-        @param power:
-        @return:
+    def cell(self):
+        width, height = self.gui.ClientSize
+        return min(width / XCELLS, height / YCELLS)
+
+    def _signal_widget(self, widget, *args, **kwargs):
+        """
+        Calls the signal widget with the given args. Calls signal for the entire widget node tree.
         """
-        matrix = self.units_to_device_matrix
-        if self.plotcut is None:
-            ox, oy = matrix.transform_point([self.x, self.y])
-            self.plotcut = PlotCut(settings=dict(self.settings))
-            self.plotcut.plot_init(int(round(ox)), int(round(oy)))
-        tx, ty = matrix.transform_point([x, y])
-        self.plotcut.plot_append(int(round(tx)), int(round(ty)), power)
-        if not self.program_mode:
-            self.plot_commit()
-        self.x = x
-        self.y = y
+        try:
+            widget.signal(*args)
+        except AttributeError:
+            pass
+        for w in widget:
+            if w is None:
+                continue
+            self._signal_widget(w, *args, **kwargs)
 
-    def plot_commit(self):
+    def notify_added_to_parent(self, parent):
         """
-        Force commits the old plotcut and unsets the current plotcut.
+        Called when node is added to parent. Notifying the scene as a whole.
+        """
+        pass
 
-        @return:
+    def notify_added_child(self, child):
         """
-        if self.plotcut is None:
-            return
-        self.plot(self.plotcut)
-        self.plotcut = None
+        Called when a child is added to the tree. Notifies scene as a whole.
+        """
+        try:
+            child.init(self.context)
+        except AttributeError:
+            pass
+
+    def notify_removed_from_parent(self, parent):
+        """
+        Called when a widget is removed from its parent. Notifies scene as a whole.
+        """
+        pass
 
-    def plot(self, plot):
+    def notify_removed_child(self, child):
+        """
+        Called when a widget's child is removed. Notifies scene as a whole.
+        """
         try:
-            self.driver.plot(plot)
+            child.final(self.context)
         except AttributeError:
             pass
-        if not self.program_mode:
-            # If we plotted this, and we aren't in program mode execute all of these commands right away
-            try:
-                self.driver.plot_start()
-            except AttributeError:
-                pass
 
-    def g93_feedrate(self):
+    def notify_moved_child(self, child):
         """
-        Feed Rate in Minutes / Unit
-        G93 - is Inverse Time Mode. In inverse time feed rate mode, an F word means the move
-        should be completed in [one divided by the F number] minutes. For example, if the
-        F number is 2.0, the move should be completed in half a minute.
-        When the inverse time feed rate mode is active, an F word must appear on every line
-        which has a G1, G2, or G3 motion, and an F word on a line that does not have
-        G1, G2, or G3 is ignored. Being in inverse time feed rate mode does not
-        affect G0 (rapid move) motions.
-        @return:
+        Called when a widget is moved from one widget parent to another.
+        """
+        pass
+
+    def draw(self, canvas):
+        """
+        Scene Draw routine to be called on paint when the _Buffer bitmap needs to be redrawn.
+        """
+        if self.widget_root is not None and not self.suppress_changes:
+            self.widget_root.draw(canvas)
+            if self.log:
+                self.log("Redraw Canvas")
+        if self._toast is not None:
+            self._toast.draw(canvas)
+
+    def convert_scene_to_window(self, position):
+        """
+        Convert the scene space to the window space for a particular point.
+        The position given in the scene, produces the position on the screen.
+        """
+        point = self.widget_root.scene_widget.matrix.point_in_matrix_space(position)
+        return point[0], point[1]
+
+    def convert_window_to_scene(self, position):
+        """
+        Convert the window space to the scene space for a particular point.
+        The position given is the window pixel, produces the position within the scene.
         """
+        point = self.widget_root.scene_widget.matrix.point_in_inverse_space(position)
+        return point[0], point[1]
 
-        if self.scale == UNITS_PER_INCH:
-            self.feed_convert = lambda s: (60.0 * self.scale / UNITS_PER_INCH) / s
-            self.feed_invert = lambda s: (60.0 * UNITS_PER_INCH / self.scale) / s
+    def rebuild_hittable_chain(self):
+        """
+        Iterates through the tree and adds all hittable elements to the hittable_elements list.
+        This is dynamically rebuilt on the mouse event.
+        """
+        self.hittable_elements.clear()
+        self.rebuild_hit_chain(self.widget_root, _reused_identity_widget)
+
+    def rebuild_hit_chain(self, current_widget, current_matrix=None):
+        """
+        Iterates through the hit chain to find elements which respond to their hit() function that they are HITCHAIN_HIT
+        and registers this within the hittable_elements list if they are able to hit at the current time. Given the
+        dimensions of the widget and the current matrix within the widget tree.
+
+        HITCHAIN_HIT means that this is a hit value and should the termination of this branch of the widget tree.
+        HITCHAIN_DELEGATE means that this is not a hittable widget and should not receive mouse events.
+        HITCHAIN_HIT_AND_DELEGATE means that this is a hittable widget, but other widgets within it might also matter.
+        HITCHAIN_DELEGATE_AND_HIT means that other widgets in the tree should be checked first, but after those this
+        widget should be checked.
+
+        The hitchain is the current matrix and current widget in the order of depth.
+
+        """
+        # If there is a matrix for the widget concatenate it.
+        if current_widget.matrix is not None:
+            matrix_within_scene = Matrix(current_widget.matrix)
+            matrix_within_scene.post_cat(current_matrix)
         else:
-            self.feed_convert = lambda s: (60.0 * self.scale / UNITS_PER_MM) / s
-            self.feed_invert = lambda s: (60.0 * UNITS_PER_MM / self.scale) / s
+            matrix_within_scene = Matrix(current_matrix)
 
-    def g94_feedrate(self):
+        # Add to list and recurse for children based on response.
+        response = current_widget.hit()
+        if response == HITCHAIN_HIT:
+            self.hittable_elements.append((current_widget, matrix_within_scene))
+        # elif response == HITCHAIN_HIT_WITH_PRIORITY:
+        #    self.hittable_elements.insert(0, (current_widget, matrix_within_scene))
+        elif response == HITCHAIN_DELEGATE:
+            for w in current_widget:
+                self.rebuild_hit_chain(w, matrix_within_scene)
+        elif response == HITCHAIN_HIT_AND_DELEGATE:
+            self.hittable_elements.append((current_widget, matrix_within_scene))
+            for w in current_widget:
+                self.rebuild_hit_chain(w, matrix_within_scene)
+        elif response == HITCHAIN_DELEGATE_AND_HIT:
+            for w in current_widget:
+                self.rebuild_hit_chain(w, matrix_within_scene)
+            self.hittable_elements.append((current_widget, matrix_within_scene))
+
+    def find_hit_chain(self, position):
         """
-        Feed Rate in Units / Minute
-        G94 - is Units per Minute Mode. In units per minute feed mode, an F word is interpreted
-        to mean the controlled point should move at a certain number of inches per minute,
-        millimeters per minute, or degrees per minute, depending upon what length units
-        are being used and which axis or axes are moving.
-        @return:
+        Processes the hittable_elements list and find which elements are hit at a given position.
+
+        This gives the actual hits with regard to the position of the event.
         """
+        self.hit_chain.clear()
+        for current_widget, current_matrix in self.hittable_elements:
+            try:
+                hit_point = Point(current_matrix.point_in_inverse_space(position))
+            except ZeroDivisionError:
+                current_matrix.reset()
+                # Some object is zero matrixed, reset it.
+                return
+            if current_widget.contains(hit_point.x, hit_point.y):
+                self.hit_chain.append((current_widget, current_matrix))
+
+    def event(
+        self, window_pos, event_type="", nearest_snap=None, modifiers=None, keycode=None
+    ):
+        """
+        Scene event code. Processes all the events for a particular mouse event bound in the ScenePanel.
+
+        Many mousedown events trigger the specific start of the hitchain matching, and processes the given hitchain.
+        Subsequent delegation of the events will be processed with regard to whether the matching event struck a
+        particular widget. This permits a hit widget to get all further events.
+
+        Responses to events are:
+        RESPONSE_ABORT: Aborts any future mouse events within the sequence.
+        RESPONSE_CONSUME: Consumes the event and prevents any event further in the hitchain from getting the event
+        RESPONSE_CHAIN: Permit the event to move to the next event in the hitchain
+        RESPONSE_DROP: Remove this item from the hitchain and continue to process the events. Future events will not
+        consider the dropped element within the hitchain.
+        """
+        if self.log_events:
+            self.log_events(
+                f"{event_type}: {str(window_pos)} {str(nearest_snap)} {str(modifiers)} {str(keycode)}"
+            )
+
+        if window_pos is None:
+            # Capture Lost
+            for i, hit in enumerate(self.hit_chain):
+                if hit is None:
+                    continue  # Element was dropped.
+                current_widget, current_matrix = hit
+                current_widget.event(
+                    window_pos=None,
+                    scene_pos=None,
+                    event_type=event_type,
+                    nearest_snap=None,
+                    modifiers=None,
+                )
+            return
+        if self.last_position is None:
+            self.last_position = window_pos
+        dx = window_pos[0] - self.last_position[0]
+        dy = window_pos[1] - self.last_position[1]
+        window_pos = (
+            window_pos[0],
+            window_pos[1],
+            self.last_position[0],
+            self.last_position[1],
+            dx,
+            dy,
+        )
+        self.last_position = window_pos
+        previous_top_element = None
+        try:
+            idx = 0
+            while idx < len(self.hit_chain):
+                if not self.hit_chain[idx][0].transparent:
+                    previous_top_element = self.hit_chain[idx][0]
+                    break
+                idx += 1
+
+        except (IndexError, TypeError):
+            pass
+
+        if event_type in (
+            "key_down",
+            "key_up",
+        ):
+            # print("Keyboard-Event raised: %s" % event_type)
+            self.rebuild_hittable_chain()
+            for current_widget, current_matrix in self.hittable_elements:
+                space_pos = window_pos
+                if current_matrix is not None and not current_matrix.is_identity():
+                    space_cur = current_matrix.point_in_inverse_space(window_pos[0:2])
+                    space_last = current_matrix.point_in_inverse_space(window_pos[2:4])
+                    sdx = space_cur[0] - space_last[0]
+                    sdy = space_cur[1] - space_last[1]
+                    space_pos = (
+                        space_cur[0],
+                        space_cur[1],
+                        space_last[0],
+                        space_last[1],
+                        sdx,
+                        sdy,
+                    )
+                response = current_widget.event(
+                    window_pos=window_pos,
+                    space_pos=space_pos,
+                    event_type=event_type,
+                    nearest_snap=nearest_snap,
+                    modifiers=modifiers,
+                    keycode=keycode,
+                )
+
+                if response == RESPONSE_ABORT:
+                    self.hit_chain.clear()
+                    return
+                elif response == RESPONSE_CONSUME:
+                    # if event_type in ("leftdown", "middledown", "middleup", "leftup", "move", "leftclick"):
+                    #      widgetname = type(current_widget).__name__
+                    #      print("Event %s was consumed by %s" % (event_type, widgetname))
+                    return
+                elif response == RESPONSE_CHAIN:
+                    continue
+                elif response == RESPONSE_DROP:
+                    # self.hit_chain[i] = None
+                    continue
+                #
+                # if response == RESPONSE_ABORT:
+                #     self.hit_chain.clear()
+            return
+
+        if event_type in (
+            "leftdown",
+            "middledown",
+            "rightdown",
+            "wheeldown",
+            "wheelup",
+            "hover",
+        ):
+            self._down_start_time = time.time()
+            self._down_start_pos = window_pos
+            self.rebuild_hittable_chain()
+            self.find_hit_chain(window_pos)
+        for i, hit in enumerate(self.hit_chain):
+            if hit is None:
+                continue  # Element was dropped.
+            current_widget, current_matrix = hit
+            if current_widget is None:
+                continue
+            space_pos = window_pos
+            if current_matrix is not None and not current_matrix.is_identity():
+                space_cur = current_matrix.point_in_inverse_space(window_pos[0:2])
+                space_last = current_matrix.point_in_inverse_space(window_pos[2:4])
+                sdx = space_cur[0] - space_last[0]
+                sdy = space_cur[1] - space_last[1]
+                space_pos = (
+                    space_cur[0],
+                    space_cur[1],
+                    space_last[0],
+                    space_last[1],
+                    sdx,
+                    sdy,
+                )
+
+            if (
+                i == 0
+                and event_type == "hover"
+                and previous_top_element is not current_widget
+            ):
+                if previous_top_element is not None:
+                    if self.log_events:
+                        self.log_events(f"Converted hover_end: {str(window_pos)}")
+                    previous_top_element.event(
+                        window_pos=window_pos,
+                        space_pos=space_pos,
+                        event_type="hover_end",
+                        nearest_snap=None,
+                        modifiers=modifiers,
+                        keycode=keycode,
+                    )
+                current_widget.event(
+                    window_pos=window_pos,
+                    space_pos=space_pos,
+                    event_type="hover_start",
+                    nearest_snap=None,
+                    modifiers=modifiers,
+                    keycode=keycode,
+                )
+                if self.log_events:
+                    self.log_events(f"Converted hover_start: {str(window_pos)}")
+                previous_top_element = current_widget
+            if (
+                event_type == "leftup"
+                and time.time() - self._down_start_time <= 0.30
+                and abs(complex(*window_pos[:2]) - complex(*self._down_start_pos[:2]))
+                < 50
+            ):  # Anything within 0.3 seconds will be converted to a leftclick
+                response = current_widget.event(
+                    window_pos=window_pos,
+                    space_pos=space_pos,
+                    event_type="leftclick",
+                    nearest_snap=nearest_snap,
+                    modifiers=modifiers,
+                    keycode=keycode,
+                )
+                if self.log_events:
+                    self.log_events(f"Converted leftclick: {str(window_pos)}")
+            elif event_type == "leftup":
+                if self.log_events:
+                    self.log_events(
+                        f"Did not convert to click, {time.time() - self._down_start_time}"
+                    )
+                response = current_widget.event(
+                    window_pos=window_pos,
+                    space_pos=space_pos,
+                    event_type=event_type,
+                    nearest_snap=nearest_snap,
+                    modifiers=modifiers,
+                    keycode=keycode,
+                )
+                # print ("Leftup called for widget #%d" % i )
+                # print (response)
+            else:
+                response = current_widget.event(
+                    window_pos=window_pos,
+                    space_pos=space_pos,
+                    event_type=event_type,
+                    nearest_snap=nearest_snap,
+                    modifiers=modifiers,
+                    keycode=keycode,
+                )
+
+            ##################
+            # PROCESS RESPONSE
+            ##################
+            if type(response) is tuple:
+                # print (f"Nearest snap provided")
+                # We get two additional parameters which are the screen location of the nearest snap point
+                params = response[1:]
+                response = response[0]
+                if len(params) > 1:
+                    new_x_space = params[0]
+                    new_y_space = params[1]
+                    new_x = window_pos[0]
+                    new_y = window_pos[1]
+                    snap_x = None
+                    snap_y = None
+
+                    sdx = new_x_space - space_pos[0]
+                    if current_matrix is not None and not current_matrix.is_identity():
+                        sdx *= current_matrix.value_scale_x()
+                    snap_x = window_pos[0] + sdx
+                    sdy = new_y_space - space_pos[1]
+                    if current_matrix is not None and not current_matrix.is_identity():
+                        sdy *= current_matrix.value_scale_y()
+                    # print("Shift x by %.1f pixel (%.1f), Shift y by %.1f pixel (%.1f)" % (sdx, odx, sdy, ody))
+                    snap_y = window_pos[1] + sdy
+
+                    dx = new_x - self.last_position[0]
+                    dy = new_y - self.last_position[1]
+                    if snap_x is None:
+                        nearest_snap = None
+                    else:
+                        # We are providing the space and screen coordinates
+                        snap_space = current_matrix.point_in_inverse_space(
+                            (snap_x, snap_y)
+                        )
+                        nearest_snap = (
+                            snap_space[0],
+                            snap_space[1],
+                            snap_x,
+                            snap_y,
+                        )
+                        self.pane.last_snap = nearest_snap
+            else:
+                params = None
 
-        if self.scale == UNITS_PER_INCH:
-            self.feed_convert = lambda s: s / ((self.scale / UNITS_PER_INCH) * 60.0)
-            self.feed_invert = lambda s: s * ((self.scale / UNITS_PER_INCH) * 60.0)
+            if response == RESPONSE_ABORT:
+                self.hit_chain.clear()
+                return
+            elif response == RESPONSE_CONSUME:
+                # if event_type in ("leftdown", "middledown", "middleup", "leftup", "move", "leftclick"):
+                #      widgetname = type(current_widget).__name__
+                #      print("Event %s was consumed by %s" % (event_type, widgetname))
+                return
+            elif response == RESPONSE_CHAIN:
+                continue
+            elif response == RESPONSE_DROP:
+                self.hit_chain[i] = None
+                continue
+            else:
+                break
+
+    def cursor(self, cursor, always=False):
+        """
+        Routine to centralize and correct cursor info.
+        @param cursor: Changed cursor
+        @param always: Force cursor change
+        @return:
+        """
+        if cursor == "sizing":
+            new_cursor = wx.CURSOR_SIZING
+        elif cursor in ("size_nw", "size_se"):
+            new_cursor = wx.CURSOR_SIZENWSE
+        elif cursor in ("size_sw", "size_ne"):
+            new_cursor = wx.CURSOR_SIZENESW
+        elif cursor in ("size_n", "size_s", "skew_y"):
+            new_cursor = wx.CURSOR_SIZENS
+        elif cursor in ("size_e", "size_w", "skew_x"):
+            new_cursor = wx.CURSOR_SIZEWE
+        elif cursor == "arrow":
+            new_cursor = wx.CURSOR_ARROW
+        elif cursor == "cross":
+            new_cursor = wx.CROSS_CURSOR
+        elif cursor == "rotate1":
+            new_cursor = wx.CURSOR_CROSS
+        elif cursor == "rotate2":
+            new_cursor = wx.CURSOR_CROSS
+        elif cursor == "rotmove":
+            new_cursor = wx.CURSOR_HAND
+        elif cursor == "reference":
+            new_cursor = wx.CURSOR_BULLSEYE
+        elif cursor == "text":
+            new_cursor = wx.CURSOR_IBEAM
         else:
-            self.feed_convert = lambda s: s / ((self.scale / UNITS_PER_MM) * 60.0)
-            self.feed_invert = lambda s: s * ((self.scale / UNITS_PER_MM) * 60.0)
+            new_cursor = wx.CURSOR_ARROW
+            self.log("Invalid cursor.")
+        if platform.system() == "Linux":
+            if cursor == "sizing":
+                new_cursor = wx.CURSOR_SIZENWSE
+            elif cursor in ("size_nw", "size_se"):
+                new_cursor = wx.CURSOR_SIZING
+            elif cursor in ("size_sw", "size_ne"):
+                new_cursor = wx.CURSOR_SIZING
+        if new_cursor != self._cursor or always:
+            self._cursor = new_cursor
+            self.gui.scene_panel.SetCursor(wx.Cursor(self._cursor))
+            self.log(f"Cursor changed to {cursor}")
+
+    def add_scenewidget(self, widget, properties=ORIENTATION_RELATIVE):
+        """
+        Delegate to the SceneSpaceWidget scene.
+        """
+        self.widget_root.scene_widget.add_widget(-1, widget, properties)
+
+    def add_interfacewidget(self, widget, properties=ORIENTATION_RELATIVE):
+        """
+        Delegate to the SceneSpaceWidget interface.
+        """
+        self.widget_root.interface_widget.add_widget(-1, widget, properties)
```

### Comparing `meerk40t-0.8.2000/meerk40t/grbl/gui/grblconfiguration.py` & `meerk40t-0.8.3000/meerk40t/grbl/gui/grblconfiguration.py`

 * *Files 4% similar despite different names*

```diff
@@ -59,27 +59,32 @@
         )
         panel_global = ChoicePropertyPanel(
             self, wx.ID_ANY, context=self.context, choices="grbl-global"
         )
         panel_dim = ChoicePropertyPanel(
             self, wx.ID_ANY, context=self.context, choices="bed_dim"
         )
+        panel_rotary = ChoicePropertyPanel(
+            self, wx.ID_ANY, context=self.context, choices="rotary"
+        )
         panel_warn = WarningPanel(self, id=wx.ID_ANY, context=self.context)
         panel_actions = DefaultActionPanel(self, id=wx.ID_ANY, context=self.context)
         newpanel = FormatterPanel(self, id=wx.ID_ANY, context=self.context)
         self.panels.append(panel_main)
         self.panels.append(panel_global)
         self.panels.append(panel_dim)
+        self.panels.append(panel_rotary)
         self.panels.append(panel_warn)
         self.panels.append(panel_actions)
         self.panels.append(newpanel)
 
         self.notebook_main.AddPage(panel_main, _("Connection"))
         self.notebook_main.AddPage(panel_dim, _("Dimensions"))
         self.notebook_main.AddPage(panel_global, _("Global Settings"))
+        self.notebook_main.AddPage(panel_rotary, _("Rotary"))
         self.notebook_main.AddPage(panel_warn, _("Warning"))
         self.notebook_main.AddPage(panel_actions, _("Default Actions"))
         self.notebook_main.AddPage(newpanel, _("Display Options"))
         self.Layout()
         for panel in self.panels:
             self.add_module_delegate(panel)
```

### Comparing `meerk40t-0.8.2000/meerk40t/grbl/gui/grblserialcontroller.py` & `meerk40t-0.8.3000/meerk40t/grbl/gui/grblserialcontroller.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/grbl/gui/gui.py` & `meerk40t-0.8.3000/meerk40t/grbl/gui/gui.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/grbl/gui/tcpcontroller.py` & `meerk40t-0.8.3000/meerk40t/grbl/gui/tcpcontroller.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/grbl/interpreter.py` & `meerk40t-0.8.3000/meerk40t/grbl/interpreter.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/grbl/loader.py` & `meerk40t-0.8.3000/meerk40t/grbl/loader.py`

 * *Files 2% similar despite different names*

```diff
@@ -13,12 +13,10 @@
         yield "Gcode File", ("gcode", "nc", "gc"), "application/x-gcode"
 
     @staticmethod
     def load(kernel, service, pathname, **kwargs):
         basename = os.path.basename(pathname)
         with open(pathname, "rb") as f:
             op_branch = service.get(type="branch ops")
-            op_branch.add(
-                data=f.read(), data_type="grbl", type="blob", name=basename
-            )
+            op_branch.add(data=f.read(), data_type="grbl", type="blob", name=basename)
             kernel.root.close(basename)
             return True
```

### Comparing `meerk40t-0.8.2000/meerk40t/grbl/mock_connection.py` & `meerk40t-0.8.3000/meerk40t/grbl/mock_connection.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/grbl/plugin.py` & `meerk40t-0.8.3000/meerk40t/ruida/plugin.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,82 +1,87 @@
 """
-GRBL Device Plugin
+Moshi Device Plugin
 
-Registers the required files to run the GRBL device.
+Registers the needed classes for ruida device (or would if the ruida device could be controlled).
 """
-from meerk40t.grbl.control import GRBLControl
-from meerk40t.grbl.device import GRBLDevice, GRBLDriver
-from meerk40t.grbl.interpreter import GRBLInterpreter
-from meerk40t.grbl.emulator import GRBLEmulator
-from meerk40t.grbl.loader import GCodeLoader
+from meerk40t.ruida.control import RuidaControl
+from meerk40t.ruida.device import RuidaDevice
+from meerk40t.ruida.emulator import RuidaEmulator
+from meerk40t.ruida.loader import RDLoader
+from meerk40t.ruida.rdjob import RDJob
 
 
 def plugin(kernel, lifecycle=None):
     if lifecycle == "plugins":
         from .gui import gui
 
         return [gui.plugin]
-    elif lifecycle == "invalidate":
-        try:
-            import serial  # pylint: disable=unused-import
-            from serial import SerialException  # pylint: disable=unused-import
-        except ImportError:
-            print("GRBL plugin could not load because pyserial is not installed.")
-            return True
-    elif lifecycle == "register":
+    if lifecycle == "register":
         _ = kernel.translation
-
-        kernel.register("provider/device/grbl", GRBLDevice)
-        kernel.register("driver/grbl", GRBLDriver)
-        kernel.register("interpreter/grbl", GRBLInterpreter)
-        kernel.register("emulator/grbl", GRBLEmulator)
-        kernel.register("load/GCodeLoader", GCodeLoader)
-
-        @kernel.console_option(
-            "port", "p", type=int, default=23, help=_("port to listen on.")
+        kernel.register("provider/device/ruida", RuidaDevice)
+        kernel.register(
+            "dev_info/ruida-beta",
+            {
+                "provider": "provider/device/ruida",
+                "friendly_name": _("K50/K60-CO2-Laser (Ruida-Controller) (INCOMPLETE)"),
+                "extended_info": _("This driver is incomplete. Use at your own risk."),
+                "priority": -1,
+                "family": _("CO2-Laser"),
+                "family_priority": 0,
+                "choices": [
+                    {
+                        "attr": "label",
+                        "default": "ruida",
+                    },
+                    {
+                        "attr": "source",
+                        "default": "co2",
+                    },
+                ],
+            },
         )
+        kernel.register("spoolerjob/ruida", RDJob)
+        kernel.register("load/RDLoader", RDLoader)
+        kernel.register("emulator/ruida", RuidaEmulator)
+
         @kernel.console_option(
             "verbose",
             "v",
             type=bool,
             action="store_true",
             help=_("watch server channels"),
         )
         @kernel.console_option(
             "quit",
             "q",
             type=bool,
             action="store_true",
-            help=_("shutdown current grblserver"),
+            help=_("shutdown current ruidaserver"),
         )
         @kernel.console_command(
-            "grblcontrol",
-            help=_("activate the grblserver."),
+            "ruidacontrol",
+            help=_("activate the ruidaserver."),
             hidden=True,
         )
-        def grblserver(
-            port=23,
-            verbose=False,
-            quit=False,
-            **kwargs,
-        ):
+        def ruidaserver(command, channel, _, verbose=False, quit=False, **kwargs):
             """
-            The grblserver emulation methods provide a simulation of a grbl device.
-            this emulates a grbl devices in order to be compatible with software that
-            controls that type of device.
+            The ruidaserver emulation methods provide a simulation of a ruida device.
+            this interprets ruida devices in order to be compatible with software that
+            controls that type of device. This would then be sent to the device in a
+            somewhat agnostic fashion.
             """
             root = kernel.root
-            grblcontrol = root.device.lookup("grblcontrol")
-            if grblcontrol is None:
+            ruidacontrol = root.device.lookup("ruidacontrol")
+            if ruidacontrol is None:
                 if quit:
                     return
-                grblcontrol = GRBLControl(root)
-                root.device.register("grblcontrol", grblcontrol)
-                grblcontrol.start(port, verbose)
+                ruidacontrol = RuidaControl(root)
+                root.device.register("ruidacontrol", ruidacontrol)
+                ruidacontrol.start(verbose=verbose)
             if quit:
-                grblcontrol.quit()
-                root.device.unregister("grblcontrol")
+                ruidacontrol.quit()
+                root.device.unregister("ruidacontrol")
 
-    elif lifecycle == "preboot":
-        suffix = "grbl"
+    if lifecycle == "preboot":
+        suffix = "ruida"
         for d in kernel.derivable(suffix):
             kernel.root(f"service device start -p {d} {suffix}\n")
```

### Comparing `meerk40t-0.8.2000/meerk40t/grbl/serial_connection.py` & `meerk40t-0.8.3000/meerk40t/grbl/serial_connection.py`

 * *Files 2% similar despite different names*

```diff
@@ -25,15 +25,15 @@
         except (SerialException, AttributeError, OSError, TypeError):
             pass
         f = self.read_buffer.find(b"\n")
         if f == -1:
             return None
         response = self.read_buffer[:f]
         self.read_buffer = self.read_buffer[f + 1 :]
-        str_response = str(response, "utf-8")
+        str_response = str(response, "raw_unicode_escape")
         str_response = str_response.strip()
         return str_response
 
     def write(self, line):
         try:
             self.laser.write(bytes(line, "utf-8"))
         except (SerialException, PermissionError) as e:
```

### Comparing `meerk40t-0.8.2000/meerk40t/grbl/tcp_connection.py` & `meerk40t-0.8.3000/meerk40t/grbl/tcp_connection.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/about.py` & `meerk40t-0.8.3000/meerk40t/gui/about.py`

 * *Files 6% similar despite different names*

```diff
@@ -148,14 +148,16 @@
         self.wx_version = wx.TextCtrl(self, wx.ID_ANY, "", style=wx.TE_READONLY)
         self.config_path = wx.TextCtrl(self, wx.ID_ANY, "", style=wx.TE_READONLY)
         self.os_version = wx.TextCtrl(
             self, wx.ID_ANY, "", style=wx.TE_READONLY | wx.TE_MULTILINE
         )
         self.info_btn = wx.Button(self, wx.ID_ANY, _("Copy to Clipboard"))
         self.Bind(wx.EVT_BUTTON, self.copy_debug_info, self.info_btn)
+        self.update_btn = wx.Button(self, wx.ID_ANY, _("Check for Updates"))
+        self.Bind(wx.EVT_BUTTON, self.check_for_updates, self.update_btn)
         self.__set_properties()
         self.__do_layout()
 
     def __set_properties(self):
         # Fill the content...
         import os
         import platform
@@ -231,19 +233,25 @@
         sizer_cfg.Add(self.config_path, 1, wx.EXPAND, 0)
         sizer_main.Add(sizer_cfg, 0, wx.EXPAND, 0)
 
         sizer_os = StaticBoxSizer(self, wx.ID_ANY, "OS", wx.HORIZONTAL)
         sizer_os.Add(self.os_version, 1, wx.EXPAND, 0)
         sizer_main.Add(sizer_os, 1, wx.EXPAND, 0)  # This one may grow
 
-        sizer_main.Add(self.info_btn, 0, wx.EXPAND, 0)
+        button_sizer = wx.BoxSizer(wx.HORIZONTAL)
+        button_sizer.Add(self.info_btn, 2, wx.EXPAND, 0)
+        button_sizer.Add(self.update_btn, 1, wx.EXPAND, 0)
+        sizer_main.Add(button_sizer, 0, wx.EXPAND, 0)
 
         sizer_main.Layout()
         self.SetSizer(sizer_main)
 
+    def check_for_updates(self, event):
+        self.context("check_for_updates -popup\n")
+
     def copy_debug_info(self, event):
         if wx.TheClipboard.Open():
             msg = ""
             msg += self.mk_version.GetValue() + "\n"
             msg += self.py_version.GetValue() + "\n"
             msg += self.wx_version.GetValue() + "\n"
             msg += self.config_path.GetValue() + "\n"
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/alignment.py` & `meerk40t-0.8.3000/meerk40t/gui/alignment.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,13 +1,13 @@
 from math import atan, sqrt, tau
 
 import numpy as np
 import wx
 
-from meerk40t.core.element_types import elem_nodes
+from meerk40t.core.elements.element_types import elem_nodes
 from meerk40t.core.node.node import Node
 from meerk40t.svgelements import (
     Arc,
     Close,
     Color,
     CubicBezier,
     Line,
@@ -62,15 +62,15 @@
 
         sizer_main.Add(self.lbl_info_main, 0, wx.EXPAND, 0)
         sizer_main.Add(sizer_default, 0, wx.EXPAND, 0)
         sizer_main.Add(sizer_first, 0, wx.EXPAND, 0)
         sizer_main.Add(sizer_last, 0, wx.EXPAND, 0)
         self.make_raster = None
         self.SetSizer(sizer_main)
-        self.Layout
+        self.Layout()
 
     def show_stuff(self, has_emph):
         def mklabel(label):
             result = ""
             if label is not None:
                 result = label
             return result
@@ -298,15 +298,15 @@
             if xpos == "none" and ypos == "none":
                 active = False
             if mode == "default" and asgroup == 1:
                 # That makes no sense...
                 active = False
             if (
                 self.scene is None
-                or self.scene.reference_object is None
+                or self.scene.pane.reference_object is None
                 and mode == "ref"
             ):
                 active = False
         else:
             active = False
         self.btn_align.Enable(active)
 
@@ -331,15 +331,15 @@
         if idx < 0:
             idx = 0
         mode = self.modeparam[idx]
 
         addition = ""
         if mode == "ref":
             if self.scene is not None:
-                node = self.scene.reference_object
+                node = self.scene.pane.reference_object
                 if node is not None:
                     addition = f" --boundaries {node.bounds[0]},{node.bounds[1]},{node.bounds[2]},{node.bounds[3]}"
                 else:
                     mode = "default"
             else:
                 mode = "default"
         self.context(
@@ -366,15 +366,15 @@
         self.rbox_align_x.Enable(has_emph)
         self.rbox_align_y.Enable(has_emph)
         self.rbox_relation.Enable(has_emph)
         self.rbox_treatment.Enable(has_emph)
         self.count, self.first_node, self.last_node = self.info_panel.show_stuff(
             has_emph
         )
-        flag = self.scene.reference_object is not None
+        flag = self.scene.pane.reference_object is not None
         self.rbox_relation.EnableItem(4, flag)
         self.validate_data()
 
 
 class DistributionPanel(wx.Panel):
     def __init__(self, *args, context=None, scene=None, **kwds):
         kwds["style"] = kwds.get("style", 0)
@@ -882,15 +882,15 @@
                 if newpt not in target:
                     # print (f"Finally: ({last_x:.1f}, {last_y:.1f}, {last_angle:.3f})")
                     segadded += 1
                     target.append(newpt)
             # print (f"Target points: {len(target)}")
 
         # "default", "shape", "points", "bed", "ref")
-        if treatment == "ref" and self.scene.reference_object is None:
+        if treatment == "ref" and self.scene.pane.reference_object is None:
             treatment = "default"
         if treatment == "default":
             # Let's get the boundaries of the data-set
             left_edge = float("inf")
             right_edge = -left_edge
             top_edge = float("inf")
             bottom_edge = -top_edge
@@ -903,18 +903,18 @@
         elif treatment == "bed":
             left_edge = 0
             top_edge = 0
             right_edge = float(Length(self.context.device.width))
             bottom_edge = float(Length(self.context.device.height))
             calc_basic()
         elif treatment == "ref":
-            left_edge = self.scene.reference_object.bounds[0]
-            top_edge = self.scene.reference_object.bounds[1]
-            right_edge = self.scene.reference_object.bounds[2]
-            bottom_edge = self.scene.reference_object.bounds[3]
+            left_edge = self.scene.pane.reference_object.bounds[0]
+            top_edge = self.scene.pane.reference_object.bounds[1]
+            right_edge = self.scene.pane.reference_object.bounds[2]
+            bottom_edge = self.scene.pane.reference_object.bounds[3]
             calc_basic()
         elif treatment == "points":
             # So what's the reference node? And delete it...
             refnode = data[0]
             if hasattr(refnode, "as_path"):
                 path = refnode.as_path()
             elif hasattr(refnode, "bounds"):
@@ -1103,15 +1103,15 @@
         self.rbox_sort.Enable(showit)
         self.rbox_treatment.Enable(showit)
         self.check_inside_xy.Enable(showit)
         self.check_rotate.Enable(showit)
         self.count, self.first_node, self.last_node = self.info_panel.show_stuff(
             has_emph
         )
-        flag = self.scene.reference_object is not None
+        flag = self.scene.pane.reference_object is not None
         self.rbox_treatment.EnableItem(4, flag)
 
         if showit:
             self.validate_data()
         else:
             self.btn_dist.Enable(showit)
 
@@ -1252,30 +1252,30 @@
         sizer_main.Add(self.info_panel, 1, wx.EXPAND, 0)
 
         self.SetSizer(sizer_main)
         sizer_main.Fit(self)
 
         self.Layout()
         self.btn_arrange.SetToolTip(_("Rearrange all selected elements"))
-        self.rbox_align_x.SetToolTip(_(""))
-        self.rbox_align_y.SetToolTip(_(""))
+        # self.rbox_align_x.SetToolTip(_(""))
+        # self.rbox_align_y.SetToolTip(_(""))
         self.check_same_x.SetToolTip(
             _(
                 "Set if all columns need to have the same size (ie maximum width over all columns)"
             )
         )
         self.check_same_y.SetToolTip(
             _(
                 "Set if all rows need to have the same size (ie maximum height over all row)"
             )
         )
-        self.rbox_relation.SetToolTip(_(""))
-        self.rbox_selection.SetToolTip(_(""))
-        self.arrange_x.SetToolTip(_(""))
-        self.arrange_y.SetToolTip(_(""))
+        # self.rbox_relation.SetToolTip(_(""))
+        # self.rbox_selection.SetToolTip(_(""))
+        # self.arrange_x.SetToolTip(_(""))
+        # self.arrange_y.SetToolTip(_(""))
         self.txt_gap_x.SetToolTip(_("Set the distance between columns"))
         self.txt_gap_y.SetToolTip(_("Set the distance between rows"))
 
         self.Bind(wx.EVT_BUTTON, self.on_button_align, self.btn_arrange)
         self.Bind(wx.EVT_RADIOBOX, self.validate_data, self.rbox_align_x)
         self.Bind(wx.EVT_RADIOBOX, self.validate_data, self.rbox_align_y)
         self.Bind(wx.EVT_RADIOBOX, self.validate_data, self.rbox_selection)
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/bufferview.py` & `meerk40t-0.8.3000/meerk40t/gui/bufferview.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/choicepropertypanel.py` & `meerk40t-0.8.3000/meerk40t/gui/choicepropertypanel.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,12 +1,18 @@
 import wx
 
 from meerk40t.core.units import Angle, Length
 from meerk40t.gui.laserrender import swizzlecolor
-from meerk40t.gui.wxutils import CheckBox, ScrolledPanel, StaticBoxSizer, TextCtrl
+from meerk40t.gui.wxutils import (
+    CheckBox,
+    EditableListCtrl,
+    ScrolledPanel,
+    StaticBoxSizer,
+    TextCtrl,
+)
 from meerk40t.kernel import Context
 from meerk40t.svgelements import Color
 
 _ = wx.GetTranslation
 
 
 class ChoicePropertyPanel(ScrolledPanel):
@@ -110,34 +116,47 @@
         #   the pages to omit : constraint=("-page1", "-page2")
         #   a leading hyphen establishes omission
         kwds["style"] = kwds.get("style", 0) | wx.TAB_TRAVERSAL
         ScrolledPanel.__init__(self, *args, **kwds)
         self.context = context
         self.listeners = list()
         self.entries_per_column = entries_per_column
+        self._detached = False
         if choices is None:
             return
         if isinstance(choices, str):
-            tempchoices = self.context.lookup("choices", choices)
-            # we need to create an independent copy of the lookup, otherwise
-            # any amendments to choices like injector will affect the original
-            choices = []
-            for c in tempchoices:
+            choices = [choices]
+
+        new_choices = []
+        # we need to create an independent copy of the lookup, otherwise
+        # any amendments to choices like injector will affect the original
+
+        for choice in choices:
+            if isinstance(choice, dict):
+                new_choices.append(choice)
+            elif isinstance(choice, str):
+                lookup_choice = self.context.lookup("choices", choice)
+                if lookup_choice is None:
+                    continue
+                new_choices.extend(lookup_choice)
+            else:
+                new_choices.extend(choice)
+        choices = new_choices
+        if injector is not None:
+            # We have additional stuff to be added, so be it
+            for c in injector:
                 choices.append(c)
-            if choices is None:
-                return
+        if len(choices) == 0:
+            # No choices to process.
+            return
         for c in choices:
             needs_dynamic_call = c.get("dynamic")
             if needs_dynamic_call:
                 # Calls dynamic function to update this dictionary before production
                 needs_dynamic_call(c)
-        if injector is not None:
-            # We have additional stuff to be added, so be it
-            for c in injector:
-                choices.append(c)
         # Let's see whether we have a section and a page property...
         for c in choices:
             try:
                 dummy = c["subsection"]
             except KeyError:
                 c["subsection"] = ""
             try:
@@ -231,15 +250,15 @@
         last_page = ""
         last_section = ""
         last_subsection = ""
         last_box = None
         current_main_sizer = sizer_main
         current_sec_sizer = sizer_main
         current_sizer = sizer_main
-        # By default 0 as we are stacking up stuff
+        # By default, 0 as we are stacking up stuff
         expansion_flag = 0
         current_col_entry = -1
         for i, c in enumerate(self.choices):
             wants_listener = True
             current_col_entry += 1
             if self.entries_per_column is not None:
                 if current_col_entry >= self.entries_per_column:
@@ -429,52 +448,84 @@
                     wx.EVT_CHECKBOX,
                     on_checkbox_check(attr, control, obj, additional_signal),
                 )
 
                 current_sizer.Add(control, expansion_flag * weight, wx.EXPAND, 0)
             elif data_type == str and data_style == "file":
                 control_sizer = StaticBoxSizer(self, wx.ID_ANY, label, wx.HORIZONTAL)
-                control = wx.Button(self, -1)
+                control = TextCtrl(
+                    self,
+                    wx.ID_ANY,
+                    style=wx.TE_PROCESS_ENTER,
+                )
+                control_btn = wx.Button(self, wx.ID_ANY, "...")
 
                 def set_file(filename: str):
-                    if not filename:
-                        filename = _("No File")
-                    control.SetLabel(filename)
+                    # if not filename:
+                    #     filename = _("No File")
+                    control.SetValue(filename)
 
                 def on_button_filename(param, ctrl, obj, wildcard, addsig):
                     def click(event=None):
                         with wx.FileDialog(
                             self,
                             label,
                             wildcard=wildcard if wildcard else "*",
                             style=wx.FD_OPEN | wx.FD_FILE_MUST_EXIST,
                         ) as fileDialog:
                             if fileDialog.ShowModal() == wx.ID_CANCEL:
                                 return  # the user changed their mind
                             pathname = str(fileDialog.GetPath())
-                            ctrl.SetLabel(pathname)
+                            ctrl.SetValue(pathname)
                             self.Layout()
                             current_value = getattr(obj, param)
                             if current_value != pathname:
                                 try:
                                     setattr(obj, param, pathname)
                                     self.context.signal(param, pathname, obj)
                                     for _sig in addsig:
                                         self.context.signal(_sig)
                                 except ValueError:
                                     # cannot cast to data_type, pass
                                     pass
 
                     return click
 
-                set_file(data)
+                def on_file_text(param, ctrl, obj, dtype, addsig):
+                    def filetext():
+                        v = ctrl.GetValue()
+                        try:
+                            dtype_v = dtype(v)
+                            current_value = getattr(obj, param)
+                            if current_value != dtype_v:
+                                setattr(obj, param, dtype_v)
+                                self.context.signal(param, dtype_v, obj)
+                                for _sig in addsig:
+                                    self.context.signal(_sig)
+                        except ValueError:
+                            # cannot cast to data_type, pass
+                            pass
+
+                    return filetext
+
+                control.SetActionRoutine(
+                    on_file_text(attr, control, obj, data_type, additional_signal)
+                )
+
+                ctrl_width = c.get("width", 0)
                 if ctrl_width > 0:
                     control.SetMaxSize(wx.Size(ctrl_width, -1))
-                control_sizer.Add(control, 0, wx.EXPAND, 0)
-                control.Bind(
+                control.SetValue(str(data))
+                if ctrl_width > 0:
+                    control.SetMaxSize(wx.Size(ctrl_width, -1))
+                if ctrl_width > 0:
+                    control.SetMaxSize(wx.Size(ctrl_width, -1))
+                control_sizer.Add(control, 1, wx.EXPAND, 0)
+                control_sizer.Add(control_btn, 0, wx.EXPAND, 0)
+                control_btn.Bind(
                     wx.EVT_BUTTON,
                     on_button_filename(
                         attr, control, obj, c.get("wildcard", "*"), additional_signal
                     ),
                 )
                 current_sizer.Add(control_sizer, expansion_flag * weight, wx.EXPAND, 0)
             elif data_type in (int, float) and data_style == "slider":
@@ -567,14 +618,57 @@
                     control.SetMaxSize(wx.Size(ctrl_width, -1))
                 control_sizer.Add(control, 1, wx.ALIGN_CENTER_VERTICAL, 0)
                 control.Bind(
                     wx.EVT_COMBOBOX,
                     on_combo_text(attr, control, obj, data_type, additional_signal),
                 )
                 current_sizer.Add(control_sizer, expansion_flag * weight, wx.EXPAND, 0)
+            elif data_type in (str, int) and data_style == "radio":
+                control_sizer = wx.BoxSizer(wx.HORIZONTAL)
+                choice_list = list(map(str, c.get("choices", [c.get("default")])))
+                control = wx.RadioBox(
+                    self,
+                    wx.ID_ANY,
+                    label,
+                    choices=choice_list,
+                    majorDimension=3,
+                    style=wx.RA_SPECIFY_COLS,  # wx.RA_SPECIFY_ROWS,
+                )
+                if data is not None:
+                    if data_type == str:
+                        control.SetSelection(0)
+                        for i, c in enumerate(choice_list):
+                            if c == data:
+                                control.SetSelection(i)
+                    else:
+                        control.SetSelection(int(data))
+
+                def on_radio_select(param, ctrl, obj, dtype, addsig):
+                    def select(event=None):
+                        if dtype == int:
+                            v = dtype(ctrl.GetSelection())
+                        else:
+                            v = dtype(ctrl.GetLabel())
+                        current_value = getattr(obj, param)
+                        if current_value != v:
+                            setattr(obj, param, v)
+                            self.context.signal(param, v, obj)
+                            for _sig in addsig:
+                                self.context.signal(_sig)
+
+                    return select
+
+                if ctrl_width > 0:
+                    control.SetMaxSize(wx.Size(ctrl_width, -1))
+                control_sizer.Add(control, 1, wx.ALIGN_CENTER_VERTICAL, 0)
+                control.Bind(
+                    wx.EVT_RADIOBOX,
+                    on_radio_select(attr, control, obj, data_type, additional_signal),
+                )
+                current_sizer.Add(control_sizer, expansion_flag * weight, wx.EXPAND, 0)
             elif data_type in (int, str) and data_style == "option":
                 control_sizer = wx.BoxSizer(wx.HORIZONTAL)
                 display_list = list(map(str, c.get("display")))
                 choice_list = list(map(str, c.get("choices", [c.get("default")])))
                 try:
                     index = choice_list.index(str(data))
                 except ValueError:
@@ -831,15 +925,69 @@
                 control.Bind(
                     wx.EVT_BUTTON,
                     on_button_color(attr, control, obj, additional_signal),
                 )
                 if ctrl_width > 0:
                     control.SetMaxSize(wx.Size(ctrl_width, -1))
                 current_sizer.Add(control_sizer, expansion_flag * weight, wx.EXPAND, 0)
+            elif data_type == list and data_style == "chart":
+                chart = EditableListCtrl(
+                    self,
+                    wx.ID_ANY,
+                    style=wx.LC_HRULES | wx.LC_REPORT | wx.LC_VRULES | wx.LC_SINGLE_SEL,
+                )
+                columns = c.get("columns", [])
+                for column in columns:
+                    chart.AppendColumn(
+                        column.get("label", ""),
+                        format=wx.LIST_FORMAT_LEFT,
+                        width=column.get("width", 150),
+                    )
+                for dataline in data:
+                    row_id = chart.InsertItem(
+                        chart.GetItemCount(), dataline.get("speed", 0)
+                    )
+                    for column_id, column in enumerate(columns):
+                        c_attr = column.get("attr")
+                        chart.SetItem(row_id, column_id, str(dataline.get(c_attr, "")))
+
+                def on_chart_start(columns, param, ctrl, obj):
+                    def chart_start(event=None):
+                        for column in columns:
+                            if column.get("editable", False):
+                                event.Allow()
+                            else:
+                                event.Veto()
+
+                    return chart_start
+
+                chart.Bind(
+                    wx.EVT_LIST_BEGIN_LABEL_EDIT,
+                    on_chart_start(columns, attr, chart, obj),
+                )
+
+                def on_chart_stop(columns, param, ctrl, obj):
+                    def chart_stop(event=None):
+                        row_id = event.GetIndex()  # Get the current row
+                        col_id = event.GetColumn()  # Get the current column
+                        new_data = event.GetLabel()  # Get the changed data
+                        ctrl.SetItem(row_id, col_id, new_data)
+                        column = columns[col_id]
+                        c_attr = column.get("attr")
+                        c_type = column.get("type")
+                        values = getattr(obj, attr)
+                        values[row_id][c_attr] = c_type(new_data)
+                        self.context.signal(param, values, row_id, attr)
 
+                    return chart_stop
+
+                chart.Bind(
+                    wx.EVT_LIST_END_LABEL_EDIT, on_chart_stop(columns, attr, chart, obj)
+                )
+                sizer_main.Add(chart, 0, wx.EXPAND, 0)
             elif data_type in (str, int, float):
                 # str, int, and float type objects get a TextCtrl setter.
                 if label != "":
                     control_sizer = StaticBoxSizer(
                         self, wx.ID_ANY, label, wx.HORIZONTAL
                     )
                 else:
@@ -1097,16 +1245,16 @@
                     if data is None:
                         return
                     if dtype == bool:
                         # Bool type objects get a checkbox.
                         if ctrl.GetValue() != data:
                             ctrl.SetValue(data)
                     elif dtype == str and dstyle == "file":
-                        if ctrl.GetLabel() != data:
-                            ctrl.SetLabel(data)
+                        if ctrl.GetValue() != data:
+                            ctrl.SetValue(data)
                     elif dtype in (int, float) and dstyle == "slider":
                         if ctrl.GetValue() != data:
                             ctrl.SetValue(data)
                     elif dtype in (str, int, float) and dstyle == "combo":
                         if dtype == str:
                             ctrl.SetValue(str(data))
                         else:
@@ -1187,15 +1335,14 @@
             last_subsection = this_subsection
 
         self.SetSizer(sizer_very_main)
         sizer_very_main.Fit(self)
         # Make sure stuff gets scrolled if necessary by default
         if scrolling:
             self.SetupScrolling()
-        self._detached = False
 
     @staticmethod
     def unsorted_label(original):
         # Special sort key just to sort stuff - we fix the preceeding "_sortcriteria_Correct label"
         result = original
         if result.startswith("_"):
             idx = result.find("_", 1)
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/consolepanel.py` & `meerk40t-0.8.3000/meerk40t/gui/consolepanel.py`

 * *Files 6% similar despite different names*

```diff
@@ -356,20 +356,58 @@
             url_end = event.GetURLEnd()
             url = self.text_main.GetRange(url_start, url_end)
             import webbrowser
 
             webbrowser.open_new_tab(url)
 
     def on_key_down_main(self, event):
+        def isrealchar(keycode):
+            if keycode in (wx.WXK_LEFT, wx.WXK_RIGHT):
+                # There are much more, but I am lazy...
+                return False
+            else:
+                return chr(keycode).isprintable
+
+        def refocus():
+            self.text_entry.SetInsertionPointEnd()
+            self.text_entry.SetFocus()
+
         key = event.GetKeyCode()
-        if key != wx.WXK_CONTROL and (key != ord("C") or not event.ControlDown()):
+        if key != wx.WXK_CONTROL and (key != ord("C")) and not event.ControlDown():
             if self.FindFocus() is not self.text_entry:
-                self.text_entry.SetFocus()
-                self.text_entry.AppendText(str(chr(key)).lower())
-        event.Skip()
+                try:
+                    if key == wx.WXK_DOWN:
+                        self.text_entry.SetValue(
+                            self.command_log[self.command_position + 1]
+                        )
+                        if not wx.IsMainThread():
+                            wx.CallAfter(refocus)
+                        else:
+                            refocus()
+                        self.command_position += 1
+                    elif key == wx.WXK_UP:
+                        self.text_entry.SetValue(
+                            self.command_log[self.command_position - 1]
+                        )
+                        if not wx.IsMainThread():
+                            wx.CallAfter(refocus)
+                        else:
+                            refocus()
+                        self.command_position -= 1
+                    elif isrealchar(key):
+                        self.text_entry.SetFocus()
+                        self.text_entry.AppendText(str(chr(key)).lower())
+                    else:
+                        self.text_entry.SetFocus()
+                        # event.Skip()
+                except IndexError:
+                    self.command_position = 0
+                    self.text_entry.SetValue("")
+        else:
+            event.Skip()
 
     def on_key_down(self, event):
         key = event.GetKeyCode()
         try:
             if key == wx.WXK_DOWN:
                 self.text_entry.SetValue(self.command_log[self.command_position + 1])
                 if not wx.IsMainThread():
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/devicepanel.py` & `meerk40t-0.8.3000/meerk40t/gui/devicepanel.py`

 * *Files 18% similar despite different names*

```diff
@@ -25,14 +25,139 @@
     pane.dock_proportion = 600
     pane.control = panel
 
     window.on_pane_create(pane)
     context.register("pane/devices", pane)
 
 
+class SelectDevice(wx.Dialog):
+    def __init__(self, *args, context=None, **kwds):
+        # begin wxGlade: SelectDevice.__init__
+        kwds["style"] = (
+            kwds.get("style", 0) | wx.DEFAULT_DIALOG_STYLE | wx.RESIZE_BORDER
+        )
+        wx.Dialog.__init__(self, *args, **kwds)
+        self.context = context
+        self.SetTitle(_("Select Device"))
+
+        sizer_main = wx.BoxSizer(wx.VERTICAL)
+
+        sizer_3 = wx.StaticBoxSizer(
+            wx.StaticBox(self, wx.ID_ANY, _("Filter")), wx.HORIZONTAL
+        )
+        sizer_main.Add(sizer_3, 0, wx.EXPAND, 0)
+
+        label_filter = wx.StaticText(self, wx.ID_ANY, _("Device:"))
+        sizer_3.Add(label_filter, 0, wx.ALIGN_CENTER_VERTICAL, 0)
+
+        self.text_filter = wx.TextCtrl(self, wx.ID_ANY, "")
+        sizer_3.Add(self.text_filter, 0, wx.EXPAND, 0)
+
+        self.tree_devices = wx.TreeCtrl(
+            self,
+            wx.ID_ANY,
+            style=wx.BORDER_SUNKEN
+            | wx.TR_HAS_BUTTONS
+            | wx.TR_HIDE_ROOT
+            | wx.TR_NO_BUTTONS
+            | wx.TR_SINGLE,
+        )
+        sizer_main.Add(self.tree_devices, 3, wx.EXPAND, 0)
+
+        self.label_info = wx.StaticText(self, wx.ID_ANY, "")
+        sizer_main.Add(self.label_info, 1, wx.EXPAND, 0)
+
+        sizer_2 = wx.StdDialogButtonSizer()
+        sizer_main.Add(sizer_2, 0, wx.ALIGN_RIGHT | wx.ALL, 4)
+
+        self.button_OK = wx.Button(self, wx.ID_OK, "")
+        self.button_OK.SetDefault()
+        sizer_2.AddButton(self.button_OK)
+
+        self.button_CANCEL = wx.Button(self, wx.ID_CANCEL, "")
+        sizer_2.AddButton(self.button_CANCEL)
+
+        sizer_2.Realize()
+
+        self.SetSizer(sizer_main)
+        sizer_main.Fit(self)
+
+        self.SetAffirmativeId(self.button_OK.GetId())
+        self.SetEscapeId(self.button_CANCEL.GetId())
+        self.device_type = ""
+        self.device_info = ""
+        self.filter = ""
+
+        self.text_filter.SetToolTip(_("Quicksearch for device-entry"))
+        self.tree_devices.SetToolTip(_("Select a matching entry for your new device"))
+
+        self.text_filter.Bind(wx.EVT_TEXT, self.on_text_filter)
+        self.tree_devices.Bind(wx.EVT_TREE_SEL_CHANGED, self.on_selection)
+        self.tree_devices.Bind(wx.EVT_LEFT_DCLICK, self.on_dclick)
+        self.SetSize(350, 450)
+        self.Layout()
+        self.populate_tree()
+
+    def populate_tree(self):
+        tree = self.tree_devices
+        tree.DeleteAllItems()
+        tree_root = tree.AddRoot(_("Devices"))
+        self.dev_infos = list(self.context.find("dev_info"))
+        self.dev_infos.sort(
+            key=lambda e: str(e[0].get("family_priority", 0))
+            + "_"
+            + str(e[0].get("priority", 0)),
+            reverse=True,
+        )
+        last_family = ""
+        parent_item = tree_root
+        index = -1
+        for obj, name, sname in self.dev_infos:
+            index += 1
+            family = obj.get("family", "")
+            info = obj.get("friendly_name", "")
+            if self.filter and self.filter.lower() not in info.lower():
+                continue
+            if family != last_family:
+                last_family = family
+                parent_item = tree.AppendItem(tree_root, family)
+            device_item = tree.AppendItem(parent_item, info)
+            tree.SetItemData(device_item, index)
+        tree.ExpandAll()
+
+    def on_text_filter(self, event):
+        self.filter = self.text_filter.GetValue()
+        self.populate_tree()
+
+    def on_selection(self, event):
+        tree = self.tree_devices
+        self.device_type = ""
+        self.device_info = ""
+        info = ""
+        item = event.GetItem()
+        if item:
+            try:
+                index = tree.GetItemData(item)
+                if index is not None and index >= 0 and index < len(self.dev_infos):
+                    obj = self.dev_infos[index][0]
+                    info = obj.get("extended_info", "")
+                    self.device_type = obj.get("provider", "")
+                    self.device_info = self.dev_infos[index][2]
+            except RuntimeError:
+                # Dialog has already been destroyed...
+                return
+        self.label_info.SetLabel(info)
+        self.button_OK.Enable(bool(self.device_type != ""))
+        self.Layout()
+
+    def on_dclick(self, event):
+        if self.device_type:
+            self.EndModal(self.GetAffirmativeId())
+
+
 class DevicePanel(wx.Panel):
     def __init__(self, *args, context=None, pane=False, **kwds):
         # begin wxGlade: DevicesPanel.__init__
         kwds["style"] = kwds.get("style", 0) | wx.TAB_TRAVERSAL
         wx.Panel.__init__(self, *args, **kwds)
         self.context = context
 
@@ -44,15 +169,16 @@
             style=wx.LC_REPORT
             | wx.LC_EDIT_LABELS
             | wx.LC_HRULES
             | wx.LC_SINGLE_SEL
             | wx.LC_SORT_ASCENDING,
         )
         self.devices_list.InsertColumn(0, _("Device"))
-        self.devices_list.InsertColumn(1, _("Type"))
+        self.devices_list.InsertColumn(1, _("Driver"))
+        self.devices_list.InsertColumn(2, _("Type"))
         sizer_1.Add(self.devices_list, 7, wx.EXPAND, 0)
 
         sizer_3 = wx.BoxSizer(wx.HORIZONTAL)
         sizer_1.Add(sizer_3, 1, wx.EXPAND, 0)
         # All devices
         self.devices = []
         # Active item in list
@@ -118,16 +244,17 @@
 
     def on_resize(self, event):
         if event is not None:
             event.Skip()
         size = self.devices_list.GetSize()
         if size[0] == 0 or size[1] == 0:
             return
-        self.devices_list.SetColumnWidth(0, int(0.45 * size[0]))
-        self.devices_list.SetColumnWidth(1, int(0.45 * size[0]))
+        self.devices_list.SetColumnWidth(0, int(0.3 * size[0]))
+        self.devices_list.SetColumnWidth(1, int(0.3 * size[0]))
+        self.devices_list.SetColumnWidth(2, int(0.3 * size[0]))
 
     def on_end_edit(self, event):
         prohibited = "'" + '"' + "/"
         if event.IsEditCancelled():
             return
         label = event.GetLabel()
 
@@ -157,29 +284,52 @@
                 self.devices_list.SetItemTextColour(idx, stdcol)
 
     @signal_listener("activate;device")
     @lookup_listener("service/device/available")
     def refresh_device_tree(self, *args):
         self.devices = []
         names = []
-        for obj, name, sname in self.context.find("provider", "device"):
-            names.append(sname.lower())
+        for obj, name, sname in self.context.find("dev_info"):
+            if obj is not None:
+                try:
+                    names.append(obj.get("friendly_name", sname.lower()))
+                except AttributeError:
+                    names.append(sname.lower())
         self.devices_list.DeleteAllItems()
         # root = self.devices_list.AddRoot("Devices")
         for i, device in enumerate(self.context.kernel.services("device")):
             self.devices.append(device)
             dev_index = len(self.devices) - 1
-            lbl = device.label
-            dev_name = ""
-            for sname in names:
-                if sname in device.path.lower():
-                    dev_name = sname
+            label = device.label
+            index = self.devices_list.InsertItem(
+                self.devices_list.GetItemCount(), label
+            )
+            type_info = getattr(device, "name", device.path)
+            dev_infos = list(self.context.find("dev_info"))
+            dev_infos.sort(key=lambda e: e[0].get("priority", 0), reverse=True)
+            family_default = ""
+            for obj, name, sname in dev_infos:
+                if device.registered_path == obj.get("provider", ""):
+                    if "choices" in obj:
+                        for prop in obj["choices"]:
+                            if (
+                                "attr" in prop
+                                and "default" in prop
+                                and prop["attr"] == "source"
+                            ):
+                                family_default = prop["default"]
+                                break
+                if family_default:
                     break
-            index = self.devices_list.InsertItem(self.devices_list.GetItemCount(), lbl)
-            self.devices_list.SetItem(index, 1, dev_name)
+
+            family_info = device.setting(str, "source", family_default)
+            if family_info:
+                family_info = family_info.capitalize()
+            self.devices_list.SetItem(index, 1, type_info)
+            self.devices_list.SetItem(index, 2, family_info)
             self.devices_list.SetItemData(index, dev_index)
             if self.context.device is device:
                 self.devices_list.SetItemTextColour(index, wx.RED)
 
         self.devices_list.SetFocus()
 
     def get_new_label_for_device(self, device_type):
@@ -294,31 +444,27 @@
             if service is not None:
                 service.kernel.activate_service_path("device", service.path)
                 self.recolor_device_items()
 
         return activateit
 
     def on_button_create_device(self, event):  # wxGlade: DevicePanel.<event_handler>
-        names = []
-        for obj, name, sname in self.context.find("provider", "device"):
-            names.append(sname)
-        with wx.SingleChoiceDialog(
-            None, _("What type of driver is being added?"), _("Device Type"), names
-        ) as dlg:
-            dlg.SetSelection(0)
-            if dlg.ShowModal() == wx.ID_OK:
-                device_type = names[dlg.GetSelection()]
-                # Let's establish how many devices of this type
-                # we already have and name it accordingly
-                label = self.get_new_label_for_device(device_type)
-                if label != "":
-                    label = ' -l "' + label + '"'
-                self.context(f"service device start -i {device_type}{label}\n")
-        self.refresh_device_tree()
-        self.context.signal("device;modified")
+        dlg = SelectDevice(None, wx.ID_ANY, context=self.context)
+        result = dlg.ShowModal()
+        if result == wx.ID_OK:
+            device_type = dlg.device_type
+            device_info = dlg.device_info
+            label = self.get_new_label_for_device(device_type)
+            if label:
+                self.context(f'device add -i {device_info} -l "{label}"\n')
+            else:
+                self.context(f"device add -i {device_info}\n")
+            self.refresh_device_tree()
+            self.context.signal("device;modified")
+        dlg.Destroy()
 
     def on_button_remove_device(self, event):  # wxGlade: DevicePanel.<event_handler>
         service = self.get_selected_device()
         if service is not None:
             if self.context.device is service:
                 wx.MessageDialog(
                     None, _("Cannot remove the currently active device."), _("Error")
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/dialogoptions.py` & `meerk40t-0.8.3000/meerk40t/gui/dialogoptions.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/executejob.py` & `meerk40t-0.8.3000/meerk40t/gui/executejob.py`

 * *Files 1% similar despite different names*

```diff
@@ -12,14 +12,15 @@
 
 class PlannerPanel(wx.Panel):
     def __init__(self, *args, context=None, plan_name=None, **kwargs):
         # begin wxGlade: ConsolePanel.__init__
         kwargs["style"] = kwargs.get("style", 0) | wx.TAB_TRAVERSAL
         wx.Panel.__init__(self, *args, **kwargs)
         self.context = context
+        self.busy = False
 
         self.plan_name = plan_name
         self.available_devices = list(self.context.kernel.services("device"))
         self.selected_device = self.context.device
         index = -1
         for i, s in enumerate(self.available_devices):
             if s is self.selected_device:
@@ -124,14 +125,18 @@
     def on_listbox_commands_click(self, event):  # wxGlade: JobInfo.<event_handler>
         event.Skip()
 
     def on_listbox_commands_dclick(self, event):  # wxGlade: JobInfo.<event_handler>
         event.Skip()
 
     def on_button_start(self, event=None):  # wxGlade: Preview.<event_handler>
+        if self.busy:
+            return
+        self.busy = True
+        self.button_start.Enable(False)
         if self.stage == 0:
             with wx.BusyInfo(_("Preprocessing...")):
                 self.context(f"plan{self.plan_name} copy preprocess\n")
                 cutplan = self.context.planner.default_plan
                 if len(cutplan.commands) == 0:
                     self.context(f"plan{self.plan_name} validate\n")
         elif self.stage == 1:
@@ -157,14 +162,16 @@
                 self.context(f"plan{self.plan_name} spool\n")
                 if self.context.auto_spooler:
                     self.context("window open JobSpooler\n")
                 try:
                     self.GetParent().Close()
                 except (TypeError, AttributeError):
                     pass
+        self.busy = False
+        self.button_start.Enable(True)
         self.update_gui()
 
     def pane_show(self):
         # self.context.setting(bool, "opt_rasters_split", True)
         # TODO: OPT_RASTER_SPLIT
         cutplan = self.context.planner.default_plan
         self.Children[0].SetFocus()
@@ -191,14 +198,17 @@
     def update_gui(self):
         def name_str(e):
             try:
                 return e.__name__
             except AttributeError:
                 return str(e)
 
+        if self.busy:
+            return
+
         self.list_operations.Clear()
         self.list_command.Clear()
         cutplan = self.context.planner.default_plan
         if cutplan.plan is not None and len(cutplan.plan) != 0:
             self.list_operations.InsertItems([name_str(e) for e in cutplan.plan], 0)
         if cutplan.commands is not None and len(cutplan.commands) != 0:
             self.list_command.InsertItems([name_str(e) for e in cutplan.commands], 0)
@@ -215,15 +225,15 @@
         elif self.stage == 2:
             self.button_start.SetLabelText(_("Validate"))
             self.button_start.SetBackgroundColour(wx.Colour(255, 102, 255))
             self.button_start.SetToolTip(
                 _("Run the commands to make these operations valid.")
             )
         elif self.stage == 3:
-            self.button_start.SetLabelText(_("Blob"))
+            self.button_start.SetLabelText(_("Create Lasercode"))
             self.button_start.SetBackgroundColour(wx.Colour(102, 102, 255))
             self.button_start.SetToolTip(_("Turn this set of operations into Cutcode"))
         elif self.stage == 4:
             self.button_start.SetLabelText(_("Preprocess Optimizations"))
             self.button_start.SetBackgroundColour(wx.Colour(255, 102, 102))
             self.button_start.SetToolTip(
                 _("Determine what needs to be done to optimize this cutcode.")
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/fonts.py` & `meerk40t-0.8.3000/meerk40t/gui/fonts.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/help_assets/help_assets.py` & `meerk40t-0.8.3000/meerk40t/gui/help_assets/help_assets.py`

 * *Files 2% similar despite different names*

```diff
@@ -22,15 +22,15 @@
 
 The 'Index' value in the WordList table indicates which entry in the Contents list will be used next, zero meaning the first entry. The index is automatically increased by one at the end of each burn.
 
 But suppose for efficiency you now want to burn two seat reservation tags at the same time each having a different name from the same list. In this case, if the first tag use '{NAME#+0}' and in the second '{NAME#+1}' (note the plus sign). '{NAME}' or '{NAME#+0}' uses the current entry (pointed to by the Index value), '{NAME#+1}' uses the next entry after the current one etc.
 
 With the above usage, you can use these values as many times as you wish in your design. To advance the index you need to click on the Prev / Next buttons in the toolbar.
 
-As an alternative to manually entering the wordlist values using this WordList Editor, you can use a standard comma-separated CSV file. The placeholder names are defined in standard CSV header line (the first line in the CSV file), and the contents are then taken from all the following lines. The easiest way to create a CSV file is using a spreadsheet e.g. Excel, however e.g. for ecommerce sites your website might automaticallycreate the CSV file from the orders placed online by customers.
+As an alternative to manually entering the wordlist values using this WordList Editor, you can use a standard comma-separated CSV file. The placeholder names are defined in standard CSV header line (the first line in the CSV file), and the contents are then taken from all the following lines. The easiest way to create a CSV file is using a spreadsheet e.g. Excel, however e.g. for ecommerce sites your website might automatically create the CSV file from the orders placed online by customers.
 
 Entries loaded from a CSV file are shown as Type CSV, and you can set the Index values for all CSV entries at the same time.
 
 Note: If your CSV doesn't have a header line, columns will be named 'column_1', 'column_2' etc.
 
 The Wordlist also contains some special entries (which might be especially useful for calibration designs):
 	* 'version'   - Meerk40t version
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/hersheymanager.py` & `meerk40t-0.8.3000/meerk40t/gui/hersheymanager.py`

 * *Files 1% similar despite different names*

```diff
@@ -183,15 +183,15 @@
         self.node = node
         # print(f"set_widget for {self.attribute} to {str(node)}")
         if self.node is None or not self.accepts(node):
             self.Hide()
             return
         fontdir = fontdirectory(self.context)
         self.load_directory(fontdir)
-        self.text_text.SetValue(node.mktext)
+        self.text_text.SetValue(str(node.mktext))
         self.Show()
 
     def load_directory(self, fontdir):
         self.fonts = []
         self.list_fonts.Clear()
         if os.path.exists(fontdir):
             self.context.font_directory = fontdir
@@ -444,20 +444,21 @@
 
         self.text_info = wx.TextCtrl(
             self,
             wx.ID_ANY,
             _(
                 "MeerK40t can use True-Type-Fonts, Hershey-Fonts or Autocad-86 shape fonts designed to be rendered purely with vectors.\n"
                 + "They can be scaled, burned like any other vector shape and are therefore very versatile.\n"
-                + "See more: https://en.wikipedia.org/wiki/Hershey_fonts , "
+                + "See more: https://en.wikipedia.org/wiki/Hershey_fonts "
             ),
             style=wx.BORDER_NONE | wx.TE_MULTILINE | wx.TE_READONLY,
         )
 
         self.text_info.SetMinSize((-1, 90))
+        self.text_info.SetBackgroundColour(self.GetBackgroundColour())
         sizer_info = StaticBoxSizer(self, wx.ID_ANY, _("Information"), wx.HORIZONTAL)
         mainsizer.Add(sizer_info, 0, wx.EXPAND, 0)
         sizer_info.Add(self.text_info, 1, wx.EXPAND, 0)
 
         sizer_directory = StaticBoxSizer(
             self, wx.ID_ANY, _("Font-Directory"), wx.HORIZONTAL
         )
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/icons.py` & `meerk40t-0.8.3000/meerk40t/gui/icons.py`

 * *Files 1% similar despite different names*

```diff
@@ -3590,42 +3590,43 @@
     b"LCS+NI31/TTzvcC/KQJiYA70QsDuQKVV6FptxQbMhGaWugBroBUKWKonBZq2kQsDljtGbgB7"
     b"9Q5tJgFMgRnQ9YhpoMCEAJIODwoc2UwS8EYDzxz1VNjRBpNgz2oqPYBXYAm0bcCxwrY6ztdK"
     b"FNj38MorWugBRq4Od44O5fQfvi/q5JGheVcrLen0rSTgFXALBazzieRAx2vnB0mO8sVNQsB+"
     b"qxdgAGI6yhzqowAAAABJRU5ErkJggg=="
 )
 
 icons8_node_edit_50 = PyEmbeddedImage(
-    b'iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAABmJLR0QA/wD/AP+gvaeTAAAF'
-    b'k0lEQVRogc2Ze4hVVRTGf3e8jWXiNDmmoc1MM6RDChoYOVpj6oCSWVkJvYweJkn2oAcKJYn0'
-    b'wlTsn6ISx1QKFXprhDWTRmnZwwGRokzKMslq1LTCbG5/fOt0zz1zzn3sc2bqg8M9Z529v7XW'
-    b'2Wuvvfa+KaASqCOLb4AO4qMf8ARwtT1vAOYDvyXAHWYz+4GM79qfgCKAt4zvY2CH3W9MiLuL'
-    b'zWngTOAL4DXgcqABmBdTUQUwBVgJ3GqylcDNwGPA4Zj8YTaTAdZbg/Xkehr3muVTPith7hyb'
-    b'UybsQHFWh+JvdJFfJgVcCdwN9DHZXuAd9PXbgStM/iowEmgBmoGzTf47sBx4uUidAJ+E2EyL'
-    b'vfCulUWSNQAfog9xFFgCDPW9vwfoJPsFO03mYRiw1PpmgA8C/fPB1eYuuAFlnxPmQFVEu0nA'
-    b'c3ZNimgzAFgG/A0cAa5zNapUPIC+4HfA+AR5JwD7jPuhBHlD8aAp+hTo3w38VcDnpmN+N/AD'
-    b'MA3FeTvd44SHSvShOoHpSZPXoSzxIzAwafIQDAQOAL+SzW6J4E30haYmSVoAU0zn60kRNqOY'
-    b'XZEUYQSqgbkoI5abbJXpnpCEgq3AX0BtEmQRaEBli7fmtAG9gHqU4lvjKhiKhndNXKICeAo5'
-    b'cC2w1u7H2bsXzYb6fARlBRTMRGVId4dVPTL+JVTKeDKA582GmXEUvI9W8PJCDWNgKArdNnse'
-    b'AvyBSv8U0BuVMVtcFZSjgu6NGEbWArPtqolo41XcjT7ZMpPNsOeNwDHgJBcjGoxssUtn4CpT'
-    b'7k3gY6hS9mM0in8vnOahDFWFJv+XQBp40jiGuRhyoXW+z6FvBXAI1WNTgUvtvgNtgT1sRllp'
-    b'uD13AuvsfoHpnw3cT24CKAmXWWeXSTbJ+s7xyeaYbKI9e+tTi6+Nf8PUF63u3yNnMmZTKPJl'
-    b'rUwJhgdxyH6rfbIa37sU8DjwJ/BwBMdR4BFgMNkP0ulizHjkzFyHvmlU+J0AXgBW2/0OtNDN'
-    b'MO6lgX7+EQElnD1k59lFDrZQY52Xu3S2/q0+I95FI5RGk/gwXTdkQUcArvdxDHExpAzt2N5z'
-    b'6exDpV0evHgPbp4qTP52iB077d1gVyM2oTjuU6hhkTgFTd4DaDJ7qAC2k/3yiwL9LjH5s66K'
-    b'7zSCa1wJAphnfHf4ZH4nFgMfEe7MFlQBFHtAkYMBwHF0vBMXlWij9DXZkqcPWSc8w/2OLfD1'
-    b'byR8DhWN1UYwxpXAMJGumWqMyX5ADnjwQulbnyyFFtWfXQ1oQEO6jcLVcj6k0YHaAeBkn3wR'
-    b'Mno7cmYcSjJHgLG+dpMJT9klYYmR3BuHBLjLeG4LyD1ndpJ1IliObEZhXk0MnArsNqKmGDx9'
-    b'gV/QAXRwdD1nwpwYZe/WxtD9L4aj8qIDOC8Gz6NE101Rk3mNvRsVQ28OLkabnkOo6HPBILQ2'
-    b'bQ15F+bIWSgSNjvqi0QTGpUTwELcNjsrkNEXBORhjnjzc7KDnoI4B/jMFOxGYZIqof+5qJLd'
-    b'EJAHHalANVl7ifwloTc6C/Z2gbvQBijvaYcZNAL4Co3qTaga9iribb7np012YyFjkvByENpF'
-    b'3gKcbrJ9yLG96PCiF6oSzkDb2wEl8P9Edp5EIsnhKkfHnJNR+hxG7sIHGr12VFHvA55B4RUM'
-    b'MQ9LUToekaCdJaMMjUAd2psEK+jhKGwW5uHYZdf/Es0ohZf65+ce8mwn0t1qcjimo5B7BU32'
-    b'YlALnI/SdVuBtj2GdlTtloKx9NBfcsWiHxqFdYUaBtAbheOmqAY9HVqNKBU3ob+VS0HK+pcR'
-    b'ciwUZ3/hAq+qPejQ9yBwGtlTyf8UrejgzSUSpqF5cnuiFjkgjVZ51/1/f/L86dSTc2Qk2ljV'
-    b'4n6AcJyIg+yedCSDMk89hQvLfDgaJvwHFoGnkXE7UcMAAAAASUVORK5CYII=')
+    b"iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAABmJLR0QA/wD/AP+gvaeTAAAF"
+    b"k0lEQVRogc2Ze4hVVRTGf3e8jWXiNDmmoc1MM6RDChoYOVpj6oCSWVkJvYweJkn2oAcKJYn0"
+    b"wlTsn6ISx1QKFXprhDWTRmnZwwGRokzKMslq1LTCbG5/fOt0zz1zzn3sc2bqg8M9Z529v7XW"
+    b"2Wuvvfa+KaASqCOLb4AO4qMf8ARwtT1vAOYDvyXAHWYz+4GM79qfgCKAt4zvY2CH3W9MiLuL"
+    b"zWngTOAL4DXgcqABmBdTUQUwBVgJ3GqylcDNwGPA4Zj8YTaTAdZbg/Xkehr3muVTPith7hyb"
+    b"UybsQHFWh+JvdJFfJgVcCdwN9DHZXuAd9PXbgStM/iowEmgBmoGzTf47sBx4uUidAJ+E2EyL"
+    b"vfCulUWSNQAfog9xFFgCDPW9vwfoJPsFO03mYRiw1PpmgA8C/fPB1eYuuAFlnxPmQFVEu0nA"
+    b"c3ZNimgzAFgG/A0cAa5zNapUPIC+4HfA+AR5JwD7jPuhBHlD8aAp+hTo3w38VcDnpmN+N/AD"
+    b"MA3FeTvd44SHSvShOoHpSZPXoSzxIzAwafIQDAQOAL+SzW6J4E30haYmSVoAU0zn60kRNqOY"
+    b"XZEUYQSqgbkoI5abbJXpnpCEgq3AX0BtEmQRaEBli7fmtAG9gHqU4lvjKhiKhndNXKICeAo5"
+    b"cC2w1u7H2bsXzYb6fARlBRTMRGVId4dVPTL+JVTKeDKA582GmXEUvI9W8PJCDWNgKArdNnse"
+    b"AvyBSv8U0BuVMVtcFZSjgu6NGEbWArPtqolo41XcjT7ZMpPNsOeNwDHgJBcjGoxssUtn4CpT"
+    b"7k3gY6hS9mM0in8vnOahDFWFJv+XQBp40jiGuRhyoXW+z6FvBXAI1WNTgUvtvgNtgT1sRllp"
+    b"uD13AuvsfoHpnw3cT24CKAmXWWeXSTbJ+s7xyeaYbKI9e+tTi6+Nf8PUF63u3yNnMmZTKPJl"
+    b"rUwJhgdxyH6rfbIa37sU8DjwJ/BwBMdR4BFgMNkP0ulizHjkzFyHvmlU+J0AXgBW2/0OtNDN"
+    b"MO6lgX7+EQElnD1k59lFDrZQY52Xu3S2/q0+I95FI5RGk/gwXTdkQUcArvdxDHExpAzt2N5z"
+    b"6exDpV0evHgPbp4qTP52iB077d1gVyM2oTjuU6hhkTgFTd4DaDJ7qAC2k/3yiwL9LjH5s66K"
+    b"7zSCa1wJAphnfHf4ZH4nFgMfEe7MFlQBFHtAkYMBwHF0vBMXlWij9DXZkqcPWSc8w/2OLfD1"
+    b"byR8DhWN1UYwxpXAMJGumWqMyX5ADnjwQulbnyyFFtWfXQ1oQEO6jcLVcj6k0YHaAeBkn3wR"
+    b"Mno7cmYcSjJHgLG+dpMJT9klYYmR3BuHBLjLeG4LyD1ndpJ1IliObEZhXk0MnArsNqKmGDx9"
+    b"gV/QAXRwdD1nwpwYZe/WxtD9L4aj8qIDOC8Gz6NE101Rk3mNvRsVQ28OLkabnkOo6HPBILQ2"
+    b"bQ15F+bIWSgSNjvqi0QTGpUTwELcNjsrkNEXBORhjnjzc7KDnoI4B/jMFOxGYZIqof+5qJLd"
+    b"EJAHHalANVl7ifwloTc6C/Z2gbvQBijvaYcZNAL4Co3qTaga9iribb7np012YyFjkvByENpF"
+    b"3gKcbrJ9yLG96PCiF6oSzkDb2wEl8P9Edp5EIsnhKkfHnJNR+hxG7sIHGr12VFHvA55B4RUM"
+    b"MQ9LUToekaCdJaMMjUAd2psEK+jhKGwW5uHYZdf/Es0ohZf65+ce8mwn0t1qcjimo5B7BU32"
+    b"YlALnI/SdVuBtj2GdlTtloKx9NBfcsWiHxqFdYUaBtAbheOmqAY9HVqNKBU3ob+VS0HK+pcR"
+    b"ciwUZ3/hAq+qPejQ9yBwGtlTyf8UrejgzSUSpqF5cnuiFjkgjVZ51/1/f/L86dSTc2Qk2ljV"
+    b"4n6AcJyIg+yedCSDMk89hQvLfDgaJvwHFoGnkXE7UcMAAAAASUVORK5CYII="
+)
 
 icons8_warning_shield_20 = PyEmbeddedImage(
     b"iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwY"
     b"AAACV0lEQVR4nJ2Tz2sTQRTHV9GDB/8GQXoT9eAf4KXszk6CoFj1VpqCVmNOVRSDRnvyB14k"
     b"1GZnZheMBxGkhogmMxu0ojm0SWixgQpaE9M0UE0PWjTJJhmZQNLWTZsmX/jCY997n2Xem5Gk"
     b"LRR/OLCPBZR+iuV7JnEsMgKXGFI0isHAS3xiv7QTRZDcxzTgMXWVUQzKDKvVmcnBUmbay4UT"
     b"k4MVhtUaxaBiGo6YqI0guc8GokgeNQnMUgT4u+DJP2nzcm0lfZdXfxicrwY3WXwTubTpqU89"
@@ -3636,15 +3637,70 @@
     b"+PSr0YZFvDH35cNVznRHRvS2fctRpFyIGc5KuYA7Hrlc0JrbHZa2UiJwbC/T4cI8dVudgJ+i"
     b"I1Wmw/Rb3/E90nZ6oymHKFKtfOpO20ssvDw7xkUNC6iHt4W1FqQBDyPQKn62b/Xnwn3xbqsM"
     b"gYtSN6IY+kRjYW6sBVtK3W7AKIHermBNRQPgEsWqNfv6vJUMDVVETDVlpCdYUxEiH2XE+Z7p"
     b"jikTgSOdGv4BIclJf+4n3KEAAAAASUVORK5CYII="
 )
 
 icons8_ghost_20 = PyEmbeddedImage(
-    b'iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwY'
-    b'AAABSklEQVR4nMXTsUtVYRjH8U/dIIcM57i6qTgXRg6h4CQ25J+ggoqbS0FLg9CQf4Agru5B'
-    b'oSiIQwQ2tSnSIKLhqIEhCRUXfsZB495zFewHLxye5/t+n/Ny3sN/SDuGsqrXEVWxjN+F9Qvv'
-    b'8aBZWRu+RvIOoxjHamo7uN+M8E02zl2o38JCerPNCHfwA2PYzdts4kWOe4btsrLb+IlP6MFb'
-    b'VCLrD7MZptJINoD5HGmpDrcUZrEw5FKmCl/zOx7XEfbiuMBPXgTuBliOqLXRUXAPfdjAURx/'
-    b'05dJHzCofEawkr1Pio1HWMdJms9LyKbDHud+PvwX1IFTrJUQboStNgI/Yw936jCVMF9KDPYq'
-    b'RznAR3QWep2pHYR5XUZYm/4SW9k0UeiNp7aVwRVNpDt/wyFmctf2U+tyxTzDt8IFrj0PX1V2'
-    b'nhY8zao932z+APy3U8fp28sCAAAAAElFTkSuQmCC')
+    b"iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwY"
+    b"AAABSklEQVR4nMXTsUtVYRjH8U/dIIcM57i6qTgXRg6h4CQ25J+ggoqbS0FLg9CQf4Agru5B"
+    b"oSiIQwQ2tSnSIKLhqIEhCRUXfsZB495zFewHLxye5/t+n/Ny3sN/SDuGsqrXEVWxjN+F9Qvv"
+    b"8aBZWRu+RvIOoxjHamo7uN+M8E02zl2o38JCerPNCHfwA2PYzdts4kWOe4btsrLb+IlP6MFb"
+    b"VCLrD7MZptJINoD5HGmpDrcUZrEw5FKmCl/zOx7XEfbiuMBPXgTuBliOqLXRUXAPfdjAURx/"
+    b"05dJHzCofEawkr1Pio1HWMdJms9LyKbDHud+PvwX1IFTrJUQboStNgI/Yw936jCVMF9KDPYq"
+    b"RznAR3QWep2pHYR5XUZYm/4SW9k0UeiNp7aVwRVNpDt/wyFmctf2U+tyxTzDt8IFrj0PX1V2"
+    b"nhY8zao932z+APy3U8fp28sCAAAAAElFTkSuQmCC"
+)
+
+icons8_circled_play_50 = PyEmbeddedImage(
+    b"iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwY"
+    b"AAACGUlEQVR4nO2ZuUpDQRSGP+NSqKC4VCpY+gJulU8hiva+gpJKUIy9ShQ7S0UtXBp7tRMl"
+    b"9m6VW6mJhVcGTkACQma9g9wPDgRumMkHc2f+OYGMjIwMTRqBcSAP7AO3wDvwJaU+l+SZ+s4Y"
+    b"kCMiBoBV4AlINOsRKAD9aQr0AltAxUCgttQYRaAntMQM8OZAoLZegekQAs3AtgeB2tqUubzQ"
+    b"CpwGkEikTmROpzQHlkikzoAWlyIhltNfpTYBJ8ymKJFITdlKdAMvEYi82W7NWxFIJFIbNid2"
+    b"xfAs+PYgUjZNAKuGE3YAw8C5B5mCrkROcpDJZFUagEngzqHIk4TTuhm3mKyWNmAJ+HAkM6Ij"
+    b"kncoUmUQ2HUgsqAjcuBBpMoocGkx/p6OSMmjCLLO54Bng/FvdERsIroO7cCibK31jq8O6Lqx"
+    b"uSyZMKSxS5ZjF6n3qlyOcWl1ysHrbWmV/svLfuBRZAK4CrX95j2IqMC34yBQzuuIjDmOKMvA"
+    b"p6VAIqUCqVZofIgwNN6bdCcLFjFeBbsLhwKJ1AoG9BueJ+8eBBLZovswpOjpR5nUGhZ0RdJ8"
+    b"eHXRF56OQGQSR2ymKLGOQ1SkOExB4hhowjGt0lgOJXHko4n9u5ldDLScmgjAlKfd7Nnli63T"
+    b"F97QvEv8VWU5J7pIkT6JMybZ7EFih/GJ7YOcZKwFuTPcyE2zIqU+X8uzeUmxUf09nZGRQfz8"
+    b"ACGaYcKeMXOQAAAAAElFTkSuQmCC"
+)
+
+icons8_circled_stop_50 = PyEmbeddedImage(
+    b"iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwY"
+    b"AAAB/klEQVR4nO2ZO07DQBCGP0KgoORR8bwECA6CEsFBgnIAkh5QQNwABBQ8GtoUhI4oHIBA"
+    b"BQllSGiMFk0RRULyrNf2KviXfsmSszv6nPXO7BgyZcqUSalJYAsoAxfAM/AJfIvNdUvumd9s"
+    b"Ajk80jJQBd6AQOlXoAIspQmwAJwAAwuAUZs5asB80hA7QNcBwKg7QDEJgCngNAaAUR9LrFg0"
+    b"A9wlABGIbyWmU00lDBGI74FplyBJLKe/bDYBJ9pNESIQF6JCzAEfHoB0o27NJx5ABOKjKBlb"
+    b"k+x6QB04C+m6jAk7f9+2AqgqgjwAKxYxVoGGIk7FpgAMWzv1LCGGYb5CxmprC80txVMySySq"
+    b"6op4G5qJy4qJzXofVthxE0NjzhTj9jQglx6DnGtAWh6DNDUgXY9BPjQgA49B+v8SpDsuS6s1"
+    b"Li/75bhsv2WPQUoakE2PS5R1zcQ5aZ6FLRpN4WerNUXR+GLTnawonlLDEsZAPCri7FvE+D3E"
+    b"aPLJl8XBKuw/EUj+WMRSNUWguH1ABM160nzouOgLFz0A2caRjlOEOMShzBn+KgWIGyCPY81I"
+    b"YzkpiOs4mtjDzexaQsspTwIqxLSbvbt8sTV94SNJVFEB+pInZklRi1LOtC0A2lJ2WGfsOJST"
+    b"5tmenBmactIciM31k9wrSRXr1efpTJky4b9+ABFcO8ADWuYXAAAAAElFTkSuQmCC"
+)
+
+icons8_checkmark_50 = PyEmbeddedImage(
+    b"iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwY"
+    b"AAAERUlEQVR4nO2aXYhVVRTHf6ONM4aaNuo4CRn4kmkiJqLgixSW4RdG0KQ9WKQpaToYgoKj"
+    b"+KLpQ5LYk2D05IM+mJZipBhSlIipqY2DD+YH2hcY6ExWIwv/J5Zzz/Wer3vOEP7hMGfO3nvt"
+    b"tfdee63/2vvCQ/x/MQiYA2wG9gPngd+BTuAvvbcBnwNbVLeBHoI6YB5wEPgb6Ir53AEOAPOB"
+    b"PkUMoC/QAlxxSnUAh4G1mu1RWqVaPfb+jMrWA0e0UkF7k9WS54CmA+1OgRPAQmBgAllmWu8A"
+    b"Z5y8duAlqoh6YLvr8KQGVZOBbJMxCzgn2f8CH6vPTNEIHFcnt4EVwCNZd8I9E1wtB2F9fQMM"
+    b"c+VJVv0/PAVckGD7O47q4zngkp4mfXsbuAZMTLoSwSC+A4aQH5qA0Xp/3jmGBXEF1TtzskH0"
+    b"pxg8rRhkemxMIiDY2BdyXgmPwc5D7gZ6ERPT3cbOY0+UC7ZHpYdZxqP6PjxOsAtmwQJUEagB"
+    b"PpEOPwNP6PtbwI9RPWaLixPVcLFRsEY6/NnNIk7ru3mwissZ0A4zryLwqgLiPwqSHs2OzljM"
+    b"KYt5jnZkEbHjYiJw6wFm3cvRme6DvA8HVcm4U96wTXxZ/e+IYPp7ylUYJCrekZYKJIDFqB+k"
+    b"4KEKZtMkPS1APhZWYY4EfUW+6A3sU9/nIk5i4JanhRVuUaHlE3niQ/X7CzAyYpsP1KY1rDCY"
+    b"ldnkh8UuKZsS07N1KaUuQZsKLbPLAy8q1TVX+0bMtmNdrCvBbyp8PIZt7wLeJD5ssv5QfxsS"
+    b"erguRf0SBMlM1Jz5FZfNLY2hxFDgotruShiv+qq9xZzUAzG8qwgclWJbanAshAjGRZ3bW6lN"
+    b"K8B82bq13fYAqm0z/6nqXY7DYkMwRHJuhBX+lGKzz9XsWPudZchmq8pvAs+SDqNd3CnB/pTu"
+    b"d6qUNBl7u52ABETQIvJM0mOu66cEmzMIiJNcWvol0A+YrATNvi0jG6yXvE1hhbNVaKeFaWBm"
+    b"c9Xl+tfd/skKRyVzRljhQEcajUCmwUjnYu35IsMkrUGE0Z4B5SodUMeLMuhwmBjt2YzZ9BLp"
+    b"aJSqLF7POLGy2XuS7FAjWmI6vlYp0ATJzcv0PMxy1KRi4F6uyqcKPHwIQ61LcyNRonp3TLqS"
+    b"noNV0um8LCcyxQ64zHiKxwTpYkH1hbiNt7mLF2OsRaHRufKtSQTUKaCZgO8LOsQe4A7Sv01z"
+    b"LTdYNhnQ7jxXptENol3/k/aip80JHJ/TnrioPo2Vj8hK8FBnZrbp3q90ZJkQtfJOHc6cMr/S"
+    b"sD3zkeNPp0TasrwMPePS563Vvqqe5kwtOMlYnCCzDCjMEkc7urQnY7vYNKvznqhCoECn6HWr"
+    b"Ep8xUrSPngZ9s7J1wNfdfjBgF59L4wS7rAfUrOzyTsKfcOwTASzkJxzlfP5MHWd+pnz6V61U"
+    b"p97PKj3dpP1V1AXrQ1Bt3AVSX1y/4Zx+TQAAAABJRU5ErkJggg=="
+)
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/imagesplitter.py` & `meerk40t-0.8.3000/meerk40t/gui/imagesplitter.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/keymap.py` & `meerk40t-0.8.3000/meerk40t/gui/keymap.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/laserpanel.py` & `meerk40t-0.8.3000/meerk40t/lihuiyu/gui/lhydrivergui.py`

 * *Files 17% similar despite different names*

```diff
@@ -1,401 +1,448 @@
 import wx
-from wx import aui
 
+from meerk40t.core.units import Length
+from meerk40t.device.gui.defaultactions import DefaultActionPanel
+from meerk40t.device.gui.formatterpanel import FormatterPanel
+from meerk40t.device.gui.warningpanel import WarningPanel
 from meerk40t.gui.choicepropertypanel import ChoicePropertyPanel
-from meerk40t.gui.icons import (
-    icons8_delete_50,
-    icons8_emergency_stop_button_50,
-    icons8_gas_industry_50,
-    icons8_goal_50,
-    icons8_laser_beam_hazard2_50,
-    icons8_pause_50,
-    icons8_pentagon_50,
-    icons8_save_50,
-)
-from meerk40t.gui.wxutils import StaticBoxSizer, disable_window
-from meerk40t.kernel import lookup_listener, signal_listener
+from meerk40t.gui.icons import icons8_administrative_tools_50
+from meerk40t.gui.mwindow import MWindow
+from meerk40t.gui.wxutils import ScrolledPanel, StaticBoxSizer, TextCtrl
+from meerk40t.kernel import signal_listener
 
 _ = wx.GetTranslation
 
+FIX_SPEEDS_RATIO = 0.9195
 
-def register_panel_laser(window, context):
-    laser_panel = LaserPanel(window, wx.ID_ANY, context=context)
-    from copy import copy
-
-    prechoices = context.lookup("choices/optimize")
-    choices = list(map(copy, prechoices))
-    # Clear the page-entry
-    for entry in choices:
-        entry["page"] = ""
-    optimize_panel = ChoicePropertyPanel(
-        window, wx.ID_ANY, context=context, choices=choices
-    )
-    notebook = wx.aui.AuiNotebook(
-        window,
-        -1,
-        style=wx.aui.AUI_NB_TAB_EXTERNAL_MOVE
-        | wx.aui.AUI_NB_SCROLL_BUTTONS
-        | wx.aui.AUI_NB_TAB_SPLIT
-        | wx.aui.AUI_NB_TAB_MOVE
-        | wx.aui.AUI_NB_BOTTOM,
-    )
-    pane = (
-        aui.AuiPaneInfo()
-        .Left()
-        .MinSize(245, 210)
-        .FloatingSize(255, 270)
-        .MaxSize(500, 300)
-        .Caption(_("Laser-Control"))
-        .CaptionVisible(not context.pane_lock)
-        .Name("laser")
-    )
-    pane.submenu = "_10_" + _("Laser")
-    pane.control = notebook
-    pane.dock_proportion = 150
-    notebook.AddPage(laser_panel, _("Laser"))
-    notebook.AddPage(optimize_panel, _("Optimize"))
-
-    window.on_pane_create(pane)
-    window.context.register("pane/laser", pane)
-    choices = [
-        {
-            "attr": "laserpane_arm",
-            "object": context.root,
-            "default": False,
-            "type": bool,
-            "label": _("Enable Laser Arm"),
-            "tip": _("Enable Laser Panel Arm/Disarm feature."),
-            "page": "Laser",
-            "section": "General",
-        },
-    ]
-    context.kernel.register_choices("preferences", choices)
 
-
-class LaserPanel(wx.Panel):
+class ConfigurationUsb(wx.Panel):
     def __init__(self, *args, context=None, **kwds):
-        # begin wxGlade: MovePanel.__init__
-        kwds["style"] = kwds.get("style", 0) | wx.TAB_TRAVERSAL
+
+        # begin wxGlade: ConfigurationUsb.__init__
+        kwds["style"] = kwds.get("style", 0)
         wx.Panel.__init__(self, *args, **kwds)
         self.context = context
 
-        sizer_main = wx.BoxSizer(wx.VERTICAL)
+        sizer_usb_settings = StaticBoxSizer(
+            self, wx.ID_ANY, _("USB Settings"), wx.VERTICAL
+        )
+
+        sizer_usb_restrict = StaticBoxSizer(
+            self, wx.ID_ANY, _("Restrict Multiple Lasers"), wx.VERTICAL
+        )
+        sizer_usb_settings.Add(sizer_usb_restrict, 0, wx.EXPAND, 0)
+
+        sizer_criteria = wx.BoxSizer(wx.HORIZONTAL)
+        sizer_usb_restrict.Add(sizer_criteria, 1, wx.EXPAND, 0)
+
+        sizer_chip_version = StaticBoxSizer(
+            self, wx.ID_ANY, _("CH341 Version"), wx.HORIZONTAL
+        )
+        sizer_criteria.Add(sizer_chip_version, 0, wx.EXPAND, 0)
 
-        sizer_devices = StaticBoxSizer(self, wx.ID_ANY, _("Device"), wx.HORIZONTAL)
-        sizer_main.Add(sizer_devices, 0, wx.EXPAND, 0)
+        self.text_device_version = TextCtrl(self, wx.ID_ANY, "", style=wx.TE_READONLY)
+        sizer_chip_version.Add(self.text_device_version, 1, wx.EXPAND, 0)
+
+        self.spin_device_version = wx.SpinCtrl(self, wx.ID_ANY, "-1", min=-1, max=100)
+        self.spin_device_version.SetMinSize((40, -1))
+        self.spin_device_version.SetToolTip(
+            _(
+                "Optional: Distinguish between different lasers using the match criteria below.\n-1 match anything. 0+ match exactly that value."
+            )
+        )
+        sizer_chip_version.Add(self.spin_device_version, 0, wx.EXPAND, 0)
 
-        # Devices Initialize.
-        self.available_devices = self.context.kernel.services("device")
+        sizer_device_index = StaticBoxSizer(
+            self, wx.ID_ANY, _("Device Index:"), wx.HORIZONTAL
+        )
+        sizer_criteria.Add(sizer_device_index, 0, wx.EXPAND, 0)
 
-        self.selected_device = self.context.device
-        index = -1
-        for i, s in enumerate(self.available_devices):
-            if s is self.selected_device:
-                index = i
-                break
-        spools = [s.label for s in self.available_devices]
+        self.text_device_index = TextCtrl(self, wx.ID_ANY, "", style=wx.TE_READONLY)
+        sizer_device_index.Add(self.text_device_index, 1, wx.EXPAND, 0)
 
-        self.combo_devices = wx.ComboBox(
-            self, wx.ID_ANY, choices=spools, style=wx.CB_DROPDOWN | wx.CB_READONLY
+        self.spin_device_index = wx.SpinCtrl(self, wx.ID_ANY, "-1", min=-1, max=5)
+        self.spin_device_index.SetMinSize((40, -1))
+        self.spin_device_index.SetToolTip(
+            _(
+                "Optional: Distinguish between different lasers using the match criteria below.\n-1 match anything. 0+ match exactly that value."
+            )
         )
-        self.combo_devices.SetToolTip(
-            _("Select device from list of configured devices")
+        sizer_device_index.Add(self.spin_device_index, 0, wx.EXPAND, 0)
+
+        sizer_serial = StaticBoxSizer(
+            self, wx.ID_ANY, _("Serial Number"), wx.HORIZONTAL
         )
-        self.combo_devices.SetSelection(index)
+        sizer_usb_restrict.Add(sizer_serial, 0, wx.EXPAND, 0)
 
-        sizer_devices.Add(self.combo_devices, 1, wx.ALIGN_CENTER_VERTICAL, 0)
+        self.check_serial_number = wx.CheckBox(self, wx.ID_ANY, _("Serial Number"))
+        self.check_serial_number.SetToolTip(
+            _("Require a serial number match for this board")
+        )
+        sizer_serial.Add(self.check_serial_number, 0, wx.EXPAND, 0)
 
-        sizer_control = wx.BoxSizer(wx.HORIZONTAL)
-        sizer_main.Add(sizer_control, 0, wx.EXPAND, 0)
+        self.text_serial_number = TextCtrl(
+            self, wx.ID_ANY, "", style=wx.TE_PROCESS_ENTER
+        )
+        self.text_serial_number.SetMinSize((50, -1))
+        self.text_serial_number.SetToolTip(
+            _(
+                "Board Serial Number to be used to identify a specific laser. If the device fails to match the serial number it will be disconnected."
+            )
+        )
+        sizer_serial.Add(self.text_serial_number, 1, wx.EXPAND, 0)
 
-        self.button_start = wx.Button(self, wx.ID_ANY, _("Start"))
-        self.button_start.SetToolTip(_("Execute the Job"))
-        self.button_start.SetBitmap(icons8_gas_industry_50.GetBitmap(resize=25))
-        self.button_start.SetBackgroundColour(wx.Colour(0, 127, 0))
-        sizer_control.Add(self.button_start, 1, 0, 0)
+        sizer_buffer = StaticBoxSizer(self, wx.ID_ANY, _("Write Buffer"), wx.HORIZONTAL)
+        sizer_usb_settings.Add(sizer_buffer, 0, wx.EXPAND, 0)
 
-        self.button_pause = wx.Button(self, wx.ID_ANY, _("Pause"))
-        self.button_pause.SetForegroundColour(wx.BLACK)  # Dark Mode correction.
-        self.button_pause.SetToolTip(_("Pause/Resume the laser"))
-        self.button_pause.SetBitmap(
-            icons8_pause_50.GetBitmap(resize=25, use_theme=False)
+        self.checkbox_limit_buffer = wx.CheckBox(
+            self, wx.ID_ANY, _("Limit Write Buffer")
+        )
+        self.checkbox_limit_buffer.SetToolTip(
+            _(
+                "Limit the write buffer to a certain amount. Permits on-the-fly command production."
+            )
         )
-        self.button_pause.SetBackgroundColour(wx.Colour(255, 255, 0))
-        sizer_control.Add(self.button_pause, 1, 0, 0)
+        self.checkbox_limit_buffer.SetValue(1)
+        sizer_buffer.Add(self.checkbox_limit_buffer, 0, 0, 0)
 
-        self.button_stop = wx.Button(self, wx.ID_ANY, _("Stop"))
-        self.button_stop.SetToolTip(_("Stop the laser"))
-        self.button_stop.SetBitmap(icons8_emergency_stop_button_50.GetBitmap(resize=25))
-        self.button_stop.SetBackgroundColour(wx.Colour(127, 0, 0))
-        sizer_control.Add(self.button_stop, 1, 0, 0)
+        self.text_buffer_length = TextCtrl(
+            self, wx.ID_ANY, "", style=wx.TE_READONLY, limited=True
+        )
+        self.text_buffer_length.SetToolTip(
+            _("Current number of bytes in the write buffer.")
+        )
+        sizer_buffer.Add(self.text_buffer_length, 1, wx.EXPAND, 0)
 
-        sizer_control_misc = wx.BoxSizer(wx.HORIZONTAL)
-        sizer_main.Add(sizer_control_misc, 0, wx.EXPAND, 0)
+        label_14 = wx.StaticText(self, wx.ID_ANY, "/")
+        sizer_buffer.Add(label_14, 0, wx.ALIGN_CENTER_VERTICAL, 0)
 
-        self.arm_toggle = wx.ToggleButton(self, wx.ID_ANY, _("Arm"))
-        self.arm_toggle.SetToolTip(_("Arm the job for execution"))
-        sizer_control_misc.Add(self.arm_toggle, 1, wx.ALIGN_CENTER, 0)
+        self.spin_packet_buffer_max = wx.SpinCtrl(
+            self, wx.ID_ANY, "1500", min=1, max=1000000
+        )
+        self.spin_packet_buffer_max.SetToolTip(_("Current maximum write buffer limit."))
+        self.spin_packet_buffer_max.SetMaxSize((100, -1))
+        sizer_buffer.Add(self.spin_packet_buffer_max, 1, wx.EXPAND, 0)
 
-        self.check_laser_arm()
+        self.SetSizer(sizer_usb_settings)
 
-        self.button_outline = wx.Button(self, wx.ID_ANY, _("Outline"))
-        self.button_outline.SetToolTip(_("Trace the outline the job"))
-        self.button_outline.SetBitmap(icons8_pentagon_50.GetBitmap(resize=25))
-        sizer_control_misc.Add(self.button_outline, 1, 0, 0)
+        self.Layout()
 
-        self.button_simulate = wx.Button(self, wx.ID_ANY, _("Simulate"))
-        self.button_simulate.SetToolTip(_("Simulate the Design"))
-        self.button_simulate.SetBitmap(
-            icons8_laser_beam_hazard2_50.GetBitmap(resize=25)
+        self.Bind(
+            wx.EVT_SPINCTRL, self.spin_on_device_version, self.spin_device_version
+        )
+        self.Bind(
+            wx.EVT_TEXT_ENTER, self.spin_on_device_version, self.spin_device_version
+        )
+        self.Bind(wx.EVT_SPINCTRL, self.spin_on_device_index, self.spin_device_index)
+        self.Bind(wx.EVT_TEXT_ENTER, self.spin_on_device_index, self.spin_device_index)
+        self.Bind(
+            wx.EVT_CHECKBOX, self.on_check_serial_number, self.check_serial_number
+        )
+        self.text_serial_number.SetActionRoutine(self.on_text_serial_number)
+        self.Bind(
+            wx.EVT_CHECKBOX,
+            self.on_check_limit_packet_buffer,
+            self.checkbox_limit_buffer,
+        )
+        self.Bind(
+            wx.EVT_SPINCTRL, self.on_spin_packet_buffer_max, self.spin_packet_buffer_max
+        )
+        self.Bind(
+            wx.EVT_TEXT, self.on_spin_packet_buffer_max, self.spin_packet_buffer_max
+        )
+        self.Bind(
+            wx.EVT_TEXT_ENTER,
+            self.on_spin_packet_buffer_max,
+            self.spin_packet_buffer_max,
         )
-        sizer_control_misc.Add(self.button_simulate, 1, 0, 0)
+        # end wxGlade
+        self.spin_device_index.SetValue(self.context.usb_index)
+        self.spin_device_version.SetValue(self.context.usb_version)
+        if self.context.serial is not None:
+            self.text_serial_number.SetValue(self.context.serial)
+        self.check_serial_number.SetValue(self.context.serial_enable)
+        self.checkbox_limit_buffer.SetValue(self.context.buffer_limit)
+        self.spin_packet_buffer_max.SetValue(self.context.buffer_max)
 
-        sizer_control_update = wx.BoxSizer(wx.HORIZONTAL)
-        sizer_main.Add(sizer_control_update, 0, wx.EXPAND, 0)
+    def pane_show(self):
+        # self.context.listen("pipe;buffer", self.on_buffer_update)
+        pass
 
-        self.button_clear = wx.Button(self, wx.ID_ANY, _("Clear"))
-        self.button_clear.SetToolTip(_("Clear locally defined plan"))
-        self.button_clear.SetBitmap(icons8_delete_50.GetBitmap(resize=25))
-        sizer_control_update.Add(self.button_clear, 1, 0, 0)
+    def pane_hide(self):
+        # self.context.unlisten("pipe;buffer", self.on_buffer_update)
+        pass
 
-        self.button_update = wx.Button(self, wx.ID_ANY, _("Update"))
-        self.button_update.SetToolTip(_("Update the Plan"))
-        self.button_update.SetBitmap(icons8_goal_50.GetBitmap(resize=25))
-        sizer_control_update.Add(self.button_update, 1, 0, 0)
+    @signal_listener("pipe;buffer")
+    def on_buffer_update(self, origin, value, *args):
+        self.text_buffer_length.SetValue(str(value))
+
+    @signal_listener("pipe;index")
+    def on_update_pipe_index(self, origin, value):
+        if origin != self.context.path:
+            return
+        self.text_device_index.SetValue(str(value))
+
+    @signal_listener("pipe;chipv")
+    def on_update_pipe_chipv(self, origin, value):
+        if origin != self.context.path:
+            return
+        self.text_device_version.SetValue(str(value))
+
+    def on_check_limit_packet_buffer(
+        self, event=None
+    ):  # wxGlade: JobInfo.<event_handler>
+        self.context.buffer_limit = self.checkbox_limit_buffer.GetValue()
+
+    def on_spin_packet_buffer_max(self, event=None):  # wxGlade: JobInfo.<event_handler>
+        self.context.buffer_max = self.spin_packet_buffer_max.GetValue()
+
+    def spin_on_device_index(self, event=None):
+        self.context.usb_index = int(self.spin_device_index.GetValue())
+
+    def spin_on_device_version(self, event=None):
+        self.context.usb_version = int(self.spin_device_version.GetValue())
+
+    def on_check_serial_number(
+        self, event
+    ):  # wxGlade: ConfigurationUsb.<event_handler>
+        self.context.serial_enable = self.check_serial_number.GetValue()
 
-        self.button_save_file = wx.Button(self, wx.ID_ANY, _("Save"))
-        self.button_save_file.SetToolTip(_("Save the job"))
-        self.button_save_file.SetBitmap(icons8_save_50.GetBitmap(resize=25))
-        sizer_control_update.Add(self.button_save_file, 1, 0, 0)
+    def on_text_serial_number(self):
+        self.context.serial = self.text_serial_number.GetValue()
 
-        sizer_source = wx.BoxSizer(wx.HORIZONTAL)
-        sizer_main.Add(sizer_source, 0, wx.EXPAND, 0)
 
-        self.text_plan = wx.TextCtrl(
-            self, wx.ID_ANY, _(_("--- Empty ---")), style=wx.TE_READONLY
-        )
-        sizer_source.Add(self.text_plan, 2, 0, 0)
+class ConfigurationTcp(wx.Panel):
+    def __init__(self, *args, context=None, **kwds):
+        # begin wxGlade: ConfigurationTcp.__init__
+        kwds["style"] = kwds.get("style", 0)
+        wx.Panel.__init__(self, *args, **kwds)
+        self.context = context
+
+        sizer_13 = StaticBoxSizer(self, wx.ID_ANY, _("TCP Settings"), wx.HORIZONTAL)
 
-        self.context.setting(bool, "laserpane_hold", False)
-        self.checkbox_hold = wx.CheckBox(self, wx.ID_ANY, _("Hold"))
-        self.checkbox_hold.SetToolTip(
-            _("Preserve the job between running, rerunning, and execution")
+        h_sizer_y1 = StaticBoxSizer(self, wx.ID_ANY, _("Address"), wx.VERTICAL)
+        sizer_13.Add(h_sizer_y1, 3, wx.EXPAND, 0)
+
+        self.text_address = TextCtrl(self, wx.ID_ANY, "", style=wx.TE_PROCESS_ENTER)
+        self.text_address.SetMinSize((75, -1))
+        self.text_address.SetToolTip(_("IP/Host if the server computer"))
+        h_sizer_y1.Add(self.text_address, 1, wx.EXPAND, 0)
+
+        sizer_port = StaticBoxSizer(self, wx.ID_ANY, _("Port"), wx.VERTICAL)
+        sizer_13.Add(sizer_port, 1, wx.EXPAND, 0)
+
+        self.text_port = TextCtrl(
+            self,
+            wx.ID_ANY,
+            "",
+            limited=True,
+            check="int",
+            style=wx.TE_PROCESS_ENTER,
         )
-        self.checkbox_hold.SetValue(self.context.laserpane_hold)
-        sizer_source.Add(self.checkbox_hold, 1, wx.ALIGN_CENTER_VERTICAL, 0)
+        self.text_port.SetToolTip(_("Port for tcp connection on the server computer"))
+        sizer_port.Add(self.text_port, 1, wx.EXPAND, 0)
 
-        self.checkbox_optimize = wx.CheckBox(self, wx.ID_ANY, _("Optimize"))
-        self.checkbox_optimize.SetToolTip(_("Enable/Disable Optimize"))
-        self.checkbox_optimize.SetValue(1)
-        sizer_source.Add(self.checkbox_optimize, 1, wx.ALIGN_CENTER_VERTICAL, 0)
+        self.SetSizer(sizer_13)
 
-        self.SetSizer(sizer_main)
         self.Layout()
 
-        self.Bind(wx.EVT_CHECKBOX, self.on_check_hold, self.checkbox_hold)
-        self.Bind(wx.EVT_BUTTON, self.on_button_start, self.button_start)
-        self.Bind(wx.EVT_BUTTON, self.on_button_pause, self.button_pause)
-        self.Bind(wx.EVT_BUTTON, self.on_button_stop, self.button_stop)
-        self.Bind(wx.EVT_TOGGLEBUTTON, self.on_check_arm, self.arm_toggle)
-        self.Bind(wx.EVT_RIGHT_DOWN, self.on_menu_arm, self)
-        self.Bind(wx.EVT_BUTTON, self.on_button_outline, self.button_outline)
-        self.button_outline.Bind(wx.EVT_RIGHT_DOWN, self.on_button_outline_right)
-        self.Bind(wx.EVT_BUTTON, self.on_button_save, self.button_save_file)
-        # self.Bind(wx.EVT_BUTTON, self.on_button_load, self.button_load)
-        self.Bind(wx.EVT_BUTTON, self.on_button_clear, self.button_clear)
-        self.Bind(wx.EVT_BUTTON, self.on_button_update, self.button_update)
-        self.Bind(wx.EVT_BUTTON, self.on_button_simulate, self.button_simulate)
-        self.Bind(wx.EVT_COMBOBOX, self.on_combo_devices, self.combo_devices)
-        # self.Bind(wx.EVT_TEXT, self.on_combo_devices, self.combo_devices)
-        # self.Bind(wx.EVT_TEXT_ENTER, self.on_combo_devices, self.combo_devices)
+        self.text_address.SetActionRoutine(self.on_text_address)
+        self.text_port.SetActionRoutine(self.on_text_port)
         # end wxGlade
-        if index == -1:
-            disable_window(self)
+        self.text_port.SetValue(str(self.context.port))
+        self.text_address.SetValue(self.context.address)
+
+    def pane_show(self):
+        pass
+
+    def pane_hide(self):
+        pass
 
-    @signal_listener("device;modified")
-    @lookup_listener("service/device/active")
-    @lookup_listener("service/device/available")
-    def spooler_lookup(self, *args):
-        # Devices Initialize.
-        self.available_devices = self.context.kernel.services("device")
-        self.selected_device = self.context.device
-        index = -1
-        for i, s in enumerate(self.available_devices):
-            if s is self.selected_device:
-                index = i
-                break
-        self.combo_devices.Clear()
-        spools = [s.label for s in self.available_devices]
-        for i in range(len(spools)):
-            self.combo_devices.Append(spools[i])
-        self.combo_devices.SetSelection(index)
-        self.button_save_file.Enable(hasattr(self.context.device, "extension"))
-        self.set_pause_color()
-
-    def set_pause_color(self):
-        new_color = None
-        new_caption = _("Pause")
+    def on_text_address(self):
+        self.context.address = self.text_address.GetValue()
+
+    def on_text_port(self):  # wxGlade: ConfigurationTcp.<event_handler>
         try:
-            if self.context.device.driver.paused:
-                new_color = wx.YELLOW
-                new_caption = _("Resume")
-        except AttributeError:
+            self.context.port = int(self.text_port.GetValue())
+        except ValueError:
             pass
-        self.button_pause.SetBackgroundColour(new_color)
-        self.button_pause.SetLabelText(new_caption)
 
-    @signal_listener("pause")
-    def on_device_pause_toggle(self, origin, *args):
-        self.set_pause_color()
-
-    @signal_listener("plan")
-    def plan_update(self, origin, *message):
-        plan_name, stage = message[0], message[1]
-        if plan_name == "z":
-            plan = self.context.planner.get_or_make_plan("z")
-            if not len(plan.plan):
-                self.text_plan.SetValue(_("--- Empty ---"))
-            else:
-                self.text_plan.SetValue(f"{str(stage)}: {str(plan)}")
-
-    @signal_listener("laserpane_arm")
-    def check_laser_arm(self, *args):
-        self.context.setting(bool, "laserpane_arm", True)
-        if self.context.laserpane_arm:
-            if not self.arm_toggle.Shown:
-                self.arm_toggle.Show(True)
-                self.Layout()
-            if self.arm_toggle.GetValue():
-                self.arm_toggle.SetBackgroundColour(wx.RED)
-                self.button_start.Enable(True)
-            else:
-                self.arm_toggle.SetBackgroundColour(wx.GREEN)
-                self.button_start.Enable(False)
-        else:
-            if self.arm_toggle.Shown:
-                self.arm_toggle.Show(False)
-                self.Layout()
-            self.button_start.Enable(True)
-
-    def on_check_arm(self, event):
-        self.check_laser_arm()
-
-    def on_menu_arm_enable(self, event):
-        self.context.laserpane_arm = True
-        self.check_laser_arm()
-
-    def on_menu_arm_disable(self, event):
-        self.context.laserpane_arm = False
-        self.check_laser_arm()
-
-    def on_menu_arm(self, event):
-        menu = wx.Menu()
-        if not self.context.laserpane_arm:
-            self.Bind(
-                wx.EVT_MENU,
-                self.on_menu_arm_enable,
-                menu.Append(wx.ID_ANY, _("Enable Arm Requirement"), _("Enable Arm")),
+
+class ConfigurationInterfacePanel(ScrolledPanel):
+    def __init__(self, *args, context=None, **kwds):
+        # begin wxGlade: ConfigurationInterfacePanel.__init__
+        kwds["style"] = kwds.get("style", 0)
+        ScrolledPanel.__init__(self, *args, **kwds)
+        self.context = context
+
+        sizer_page_1 = wx.BoxSizer(wx.VERTICAL)
+
+        sizer_interface = StaticBoxSizer(self, wx.ID_ANY, _("Interface"), wx.VERTICAL)
+        sizer_page_1.Add(sizer_interface, 0, wx.EXPAND, 0)
+
+        sizer_interface_radio = wx.BoxSizer(wx.HORIZONTAL)
+        sizer_interface.Add(sizer_interface_radio, 0, wx.EXPAND, 0)
+
+        self.radio_usb = wx.RadioButton(self, wx.ID_ANY, _("USB"), style=wx.RB_GROUP)
+        self.radio_usb.SetValue(1)
+        self.radio_usb.SetToolTip(
+            _(
+                "Select this if you have an m2-nano controller physically connected to this computer using a USB cable."
             )
-        else:
-            self.Bind(
-                wx.EVT_MENU,
-                self.on_menu_arm_disable,
-                menu.Append(wx.ID_ANY, _("Disable Arm Requirement"), _("Disable Arm")),
+        )
+        sizer_interface_radio.Add(self.radio_usb, 1, wx.EXPAND, 0)
+
+        self.radio_tcp = wx.RadioButton(self, wx.ID_ANY, _("Networked"))
+        self.radio_tcp.SetToolTip(
+            _(
+                "Select this to connect this instance of Meerk40t to another instance of Meerk40t running as a remote server."
             )
-        self.PopupMenu(menu)
-        menu.Destroy()
+        )
+        sizer_interface_radio.Add(self.radio_tcp, 1, wx.EXPAND, 0)
 
-    def on_button_start(self, event):  # wxGlade: LaserPanel.<event_handler>
-        plan = self.context.planner.get_or_make_plan("z")
-        if plan.plan and self.context.laserpane_hold:
-            self.context("planz spool\n")
-        else:
-            if self.checkbox_optimize.GetValue():
-                self.context(
-                    "planz clear copy preprocess validate blob preopt optimize spool\n"
-                )
-            else:
-                self.context("planz clear copy preprocess validate blob spool\n")
-        self.arm_toggle.SetValue(False)
-        self.check_laser_arm()
-        if self.context.auto_spooler:
-            self.context("window open JobSpooler\n")
-
-    def on_button_pause(self, event):  # wxGlade: LaserPanel.<event_handler>
-        self.context("pause\n")
-
-    def on_button_stop(self, event):  # wxGlade: LaserPanel.<event_handler>
-        self.context("estop\n")
-
-    def on_button_outline(self, event):  # wxGlade: LaserPanel.<event_handler>
-        self.context("element* trace hull\n")
-
-    def on_button_outline_right(self, event):  # wxGlade: LaserPanel.<event_handler>
-        self.context("element* trace complex\n")
-
-    def on_button_save(self, event):  # wxGlade: LaserPanel.<event_handler>
-        gui = self.context.gui
-        extension = "txt"
-        if hasattr(self.context.device, "extension"):
-            extension = self.context.device.extension
-        filetype = f"*.{extension}"
-        with wx.FileDialog(
-            gui,
-            _("Save Project"),
-            wildcard=filetype,
-            style=wx.FD_SAVE | wx.FD_OVERWRITE_PROMPT,
-        ) as fileDialog:
-            if fileDialog.ShowModal() == wx.ID_CANCEL:
-                return
-            pathname = fileDialog.GetPath()
-
-            if not pathname.lower().endswith(f".{extension}"):
-                pathname += f".{extension}"
-            self.context(
-                f'planz clear copy preprocess validate blob preopt optimize save_job "{pathname}"\n'
+        self.radio_mock = wx.RadioButton(self, wx.ID_ANY, _("Mock"))
+        self.radio_mock.SetToolTip(
+            _(
+                "Select this only for debugging without a physical laser available. Execute a burn as if there was an m2-nano controller physically connected by USB."
             )
+        )
+        sizer_interface_radio.Add(self.radio_mock, 1, wx.EXPAND, 0)
 
-    def on_button_load(self, event):  # wxGlade: LaserPanel.<event_handler>
-        pass
+        self.panel_usb_settings = ConfigurationUsb(
+            self, wx.ID_ANY, context=self.context
+        )
+        sizer_interface.Add(self.panel_usb_settings, 0, wx.EXPAND, 0)
+
+        self.panel_tcp_config = ConfigurationTcp(self, wx.ID_ANY, context=self.context)
+        sizer_interface.Add(self.panel_tcp_config, 0, wx.EXPAND, 0)
+
+        self.SetSizer(sizer_page_1)
+
+        self.Layout()
+
+        self.Bind(wx.EVT_RADIOBUTTON, self.on_radio_interface, self.radio_usb)
+        self.Bind(wx.EVT_RADIOBUTTON, self.on_radio_interface, self.radio_tcp)
+        self.Bind(wx.EVT_RADIOBUTTON, self.on_radio_interface, self.radio_mock)
+        # end wxGlade
+        if self.context.mock:
+            self.panel_tcp_config.Hide()
+            self.panel_usb_settings.Hide()
+            self.radio_mock.SetValue(True)
+        elif self.context.networked:
+            self.panel_usb_settings.Hide()
+            self.radio_tcp.SetValue(True)
+        else:
+            self.radio_usb.SetValue(True)
+            self.panel_tcp_config.Hide()
+        self.SetupScrolling()
+
+    def pane_show(self):
+        self.panel_usb_settings.pane_show()
+        self.panel_tcp_config.pane_show()
+
+    def pane_hide(self):
+        self.panel_usb_settings.pane_hide()
+        self.panel_tcp_config.pane_hide()
+
+    def on_radio_interface(
+        self, event
+    ):  # wxGlade: ConfigurationInterfacePanel.<event_handler>
+        if self.radio_usb.GetValue():
+            self.panel_tcp_config.Hide()
+            self.panel_usb_settings.Show()
+            self.context.networked = False
+            self.context.mock = False
+            self.context(".network_update\n")
+        if self.radio_tcp.GetValue():
+            self.panel_tcp_config.Show()
+            self.panel_usb_settings.Hide()
+            self.context.networked = True
+            self.context.mock = False
+            self.context(".network_update\n")
+        if self.radio_mock.GetValue():
+            self.panel_tcp_config.Hide()
+            self.panel_usb_settings.Hide()
+            self.context.networked = False
+            self.context.mock = True
+            self.context(".network_update\n")
+        self.Layout()
+
+
+class LihuiyuDriverGui(MWindow):
+    def __init__(self, *args, **kwds):
+        super().__init__(330, 630, *args, **kwds)
+        self.context = self.context.device
+        _icon = wx.NullIcon
+        _icon.CopyFromBitmap(icons8_administrative_tools_50.GetBitmap())
+        self.SetIcon(_icon)
+        self.SetTitle(_("Lihuiyu-Configuration"))
+
+        # self.notebook_main = wx.Notebook(self, wx.ID_ANY)
+        self.notebook_main = wx.aui.AuiNotebook(
+            self,
+            -1,
+            style=wx.aui.AUI_NB_TAB_EXTERNAL_MOVE
+            | wx.aui.AUI_NB_SCROLL_BUTTONS
+            | wx.aui.AUI_NB_TAB_SPLIT
+            | wx.aui.AUI_NB_TAB_MOVE,
+        )
+        self.panels = []
+        panel_config = ChoicePropertyPanel(
+            self.notebook_main,
+            wx.ID_ANY,
+            context=self.context,
+            choices=("bed_dim", "bed_orientation"),
+        )
+
+        panel_interface = ConfigurationInterfacePanel(
+            self.notebook_main, wx.ID_ANY, context=self.context
+        )
+
+        panel_setup = ChoicePropertyPanel(
+            self,
+            wx.ID_ANY,
+            context=self.context,
+            choices=("lhy-general", "lhy-jog", "lhy-rapid-override", "lhy-speed"),
+        )
+        panel_warn = WarningPanel(self, id=wx.ID_ANY, context=self.context)
+        panel_actions = DefaultActionPanel(self, id=wx.ID_ANY, context=self.context)
+        panel_format = FormatterPanel(self, id=wx.ID_ANY, context=self.context)
+        panel_rotary = ChoicePropertyPanel(
+            self, wx.ID_ANY, context=self.context, choices="rotary"
+        )
+
+        self.panels.append(panel_config)
+        self.panels.append(panel_interface)
+        self.panels.append(panel_setup)
+        self.panels.append(panel_rotary)
+        self.panels.append(panel_warn)
+        self.panels.append(panel_actions)
+        self.panels.append(panel_format)
+
+        self.notebook_main.AddPage(panel_config, _("Configuration"))
+        self.notebook_main.AddPage(panel_interface, _("Interface"))
+        self.notebook_main.AddPage(panel_setup, _("Setup"))
+        self.notebook_main.AddPage(panel_rotary, _("Rotary"))
+        self.notebook_main.AddPage(panel_warn, _("Warning"))
+        self.notebook_main.AddPage(panel_actions, _("Default Actions"))
+        self.notebook_main.AddPage(panel_format, _("Display Options"))
+
+        self.Layout()
 
-    def on_button_clear(self, event):  # wxGlade: LaserPanel.<event_handler>
-        self.context("planz clear\n")
+        for panel in self.panels:
+            self.add_module_delegate(panel)
 
-    def on_button_update(self, event):  # wxGlade: LaserPanel.<event_handler>
-        with wx.BusyInfo(_("Updating Plan...")):
-            if self.checkbox_optimize.GetValue():
-                self.context(
-                    "planz clear copy preprocess validate blob preopt optimize\n"
-                )
-            else:
-                self.context("planz clear copy preprocess validate blob\n")
-
-    def on_button_simulate(self, event):  # wxGlade: LaserPanel.<event_handler>
-        with wx.BusyInfo(_("Preparing simulation...")):
-            plan = self.context.planner.get_or_make_plan("z")
-            if not plan.plan or not self.context.laserpane_hold:
-                if self.checkbox_optimize.GetValue():
-                    self.context(
-                        "planz clear copy preprocess validate blob preopt optimize\n"
-                    )
-                else:
-                    self.context("planz clear copy preprocess validate blob\n")
-
-            self.context("window toggle Simulation z 0\n")
-
-    def on_check_hold(self, event):
-        self.context.laserpane_hold = self.checkbox_hold.GetValue()
-
-    def on_button_devices(self, event):  # wxGlade: LaserPanel.<event_handler>
-        self.context("window toggle DeviceManager\n")
-
-    def on_combo_devices(self, event):  # wxGlade: LaserPanel.<event_handler>
-        index = self.combo_devices.GetSelection()
-        self.selected_device = self.available_devices[index]
-        self.selected_device.kernel.activate_service_path(
-            "device", self.selected_device.path
-        )
-        # Device change, so let's focus properly...
-        zl = self.context.zoom_margin
-        self.context(f"scene focus -{zl}% -{zl}% {100 + zl}% {100 + zl}%\n")
-        self.set_pause_color()
+    def window_open(self):
+        for panel in self.panels:
+            panel.pane_show()
+
+    def window_close(self):
+        for panel in self.panels:
+            panel.pane_hide()
+
+    def window_preserve(self):
+        return False
+
+    @staticmethod
+    def submenu():
+        return ("Device-Settings", "Configuration")
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/laserrender.py` & `meerk40t-0.8.3000/meerk40t/gui/laserrender.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,13 +1,14 @@
 from copy import copy
 from math import ceil, isnan, sqrt
 
 import wx
 from PIL import Image
 
+from meerk40t.core.elements.element_types import elem_nodes
 from meerk40t.core.node.node import Fillrule, Linecap, Linejoin, Node
 from meerk40t.svgelements import (
     Arc,
     Close,
     Color,
     CubicBezier,
     Line,
@@ -25,15 +26,14 @@
 from ..core.cutcode.linecut import LineCut
 from ..core.cutcode.outputcut import OutputCut
 from ..core.cutcode.plotcut import PlotCut
 from ..core.cutcode.quadcut import QuadCut
 from ..core.cutcode.rastercut import RasterCut
 from ..core.cutcode.setorigincut import SetOriginCut
 from ..core.cutcode.waitcut import WaitCut
-from ..core.element_types import elem_nodes
 from ..tools.geomstr import TYPE_CUBIC, TYPE_LINE, TYPE_QUAD  # , TYPE_RAMP
 from .fonts import wxfont_to_svg
 from .icons import icons8_image_50
 from .zmatrix import ZMatrix
 
 DRAW_MODE_FILLS = 0x000001
 DRAW_MODE_GUIDES = 0x000002
@@ -844,15 +844,15 @@
                 except AttributeError:
                     use_font.SetPointSize(int(fsize))
 
             gc.Destroy()
             dc.SelectObject(wx.NullBitmap)
             dc.Destroy()
             del dc
-            bmp = wx.Bitmap(dimension_x, dimension_y, 32)
+            bmp = wx.Bitmap(int(dimension_x), int(dimension_y), 32)
             dc = wx.MemoryDC()
             dc.SelectObject(bmp)
             dc.SetBackground(wx.BLACK_BRUSH)
             dc.Clear()
             gc = wx.GraphicsContext.Create(dc)
             gc.SetFont(use_font, wx.WHITE)
 
@@ -946,19 +946,19 @@
         # if it's a raster we will always translate text variables...
         variable_translation = True
         nodecopy = [e for e in _nodes]
         self.validate_text_nodes(nodecopy, variable_translation)
 
         for item in _nodes:
 
-            bb = item.bounds
-            # bb = item.paint_bounds
-            # if bb is None:
-            #     # Fall back to bounds
-            #     bb = item.bounds
+            # bb = item.bounds
+            bb = item.paint_bounds
+            if bb is None:
+                # Fall back to bounds
+                bb = item.bounds
             if bb is None:
                 continue
             if bb[0] < x_min:
                 x_min = bb[0]
             if bb[1] < y_min:
                 y_min = bb[1]
             if bb[2] > x_max:
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/lasertoolpanel.py` & `meerk40t-0.8.3000/meerk40t/gui/lasertoolpanel.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/materialtest.py` & `meerk40t-0.8.3000/meerk40t/gui/materialtest.py`

 * *Files 1% similar despite different names*

```diff
@@ -779,46 +779,50 @@
             element_branch = self.context.elements._tree.get(type="branch elems")
 
             text_scale_x = min(1.0, size_y / float(Length("20mm")))
             text_scale_y = min(1.0, size_x / float(Length("20mm")))
 
             # Make one op for text
             if display_labels or display_values:
-                text_op = RasterOpNode()
-                text_op.color = Color("black")
-                text_op.label = "Descriptions"
-                operation_branch.add_node(text_op)
+                text_op_x = RasterOpNode()
+                text_op_x.color = Color("black")
+                text_op_x.label = "Descriptions X-Axis"
+                text_op_y = RasterOpNode()
+                text_op_y.color = Color("black")
+                text_op_y.label = "Descriptions Y-Axis"
+                operation_branch.add_node(text_op_x)
+                operation_branch.add_node(text_op_y)
             if display_labels:
                 text_x = start_x + expected_width / 2
                 text_y = start_y - min(float(Length("10mm")), 3 * gap_y)
                 node = self.context.elements.elem_branch.add(
                     text=f"{param_name_1} [{param_unit_1}]",
                     matrix=Matrix(
                         f"translate({text_x}, {text_y}) scale({2 * max(text_scale_x, text_scale_y) * UNITS_PER_PIXEL})"
                     ),
                     anchor="middle",
                     fill=Color("black"),
                     type="elem text",
                 )
-                text_op.add_reference(node, 0)
+                text_op_x.add_reference(node, 0)
 
                 text_x = start_x - min(float(Length("10mm")), 3 * gap_x)
                 text_y = start_y + expected_height / 2
                 node = self.context.elements.elem_branch.add(
                     text=f"{param_name_2} [{param_unit_2}]",
                     matrix=Matrix(
                         f"translate({text_x}, {text_y}) scale({2 * max(text_scale_x, text_scale_y) * UNITS_PER_PIXEL})"
                     ),
                     anchor="middle",
                     fill=Color("black"),
                     type="elem text",
                 )
                 node.matrix.post_rotate(tau * 3 / 4, text_x, text_y)
                 node.modified()
-                text_op.add_reference(node, 0)
+                text_op_y.add_reference(node, 0)
 
             p_value_1 = min_value_1
 
             xx = start_x
             for idx1 in range(count_1):
                 pval1 = shortened(p_value_1, 3)
 
@@ -836,15 +840,15 @@
                         ),
                         anchor="middle",
                         fill=Color("black"),
                         type="elem text",
                     )
                     # node.matrix.post_rotate(tau / 4, text_x, text_y)
                     node.modified()
-                    text_op.add_reference(node, 0)
+                    text_op_x.add_reference(node, 0)
 
                 for idx2 in range(count_2):
                     pval2 = shortened(p_value_2, 3)
                     s_lbl = f"{param_type_1}={pval1}{param_unit_1}"
                     s_lbl += f"- {param_type_2}={pval2}{param_unit_2}"
                     if display_values and idx1 == 0:  # first row, so add a text above
                         text_x = xx - min(float(Length("5mm")), 1.5 * gap_x)
@@ -855,15 +859,15 @@
                                 f"translate({text_x}, {text_y}) scale({text_scale_y * UNITS_PER_PIXEL})"
                             ),
                             anchor="middle",
                             fill=Color("black"),
                             type="elem text",
                         )
                         node.matrix.post_rotate(tau * 3 / 4, text_x, text_y)
-                        text_op.add_reference(node, 0)
+                        text_op_y.add_reference(node, 0)
                     if optype == 0:  # Cut
                         this_op = copy(self.default_op[optype])
                         usefill = False
                     elif optype == 1:  # Engrave
                         this_op = copy(self.default_op[optype])
                         usefill = False
                     elif optype == 2:  # Raster
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/mkdebug.py` & `meerk40t-0.8.3000/meerk40t/gui/mkdebug.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/mwindow.py` & `meerk40t-0.8.3000/meerk40t/gui/mwindow.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/navigationpanels.py` & `meerk40t-0.8.3000/meerk40t/gui/navigationpanels.py`

 * *Files 2% similar despite different names*

```diff
@@ -2,14 +2,15 @@
 
 import wx
 from wx import aui
 
 from meerk40t.core.node.node import Node
 from meerk40t.core.units import UNITS_PER_PIXEL, Length
 from meerk40t.gui.icons import (
+    EmptyIcon,
     get_default_icon_size,
     icon_corner1,
     icon_corner2,
     icon_corner3,
     icon_corner4,
     icons8_center_of_gravity_50,
     icons8_compress_50,
@@ -36,15 +37,14 @@
     icons8_rotate_left_50,
     icons8_rotate_right_50,
     icons8_square_border_50,
     icons8_up_50,
     icons8_up_left_50,
     icons8_up_right_50,
     icons8up,
-    EmptyIcon,
 )
 from meerk40t.gui.mwindow import MWindow
 from meerk40t.gui.wxutils import StaticBoxSizer, TextCtrl
 from meerk40t.kernel.kernel import signal_listener
 from meerk40t.svgelements import Angle
 
 _ = wx.GetTranslation
@@ -239,54 +239,54 @@
     sy = Length(newy)
     nx = f"{sx.mm:.4f}mm"
     ny = f"{sy.mm:.4f}mm"
     return nx, ny
 
 
 class Drag(wx.Panel):
-    def __init__(self, *args, context=None, **kwds):
+    def __init__(self, *args, context=None, icon_size=None, **kwds):
         # begin wxGlade: Drag.__init__
         kwds["style"] = kwds.get("style", 0) | wx.TAB_TRAVERSAL
         wx.Panel.__init__(self, *args, **kwds)
         self.context = context
         self.button_align_corner_top_left = wx.BitmapButton(
-            self, wx.ID_ANY, icon_corner1.GetBitmap()
+            self, wx.ID_ANY, icon_corner1.GetBitmap(resize=icon_size)
         )
         self.button_align_drag_up = wx.BitmapButton(
-            self, wx.ID_ANY, icons8up.GetBitmap()
+            self, wx.ID_ANY, icons8up.GetBitmap(resize=icon_size)
         )
         self.button_align_corner_top_right = wx.BitmapButton(
-            self, wx.ID_ANY, icon_corner2.GetBitmap()
+            self, wx.ID_ANY, icon_corner2.GetBitmap(resize=icon_size)
         )
         self.button_align_drag_left = wx.BitmapButton(
-            self, wx.ID_ANY, icons8_left.GetBitmap()
+            self, wx.ID_ANY, icons8_left.GetBitmap(resize=icon_size)
         )
         self.button_align_center = wx.BitmapButton(
-            self, wx.ID_ANY, icons8_square_border_50.GetBitmap()
+            self, wx.ID_ANY, icons8_square_border_50.GetBitmap(resize=icon_size)
         )
         self.button_align_drag_right = wx.BitmapButton(
-            self, wx.ID_ANY, icons8_right.GetBitmap()
+            self, wx.ID_ANY, icons8_right.GetBitmap(resize=icon_size)
         )
         self.button_align_corner_bottom_left = wx.BitmapButton(
-            self, wx.ID_ANY, icon_corner4.GetBitmap()
+            self, wx.ID_ANY, icon_corner4.GetBitmap(resize=icon_size)
         )
         self.button_align_drag_down = wx.BitmapButton(
-            self, wx.ID_ANY, icons8_down.GetBitmap()
+            self, wx.ID_ANY, icons8_down.GetBitmap(resize=icon_size)
         )
         self.button_align_corner_bottom_right = wx.BitmapButton(
-            self, wx.ID_ANY, icon_corner3.GetBitmap()
+            self, wx.ID_ANY, icon_corner3.GetBitmap(resize=icon_size)
         )
         self.button_align_first_position = wx.BitmapButton(
-            self, wx.ID_ANY, icons8_level_1_50.GetBitmap()
+            self, wx.ID_ANY, icons8_level_1_50.GetBitmap(resize=icon_size)
         )
         self.button_align_trace_hull = wx.BitmapButton(
-            self, wx.ID_ANY, icons8_pentagon_50.GetBitmap()
+            self, wx.ID_ANY, icons8_pentagon_50.GetBitmap(resize=icon_size)
         )
         self.button_align_trace_quick = wx.BitmapButton(
-            self, wx.ID_ANY, icons8_pentagon_square_50.GetBitmap()
+            self, wx.ID_ANY, icons8_pentagon_square_50.GetBitmap(resize=icon_size)
         )
         self.bg_color = self.button_align_corner_top_left.BackgroundColour
         self.__set_properties()
         self.__do_layout()
 
         self.Bind(
             wx.EVT_BUTTON,
@@ -664,56 +664,56 @@
         self.context(
             f"translate {Length(amount=dx).length_mm} {Length(amount=dy).length_mm}\n"
         )
         self.drag_ready(True)
 
 
 class Jog(wx.Panel):
-    def __init__(self, *args, context=None, **kwds):
+    def __init__(self, *args, context=None, icon_size=None, **kwds):
         # begin wxGlade: Jog.__init__
         kwds["style"] = kwds.get("style", 0) | wx.TAB_TRAVERSAL
 
         wx.Panel.__init__(self, *args, **kwds)
         self.context = context
         context.setting(str, "jog_amount", "10mm")
         self.button_navigate_up_left = wx.BitmapButton(
-            self, wx.ID_ANY, icons8_up_left_50.GetBitmap()
+            self, wx.ID_ANY, icons8_up_left_50.GetBitmap(resize=icon_size)
         )
         self.button_navigate_up = wx.BitmapButton(
-            self, wx.ID_ANY, icons8_up_50.GetBitmap()
+            self, wx.ID_ANY, icons8_up_50.GetBitmap(resize=icon_size)
         )
         self.button_navigate_up_right = wx.BitmapButton(
-            self, wx.ID_ANY, icons8_up_right_50.GetBitmap()
+            self, wx.ID_ANY, icons8_up_right_50.GetBitmap(resize=icon_size)
         )
         self.button_navigate_left = wx.BitmapButton(
-            self, wx.ID_ANY, icons8_left_50.GetBitmap()
+            self, wx.ID_ANY, icons8_left_50.GetBitmap(resize=icon_size)
         )
         self.button_navigate_home = wx.BitmapButton(
-            self, wx.ID_ANY, icons8_home_filled_50.GetBitmap()
+            self, wx.ID_ANY, icons8_home_filled_50.GetBitmap(resize=icon_size)
         )
         self.button_navigate_right = wx.BitmapButton(
-            self, wx.ID_ANY, icons8_right_50.GetBitmap()
+            self, wx.ID_ANY, icons8_right_50.GetBitmap(resize=icon_size)
         )
         self.button_navigate_down_left = wx.BitmapButton(
-            self, wx.ID_ANY, icons8_down_left_50.GetBitmap()
+            self, wx.ID_ANY, icons8_down_left_50.GetBitmap(resize=icon_size)
         )
         self.button_navigate_down = wx.BitmapButton(
-            self, wx.ID_ANY, icons8_down_50.GetBitmap()
+            self, wx.ID_ANY, icons8_down_50.GetBitmap(resize=icon_size)
         )
         self.button_navigate_down_right = wx.BitmapButton(
-            self, wx.ID_ANY, icons8_down_right_50.GetBitmap()
+            self, wx.ID_ANY, icons8_down_right_50.GetBitmap(resize=icon_size)
         )
         self.button_navigate_unlock = wx.BitmapButton(
-            self, wx.ID_ANY, icons8_padlock_50.GetBitmap()
+            self, wx.ID_ANY, icons8_padlock_50.GetBitmap(resize=icon_size)
         )
         self.button_navigate_lock = wx.BitmapButton(
-            self, wx.ID_ANY, icons8_lock_50.GetBitmap()
+            self, wx.ID_ANY, icons8_lock_50.GetBitmap(resize=icon_size)
         )
         self.button_confine = wx.BitmapButton(
-            self, wx.ID_ANY, icons8_constraint_50.GetBitmap()
+            self, wx.ID_ANY, icons8_constraint_50.GetBitmap(resize=icon_size)
         )
         self.__set_properties()
         self.__do_layout()
 
         self.Bind(
             wx.EVT_BUTTON, self.on_button_navigate_ul, self.button_navigate_up_left
         )
@@ -983,80 +983,106 @@
                 x = Length(self.context.elements.length_x("0%"))
             if idx in (6, 7, 8):
                 y = Length(self.context.elements.length_y("100%"))
             elif idx in (3, 4, 5):
                 y = Length(self.context.elements.length_y("50%"))
             else:
                 y = Length(self.context.elements.length_y("0%"))
-            self.context.root.setting(str, f"MovePos{idx}", f"{x.length_mm}|{y.length_mm}")
-            label = _("Left click to go to saved position\nRight click to save coordinates")
+            self.context.root.setting(
+                str, f"MovePos{idx}", f"{x.length_mm}|{y.length_mm}"
+            )
+            label = _(
+                "Left click to go to saved position\nRight click to save coordinates"
+            )
             label += "\n" + _("Current: ") + f"{x.length_mm}, {y.length_mm}"
             btn.SetToolTip(label)
 
-        self.label_pos = wx.StaticText(self, wx.ID_ANY, "")
+        self.label_pos = wx.StaticText(self, wx.ID_ANY, "---")
         self.__set_properties()
         self.__do_layout()
 
         self.Bind(
             wx.EVT_BUTTON, self.on_button_navigate_move_to, self.button_navigate_move_to
         )
         self.Bind(
             wx.EVT_TEXT_ENTER, self.on_button_navigate_move_to, self.text_position_x
         )
         self.Bind(
             wx.EVT_TEXT_ENTER, self.on_button_navigate_move_to, self.text_position_y
         )
+        self.label_pos.Bind(wx.EVT_LEFT_DCLICK, self.on_label_dclick)
         self.button_navigate_move_to.Bind(
             wx.EVT_RIGHT_DOWN, self.on_button_navigate_move_to_right
         )
+        self.Bind(wx.EVT_SIZE, self.on_size, self)
 
     def __set_properties(self):
         # begin wxGlade: MovePanel.__set_properties
         label = _("Move to the set position")
         label += "\n" + _("Right click to activate mouse-click mode to set position")
         self.button_navigate_move_to.SetToolTip(label)
         self.button_navigate_move_to.SetSize(self.button_navigate_move_to.GetBestSize())
         self.text_position_x.SetToolTip(_("Set X value for the Move To"))
         self.text_position_y.SetToolTip(_("Set Y value for the Move To"))
+        self.label_pos.SetToolTip(_("Current laserhead position. Double-click to use."))
         # end wxGlade
 
     def __do_layout(self):
         # begin wxGlade: MovePanel.__do_layout
         main_sizer = StaticBoxSizer(self, wx.ID_ANY, _("Move Laser to:"), wx.HORIZONTAL)
         v_main_sizer = wx.BoxSizer(wx.VERTICAL)
         h_x_sizer = wx.BoxSizer(wx.HORIZONTAL)
         h_y_sizer = wx.BoxSizer(wx.HORIZONTAL)
         button_info_sizer = wx.BoxSizer(wx.VERTICAL)
         smallfont = wx.Font(
             6, wx.FONTFAMILY_SWISS, wx.FONTSTYLE_NORMAL, wx.FONTWEIGHT_NORMAL
         )
         self.label_pos.SetFont(smallfont)
-        button_info_sizer.Add(self.button_navigate_move_to, 0, wx.ALIGN_CENTER_HORIZONTAL, 0)
+        button_info_sizer.Add(
+            self.button_navigate_move_to, 0, wx.ALIGN_CENTER_HORIZONTAL, 0
+        )
         button_info_sizer.Add(self.label_pos, 0, wx.ALIGN_CENTER_HORIZONTAL, 0)
         main_sizer.Add(button_info_sizer, 0, wx.ALIGN_CENTER_VERTICAL, 0)
         label_9 = wx.StaticText(self, wx.ID_ANY, "X:")
         self.text_position_x.SetMinSize((45, 23))
         self.text_position_y.SetMinSize((45, 23))
         h_x_sizer.Add(label_9, 0, wx.ALIGN_CENTER_VERTICAL, 0)
         h_x_sizer.Add(self.text_position_x, 1, wx.EXPAND, 0)
         v_main_sizer.Add(h_x_sizer, 0, wx.EXPAND, 0)
         label_10 = wx.StaticText(self, wx.ID_ANY, "Y:")
         h_y_sizer.Add(label_10, 0, wx.ALIGN_CENTER_VERTICAL, 0)
         h_y_sizer.Add(self.text_position_y, 1, wx.EXPAND, 0)
         v_main_sizer.Add(h_y_sizer, 0, wx.EXPAND, 0)
         main_sizer.Add(v_main_sizer, 1, wx.ALIGN_CENTER_VERTICAL, 0)
-        btn_sizer = wx.GridSizer(3, 3, 2, 2)
+        self.btn_sizer = wx.GridSizer(3, 3, 2, 2)
         for idx in range(9):
-            btn_sizer.Add(self.small_buttons[idx], 0, 0, 0)
-        main_sizer.Add(btn_sizer, 0, wx.ALIGN_CENTER_VERTICAL, 0)
+            self.btn_sizer.Add(self.small_buttons[idx], 0, 0, 0)
+        main_sizer.Add(self.btn_sizer, 0, wx.ALIGN_CENTER_VERTICAL, 0)
         self.SetSizer(main_sizer)
         main_sizer.Fit(self)
         self.Layout()
         # end wxGlade
 
+    def on_size(self, event):
+        # Resize event - only display numpad buttons if enough horizontal space
+        winsize = self.GetSize()
+        display_it = bool(winsize[0] > 175)
+        self.btn_sizer.Show(display_it)
+        self.btn_sizer.ShowItems(display_it)
+        self.Layout()
+
+    def on_label_dclick(self, event):
+        p = self.context
+        pos = p.device.current
+        units = p.units_name
+        xpos = Length(amount=pos[0], preferred_units=units)
+        ypos = Length(amount=pos[1], preferred_units=units)
+        self.text_position_x.SetValue(f"{round(xpos.preferred, 6):.1f}{units}")
+        self.text_position_y.SetValue(f"{round(ypos.preferred, 6):.1f}{units}")
+
     def on_left(self, index):
         def handler(event):
             gotostr = getattr(self.context.root, f"MovePos{index}", "")
             if gotostr:
                 substr = gotostr.split("|")
                 if len(substr) < 2:
                     return
@@ -1064,34 +1090,39 @@
                     x = Length(substr[0])
                     y = Length(substr[1])
                 except ValueError:
                     return
                 self.text_position_x.SetValue(substr[0])
                 self.text_position_y.SetValue(substr[1])
                 self.on_button_navigate_move_to(None)
+
         return handler
 
     def on_right(self, index):
         def handler(event):
             btn = event.GetEventObject()
             try:
                 xlen = Length(self.text_position_x.GetValue())
                 ylen = Length(self.text_position_y.GetValue())
-                setattr(self.context.root, f"MovePos{index}", f"{xlen.length_mm}|{ylen.length_mm}")
-                label = _("Left click to go to saved position\nRight click to save coordinates")
+                setattr(
+                    self.context.root,
+                    f"MovePos{index}",
+                    f"{xlen.length_mm}|{ylen.length_mm}",
+                )
+                label = _(
+                    "Left click to go to saved position\nRight click to save coordinates"
+                )
                 label += "\n" + _("Current: ") + f"{xlen.length_mm}, {ylen.length_mm}"
                 btn.SetToolTip(label)
             except ValueError:
                 pass
 
         return handler
 
-    def on_button_navigate_move_to_right(
-        self, event=None
-    ):
+    def on_button_navigate_move_to_right(self, event=None):
         self.context("tool relocate\n")
 
     def on_button_navigate_move_to(
         self, event=None
     ):  # wxGlade: Navigation.<event_handler>
         try:
             x = self.text_position_x.GetValue()
@@ -1118,34 +1149,48 @@
                 new_units=self.context.units_name,
                 unitless=UNITS_PER_PIXEL,
             )
             self.context(f"move {pos_x} {pos_y}\n")
         except ValueError:
             return
 
-    @signal_listener("driver;position")
-    @signal_listener("emulator;position")
     def update_position_info(self, origin, pos):
         # origin, pos
 
         if pos is None:
             return
         service = self.context.device
-        # print (f"origin={origin}, pos={pos}, driver={service.path}")
         # Might not come from the right device...
         if origin not in (service.path, "lhystudios"):
             # wrong device...
             return
         # New position...
         p = self.context
         units = p.units_name
         xpos = Length(amount=pos[2], preferred_units=units)
         ypos = Length(amount=pos[3], preferred_units=units)
-        self.label_pos.SetLabel(f"{round(xpos.preferred, 6):.1f}{units}\n{round(ypos.preferred, 6):.1f}{units}")
+        self.label_pos.SetLabel(
+            f"{round(xpos.preferred, 6):.1f}{units}\n{round(ypos.preferred, 6):.1f}{units}"
+        )
+        self.label_pos.Refresh()
+        # button_info_sizer.Layout()
+        # self.GetSizer().Layout()
         self.Layout()
+        self.Refresh()
+
+    def pane_show(self, *args):
+        self.context.listen("driver;position", self.update_position_info)
+        self.context.listen("emulator;position", self.update_position_info)
+
+    # Not sure whether this is the right thing to do, if it's still locked and then
+    # the pane gets hidden?! Let's call it a feature for now...
+    def pane_hide(self, *args):
+        self.context.unlisten("driver;position", self.update_position_info)
+        self.context.unlisten("emulator;position", self.update_position_info)
+
 
 class PulsePanel(wx.Panel):
     def __init__(self, *args, context=None, **kwds):
         # begin wxGlade: PulsePanel.__init__
         kwds["style"] = kwds.get("style", 0) | wx.TAB_TRAVERSAL
         wx.Panel.__init__(self, *args, **kwds)
         self.context = context
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/notes.py` & `meerk40t-0.8.3000/meerk40t/gui/notes.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/opassignment.py` & `meerk40t-0.8.3000/meerk40t/gui/opassignment.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,11 +1,11 @@
 import wx
 from wx import aui
 
-from meerk40t.core.element_types import op_nodes
+from meerk40t.core.elements.element_types import op_nodes
 from meerk40t.gui.icons import (
     icons8_diagonal_20,
     icons8_direction_20,
     icons8_image_20,
     icons8_laser_beam_20,
     icons8_scatter_plot_20,
     icons8_small_beam_20,
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/operation_info.py` & `meerk40t-0.8.3000/meerk40t/gui/operation_info.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/plugin.py` & `meerk40t-0.8.3000/meerk40t/gui/plugin.py`

 * *Files 7% similar despite different names*

```diff
@@ -199,14 +199,53 @@
             try:
                 return data_type(value)
             except ValueError:
                 return None
 
         kernel.prompt = prompt_popup
 
+        def yesno_popup(prompt, option_yes=None, option_no=None, caption=None):
+            """
+            @param prompt: question asked of the user.
+            @param option_yes: input to be interpreted as yes (first letter is okay too).
+            @param option_no: input to be interpreted as no (first letter is okay too).
+            """
+            import wx
+
+            if option_yes is None:
+                option_yes = _("Yes")
+            if option_no is None:
+                option_no = _("No")
+            if caption is None:
+                caption = _("Question")
+            dlg = wx.MessageDialog(
+                None,
+                message=prompt,
+                caption=caption,
+                style=wx.YES_NO | wx.ICON_QUESTION,
+            )
+            if dlg.SetYesNoLabels(option_yes, option_no):
+                dlg.SetMessage(prompt)
+            else:
+                dlg.SetMessage(
+                    prompt
+                    + "\n"
+                    + _("(Yes={yes}, No={no})").format(yes=option_yes, no=option_no)
+                )
+
+            response = dlg.ShowModal()
+            dlg.Destroy()
+            return bool(response == wx.ID_YES)
+
+        kernel.yesno = yesno_popup
+
+        from meerk40t.gui.busy import BusyInfo
+
+        kernel.busyinfo = BusyInfo()
+
         @kernel.console_argument("message")
         @kernel.console_command("notify", hidden=True)
         def notification_message(message=None, **kwargs):
             if message is None:
                 message = _("Something requires your attention")
             from wx.adv import NotificationMessage
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/position.py` & `meerk40t-0.8.3000/meerk40t/gui/position.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,11 +1,11 @@
 import wx
 from wx import aui
 
-from meerk40t.core.element_types import elem_nodes
+from meerk40t.core.elements.element_types import elem_nodes
 from meerk40t.core.units import UNITS_PER_PIXEL, Length
 from meerk40t.gui.icons import icons8_up_left_50
 from meerk40t.gui.wxutils import StaticBoxSizer, TextCtrl
 
 _ = wx.GetTranslation
 
 
@@ -223,35 +223,40 @@
             self.chk_indivdually.SetValue(False)
             self.chk_lock.Enable(True)
         self.chk_indivdually.Enable(more_than_one)
 
         if reset:
             x0, y0, x1, y1 = bounds
             # conversion = ViewPort.conversion(self.position_units)
-            conversion = float(Length(f"1{self.position_units}"))
+            conversion_x = float(
+                Length(
+                    f"1{self.position_units}",
+                    relative_length=self.context.device.unit_width,
+                )
+            )
+            conversion_y = float(
+                Length(
+                    f"1{self.position_units}",
+                    relative_length=self.context.device.unit_height,
+                )
+            )
             # print ("Size: x0 = %.2f, conversion=%.5f, new=%.2f (units %s)" % (x0, conversion, x0/conversion, self.position_units))
-            self.position_x = x0 / conversion
-            self.position_y = y0 / conversion
-            self.position_w = (x1 - x0) / conversion
-            self.position_h = (y1 - y0) / conversion
+            self.position_x = x0 / conversion_x
+            self.position_y = y0 / conversion_y
+            self.position_w = (x1 - x0) / conversion_x
+            self.position_h = (y1 - y0) / conversion_y
             self.org_x = self.position_x
             self.org_y = self.position_y
             self.org_w = self.position_w
             self.org_h = self.position_h
 
-        if self.position_units == "%":
-            self.text_x.SetValue(f"{100:.2f}")
-            self.text_y.SetValue(f"{100:.2f}")
-            self.text_w.SetValue(f"{100:.2f}")
-            self.text_h.SetValue(f"{100:.2f}")
-        else:
-            self.text_x.SetValue(f"{self.position_x:.2f}")
-            self.text_y.SetValue(f"{self.position_y:.2f}")
-            self.text_w.SetValue(f"{self.position_w:.2f}")
-            self.text_h.SetValue(f"{self.position_h:.2f}")
+        self.text_x.SetValue(f"{self.position_x:.2f}")
+        self.text_y.SetValue(f"{self.position_y:.2f}")
+        self.text_w.SetValue(f"{self.position_w:.2f}")
+        self.text_h.SetValue(f"{self.position_h:.2f}")
         self.combo_box_units.SetSelection(self.choices.index(self.position_units))
 
     def space_changed(self, origin, *args):
         self.position_units = self.context.units_name
         self.update_position(True)
 
     def on_button_execute(self, event):  # wxGlade: MyFrame.<event_handler>
@@ -426,30 +431,26 @@
             self.context(cmd)
         if refresh_after:
             self.update_position(True)
 
     def on_text_w_action(self, force):
         original = self.position_w
 
-        if self.position_units == "%":
-            ratio_w = float(self.text_w.GetValue()) / 100.0
-            w = self.position_w * ratio_w
-        else:
+        try:
+            w = float(self.text_w.GetValue())
+        except ValueError:
             try:
-                w = float(self.text_w.GetValue())
+                w = self.context.device.length(
+                    self.text_w.GetValue(),
+                    0,
+                    new_units=self.position_units,
+                    unitless=UNITS_PER_PIXEL,
+                )
             except ValueError:
-                try:
-                    w = self.context.device.length(
-                        self.text_w.GetValue(),
-                        0,
-                        new_units=self.position_units,
-                        unitless=UNITS_PER_PIXEL,
-                    )
-                except ValueError:
-                    return
+                return
         if isinstance(w, str):
             return
         if abs(w) < 1e-8:
             self.text_w.SetValue(str(self.position_w))
             return
         self.position_w = w
 
@@ -462,30 +463,26 @@
 
         if force:
             self.execute_wh_changes()
             self.context.signal("refresh_scene", "Scene")
 
     def on_text_h_action(self, force):
         original = self.position_h
-        if self.position_units == "%":
-            ratio_w = float(self.text_h.GetValue()) / 100.0
-            h = self.position_h * ratio_w
-        else:
+        try:
+            h = float(self.text_h.GetValue())
+        except ValueError:
             try:
-                h = float(self.text_h.GetValue())
+                h = self.context.device.length(
+                    self.text_h.GetValue(),
+                    1,
+                    new_units=self.position_units,
+                    unitless=UNITS_PER_PIXEL,
+                )
             except ValueError:
-                try:
-                    h = self.context.device.length(
-                        self.text_h.GetValue(),
-                        1,
-                        new_units=self.position_units,
-                        unitless=UNITS_PER_PIXEL,
-                    )
-                except ValueError:
-                    return
+                return
         if isinstance(h, str):
             return
         if abs(h) < 1e-8:
             self.text_h.SetValue(str(self.position_h))
             return
 
         self.position_h = h
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/preferences.py` & `meerk40t-0.8.3000/meerk40t/gui/preferences.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/propertypanels/attributes.py` & `meerk40t-0.8.3000/meerk40t/gui/propertypanels/attributes.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/propertypanels/blobproperty.py` & `meerk40t-0.8.3000/meerk40t/gui/propertypanels/blobproperty.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/propertypanels/consoleproperty.py` & `meerk40t-0.8.3000/meerk40t/gui/propertypanels/consoleproperty.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/propertypanels/groupproperties.py` & `meerk40t-0.8.3000/meerk40t/gui/propertypanels/groupproperties.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/propertypanels/imageproperty.py` & `meerk40t-0.8.3000/meerk40t/gui/propertypanels/imageproperty.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/propertypanels/inputproperty.py` & `meerk40t-0.8.3000/meerk40t/gui/propertypanels/inputproperty.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/propertypanels/opbranchproperties.py` & `meerk40t-0.8.3000/meerk40t/gui/propertypanels/opbranchproperties.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/propertypanels/operationpropertymain.py` & `meerk40t-0.8.3000/meerk40t/gui/propertypanels/operationpropertymain.py`

 * *Files 1% similar despite different names*

```diff
@@ -242,14 +242,51 @@
             color = data.GetColour()
             rgb = color.GetRGB()
             color = swizzlecolor(rgb)
             self.operation.color = Color(color, 1.0)
             self.button_layer_color.SetBackgroundColour(
                 wx.Colour(swizzlecolor(self.operation.color))
             )
+            # Ask the user if she/he wants to assign the color of the contained objects
+            candidate_stroke = bool(self.checkbox_stroke.GetValue())
+            candidate_fill = bool(self.checkbox_fill.GetValue())
+            if (
+                self.operation.type in ("op engrave", "op cut", "op hatch")
+                and len(self.operation.children) > 0
+                and (candidate_fill or candidate_stroke)
+            ):
+                dlg = wx.MessageDialog(
+                    None,
+                    message=_(
+                        "Do you want to change the color of the contained elements too?"
+                    ),
+                    caption=_("Update Colors?"),
+                    style=wx.YES_NO | wx.ICON_QUESTION,
+                )
+                response = dlg.ShowModal()
+                dlg.Destroy()
+                if response == wx.ID_YES:
+                    changed = []
+                    for refnode in self.operation.children:
+                        cnode = refnode.node
+                        add_to_change = False
+                        if candidate_stroke and hasattr(cnode, "stroke"):
+                            cnode.stroke = self.operation.color
+                            add_to_change = True
+
+                        if candidate_fill and hasattr(cnode, "fill"):
+                            cnode.fill = self.operation.color
+                            add_to_change = True
+
+                        if add_to_change:
+                            changed.append(cnode)
+                    if len(changed) > 0:
+                        self.context.elements.signal("element_property_update", changed)
+                        self.context.elements.signal("refresh_scene", "Scene")
+
         self.context.elements.signal(
             "element_property_reload", self.operation, "button_layer"
         )
 
     # def on_combo_operation(
     #     self, event=None
     # ):  # wxGlade: OperationProperty.<event_handler>
@@ -385,16 +422,18 @@
                 "For Raster/Image operations, this is the speed of the head as it sweeps backwards and forwards."
             )
         )
 
         self.text_speed.SetToolTip(OPERATION_SPEED_TOOLTIP)
         speed_sizer.Add(self.text_speed, 1, wx.EXPAND, 0)
 
-        power_sizer = StaticBoxSizer(self, wx.ID_ANY, _("Power (ppi)"), wx.HORIZONTAL)
-        speed_power_sizer.Add(power_sizer, 1, wx.EXPAND, 0)
+        self.power_sizer = StaticBoxSizer(
+            self, wx.ID_ANY, _("Power (ppi)"), wx.HORIZONTAL
+        )
+        speed_power_sizer.Add(self.power_sizer, 1, wx.EXPAND, 0)
 
         self.text_power = TextCtrl(
             self,
             wx.ID_ANY,
             "1000.0",
             limited=True,
             check="float",
@@ -408,15 +447,15 @@
             + _("1000 is always on, 500 is half power (fire every other step).")
             + "\n"
             + _(
                 'Values of 100 or have pulses > 1/10" and are generally used only for dotted or perforated lines.'
             )
         )
         self.text_power.SetToolTip(OPERATION_POWER_TOOLTIP)
-        power_sizer.Add(self.text_power, 1, wx.EXPAND, 0)
+        self.power_sizer.Add(self.text_power, 1, wx.EXPAND, 0)
 
         freq = self.context.device.lookup("frequency")
         if freq:
             frequency_sizer = StaticBoxSizer(
                 self, wx.ID_ANY, _("Frequency (kHz)"), wx.HORIZONTAL
             )
             speed_power_sizer.Add(frequency_sizer, 1, wx.EXPAND, 0)
@@ -472,16 +511,16 @@
         self.operation = node
         if self.operation is None or not self.accepts(node):
             self.Hide()
             return
         if self.operation.speed is not None:
             set_ctrl_value(self.text_speed, str(self.operation.speed))
         if self.operation.power is not None:
-            self.update_power_label()
             set_ctrl_value(self.text_power, str(self.operation.power))
+            self.update_power_label()
         if self.operation.frequency is not None and self.text_frequency:
             set_ctrl_value(self.text_frequency, str(self.operation.frequency))
         self.Show()
 
     def on_text_speed(self):  # wxGlade: OperationProperty.<event_handler>
         try:
             value = float(self.text_speed.GetValue())
@@ -505,15 +544,19 @@
             pass
 
     def update_power_label(self):
         # if self.operation.power <= 100:
         #     self.power_label.SetLabel(_("Power (ppi):") + "")
         # else:
         #     self.power_label.SetLabel(_("Power (ppi):"))
-        pass
+        try:
+            value = float(self.text_power.GetValue())
+            self.power_sizer.SetLabel(_("Power (ppi)") + f" ({value/10:.1f}%)")
+        except ValueError:
+            return
 
     def on_text_power(self):
         try:
             value = float(self.text_power.GetValue())
             if self.operation.power != value:
                 self.operation.power = value
                 self.update_power_label()
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/propertypanels/outputproperty.py` & `meerk40t-0.8.3000/meerk40t/gui/propertypanels/outputproperty.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/propertypanels/pathproperty.py` & `meerk40t-0.8.3000/meerk40t/gui/propertypanels/pathproperty.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/propertypanels/pointproperty.py` & `meerk40t-0.8.3000/meerk40t/gui/propertypanels/pointproperty.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/propertypanels/propertywindow.py` & `meerk40t-0.8.3000/meerk40t/gui/propertypanels/propertywindow.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/propertypanels/rasterwizardpanels.py` & `meerk40t-0.8.3000/meerk40t/gui/propertypanels/rasterwizardpanels.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/propertypanels/textproperty.py` & `meerk40t-0.8.3000/meerk40t/gui/propertypanels/textproperty.py`

 * *Files 1% similar despite different names*

```diff
@@ -542,15 +542,18 @@
         self.label_fonttest.SetForegroundColour(wx.Colour(swizzlecolor(self.node.fill)))
         self.label_fonttest.Refresh()
 
         self.button_attrib_bold.SetValue(self.node.weight > 600)
         self.button_attrib_italic.SetValue(self.node.font_style != "normal")
         self.button_attrib_underline.SetValue(self.node.underline)
         self.button_attrib_strikethrough.SetValue(self.node.strikethrough)
-        self.combo_font.SetValue(self.node.wxfont.GetFaceName())
+        try:
+            self.combo_font.SetValue(self.node.wxfont.GetFaceName())
+        except AttributeError:
+            pass
 
     def font_callback(self, forecolor, newfont):
         self.node.wxfont = newfont
         self.node.fill = Color(swizzlecolor(forecolor))
         wxfont_to_svg(self.node)
         self.update_label()
         self.refresh()
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/propertypanels/waitproperty.py` & `meerk40t-0.8.3000/meerk40t/gui/propertypanels/waitproperty.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/scene/guicolors.py` & `meerk40t-0.8.3000/meerk40t/gui/scene/guicolors.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/scene/scene.py` & `meerk40t-0.8.3000/meerk40t/gui/spoolerpanel.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,1071 +1,1007 @@
-import platform
-import threading
 import time
+from math import isinf, isnan
+from pathlib import Path
 
 import wx
+import wx.lib.mixins.listctrl as listmix
+from wx import aui
 
-from meerk40t.core.element_types import elem_nodes
-from meerk40t.core.units import Length
-from meerk40t.gui.laserrender import (
-    DRAW_MODE_ANIMATE,
-    DRAW_MODE_FLIPXY,
-    DRAW_MODE_INVERT,
-    DRAW_MODE_REFRESH,
+from meerk40t.gui.icons import (
+    icons8_emergency_stop_button_50,
+    icons8_pause_50,
+    icons8_route_50,
 )
-from meerk40t.gui.scene.guicolors import GuiColors
-from meerk40t.gui.scene.sceneconst import (
-    HITCHAIN_DELEGATE,
-    HITCHAIN_DELEGATE_AND_HIT,
-    HITCHAIN_HIT,
-    HITCHAIN_HIT_AND_DELEGATE,
-    ORIENTATION_RELATIVE,
-    RESPONSE_ABORT,
-    RESPONSE_CHAIN,
-    RESPONSE_CONSUME,
-    RESPONSE_DROP,
-)
-from meerk40t.gui.scene.scenespacewidget import SceneSpaceWidget
-from meerk40t.kernel import Job, Module
-from meerk40t.svgelements import Matrix, Point
-
-# TODO: _buffer can be updated partially rather than fully rewritten, especially with some layering.
-
-
-_reused_identity_widget = Matrix()
-XCELLS = 15
-YCELLS = 15
-
-
-class SceneToast:
-    """
-    SceneToast is drawn directly by the Scene. It creates a text message in a box that animates a fade.
-    """
-
-    def __init__(self, scene, left, top, right, bottom):
-        self.scene = scene
-        self.left = left
-        self.top = top
-        self.right = right
-        self.bottom = bottom
-        self.countdown = 0
-        self.message = None
-        self.token = None
-
-        self.brush = wx.Brush()
-        self.pen = wx.Pen()
-        self.font = wx.Font()
-        self.brush_color = wx.Colour()
-        self.pen_color = wx.Colour()
-        self.font_color = wx.Colour()
-
-        self.pen.SetWidth(10)
-        self.text_height = float("inf")
-        self.text_width = float("inf")
-
-        self.alpha = None
-        self.set_alpha(255)
-
-    def tick(self):
-        """
-        Each tick reduces countdown by 1. Once countdown is below 20 we call requests for animation.
-        @return:
-        """
-        self.countdown -= 1
-        if self.countdown <= 20:
-            self.scene.request_refresh_for_animation()
-        if self.countdown <= 0:
-            self.scene.request_refresh()
-            self.message = None
-            self.token = None
-        return self.countdown > 0
-
-    def set_alpha(self, alpha):
-        """
-        We set the alpha for all the colors.
-
-        @param alpha:
-        @return:
-        """
-        if alpha != self.alpha:
-            self.alpha = alpha
-            self.brush_color.SetRGBA(0xFFFFFF | alpha << 24)
-            self.pen_color.SetRGBA(0x70FF70 | alpha << 24)
-            self.font_color.SetRGBA(0x000000 | alpha << 24)
-            self.brush.SetColour(self.brush_color)
-            self.pen.SetColour(self.pen_color)
+from meerk40t.gui.mwindow import MWindow
+from meerk40t.kernel import get_safe_path, signal_listener
 
-    def draw(self, gc: wx.GraphicsContext):
-        if not self.message:
-            return
-        alpha = 255
-        if self.countdown <= 20:
-            alpha = int(self.countdown * 12.5)
-        self.set_alpha(alpha)
-
-        width = self.right - self.left
-        height = self.bottom - self.top
-        text_size = height
-
-        while self.text_height > height or self.text_width > width:
-            # If we do not fit in the box, decrease size
-            text_size *= 0.9
-            try:
-                self.font.SetFractionalPointSize(text_size)
-            except AttributeError:
-                self.font.SetPointSize(int(text_size))
-            gc.SetFont(self.font, self.font_color)
-            self.text_width, self.text_height = gc.GetTextExtent(self.message)
-        if text_size == height:
-            gc.SetFont(self.font, self.font_color)
-        gc.SetPen(self.pen)
-        gc.SetBrush(self.brush)
-        gc.DrawRectangle(
-            self.left, self.top, self.right - self.left, self.bottom - self.top
-        )
-
-        toast_x = self.left + (width - self.text_width) / 2.0
-        toast_y = self.top
-        gc.DrawText(self.message, toast_x, toast_y)
-
-    def start_threaded(self):
-        """
-        First start of threaded animate. Refresh to draw.
-        @return:
-        """
-        self.scene.request_refresh()
-
-    def stop_threaded(self):
-        """
-        Stop of threaded animate. Unset text dims and delete the toast.
-        @return:
-        """
-        self.scene._toast = None
-        self.text_height = float("inf")
-        self.text_width = float("inf")
-
-    def set_message(self, message, token=-1, duration=100):
-        """
-        Sets the message. If the token is different, we reset the text position.
-
-        We always reset the duration.
-
-        @param message:
-        @param token:
-        @param duration:
-        @return:
-        """
-        if token != self.token or token == -1:
-            self.text_height = float("inf")
-            self.text_width = float("inf")
-        self.message = message
-        self.token = token
-        self.countdown = duration
-
-
-class Scene(Module, Job):
-    """
-    The Scene Module holds all the needed references to widgets and catches the events from the ScenePanel which
-    stores this object primarily.
-
-    Scene overloads both Module being registered in "module/Scene" and the Job to handle the refresh.
-
-    The Scene is the infinite space of the scene as seen through the panel's viewpoint. It serves to zoom, pan, and
-    manipulate various elements. This is done through a matrix which translates the scene space to window space. The
-    scene space to window space. The widgets are stored in a tree within the scene. The primary widget is the
-    SceneSpaceWidget which draws elements in two different forms. It first draws the scene and all scenewidgets added
-    to the scene and then the interface widget which contains all the non-scene widget elements.
-    """
-
-    def __init__(self, context, path, gui, **kwargs):
-        Module.__init__(self, context, path)
-        Job.__init__(
-            self,
-            job_name=f"Scene-{path}",
-            process=self.refresh_scene,
-            conditional=lambda: self.screen_refresh_is_requested,
-            run_main=True,
-        )
-        self.log = context.channel("scene")
-        self.log_events = context.channel("scene-events")
-        self.gui = gui
-        self.hittable_elements = list()
-        self.hit_chain = list()
-        self.widget_root = SceneSpaceWidget(self)
-        self.screen_refresh_lock = threading.Lock()
-        self.interval = 1.0 / 60.0  # 60fps
-        self.last_position = None
-        self._down_start_time = None
-        self._down_start_pos = None
-        self._cursor = None
-        self._reference = None  # Reference Object
-        self.attraction_points = []  # Clear all
-        self.compute = True
-        self.has_background = False
-        self.suppress_changes = True
-
-        self.colors = GuiColors(self.context)
-
-        self.screen_refresh_is_requested = True
-        self.background_brush = wx.Brush(self.colors.color_background)
-        # If set this color will be used for the scene background (used during burn)
-        self.overrule_background = None
-        # Stuff for magnet-lines
-        self.magnet_x = []
-        self.magnet_y = []
-        self.magnet_attraction = 2
-        # 0 off, `1..x` increasing strength (quadratic behaviour)
-
-        self.magnet_attract_x = True  # Shall the X-Axis be affected
-        self.magnet_attract_y = True  # Shall the Y-Axis be affected
-        self.magnet_attract_c = True  # Shall the center be affected
-
-        # Stuff related to grids and guides
-        self.tick_distance = 0
-        self.auto_tick = False  # by definition do not auto_tick
-        self.reset_grids()
-
-        self.tool_active = False
-        self.modif_active = False
-
-        self._last_snap_position = None
-        self._last_snap_ts = 0
-
-        self.active_tool = "none"
-        self.grid_points = None  # Points representing the grid - total of primary + secondary + circular
-
-        self._animating = list()
-        self._animate_lock = threading.Lock()
-        self._adding_widgets = list()
-        self._animate_job = Job(
-            self._animate_scene,
-            job_name=f"Animate-Scene{path}",
-            run_main=True,
-            interval=1.0 / 60.0,
-        )
-        self._toast = None
-
-    @property
-    def last_snap(self):
-        result = self._last_snap_position
-        # Too old? Discard
-        if (time.time() - self._last_snap_ts) > 0.5:
-            result = None
-        return result
+_ = wx.GetTranslation
 
-    @last_snap.setter
-    def last_snap(self, value):
-        self._last_snap_position = value
-        if value is None:
-            self._last_snap_ts = 0
-        else:
-            self._last_snap_ts = time.time()
+JC_INDEX = 0
+JC_DEVICE = 1
+JC_JOBNAME = 2
+JC_ENTRIES = 3
+JC_STATUS = 4
+JC_TYPE = 5
+JC_STEPS = 6
+JC_PASSES = 7
+JC_PRIORITY = 8
+JC_RUNTIME = 9
+JC_ESTIMATE = 10
+
+HC_INDEX = 0
+HC_DEVICE = 1
+HC_JOBNAME = 2
+HC_START = 3
+HC_END = 4
+HC_RUNTIME = 5
+HC_ESTIMATE = 6
+HC_STEPS = 7
+HC_PASSES = 8
+HC_STATUS = 9
+HC_JOBINFO = 10
+
+
+def register_panel_spooler(window, context):
+    panel = SpoolerPanel(window, wx.ID_ANY, context=context)
+    pane = (
+        aui.AuiPaneInfo()
+        .Bottom()
+        .Layer(1)
+        .MinSize(600, 100)
+        .FloatingSize(600, 230)
+        .Caption(_("Spooler"))
+        .Name("spooler")
+        .CaptionVisible(not context.pane_lock)
+        .Hide()
+    )
+    pane.dock_proportion = 600
+    pane.control = panel
+
+    window.on_pane_create(pane)
+    context.register("pane/spooler", pane)
+
+
+class EditableListCtrl(wx.ListCtrl, listmix.TextEditMixin):
+    """TextEditMixin allows any column to be edited."""
+
+    # ----------------------------------------------------------------------
+    def __init__(
+        self, parent, ID=wx.ID_ANY, pos=wx.DefaultPosition, size=wx.DefaultSize, style=0
+    ):
+        """Constructor"""
+        wx.ListCtrl.__init__(self, parent, ID, pos, size, style)
+        listmix.TextEditMixin.__init__(self)
+
+
+class SpoolerPanel(wx.Panel):
+    def __init__(self, *args, context=None, selected_device=None, **kwds):
+        # begin wxGlade: SpoolerPanel.__init__
+        kwds["style"] = kwds.get("style", 0) | wx.TAB_TRAVERSAL
+        wx.Panel.__init__(self, *args, **kwds)
+        self.context = context
+        self.selected_device = selected_device
+        self.available_devices = context.kernel.services("device")
+        self.filter_device = None
+        spools = [s.label for s in self.available_devices]
+        spools.insert(0, _("-- All available devices --"))
+        self.queue_entries = []
+        self.context.setting(int, "spooler_sash_position", 0)
+        self.context.setting(bool, "spool_history_clear_on_start", False)
+        self.context.setting(bool, "spool_ignore_helper_jobs", True)
+
+        self.splitter = wx.SplitterWindow(self, id=wx.ID_ANY, style=wx.SP_LIVE_UPDATE)
+        sty = wx.BORDER_SUNKEN
+
+        self.win_top = wx.Window(self.splitter, style=sty)
+        self.win_bottom = wx.Window(self.splitter, style=sty)
+        self.splitter.SetMinimumPaneSize(50)
+        self.splitter.SplitHorizontally(self.win_top, self.win_bottom, -100)
+        self.splitter.SetSashPosition(self.context.spooler_sash_position)
+        self.combo_device = wx.ComboBox(
+            self.win_top, wx.ID_ANY, choices=spools, style=wx.CB_DROPDOWN
+        )
+        self.combo_device.SetSelection(0)  # All by default...
+        self.button_pause = wx.Button(self.win_top, wx.ID_ANY, _("Pause"))
+        self.button_pause.SetToolTip(_("Pause/Resume the laser"))
+        self.button_pause.SetBitmap(icons8_pause_50.GetBitmap(resize=25))
+        self.button_stop = wx.Button(self.win_top, wx.ID_ANY, _("Abort"))
+        self.button_stop.SetToolTip(_("Stop the laser"))
+        self.button_stop.SetBitmap(icons8_emergency_stop_button_50.GetBitmap(resize=25))
+        self.button_stop.SetBackgroundColour(wx.Colour(127, 0, 0))
 
-    def reset_grids(self):
-        self.draw_grid_primary = True
-        self.tick_distance = 0
-        # Secondary grid, perpendicular, but with definable center and scaling
-        self.draw_grid_secondary = False
-        self.grid_secondary_cx = None
-        self.grid_secondary_cy = None
-        self.grid_secondary_scale_x = 1
-        self.grid_secondary_scale_y = 1
-        # Circular grid
-        self.draw_grid_circular = False
-        self.grid_circular_cx = None
-        self.grid_circular_cy = None
-
-    def clear_magnets(self):
-        self.magnet_x = []
-        self.magnet_y = []
-        self.context.signal("magnets", False)
-
-    def toggle_x_magnet(self, x_value):
-        prev = self.has_magnets()
-        if x_value in self.magnet_x:
-            self.magnet_x.remove(x_value)
-            # print("Remove x magnet for %.1f" % x_value)
-            now = self.has_magnets()
-        else:
-            self.magnet_x += [x_value]
-            # print("Add x magnet for %.1f" % x_value)
-            now = True
-        if prev != now:
-            self.context.signal("magnets", now)
-
-    def toggle_y_magnet(self, y_value):
-        prev = self.has_magnets()
-        if y_value in self.magnet_y:
-            self.magnet_y.remove(y_value)
-            # print("Remove y magnet for %.1f" % y_value)
-            now = self.has_magnets()
-        else:
-            self.magnet_y += [y_value]
-            now = True
-            # print("Add y magnet for %.1f" % y_value)
-        if prev != now:
-            self.context.signal("magnets", now)
-
-    def magnet_attracted_x(self, x_value, useit):
-        delta = float("inf")
-        x_val = None
-        if useit:
-            for mag_x in self.magnet_x:
-                if abs(x_value - mag_x) < delta:
-                    delta = abs(x_value - mag_x)
-                    x_val = mag_x
-        return delta, x_val
-
-    def magnet_attracted_y(self, y_value, useit):
-        delta = float("inf")
-        y_val = None
-        if useit:
-            for mag_y in self.magnet_y:
-                if abs(y_value - mag_y) < delta:
-                    delta = abs(y_value - mag_y)
-                    y_val = mag_y
-        return delta, y_val
-
-    def revised_magnet_bound(self, bounds=None):
-
-        dx = 0
-        dy = 0
-        if self.has_magnets() and self.magnet_attraction > 0:
-            if self.tick_distance > 0:
-                s = f"{self.tick_distance}{self.context.units_name}"
-                len_tick = float(Length(s))
-                # Attraction length is 1/3, 4/3, 9/3 of a grid-unit
-                # fmt: off
-                attraction_len = 1 / 3 * self.magnet_attraction * self.magnet_attraction * len_tick
+        self.list_job_spool = wx.ListCtrl(
+            self.win_top, wx.ID_ANY, style=wx.LC_HRULES | wx.LC_REPORT | wx.LC_VRULES
+        )
 
-                # print("Attraction len=%s, attract=%d, alen=%.1f, tlen=%.1f, factor=%.1f" % (s, self.magnet_attraction, attraction_len, len_tick, attraction_len / len_tick ))
-                # fmt: on
-            else:
-                attraction_len = float(Length("1mm"))
+        self.info_label = wx.StaticText(
+            self.win_bottom, wx.ID_ANY, _("Completed jobs:")
+        )
+        self.button_clear_history = wx.Button(
+            self.win_bottom, wx.ID_ANY, _("Clear History")
+        )
+        self.list_job_history = EditableListCtrl(
+            self.win_bottom,
+            wx.ID_ANY,
+            style=wx.LC_HRULES | wx.LC_REPORT | wx.LC_VRULES | wx.LC_SINGLE_SEL,
+        )
 
-            delta_x1, x1 = self.magnet_attracted_x(bounds[0], self.magnet_attract_x)
-            delta_x2, x2 = self.magnet_attracted_x(bounds[2], self.magnet_attract_x)
-            delta_x3, x3 = self.magnet_attracted_x(
-                (bounds[0] + bounds[2]) / 2, self.magnet_attract_c
-            )
-            delta_y1, y1 = self.magnet_attracted_y(bounds[1], self.magnet_attract_y)
-            delta_y2, y2 = self.magnet_attracted_y(bounds[3], self.magnet_attract_y)
-            delta_y3, y3 = self.magnet_attracted_y(
-                (bounds[1] + bounds[3]) / 2, self.magnet_attract_c
-            )
-            if delta_x3 < delta_x1 and delta_x3 < delta_x2:
-                if delta_x3 < attraction_len:
-                    if x3 is not None:
-                        dx = x3 - (bounds[0] + bounds[2]) / 2
-                        # print("X Take center , x=%.1f, dx=%.1f" % ((bounds[0] + bounds[2]) / 2, dx)
-            elif delta_x1 < delta_x2 and delta_x1 < delta_x3:
-                if delta_x1 < attraction_len:
-                    if x1 is not None:
-                        dx = x1 - bounds[0]
-                        # print("X Take left side, x=%.1f, dx=%.1f" % (bounds[0], dx))
-            elif delta_x2 < delta_x1 and delta_x2 < delta_x3:
-                if delta_x2 < attraction_len:
-                    if x2 is not None:
-                        dx = x2 - bounds[2]
-                        # print("X Take right side, x=%.1f, dx=%.1f" % (bounds[2], dx))
-            if delta_y3 < delta_y1 and delta_y3 < delta_y2:
-                if delta_y3 < attraction_len:
-                    if y3 is not None:
-                        dy = y3 - (bounds[1] + bounds[3]) / 2
-                        # print("Y Take center , x=%.1f, dx=%.1f" % ((bounds[1] + bounds[3]) / 2, dy))
-            elif delta_y1 < delta_y2 and delta_y1 < delta_y3:
-                if delta_y1 < attraction_len:
-                    if y1 is not None:
-                        dy = y1 - bounds[1]
-                        # print("Y Take top side, y=%.1f, dy=%.1f" % (bounds[1], dy))
-            elif delta_y2 < delta_y1 and delta_y2 < delta_y3:
-                if delta_y2 < attraction_len:
-                    if y2 is not None:
-                        dy = y2 - bounds[3]
-                        # print("Y Take bottom side, y=%.1f, dy=%.1f" % (bounds[3], dy))
-
-        return dx, dy
-
-    def has_magnets(self):
-        return len(self.magnet_x) + len(self.magnet_y) > 0
-
-    def module_open(self, *args, **kwargs):
-        context = self.context
-        context.schedule(self)
-        context.setting(int, "draw_mode", 0)
-        context.setting(bool, "mouse_zoom_invert", False)
-        context.setting(bool, "mouse_pan_invert", False)
-        context.setting(bool, "mouse_wheel_pan", False)
-        context.setting(float, "zoom_factor", 0.1)
-        context.setting(float, "pan_factor", 25.0)
-        context.setting(int, "fps", 40)
-        if context.fps <= 0:
-            context.fps = 60
-        self.interval = 1.0 / float(context.fps)
-        self.commit()
-
-    def commit(self):
-        context = self.context
-        self._init_widget(self.widget_root, context)
-
-    def module_close(self, *args, **kwargs):
-        self._final_widget(self.widget_root, self.context)
-        self.screen_refresh_lock.acquire()  # calling shutdown live locks here since it's already shutting down.
-        self.context.unschedule(self)
+        self.__set_properties()
+        self.__do_layout()
+        self.current_item = None
+        self.Bind(
+            wx.EVT_BUTTON, self.on_button_clear_history, self.button_clear_history
+        )
+        self.button_clear_history.Bind(wx.EVT_RIGHT_DOWN, self.on_right_mouse_history)
+        self.list_job_history.Bind(wx.EVT_RIGHT_DOWN, self.on_right_mouse_history)
+        self.list_job_history.Bind(
+            wx.EVT_LIST_BEGIN_LABEL_EDIT, self.before_history_update
+        )
+        self.list_job_history.Bind(wx.EVT_LIST_END_LABEL_EDIT, self.on_history_update)
+        self.Bind(wx.EVT_BUTTON, self.on_button_pause, self.button_pause)
+        self.Bind(wx.EVT_BUTTON, self.on_button_stop, self.button_stop)
+        self.Bind(wx.EVT_COMBOBOX, self.on_combo_device, self.combo_device)
+        self.Bind(wx.EVT_LIST_BEGIN_DRAG, self.on_list_drag, self.list_job_spool)
+
+        self.splitter.Bind(wx.EVT_SPLITTER_SASH_POS_CHANGED, self.on_sash_changed)
+        self.splitter.Bind(wx.EVT_SPLITTER_DOUBLECLICKED, self.on_sash_double)
+
+        self.list_job_spool.Bind(wx.EVT_LIST_ITEM_SELECTED, self.on_item_selected)
+        # self.list_job_spool.Bind(wx.EVT_LEFT_DCLICK, self.on_item_doubleclick)
+        self.Bind(
+            wx.EVT_LIST_ITEM_RIGHT_CLICK, self.on_item_rightclick, self.list_job_spool
+        )
+        # end wxGlade
+        self._last_invokation = 0
+        self.dirty = False
+        self.update_buffer_size = False
+        self.update_spooler_state = False
+        self.update_spooler = True
+
+        self.elements_progress = 0
+        self.elements_progress_total = 0
+        self.command_index = 0
+        self.listener_list = None
+        self.list_lookup = {}
+        self.map_item_key = {}
+        self.refresh_history()
+        self.set_pause_color()
+        if self.context.spool_history_clear_on_start:
+            self.clear_history()
+
+    def __set_properties(self):
+        # begin wxGlade: SpoolerPanel.__set_properties
+        self.combo_device.SetToolTip(_("Select the device"))
+        self.list_job_spool.SetToolTip(_("List and modify the queued operations"))
+        self.list_job_spool.AppendColumn(_("#"), format=wx.LIST_FORMAT_LEFT, width=58)
+        self.list_job_spool.AppendColumn(
+            _("Device"),
+            format=wx.LIST_FORMAT_LEFT,
+            width=95,
+        )
+        self.list_job_spool.AppendColumn(
+            _("Name"), format=wx.LIST_FORMAT_LEFT, width=95
+        )
+        self.list_job_spool.AppendColumn(
+            _("Items"), format=wx.LIST_FORMAT_LEFT, width=45
+        )
+        self.list_job_spool.AppendColumn(
+            _("Status"), format=wx.LIST_FORMAT_LEFT, width=73
+        )
+        self.list_job_spool.AppendColumn(
+            _("Type"), format=wx.LIST_FORMAT_LEFT, width=60
+        )
+        self.list_job_spool.AppendColumn(
+            _("Steps"), format=wx.LIST_FORMAT_LEFT, width=73
+        )
+        self.list_job_spool.AppendColumn(
+            _("Passes"), format=wx.LIST_FORMAT_LEFT, width=73
+        )
+        self.list_job_spool.AppendColumn(
+            _("Priority"), format=wx.LIST_FORMAT_LEFT, width=73
+        )
+        self.list_job_spool.AppendColumn(
+            _("Runtime"), format=wx.LIST_FORMAT_LEFT, width=73
+        )
+        self.list_job_spool.AppendColumn(
+            _("Estimate"), format=wx.LIST_FORMAT_LEFT, width=73
+        )
 
-    def _init_widget(self, widget, context):
-        try:
-            widget.init(context)
-        except AttributeError:
-            pass
-        for w in widget:
-            if w is None:
-                continue
-            self._init_widget(w, context)
+        self.list_job_history.AppendColumn(_("#"), format=wx.LIST_FORMAT_LEFT, width=48)
 
-    def _final_widget(self, widget, context):
-        try:
-            widget.final(context)
-        except AttributeError:
-            pass
-        for w in widget:
-            if w is None:
-                continue
-            self._final_widget(w, context)
+        self.list_job_history.AppendColumn(
+            _("Device"), format=wx.LIST_FORMAT_LEFT, width=73
+        )
+        self.list_job_history.AppendColumn(
+            _("Name"), format=wx.LIST_FORMAT_LEFT, width=95
+        )
+        self.list_job_history.AppendColumn(
+            _("Start"), format=wx.LIST_FORMAT_LEFT, width=113
+        )
+        self.list_job_history.AppendColumn(
+            _("End"), format=wx.LIST_FORMAT_LEFT, width=73
+        )
+        self.list_job_history.AppendColumn(
+            _("Runtime"), format=wx.LIST_FORMAT_LEFT, width=73
+        )
+        self.list_job_history.AppendColumn(
+            _("Estimate"), format=wx.LIST_FORMAT_LEFT, width=73
+        )
+        self.list_job_history.AppendColumn(
+            _("Steps"), format=wx.LIST_FORMAT_LEFT, width=73
+        )
+        self.list_job_history.AppendColumn(
+            _("Passes"), format=wx.LIST_FORMAT_LEFT, width=73
+        )
+        self.list_job_history.AppendColumn(
+            _("Status"), format=wx.LIST_FORMAT_LEFT, width=73
+        )
+        self.list_job_history.AppendColumn(
+            _("Jobinfo"), format=wx.LIST_FORMAT_LEFT, width=wx.LIST_AUTOSIZE_USEHEADER
+        )
 
-    def set_fps(self, fps):
-        """
-        Set the scene frames per second which sets the interval for the Job.
-        """
-        if fps == 0:
-            fps = 1
-        self.context.fps = fps
-        self.interval = 1.0 / float(self.context.fps)
+        # end wxGlade
 
-    def request_refresh_for_animation(self):
-        """Called on the various signals trying to animate the screen."""
-        try:
-            if self.context.draw_mode & DRAW_MODE_ANIMATE == 0:
-                self.request_refresh()
-        except AttributeError:
-            pass
+    def __do_layout(self):
+        sizer_main = wx.BoxSizer(wx.VERTICAL)
 
-    def request_refresh(self, origin=None, *args):
-        """Request an update to the scene."""
+        sizer_top = wx.BoxSizer(wx.VERTICAL)
+        sizer_bottom = wx.BoxSizer(wx.VERTICAL)
+        sizer_combo_cmds = wx.BoxSizer(wx.HORIZONTAL)
+        sizer_combo_cmds.Add(self.combo_device, 1, wx.ALIGN_CENTER_VERTICAL, 0)
+        sizer_combo_cmds.Add(self.button_pause, 0, wx.EXPAND, 0)
+        sizer_combo_cmds.Add(self.button_stop, 0, wx.EXPAND, 0)
+
+        sizer_top.Add(sizer_combo_cmds, 0, wx.EXPAND, 0)
+        sizer_top.Add(self.list_job_spool, 4, wx.EXPAND, 0)
+        self.win_top.SetSizer(sizer_top)
+        sizer_top.Fit(self.win_top)
+
+        hsizer = wx.BoxSizer(wx.HORIZONTAL)
+        hsizer.Add(self.info_label, 1, wx.ALIGN_CENTER_VERTICAL, 0)
+        hsizer.Add(self.button_clear_history, 0, wx.EXPAND, 0)
+        sizer_bottom.Add(hsizer, 0, wx.EXPAND, 0)
+        sizer_bottom.Add(self.list_job_history, 2, wx.EXPAND, 0)
+        self.win_bottom.SetSizer(sizer_bottom)
+        sizer_bottom.Fit(self.win_bottom)
+
+        sizer_main.Add(self.splitter, 1, wx.EXPAND, 0)
+        self.SetSizer(sizer_main)
+        sizer_main.Fit(self)
+        self.Layout()
+        # end wxGlade
+
+    def on_sash_changed(self, event):
+        position = self.splitter.GetSashPosition()
+        self.context.spooler_sash_position = position
+
+    def on_sash_double(self, event):
+        self.splitter.SetSashPosition(0, True)
+        self.context.spooler_sash_position = 0
+
+    def on_item_selected(self, event):
+        self.current_item = event.Index
+
+    def write_csv(self):
+        filename = Path(get_safe_path(self.context.kernel.name, create=True)).joinpath(
+            "history.csv"
+        )
+        if self.filter_device:
+            events = self.context.logging.matching_events(
+                "job", device=self.filter_device
+            )
+        else:
+            events = self.context.logging.matching_events("job")
         try:
-            if self.context.draw_mode & DRAW_MODE_REFRESH == 0:
-                self.screen_refresh_is_requested = True
-        except AttributeError:
+            with open(filename, "w", encoding="utf-8") as f:
+                simpleline = "device;jobname;start;end;duration;estimate;steps;total;loops;passes;status;info"
+                f.write(simpleline + "\n")
+                for key, info in events:
+                    line_items = []
+                    if info["start_time"] is None:
+                        continue
+                    line_items.append(str(info.get("device", "''")))
+                    line_items.append(str(info.get("label", "''")))
+                    line_items.append(
+                        f"{self.datestr(info.get('start_time',0))} {self.timestr(info.get('start_time',0), True)}"
+                    )
+
+                    line_items.append(
+                        self.timestr(
+                            info.get("start_time", 0) + info.get("duration", 0), True
+                        )
+                    )
+                    line_items.append(self.timestr(info.get("duration", 0), False))
+                    line_items.append(self.timestr(info.get("estimate", 0), False))
+                    line_items.append(str(info.get("steps_done", 0)))
+                    line_items.append(str(info.get("steps_total", 0)))
+                    line_items.append(str(info.get("loop", 0)))
+                    # First passes then device
+                    line_items.append(str(info.get("passes", "''")))
+                    line_items.append(str(info.get("status", "''")))
+                    line_items.append(str(info.get("info", "''")))
+                    f.write(f'{";".join(line_items)}\n')
+
+        except (PermissionError, OSError, FileNotFoundError):
             pass
 
-    def animate(self, widget):
-        with self._animate_lock:
-            if widget not in self._adding_widgets:
-                self._adding_widgets.append(widget)
-        if self.log:
-            self.log("Start Animation...")
-        self.context.schedule(self._animate_job)
-
-    def _animate_scene(self, *args, **kwargs):
-        if self.log:
-            self.log("Animating Scene...")
-        if self._adding_widgets:
-            with self._animate_lock:
-                animate_add = list(self._adding_widgets)
-                self._adding_widgets.clear()
-            for widget in animate_add:
-                self._animating.append(widget)
-                try:
-                    widget.start_threaded()
-                except AttributeError:
-                    pass
-        if self._animating:
-            for idx in range(len(self._animating) - 1, -1, -1):
-                widget = self._animating[idx]
-                try:
-                    more = widget.tick()
-                    if not more:
-                        try:
-                            widget.stop_threaded()
-                        except AttributeError:
-                            pass
-                        del self._animating[idx]
-                except AttributeError:
-                    pass
-        if not self._animating:
-            self._animate_job.cancel()
-            if self.log:
-                self.log("Removing Animation...")
-
-    def refresh_scene(self, *args, **kwargs):
-        """
-        Called by the Scheduler at a given the specified framerate.
-        Called in the UI thread.
-        """
-        if self.screen_refresh_is_requested:
-            if self.screen_refresh_lock.acquire(timeout=0.2):
-                try:
-                    self.update_buffer_ui_thread()  # May hit runtime error.
-                    self.gui.Refresh()
-                    self.gui.Update()
-                except RuntimeError:
-                    pass
-                self.screen_refresh_is_requested = False
-                self.screen_refresh_lock.release()
-            else:
-                self.screen_refresh_is_requested = False
+    def clear_history(self, older_than=None):
+        if self.filter_device:
+            to_remove = list(
+                self.context.logging.matching_events("job", device=self.filter_device)
+            )
+        else:
+            to_remove = list(self.context.logging.matching_events("job"))
+        for key, event in to_remove:
+            if older_than is not None:
+                if not "start_time" in event:
+                    continue
+                if event["start_time"] >= older_than:
+                    continue
+            del self.context.logging.logs[key]
+        self.refresh_history()
+
+    def on_button_clear_history(self, event):
+        self.clear_history(None)
 
-    def update_buffer_ui_thread(self):
-        """Performs redrawing of the data in the UI thread."""
-        dm = self.context.draw_mode
-        buf = self.gui._Buffer
-        if buf is None or buf.GetSize() != self.gui.ClientSize or not buf.IsOk():
-            self.gui.set_buffer()
-            buf = self.gui._Buffer
-        dc = wx.MemoryDC()
-        dc.SelectObject(buf)
-        if self.overrule_background is None:
-            self.background_brush.SetColour(self.colors.color_background)
+    def on_right_mouse_history(self, event):
+        listid = self.list_job_history.GetFirstSelected()
+        if listid >= 0:
+            idx = self.list_job_history.GetItemData(listid)
+            key = self.map_item_key[listid]
         else:
-            self.background_brush.SetColour(self.overrule_background)
-        dc.SetBackground(self.background_brush)
-        dc.Clear()
-        w, h = dc.Size
-        if dm & DRAW_MODE_FLIPXY != 0:
-            dc.SetUserScale(-1, -1)
-            dc.SetLogicalOrigin(w, h)
-        gc = wx.GraphicsContext.Create(dc)
-        gc.dc = dc
-        gc.Size = dc.Size
-
-        font = wx.Font(14, wx.FONTFAMILY_SWISS, wx.FONTSTYLE_NORMAL, wx.FONTWEIGHT_BOLD)
-        gc.SetFont(font, wx.BLACK)
-        self.draw(gc)
-        if dm & DRAW_MODE_INVERT != 0:
-            dc.Blit(0, 0, w, h, dc, 0, 0, wx.SRC_INVERT)
-        gc.Destroy()
-        dc.SelectObject(wx.NullBitmap)
-        del gc.dc
-        del dc
-
-    def toast(self, message, token=-1):
-        if self._toast is None:
-            self._toast = SceneToast(
-                self, self.x(0.1), self.y(0.8), self.x(0.9), self.y(0.9)
+            # Bad selection.
+            idx = -1
+            key = None
+
+        def on_menu_index(idx_to_delete):
+            def check(event_c):
+                del self.context.logging.logs[key]
+                self.refresh_history()
+
+            return check
+
+        def on_menu_time(cutoff):
+            def check(event):
+                self.clear_history(dcutoff)
+
+            # Store value locally
+            dcutoff = cutoff
+            return check
+
+        def toggle_1(event):
+            self.context.spool_history_clear_on_start = (
+                not self.context.spool_history_clear_on_start
             )
-            self._toast.set_message(message, token)
-            self.animate(self._toast)
-        else:
-            self._toast.set_message(message, token)
-            self.animate(self._toast)
 
-    def x(self, v):
-        width, height = self.gui.ClientSize
-        return width * v
-
-    def y(self, v):
-        width, height = self.gui.ClientSize
-        return height * v
-
-    def cell(self):
-        width, height = self.gui.ClientSize
-        return min(width / XCELLS, height / YCELLS)
-
-    def _signal_widget(self, widget, *args, **kwargs):
-        """
-        Calls the signal widget with the given args. Calls signal for the entire widget node tree.
-        """
-        try:
-            widget.signal(*args)
-        except AttributeError:
-            pass
-        for w in widget:
-            if w is None:
-                continue
-            self._signal_widget(w, *args, **kwargs)
+        def toggle_2(event):
+            self.context.spool_ignore_helper_jobs = (
+                not self.context.spool_ignore_helper_jobs
+            )
+            self.refresh_history()
 
-    def notify_added_to_parent(self, parent):
-        """
-        Called when node is added to parent. Notifying the scene as a whole.
-        """
-        pass
+        now = time.time()
+        week_seconds = 60 * 60 * 24 * 7
+        options = [(_("All entries"), None)]
+        for week in range(1, 5):
+            cutoff_time = now - week * week_seconds
+            options.append((_("Older than {week} week").format(week=week), cutoff_time))
+        menu = wx.Menu()
+        if idx >= 0:
+            menuitem = menu.Append(wx.ID_ANY, _("Delete this entry"), "")
+            self.Bind(
+                wx.EVT_MENU,
+                on_menu_index(idx),
+                id=menuitem.GetId(),
+            )
+            menu.AppendSeparator()
 
-    def notify_added_child(self, child):
-        """
-        Called when a child is added to the tree. Notifies scene as a whole.
-        """
-        try:
-            child.init(self.context)
-        except AttributeError:
-            pass
+        menuitem = menu.Append(wx.ID_ANY, _("Delete..."))
+        menu.Enable(menuitem.GetId(), False)
 
-    def notify_removed_from_parent(self, parent):
-        """
-        Called when a widget is removed from its parent. Notifies scene as a whole.
-        """
-        pass
+        for item in options:
+            menuitem = menu.Append(wx.ID_ANY, item[0], "")
+            self.Bind(
+                wx.EVT_MENU,
+                on_menu_time(item[1]),
+                id=menuitem.GetId(),
+            )
 
-    def notify_removed_child(self, child):
-        """
-        Called when a widget's child is removed. Notifies scene as a whole.
-        """
-        try:
-            child.final(self.context)
-        except AttributeError:
-            pass
+        menu.AppendSeparator()
+        menuitem = menu.Append(
+            wx.ID_ANY, _("Clear history on startup"), "", wx.ITEM_CHECK
+        )
+        menuitem.Check(self.context.spool_history_clear_on_start)
+        self.Bind(
+            wx.EVT_MENU,
+            toggle_1,
+            id=menuitem.GetId(),
+        )
+        menuitem = menu.Append(wx.ID_ANY, _("Ignore helper jobs"), "", wx.ITEM_CHECK)
+        menuitem.Check(self.context.spool_ignore_helper_jobs)
+        self.Bind(
+            wx.EVT_MENU,
+            toggle_2,
+            id=menuitem.GetId(),
+        )
 
-    def notify_moved_child(self, child):
-        """
-        Called when a widget is moved from one widget parent to another.
-        """
-        pass
+        item = menu.Append(wx.ID_ANY, _("Write CSV"), "", wx.ITEM_NORMAL)
+        self.Bind(wx.EVT_MENU, lambda e: self.write_csv(), item)
 
-    def draw(self, canvas):
-        """
-        Scene Draw routine to be called on paint when the _Buffer bitmap needs to be redrawn.
-        """
-        if self.widget_root is not None and not self.suppress_changes:
-            self.widget_root.draw(canvas)
-            if self.log:
-                self.log("Redraw Canvas")
-        if self._toast is not None:
-            self._toast.draw(canvas)
-
-    def convert_scene_to_window(self, position):
-        """
-        Convert the scene space to the window space for a particular point.
-        The position given in the scene, produces the position on the screen.
-        """
-        point = self.widget_root.scene_widget.matrix.point_in_matrix_space(position)
-        return point[0], point[1]
-
-    def convert_window_to_scene(self, position):
-        """
-        Convert the window space to the scene space for a particular point.
-        The position given is the window pixel, produces the position within the scene.
-        """
-        point = self.widget_root.scene_widget.matrix.point_in_inverse_space(position)
-        return point[0], point[1]
-
-    def rebuild_hittable_chain(self):
-        """
-        Iterates through the tree and adds all hittable elements to the hittable_elements list.
-        This is dynamically rebuilt on the mouse event.
-        """
-        self.hittable_elements.clear()
-        self.rebuild_hit_chain(self.widget_root, _reused_identity_widget)
-
-    def rebuild_hit_chain(self, current_widget, current_matrix=None):
-        """
-        Iterates through the hit chain to find elements which respond to their hit() function that they are HITCHAIN_HIT
-        and registers this within the hittable_elements list if they are able to hit at the current time. Given the
-        dimensions of the widget and the current matrix within the widget tree.
-
-        HITCHAIN_HIT means that this is a hit value and should the termination of this branch of the widget tree.
-        HITCHAIN_DELEGATE means that this is not a hittable widget and should not receive mouse events.
-        HITCHAIN_HIT_AND_DELEGATE means that this is a hittable widget, but other widgets within it might also matter.
-        HITCHAIN_DELEGATE_AND_HIT means that other widgets in the tree should be checked first, but after those this
-        widget should be checked.
-
-        The hitchain is the current matrix and current widget in the order of depth.
-
-        """
-        # If there is a matrix for the widget concatenate it.
-        if current_widget.matrix is not None:
-            matrix_within_scene = Matrix(current_widget.matrix)
-            matrix_within_scene.post_cat(current_matrix)
+        if menu.MenuItemCount != 0:
+            self.PopupMenu(menu)
+            menu.Destroy()
+
+    def on_button_pause(self, event):  # wxGlade: LaserPanel.<event_handler>
+        self.context("pause\n")
+
+    def on_button_stop(self, event):  # wxGlade: LaserPanel.<event_handler>
+        self.context("estop\n")
+
+    def on_combo_device(self, event=None):  # wxGlade: Spooler.<event_handler>
+        index = self.combo_device.GetSelection()
+        if index == 0:
+            self.filter_device = None
         else:
-            matrix_within_scene = Matrix(current_matrix)
+            self.filter_device = self.available_devices[index - 1].label
+        self.update_spooler = True
+        self.refresh_spooler_list()
+        self.refresh_history()
+        self.set_pause_color()
+
+    def on_list_drag(self, event):  # wxGlade: JobSpooler.<event_handler>
+        # Todo: Drag to reprioritise jobs
+        event.Skip()
 
-        # Add to list and recurse for children based on response.
-        response = current_widget.hit()
-        if response == HITCHAIN_HIT:
-            self.hittable_elements.append((current_widget, matrix_within_scene))
-        # elif response == HITCHAIN_HIT_WITH_PRIORITY:
-        #    self.hittable_elements.insert(0, (current_widget, matrix_within_scene))
-        elif response == HITCHAIN_DELEGATE:
-            for w in current_widget:
-                self.rebuild_hit_chain(w, matrix_within_scene)
-        elif response == HITCHAIN_HIT_AND_DELEGATE:
-            self.hittable_elements.append((current_widget, matrix_within_scene))
-            for w in current_widget:
-                self.rebuild_hit_chain(w, matrix_within_scene)
-        elif response == HITCHAIN_DELEGATE_AND_HIT:
-            for w in current_widget:
-                self.rebuild_hit_chain(w, matrix_within_scene)
-            self.hittable_elements.append((current_widget, matrix_within_scene))
-
-    def find_hit_chain(self, position):
-        """
-        Processes the hittable_elements list and find which elements are hit at a given position.
-
-        This gives the actual hits with regard to the position of the event.
-        """
-        self.hit_chain.clear()
-        for current_widget, current_matrix in self.hittable_elements:
-            try:
-                hit_point = Point(current_matrix.point_in_inverse_space(position))
-            except ZeroDivisionError:
-                current_matrix.reset()
-                # Some object is zero matrixed, reset it.
-                return
-            if current_widget.contains(hit_point.x, hit_point.y):
-                self.hit_chain.append((current_widget, current_matrix))
+    def on_item_rightclick(self, event):  # wxGlade: JobSpooler.<event_handler>
+        listindex = event.Index
+        try:
+            index = self.list_job_spool.GetItemData(listindex)
+        except AssertionError:
+            # Size of list_job_spool changed or is updating.
+            return
+        try:
+            spooler = self.queue_entries[index][0]
+            qindex = self.queue_entries[index][1]
+            element = spooler.queue[qindex]
+        except IndexError:
+            return
 
-    def event(
-        self, window_pos, event_type="", nearest_snap=None, modifiers=None, keycode=None
-    ):
-        """
-        Scene event code. Processes all the events for a particular mouse event bound in the ScenePanel.
+        menu = wx.Menu()
+        if element.status.lower() == "running":
+            action = _("Stop")
+            remove_mode = "stop"
+        else:
+            action = _("Remove")
+            remove_mode = "remove"
+        item = menu.Append(
+            wx.ID_ANY,
+            f"{action} {str(element)[:30]} [{spooler.context.label}]",
+            "",
+            wx.ITEM_NORMAL,
+        )
+        info_tuple = [spooler, element, remove_mode]
+        self.Bind(wx.EVT_MENU, self.on_menu_popup_delete(info_tuple), item)
 
-        Many mousedown events trigger the specific start of the hitchain matching, and processes the given hitchain.
-        Subsequent delegation of the events will be processed with regard to whether the matching event struck a
-        particular widget. This permits a hit widget to get all further events.
-
-        Responses to events are:
-        RESPONSE_ABORT: Aborts any future mouse events within the sequence.
-        RESPONSE_CONSUME: Consumes the event and prevents any event further in the hitchain from getting the event
-        RESPONSE_CHAIN: Permit the event to move to the next event in the hitchain
-        RESPONSE_DROP: Remove this item from the hitchain and continue to process the events. Future events will not
-        consider the dropped element within the hitchain.
-        """
-        if self.log_events:
-            self.log_events(
-                f"{event_type}: {str(window_pos)} {str(nearest_snap)} {str(modifiers)} {str(keycode)}"
-            )
+        item = menu.Append(wx.ID_ANY, _("Clear All"), "", wx.ITEM_NORMAL)
+        self.Bind(wx.EVT_MENU, self.on_menu_popup_clear(element), item)
 
-        if window_pos is None:
-            # Capture Lost
-            for i, hit in enumerate(self.hit_chain):
-                if hit is None:
-                    continue  # Element was dropped.
-                current_widget, current_matrix = hit
-                current_widget.event(
-                    window_pos=None,
-                    scene_pos=None,
-                    event_type=event_type,
-                    nearest_snap=None,
-                    modifiers=None,
-                )
+        self.PopupMenu(menu)
+        menu.Destroy()
+
+    def on_menu_popup_clear(self, element=None):
+        def clear(event=None):
+            spoolers = []
+            for device in self.available_devices:
+                addit = True
+                if (
+                    self.filter_device is not None
+                    and device.label != self.filter_device
+                ):
+                    addit = False
+                if addit:
+                    spoolers.append(device.spooler)
+            for spooler in spoolers:
+                spooler.clear_queue()
+            self.refresh_spooler_list()
+
+        return clear
+
+    def on_menu_popup_delete(self, element):
+        def delete(event=None):
+            spooler = element[0]
+            mode = element[2]
+            job = element[1]
+            spooler.remove(job)
+            # That will remove the job but create a log entry if needed.
+            if mode == "stop":
+                # Force stop of laser.
+                self.context("estop\n")
+            self.refresh_spooler_list()
+
+        return delete
+
+    def pane_show(self, *args):
+        self.refresh_spooler_list()
+
+    def pane_hide(self, *args):
+        pass
+
+    @staticmethod
+    def _name_str(named_obj):
+        try:
+            return named_obj.__name__
+        except AttributeError:
+            return str(named_obj)
+
+    def refresh_spooler_list(self):
+        if not self.update_spooler:
             return
-        if self.last_position is None:
-            self.last_position = window_pos
-        dx = window_pos[0] - self.last_position[0]
-        dy = window_pos[1] - self.last_position[1]
-        window_pos = (
-            window_pos[0],
-            window_pos[1],
-            self.last_position[0],
-            self.last_position[1],
-            dx,
-            dy,
-        )
-        self.last_position = window_pos
-        previous_top_element = None
         try:
-            idx = 0
-            while idx < len(self.hit_chain):
-                if not self.hit_chain[idx][0].transparent:
-                    previous_top_element = self.hit_chain[idx][0]
-                    break
-                idx += 1
+            self.list_job_spool.DeleteAllItems()
+        except RuntimeError:
+            return
+        self.queue_entries = []
+        queue_idx = -1
+        for device in self.available_devices:
+            spooler = device.spooler
+            if spooler is None:
+                continue
+            if self.filter_device is not None and self.filter_device != device.label:
+                continue
+            for idx, e in enumerate(spooler.queue):
+                self.queue_entries.append([spooler, idx])
+                queue_idx += 1
+                # Idx, Status, Type, Passes, Priority, Runtime, Estimate
+                m = self.list_job_spool.InsertItem(idx, f"#{idx}")
+                list_id = m
+                spool_obj = e
+
+                if list_id != -1:
+                    self.list_job_spool.SetItemData(list_id, queue_idx)
+                    # DEVICE
+                    self.list_job_spool.SetItem(list_id, JC_DEVICE, device.label)
+                    # Jobname
+                    to_display = ""
+                    if hasattr(spool_obj, "label"):
+                        to_display = spool_obj.label
+                        if to_display is None:
+                            to_display = ""
+                    if to_display == "":
+                        to_display = SpoolerPanel._name_str(spool_obj)
+                    if to_display.endswith(" items"):
+                        # Look for last ':' and remove everything from there
+                        cpos = -1
+                        lpos = -1
+                        while True:
+                            lpos = to_display.find(":", lpos + 1)
+                            if lpos == -1:
+                                break
+                            cpos = lpos
+                        if cpos > 0:
+                            to_display = to_display[:cpos]
+
+                    self.list_job_spool.SetItem(list_id, JC_JOBNAME, to_display)
+                    # Entries
+                    joblen = 1
+                    try:
+                        if hasattr(spool_obj, "items"):
+                            joblen = len(spool_obj.items)
+                        elif hasattr(spool_obj, "elements"):
+                            joblen = len(spool_obj.elements)
+                    except AttributeError:
+                        joblen = 1
+                    self.list_job_spool.SetItem(list_id, JC_ENTRIES, str(joblen))
+                    # STATUS
+                    # try:
+                    status = spool_obj.status
+                    # except AttributeError:
+                    # status = _("Queued")
+                    self.list_job_spool.SetItem(list_id, JC_STATUS, str(status))
+
+                    # TYPE
+                    try:
+                        self.list_job_spool.SetItem(
+                            list_id,
+                            JC_TYPE,
+                            str(spool_obj.__class__.__name__),
+                        )
+                    except AttributeError:
+                        pass
 
-        except (IndexError, TypeError):
-            pass
+                    # STEPS
+                    try:
+                        self.list_job_spool.SetItem(
+                            list_id,
+                            JC_STEPS,
+                            f"{spool_obj.steps_done}/{spool_obj.steps_total}",
+                        )
+                    except AttributeError:
+                        self.list_job_spool.SetItem(list_id, JC_STEPS, "-")
+                    # PASSES
+                    try:
+                        loop = spool_obj.loops_executed
+                        total = spool_obj.loops
+                        # No invalid values please
+                        if loop is None:
+                            loop = 0
+                        if total is None:
+                            total = 1
+
+                        if isinf(total):
+                            total = ""
+                        self.list_job_spool.SetItem(
+                            list_id, JC_PASSES, f"{loop}/{total}"
+                        )
+                    except AttributeError:
+                        self.list_job_spool.SetItem(list_id, JC_PASSES, "-")
 
-        if event_type in (
-            "key_down",
-            "key_up",
-        ):
-            # print("Keyboard-Event raised: %s" % event_type)
-            self.rebuild_hittable_chain()
-            for current_widget, current_matrix in self.hittable_elements:
-                space_pos = window_pos
-                if current_matrix is not None and not current_matrix.is_identity():
-                    space_cur = current_matrix.point_in_inverse_space(window_pos[0:2])
-                    space_last = current_matrix.point_in_inverse_space(window_pos[2:4])
-                    sdx = space_cur[0] - space_last[0]
-                    sdy = space_cur[1] - space_last[1]
-                    space_pos = (
-                        space_cur[0],
-                        space_cur[1],
-                        space_last[0],
-                        space_last[1],
-                        sdx,
-                        sdy,
-                    )
-                response = current_widget.event(
-                    window_pos=window_pos,
-                    space_pos=space_pos,
-                    event_type=event_type,
-                    nearest_snap=nearest_snap,
-                    modifiers=modifiers,
-                    keycode=keycode,
-                )
+                    # Priority
+                    try:
+                        self.list_job_spool.SetItem(
+                            list_id,
+                            JC_PRIORITY,
+                            str(spool_obj.priority),
+                        )
+                    except AttributeError:
+                        self.list_job_spool.SetItem(list_id, JC_PRIORITY, "-")
 
-                if response == RESPONSE_ABORT:
-                    self.hit_chain.clear()
-                    return
-                elif response == RESPONSE_CONSUME:
-                    # if event_type in ("leftdown", "middledown", "middleup", "leftup", "move", "leftclick"):
-                    #      widgetname = type(current_widget).__name__
-                    #      print("Event %s was consumed by %s" % (event_type, widgetname))
-                    return
-                elif response == RESPONSE_CHAIN:
-                    continue
-                elif response == RESPONSE_DROP:
-                    # self.hit_chain[i] = None
-                    continue
-                #
-                # if response == RESPONSE_ABORT:
-                #     self.hit_chain.clear()
-            return
+                    # Runtime
+                    try:
+                        t = spool_obj.elapsed_time()
+                        hours, remainder = divmod(t, 3600)
+                        minutes, seconds = divmod(remainder, 60)
+                        runtime = f"{int(hours)}:{str(int(minutes)).zfill(2)}:{str(int(seconds)).zfill(2)}"
+                        self.list_job_spool.SetItem(list_id, JC_RUNTIME, runtime)
+                    except AttributeError:
+                        self.list_job_spool.SetItem(list_id, JC_RUNTIME, "-")
+
+                    # Estimate Time
+                    try:
+                        t = spool_obj.estimate_time()
+                        if isinf(t):
+                            runtime = ""
+                        else:
+                            hours, remainder = divmod(t, 3600)
+                            minutes, seconds = divmod(remainder, 60)
+                            runtime = f"{int(hours)}:{str(int(minutes)).zfill(2)}:{str(int(seconds)).zfill(2)}"
+                        self.list_job_spool.SetItem(list_id, JC_ESTIMATE, runtime)
+                    except AttributeError:
+                        self.list_job_spool.SetItem(list_id, JC_ESTIMATE, "-")
+        self._last_invokation = time.time()
+
+    @staticmethod
+    def timestr(t, oneday):
+        if t is None:
+            return ""
+        if isinstance(t, str):
+            return t
+        if isinf(t) or isnan(t) or t < 0:
+            return ""
+
+        if oneday:
+            localt = time.localtime(t)
+            hours = localt[3]
+            minutes = localt[4]
+            seconds = localt[5]
+        else:
+            hours, remainder = divmod(t, 3600)
+            minutes, seconds = divmod(remainder, 60)
+        result = (
+            f"{int(hours)}:{str(int(minutes)).zfill(2)}:{str(int(seconds)).zfill(2)}"
+        )
+        return result
 
-        if event_type in (
-            "leftdown",
-            "middledown",
-            "rightdown",
-            "wheeldown",
-            "wheelup",
-            "hover",
-        ):
-            self._down_start_time = time.time()
-            self._down_start_pos = window_pos
-            self.rebuild_hittable_chain()
-            self.find_hit_chain(window_pos)
-        for i, hit in enumerate(self.hit_chain):
-            if hit is None:
-                continue  # Element was dropped.
-            current_widget, current_matrix = hit
-            if current_widget is None:
-                continue
-            space_pos = window_pos
-            if current_matrix is not None and not current_matrix.is_identity():
-                space_cur = current_matrix.point_in_inverse_space(window_pos[0:2])
-                space_last = current_matrix.point_in_inverse_space(window_pos[2:4])
-                sdx = space_cur[0] - space_last[0]
-                sdy = space_cur[1] - space_last[1]
-                space_pos = (
-                    space_cur[0],
-                    space_cur[1],
-                    space_last[0],
-                    space_last[1],
-                    sdx,
-                    sdy,
-                )
+    @staticmethod
+    def datestr(t):
+        if t is None:
+            return ""
+        if isinstance(t, str):
+            return t
+        localt = time.localtime(t)
+        lyear = localt[0]
+        lmonth = int(localt[1])
+        lday = localt[2]
+        lhour = localt[3]
+        lminute = localt[4]
+        lsecond = localt[5]
+        # wx.DateTime has a bug: it does always provide the dateformat
+        # string with a month representation one number too high, so
+        # wx.DateTime(31,01,1999)
+        # Arbitrary but with different figures
+        # Alas this is the only simple method to get locale relevant dateformat...
+        wxdt = wx.DateTime(31, 7, 2022)
+        pattern = wxdt.FormatDate()
+        pattern = pattern.replace("2022", "{yy}")
+        pattern = pattern.replace("22", "{yy}")
+        pattern = pattern.replace("31", "{dd}")
+        # That would be the right thing, so if the bug is ever fixed, that will work
+        pattern = pattern.replace("07", "{mm}")
+        pattern = pattern.replace("7", "{mm}")
+        # And this is needed to deal with the bug...
+        pattern = pattern.replace("08", "{mm}")
+        pattern = pattern.replace("8", "{mm}")
+        result = pattern.format(
+            dd=str(lday).zfill(2), mm=str(lmonth).zfill(2), yy=str(lyear).zfill(2)
+        )
+        # Just to show the bug...
+        # result1 = f"{int(lday)}.{str(int(lmonth)).zfill(2)}.{str(int(lyear)).zfill(2)}"
+        # wxdt = wx.DateTime(lday, lmonth, lyear, lhour, lminute, lsecond)
+        # result2 = wxdt.FormatDate()
+        # print(f"res={result}, wxd={result2}, manual={result1}, pattern={pattern}")
+        return result
 
-            if (
-                i == 0
-                and event_type == "hover"
-                and previous_top_element is not current_widget
-            ):
-                if previous_top_element is not None:
-                    if self.log_events:
-                        self.log_events(f"Converted hover_end: {str(window_pos)}")
-                    previous_top_element.event(
-                        window_pos=window_pos,
-                        space_pos=space_pos,
-                        event_type="hover_end",
-                        nearest_snap=None,
-                        modifiers=modifiers,
-                        keycode=keycode,
-                    )
-                current_widget.event(
-                    window_pos=window_pos,
-                    space_pos=space_pos,
-                    event_type="hover_start",
-                    nearest_snap=None,
-                    modifiers=modifiers,
-                    keycode=keycode,
+    def refresh_history(self):
+        self.list_job_history.DeleteAllItems()
+        self.map_item_key.clear()
+        if self.filter_device:
+            if self.context.spool_ignore_helper_jobs:
+                events = self.context.logging.matching_events(
+                    "job", device=self.filter_device, important=True
                 )
-                if self.log_events:
-                    self.log_events(f"Converted hover_start: {str(window_pos)}")
-                previous_top_element = current_widget
-            if (
-                event_type == "leftup"
-                and time.time() - self._down_start_time <= 0.30
-                and abs(complex(*window_pos[:2]) - complex(*self._down_start_pos[:2]))
-                < 50
-            ):  # Anything within 0.3 seconds will be converted to a leftclick
-                response = current_widget.event(
-                    window_pos=window_pos,
-                    space_pos=space_pos,
-                    event_type="leftclick",
-                    nearest_snap=nearest_snap,
-                    modifiers=modifiers,
-                    keycode=keycode,
-                )
-                if self.log_events:
-                    self.log_events(f"Converted leftclick: {str(window_pos)}")
-            elif event_type == "leftup":
-                if self.log_events:
-                    self.log_events(
-                        f"Did not convert to click, {time.time() - self._down_start_time}"
-                    )
-                response = current_widget.event(
-                    window_pos=window_pos,
-                    space_pos=space_pos,
-                    event_type=event_type,
-                    nearest_snap=nearest_snap,
-                    modifiers=modifiers,
-                    keycode=keycode,
-                )
-                # print ("Leftup called for widget #%d" % i )
-                # print (response)
             else:
-                response = current_widget.event(
-                    window_pos=window_pos,
-                    space_pos=space_pos,
-                    event_type=event_type,
-                    nearest_snap=nearest_snap,
-                    modifiers=modifiers,
-                    keycode=keycode,
+                events = self.context.logging.matching_events(
+                    "job", device=self.filter_device
                 )
 
-            ##################
-            # PROCESS RESPONSE
-            ##################
-            if type(response) is tuple:
-                # print (f"Nearest snap provided")
-                # We get two additional parameters which are the screen location of the nearest snap point
-                params = response[1:]
-                response = response[0]
-                if len(params) > 1:
-                    new_x_space = params[0]
-                    new_y_space = params[1]
-                    new_x = window_pos[0]
-                    new_y = window_pos[1]
-                    snap_x = None
-                    snap_y = None
-
-                    sdx = new_x_space - space_pos[0]
-                    if current_matrix is not None and not current_matrix.is_identity():
-                        sdx *= current_matrix.value_scale_x()
-                    snap_x = window_pos[0] + sdx
-                    sdy = new_y_space - space_pos[1]
-                    if current_matrix is not None and not current_matrix.is_identity():
-                        sdy *= current_matrix.value_scale_y()
-                    # print("Shift x by %.1f pixel (%.1f), Shift y by %.1f pixel (%.1f)" % (sdx, odx, sdy, ody))
-                    snap_y = window_pos[1] + sdy
-
-                    dx = new_x - self.last_position[0]
-                    dy = new_y - self.last_position[1]
-                    if snap_x is None:
-                        nearest_snap = None
-                    else:
-                        # We are providing the space and screen coordinates
-                        snap_space = current_matrix.point_in_inverse_space(
-                            (snap_x, snap_y)
-                        )
-                        nearest_snap = (
-                            snap_space[0],
-                            snap_space[1],
-                            snap_x,
-                            snap_y,
-                        )
-                        self.last_snap = nearest_snap
+        else:
+            if self.context.spool_ignore_helper_jobs:
+                events = self.context.logging.matching_events("job", important=True)
             else:
-                params = None
+                events = self.context.logging.matching_events("job")
+        for idx, event_and_key in enumerate(reversed(list(events))):
+            key, info = event_and_key
+            list_id = self.list_job_history.InsertItem(
+                self.list_job_history.GetItemCount(), f"#{idx}"
+            )
+            self.map_item_key[list_id] = key
+            start_time = info.get("start_time", 0)
+            if start_time is None:
+                start_time = 0
+            duration = info.get("duration", 0)
+            if duration is None:
+                duration = 0
+            self.list_job_history.SetItem(list_id, HC_JOBNAME, str(info.get("label")))
+            self.list_job_history.SetItem(
+                list_id,
+                HC_START,
+                f"{self.datestr(start_time)} {self.timestr(start_time, True)}",
+            )
 
-            if response == RESPONSE_ABORT:
-                self.hit_chain.clear()
-                return
-            elif response == RESPONSE_CONSUME:
-                # if event_type in ("leftdown", "middledown", "middleup", "leftup", "move", "leftclick"):
-                #      widgetname = type(current_widget).__name__
-                #      print("Event %s was consumed by %s" % (event_type, widgetname))
-                return
-            elif response == RESPONSE_CHAIN:
-                continue
-            elif response == RESPONSE_DROP:
-                self.hit_chain[i] = None
-                continue
+            self.list_job_history.SetItem(
+                list_id,
+                HC_END,
+                self.timestr(start_time + duration, True),
+            )
+            self.list_job_history.SetItem(
+                list_id,
+                HC_RUNTIME,
+                self.timestr(duration, False),
+            )
+            nr_loop = info.get("loop")
+            nr_total = info.get("total")
+            if nr_total is None:
+                if nr_loop is None:
+                    passes_str = "n/a"
+                else:
+                    passes_str = f"{nr_loop}"
+            elif isinf(nr_total):
+                passes_str = f"{nr_loop}/"
             else:
-                break
+                passes_str = f"{nr_loop}/{nr_total}"
+            self.list_job_history.SetItem(
+                list_id,
+                HC_PASSES,
+                passes_str,
+            )
+            self.list_job_history.SetItem(list_id, HC_DEVICE, str(info.get("device")))
+            self.list_job_history.SetItem(
+                list_id, HC_STATUS, str(info.get("status", ""))
+            )
+            self.list_job_history.SetItem(
+                list_id, HC_JOBINFO, str(info.get("info", ""))
+            )
+            self.list_job_history.SetItem(
+                list_id,
+                HC_ESTIMATE,
+                self.timestr(info.get("estimate", 0), False),
+            )
+            self.list_job_history.SetItem(
+                list_id,
+                HC_STEPS,
+                f"{info.get('steps_done',0)}/{info.get('steps_total',0)}",
+            )
+            self.list_job_history.SetItemData(list_id, idx)
 
-    def cursor(self, cursor, always=False):
-        """
-        Routine to centralize and correct cursor info.
-        @param cursor: Changed cursor
-        @param always: Force cursor change
-        @return:
-        """
-        if cursor == "sizing":
-            new_cursor = wx.CURSOR_SIZING
-        elif cursor in ("size_nw", "size_se"):
-            new_cursor = wx.CURSOR_SIZENWSE
-        elif cursor in ("size_sw", "size_ne"):
-            new_cursor = wx.CURSOR_SIZENESW
-        elif cursor in ("size_n", "size_s", "skew_y"):
-            new_cursor = wx.CURSOR_SIZENS
-        elif cursor in ("size_e", "size_w", "skew_x"):
-            new_cursor = wx.CURSOR_SIZEWE
-        elif cursor == "arrow":
-            new_cursor = wx.CURSOR_ARROW
-        elif cursor == "cross":
-            new_cursor = wx.CROSS_CURSOR
-        elif cursor == "rotate1":
-            new_cursor = wx.CURSOR_CROSS
-        elif cursor == "rotate2":
-            new_cursor = wx.CURSOR_CROSS
-        elif cursor == "rotmove":
-            new_cursor = wx.CURSOR_HAND
-        elif cursor == "reference":
-            new_cursor = wx.CURSOR_BULLSEYE
-        elif cursor == "text":
-            new_cursor = wx.CURSOR_IBEAM
+    def before_history_update(self, event):
+        list_id = event.GetIndex()  # Get the current row
+        col_id = event.GetColumn()  # Get the current column
+        if col_id == HC_JOBINFO:
+            event.Allow()
         else:
-            new_cursor = wx.CURSOR_ARROW
-            self.log("Invalid cursor.")
-        if platform.system() == "Linux":
-            if cursor == "sizing":
-                new_cursor = wx.CURSOR_SIZENWSE
-            elif cursor in ("size_nw", "size_se"):
-                new_cursor = wx.CURSOR_SIZING
-            elif cursor in ("size_sw", "size_ne"):
-                new_cursor = wx.CURSOR_SIZING
-        if new_cursor != self._cursor or always:
-            self._cursor = new_cursor
-            self.gui.scene_panel.SetCursor(wx.Cursor(self._cursor))
-            self.log(f"Cursor changed to {cursor}")
-
-    def add_scenewidget(self, widget, properties=ORIENTATION_RELATIVE):
-        """
-        Delegate to the SceneSpaceWidget scene.
-        """
-        self.widget_root.scene_widget.add_widget(-1, widget, properties)
-
-    def add_interfacewidget(self, widget, properties=ORIENTATION_RELATIVE):
-        """
-        Delegate to the SceneSpaceWidget interface.
-        """
-        self.widget_root.interface_widget.add_widget(-1, widget, properties)
-
-    def validate_reference(self):
-        """
-        Check whether the reference is still valid
-        """
-        found = False
-        if self._reference:
-            for e in self.context.elements.flat(types=elem_nodes):
-                # Here we ignore the lock-status of an element
-                if e is self._reference:
-                    found = True
-                    break
-        if not found:
-            self._reference = None
-
-    @property
-    def reference_object(self):
-        return self._reference
-
-    @reference_object.setter
-    def reference_object(self, ref_object):
-        prev = self._reference
-        self._reference = ref_object
-        dlist = []
-        if prev is not None:
-            dlist.append(prev)
-        if self._reference is not None:
-            dlist.append(self._reference)
-        if len(dlist) > 0:
-            self.context.signal("element_property_update", dlist)
+            event.Veto()
+
+    def on_history_update(self, event):
+        list_id = event.GetIndex()  # Get the current row
+        col_id = event.GetColumn()  # Get the current column
+        new_data = event.GetLabel()  # Get the changed data
+        if list_id >= 0 and col_id == HC_JOBINFO:
+            idx = self.list_job_history.GetItemData(list_id)
+            key = self.map_item_key[idx]
+            self.context.logging.logs[key]["info"] = new_data
+
+            # Set the new data in the listctrl
+            self.list_job_history.SetItem(list_id, col_id, new_data)
+
+    def set_pause_color(self):
+        new_color = None
+        new_caption = _("Pause")
+        try:
+            if self.context.device.driver.paused:
+                new_color = wx.YELLOW
+                new_caption = _("Resume")
+        except AttributeError:
+            pass
+        self.button_pause.SetBackgroundColour(new_color)
+        self.button_pause.SetLabelText(new_caption)
+
+    @signal_listener("pause")
+    def on_device_pause_toggle(self, origin, *args):
+        self.set_pause_color()
+
+    @signal_listener("activate;device")
+    def on_activate_device(self, origin, device):
+        self.available_devices = self.context.kernel.services("device")
+        self.selected_device = self.context.device
+        index = -1
+        for i, s in enumerate(self.available_devices):
+            if s is self.selected_device:
+                index = i + 1
+                break
+        spools = [s.label for s in self.available_devices]
+        spools.insert(0, _("-- All available devices --"))
+        # This might not be relevant if you have a stable device set, but there might always be
+        # changes to add / rename devices etc.
+        if self.combo_device.GetSelection() == 0:
+            # all-devices is a superset of any device, so we can leave it...
+            index = 0
+        self.combo_device.Clear()
+        self.combo_device.SetItems(spools)
+        self.combo_device.SetSelection(index)
+        self.on_combo_device(None)
+        self.set_pause_color()
+
+    @signal_listener("spooler;completed")
+    def on_spooler_completed(self, origin, *args):
+        self.refresh_history()
+
+    @signal_listener("spooler;queue")
+    @signal_listener("spooler;idle")
+    @signal_listener("spooler;realtime")
+    def on_spooler_update(self, origin, value, *args, **kwargs):
+        self.update_spooler = True
+        self.refresh_spooler_list()
+
+    @signal_listener("driver;position")
+    @signal_listener("emulator;position")
+    def on_device_update(self, origin, pos):
+        # Only update every 2 seconds or so
+        dtime = time.time()
+        if dtime - self._last_invokation < 2:
+            return
+        # Two things (at least) could go wrong:
+        # 1) You are in the wrong queue, ie there's a job running in the background a
+        #    that provides an update but the user has changed the device so a different
+        #    queue is selected
+        # 2) As this is a signal it may come later, ie the job has already finished
+        #
+        # The checks here are rather basic and need to be revisited
+        refresh_needed = False
+        try:
+            listctrl = self.list_job_spool
+        except RuntimeError:
+            return
+        self._last_invokation = dtime
+        for list_id, entry in enumerate(self.queue_entries):
+            spooler = entry[0]
+            qindex = entry[1]
+            if qindex >= len(spooler.queue):
+                # This item is nowhere to be found
+                refresh_needed = True
+                continue
+            spool_obj = spooler.queue[qindex]
+            try:
+                t = spool_obj.elapsed_time()
+                hours, remainder = divmod(t, 3600)
+                minutes, seconds = divmod(remainder, 60)
+                runtime = f"{int(hours)}:{str(int(minutes)).zfill(2)}:{str(int(seconds)).zfill(2)}"
+                if list_id < self.list_job_spool.GetItemCount():
+                    self.list_job_spool.SetItem(list_id, JC_RUNTIME, runtime)
+            except (AttributeError, AssertionError):
+                if list_id < self.list_job_spool.GetItemCount():
+                    self.list_job_spool.SetItem(list_id, JC_RUNTIME, "-")
+                else:
+                    refresh_needed = True
+
+            try:
+                pass_str = f"{spool_obj.steps_done}/{spool_obj.steps_total}"
+                self.list_job_spool.SetItem(list_id, JC_STEPS, pass_str)
+            except AttributeError:
+                if list_id < self.list_job_spool.GetItemCount():
+                    self.list_job_spool.SetItem(list_id, JC_STEPS, "-")
+                else:
+                    refresh_needed = True
+            try:
+                loop = spool_obj.loops_executed
+                total = spool_obj.loops
+
+                if isinf(total):
+                    total = ""
+                pass_str = f"{loop}/{total}"
+                self.list_job_spool.SetItem(list_id, JC_PASSES, pass_str)
+            except AttributeError:
+                if list_id < self.list_job_spool.GetItemCount():
+                    self.list_job_spool.SetItem(list_id, JC_PASSES, "-")
+                else:
+                    refresh_needed = True
+
+            # Estimate Time
+            try:
+                t = spool_obj.estimate_time()
+                if isinf(t):
+                    runtime = ""
+                else:
+                    hours, remainder = divmod(t, 3600)
+                    minutes, seconds = divmod(remainder, 60)
+                    runtime = f"{int(hours)}:{str(int(minutes)).zfill(2)}:{str(int(seconds)).zfill(2)}"
+
+                if list_id < self.list_job_spool.GetItemCount():
+                    self.list_job_spool.SetItem(list_id, JC_ESTIMATE, runtime)
+            except (AttributeError, AssertionError):
+                if list_id < self.list_job_spool.GetItemCount():
+                    self.list_job_spool.SetItem(list_id, JC_ESTIMATE, "-")
+                else:
+                    refresh_needed = True
+        if refresh_needed:
+            self.refresh_spooler_list()
+            self.refresh_history()
+
+
+class JobSpooler(MWindow):
+    def __init__(self, *args, **kwds):
+        super().__init__(673, 456, *args, **kwds)
+        selected_device = None
+        if len(args) >= 4 and args[3]:
+            selected_device = args[3]
+        self.panel = SpoolerPanel(
+            self, wx.ID_ANY, context=self.context, selected_device=selected_device
+        )
+        self.add_module_delegate(self.panel)
+        _icon = wx.NullIcon
+        _icon.CopyFromBitmap(icons8_route_50.GetBitmap())
+        self.SetIcon(_icon)
+        self.SetTitle(_("Job Spooler"))
+        self.Layout()
+
+    @staticmethod
+    def sub_register(kernel):
+        kernel.register("wxpane/JobSpooler", register_panel_spooler)
+        kernel.register(
+            "button/control/Spooler",
+            {
+                "label": _("Spooler"),
+                "icon": icons8_route_50,
+                "tip": _("Opens Spooler Window"),
+                "action": lambda v: kernel.console("window toggle JobSpooler\n"),
+                "priority": -1,
+            },
+        )
+
+    def window_open(self):
+        self.panel.pane_show()
+
+    def window_close(self):
+        self.panel.pane_hide()
+
+    @staticmethod
+    def submenu():
+        return ("Burning", "Spooler")
```

#### encoding

```diff
@@ -1 +1 @@
-us-ascii
+utf-8
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/scene/sceneconst.py` & `meerk40t-0.8.3000/meerk40t/gui/scene/sceneconst.py`

 * *Files 4% similar despite different names*

```diff
@@ -4,18 +4,18 @@
 HITCHAIN_DELEGATE_AND_HIT = 3
 
 RESPONSE_CONSUME = 0
 RESPONSE_ABORT = 1
 RESPONSE_CHAIN = 2
 RESPONSE_DROP = 3
 
-ORIENTATION_MODE_MASK = 0b00001111110000
-ORIENTATION_DIM_MASK = 0b00000000001111
+ORIENTATION_MODE_MASK = 0b000011_11110000
+ORIENTATION_DIM_MASK = 0b000000_00001111
 ORIENTATION_MASK = ORIENTATION_MODE_MASK | ORIENTATION_DIM_MASK
-ORIENTATION_RELATIVE = 0b00000000000000
-ORIENTATION_ABSOLUTE = 0b00000000010000
-ORIENTATION_CENTERED = 0b00000000100000
-ORIENTATION_HORIZONTAL = 0b00000001000000
-ORIENTATION_VERTICAL = 0b00000010000000
-ORIENTATION_GRID = 0b00000100000000
-ORIENTATION_NO_BUFFER = 0b00001000000000
-BUFFER = 10.0
+ORIENTATION_RELATIVE = 0b000000_00000000
+ORIENTATION_ABSOLUTE = 0b000000_00010000
+ORIENTATION_CENTERED = 0b000000_00100000
+ORIENTATION_HORIZONTAL = 0b000000_01000000
+ORIENTATION_VERTICAL = 0b000000_10000000
+ORIENTATION_GRID = 0b000001_00000000
+ORIENTATION_NO_BUFFER = 0b000010_00000000
+BUFFER = 1000.0
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/scene/scenepanel.py` & `meerk40t-0.8.3000/meerk40t/gui/scene/scenepanel.py`

 * *Files 1% similar despite different names*

```diff
@@ -4,20 +4,20 @@
 
 
 class ScenePanel(wx.Panel):
     """
     wxPanel that holds the Scene. This serves as the wx.Control object that holds and draws the scene.
     """
 
-    def __init__(self, context, *args, scene_name="Scene", **kwds):
+    def __init__(self, context, parent, scene_name="Scene", **kwds):
         kwds["style"] = kwds.get("style", 0)
-        wx.Panel.__init__(self, *args, **kwds)
+        wx.Panel.__init__(self, parent, **kwds)
         #        self.scene_panel = wx.Panel(self, wx.ID_ANY)
         self.scene_panel = wx.Window(self, wx.ID_ANY)
-        self.scene = context.open_as("module/Scene", scene_name, self)
+        self.scene = context.open_as("module/Scene", scene_name, self, pane=parent)
         self.context = context
         self.scene_panel.SetDoubleBuffered(True)
 
         self._Buffer = None
 
         self.__set_properties()
         self.__do_layout()
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/scene/scenespacewidget.py` & `meerk40t-0.8.3000/meerk40t/gui/scene/scenespacewidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/scene/widget.py` & `meerk40t-0.8.3000/meerk40t/gui/scene/widget.py`

 * *Files 1% similar despite different names*

```diff
@@ -159,22 +159,24 @@
 
     def notify_moved_child(self, child):
         """
         Widget notify that calls scene notify.
         """
         self.scene.notify_moved_child(child)
 
-    def add_widget(self, index=-1, widget=None, properties=0):
+    def add_widget(self, index=-1, widget=None, properties=None):
         """
         Add a widget to the current widget.
 
         Adds at the particular index according to the properties.
 
         The properties can be used to trigger particular layouts or properties for the added widget.
         """
+        if properties is None:
+            properties = self.properties
         if len(self) == 0:
             last = self
         else:
             last = self[-1]
         if 0 <= index < len(self):
             self.insert(index, widget)
         else:
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/scenewidgets/attractionwidget.py` & `meerk40t-0.8.3000/meerk40t/gui/scenewidgets/attractionwidget.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 from math import sqrt
 
 import wx
 
-from meerk40t.core.element_types import elem_nodes
+from meerk40t.core.elements.element_types import elem_nodes
 from meerk40t.gui.scene.sceneconst import (
     HITCHAIN_DELEGATE,
     HITCHAIN_HIT,
     RESPONSE_CHAIN,
 )
 from meerk40t.gui.scene.widget import Widget
 
@@ -73,15 +73,15 @@
         if space_pos is None:
             return response
         self.my_x = space_pos[0]
         self.my_y = space_pos[1]
         if (
             event_type
             in ("leftdown", "leftup", "leftclick", "move", "hover", "hover_start")
-            and (self.scene.tool_active or self.scene.modif_active)
+            and (self.scene.pane.tool_active or self.scene.pane.modif_active)
             and "shift" not in modifiers
         ):
             self.calculate_display_points()
             self._show_snap_points = True
         else:
             self._show_snap_points = False
         if (
@@ -354,30 +354,30 @@
             self.context.snap_points
             and len(self.attraction_points) > 0
             and not self.my_x is None
         ):
             dummy = 0
             for pts in self.attraction_points:
                 doit = True  # Not sure why not :-)
-                if self.scene.modif_active:
+                if self.scene.pane.modif_active:
                     doit = not pts[3]  # not emphasized
                 if doit:
                     if (
                         abs(pts[0] - self.my_x) <= pixel
                         and abs(pts[1] - self.my_y) <= pixel
                     ):
                         self.display_points.append([pts[0], pts[1], pts[2]])
 
         if (
             self.context.snap_grid
-            and self.scene.grid_points is not None
-            and len(self.scene.grid_points) > 0
+            and self.scene.pane.grid.grid_points is not None
+            and len(self.scene.pane.grid.grid_points) > 0
             and not self.my_x is None
         ):
-            for pts in self.scene.grid_points:
+            for pts in self.scene.pane.grid.grid_points:
                 if (
                     abs(pts[0] - self.my_x) <= pixel
                     and abs(pts[1] - self.my_y) <= pixel
                 ):
                     self.display_points.append([pts[0], pts[1], TYPE_GRID])
 
         self.context.elements.set_end_time(
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/scenewidgets/bedwidget.py` & `meerk40t-0.8.3000/meerk40t/gui/scenewidgets/bedwidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/scenewidgets/elementswidget.py` & `meerk40t-0.8.3000/meerk40t/gui/scenewidgets/elementswidget.py`

 * *Files 2% similar despite different names*

```diff
@@ -59,16 +59,16 @@
         # gc.PopState()
 
     def event(
         self, window_pos=None, space_pos=None, event_type=None, modifiers=None, **kwargs
     ):
 
         if event_type == "rightdown" and not modifiers:
-            if not self.scene.tool_active:
-                if self.scene.active_tool != "none":
+            if not self.scene.pane.tool_active:
+                if self.scene.pane.active_tool != "none":
                     self.scene.context("tool none")
                     return RESPONSE_CONSUME
                 else:
                     self.scene.context.signal("scene_right_click")
                     return RESPONSE_CONSUME
         elif event_type == "rightdown":  # any modifier
             if self.scene.context.use_toolmenu:
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/scenewidgets/guidewidget.py` & `meerk40t-0.8.3000/meerk40t/gui/scenewidgets/guidewidget.py`

 * *Files 5% similar despite different names*

```diff
@@ -30,31 +30,31 @@
         self.scale_x2_upper = self.scale_x_upper
         self.scale_y2_lower = self.scale_y_lower
         self.scale_y2_upper = self.scale_y_upper
         self.scaled_conversion_x = 0
         self.scaled_conversion_y = 0
         self.units = None
         self.options = []
-        self.pen_guide1 = wx.Pen()
-        self.pen_guide2 = wx.Pen()
+        self.primary_guides_pen = wx.Pen()
+        self.secondary_guides_pen = wx.Pen()
         self.pen_magnets = wx.Pen()
         self.color_units = None
-        self.color_guide1 = None
-        self.color_guide2 = None
+        self.primary_guides_color = None
+        self.secondary_guides_color = None
         self.set_colors()
         self.font = wx.Font(
             10, wx.FONTFAMILY_SWISS, wx.FONTSTYLE_NORMAL, wx.FONTWEIGHT_BOLD
         )
 
     def set_colors(self):
         self.color_units = self.scene.colors.color_guide
-        self.color_guide1 = self.scene.colors.color_guide
-        self.color_guide2 = self.scene.colors.color_guide2
-        self.pen_guide1.SetColour(self.color_guide1)
-        self.pen_guide2.SetColour(self.color_guide2)
+        self.primary_guides_color = self.scene.colors.color_guide
+        self.secondary_guides_color = self.scene.colors.color_guide2
+        self.primary_guides_pen.SetColour(self.primary_guides_color)
+        self.secondary_guides_pen.SetColour(self.secondary_guides_color)
         self.pen_magnets.SetColour(self.scene.colors.color_magnetline)
         self.pen_magnets.SetWidth(2)
 
     def hit(self):
         return HITCHAIN_HIT
 
     def contains(self, x, y=None):
@@ -71,35 +71,35 @@
             or self.scale_y2_lower <= y <= self.scale_y2_upper
         ):
             value = True
         return value
 
     def set_auto_tick(self, value):
         if value == 0:
-            self.scene.auto_tick = True
+            self.scene.pane.grid.auto_tick = True
         else:
-            self.scene.auto_tick = False
-            self.scene.tick_distance = value
+            self.scene.pane.grid.auto_tick = False
+            self.scene.pane.grid.tick_distance = value
         self.scene._signal_widget(self.scene.widget_root, "grid")
         self.scene.request_refresh()
 
     def change_tick_event(self, idx):
         value = self.options[idx]
         self.set_auto_tick(value)
 
     def attract_event(self, value):
-        self.scene.magnet_attraction = value
+        self.scene.pane.magnet_attraction = value
 
     def affect_event(self, value):
         if value == 0:
-            self.scene.magnet_attract_x = not self.scene.magnet_attract_x
+            self.scene.pane.magnet_attract_x = not self.scene.pane.magnet_attract_x
         elif value == 1:
-            self.scene.magnet_attract_y = not self.scene.magnet_attract_y
+            self.scene.pane.magnet_attract_y = not self.scene.pane.magnet_attract_y
         elif value == 2:
-            self.scene.magnet_attract_c = not self.scene.magnet_attract_c
+            self.scene.pane.magnet_attract_c = not self.scene.pane.magnet_attract_c
 
     def toggle_circles(self):
         # toggle circular grid
         self.scene.context("scene grid circular\n")
 
     def toggle_rect(self):
         # toggle primary grid
@@ -108,16 +108,16 @@
     def toggle_secondary(self):
         # toggle secondary grid
         self.scene.context("scene grid secondary\n")
 
     def fill_magnets(self):
         # Let's set the full grid
         p = self.scene.context
-        if self.scene.draw_grid_primary:
-            tlen = float(Length(f"{self.scene.tick_distance}{p.units_name}"))
+        if self.scene.pane.grid.draw_grid_primary:
+            tlen = float(Length(f"{self.scene.pane.grid.tick_distance}{p.units_name}"))
             amount = (
                 round(
                     (p.device.unit_width / tlen) * (p.device.unit_height / tlen) / 1000,
                     0,
                 )
                 * 1000
             )
@@ -133,54 +133,54 @@
                 result = dlg.ShowModal()
                 dlg.Destroy()
                 if result == wx.ID_NO:
                     return
 
             x = 0
             while x <= p.device.unit_width:
-                self.scene.toggle_x_magnet(x)
+                self.scene.pane.toggle_x_magnet(x)
                 x += tlen
 
             y = 0
             while y <= p.device.unit_height:
-                self.scene.toggle_y_magnet(y)
+                self.scene.pane.toggle_y_magnet(y)
                 y += tlen
-        elif self.scene.draw_grid_secondary:
+        elif self.scene.pane.grid.draw_grid_secondary:
             # Placeholder for a use case, as you can define them manually...
             pass
 
     def _add_scale_options(self, menu):
         def on_user_option(event):
             dlg = wx.TextEntryDialog(
                 self.scene.context.gui,
                 message=_("Please provide the grid-size in {units}").format(
                     units=self.scene.context.units_name
                 ),
                 caption=_("User-defined grid-size"),
-                value=str(self.scene.tick_distance),
+                value=str(self.scene.pane.grid.tick_distance),
             )
             dlg.ShowModal()
             result = dlg.GetValue()
             dlg.Destroy()
             try:
                 value = float(result)
             except:
                 return
-            self.scene.tick_distance = value
-            self.scene.auto_tick = False
+            self.scene.pane.grid.tick_distance = value
+            self.scene.pane.grid.auto_tick = False
             self.scene._signal_widget(self.scene.widget_root, "grid")
             self.scene.request_refresh()
 
         def on_regular_option(option):
             def check(event):
                 self.set_auto_tick(option)
 
             return check
 
-        kind = wx.ITEM_CHECK if self.scene.auto_tick else wx.ITEM_NORMAL
+        kind = wx.ITEM_CHECK if self.scene.pane.grid.auto_tick else wx.ITEM_NORMAL
         item = menu.Append(wx.ID_ANY, _("Auto-Scale"), "", kind)
         if kind == wx.ITEM_CHECK:
             menu.Check(item.GetId(), True)
         self.scene.context.gui.Bind(
             wx.EVT_MENU,
             lambda e: self.set_auto_tick(0),
             id=item.GetId(),
@@ -195,15 +195,16 @@
             self.options = [0.1, 0.25, 0.5, 1]
         else:  # mils
             self.options = [10, 25, 50, 100, 250, 500, 1000]
 
         for option in self.options:
             kind = (
                 wx.ITEM_CHECK
-                if self.scene.tick_distance == option and not self.scene.auto_tick
+                if self.scene.pane.grid.tick_distance == option
+                and not self.scene.pane.grid.auto_tick
                 else wx.ITEM_NORMAL
             )
             item = menu.Append(
                 wx.ID_ANY,
                 f"{option:.2f}{units}",
                 "",
                 kind,
@@ -215,181 +216,201 @@
                 on_regular_option(option),
                 id=item.GetId(),
             )
 
         menu.AppendSeparator()
         item = menu.Append(
             wx.ID_ANY,
-            f"User defined value: {self.scene.tick_distance}{units}",
+            f"User defined value: {self.scene.pane.grid.tick_distance}{units}",
             "",
             wx.ITEM_NORMAL,
         )
         self.scene.context.gui.Bind(
             wx.EVT_MENU,
             on_user_option,
             id=item.GetId(),
         )
 
     def _add_attraction_strength_menu(self, menu):
         item = menu.Append(wx.ID_ANY, _("Attraction strength..."), "", wx.ITEM_NORMAL)
         menu.Enable(item.GetId(), False)
-        kind = wx.ITEM_CHECK if self.scene.magnet_attraction == 0 else wx.ITEM_NORMAL
+        kind = (
+            wx.ITEM_CHECK if self.scene.pane.magnet_attraction == 0 else wx.ITEM_NORMAL
+        )
         item = menu.Append(wx.ID_ANY, _("Off"), "", kind)
         if kind == wx.ITEM_CHECK:
             menu.Check(item.GetId(), True)
         self.scene.context.gui.Bind(
             wx.EVT_MENU,
             lambda e: self.attract_event(0),
             id=item.GetId(),
         )
-        kind = wx.ITEM_CHECK if self.scene.magnet_attraction == 1 else wx.ITEM_NORMAL
+        kind = (
+            wx.ITEM_CHECK if self.scene.pane.magnet_attraction == 1 else wx.ITEM_NORMAL
+        )
         item = menu.Append(wx.ID_ANY, _("Weak"), "", kind)
         if kind == wx.ITEM_CHECK:
             menu.Check(item.GetId(), True)
         self.scene.context.gui.Bind(
             wx.EVT_MENU,
             lambda e: self.attract_event(1),
             id=item.GetId(),
         )
-        kind = wx.ITEM_CHECK if self.scene.magnet_attraction == 2 else wx.ITEM_NORMAL
+        kind = (
+            wx.ITEM_CHECK if self.scene.pane.magnet_attraction == 2 else wx.ITEM_NORMAL
+        )
         item = menu.Append(wx.ID_ANY, _("Normal"), "", kind)
         if kind == wx.ITEM_CHECK:
             menu.Check(item.GetId(), True)
         self.scene.context.gui.Bind(
             wx.EVT_MENU,
             lambda e: self.attract_event(2),
             id=item.GetId(),
         )
-        kind = wx.ITEM_CHECK if self.scene.magnet_attraction == 3 else wx.ITEM_NORMAL
+        kind = (
+            wx.ITEM_CHECK if self.scene.pane.magnet_attraction == 3 else wx.ITEM_NORMAL
+        )
         item = menu.Append(wx.ID_ANY, _("Strong"), "", kind)
         if kind == wx.ITEM_CHECK:
             menu.Check(item.GetId(), True)
         self.scene.context.gui.Bind(
             wx.EVT_MENU,
             lambda e: self.attract_event(3),
             id=item.GetId(),
         )
-        kind = wx.ITEM_CHECK if self.scene.magnet_attraction == 4 else wx.ITEM_NORMAL
+        kind = (
+            wx.ITEM_CHECK if self.scene.pane.magnet_attraction == 4 else wx.ITEM_NORMAL
+        )
         item = menu.Append(wx.ID_ANY, _("Very Strong"), "", kind)
         if kind == wx.ITEM_CHECK:
             menu.Check(item.GetId(), True)
         self.scene.context.gui.Bind(
             wx.EVT_MENU,
             lambda e: self.attract_event(4),
             id=item.GetId(),
         )
-        kind = wx.ITEM_CHECK if self.scene.magnet_attraction == 5 else wx.ITEM_NORMAL
+        kind = (
+            wx.ITEM_CHECK if self.scene.pane.magnet_attraction == 5 else wx.ITEM_NORMAL
+        )
         item = menu.Append(wx.ID_ANY, _("Enormous"), "", kind)
         if kind == wx.ITEM_CHECK:
             menu.Check(item.GetId(), True)
         self.scene.context.gui.Bind(
             wx.EVT_MENU,
             lambda e: self.attract_event(5),
             id=item.GetId(),
         )
 
     def _add_attraction_options_menu(self, menu):
         item = menu.Append(wx.ID_ANY, _("Attraction areas..."), "", wx.ITEM_NORMAL)
         menu.Enable(item.GetId(), False)
-        kind = wx.ITEM_CHECK if self.scene.magnet_attract_x else wx.ITEM_NORMAL
+        kind = wx.ITEM_CHECK if self.scene.pane.magnet_attract_x else wx.ITEM_NORMAL
         item = menu.Append(wx.ID_ANY, _("Left/Right Side"), "", kind)
         if kind == wx.ITEM_CHECK:
             menu.Check(item.GetId(), True)
         self.scene.context.gui.Bind(
             wx.EVT_MENU,
             lambda e: self.affect_event(0),
             id=item.GetId(),
         )
-        kind = wx.ITEM_CHECK if self.scene.magnet_attract_y else wx.ITEM_NORMAL
+        kind = wx.ITEM_CHECK if self.scene.pane.magnet_attract_y else wx.ITEM_NORMAL
         item = menu.Append(wx.ID_ANY, _("Top/Bottom Side"), "", kind)
         if kind == wx.ITEM_CHECK:
             menu.Check(item.GetId(), True)
         self.scene.context.gui.Bind(
             wx.EVT_MENU,
             lambda e: self.affect_event(1),
             id=item.GetId(),
         )
-        kind = wx.ITEM_CHECK if self.scene.magnet_attract_c else wx.ITEM_NORMAL
+        kind = wx.ITEM_CHECK if self.scene.pane.magnet_attract_c else wx.ITEM_NORMAL
         item = menu.Append(wx.ID_ANY, _("Center"), "", kind)
         if kind == wx.ITEM_CHECK:
             menu.Check(item.GetId(), True)
         self.scene.context.gui.Bind(
             wx.EVT_MENU,
             lambda e: self.affect_event(2),
             id=item.GetId(),
         )
 
     def _add_grid_draw_options(self, menu):
         menu.AppendSeparator()
-        kind = wx.ITEM_CHECK if self.scene.draw_grid_primary else wx.ITEM_NORMAL
+        kind = (
+            wx.ITEM_CHECK if self.scene.pane.grid.draw_grid_primary else wx.ITEM_NORMAL
+        )
         item = menu.Append(wx.ID_ANY, _("Draw primary grid"), "", kind)
         if kind == wx.ITEM_CHECK:
             menu.Check(item.GetId(), True)
         self.scene.context.gui.Bind(
             wx.EVT_MENU,
             lambda e: self.toggle_rect(),
             id=item.GetId(),
         )
-        kind = wx.ITEM_CHECK if self.scene.draw_grid_secondary else wx.ITEM_NORMAL
+        kind = (
+            wx.ITEM_CHECK
+            if self.scene.pane.grid.draw_grid_secondary
+            else wx.ITEM_NORMAL
+        )
         item = menu.Append(wx.ID_ANY, _("Draw secondary grid"), "", kind)
         if kind == wx.ITEM_CHECK:
             menu.Check(item.GetId(), True)
         self.scene.context.gui.Bind(
             wx.EVT_MENU,
             lambda e: self.toggle_secondary(),
             id=item.GetId(),
         )
         # DISABLE, AS NOT YET READY
         # menu.Enable(item.GetId(), False)
 
-        kind = wx.ITEM_CHECK if self.scene.draw_grid_circular else wx.ITEM_NORMAL
+        kind = (
+            wx.ITEM_CHECK if self.scene.pane.grid.draw_grid_circular else wx.ITEM_NORMAL
+        )
         item = menu.Append(wx.ID_ANY, _("Draw circular grid"), "", kind)
         if kind == wx.ITEM_CHECK:
             menu.Check(item.GetId(), True)
         self.scene.context.gui.Bind(
             wx.EVT_MENU,
             lambda e: self.toggle_circles(),
             id=item.GetId(),
         )
 
     def _process_doubleclick(self, window_pos=None, space_pos=None):
         # Primary Guide
         secondary = False
         is_y = self.scale_x_lower <= space_pos[0] <= self.scale_x_upper
         if not is_y:
-            if self.scene.draw_grid_secondary:
+            if self.scene.pane.grid.draw_grid_secondary:
                 is_y = self.scale_x2_lower <= space_pos[0] <= self.scale_x2_upper
                 secondary = True
         is_x = self.scale_y_lower <= space_pos[1] <= self.scale_y_upper
         if not is_x:
-            if self.scene.draw_grid_secondary:
+            if self.scene.pane.grid.draw_grid_secondary:
                 is_x = self.scale_y2_lower <= space_pos[1] <= self.scale_y2_upper
                 secondary = True
         # print ("is_x=%s, is_y=%s, secondary=%s" % (is_x, is_y, secondary))
         if not (is_x or is_y):
             return
 
         value = 0
         p = self.scene.context
         if self.scaled_conversion_x == 0:
             return
         p = self.scene.context
         sx = 0
         sy = 0
-        tick_distance_x = self.scene.tick_distance
-        tick_distance_y = self.scene.tick_distance
+        tick_distance_x = self.scene.pane.grid.tick_distance
+        tick_distance_y = self.scene.pane.grid.tick_distance
         if secondary:
-            if self.scene.grid_secondary_cx is not None:
-                sx = self.scene.grid_secondary_cx
-            if self.scene.grid_secondary_cy is not None:
-                sy = self.scene.grid_secondary_cy
-            if self.scene.grid_secondary_scale_x is not None:
-                tick_distance_x *= self.scene.grid_secondary_scale_x
-            if self.scene.grid_secondary_scale_y is not None:
-                tick_distance_y *= self.scene.grid_secondary_scale_y
+            if self.scene.pane.grid.grid_secondary_cx is not None:
+                sx = self.scene.pane.grid.grid_secondary_cx
+            if self.scene.pane.grid.grid_secondary_cy is not None:
+                sy = self.scene.pane.grid.grid_secondary_cy
+            if self.scene.pane.grid.grid_secondary_scale_x is not None:
+                tick_distance_x *= self.scene.pane.grid.grid_secondary_scale_x
+            if self.scene.pane.grid.grid_secondary_scale_y is not None:
+                tick_distance_y *= self.scene.pane.grid.grid_secondary_scale_y
         ox, oy = self.scene.convert_scene_to_window([sx, sy])
 
         # print(
         #    "Device-origin=%.1f, %.1f \n ox, oy=%.1f, %.1f"
         #    % (p.device.origin_x, p.device.origin_y, ox, oy)
         # )
         mark_point_x = (window_pos[0] - ox) / self.scaled_conversion_x
@@ -409,26 +430,26 @@
         mark_point_x = (
             round(2.0 * mark_point_x / tick_distance_x) * 0.5 * tick_distance_x
         )
         mark_point_y = (
             round(2.0 * mark_point_y / tick_distance_y) * 0.5 * tick_distance_y
         )
         if is_x and is_y:
-            if self.scene.has_magnets():
-                self.scene.clear_magnets()
+            if self.scene.pane.has_magnets():
+                self.scene.pane.clear_magnets()
             else:
                 self.fill_magnets()
         elif is_x:
             # Get the X coordinate from space_pos [0]
             value = float(Length(f"{mark_point_x:.1f}{self.units}"))
-            self.scene.toggle_x_magnet(value)
+            self.scene.pane.toggle_x_magnet(value)
         elif is_y:
             # Get the Y coordinate from space_pos [1]
             value = float(Length(f"{mark_point_y:.1f}{self.units}"))
-            self.scene.toggle_y_magnet(value)
+            self.scene.pane.toggle_y_magnet(value)
 
         self.scene.request_refresh()
 
     def event(self, window_pos=None, space_pos=None, event_type=None, **kwargs):
         """
         Capture and deal with the double click event.
         Double-click in the grid loads a menu to remove the background.
@@ -436,19 +457,19 @@
 
         if event_type == "hover":
             return RESPONSE_CHAIN
         elif event_type == "rightdown":
             menu = wx.Menu()
             self._add_scale_options(menu)
             menu.AppendSeparator()
-            if self.scene.has_magnets():
+            if self.scene.pane.has_magnets():
                 item = menu.Append(wx.ID_ANY, _("Clear all magnets"), "")
                 self.scene.context.gui.Bind(
                     wx.EVT_MENU,
-                    lambda e: self.scene.clear_magnets(),
+                    lambda e: self.scene.pane.clear_magnets(),
                     id=item.GetId(),
                 )
                 menu.AppendSeparator()
                 self._add_attraction_strength_menu(menu)
                 menu.AppendSeparator()
                 self._add_attraction_options_menu(menu)
 
@@ -483,19 +504,19 @@
     def _get_center_secondary(self):
         """
         Calculate center position for secondary grid
         """
         p = self.scene.context
         x = p.device.unit_width * p.device.show_origin_x
         y = p.device.unit_height * p.device.show_origin_y
-        if self.scene.grid_secondary_cx is not None:
-            x = self.scene.grid_secondary_cx
+        if self.scene.pane.grid.grid_secondary_cx is not None:
+            x = self.scene.pane.grid.grid_secondary_cx
 
-        if self.scene.grid_secondary_cy is not None:
-            y = self.scene.grid_secondary_cy
+        if self.scene.pane.grid.grid_secondary_cy is not None:
+            y = self.scene.pane.grid.grid_secondary_cy
 
         return self.scene.convert_scene_to_window([x, y])
 
     def _set_scaled_conversion(self):
         p = self.scene.context
         f = p.device.length(f"1{p.units_name}", as_float=True)
         m = self.scene.widget_root.scene_widget.matrix
@@ -504,22 +525,22 @@
 
     def _draw_primary_guides(self, gc):
         w, h = gc.Size
         p = self.scene.context
         sx_primary, sy_primary = self._get_center_primary()
         length = self.line_length
         edge_gap = self.edge_gap
-        gc.SetPen(self.pen_guide1)
-        gc.SetFont(self.font, self.color_guide1)
+        gc.SetPen(self.primary_guides_pen)
+        gc.SetFont(self.font, self.primary_guides_color)
 
-        (t_width, t_height) = gc.GetTextExtent("0")
+        text_width, text_height = gc.GetTextExtent("0")
 
         starts = []
         ends = []
-        points_x_primary = self.scene.tick_distance * self.scaled_conversion_x
+        points_x_primary = self.scene.pane.grid.tick_distance * self.scaled_conversion_x
         offset_x_primary = float(sx_primary) % points_x_primary
         x = offset_x_primary
         last_text_pos = x - 30  # Arbitrary
         while x < w:
             if x >= 45:
                 mark_point = (x - sx_primary) / self.scaled_conversion_x
                 if p.device.show_flip_x:
@@ -528,87 +549,87 @@
                     mark_point = 0.0  # prevents -0
                 starts.append((x, edge_gap))
                 ends.append((x, length + edge_gap))
 
                 starts.append((x, h - edge_gap))
                 ends.append((x, h - length - edge_gap))
                 # Show half distance as well if there's enough room
-                if t_height < 0.5 * points_x_primary:
+                if text_height < 0.5 * points_x_primary:
                     starts.append((x - 0.5 * points_x_primary, edge_gap))
                     ends.append((x - 0.5 * points_x_primary, 0.25 * length + edge_gap))
 
-                if not self.scene.draw_grid_secondary:
+                if not self.scene.pane.grid.draw_grid_secondary:
                     starts.append((x, h - edge_gap))
                     ends.append((x, h - length - edge_gap))
                     starts.append((x - 0.5 * points_x_primary, h - edge_gap))
                     ends.append(
                         (x - 0.5 * points_x_primary, h - 0.25 * length - edge_gap)
                     )
-                if (x - last_text_pos) >= t_height * 1.25:
+                if (x - last_text_pos) >= text_height * 1.25:
                     gc.DrawText(f"{mark_point:g}", x, edge_gap, -math.tau / 4)
                     last_text_pos = x
             x += points_x_primary
 
-        points_y_primary = self.scene.tick_distance * self.scaled_conversion_y
+        points_y_primary = self.scene.pane.grid.tick_distance * self.scaled_conversion_y
         offset_y_primary = float(sy_primary) % points_y_primary
         y = offset_y_primary
         last_text_pos = y - 30  # arbitrary
         while y < h:
             if y >= 20:
                 mark_point = (y - sy_primary) / self.scaled_conversion_y
                 if p.device.show_flip_y:
                     mark_point *= -1
                 if round(float(mark_point) * 1000) == 0:
                     mark_point = 0.0  # prevents -0
                 starts.append((edge_gap, y))
                 ends.append((length + edge_gap, y))
                 # if there is enough room for a mid-distance stroke...
-                if t_height < 0.5 * points_y_primary:
+                if text_height < 0.5 * points_y_primary:
                     starts.append((edge_gap, y - 0.5 * points_y_primary))
                     ends.append((0.25 * length + edge_gap, y - 0.5 * points_y_primary))
 
-                if not self.scene.draw_grid_secondary:
+                if not self.scene.pane.grid.draw_grid_secondary:
                     starts.append((w - edge_gap, y))
                     ends.append((w - length - edge_gap, y))
                     starts.append((w - edge_gap, y - 0.5 * points_y_primary))
                     ends.append(
                         (w - 0.25 * length - edge_gap, y - 0.5 * points_y_primary)
                     )
 
-                if (y - last_text_pos) >= t_height * 1.25:
+                if (y - last_text_pos) >= text_height * 1.25:
                     # Adding zero makes -0 into positive 0
                     gc.DrawText(f"{mark_point + 0:g}", edge_gap, y + 0)
                     last_text_pos = y
             y += points_y_primary
         if len(starts) > 0:
             gc.StrokeLineSegments(starts, ends)
 
     def _draw_secondary_guides(self, gc):
         w, h = gc.Size
         p = self.scene.context
 
         fx = 1.0
-        if self.scene.grid_secondary_scale_x is not None:
-            fx = self.scene.grid_secondary_scale_x
-        points_x = fx * self.scene.tick_distance * self.scaled_conversion_x
+        if self.scene.pane.grid.grid_secondary_scale_x is not None:
+            fx = self.scene.pane.grid.grid_secondary_scale_x
+        points_x = fx * self.scene.pane.grid.tick_distance * self.scaled_conversion_x
 
         fy = 1.0
-        if self.scene.grid_secondary_scale_y is not None:
-            fy = self.scene.grid_secondary_scale_y
-        points_y = fy * self.scene.tick_distance * self.scaled_conversion_y
+        if self.scene.pane.grid.grid_secondary_scale_y is not None:
+            fy = self.scene.pane.grid.grid_secondary_scale_y
+        points_y = fy * self.scene.pane.grid.tick_distance * self.scaled_conversion_y
         self.units = p.units_name
 
         sx, sy = self._get_center_secondary()
 
         length = self.line_length
         edge_gap = self.edge_gap
 
-        gc.SetPen(self.pen_guide2)
-        gc.SetFont(self.font, self.color_guide2)
-        (t_width, t_height) = gc.GetTextExtent("0")
+        gc.SetPen(self.secondary_guides_pen)
+        gc.SetFont(self.font, self.secondary_guides_color)
+        t_width, t_height = gc.GetTextExtent("0")
 
         starts = []
         ends = []
         offset_x = float(sx) % points_x
         x = offset_x
         last_text_pos = x - 30
         while x < w:
@@ -674,20 +695,20 @@
         w, h = gc.Size
         length = self.line_length
         edge_gap = self.edge_gap
 
         starts_hi = []
         ends_hi = []
 
-        for x in self.scene.magnet_x:
+        for x in self.scene.pane.magnet_x:
             sx, sy = self.scene.convert_scene_to_window([x, 0])
             starts_hi.append((sx, length + edge_gap))
             ends_hi.append((sx, h - length - edge_gap))
 
-        for y in self.scene.magnet_y:
+        for y in self.scene.pane.magnet_y:
             sx, sy = self.scene.convert_scene_to_window([0, y])
             starts_hi.append((length + edge_gap, sy))
             ends_hi.append((w - length - edge_gap, sy))
 
         gc.SetPen(self.pen_magnets)
         if starts_hi and ends_hi:
             gc.StrokeLineSegments(starts_hi, ends_hi)
@@ -706,23 +727,23 @@
         self.scale_x2_lower = w - self.edge_gap - self.line_length
         self.scale_x2_upper = w
         self.scale_y2_lower = h - self.edge_gap - self.line_length
         self.scale_y2_upper = h
         if self.scene.context.draw_mode & DRAW_MODE_GUIDES != 0:
             return
         self._set_scaled_conversion()
-        if self.scaled_conversion_x == 0 or self.scene.tick_distance == 0:
+        if self.scaled_conversion_x == 0 or self.scene.pane.grid.tick_distance == 0:
             # Cannot be drawn.
             return
 
         self._draw_units(gc)
 
         self._draw_primary_guides(gc)
 
-        if self.scene.draw_grid_secondary:
+        if self.scene.pane.grid.draw_grid_secondary:
             self._draw_secondary_guides(gc)
         self._draw_magnet_lines(gc)
 
     def signal(self, signal, *args, **kwargs):
         """
         Process guide signal to delete the current guidelines and force them to be recalculated.
         """
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/scenewidgets/laserpathwidget.py` & `meerk40t-0.8.3000/meerk40t/gui/scenewidgets/laserpathwidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/scenewidgets/machineoriginwidget.py` & `meerk40t-0.8.3000/meerk40t/gui/scenewidgets/machineoriginwidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/scenewidgets/rectselectwidget.py` & `meerk40t-0.8.3000/meerk40t/gui/scenewidgets/rectselectwidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/scenewidgets/relocatewidget.py` & `meerk40t-0.8.3000/meerk40t/gui/scenewidgets/relocatewidget.py`

 * *Files 17% similar despite different names*

```diff
@@ -1,7 +1,14 @@
+"""
+Relocate widget adds a widget relocation widget. Moving the widget will cause the direct parent of this widget to
+move. The expectation is that the parent type of this widget will DELEGATE or DELEGATE and HIT.
+
+This is usually used for a group of widgets which should be moved together.
+"""
+
 import wx
 
 from meerk40t.gui import icons
 from meerk40t.gui.scene.sceneconst import HITCHAIN_HIT, RESPONSE_CONSUME
 from meerk40t.gui.scene.widget import Widget
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/scenewidgets/reticlewidget.py` & `meerk40t-0.8.3000/meerk40t/gui/scenewidgets/reticlewidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/scenewidgets/selectionwidget.py` & `meerk40t-0.8.3000/meerk40t/gui/scenewidgets/selectionwidget.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 import math
 
 import wx
 
-from meerk40t.core.element_types import *
+from meerk40t.core.elements.element_types import *
 from meerk40t.core.units import Length
 from meerk40t.gui.laserrender import DRAW_MODE_SELECTION
 from meerk40t.gui.scene.scene import (
     HITCHAIN_DELEGATE,
     HITCHAIN_HIT,
     RESPONSE_CHAIN,
     RESPONSE_CONSUME,
@@ -38,15 +38,15 @@
     except TypeError:
         # Widget already destroyed ?!
         return RESPONSE_CHAIN
     # if event_type in ("move", "leftdown", "leftup"):
     #     print(f"Event for {widget_identifier}: {event_type}, {nearest_snap}")
 
     # Not during an edit !
-    if widget.scene.active_tool.startswith("edit"):
+    if widget.scene.pane.active_tool.startswith("edit"):
         return RESPONSE_CHAIN
 
     # Now all Mouse-Hover-Events
     _ = widget.scene.context._
     if event_type == "hover" and widget.hovering and not inside:
         widget.hovering = False
         widget.scene.cursor("arrow")
@@ -70,16 +70,16 @@
         widget.scene.context.signal("statusmsg", _(helptext))
         return RESPONSE_CONSUME
 
     # Now all Mouse-Click-Events
     elements = widget.scene.context.elements
     dx = space_pos[4]
     dy = space_pos[5]
-    # print (f"Event={event_type}, tool={widget.scene.tool_active}, modif={widget.scene.modif_active}, snap={nearest_snap}")
-    if widget.scene.tool_active:
+    # print (f"Event={event_type}, tool={widget.scene.tool_active}, modif={widget.scene.pane.modif_active}, snap={nearest_snap}")
+    if widget.scene.pane.tool_active:
         # print ("ignore")
         return RESPONSE_CHAIN
 
     if event_type == "leftdown":
         # We want to establish that we don't have a singular Shift key or a singular ctrl-key
         # as these will extend / reduce the selection
         if widget_identifier == "move" or (
@@ -439,15 +439,15 @@
             for e in images:
                 e.update(None)
             self.master.last_angle = None
             self.master.start_angle = None
             self.master.rotated_angle = 0
             self.scene.context.signal("tool_modified")
         elif event == -1:
-            self.scene.modif_active = True
+            self.scene.pane.modif_active = True
             # Normally this would happen automagically in the background, but as we are going
             # to suppress undo during the execution of this tool (to allow to go back to the
             # very starting point) we need to set the recovery point ourselves.
             elements.prepare_undo()
             return
         elif event == 0:
 
@@ -693,15 +693,15 @@
         gc.SetBrush(brush)
         gc.DrawRectangle(self.left, self.top, self.width, self.height)
 
     def tool(self, position, nearest_snap, dx, dy, event=0, modifiers=None):
         elements = self.scene.context.elements
         if nearest_snap is None:
             # print ("Took last snap instead...")
-            nearest_snap = self.scene.last_snap
+            nearest_snap = self.scene.pane.last_snap
         if nearest_snap is not None:
             # Position is space_pos:
             # 0, 1: current x, y
             # 2, 3: last pos x, y
             # 4, 5: current - last
             position = list(position)
             position[0] = nearest_snap[0]
@@ -719,18 +719,18 @@
                 #     e.modified()
                 # except AttributeError:
                 #     pass
                 if hasattr(e, "update"):
                     images.append(e)
             for e in images:
                 e.update(None)
-            self.scene.modif_active = False
+            self.scene.pane.modif_active = False
             self.scene.context.signal("tool_modified")
         elif event == -1:
-            self.scene.modif_active = True
+            self.scene.pane.modif_active = True
             # Normally this would happen automagically in the background, but as we are going
             # to suppress undo during the execution of this tool (to allow to go back to the
             # very starting point) we need to set the recovery point ourselves.
             elements.prepare_undo()
             return
         elif event == 0:
             # Establish origin
@@ -773,14 +773,16 @@
                 scale = (scaley + scalex) / 2.0
                 scalex = scale
                 scaley = scale
             if abs(scalex) < NEARLY_ZERO or abs(scaley) <= NEARLY_ZERO:
                 return
 
             b = elements._emphasized_bounds
+            if b is None:
+                return
             if "n" in self.method:
                 orgy = self.master.bottom
             else:
                 orgy = self.master.top
 
             if "w" in self.method:
                 orgx = self.master.right
@@ -931,15 +933,15 @@
         gc.SetBrush(brush)
         gc.DrawRectangle(self.left, self.top, self.width, self.height)
 
     def tool(self, position, nearest_snap, dx, dy, event=0, modifiers=None):
         elements = self.scene.context.elements
         if nearest_snap is None:
             # print ("Took last snap instead...")
-            nearest_snap = self.scene.last_snap
+            nearest_snap = self.scene.pane.last_snap
         if nearest_snap is not None:
             # Position is space_pos:
             # 0, 1: current x, y
             # 2, 3: last pos x, y
             # 4, 5: current - last
             position = list(position)
             # print(
@@ -966,18 +968,18 @@
                 #     e.modified()
                 # except AttributeError:
                 #     pass
                 if hasattr(e, "update"):
                     images.append(e)
             for e in images:
                 e.update(None)
-            self.scene.modif_active = False
+            self.scene.pane.modif_active = False
             self.scene.context.signal("tool_modified")
         elif event == -1:
-            self.scene.modif_active = True
+            self.scene.pane.modif_active = True
             # Normally this would happen automagically in the background, but as we are going
             # to suppress undo during the execution of this tool (to allow to go back to the
             # very starting point) we need to set the recovery point ourselves.
             elements.prepare_undo()
             return
         elif event == 0:
             # Establish origin
@@ -1197,15 +1199,15 @@
                     pass
                 if hasattr(e, "update"):
                     images.append(e)
             for e in images:
                 e.update(None)
             self.scene.context.signal("tool_modified")
         elif event == -1:
-            self.scene.modif_active = True
+            self.scene.pane.modif_active = True
             # Normally this would happen automagically in the background, but as we are going
             # to suppress undo during the execution of this tool (to allow to go back to the
             # very starting point) we need to set the recovery point ourselves.
             elements.prepare_undo()
             return
         elif event == 0:  # move
             if self.is_x:
@@ -1368,15 +1370,15 @@
             to_be_copied.append([e, org_parent, new_parent])
 
         for entry in to_be_copied:
             e = entry[0]
             oldparent = entry[1]
             newparent = entry[2]
             if newparent is None:
-              # Add a new group...
+                # Add a new group...
                 if oldparent.label is None:
                     newlabel = "Copy"
                 else:
                     newlabel = f"Copy of {oldparent.label}"
                 if oldparent.id is None:
                     newid = "Copy"
                 else:
@@ -1451,16 +1453,18 @@
 
     def check_for_magnets(self):
         if (
             not self.master.key_shift_pressed
         ):  # if Shift-Key pressed then ignore Magnets...
             elements = self.scene.context.elements
             b = elements._emphasized_bounds
+            if b is None:
+                return
             allowlockmove = elements.lock_allows_move
-            dx, dy = self.scene.revised_magnet_bound(b)
+            dx, dy = self.scene.pane.revised_magnet_bound(b)
             self.total_dx += dx
             self.total_dy += dy
             if dx != 0 or dy != 0:
                 with elements.undofree():
                     for e in elements.flat(types=elem_nodes, emphasized=True):
                         if hasattr(e, "lock") and e.lock and not allowlockmove:
                             continue
@@ -1501,15 +1505,15 @@
             elements.update_bounds([b[0] + dx, b[1] + dy, b[2] + dx, b[3] + dy])
 
         elements = self.scene.context.elements
         lastdx = 0
         lastdy = 0
         if nearest_snap is None:
             # print ("Took last snap instead...")
-            nearest_snap = self.scene.last_snap
+            nearest_snap = self.scene.pane.last_snap
         # sweeping it under the rug for now until we have figured out a way
         # to move a defined reference and not an arbitrary point on the
         # Widget area.
         # nearest_snap = None
         if nearest_snap is not None and event != -1:
             # Position is space_pos:
             # 0, 1: current x, y
@@ -1552,19 +1556,19 @@
             #             e.translated(self.total_dx, self.total_dy)
             #         except AttributeError:
             #             pass
             #     # .translated will set the scene emphasized bounds dirty, that's not needed, so...
             #     elements.update_bounds([bx0, by0, bx1, by1])
 
             self.scene.context.signal("tool_modified")
-            self.scene.modif_active = False
+            self.scene.pane.modif_active = False
         elif event == -1:  # start
             if "alt" in modifiers:
                 self.create_duplicate()
-            self.scene.modif_active = True
+            self.scene.pane.modif_active = True
             # Normally this would happen automagically in the background, but as we are going
             # to suppress undo during the execution of this tool (to allow to go back to the
             # very starting point) we need to set the recovery point ourselves.
             elements.prepare_undo()
             self.total_dx = 0
             self.total_dy = 0
         elif event == 0:  # move
@@ -1656,15 +1660,15 @@
         """
         Change the rotation-center of the selected elements.
         """
         lastdx = 0
         lastdy = 0
         if nearest_snap is None:
             # print ("Took last snap instead...")
-            nearest_snap = self.scene.last_snap
+            nearest_snap = self.scene.pane.last_snap
         elements = self.scene.context.elements
         if nearest_snap is not None:
             # Position is space_pos:
             # 0, 1: current x, y
             # 2, 3: last pos x, y
             # 4, 5: current - last
             position = list(position)
@@ -1675,17 +1679,17 @@
             position[4] = position[0] - position[2]
             position[5] = position[1] - position[3]
 
         if event == 1:  # end
             self.master.rotation_cx += lastdx - self.master.offset_x
             self.master.rotation_cy += lastdy - self.master.offset_y
             self.master.invalidate_rot_center()
-            self.scene.modif_active = False
+            self.scene.pane.modif_active = False
         elif event == -1:  # start
-            self.scene.modif_active = True
+            self.scene.pane.modif_active = True
             return
         elif event == 0:  # move
             self.master.rotation_cx += dx
             self.master.rotation_cy += dy
             self.master.invalidate_rot_center()
         self.scene.request_refresh()
 
@@ -1823,20 +1827,20 @@
         """
         elements = self.scene.context.elements
         if event == -1:  # leftdown
             # Nothing to do...
             return
         elif event == 1:  # leftup, leftclick
             if self.is_reference_object:
-                self.scene.reference_object = None
+                self.scene.pane.reference_object = None
             else:
                 for e in elements.flat(types=elem_nodes, emphasized=True):
                     try:
                         # First object
-                        self.scene.reference_object = e
+                        self.scene.pane.reference_object = e
                         break
                     except AttributeError:
                         pass
             self.scene.context.signal("reference")
         self.scene.request_refresh()
 
     def event(
@@ -2251,15 +2255,15 @@
             # print ("Hit and delegate")
             return HITCHAIN_HIT_AND_DELEGATE
         else:
             self.reset_variables()
             return HITCHAIN_DELEGATE
 
     def move_selection_to_ref(self, pos="c"):
-        refob = self.scene.reference_object
+        refob = self.scene.pane.reference_object
 
         elements = self.scene.context.elements
         if refob is None:
             return
         alignbounds = refob.bounds
         posx = ""
         posy = ""
@@ -2283,15 +2287,15 @@
         elements.align_elements(data, alignbounds, posx, posy, False)
         for q in data:
             q.invalidated_node()
 
     def rotate_elements_if_needed(self, doit):
         if not doit:
             return
-        refob = self.scene.reference_object
+        refob = self.scene.pane.reference_object
         if refob is None:
             return
         bb = refob.bounds
         elements = self.scene.context.elements
         cc = elements.selected_area()
 
         ratio_ref = (bb[3] - bb[1]) > (bb[2] - bb[0])
@@ -2310,15 +2314,15 @@
             cc[0] = cx - dy / 2
             cc[2] = cc[0] + dy
             cc[1] = cy - dx / 2
             cc[3] = cc[1] + dx
             elements.update_bounds([cc[0], cc[1], cc[2], cc[3]])
 
     def scale_selection_to_ref(self, method="none"):
-        refob = self.scene.reference_object
+        refob = self.scene.pane.reference_object
         if refob is None:
             return
         bb = refob.bounds
         elements = self.scene.context.elements
         cc = elements.selected_area()
 
         if bb is None or cc is None:
@@ -2372,37 +2376,37 @@
             self.scene.context.elements.validate_selected_area()
             self.scene.request_refresh()
 
     def become_reference(self, event):
         for e in self.scene.context.elements.flat(types=elem_nodes, emphasized=True):
             try:
                 # First object
-                self.scene.reference_object = e
+                self.scene.pane.reference_object = e
                 break
             except AttributeError:
                 pass
         # print("set...")
         self.scene.context.signal("reference")
         self.scene.request_refresh()
 
     def delete_reference(self, event):
-        self.scene.reference_object = None
+        self.scene.pane.reference_object = None
         self.scene.context.signal("reference")
         # Simplify, no complete scene refresh required
         # print("unset...")
         self.scene.request_refresh()
 
     def create_menu(self, gui, node, elements):
         if node is None:
             return
         if hasattr(node, "node"):
             node = node.node
         menu = create_menu_for_node(gui, node, elements)
         # Now check whether we have a reference object
-        reference_object = self.scene.reference_object
+        reference_object = self.scene.pane.reference_object
         if reference_object is not None:
             # Okay, just lets make sure we are not doing this on the refobject itself...
             for e in self.scene.context.elements.flat(
                 types=elem_nodes, emphasized=True
             ):
                 # Here we acknowledge the lock-status of an element
                 if reference_object is e:
@@ -2418,15 +2422,15 @@
             gui.Bind(wx.EVT_MENU, self.show_reference_align_dialog, id=item1.GetId())
 
         if self.single_element and not self.is_ref:
             if submenu is None:
                 submenu = wx.Menu()
             item2 = submenu.Append(wx.ID_ANY, _("Become reference object"))
             gui.Bind(wx.EVT_MENU, self.become_reference, id=item2.GetId())
-        if self.scene.reference_object is not None:
+        if self.scene.pane.reference_object is not None:
             if submenu is None:
                 submenu = wx.Menu()
             item3 = submenu.Append(wx.ID_ANY, _("Clear reference object"))
             gui.Bind(wx.EVT_MENU, self.delete_reference, id=item3.GetId())
 
         if submenu is not None:
             menu.AppendSubMenu(submenu, _("Reference Object"))
@@ -2482,36 +2486,36 @@
                         self.scene.cursor("arrow")
                         self.scene.context.signal("statusmsg", "")
 
         elif event_type in ("leftdown", "leftup", "leftclick", "move"):
             # self.scene.tool_active = False
             pass
         elif event_type == "rightdown":
-            self.scene.tool_active = False
-            self.scene.modif_active = False
+            self.scene.pane.tool_active = False
+            self.scene.pane.modif_active = False
             smallest = bool(self.scene.context.select_smallest) != bool(
                 "ctrl" in modifiers
             )
             elements.set_emphasized_by_position(
                 space_pos,
                 keep_old_selection=False,
                 use_smallest=smallest,
                 exit_over_selection=True,
             )
             # Check if reference is still existing
-            self.scene.validate_reference()
+            self.scene.pane.validate_reference()
             if not elements.has_emphasis():
                 return RESPONSE_CONSUME
             self.create_menu(
                 self.scene.context.gui, elements.top_element(emphasized=True), elements
             )
             return RESPONSE_CONSUME
         elif event_type == "doubleclick":
-            self.scene.tool_active = False
-            self.scene.modif_active = False
+            self.scene.pane.tool_active = False
+            self.scene.pane.modif_active = False
             smallest = bool(self.scene.context.select_smallest) != bool(
                 "ctrl" in modifiers
             )
             elements.set_emphasized_by_position(
                 space_pos,
                 keep_old_selection=False,
                 use_smallest=smallest,
@@ -2554,15 +2558,15 @@
         Draw routine for drawing the selection box.
         """
         self.gc = gc
         if self.scene.context.draw_mode & DRAW_MODE_SELECTION != 0:
             return
         self.clear()  # Clearing children as we are generating them in a bit...
         # Don't interfere during node editing
-        if self.scene.active_tool.startswith("edit"):
+        if self.scene.pane.active_tool.startswith("edit"):
             return
         context = self.scene.context
         try:
             self.use_handle_rotate = context.enable_sel_rotate
             self.use_handle_skew = context.enable_sel_skew
             self.use_handle_size = context.enable_sel_size
             self.use_handle_move = context.enable_sel_move
@@ -2623,15 +2627,15 @@
                 self.rotation_cy = cy
 
             # Code for reference object - single object? And identical to reference?
             self.is_ref = False
             self.single_element = True
             is_locked = True
             for idx, e in enumerate(elements.flat(types=elem_nodes, emphasized=True)):
-                if e is self.scene.reference_object:
+                if e is self.scene.pane.reference_object:
                     self.is_ref = True
                 # Is one of the elements locked?
                 is_locked = is_locked and e.lock
                 if idx > 0:
                     self.single_element = False
 
             if not self.single_element:
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/simulation.py` & `meerk40t-0.8.3000/meerk40t/gui/simulation.py`

 * *Files 2% similar despite different names*

```diff
@@ -833,15 +833,23 @@
 
         if menu.MenuItemCount != 0:
             gui.PopupMenu(menu)
             menu.Destroy()
 
 
 class SimulationPanel(wx.Panel, Job):
-    def __init__(self, *args, context=None, plan_name=None, auto_clear=True, **kwds):
+    def __init__(
+        self,
+        *args,
+        context=None,
+        plan_name=None,
+        auto_clear=True,
+        optimise_at_start=True,
+        **kwds,
+    ):
         kwds["style"] = kwds.get("style", 0) | wx.TAB_TRAVERSAL
         wx.Panel.__init__(self, *args, **kwds)
         self.parent = args[0]
         self.context = context
         self.plan_name = plan_name
         self.auto_clear = auto_clear
 
@@ -910,15 +918,18 @@
         self.subpanel_operations.Reparent(self.panel_optimize)
         self.subpanel_cutcode.Reparent(self.panel_optimize)
         self.panel_optimize.AddPage(self.subpanel_optimize, _("Optimizations"))
         self.panel_optimize.AddPage(self.subpanel_operations, _("Operations"))
         self.panel_optimize.AddPage(self.subpanel_cutcode, _("Cutcode"))
         self.checkbox_optimize = wx.CheckBox(self, wx.ID_ANY, _("Optimize"))
         self.checkbox_optimize.SetToolTip(_("Enable/Disable Optimize"))
-        self.checkbox_optimize.SetValue(1)
+        if optimise_at_start:
+            self.checkbox_optimize.SetValue(1)
+        else:
+            self.checkbox_optimize.SetValue(0)
         self.btn_redo_it = wx.Button(self, wx.ID_ANY, _("Recalculate"))
         self.btn_redo_it.Bind(wx.EVT_BUTTON, self.on_redo_it)
 
         self.slider_progress = wx.Slider(self, wx.ID_ANY, self.max, 0, self.max)
         self.slider_progress.SetFocus()
         self.text_distance_laser = wx.TextCtrl(
             self, wx.ID_ANY, "", style=wx.TE_READONLY
@@ -998,36 +1009,38 @@
         )
         self.Bind(
             wx.EVT_RADIOBUTTON, self.on_radio_playback_mode, self.radio_time_minutes
         )
         self.view_pane.scene_panel.Bind(wx.EVT_RIGHT_DOWN, self.on_mouse_right_down)
         self.Bind(wx.EVT_CHECKBOX, self.on_checkbox_optimize, self.checkbox_optimize)
         # end wxGlade
+        self.on_checkbox_optimize(None)
 
         ##############
         # BUILD SCENE
         ##############
 
         self.widget_scene.add_scenewidget(SimulationWidget(self.widget_scene, self))
         self.sim_travel = SimulationTravelWidget(self.widget_scene, self)
         self.widget_scene.add_scenewidget(self.sim_travel)
+
+        self.grid = GridWidget(
+            self.widget_scene, name="Simulation", suppress_labels=True
+        )
         # Don't let grid resize itself
-        self.widget_scene.auto_tick = False
+        self.grid.auto_tick = False
         if self.context.units_name == "mm":
-            self.widget_scene.tick_distance = 10  # mm
+            self.grid.tick_distance = 10  # mm
         elif self.context.units_name == "cm":
-            self.widget_scene.tick_distance = 1
+            self.grid.tick_distance = 1
         elif self.context.units_name == "inch":
-            self.widget_scene.tick_distance = 0.5
+            self.grid.tick_distance = 0.5
         elif self.context.units_name == "mil":
-            self.widget_scene.tick_distance = 500
-        # print (f"{self.widget_scene.tick_distance} {self.context.units_name}")
-        self.widget_scene.add_scenewidget(
-            GridWidget(self.widget_scene, name="Simulation", suppress_labels=True)
-        )
+            self.grid.tick_distance = 500
+        self.widget_scene.add_scenewidget(self.grid)
         self.widget_scene.add_scenewidget(
             BedWidget(self.widget_scene, name="Simulation")
         )
         self.widget_scene.add_interfacewidget(SimReticleWidget(self.widget_scene, self))
 
         self.parent.add_module_delegate(self.options_optimize)
         self.context.setting(int, "simulation_mode", 0)
@@ -1247,25 +1260,19 @@
         Toggle the draw mode for the background
         """
         self.widget_scene.context.draw_mode ^= DRAW_MODE_BACKGROUND
         self.widget_scene.request_refresh()
 
     def toggle_grid(self, gridtype):
         if gridtype == "primary":
-            self.widget_scene.draw_grid_primary = (
-                not self.widget_scene.draw_grid_primary
-            )
+            self.grid.draw_grid_primary = not self.grid.draw_grid_primary
         elif gridtype == "secondary":
-            self.widget_scene.draw_grid_secondary = (
-                not self.widget_scene.draw_grid_secondary
-            )
+            self.grid.draw_grid_secondary = not self.grid.draw_grid_secondary
         elif gridtype == "circular":
-            self.widget_scene.draw_grid_circular = (
-                not self.widget_scene.draw_grid_circular
-            )
+            self.grid.draw_grid_circular = not self.grid.draw_grid_circular
         self.widget_scene.request_refresh()
 
     def toggle_grid_p(self, event):
         self.toggle_grid("primary")
 
     def toggle_grid_s(self, event):
         self.toggle_grid("secondary")
@@ -1368,31 +1375,31 @@
         id2 = menu.Append(
             wx.ID_ANY,
             _("Show Primary Grid"),
             _("Display the primary grid in the Simulation pane"),
             wx.ITEM_CHECK,
         )
         self.Bind(wx.EVT_MENU, self.toggle_grid_p, id=id2.GetId())
-        menu.Check(id2.GetId(), self.widget_scene.draw_grid_primary)
+        menu.Check(id2.GetId(), self.grid.draw_grid_primary)
         id3 = menu.Append(
             wx.ID_ANY,
             _("Show Secondary Grid"),
             _("Display the secondary grid in the Simulation pane"),
             wx.ITEM_CHECK,
         )
         self.Bind(wx.EVT_MENU, self.toggle_grid_s, id=id3.GetId())
-        menu.Check(id3.GetId(), self.widget_scene.draw_grid_secondary)
+        menu.Check(id3.GetId(), self.grid.draw_grid_secondary)
         id4 = menu.Append(
             wx.ID_ANY,
             _("Show Circular Grid"),
             _("Display the circular grid in the Simulation pane"),
             wx.ITEM_CHECK,
         )
         self.Bind(wx.EVT_MENU, self.toggle_grid_c, id=id4.GetId())
-        menu.Check(id4.GetId(), self.widget_scene.draw_grid_circular)
+        menu.Check(id4.GetId(), self.grid.draw_grid_circular)
         if self.widget_scene.has_background:
             menu.AppendSeparator()
             id5 = menu.Append(wx.ID_ANY, _("Remove Background"), "")
             self.Bind(wx.EVT_MENU, self.remove_background, id=id5.GetId())
         menu.AppendSeparator()
         self.Bind(
             wx.EVT_MENU,
@@ -2107,21 +2114,26 @@
             plan_name = args[3]
         else:
             plan_name = None
         if len(args) > 4:
             auto_clear = bool(int(args[4]))
         else:
             auto_clear = True
+        if len(args) > 5:
+            optimise = bool(int(args[5]))
+        else:
+            optimise = True
 
         self.panel = SimulationPanel(
             self,
             wx.ID_ANY,
             context=self.context,
             plan_name=plan_name,
             auto_clear=auto_clear,
+            optimise_at_start=optimise,
         )
         _icon = wx.NullIcon
         _icon.CopyFromBitmap(icons8_laser_beam_hazard2_50.GetBitmap())
         self.SetIcon(_icon)
         self.SetTitle(_("Simulation"))
 
     @staticmethod
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/snapoptions.py` & `meerk40t-0.8.3000/meerk40t/gui/snapoptions.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/spoolerpanel.py` & `meerk40t-0.8.3000/meerk40t/gui/wordlisteditor.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,980 +1,909 @@
-import time
-from math import isinf, isnan
-from pathlib import Path
+import os
+import re
 
 import wx
-import wx.lib.mixins.listctrl as listmix
 from wx import aui
 
-from meerk40t.gui.icons import (
-    icons8_emergency_stop_button_50,
-    icons8_pause_50,
-    icons8_route_50,
+from ..kernel import signal_listener
+from .icons import (
+    icons8_add_new_25,
+    icons8_circled_left_50,
+    icons8_circled_right_50,
+    icons8_curly_brackets_50,
+    icons8_edit_25,
+    icons8_paste_25,
+    icons8_remove_25,
 )
-from meerk40t.gui.mwindow import MWindow
-from meerk40t.kernel import get_safe_path, signal_listener
+from .mwindow import MWindow
+from .wxutils import StaticBoxSizer
 
 _ = wx.GetTranslation
 
-JC_INDEX = 0
-JC_DEVICE = 1
-JC_JOBNAME = 2
-JC_ENTRIES = 3
-JC_STATUS = 4
-JC_TYPE = 5
-JC_STEPS = 6
-JC_PASSES = 7
-JC_PRIORITY = 8
-JC_RUNTIME = 9
-JC_ESTIMATE = 10
-
-HC_INDEX = 0
-HC_DEVICE = 1
-HC_JOBNAME = 2
-HC_START = 3
-HC_END = 4
-HC_RUNTIME = 5
-HC_ESTIMATE = 6
-HC_STEPS = 7
-HC_PASSES = 8
-HC_STATUS = 9
-HC_JOBINFO = 10
 
-
-def register_panel_spooler(window, context):
-    panel = SpoolerPanel(window, wx.ID_ANY, context=context)
+def register_panel_wordlist(window, context):
     pane = (
         aui.AuiPaneInfo()
-        .Bottom()
-        .Layer(1)
-        .MinSize(600, 100)
-        .FloatingSize(600, 230)
-        .Caption(_("Spooler"))
-        .Name("spooler")
+        .Left()
+        .MinSize(150, 25)
+        .FloatingSize(150, 35)
+        .Caption(_("Wordlist"))
         .CaptionVisible(not context.pane_lock)
+        .Name("wordlist")
         .Hide()
     )
-    pane.dock_proportion = 600
-    pane.control = panel
-
+    pane.dock_proportion = 225
+    pane.control = WordlistMiniPanel(window, wx.ID_ANY, context=context)
+    pane.submenu = "_50_" + _("Tools")
     window.on_pane_create(pane)
-    context.register("pane/spooler", pane)
+    context.register("pane/wordlist", pane)
 
 
-class EditableListCtrl(wx.ListCtrl, listmix.TextEditMixin):
-    """TextEditMixin allows any column to be edited."""
+class WordlistMiniPanel(wx.Panel):
+    def __init__(self, *args, context=None, **kwds):
+        kwds["style"] = kwds.get("style", 0) | wx.TAB_TRAVERSAL
+        wx.Panel.__init__(self, *args, **kwds)
+        self.context = context
+        main_sizer = wx.BoxSizer(wx.HORIZONTAL)
+        self.button_edit = wx.Button(self, wx.ID_ANY, _("Edit"))
+        self.button_edit.SetBitmap(icons8_curly_brackets_50.GetBitmap(resize=25))
+        self.button_edit.SetToolTip(_("Manages Wordlist-Entries"))
+
+        self.button_next = wx.Button(self, wx.ID_ANY, _("Next"))
+        self.button_next.SetBitmap(icons8_circled_right_50.GetBitmap(resize=25))
+        self.button_next.SetToolTip(
+            _("Wordlist: go to next page (right-click to next entry)")
+        )
+
+        self.button_prev = wx.Button(self, wx.ID_ANY, _("Prev"))
+        self.button_prev.SetBitmap(icons8_circled_left_50.GetBitmap(resize=25))
+        self.button_prev.SetToolTip(
+            _("Wordlist: go to previous page (right-click to previous entry)")
+        )
+
+        main_sizer.Add(self.button_prev, 1, wx.EXPAND, 0)
+        main_sizer.Add(self.button_edit, 1, wx.EXPAND, 0)
+        main_sizer.Add(self.button_next, 1, wx.EXPAND, 0)
+
+        self.button_next.Bind(wx.EVT_BUTTON, self.on_button_next_page)
+        self.button_prev.Bind(wx.EVT_BUTTON, self.on_button_prev_page)
+        self.button_next.Bind(wx.EVT_RIGHT_DOWN, self.on_button_next)
+        self.button_prev.Bind(wx.EVT_RIGHT_DOWN, self.on_button_prev)
+        self.button_edit.Bind(wx.EVT_BUTTON, self.on_button_edit)
+
+        self.SetSizer(main_sizer)
+        self.Layout()
 
-    # ----------------------------------------------------------------------
-    def __init__(
-        self, parent, ID=wx.ID_ANY, pos=wx.DefaultPosition, size=wx.DefaultSize, style=0
-    ):
-        """Constructor"""
-        wx.ListCtrl.__init__(self, parent, ID, pos, size, style)
-        listmix.TextEditMixin.__init__(self)
+    def establish_max_delta(self):
+        # try to establish the needed delta to satisfy all variables...
+        deltamin = 0
+        deltamax = 0
+        for node in self.context.elements.elems():
+            sample = ""
+            if node.type == "elem text":
+                if node.text is not None:
+                    sample = node.text
+            elif node.type == "elem path" and hasattr(node, "mktext"):
+                if node.mktext is not None:
+                    sample = node.mktext
+            if sample == "":
+                continue
+            # we can be rather agnostic on the individual variable, we are interested in the highest {variable#+offset} pattern
+            brackets = re.compile(r"\{[^}]+\}")
+            for bracketed_key in brackets.findall(sample):
+                #            print(f"Key found: {bracketed_key}")
+                key = bracketed_key[1:-1].lower().strip()
+                relative = 0
+                pos = key.find("#")
+                if pos > 0:  # Needs to be after first character
+                    # Process offset modification.
+                    index_string = key[pos + 1 :]
+                    key = key[:pos].strip()
+                    if index_string.startswith("+") or index_string.startswith("-"):
+                        try:
+                            # This covers +x, -x, x
+                            relative = int(index_string)
+                        except ValueError:
+                            relative = 0
+                deltamin = min(relative, deltamin)
+                deltamax = max(relative, deltamax)
+
+        return deltamax
+
+    def on_button_edit(self, event):
+        self.context("window toggle Wordlist\n")
+
+    def on_button_prev(self, event):
+        self.context.elements.wordlist_advance(-1)
+
+    def on_button_prev_page(self, event):
+        delta = self.establish_max_delta()
+        self.context.elements.wordlist_advance(-1 - delta)
+
+    def on_button_next(self, event):
+        self.context.elements.wordlist_advance(+1)
+
+    def on_button_next_page(self, event):
+        delta = self.establish_max_delta()
+        self.context.elements.wordlist_advance(+1 + delta)
 
 
-class SpoolerPanel(wx.Panel):
-    def __init__(self, *args, context=None, selected_device=None, **kwds):
-        # begin wxGlade: SpoolerPanel.__init__
+class WordlistPanel(wx.Panel):
+    def __init__(self, *args, context=None, **kwds):
         kwds["style"] = kwds.get("style", 0) | wx.TAB_TRAVERSAL
         wx.Panel.__init__(self, *args, **kwds)
         self.context = context
-        self.selected_device = selected_device
-        self.available_devices = context.kernel.services("device")
-        self.filter_device = None
-        spools = [s.label for s in self.available_devices]
-        spools.insert(0, _("-- All available devices --"))
-        self.queue_entries = []
-        self.context.setting(int, "spooler_sash_position", 0)
-        self.context.setting(bool, "spool_history_clear_on_start", False)
-        self.context.setting(bool, "spool_ignore_helper_jobs", True)
-
-        self.splitter = wx.SplitterWindow(self, id=wx.ID_ANY, style=wx.SP_LIVE_UPDATE)
-        sty = wx.BORDER_SUNKEN
-
-        self.win_top = wx.Window(self.splitter, style=sty)
-        self.win_bottom = wx.Window(self.splitter, style=sty)
-        self.splitter.SetMinimumPaneSize(50)
-        self.splitter.SplitHorizontally(self.win_top, self.win_bottom, -100)
-        self.splitter.SetSashPosition(self.context.spooler_sash_position)
-        self.combo_device = wx.ComboBox(
-            self.win_top, wx.ID_ANY, choices=spools, style=wx.CB_DROPDOWN
-        )
-        self.combo_device.SetSelection(0)  # All by default...
-        self.button_pause = wx.Button(self.win_top, wx.ID_ANY, _("Pause"))
-        self.button_pause.SetToolTip(_("Pause/Resume the laser"))
-        self.button_pause.SetBitmap(icons8_pause_50.GetBitmap(resize=25))
-        self.button_stop = wx.Button(self.win_top, wx.ID_ANY, _("Abort"))
-        self.button_stop.SetToolTip(_("Stop the laser"))
-        self.button_stop.SetBitmap(icons8_emergency_stop_button_50.GetBitmap(resize=25))
-        self.button_stop.SetBackgroundColour(wx.Colour(127, 0, 0))
-
-        self.list_job_spool = wx.ListCtrl(
-            self.win_top, wx.ID_ANY, style=wx.LC_HRULES | wx.LC_REPORT | wx.LC_VRULES
-        )
+        self.parent_panel = None
+        self.wlist = self.context.elements.mywordlist
+        self.current_entry = None
+        # For Grid editing
+        self.cur_skey = None
+        self.cur_index = None
+        self.to_save_content = None
+        self.to_save_wordlist = None
 
-        self.info_label = wx.StaticText(
-            self.win_bottom, wx.ID_ANY, _("Completed jobs:")
-        )
-        self.button_clear_history = wx.Button(
-            self.win_bottom, wx.ID_ANY, _("Clear History")
+        self.context.setting(bool, "wordlist_autosave", False)
+
+        sizer_main = wx.BoxSizer(wx.VERTICAL)
+        sizer_grids = wx.BoxSizer(wx.HORIZONTAL)
+        sizer_grid_left = wx.BoxSizer(wx.VERTICAL)
+        sizer_grid_right = wx.BoxSizer(wx.VERTICAL)
+        sizer_grids.Add(sizer_grid_left, 1, wx.EXPAND, 0)
+        sizer_grids.Add(sizer_grid_right, 1, wx.EXPAND, 0)
+
+        sizer_index_left = wx.BoxSizer(wx.HORIZONTAL)
+        sizer_grid_left.Add(sizer_index_left, 0, wx.EXPAND, 0)
+
+        label_2 = wx.StaticText(self, wx.ID_ANY, _("Start Index for CSV-based data:"))
+        sizer_index_left.Add(label_2, 0, wx.ALIGN_CENTER_VERTICAL, 0)
+        self.cbo_Index = wx.ComboBox(
+            self, wx.ID_ANY, choices=[], style=wx.CB_DROPDOWN | wx.CB_READONLY
         )
-        self.list_job_history = EditableListCtrl(
-            self.win_bottom,
+        sizer_index_left.Add(self.cbo_Index, 0, wx.ALIGN_CENTER_VERTICAL, 0)
+
+        self.grid_wordlist = wx.ListCtrl(
+            self,
             wx.ID_ANY,
-            style=wx.LC_HRULES | wx.LC_REPORT | wx.LC_VRULES | wx.LC_SINGLE_SEL,
+            style=wx.LC_HRULES
+            | wx.LC_REPORT
+            | wx.LC_VRULES
+            | wx.LC_SINGLE_SEL
+            | wx.LC_EDIT_LABELS,
         )
+        sizer_grid_left.Add(self.grid_wordlist, 1, wx.EXPAND, 0)
 
-        self.__set_properties()
-        self.__do_layout()
-        self.current_item = None
-        self.Bind(
-            wx.EVT_BUTTON, self.on_button_clear_history, self.button_clear_history
-        )
-        self.button_clear_history.Bind(wx.EVT_RIGHT_DOWN, self.on_right_mouse_history)
-        self.list_job_history.Bind(wx.EVT_RIGHT_DOWN, self.on_right_mouse_history)
-        self.list_job_history.Bind(
-            wx.EVT_LIST_BEGIN_LABEL_EDIT, self.before_history_update
+        self.grid_content = wx.ListCtrl(
+            self,
+            wx.ID_ANY,
+            style=wx.LC_HRULES
+            | wx.LC_REPORT
+            | wx.LC_VRULES
+            | wx.LC_SINGLE_SEL
+            | wx.LC_EDIT_LABELS,
         )
-        self.list_job_history.Bind(wx.EVT_LIST_END_LABEL_EDIT, self.on_history_update)
-        self.Bind(wx.EVT_BUTTON, self.on_button_pause, self.button_pause)
-        self.Bind(wx.EVT_BUTTON, self.on_button_stop, self.button_stop)
-        self.Bind(wx.EVT_COMBOBOX, self.on_combo_device, self.combo_device)
-        self.Bind(wx.EVT_LIST_BEGIN_DRAG, self.on_list_drag, self.list_job_spool)
 
-        self.splitter.Bind(wx.EVT_SPLITTER_SASH_POS_CHANGED, self.on_sash_changed)
-        self.splitter.Bind(wx.EVT_SPLITTER_DOUBLECLICKED, self.on_sash_double)
+        sizer_edit_wordlist_buttons = wx.BoxSizer(wx.HORIZONTAL)
+        sizer_edit_content_buttons = wx.BoxSizer(wx.HORIZONTAL)
 
-        self.list_job_spool.Bind(wx.EVT_LIST_ITEM_SELECTED, self.on_item_selected)
-        # self.list_job_spool.Bind(wx.EVT_LEFT_DCLICK, self.on_item_doubleclick)
-        self.Bind(
-            wx.EVT_LIST_ITEM_RIGHT_CLICK, self.on_item_rightclick, self.list_job_spool
+        dummylabel = wx.StaticText(self, wx.ID_ANY, " ")
+        sizer_index_left.Add(dummylabel, 1, wx.ALIGN_CENTER_VERTICAL, 0)
+        sizer_index_left.Add(
+            sizer_edit_wordlist_buttons, 0, wx.ALIGN_CENTER_VERTICAL, 0
         )
-        # end wxGlade
-        self._last_invokation = 0
-        self.dirty = False
-        self.update_buffer_size = False
-        self.update_spooler_state = False
-        self.update_spooler = True
-
-        self.elements_progress = 0
-        self.elements_progress_total = 0
-        self.command_index = 0
-        self.listener_list = None
-        self.list_lookup = {}
-        self.map_item_key = {}
-        self.refresh_history()
-        self.set_pause_color()
-        if self.context.spool_history_clear_on_start:
-            self.clear_history()
 
-    def __set_properties(self):
-        # begin wxGlade: SpoolerPanel.__set_properties
-        self.combo_device.SetToolTip(_("Select the device"))
-        self.list_job_spool.SetToolTip(_("List and modify the queued operations"))
-        self.list_job_spool.AppendColumn(_("#"), format=wx.LIST_FORMAT_LEFT, width=58)
-        self.list_job_spool.AppendColumn(
-            _("Device"),
-            format=wx.LIST_FORMAT_LEFT,
-            width=95,
+        self.btn_edit_wordlist_del = wx.StaticBitmap(
+            self, wx.ID_ANY, size=wx.Size(25, 25)
         )
-        self.list_job_spool.AppendColumn(
-            _("Name"), format=wx.LIST_FORMAT_LEFT, width=95
+        self.btn_edit_wordlist_edit = wx.StaticBitmap(
+            self, wx.ID_ANY, size=wx.Size(25, 25)
         )
-        self.list_job_spool.AppendColumn(
-            _("Items"), format=wx.LIST_FORMAT_LEFT, width=45
+        self.btn_edit_content_add = wx.StaticBitmap(
+            self, wx.ID_ANY, size=wx.Size(25, 25)
         )
-        self.list_job_spool.AppendColumn(
-            _("Status"), format=wx.LIST_FORMAT_LEFT, width=73
+        self.btn_edit_content_del = wx.StaticBitmap(
+            self, wx.ID_ANY, size=wx.Size(25, 25)
         )
-        self.list_job_spool.AppendColumn(
-            _("Type"), format=wx.LIST_FORMAT_LEFT, width=60
+        self.btn_edit_content_edit = wx.StaticBitmap(
+            self, wx.ID_ANY, size=wx.Size(25, 25)
         )
-        self.list_job_spool.AppendColumn(
-            _("Steps"), format=wx.LIST_FORMAT_LEFT, width=73
-        )
-        self.list_job_spool.AppendColumn(
-            _("Passes"), format=wx.LIST_FORMAT_LEFT, width=73
-        )
-        self.list_job_spool.AppendColumn(
-            _("Priority"), format=wx.LIST_FORMAT_LEFT, width=73
-        )
-        self.list_job_spool.AppendColumn(
-            _("Runtime"), format=wx.LIST_FORMAT_LEFT, width=73
-        )
-        self.list_job_spool.AppendColumn(
-            _("Estimate"), format=wx.LIST_FORMAT_LEFT, width=73
+        self.btn_edit_content_paste = wx.StaticBitmap(
+            self, wx.ID_ANY, size=wx.Size(25, 25)
         )
+        self.btn_edit_wordlist_del.SetBitmap(icons8_remove_25.GetBitmap())
+        self.btn_edit_wordlist_edit.SetBitmap(icons8_edit_25.GetBitmap())
+        self.btn_edit_content_add.SetBitmap(icons8_add_new_25.GetBitmap())
+        self.btn_edit_content_del.SetBitmap(icons8_remove_25.GetBitmap())
+        self.btn_edit_content_edit.SetBitmap(icons8_edit_25.GetBitmap())
+        self.btn_edit_content_paste.SetBitmap(icons8_paste_25.GetBitmap())
 
-        self.list_job_history.AppendColumn(_("#"), format=wx.LIST_FORMAT_LEFT, width=48)
-
-        self.list_job_history.AppendColumn(
-            _("Device"), format=wx.LIST_FORMAT_LEFT, width=73
-        )
-        self.list_job_history.AppendColumn(
-            _("Name"), format=wx.LIST_FORMAT_LEFT, width=95
-        )
-        self.list_job_history.AppendColumn(
-            _("Start"), format=wx.LIST_FORMAT_LEFT, width=113
-        )
-        self.list_job_history.AppendColumn(
-            _("End"), format=wx.LIST_FORMAT_LEFT, width=73
+        self.btn_edit_wordlist_del.SetToolTip(_("Delete the current variable"))
+        self.btn_edit_wordlist_edit.SetToolTip(
+            _("Edit the name of the active variable")
         )
-        self.list_job_history.AppendColumn(
-            _("Runtime"), format=wx.LIST_FORMAT_LEFT, width=73
+        self.btn_edit_content_add.SetToolTip(
+            _("Add a new entry for the active variable")
         )
-        self.list_job_history.AppendColumn(
-            _("Estimate"), format=wx.LIST_FORMAT_LEFT, width=73
+        self.btn_edit_content_del.SetToolTip(
+            _("Delete the current entry for the active variable")
         )
-        self.list_job_history.AppendColumn(
-            _("Steps"), format=wx.LIST_FORMAT_LEFT, width=73
+        self.btn_edit_content_edit.SetToolTip(
+            _("Edit the current entry for the active variable")
         )
-        self.list_job_history.AppendColumn(
-            _("Passes"), format=wx.LIST_FORMAT_LEFT, width=73
-        )
-        self.list_job_history.AppendColumn(
-            _("Status"), format=wx.LIST_FORMAT_LEFT, width=73
-        )
-        self.list_job_history.AppendColumn(
-            _("Jobinfo"), format=wx.LIST_FORMAT_LEFT, width=wx.LIST_AUTOSIZE_USEHEADER
+        self.btn_edit_content_paste.SetToolTip(
+            _(
+                "Paste the clipboard as new entries for the active variable, any line as new entry"
+            )
         )
+        minsize = 23
+        self.btn_edit_wordlist_del.SetMinSize(wx.Size(minsize, minsize))
+        self.btn_edit_wordlist_edit.SetMinSize(wx.Size(minsize, minsize))
+        self.btn_edit_content_add.SetMinSize(wx.Size(minsize, minsize))
+        self.btn_edit_content_del.SetMinSize(wx.Size(minsize, minsize))
+        self.btn_edit_content_edit.SetMinSize(wx.Size(minsize, minsize))
+        self.btn_edit_content_paste.SetMinSize(wx.Size(minsize, minsize))
 
-        # end wxGlade
+        sizer_edit_wordlist_buttons.Add(self.btn_edit_wordlist_del, 0, wx.EXPAND, 0)
+        sizer_edit_wordlist_buttons.Add(self.btn_edit_wordlist_edit, 0, wx.EXPAND, 0)
 
-    def __do_layout(self):
-        sizer_main = wx.BoxSizer(wx.VERTICAL)
+        sizer_edit_content_buttons.Add(self.btn_edit_content_add, 0, wx.EXPAND, 0)
+        sizer_edit_content_buttons.Add(self.btn_edit_content_del, 0, wx.EXPAND, 0)
+        sizer_edit_content_buttons.Add(self.btn_edit_content_edit, 0, wx.EXPAND, 0)
+        sizer_edit_content_buttons.Add(self.btn_edit_content_paste, 0, wx.EXPAND, 0)
 
-        sizer_top = wx.BoxSizer(wx.VERTICAL)
-        sizer_bottom = wx.BoxSizer(wx.VERTICAL)
-        sizer_combo_cmds = wx.BoxSizer(wx.HORIZONTAL)
-        sizer_combo_cmds.Add(self.combo_device, 1, wx.ALIGN_CENTER_VERTICAL, 0)
-        sizer_combo_cmds.Add(self.button_pause, 0, wx.EXPAND, 0)
-        sizer_combo_cmds.Add(self.button_stop, 0, wx.EXPAND, 0)
-
-        sizer_top.Add(sizer_combo_cmds, 0, wx.EXPAND, 0)
-        sizer_top.Add(self.list_job_spool, 4, wx.EXPAND, 0)
-        self.win_top.SetSizer(sizer_top)
-        sizer_top.Fit(self.win_top)
-
-        hsizer = wx.BoxSizer(wx.HORIZONTAL)
-        hsizer.Add(self.info_label, 1, wx.ALIGN_CENTER_VERTICAL, 0)
-        hsizer.Add(self.button_clear_history, 0, wx.EXPAND, 0)
-        sizer_bottom.Add(hsizer, 0, wx.EXPAND, 0)
-        sizer_bottom.Add(self.list_job_history, 2, wx.EXPAND, 0)
-        self.win_bottom.SetSizer(sizer_bottom)
-        sizer_bottom.Fit(self.win_bottom)
+        sizer_index_right = wx.BoxSizer(wx.HORIZONTAL)
+        label_2 = wx.StaticText(self, wx.ID_ANY, _("Start Index for field:"))
+        sizer_index_right.Add(label_2, 0, wx.ALIGN_CENTER_VERTICAL, 0)
+        self.cbo_index_single = wx.ComboBox(
+            self, wx.ID_ANY, choices=[], style=wx.CB_DROPDOWN | wx.CB_READONLY
+        )
+        sizer_index_right.Add(self.cbo_index_single, 1, wx.ALIGN_CENTER_VERTICAL, 0)
 
-        sizer_main.Add(self.splitter, 1, wx.EXPAND, 0)
-        self.SetSizer(sizer_main)
-        sizer_main.Fit(self)
-        self.Layout()
-        # end wxGlade
+        dummylabel = wx.StaticText(self, wx.ID_ANY, " ")
+        sizer_index_right.Add(dummylabel, 1, wx.ALIGN_CENTER_VERTICAL, 0)
+        sizer_index_right.Add(
+            sizer_edit_content_buttons, 0, wx.ALIGN_CENTER_VERTICAL, 0
+        )
 
-    def on_sash_changed(self, event):
-        position = self.splitter.GetSashPosition()
-        self.context.spooler_sash_position = position
-
-    def on_sash_double(self, event):
-        self.splitter.SetSashPosition(0, True)
-        self.context.spooler_sash_position = 0
-
-    def on_item_selected(self, event):
-        self.current_item = event.Index
-
-    def write_csv(self):
-        filename = Path(get_safe_path(self.context.kernel.name, create=True)).joinpath(
-            "history.csv"
-        )
-        if self.filter_device:
-            events = self.context.logging.matching_events(
-                "job", device=self.filter_device
-            )
-        else:
-            events = self.context.logging.matching_events("job")
-        try:
-            with open(filename, "w", encoding="utf-8") as f:
-                simpleline = "device;jobname;start;end;duration;estimate;steps;total;loops;passes;status;info"
-                f.write(simpleline + "\n")
-                for key, info in events:
-                    line_items = []
-                    if info["start_time"] is None:
-                        continue
-                    line_items.append(info.get("device", "''"))
-                    line_items.append(info.get("label", "''"))
-                    line_items.append(
-                        f"{self.datestr(info.get('start_time',0))} {self.timestr(info.get('start_time',0), True)}"
-                    )
-
-                    line_items.append(
-                        self.timestr(
-                            info.get("start_time", 0) + info.get("duration", 0), True
-                        )
-                    )
-                    line_items.append(self.timestr(info.get("duration", 0), False))
-                    line_items.append(self.timestr(info.get("estimate", 0), False))
-                    line_items.append(str(info.get("steps_done", 0)))
-                    line_items.append(str(info.get("steps_total", 0)))
-                    line_items.append(str(info.get("loop", 0)))
-                    # First passes then device
-                    line_items.append(str(info.get("passes", "''")))
-                    line_items.append(str(info.get("status", "''")))
-                    line_items.append(str(info.get("info", "''")))
-                    f.write(f'{";".join(line_items)}\n')
+        sizer_grid_right.Add(sizer_index_right, 0, wx.EXPAND, 0)
+        sizer_grid_right.Add(self.grid_content, 1, wx.EXPAND, 0)
 
-        except (PermissionError, OSError, FileNotFoundError):
-            pass
+        self.txt_pattern = wx.TextCtrl(self, wx.ID_ANY, "")
 
-    def clear_history(self, older_than=None):
-        if self.filter_device:
-            to_remove = list(
-                self.context.logging.matching_events("job", device=self.filter_device)
-            )
-        else:
-            to_remove = list(self.context.logging.matching_events("job"))
-        for key, event in to_remove:
-            del self.context.logging.logs[key]
-        self.refresh_history()
-
-    def on_button_clear_history(self, event):
-        self.clear_history(None)
-
-    def on_right_mouse_history(self, event):
-        listid = self.list_job_history.GetFirstSelected()
-        if listid >= 0:
-            idx = self.list_job_history.GetItemData(listid)
-            key = self.map_item_key[listid]
-        else:
-            # Bad selection.
-            idx = -1
-            key = None
-
-        def on_menu_index(idx_to_delete):
-            def check(event_c):
-                del self.context.logging.logs[key]
-                self.refresh_history()
-
-            return check
-
-        def on_menu_time(cutoff):
-            def check(event):
-                self.clear_history(cutoff)
-
-            return check
-
-        def toggle_1(event):
-            self.context.spool_history_clear_on_start = (
-                not self.context.spool_history_clear_on_start
-            )
+        sizer_buttons = wx.BoxSizer(wx.HORIZONTAL)
+        sizer_buttons.Add(self.txt_pattern, 1, wx.ALIGN_CENTER_VERTICAL, 0)
 
-        def toggle_2(event):
-            self.context.spool_ignore_helper_jobs = (
-                not self.context.spool_ignore_helper_jobs
-            )
-            self.refresh_history()
+        self.btn_add = wx.Button(self, wx.ID_ANY, _("Add Text"))
+        self.btn_add.SetToolTip(_("Add another wordlist entry"))
+        sizer_buttons.Add(self.btn_add, 0, 0, 0)
 
-        now = time.time()
-        week_seconds = 60 * 60 * 24 * 7
-        options = [(_("All entries"), None)]
-        for week in range(1, 5):
-            cutoff_time = now - week * week_seconds
-            options.append((_("Older than {week} week").format(week=week), cutoff_time))
-        menu = wx.Menu()
-        if idx >= 0:
-            menuitem = menu.Append(wx.ID_ANY, _("Delete this entry"), "")
-            self.Bind(
-                wx.EVT_MENU,
-                on_menu_index(idx),
-                id=menuitem.GetId(),
-            )
-            menu.AppendSeparator()
+        self.btn_add_counter = wx.Button(self, wx.ID_ANY, _("Add Counter"))
+        sizer_buttons.Add(self.btn_add_counter, 0, 0, 0)
 
-        menuitem = menu.Append(wx.ID_ANY, _("Delete..."))
-        menu.Enable(menuitem.GetId(), False)
+        self.btn_delete = wx.Button(self, wx.ID_ANY, _("Delete"))
+        self.btn_delete.SetToolTip(_("Delete the current wordlist entry"))
+        sizer_buttons.Add(self.btn_delete, 0, 0, 0)
 
-        for item in options:
-            menuitem = menu.Append(wx.ID_ANY, item[0], "")
-            self.Bind(
-                wx.EVT_MENU,
-                on_menu_time(item[1]),
-                id=menuitem.GetId(),
-            )
+        sizer_exit = wx.BoxSizer(wx.HORIZONTAL)
 
-        menu.AppendSeparator()
-        menuitem = menu.Append(
-            wx.ID_ANY, _("Clear history on startup"), "", wx.ITEM_CHECK
-        )
-        menuitem.Check(self.context.spool_history_clear_on_start)
-        self.Bind(
-            wx.EVT_MENU,
-            toggle_1,
-            id=menuitem.GetId(),
-        )
-        menuitem = menu.Append(wx.ID_ANY, _("Ignore helper jobs"), "", wx.ITEM_CHECK)
-        menuitem.Check(self.context.spool_ignore_helper_jobs)
-        self.Bind(
-            wx.EVT_MENU,
-            toggle_2,
-            id=menuitem.GetId(),
-        )
-
-        item = menu.Append(wx.ID_ANY, _("Write CSV"), "", wx.ITEM_NORMAL)
-        self.Bind(wx.EVT_MENU, lambda e: self.write_csv(), item)
-
-        if menu.MenuItemCount != 0:
-            self.PopupMenu(menu)
-            menu.Destroy()
-
-    def on_button_pause(self, event):  # wxGlade: LaserPanel.<event_handler>
-        self.context("pause\n")
-
-    def on_button_stop(self, event):  # wxGlade: LaserPanel.<event_handler>
-        self.context("estop\n")
-
-    def on_combo_device(self, event=None):  # wxGlade: Spooler.<event_handler>
-        index = self.combo_device.GetSelection()
-        if index == 0:
-            self.filter_device = None
-        else:
-            self.filter_device = self.available_devices[index - 1].label
-        self.update_spooler = True
-        self.refresh_spooler_list()
-        self.refresh_history()
-        self.set_pause_color()
+        self.btn_backup = wx.Button(self, wx.ID_ANY, _("Backup Wordlist"))
+        self.btn_backup.SetToolTip(_("Save current wordlist to disk"))
+        sizer_exit.Add(self.btn_backup, 0, wx.ALIGN_CENTER_VERTICAL, 0)
 
-    def on_list_drag(self, event):  # wxGlade: JobSpooler.<event_handler>
-        # Todo: Drag to reprioritise jobs
-        event.Skip()
+        self.btn_restore = wx.Button(self, wx.ID_ANY, _("Restore Wordlist"))
+        self.btn_restore.SetToolTip(_("Load wordlist from disk"))
+        sizer_exit.Add(self.btn_restore, 0, wx.ALIGN_CENTER_VERTICAL, 0)
 
-    def on_item_rightclick(self, event):  # wxGlade: JobSpooler.<event_handler>
-        listindex = event.Index
-        index = self.list_job_spool.GetItemData(listindex)
-        try:
-            spooler = self.queue_entries[index][0]
-            qindex = self.queue_entries[index][1]
-            element = spooler.queue[qindex]
-        except IndexError:
-            return
+        self.check_autosave = wx.CheckBox(self, wx.ID_ANY, _("Autosave"))
+        self.check_autosave.SetToolTip(
+            _("All changes to the wordlist will be saved immediately")
+        )
+        sizer_exit.Add(self.check_autosave, 0, wx.ALIGN_CENTER_VERTICAL, 0)
+        self.check_autosave.SetValue(self.context.wordlist_autosave)
 
-        menu = wx.Menu()
-        if element.status.lower() == "running":
-            action = _("Stop")
-            remove_mode = "stop"
-        else:
-            action = _("Remove")
-            remove_mode = "remove"
-        item = menu.Append(
-            wx.ID_ANY,
-            f"{action} {str(element)[:30]} [{spooler.context.label}]",
-            "",
-            wx.ITEM_NORMAL,
-        )
-        info_tuple = [spooler, element, remove_mode]
-        self.Bind(wx.EVT_MENU, self.on_menu_popup_delete(info_tuple), item)
-
-        item = menu.Append(wx.ID_ANY, _("Clear All"), "", wx.ITEM_NORMAL)
-        self.Bind(wx.EVT_MENU, self.on_menu_popup_clear(element), item)
-
-        self.PopupMenu(menu)
-        menu.Destroy()
-
-    def on_menu_popup_clear(self, element=None):
-        def clear(event=None):
-            spoolers = []
-            for device in self.available_devices:
-                addit = True
-                if (
-                    self.filter_device is not None
-                    and device.label != self.filter_device
-                ):
-                    addit = False
-                if addit:
-                    spoolers.append(device.spooler)
-            for spooler in spoolers:
-                spooler.clear_queue()
-            self.refresh_spooler_list()
-
-        return clear
-
-    def on_menu_popup_delete(self, element):
-        def delete(event=None):
-            spooler = element[0]
-            mode = element[2]
-            job = element[1]
-            spooler.remove(job)
-            # That will remove the job but create a log entry if needed.
-            if mode == "stop":
-                # Force stop of laser.
-                self.context("estop\n")
-            self.refresh_spooler_list()
+        self.lbl_message = wx.StaticText(self, wx.ID_ANY, "")
+        sizer_exit.Add(self.lbl_message, 1, wx.ALIGN_CENTER_VERTICAL, 0)
+
+        sizer_lower = wx.BoxSizer(wx.HORIZONTAL)
+        sizer_lower.Add(sizer_buttons, 1, wx.ALL, 0)
+        sizer_lower.Add(sizer_exit, 1, wx.ALL, 0)
+
+        sizer_main.Add(sizer_grids, 1, wx.EXPAND, 0)
+        sizer_main.Add(sizer_lower, 0, wx.ALL, 0)
 
-        return delete
+        self.SetSizer(sizer_main)
+        self.Layout()
+        self._set_logic()
+        self.populate_gui()
 
-    def pane_show(self, *args):
-        self.refresh_spooler_list()
+    def _set_logic(self):
+        self.btn_add.Bind(wx.EVT_BUTTON, self.on_btn_add)
+        self.btn_add_counter.Bind(wx.EVT_BUTTON, self.on_add_counter)
+        self.btn_delete.Bind(wx.EVT_BUTTON, self.on_btn_delete)
+        self.btn_backup.Bind(wx.EVT_BUTTON, self.on_backup)
+        self.btn_restore.Bind(wx.EVT_BUTTON, self.on_restore)
+        self.txt_pattern.Bind(wx.EVT_TEXT, self.on_patterntext_change)
+        self.cbo_Index.Bind(wx.EVT_COMBOBOX, self.on_cbo_select)
+        self.grid_wordlist.Bind(wx.EVT_LIST_ITEM_SELECTED, self.on_grid_wordlist)
+        self.grid_wordlist.Bind(
+            wx.EVT_LIST_BEGIN_LABEL_EDIT, self.on_begin_edit_wordlist
+        )
+        self.grid_wordlist.Bind(wx.EVT_LIST_END_LABEL_EDIT, self.on_end_edit_wordlist)
+        self.grid_content.Bind(wx.EVT_LIST_ITEM_SELECTED, self.on_grid_content)
+        self.grid_content.Bind(wx.EVT_LIST_BEGIN_LABEL_EDIT, self.on_begin_edit_content)
+        self.grid_content.Bind(wx.EVT_LIST_END_LABEL_EDIT, self.on_end_edit_content)
+        self.grid_content.Bind(wx.EVT_LEFT_DCLICK, self.on_content_dblclick)
+        self.check_autosave.Bind(wx.EVT_CHECKBOX, self.on_checkbox_autosave)
+
+        self.btn_edit_wordlist_del.Bind(wx.EVT_LEFT_DOWN, self.on_btn_edit_wordlist_del)
+        self.btn_edit_wordlist_edit.Bind(
+            wx.EVT_LEFT_DOWN, self.on_btn_edit_wordlist_edit
+        )
+        self.btn_edit_content_add.Bind(wx.EVT_LEFT_DOWN, self.on_btn_edit_content_add)
+        self.btn_edit_content_del.Bind(wx.EVT_LEFT_DOWN, self.on_btn_edit_content_del)
+        self.btn_edit_content_edit.Bind(wx.EVT_LEFT_DOWN, self.on_btn_edit_content_edit)
+        self.btn_edit_content_paste.Bind(
+            wx.EVT_LEFT_DOWN, self.on_btn_edit_content_paste
+        )
+        self.cbo_index_single.Bind(wx.EVT_COMBOBOX, self.on_single_index)
+        # Key handler for F2
+        self.grid_content.Bind(wx.EVT_CHAR, self.on_key_grid)
+        self.grid_wordlist.Bind(wx.EVT_CHAR, self.on_key_grid)
+
+    def set_parent(self, par_panel):
+        self.parent_panel = par_panel
+
+    def pane_show(self):
+        self.populate_gui()
+        self.grid_wordlist.SetFocus()
 
-    def pane_hide(self, *args):
+    def pane_hide(self):
         pass
 
-    @staticmethod
-    def _name_str(named_obj):
-        try:
-            return named_obj.__name__
-        except AttributeError:
-            return str(named_obj)
+    def autosave(self):
+        if self.check_autosave.GetValue():
+            if self.wlist.default_filename is not None:
+                self.wlist.save_data(self.wlist.default_filename)
+                msg = _("Saved to ") + self.wlist.default_filename
+                self.edit_message(msg)
+
+    def on_key_grid(self, event):
+        grid = event.GetEventObject()
+        key = event.GetKeyCode()
+        if key == wx.WXK_F2:
+            index = grid.GetFirstSelected()
+            if index >= 0:
+                grid.EditLabel(index)
+                # that consumes the key
+                return
+        # Let's make sure the keystroke is processed further
+        event.Skip()
+
+    def on_checkbox_autosave(self, event):
+        self.context.wordlist_autosave = self.check_autosave.GetValue()
+        event.Skip()
 
-    def refresh_spooler_list(self):
-        if not self.update_spooler:
+    def on_btn_edit_wordlist_del(self, event):
+        index = self.grid_wordlist.GetFirstSelected()
+        key = self.get_column_text(self.grid_wordlist, index, 0)
+        if key in self.wlist.prohibited:
+            msg = _("Can't delete internal variable {key}").format(key=key)
+            self.edit_message(msg)
             return
-        try:
-            self.list_job_spool.DeleteAllItems()
-        except RuntimeError:
+        self.wlist.delete(key)
+        self.autosave()
+        self.refresh_grid_wordlist()
+
+    def on_btn_edit_wordlist_edit(self, event):
+        index = self.grid_wordlist.GetFirstSelected()
+        if index >= 0:
+            self.grid_wordlist.EditLabel(index)
+
+    def on_btn_edit_content_add(self, event):
+        skey = self.cur_skey
+        if skey is None:
             return
-        self.queue_entries = []
-        queue_idx = -1
-        for device in self.available_devices:
-            spooler = device.spooler
-            if spooler is None:
-                continue
-            if self.filter_device is not None and self.filter_device != device.label:
-                continue
-            for idx, e in enumerate(spooler.queue):
-                self.queue_entries.append([spooler, idx])
-                queue_idx += 1
-                # Idx, Status, Type, Passes, Priority, Runtime, Estimate
-                m = self.list_job_spool.InsertItem(idx, f"#{idx}")
-                list_id = m
-                spool_obj = e
-
-                if list_id != -1:
-                    self.list_job_spool.SetItemData(list_id, queue_idx)
-                    # DEVICE
-                    self.list_job_spool.SetItem(list_id, JC_DEVICE, device.label)
-                    # Jobname
-                    to_display = ""
-                    if hasattr(spool_obj, "label"):
-                        to_display = spool_obj.label
-                        if to_display is None:
-                            to_display = ""
-                    if to_display == "":
-                        to_display = SpoolerPanel._name_str(spool_obj)
-                    if to_display.endswith(" items"):
-                        # Look for last ':' and remove everything from there
-                        cpos = -1
-                        lpos = -1
-                        while True:
-                            lpos = to_display.find(":", lpos + 1)
-                            if lpos == -1:
-                                break
-                            cpos = lpos
-                        if cpos > 0:
-                            to_display = to_display[:cpos]
-
-                    self.list_job_spool.SetItem(list_id, JC_JOBNAME, to_display)
-                    # Entries
-                    joblen = 1
-                    try:
-                        if hasattr(spool_obj, "items"):
-                            joblen = len(spool_obj.items)
-                        elif hasattr(spool_obj, "elements"):
-                            joblen = len(spool_obj.elements)
-                    except AttributeError:
-                        joblen = 1
-                    self.list_job_spool.SetItem(list_id, JC_ENTRIES, str(joblen))
-                    # STATUS
-                    # try:
-                    status = spool_obj.status
-                    # except AttributeError:
-                    # status = _("Queued")
-                    self.list_job_spool.SetItem(list_id, JC_STATUS, str(status))
-
-                    # TYPE
-                    try:
-                        self.list_job_spool.SetItem(
-                            list_id,
-                            JC_TYPE,
-                            str(spool_obj.__class__.__name__),
-                        )
-                    except AttributeError:
-                        pass
-
-                    # STEPS
-                    try:
-                        self.list_job_spool.SetItem(
-                            list_id,
-                            JC_STEPS,
-                            f"{spool_obj.steps_done}/{spool_obj.steps_total}",
-                        )
-                    except AttributeError:
-                        self.list_job_spool.SetItem(list_id, JC_STEPS, "-")
-                    # PASSES
-                    try:
-                        loop = spool_obj.loops_executed
-                        total = spool_obj.loops
-
-                        if isinf(total):
-                            total = ""
-                        self.list_job_spool.SetItem(
-                            list_id, JC_PASSES, f"{loop}/{total}"
-                        )
-                    except AttributeError:
-                        self.list_job_spool.SetItem(list_id, JC_PASSES, "-")
-
-                    # Priority
-                    try:
-                        self.list_job_spool.SetItem(
-                            list_id,
-                            JC_PRIORITY,
-                            str(spool_obj.priority),
-                        )
-                    except AttributeError:
-                        self.list_job_spool.SetItem(list_id, JC_PRIORITY, "-")
-
-                    # Runtime
-                    try:
-                        t = spool_obj.elapsed_time()
-                        hours, remainder = divmod(t, 3600)
-                        minutes, seconds = divmod(remainder, 60)
-                        runtime = f"{int(hours)}:{str(int(minutes)).zfill(2)}:{str(int(seconds)).zfill(2)}"
-                        self.list_job_spool.SetItem(list_id, JC_RUNTIME, runtime)
-                    except AttributeError:
-                        self.list_job_spool.SetItem(list_id, JC_RUNTIME, "-")
-
-                    # Estimate Time
-                    try:
-                        t = spool_obj.estimate_time()
-                        if isinf(t):
-                            runtime = ""
-                        else:
-                            hours, remainder = divmod(t, 3600)
-                            minutes, seconds = divmod(remainder, 60)
-                            runtime = f"{int(hours)}:{str(int(minutes)).zfill(2)}:{str(int(seconds)).zfill(2)}"
-                        self.list_job_spool.SetItem(list_id, JC_ESTIMATE, runtime)
-                    except AttributeError:
-                        self.list_job_spool.SetItem(list_id, JC_ESTIMATE, "-")
-        self._last_invokation = time.time()
-
-    @staticmethod
-    def timestr(t, oneday):
-        if t is None:
-            return ""
-        if isinstance(t, str):
-            return t
-        if isinf(t) or isnan(t) or t < 0:
-            return ""
-
-        if oneday:
-            localt = time.localtime(t)
-            hours = localt[3]
-            minutes = localt[4]
-            seconds = localt[5]
-        else:
-            hours, remainder = divmod(t, 3600)
-            minutes, seconds = divmod(remainder, 60)
-        result = (
-            f"{int(hours)}:{str(int(minutes)).zfill(2)}:{str(int(seconds)).zfill(2)}"
-        )
-        return result
+        self.wlist.add_value(self.cur_skey, "---", 0)
+        self.refresh_grid_content(skey, 0)
+        self.autosave()
+
+    def on_btn_edit_content_del(self, event):
+        skey = self.cur_skey
+        if skey is None:
+            return
+        index = self.grid_content.GetFirstSelected()
+        if index >= 0:
+            pass
+        self.wlist.delete_value(skey, index)
+        self.refresh_grid_content(skey, 0)
+        self.autosave()
+
+    def on_btn_edit_content_edit(self, event):
+        skey = self.cur_skey
+        if skey is None:
+            return
+        index = self.grid_content.GetFirstSelected()
+        if index >= 0:
+            self.cur_index = index
+            self.grid_content.EditLabel(self.cur_index)
+
+    def on_btn_edit_content_paste(self, event):
+        skey = self.cur_skey
+        if skey is None:
+            return
+        text_data = wx.TextDataObject()
+        if wx.TheClipboard.Open():
+            success = wx.TheClipboard.GetData(text_data)
+            wx.TheClipboard.Close()
+        if success:
+            msg = text_data.GetText()
+            if msg is not None and len(msg) > 0:
+                lines = msg.splitlines()
+                for entry in lines:
+                    self.wlist.add_value(skey, entry, 0)
+                self.refresh_grid_content(skey, 0)
+                self.autosave()
+
+    def refresh_grid_wordlist(self):
+        self.current_entry = None
+        self.grid_wordlist.ClearAll()
+        self.cur_skey = None
+        self.grid_wordlist.InsertColumn(0, _("Name"))
+        self.grid_wordlist.InsertColumn(1, _("Type"))
+        self.grid_wordlist.InsertColumn(2, _("Index"))
+        typestr = [_("Text"), _("CSV"), _("Counter")]
+        for skey in self.wlist.content:
+            index = self.grid_wordlist.InsertItem(
+                self.grid_wordlist.GetItemCount(), skey
+            )
+            self.grid_wordlist.SetItem(index, 1, typestr[self.wlist.content[skey][0]])
+            self.grid_wordlist.SetItem(index, 2, str(self.wlist.content[skey][1] - 2))
+        self.grid_wordlist.SetColumnWidth(0, wx.LIST_AUTOSIZE)
+        self.grid_wordlist.SetColumnWidth(1, wx.LIST_AUTOSIZE_USEHEADER)
+        self.grid_wordlist.SetColumnWidth(2, wx.LIST_AUTOSIZE_USEHEADER)
+
+    def get_column_text(self, grid, index, col):
+        item = grid.GetItem(index, col)
+        return item.GetText()
+
+    def set_column_text(self, grid, index, col, value):
+        # item = grid.GetItem(index)
+        grid.SetItem(index, col, value)
+
+    def refresh_grid_content(self, skey, current):
+        self.cbo_index_single.Clear()
+        choices = []
+        selidx = 0
+        self.grid_content.ClearAll()
+        self.cur_skey = skey.lower()
+        self.cur_index = None
+        self.grid_content.InsertColumn(0, _("Content"))
+
+        for idx in range(2, len(self.wlist.content[skey])):
+            myidx = idx - 2
+            s_entry = str(self.wlist.content[skey][idx])
+            choices.append(f"{myidx:3d} - {s_entry[:10]}")
+            index = self.grid_content.InsertItem(
+                self.grid_content.GetItemCount(), s_entry
+            )
+            if idx == current + 2:
+                selidx = current
+                self.grid_content.SetItemTextColour(index, wx.RED)
+        wsize = self.grid_content.GetSize()
+        self.grid_content.SetColumnWidth(0, wsize[0] - 10)
+        self.cbo_index_single.Set(choices)
+        if selidx >= 0:
+            self.cbo_index_single.SetSelection(selidx)
+
+    def on_single_index(self, event):
+        skey = self.cur_skey
+        idx = self.cbo_index_single.GetSelection()
+        if skey is None:
+            return
+        self.wlist.set_index(skey, idx)
+        self.refresh_grid_content(skey, idx)
+        # We need to refresh the main_index_column as well
+        self.set_column_text(self.grid_wordlist, self.current_entry, 2, str(idx))
+
+    def on_grid_wordlist(self, event):
+        current_item = event.Index
+        self.current_entry = current_item
+        skey = self.get_column_text(self.grid_wordlist, current_item, 0).lower()
+        try:
+            current = int(self.get_column_text(self.grid_wordlist, current_item, 2))
+        except ValueError:
+            current = 0
 
-    @staticmethod
-    def datestr(t):
-        if t is None:
-            return ""
-        if isinstance(t, str):
-            return t
-        localt = time.localtime(t)
-        lyear = localt[0]
-        lmonth = int(localt[1])
-        lday = localt[2]
-        lhour = localt[3]
-        lminute = localt[4]
-        lsecond = localt[5]
-        # wx.DateTime has a bug: it does always provide the dateformat
-        # string with a month representation one number too high, so
-        # wx.DateTime(31,01,1999)
-        # Arbitrary but with different figures
-        # Alas this is the only simple method to get locale relevant dateformat...
-        wxdt = wx.DateTime(31, 7, 2022)
-        pattern = wxdt.FormatDate()
-        pattern = pattern.replace("2022", "{yy}")
-        pattern = pattern.replace("22", "{yy}")
-        pattern = pattern.replace("31", "{dd}")
-        # That would be the right thing, so if the bug is ever fixed, that will work
-        pattern = pattern.replace("07", "{mm}")
-        pattern = pattern.replace("7", "{mm}")
-        # And this is needed to deal with the bug...
-        pattern = pattern.replace("08", "{mm}")
-        pattern = pattern.replace("8", "{mm}")
-        result = pattern.format(
-            dd=str(lday).zfill(2), mm=str(lmonth).zfill(2), yy=str(lyear).zfill(2)
-        )
-        # Just to show the bug...
-        # result1 = f"{int(lday)}.{str(int(lmonth)).zfill(2)}.{str(int(lyear)).zfill(2)}"
-        # wxdt = wx.DateTime(lday, lmonth, lyear, lhour, lminute, lsecond)
-        # result2 = wxdt.FormatDate()
-        # print(f"res={result}, wxd={result2}, manual={result1}, pattern={pattern}")
-        return result
-
-    def refresh_history(self):
-        self.list_job_history.DeleteAllItems()
-        self.map_item_key.clear()
-        if self.filter_device:
-            if self.context.spool_ignore_helper_jobs:
-                events = self.context.logging.matching_events(
-                    "job", device=self.filter_device, important=True
-                )
-            else:
-                events = self.context.logging.matching_events(
-                    "job", device=self.filter_device
-                )
+        self.refresh_grid_content(skey, current)
+        self.txt_pattern.SetValue(skey)
+        event.Skip()
 
-        else:
-            if self.context.spool_ignore_helper_jobs:
-                events = self.context.logging.matching_events("job", important=True)
-            else:
-                events = self.context.logging.matching_events("job")
-        for idx, event_and_key in enumerate(reversed(list(events))):
-            key, info = event_and_key
-            list_id = self.list_job_history.InsertItem(
-                self.list_job_history.GetItemCount(), f"#{idx}"
-            )
-            self.map_item_key[list_id] = key
-            start_time = info.get("start_time", 0)
-            if start_time is None:
-                start_time = 0
-            duration = info.get("duration", 0)
-            if duration is None:
-                duration = 0
-            self.list_job_history.SetItem(list_id, HC_JOBNAME, str(info.get("label")))
-            self.list_job_history.SetItem(
-                list_id,
-                HC_START,
-                f"{self.datestr(start_time)} {self.timestr(start_time, True)}",
-            )
+    def on_content_dblclick(self, event):
+        index = self.grid_content.GetFirstSelected()
+        if index >= 0:
+            self.cbo_index_single.SetSelection(index)
+            self.on_single_index(event)
 
-            self.list_job_history.SetItem(
-                list_id,
-                HC_END,
-                self.timestr(start_time + duration, True),
-            )
-            self.list_job_history.SetItem(
-                list_id,
-                HC_RUNTIME,
-                self.timestr(duration, False),
-            )
-            self.list_job_history.SetItem(
-                list_id,
-                HC_PASSES,
-                str(info.get("loops_total")),
-            )
-            self.list_job_history.SetItem(list_id, HC_DEVICE, str(info.get("device")))
-            self.list_job_history.SetItem(
-                list_id, HC_STATUS, str(info.get("status", ""))
-            )
-            self.list_job_history.SetItem(
-                list_id, HC_JOBINFO, str(info.get("info", ""))
-            )
-            self.list_job_history.SetItem(
-                list_id,
-                HC_ESTIMATE,
-                self.timestr(info.get("estimate", 0), False),
-            )
-            self.list_job_history.SetItem(
-                list_id,
-                HC_STEPS,
-                f"{info.get('steps_done',0)}/{info.get('steps_total',0)}",
-            )
-            self.list_job_history.SetItemData(list_id, idx)
+    def on_grid_content(self, event):
+        # Single Click
+        event.Skip()
 
-    def before_history_update(self, event):
-        list_id = event.GetIndex()  # Get the current row
-        col_id = event.GetColumn()  # Get the current column
-        if col_id == HC_JOBINFO:
-            event.Allow()
+    def on_begin_edit_wordlist(self, event):
+        index = self.grid_wordlist.GetFirstSelected()
+        if index >= 0:
+            # Is this a prevented value?
+            skey = self.get_column_text(self.grid_wordlist, index, 0)
+            self.to_save_wordlist = (skey, 0)
+            if skey in self.wlist.prohibited:
+                msg = _("Can't rename internal variable {key}").format(key=skey)
+                self.edit_message(msg)
+                self.to_save_wordlist = None
+                event.Veto()
+                return
+        event.Allow()
+
+    def on_end_edit_wordlist(self, event):
+        if self.to_save_wordlist is None:
+            self.edit_message(_("Update failed"))
         else:
-            event.Veto()
+            skey = self.to_save_wordlist[0]
+            value = event.GetText().lower()
+            # We need to replace it...
+            self.wlist.rename_key(skey, value)
+            self.autosave()
+            self.cur_skey = value
+            self.refresh_grid_content(value, 0)
+            self.txt_pattern.SetValue(value)
+
+        self.to_save_wordlist = None
+        event.Allow()
+
+    def on_begin_edit_content(self, event):
+        index = self.grid_content.GetFirstSelected()
+        if index >= 0:
+            self.cur_index = index
+        self.to_save_content = (self.cur_skey, self.cur_index)
+        event.Allow()
+
+    def on_end_edit_content(self, event):
+        if self.to_save_content is None:
+            self.edit_message(_("Update failed"))
+        else:
+            skey = self.to_save_content[0]
+            index = self.to_save_content[1]
+            value = event.GetText()
+            self.wlist.set_value(skey, value, index)
+            self.autosave()
+        self.to_save_content = None
+        event.Allow()
+
+    def populate_gui(self):
+        self.cbo_Index.Clear()
+        self.cbo_Index.Enable(False)
+        maxidx = -1
+        self.grid_content.ClearAll()
+        self.refresh_grid_wordlist()
+        for skey in self.wlist.content:
+            if self.wlist.content[skey][0] == 1:  # CSV
+                i = len(self.wlist.content[skey]) - 2
+                if i > maxidx:
+                    maxidx = i
+        if maxidx >= 0:
+            for i in range(maxidx):
+                self.cbo_Index.Append(str(i))
+            self.cbo_Index.SetValue("0")
+        self.cbo_Index.Enable(True)
+        # Lets refresh the scene to acknowledge new changes
+        self.context.signal("refresh_scene", "Scene")
+
+    def edit_message(self, text):
+        self.lbl_message.Label = text
+        self.lbl_message.Refresh()
 
-    def on_history_update(self, event):
-        list_id = event.GetIndex()  # Get the current row
-        col_id = event.GetColumn()  # Get the current column
-        new_data = event.GetLabel()  # Get the changed data
-        if list_id >= 0 and col_id == HC_JOBINFO:
-            idx = self.list_job_history.GetItemData(list_id)
-            key = self.map_item_key[idx]
-            self.context.logging.logs[key]["info"] = new_data
-
-            # Set the new data in the listctrl
-            self.list_job_history.SetItem(list_id, col_id, new_data)
-
-    def set_pause_color(self):
-        new_color = None
-        new_caption = _("Pause")
+    def on_cbo_select(self, event):
         try:
-            if self.context.device.driver.paused:
-                new_color = wx.YELLOW
-                new_caption = _("Resume")
-        except AttributeError:
-            pass
-        self.button_pause.SetBackgroundColour(new_color)
-        self.button_pause.SetLabelText(new_caption)
+            idx = int(self.cbo_Index.GetValue())
+        except ValueError:
+            idx = 0
+        self.wlist.set_index(skey="@all", idx=idx)
+        selidx = self.grid_wordlist.GetFirstSelected()
+        if selidx < 0:
+            selidx = 0
+        self.refresh_grid_wordlist()
+        self.grid_wordlist.Select(selidx, True)
+        self.autosave()
+
+    def on_btn_add(self, event):
+        skey = self.txt_pattern.GetValue()
+        if skey is not None and len(skey) > 0:
+            if skey in self.wlist.content:
+                self.wlist.delete(skey)
+            self.wlist.add_value(skey, "---", 0)
+            self.autosave()
+            self.populate_gui()
+        event.Skip()
 
-    @signal_listener("pause")
-    def on_device_pause_toggle(self, origin, *args):
-        self.set_pause_color()
-
-    @signal_listener("activate;device")
-    def on_activate_device(self, origin, device):
-        self.available_devices = self.context.kernel.services("device")
-        self.selected_device = self.context.device
-        index = -1
-        for i, s in enumerate(self.available_devices):
-            if s is self.selected_device:
-                index = i + 1
-                break
-        spools = [s.label for s in self.available_devices]
-        spools.insert(0, _("-- All available devices --"))
-        # This might not be relevant if you have a stable device set, but there might always be
-        # changes to add / rename devices etc.
-        if self.combo_device.GetSelection() == 0:
-            # all-devices is a superset of any device, so we can leave it...
-            index = 0
-        self.combo_device.Clear()
-        self.combo_device.SetItems(spools)
-        self.combo_device.SetSelection(index)
-        self.on_combo_device(None)
-        self.set_pause_color()
-
-    @signal_listener("spooler;completed")
-    def on_spooler_completed(self, origin, *args):
-        self.refresh_history()
-
-    @signal_listener("spooler;queue")
-    @signal_listener("spooler;idle")
-    @signal_listener("spooler;realtime")
-    def on_spooler_update(self, origin, value, *args, **kwargs):
-        self.update_spooler = True
-        self.refresh_spooler_list()
-
-    @signal_listener("driver;position")
-    @signal_listener("emulator;position")
-    def on_device_update(self, origin, pos):
-        # Only update every 2 seconds or so
-        dtime = time.time()
-        if dtime - self._last_invokation < 2:
-            return
-        # Two things (at least) could go wrong:
-        # 1) You are in the wrong queue, ie there's a job running in the background a
-        #    that provides an update but the user has changed the device so a different
-        #    queue is selected
-        # 2) As this is a signal it may come later, ie the job has already finished
-        #
-        # The checks here are rather basic and need to be revisited
-        refresh_needed = False
-        try:
-            listctrl = self.list_job_spool
-        except RuntimeError:
-            return
-        self._last_invokation = dtime
-        for list_id, entry in enumerate(self.queue_entries):
-            spooler = entry[0]
-            qindex = entry[1]
-            if qindex >= len(spooler.queue):
-                # This item is nowhere to be found
-                refresh_needed = True
-                continue
-            spool_obj = spooler.queue[qindex]
-            try:
-                t = spool_obj.elapsed_time()
-                hours, remainder = divmod(t, 3600)
-                minutes, seconds = divmod(remainder, 60)
-                runtime = f"{int(hours)}:{str(int(minutes)).zfill(2)}:{str(int(seconds)).zfill(2)}"
-                if list_id < self.list_job_spool.GetItemCount():
-                    self.list_job_spool.SetItem(list_id, JC_RUNTIME, runtime)
-            except (AttributeError, AssertionError):
-                if list_id < self.list_job_spool.GetItemCount():
-                    self.list_job_spool.SetItem(list_id, JC_RUNTIME, "-")
-                else:
-                    refresh_needed = True
+    def on_patterntext_change(self, event):
+        enab1 = False
+        enab2 = False
+        newname = self.txt_pattern.GetValue().lower()
+        if len(newname) > 0:
+            enab2 = True
+            enab1 = True
+            if newname in self.wlist.content:
+                enab1 = False
+        self.btn_add.Enable(enab1)
+        self.btn_add_counter.Enable(enab1)
+        self.btn_delete.Enable(enab2)
+
+    def on_add_counter(self, event):  # wxGlade: editWordlist.<event_handler>
+        skey = self.txt_pattern.GetValue()
+        if skey is not None and len(skey) > 0:
+            if skey in self.wlist.content:
+                self.wlist.delete(skey)
+            self.wlist.add_value(skey, 1, 2)
+            self.autosave()
+        self.populate_gui()
+        event.Skip()
 
-            try:
-                pass_str = f"{spool_obj.steps_done}/{spool_obj.steps_total}"
-                self.list_job_spool.SetItem(list_id, JC_STEPS, pass_str)
-            except AttributeError:
-                if list_id < self.list_job_spool.GetItemCount():
-                    self.list_job_spool.SetItem(list_id, JC_STEPS, "-")
-                else:
-                    refresh_needed = True
-            try:
-                loop = spool_obj.loops_executed
-                total = spool_obj.loops
+    def on_btn_delete(self, event):
+        skey = self.txt_pattern.GetValue()
+        if skey is not None and len(skey) > 0:
+            self.wlist.delete(skey)
+            self.autosave()
+            self.populate_gui()
+        event.Skip()
+
+    def on_backup(self, event):
+        if self.wlist.default_filename is not None:
+            self.wlist.save_data(self.wlist.default_filename)
+            msg = _("Saved to ") + self.wlist.default_filename
+            self.edit_message(msg)
+        event.Skip()
+
+    def on_restore(self, event):
+        if self.wlist.default_filename is not None:
+            self.wlist.load_data(self.wlist.default_filename)
+            msg = _("Loaded from ") + self.wlist.default_filename
+            self.edit_message(msg)
+            self.populate_gui()
+        event.Skip()
 
-                if isinf(total):
-                    total = ""
-                pass_str = f"{loop}/{total}"
-                self.list_job_spool.SetItem(list_id, JC_PASSES, pass_str)
-            except AttributeError:
-                if list_id < self.list_job_spool.GetItemCount():
-                    self.list_job_spool.SetItem(list_id, JC_PASSES, "-")
-                else:
-                    refresh_needed = True
+    @signal_listener("wordlist")
+    def signal_wordlist(self, origin, *args):
+        self.autosave()
+        self.refresh_grid_wordlist()
 
-            # Estimate Time
+
+class ImportPanel(wx.Panel):
+    def __init__(self, *args, context=None, **kwds):
+        kwds["style"] = kwds.get("style", 0) | wx.TAB_TRAVERSAL
+        wx.Panel.__init__(self, *args, **kwds)
+        self.parent_panel = None
+        self.context = context
+        self.wlist = self.context.elements.mywordlist
+        main_sizer = wx.BoxSizer(wx.VERTICAL)
+        info_box = StaticBoxSizer(self, wx.ID_ANY, _("Import CSV"), wx.VERTICAL)
+        sizer_csv = wx.BoxSizer(wx.HORIZONTAL)
+        info_box.Add(sizer_csv, 1, wx.EXPAND, 0)
+
+        label_1 = wx.StaticText(self, wx.ID_ANY, _("Import CSV-File"))
+        sizer_csv.Add(label_1, 0, wx.ALIGN_CENTER_VERTICAL, 0)
+
+        self.txt_filename = wx.TextCtrl(self, wx.ID_ANY, "")
+        sizer_csv.Add(self.txt_filename, 1, wx.ALIGN_CENTER_VERTICAL, 0)
+
+        self.btn_fileDialog = wx.Button(self, wx.ID_ANY, "...")
+        self.btn_fileDialog.SetMinSize((23, 23))
+        sizer_csv.Add(self.btn_fileDialog, 0, wx.ALIGN_CENTER_VERTICAL, 0)
+
+        self.btn_import = wx.Button(self, wx.ID_ANY, _("Import CSV"))
+        sizer_csv.Add(self.btn_import, 0, wx.ALIGN_CENTER_VERTICAL, 0)
+
+        sizer_header = wx.BoxSizer(wx.HORIZONTAL)
+        self.rbox_header = wx.RadioBox(
+            self,
+            wx.ID_ANY,
+            _("What does the first row contain:"),
+            choices=(
+                _("Auto-Detect"),
+                _("Contains Data"),
+                _("Contains Variable-Names"),
+            ),
+            majorDimension=3,
+            style=wx.RA_SPECIFY_COLS,
+        )
+        self.rbox_header.SetSelection(0)
+        sizer_header.Add(self.rbox_header, 1, wx.EXPAND, 0)
+        info_box.Add(sizer_header, 0, wx.EXPAND)
+
+        self.text_preview = wx.TextCtrl(
+            self, wx.ID_ANY, style=wx.TE_READONLY | wx.TE_MULTILINE
+        )
+
+        main_sizer.Add(info_box, 0, wx.EXPAND, 0)
+        main_sizer.Add(self.text_preview, 1, wx.EXPAND, 0)
+        self.SetSizer(main_sizer)
+        self.Layout()
+        self.btn_fileDialog.Bind(wx.EVT_BUTTON, self.on_btn_file)
+        self.btn_import.Bind(wx.EVT_BUTTON, self.on_btn_import)
+        self.txt_filename.Bind(wx.EVT_TEXT, self.on_filetext_change)
+        self.btn_import.Enable(False)
+
+    def set_parent(self, par_panel):
+        self.parent_panel = par_panel
+
+    def on_btn_file(self, event):
+        myfile = ""
+        mydlg = wx.FileDialog(
+            self,
+            message=_("Choose a csv-file"),
+            wildcard="CSV-Files (*.csv)|*.csv|Text files (*.txt)|*.txt|All files (*.*)|*.*",
+            style=wx.FD_OPEN | wx.FD_FILE_MUST_EXIST | wx.FD_PREVIEW,
+        )
+        if mydlg.ShowModal() == wx.ID_OK:
+            # This returns a Python list of files that were selected.
+            myfile = mydlg.GetPath()
+        mydlg.Destroy()
+        if myfile != "":
+            self.txt_filename.SetValue(myfile)
+            # self.on_btn_import(None)
+
+    def import_csv(self, myfile):
+        if os.path.exists(myfile):
+            self.txt_filename.SetValue(myfile)
+            force_header = None
+            if self.rbox_header.GetSelection() == 1:
+                force_header = False
+            elif self.rbox_header.GetSelection() == 2:
+                force_header = True
+            ct, colcount, headers = self.wlist.load_csv_file(
+                myfile, force_header=force_header
+            )
+            msg = _("Imported file, {col} fields, {row} rows").format(
+                col=colcount, row=ct
+            )
+            if self.parent_panel is not None:
+                self.parent_panel.edit_message(msg)
+                self.parent_panel.populate_gui()
+            return True
+        return False
+
+    def on_btn_import(self, event):
+        myfile = self.txt_filename.GetValue()
+        if os.path.exists(myfile):
+            force_header = None
+            if self.rbox_header.GetSelection() == 1:
+                force_header = False
+            elif self.rbox_header.GetSelection() == 2:
+                force_header = True
+            ct, colcount, headers = self.wlist.load_csv_file(
+                myfile, force_header=force_header
+            )
+            msg = _("Imported file, {col} fields, {row} rows").format(
+                col=colcount, row=ct
+            )
+            if self.parent_panel is not None:
+                self.parent_panel.edit_message(msg)
+                self.parent_panel.populate_gui()
+
+    def on_filetext_change(self, event):
+        myfile = self.txt_filename.GetValue()
+        enab = False
+        if os.path.exists(myfile):
+            enab = True
+        self.btn_import.Enable(enab)
+        self.preview_it()
+
+    def preview_it(self):
+        filename = self.txt_filename.GetValue()
+        buffer = ""
+        if os.path.exists(filename):
             try:
-                t = spool_obj.estimate_time()
-                if isinf(t):
-                    runtime = ""
-                else:
-                    hours, remainder = divmod(t, 3600)
-                    minutes, seconds = divmod(remainder, 60)
-                    runtime = f"{int(hours)}:{str(int(minutes)).zfill(2)}:{str(int(seconds)).zfill(2)}"
-
-                if list_id < self.list_job_spool.GetItemCount():
-                    self.list_job_spool.SetItem(list_id, JC_ESTIMATE, runtime)
-            except (AttributeError, AssertionError):
-                if list_id < self.list_job_spool.GetItemCount():
-                    self.list_job_spool.SetItem(list_id, JC_ESTIMATE, "-")
-                else:
-                    refresh_needed = True
-        if refresh_needed:
-            self.refresh_spooler_list()
-            self.refresh_history()
+                with open(filename, newline="") as csvfile:
+                    buffer = csvfile.read(1024)
+            except (PermissionError, OSError, FileNotFoundError):
+                pass
+        self.text_preview.SetValue(buffer)
 
 
-class JobSpooler(MWindow):
+class AboutPanel(wx.Panel):
+    def __init__(self, *args, context=None, **kwds):
+        kwds["style"] = kwds.get("style", 0) | wx.TAB_TRAVERSAL
+        wx.Panel.__init__(self, *args, **kwds)
+        self.context = context
+        main_sizer = wx.BoxSizer(wx.VERTICAL)
+        info_box = StaticBoxSizer(self, wx.ID_ANY, _("How to use..."), wx.VERTICAL)
+        self.parent_panel = None
+        s = self.context.asset("wordlist_howto")
+        info_label = wx.TextCtrl(
+            self, wx.ID_ANY, value=s, style=wx.TE_READONLY | wx.TE_MULTILINE
+        )
+        font = wx.Font(
+            10,
+            wx.FONTFAMILY_TELETYPE,
+            wx.FONTSTYLE_NORMAL,
+            wx.FONTWEIGHT_NORMAL,
+        )
+        info_label.SetFont(font)
+        info_label.SetBackgroundColour(self.GetBackgroundColour())
+        info_box.Add(info_label, 1, wx.EXPAND, 0)
+        main_sizer.Add(info_box, 1, wx.EXPAND, 0)
+        self.SetSizer(main_sizer)
+        self.Layout()
+
+    def set_parent(self, par_panel):
+        self.parent_panel = par_panel
+
+
+class WordlistEditor(MWindow):
     def __init__(self, *args, **kwds):
-        super().__init__(673, 456, *args, **kwds)
-        selected_device = None
-        if len(args) >= 4 and args[3]:
-            selected_device = args[3]
-        self.panel = SpoolerPanel(
-            self, wx.ID_ANY, context=self.context, selected_device=selected_device
-        )
-        self.add_module_delegate(self.panel)
+        super().__init__(500, 530, *args, **kwds)
+
+        self.panel_editor = WordlistPanel(self, wx.ID_ANY, context=self.context)
+        self.panel_import = ImportPanel(self, wx.ID_ANY, context=self.context)
+        self.panel_about = AboutPanel(self, wx.ID_ANY, context=self.context)
+
+        self.panel_editor.set_parent(self)
+        self.panel_import.set_parent(self)
+        self.panel_about.set_parent(self)
+
         _icon = wx.NullIcon
-        _icon.CopyFromBitmap(icons8_route_50.GetBitmap())
+        _icon.CopyFromBitmap(icons8_curly_brackets_50.GetBitmap())
         self.SetIcon(_icon)
-        self.SetTitle(_("Job Spooler"))
-        self.Layout()
+        self.notebook_main = wx.aui.AuiNotebook(
+            self,
+            -1,
+            style=wx.aui.AUI_NB_TAB_EXTERNAL_MOVE
+            | wx.aui.AUI_NB_SCROLL_BUTTONS
+            | wx.aui.AUI_NB_TAB_SPLIT
+            | wx.aui.AUI_NB_TAB_MOVE,
+        )
+        self.notebook_main.AddPage(self.panel_editor, _("Editing"))
+        self.notebook_main.AddPage(self.panel_import, _("Import/Export"))
+        self.notebook_main.AddPage(self.panel_about, _("How to use"))
+        # begin wxGlade: Keymap.__set_properties
+        self.DragAcceptFiles(True)
+        self.Bind(wx.EVT_DROP_FILES, self.on_drop_file)
+        self.SetTitle(_("Wordlist Editor"))
+
+    def on_drop_file(self, event):
+        """
+        Drop file handler
+        Accepts only a single file drop.
+        """
+        for pathname in event.GetFiles():
+            if self.panel_import.import_csv(pathname):
+                break
+
+    def delegates(self):
+        yield self.panel_editor
+        yield self.panel_import
+        yield self.panel_about
 
     @staticmethod
     def sub_register(kernel):
-        kernel.register("wxpane/JobSpooler", register_panel_spooler)
         kernel.register(
-            "button/control/Spooler",
+            "button/config/Wordlist",
             {
-                "label": _("Spooler"),
-                "icon": icons8_route_50,
-                "tip": _("Opens Spooler Window"),
-                "action": lambda v: kernel.console("window toggle JobSpooler\n"),
-                "priority": -1,
+                "label": _("Wordlist"),
+                "icon": icons8_curly_brackets_50,
+                "tip": _("Manages Wordlist-Entries"),
+                "action": lambda v: kernel.console("window toggle Wordlist\n"),
             },
         )
 
     def window_open(self):
-        self.panel.pane_show()
+        pass
 
     def window_close(self):
-        self.panel.pane_hide()
+        pass
+
+    def edit_message(self, msg):
+        self.panel_editor.edit_message(msg)
+
+    def populate_gui(self):
+        self.panel_editor.populate_gui()
 
     @staticmethod
     def submenu():
-        return ("Burning", "Spooler")
+        # Suppress to avoid double menu-appearance
+        return ("Editing", "Variables + Wordlists", True)
```

#### encoding

```diff
@@ -1 +1 @@
-utf-8
+us-ascii
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/statusbarwidgets/infowidget.py` & `meerk40t-0.8.3000/meerk40t/gui/statusbarwidgets/infowidget.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,14 +1,14 @@
 import time
 from copy import copy
 from math import isinf
 
 import wx
 
-from meerk40t.core.element_types import elem_nodes
+from meerk40t.core.elements.element_types import elem_nodes
 from meerk40t.core.laserjob import LaserJob
 from meerk40t.core.node.node import Node
 from meerk40t.core.units import UNITS_PER_INCH, Length
 from meerk40t.gui.icons import icons8_up_50
 from meerk40t.gui.statusbarwidgets.statusbarwidget import StatusBarWidget
 from meerk40t.svgelements import Color
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/statusbarwidgets/opassignwidget.py` & `meerk40t-0.8.3000/meerk40t/gui/statusbarwidgets/opassignwidget.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 import wx
 
-from meerk40t.core.element_types import op_nodes
+from meerk40t.core.elements.element_types import op_nodes
 from meerk40t.gui.icons import (
     icons8_diagonal_20,
     icons8_direction_20,
     icons8_image_20,
     icons8_laser_beam_20,
     icons8_scatter_plot_20,
     icons8_small_beam_20,
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/statusbarwidgets/selectionwidget.py` & `meerk40t-0.8.3000/meerk40t/gui/statusbarwidgets/selectionwidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/statusbarwidgets/shapepropwidget.py` & `meerk40t-0.8.3000/meerk40t/gui/statusbarwidgets/shapepropwidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/statusbarwidgets/statusbar.py` & `meerk40t-0.8.3000/meerk40t/gui/statusbarwidgets/statusbar.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/statusbarwidgets/statusbarwidget.py` & `meerk40t-0.8.3000/meerk40t/gui/statusbarwidgets/statusbarwidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/statusbarwidgets/strokewidget.py` & `meerk40t-0.8.3000/meerk40t/gui/statusbarwidgets/strokewidget.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,11 @@
 import wx
 
-from ...core.element_types import elem_nodes
+from meerk40t.core.elements.element_types import elem_nodes
+
 from ...core.units import Length
 from .statusbarwidget import StatusBarWidget
 
 _ = wx.GetTranslation
 
 
 class ColorWidget(StatusBarWidget):
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/toolwidgets/circlebrush.py` & `meerk40t-0.8.3000/meerk40t/gui/toolwidgets/circlebrush.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/toolwidgets/toolcircle.py` & `meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolcircle.py`

 * *Files 2% similar despite different names*

```diff
@@ -10,14 +10,15 @@
     RESPONSE_CONSUME,
 )
 from meerk40t.gui.toolwidgets.toolwidget import ToolWidget
 from meerk40t.svgelements import Ellipse
 
 _ = wx.GetTranslation
 
+
 class CircleTool(ToolWidget):
     """
     Circle Drawing Tool.
 
     Adds Circle with click and drag.
     """
 
@@ -66,15 +67,18 @@
                 ellipse = Ellipse(
                     cx=(x1 + x0) / 2.0, cy=(y1 + y0) / 2.0, r=abs(self.p1 - self.p2) / 2
                 )
             bbox = ellipse.bbox()
             if bbox is not None:
 
                 gc.DrawEllipse(bbox[0], bbox[1], bbox[2] - bbox[0], bbox[3] - bbox[1])
-                if abs(bbox[2] - bbox[0]) > 10 * pixel and abs(bbox[3] - bbox[1]) > 10 * pixel:
+                if (
+                    abs(bbox[2] - bbox[0]) > 10 * pixel
+                    and abs(bbox[3] - bbox[1]) > 10 * pixel
+                ):
                     ccx = (bbox[0] + bbox[2]) / 2
                     ccy = (bbox[1] + bbox[3]) / 2
                     gc.StrokeLine(
                         ccx - 4 * pixel,
                         ccy - 4 * pixel,
                         ccx + 4 * pixel,
                         ccy + 4 * pixel,
@@ -106,24 +110,28 @@
         nearest_snap=None,
         modifiers=None,
         keycode=None,
         **kwargs,
     ):
         response = RESPONSE_CHAIN
         update_required = False
-        if modifiers is None or (event_type=="key_up" and "alt" in modifiers) or ("alt" not in modifiers):
+        if (
+            modifiers is None
+            or (event_type == "key_up" and "alt" in modifiers)
+            or ("alt" not in modifiers)
+        ):
             if self.creation_mode != 0:
                 self.creation_mode = 0
                 update_required = True
         else:
             if self.creation_mode != 1:
                 self.creation_mode = 1
                 update_required = True
         if event_type == "leftdown":
-            self.scene.tool_active = True
+            self.scene.pane.tool_active = True
             if nearest_snap is None:
                 self.p1 = complex(space_pos[0], space_pos[1])
             else:
                 self.p1 = complex(nearest_snap[0], nearest_snap[1])
             response = RESPONSE_CONSUME
         elif event_type == "move":
             if self.p1 is not None:
@@ -133,19 +141,19 @@
                     self.p2 = complex(nearest_snap[0], nearest_snap[1])
                 self.scene.request_refresh()
                 response = RESPONSE_CONSUME
         elif event_type == "leftclick":
             # Dear user: that's too quick for my taste - take your time...
             self.p1 = None
             self.p2 = None
-            self.scene.tool_active = False
+            self.scene.pane.tool_active = False
             self.scene.request_refresh()
             response = RESPONSE_ABORT
         elif event_type == "leftup":
-            self.scene.tool_active = False
+            self.scene.pane.tool_active = False
             try:
                 if self.p1 is None:
                     self.scene.request_refresh()
                     self.scene.context.signal("statusmsg", "")
                     response = RESPONSE_ABORT
                     return response
                 if nearest_snap is None:
@@ -201,16 +209,16 @@
             self.scene.request_refresh()
             self.scene.context.signal("statusmsg", "")
             response = RESPONSE_ABORT
         elif event_type == "lost" or (event_type == "key_up" and modifiers == "escape"):
             self.p1 = None
             self.p2 = None
             self.scene.context.signal("statusmsg", "")
-            if self.scene.tool_active:
-                self.scene.tool_active = False
+            if self.scene.pane.tool_active:
+                self.scene.pane.tool_active = False
                 self.scene.request_refresh()
                 response = RESPONSE_CONSUME
             else:
                 response = RESPONSE_CHAIN
         elif update_required:
             self.scene.request_refresh()
             response = RESPONSE_CONSUME
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/toolwidgets/toolcontainer.py` & `meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolcontainer.py`

 * *Files 4% similar despite different names*

```diff
@@ -24,20 +24,20 @@
             tool = args[0]
             self.set_tool(tool)
 
     def set_tool(self, tool):
         if self._active_tool == tool:
             return
         self._active_tool = tool
-        self.scene.tool_active = False
+        self.scene.pane.tool_active = False
         self.remove_all_widgets()
         self.scene.cursor("arrow")
         if tool is not None:
             new_tool = self.scene.context.lookup("tool", tool)
             if new_tool is not None:
                 self.add_widget(0, new_tool(self.scene))
         if tool is None:
             tool = "none"
-        self.scene.active_tool = tool.lower()
+        self.scene.pane.active_tool = tool.lower()
         message = ("tool", tool)
         self.scene.context.signal("tool_changed", message)
         self.scene._signal_widget(self.scene.widget_root, "tool_changed", message)
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/toolwidgets/tooldraw.py` & `meerk40t-0.8.3000/meerk40t/gui/toolwidgets/tooldraw.py`

 * *Files 2% similar despite different names*

```diff
@@ -55,16 +55,16 @@
             if self.series is None:
                 return RESPONSE_DROP
             self.add_point(space_pos[:2])
             self.scene.request_refresh()
             response = RESPONSE_CONSUME
         elif event_type == "lost" or (event_type == "key_up" and modifiers == "escape"):
             self.series = None
-            if self.scene.tool_active:
-                self.scene.tool_active = False
+            if self.scene.pane.tool_active:
+                self.scene.pane.tool_active = False
                 self.scene.request_refresh()
                 response = RESPONSE_CONSUME
             else:
                 response = RESPONSE_CHAIN
         elif event_type == "leftup":
             try:
                 t = Path()
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/toolwidgets/toolellipse.py` & `meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolellipse.py`

 * *Files 2% similar despite different names*

```diff
@@ -8,14 +8,15 @@
     RESPONSE_CONSUME,
 )
 from meerk40t.gui.toolwidgets.toolwidget import ToolWidget
 from meerk40t.svgelements import Ellipse
 
 _ = wx.GetTranslation
 
+
 class EllipseTool(ToolWidget):
     """
     Ellipse Drawing Tool.
 
     Adds Circle with click and drag.
     """
 
@@ -98,24 +99,28 @@
         nearest_snap=None,
         modifiers=None,
         keycode=None,
         **kwargs,
     ):
         response = RESPONSE_CHAIN
         update_required = False
-        if modifiers is None or (event_type=="key_up" and "alt" in modifiers) or ("alt" not in modifiers):
+        if (
+            modifiers is None
+            or (event_type == "key_up" and "alt" in modifiers)
+            or ("alt" not in modifiers)
+        ):
             if self.creation_mode != 0:
                 self.creation_mode = 0
                 update_required = True
         else:
             if self.creation_mode != 1:
                 self.creation_mode = 1
                 update_required = True
         if event_type == "leftdown":
-            self.scene.tool_active = True
+            self.scene.pane.tool_active = True
             if nearest_snap is None:
                 self.p1 = complex(space_pos[0], space_pos[1])
             else:
                 self.p1 = complex(nearest_snap[0], nearest_snap[1])
             response = RESPONSE_CONSUME
         elif event_type == "move":
             if self.p1 is not None:
@@ -125,19 +130,19 @@
                     self.p2 = complex(nearest_snap[0], nearest_snap[1])
                 self.scene.request_refresh()
                 response = RESPONSE_CONSUME
         elif event_type == "leftclick":
             # Dear user: that's too quick for my taste - take your time...
             self.p1 = None
             self.p2 = None
-            self.scene.tool_active = False
+            self.scene.pane.tool_active = False
             self.scene.request_refresh()
             response = RESPONSE_ABORT
         elif event_type == "leftup":
-            self.scene.tool_active = False
+            self.scene.pane.tool_active = False
             try:
                 if self.p1 is None:
                     return
                 if nearest_snap is None:
                     self.p2 = complex(space_pos[0], space_pos[1])
                 else:
                     self.p2 = complex(nearest_snap[0], nearest_snap[1])
@@ -189,16 +194,16 @@
                 self.p2 = None
             except IndexError:
                 pass
             self.scene.request_refresh()
             self.scene.context.signal("statusmsg", "")
             response = RESPONSE_ABORT
         elif event_type == "lost" or (event_type == "key_up" and modifiers == "escape"):
-            if self.scene.tool_active:
-                self.scene.tool_active = False
+            if self.scene.pane.tool_active:
+                self.scene.pane.tool_active = False
                 self.scene.request_refresh()
                 response = RESPONSE_CONSUME
             else:
                 response = RESPONSE_CHAIN
             self.p1 = None
             self.p2 = None
             self.scene.context.signal("statusmsg", "")
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/toolwidgets/toollinetext.py` & `meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toollinetext.py`

 * *Files 4% similar despite different names*

```diff
@@ -91,26 +91,28 @@
     ):
         def done():
             self.p1 = None
             if self.node is not None:
                 self.node.stroke = self.color
                 self.node.altered()
                 self.node.focus()
-                self.scene.tool_active = False
+                self.scene.pane.tool_active = False
                 self.scene.context.signal("element_property_update", [self.node])
                 self.scene.request_refresh()
             self.node = None
             self.scene.context("tool none\n")
             self.scene.context("window close HersheyFontSelector\n")
             self.scene.context.signal("statusmsg", "")
 
         response = RESPONSE_CHAIN
+        # if event_type == "key_up":
+        #     print (f"Event {event_type}, Key: {keycode}, Modifiers: {modifiers}")
         if event_type == "leftdown":
             if self.p1 is None:
-                self.scene.tool_active = True
+                self.scene.pane.tool_active = True
                 self.scene.animate(self)
                 elements = self.scene.context.elements
                 if elements.default_stroke is None:
                     self.color = Color("black")
                 else:
                     self.color = elements.default_stroke
                 if nearest_snap is None:
@@ -130,42 +132,42 @@
                         "statusmsg",
                         _("Complete text-entry by pressing either Enter or Escape"),
                     )
                     if elements.classify_new:
                         elements.classify([self.node])
                     self.notify_created(self.node)
                     self.node.emphasized = False
-
-                self.scene.context("window open HersheyFontSelector\n")
-                # Refocus, to allow typing...
-                self.scene.gui.scene_panel.SetFocus()
+                    self.scene.context("window open HersheyFontSelector\n")
+                    # Refocus, to allow typing...
+                    self.scene.gui.scene_panel.SetFocus()
+                else:
+                    # Node creation failed!
+                    done()
 
             response = RESPONSE_CONSUME
         elif event_type == "doubleclick":
             done()
             response = RESPONSE_CONSUME
         elif event_type == "rightdown":
             done()
             response = RESPONSE_CONSUME
         elif event_type == "key_up" and modifiers == "escape":
-            if self.scene.tool_active:
+            if self.scene.pane.tool_active:
                 done()
-                # print ("Done - escape")
                 response = RESPONSE_CONSUME
             else:
                 response = RESPONSE_CHAIN
         elif event_type == "key_up" and modifiers == "return":
-            if self.scene.tool_active:
+            if self.scene.pane.tool_active:
                 done()
-                # print ("Done - return")
                 response = RESPONSE_CONSUME
             else:
                 response = RESPONSE_CHAIN
         elif event_type == "key_up":
-            if self.scene.tool_active:
+            if self.scene.pane.tool_active:
                 response = RESPONSE_CONSUME
                 to_add = ""
                 if keycode is not None:
                     to_add = keycode
                 # if modifiers.startswith("shift+") and modifiers != "shift+":
                 #     to_add = modifiers[-1].upper()
                 # elif len(modifiers) == 1:
@@ -175,15 +177,15 @@
                 # elif modifiers == "back":
                 if modifiers == "back":
                     to_add = ""
                     if len(self.vtext) > 0:
                         self.vtext = self.vtext[:-1]
                 if len(to_add) > 0:
                     self.vtext += to_add
-                # print(self.vtext)
+                # print(f"Keyup: {keycode} - {modifiers}: '{self.vtext}'")
                 if self.node is None:
                     x = self.p1.real
                     y = self.p1.imag
                     self.node = create_linetext_node(
                         self.scene.context, x, y, self.vtext
                     )
                 else:
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/toolwidgets/toolmeasure.py` & `meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolmeasure.py`

 * *Files 5% similar despite different names*

```diff
@@ -161,18 +161,18 @@
     ):
         response = RESPONSE_CHAIN
         if event_type == "leftclick":
             if nearest_snap is None:
                 self.point_series.append((space_pos[0], space_pos[1]))
             else:
                 self.point_series.append((nearest_snap[0], nearest_snap[1]))
-            self.scene.tool_active = True
+            self.scene.pane.tool_active = True
             response = RESPONSE_CONSUME
         elif event_type == "leftdown":
-            self.scene.tool_active = True
+            self.scene.pane.tool_active = True
             if nearest_snap is None:
                 self.mouse_position = space_pos[0], space_pos[1]
             else:
                 self.mouse_position = nearest_snap[0], nearest_snap[1]
             if self.point_series:
                 self.scene.request_refresh()
             response = RESPONSE_CONSUME
@@ -181,28 +181,28 @@
                 self.mouse_position = space_pos[0], space_pos[1]
             else:
                 self.mouse_position = nearest_snap[0], nearest_snap[1]
             if self.point_series:
                 self.scene.request_refresh()
                 response = RESPONSE_CONSUME
         elif event_type == "rightdown":
-            self.scene.tool_active = False
+            self.scene.pane.tool_active = False
             self.point_series = []
             self.mouse_position = None
             self.scene.request_refresh()
             response = RESPONSE_ABORT
         elif event_type == "doubleclick":
-            self.scene.tool_active = False
+            self.scene.pane.tool_active = False
             self.point_series = []
             self.mouse_position = None
             self.scene.request_refresh()
             response = RESPONSE_ABORT
         elif event_type == "lost" or (event_type == "key_up" and modifiers == "escape"):
-            if self.scene.tool_active:
-                self.scene.tool_active = False
+            if self.scene.pane.tool_active:
+                self.scene.pane.tool_active = False
                 self.scene.request_refresh()
                 response = RESPONSE_CONSUME
             else:
                 response = RESPONSE_CHAIN
             self.point_series = []
             self.mouse_position = None
         return response
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/toolwidgets/toolnodeedit.py` & `meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolnodeedit.py`

 * *Files 0% similar despite different names*

```diff
@@ -952,16 +952,16 @@
                 ]
                 gc.DrawLines(pattern)
 
     def done(self):
         """
         We are done with node editing, so shutdown stuff
         """
-        self.scene.tool_active = False
-        self.scene.modif_active = False
+        self.scene.pane.tool_active = False
+        self.scene.pane.modif_active = False
         self.p1 = None
         self.p2 = None
         self.move_type = "node"
         self.scene.context("tool none\n")
         self.scene.context.signal("statusmsg", "")
         self.scene.context.elements.validate_selected_area()
         self.scene.request_refresh()
@@ -1846,15 +1846,19 @@
             pt1 = self.element.shape.points[idx - 1]
             pt2 = self.element.shape.points[idx]
             newpt = Point(pt2.x + (pt2.x - pt1.x), pt2.y + (pt2.y - pt1.y))
             self.element.shape.points.append(newpt)
             modified = True
         else:
             # path
-            valididx = len(self.element.path) - 1
+            try:
+                valididx = len(self.element.path) - 1
+            except AttributeError:
+                # Shape
+                return
             while valididx >= 0 and isinstance(
                 self.element.path[valididx], (Close, Move)
             ):
                 valididx -= 1
             if valididx >= 0:
                 seg = self.element.path[valididx]
                 pt1 = seg.start
@@ -1897,27 +1901,27 @@
             nearest_snap (tuple, optional): If set the coordinates of the nearest snap point in scene coordinates.
             modifiers (string): If available provides a  list of modifier keys that were pressed (shift, alt, ctrl).
             keycode (string): if available the keyocde that was pressed
 
         Returns:
             Indicator how to proceed with this event after its execution (consume, chain etc)
         """
-        if self.scene.active_tool != "edit":
+        if self.scene.pane.active_tool != "edit":
             return RESPONSE_CHAIN
         # print (f"event: {event_type}, modifiers: '{modifiers}', keycode: '{keycode}'")
         offset = 5
         s = math.sqrt(abs(self.scene.widget_root.scene_widget.matrix.determinant))
         offset /= s
         elements = self.scene.context.elements
         if event_type in ("leftdown", "leftclick"):
             self.pen = wx.Pen()
             self.pen.SetColour(wx.Colour(swizzlecolor(elements.default_stroke)))
             self.pen.SetWidth(25)
-            self.scene.tool_active = True
-            self.scene.modif_active = True
+            self.scene.pane.tool_active = True
+            self.scene.pane.modif_active = True
 
             self.scene.context.signal("statusmsg", self.message)
             self.move_type = "node"
 
             xp = space_pos[0]
             yp = space_pos[1]
             anyselected = False
@@ -1963,14 +1967,16 @@
                     self.selected_index = None
             self.scene.context.signal("nodeedit", (self.node_type, anyselected))
             if self.selected_index is None:
                 if event_type == "leftclick":
                     # Have we clicked outside the bbox? Then we call it a day...
                     outside = False
                     bb = self.element.bbox()
+                    if bb is None:
+                        return RESPONSE_CONSUME
                     if space_pos[0] < bb[0] or space_pos[0] > bb[2]:
                         outside = True
                     if space_pos[1] < bb[1] or space_pos[1] > bb[3]:
                         outside = True
                     if outside:
                         self.done()
                         return RESPONSE_CONSUME
@@ -2061,20 +2067,20 @@
                         if nextseg is not None and isinstance(nextseg, CubicBezier):
                             self.adjust_midpoint(self.selected_index + 1)
 
                     # self.debug_path()
                 self.modify_element(False)
             return RESPONSE_CONSUME
         elif event_type == "key_down":
-            if not self.scene.tool_active:
+            if not self.scene.pane.tool_active:
                 return RESPONSE_CHAIN
             # print (f"event: {event_type}, modifiers: '{modifiers}', keycode: '{keycode}'")
             return RESPONSE_CONSUME
         elif event_type == "key_up":
-            if not self.scene.tool_active:
+            if not self.scene.pane.tool_active:
                 return RESPONSE_CHAIN
             # print (f"event: {event_type}, modifiers: '{modifiers}', keycode: '{keycode}'")
             if modifiers == "escape":
                 self.done()
                 return RESPONSE_CONSUME
             # print(f"Key: '{keycode}'")
             if not self.selected_index is None:
@@ -2082,15 +2088,15 @@
             else:
                 entry = None
             self.perform_action(keycode)
 
             return RESPONSE_CONSUME
 
         elif event_type == "lost":
-            if self.scene.tool_active:
+            if self.scene.pane.tool_active:
                 self.done()
                 return RESPONSE_CONSUME
             else:
                 return RESPONSE_CHAIN
         elif event_type == "leftup":
             if (
                 self.move_type == "selection"
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/toolwidgets/toolpoint.py` & `meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolpoint.py`

 * *Files 2% similar despite different names*

```diff
@@ -43,14 +43,14 @@
                 fill=elements.default_fill,
             )
             if elements.classify_new:
                 elements.classify([node])
             self.notify_created(node)
             response = RESPONSE_CONSUME
         elif event_type == "lost" or (event_type == "key_up" and modifiers == "escape"):
-            if self.scene.tool_active:
-                self.scene.tool_active = False
+            if self.scene.pane.tool_active:
+                self.scene.pane.tool_active = False
                 self.scene.request_refresh()
                 response = RESPONSE_CONSUME
             else:
                 response = RESPONSE_CHAIN
         return response
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/toolwidgets/toolpolygon.py` & `meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolpolyline.py`

 * *Files 14% similar despite different names*

```diff
@@ -1,34 +1,50 @@
-from math import sqrt
+from math import sqrt, tau
 
 import wx
 
 from meerk40t.core.units import Length
 from meerk40t.gui.laserrender import swizzlecolor
 from meerk40t.gui.scene.sceneconst import (
     RESPONSE_ABORT,
     RESPONSE_CHAIN,
     RESPONSE_CONSUME,
 )
 from meerk40t.gui.toolwidgets.toolwidget import ToolWidget
-from meerk40t.svgelements import Polygon
+from meerk40t.svgelements import Point, Polyline
 
 
-class PolygonTool(ToolWidget):
+class PolylineTool(ToolWidget):
     """
-    Polygon Drawing Tool.
+    Polyline Drawing Tool.
 
-    Adds polygon with clicks.
+    Adds polylines with clicks.
     """
 
     def __init__(self, scene):
         ToolWidget.__init__(self, scene)
         self.start_position = None
         self.point_series = []
         self.mouse_position = None
+        # angle_snap indicates whether a line should be angle snapping
+        # False anything goes, True snaps to next 45 angle
+        self.angle_snap = False
+
+    def angled(self, pos):
+        points = list(self.point_series)
+        if self.angle_snap and len(points):
+            # What is the angle between mouse_pos and the last_position?
+            p1 = Point(points[-1][0], points[-1][1])
+            p2 = Point(pos[0], pos[1])
+            oldangle = p1.angle_to(p2)
+            dist = p1.distance_to(p2)
+            newangle = round(oldangle / tau * 8, 0) / 8 * tau
+            p3 = p1.polar(p1, newangle, dist)
+            pos = [p3.x, p3.y]
+        return pos
 
     def process_draw(self, gc: wx.GraphicsContext):
         if self.point_series:
             elements = self.scene.context.elements
             if elements.default_stroke is None:
                 self.pen.SetColour(wx.BLUE)
             else:
@@ -41,46 +57,67 @@
                     wx.Brush(
                         wx.Colour(swizzlecolor(elements.default_fill)),
                         wx.BRUSHSTYLE_SOLID,
                     )
                 )
             points = list(self.point_series)
             if self.mouse_position is not None:
-                points.append(self.mouse_position)
-            points.append(points[0])
+                pos = self.angled(self.mouse_position)
+                points.append(pos)
             gc.StrokeLines(points)
-            total_len = 0
-            for idx in range(1, len(points)):
-                x0 = points[idx][0]
-                y0 = points[idx][1]
-                x1 = points[idx - 1][0]
-                y1 = points[idx - 1][1]
-                total_len += sqrt((x1 - x0) * (x1 - x0) + (y1 - y0) * (y1 - y0))
-                units = self.scene.context.units_name
-                s = "Pts: {pts}, Len={a}".format(
-                    pts=len(points) - 1,
-                    a=Length(amount=total_len, digits=2, preferred_units=units),
-                )
+            x0 = points[-2][0]
+            y0 = points[-2][1]
+            x1 = points[-1][0]
+            y1 = points[-1][1]
+            units = self.scene.context.units_name
+            s = "Pts: {pts}, to last point: O=({cx}, {cy}), d={a}".format(
+                pts=len(points),
+                cx=Length(amount=x0, digits=2, preferred_units=units),
+                cy=Length(amount=y0, digits=2, preferred_units=units),
+                a=Length(
+                    amount=sqrt((x1 - x0) * (x1 - x0) + (y1 - y0) * (y1 - y0)),
+                    digits=2,
+                    preferred_units=units,
+                ),
+            )
             self.scene.context.signal("statusmsg", s)
 
     def event(
         self,
         window_pos=None,
         space_pos=None,
         event_type=None,
         nearest_snap=None,
         modifiers=None,
         **kwargs,
     ):
         response = RESPONSE_CHAIN
+        update_required = False
+        if (
+            modifiers is None
+            or (event_type == "key_up" and "alt" in modifiers)
+            or ("alt" not in modifiers)
+        ):
+            if self.angle_snap:
+                self.angle_snap = False
+                update_required = True
+        else:
+            if not self.angle_snap:
+                self.angle_snap = True
+                update_required = True
+
         if event_type == "leftclick":
+            self.scene.pane.tool_active = True
             if nearest_snap is None:
-                self.point_series.append((space_pos[0], space_pos[1]))
+                pos = [space_pos[0], space_pos[1]]
             else:
-                self.point_series.append((nearest_snap[0], nearest_snap[1]))
+                pos = [nearest_snap[0], nearest_snap[1]]
+            pos = self.angled(pos)
+            self.point_series.append((pos[0], pos[1]))
+            self.scene.context.signal("statusmsg", "")
             response = RESPONSE_CONSUME
             if (
                 len(self.point_series) > 2
                 and abs(
                     complex(*self.point_series[0]) - complex(*self.point_series[-1])
                 )
                 < 5000
@@ -92,27 +129,22 @@
                 and abs(
                     complex(*self.point_series[-2]) - complex(*self.point_series[-1])
                 )
                 < 5000
             ):
                 self.end_tool()
                 response = RESPONSE_ABORT
-            self.scene.tool_active = True
-            response = RESPONSE_CONSUME
         elif event_type == "rightdown":
             was_already_empty = len(self.point_series) == 0
-            self.scene.tool_active = False
-            self.point_series = []
-            self.mouse_position = None
-            self.scene.request_refresh()
+            self.end_tool()
             if was_already_empty:
                 self.scene.context("tool none\n")
-            response = RESPONSE_ABORT
+            response = RESPONSE_CONSUME
         elif event_type == "leftdown":
-            self.scene.tool_active = True
+            self.scene.pane.tool_active = True
             if nearest_snap is None:
                 self.mouse_position = space_pos[0], space_pos[1]
             else:
                 self.mouse_position = nearest_snap[0], nearest_snap[1]
             if self.point_series:
                 self.scene.request_refresh()
             response = RESPONSE_CONSUME
@@ -124,33 +156,38 @@
             if self.point_series:
                 self.scene.request_refresh()
                 response = RESPONSE_CONSUME
         elif event_type == "doubleclick":
             self.end_tool()
             response = RESPONSE_ABORT
         elif event_type == "lost" or (event_type == "key_up" and modifiers == "escape"):
-            if self.scene.tool_active:
-                self.scene.tool_active = False
+            if self.scene.pane.tool_active:
+                self.scene.pane.tool_active = False
                 self.scene.request_refresh()
                 response = RESPONSE_CONSUME
             else:
                 response = RESPONSE_CHAIN
             self.point_series = []
             self.mouse_position = None
+            self.scene.context.signal("statusmsg", "")
+        elif update_required:
+            self.scene.request_refresh()
+            response = RESPONSE_CONSUME
         return response
 
     def end_tool(self):
-        polyline = Polygon(*self.point_series)
-        elements = self.scene.context.elements
-        node = elements.elem_branch.add(
-            shape=polyline,
-            type="elem polyline",
-            stroke_width=elements.default_strokewidth,
-            stroke=elements.default_stroke,
-            fill=elements.default_fill,
-        )
-        if elements.classify_new:
-            elements.classify([node])
-        self.scene.tool_active = False
+        if len(self.point_series) > 1:
+            polyline = Polyline(*self.point_series)
+            elements = self.scene.context.elements
+            node = elements.elem_branch.add(
+                shape=polyline,
+                type="elem polyline",
+                stroke_width=elements.default_strokewidth,
+                stroke=elements.default_stroke,
+                fill=elements.default_fill,
+            )
+            if elements.classify_new:
+                elements.classify([node])
+            self.notify_created(node)
+        self.scene.pane.tool_active = False
         self.point_series = []
-        self.notify_created(node)
         self.mouse_position = None
```

#### encoding

```diff
@@ -1 +1 @@
-us-ascii
+utf-8
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/toolwidgets/toolpolyline.py` & `meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolvector.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,160 +1,198 @@
-from math import sqrt
+from math import tau
 
 import wx
 
-from meerk40t.core.units import Length
-from meerk40t.gui.laserrender import swizzlecolor
-from meerk40t.gui.scene.sceneconst import (
-    RESPONSE_ABORT,
-    RESPONSE_CHAIN,
-    RESPONSE_CONSUME,
-)
+from meerk40t.gui.scene.sceneconst import RESPONSE_CHAIN, RESPONSE_CONSUME
 from meerk40t.gui.toolwidgets.toolwidget import ToolWidget
-from meerk40t.svgelements import Polyline
+from meerk40t.svgelements import Path, Point
 
+from ..laserrender import LaserRender, swizzlecolor
 
-class PolylineTool(ToolWidget):
+
+class VectorTool(ToolWidget):
     """
-    Polyline Drawing Tool.
+    Path Drawing Tool.
 
-    Adds polylines with clicks.
+    Adds Path with click and drag.
     """
 
     def __init__(self, scene):
         ToolWidget.__init__(self, scene)
         self.start_position = None
-        self.point_series = []
+        self.path = None
         self.mouse_position = None
+        self.render = LaserRender(scene.context)
+        self.c0 = None
+        # angle_snap indicates whether a line should be angle snapping
+        # False anything goes, True snaps to next 45 angle
+        self.angle_snap = False
+
+    def angled(self, pos):
+        if self.angle_snap and self.path:
+            # What is the angle between mouse_pos and the last_position?
+            p1 = self.path.z_point
+            p2 = Point(pos[0], pos[1])
+            oldangle = p1.angle_to(p2)
+            dist = p1.distance_to(p2)
+            newangle = round(oldangle / tau * 8, 0) / 8 * tau
+            p3 = p1.polar(p1, newangle, dist)
+            pos = [p3.x, p3.y]
+        return pos
 
     def process_draw(self, gc: wx.GraphicsContext):
-        if self.point_series:
-            elements = self.scene.context.elements
-            if elements.default_stroke is None:
-                self.pen.SetColour(wx.BLUE)
-            else:
-                self.pen.SetColour(wx.Colour(swizzlecolor(elements.default_stroke)))
+        if self.path:
             gc.SetPen(self.pen)
-            if elements.default_fill is None:
-                gc.SetBrush(wx.TRANSPARENT_BRUSH)
-            else:
-                gc.SetBrush(
-                    wx.Brush(
-                        wx.Colour(swizzlecolor(elements.default_fill)),
-                        wx.BRUSHSTYLE_SOLID,
-                    )
-                )
-            points = list(self.point_series)
+            gc.SetBrush(wx.TRANSPARENT_BRUSH)
+            path = Path(self.path)
             if self.mouse_position is not None:
-                points.append(self.mouse_position)
-            gc.StrokeLines(points)
-            x0 = points[-2][0]
-            y0 = points[-2][1]
-            x1 = points[-1][0]
-            y1 = points[-1][1]
-            units = self.scene.context.units_name
-            s = "Pts: {pts}, to last point: O=({cx}, {cy}), d={a}".format(
-                pts=len(points),
-                cx=Length(amount=x0, digits=2, preferred_units=units),
-                cy=Length(amount=y0, digits=2, preferred_units=units),
-                a=Length(
-                    amount=sqrt((x1 - x0) * (x1 - x0) + (y1 - y0) * (y1 - y0)),
-                    digits=2,
-                    preferred_units=units,
-                ),
-            )
-            self.scene.context.signal("statusmsg", s)
+                if self.c0:
+                    pos = self.mouse_position
+                    path.smooth_cubic(self.c0, pos)
+                else:
+                    pos = self.angled(self.mouse_position)
+                    path.line(pos)
+            gpath = self.render.make_path(gc, path)
+            gc.DrawPath(gpath)
+            del gpath
+            # x0 = points[-2][0]
+            # y0 = points[-2][1]
+            # x1 = points[-1][0]
+            # y1 = points[-1][1]
+            # s = "Pts: {pts}, to last point: O=({cx}, {cy}), d={a}".format(
+            #     pts = len(points),
+            #     cx = Length(amount=x0, digits=2).length_mm,
+            #     cy = Length(amount=y0, digits=2).length_mm,
+            #     a = Length(amount=sqrt((x1-x0)*(x1-x0) + (y1-y0)*(y1-y0)), digits=2).length_mm,
+            # )
+            # self.scene.context.signal("statusmsg", s)
 
     def event(
         self,
         window_pos=None,
         space_pos=None,
         event_type=None,
         nearest_snap=None,
         modifiers=None,
         **kwargs,
     ):
         response = RESPONSE_CHAIN
+        update_required = False
+        if (
+            modifiers is None
+            or (event_type == "key_up" and "alt" in modifiers)
+            or ("alt" not in modifiers)
+        ):
+            if self.angle_snap:
+                self.angle_snap = False
+                update_required = True
+        else:
+            if not self.angle_snap:
+                self.angle_snap = True
+                update_required = True
+
         if event_type == "leftclick":
-            self.scene.tool_active = True
-            if nearest_snap is None:
-                self.point_series.append((space_pos[0], space_pos[1]))
-            else:
-                self.point_series.append((nearest_snap[0], nearest_snap[1]))
-            self.scene.context.signal("statusmsg", "")
+            self.scene.pane.tool_active = True
+            elements = self.scene.context.elements
+            if self.path is None:
+                self.pen = wx.Pen()
+                self.pen.SetColour(wx.Colour(swizzlecolor(elements.default_stroke)))
+                try:
+                    self.pen.SetWidth(elements.default_strokewidth)
+                except TypeError:
+                    self.pen.SetWidth(int(elements.default_strokewidth))
+                self.path = Path()
+                if nearest_snap is None:
+                    self.path.move((space_pos[0], space_pos[1]))
+                else:
+                    self.path.move((nearest_snap[0], nearest_snap[1]))
+            else:
+                if nearest_snap is None:
+                    pos = [space_pos[0], space_pos[1]]
+                else:
+                    pos = [nearest_snap[0], nearest_snap[1]]
+                pos = self.angled(pos)
+                self.path.line((pos[0], pos[1]))
+            self.c0 = None
             response = RESPONSE_CONSUME
-            if (
-                len(self.point_series) > 2
-                and abs(
-                    complex(*self.point_series[0]) - complex(*self.point_series[-1])
-                )
-                < 5000
-            ):
-                self.end_tool()
-                response = RESPONSE_ABORT
-            if (
-                len(self.point_series) > 2
-                and abs(
-                    complex(*self.point_series[-2]) - complex(*self.point_series[-1])
-                )
-                < 5000
-            ):
-                self.end_tool()
-                response = RESPONSE_ABORT
         elif event_type == "rightdown":
-            was_already_empty = len(self.point_series) == 0
-            self.point_series = []
-            self.mouse_position = None
-            self.scene.tool_active = False
-            self.scene.request_refresh()
+            if self.path is None or len(self.path) == 0:
+                was_already_empty = True
+            else:
+                was_already_empty = False
+            self.end_tool()
             if was_already_empty:
                 self.scene.context("tool none\n")
             response = RESPONSE_CONSUME
         elif event_type == "leftdown":
-            self.scene.tool_active = True
+            self.scene.pane.tool_active = True
             if nearest_snap is None:
-                self.mouse_position = space_pos[0], space_pos[1]
+                pos = (space_pos[0], space_pos[1])
             else:
-                self.mouse_position = nearest_snap[0], nearest_snap[1]
-            if self.point_series:
+                pos = (nearest_snap[0], nearest_snap[1])
+            pos = self.angled(pos)
+            self.c0 = (pos[0], pos[1])
+            response = RESPONSE_CONSUME
+        elif event_type == "move":
+            if nearest_snap is None:
+                pos = (space_pos[0], space_pos[1])
+            else:
+                pos = (nearest_snap[0], nearest_snap[1])
+            pos = self.angled(pos)
+            self.c0 = (pos[0], pos[1])
+            if self.path:
                 self.scene.request_refresh()
+                response = RESPONSE_CONSUME
+        elif event_type == "leftup":
+            self.scene.pane.tool_active = False
+            if self.c0 is not None and self.path:
+                self.scene.pane.tool_active = True
+                pos = self.mouse_position
+                self.path.smooth_cubic(self.c0, pos)
+                self.scene.request_refresh()
+            self.c0 = None
+            self.mouse_position = None
+            self.scene.request_refresh()
             response = RESPONSE_CONSUME
-        elif event_type in ("leftup", "move", "hover"):
+        elif event_type == "hover":
             if nearest_snap is None:
                 self.mouse_position = space_pos[0], space_pos[1]
             else:
                 self.mouse_position = nearest_snap[0], nearest_snap[1]
-            if self.point_series:
+            if self.path:
                 self.scene.request_refresh()
-                response = RESPONSE_CONSUME
         elif event_type == "doubleclick":
             self.end_tool()
-            self.scene.context.signal("statusmsg", "")
-            response = RESPONSE_ABORT
+            response = RESPONSE_CONSUME
         elif event_type == "lost" or (event_type == "key_up" and modifiers == "escape"):
-            if self.scene.tool_active:
-                self.scene.tool_active = False
+            if self.scene.pane.tool_active:
+                self.scene.pane.tool_active = False
                 self.scene.request_refresh()
                 response = RESPONSE_CONSUME
             else:
                 response = RESPONSE_CHAIN
-            self.point_series = []
-            self.mouse_position = None
             self.scene.context.signal("statusmsg", "")
+            self.path = None
+        elif update_required:
+            self.scene.request_refresh()
+            response = RESPONSE_CONSUME
         return response
 
     def end_tool(self):
-        polyline = Polyline(*self.point_series)
-        elements = self.scene.context.elements
-        node = elements.elem_branch.add(
-            shape=polyline,
-            type="elem polyline",
-            stroke_width=elements.default_strokewidth,
-            stroke=elements.default_stroke,
-            fill=elements.default_fill,
-        )
-        if elements.classify_new:
-            elements.classify([node])
-        self.scene.tool_active = False
-        self.point_series = []
-        self.notify_created(node)
+        self.scene.pane.tool_active = False
+        t = self.path
+        if t is not None and len(t) > 1:
+            elements = self.scene.context.elements
+            node = elements.elem_branch.add(
+                path=t,
+                type="elem path",
+                stroke_width=elements.default_strokewidth,
+                stroke=elements.default_stroke,
+                fill=elements.default_fill,
+            )
+            if elements.classify_new:
+                elements.classify([node])
+            self.notify_created(node)
+        self.path = None
+        self.scene.context.signal("statusmsg", "")
         self.mouse_position = None
+        self.scene.request_refresh()
```

#### encoding

```diff
@@ -1 +1 @@
-us-ascii
+utf-8
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/toolwidgets/toolrect.py` & `meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolrect.py`

 * *Files 6% similar despite different names*

```diff
@@ -8,14 +8,15 @@
     RESPONSE_CONSUME,
 )
 from meerk40t.gui.toolwidgets.toolwidget import ToolWidget
 from meerk40t.svgelements import Rect
 
 _ = wx.GetTranslation
 
+
 class RectTool(ToolWidget):
     """
     Rectangle Drawing Tool.
 
     Adds Rectangles with click and drag.
     """
 
@@ -95,24 +96,28 @@
         nearest_snap=None,
         modifiers=None,
         keycode=None,
         **kwargs,
     ):
         response = RESPONSE_CHAIN
         update_required = False
-        if modifiers is None or (event_type=="key_up" and "alt" in modifiers) or ("alt" not in modifiers):
+        if (
+            modifiers is None
+            or (event_type == "key_up" and "alt" in modifiers)
+            or ("alt" not in modifiers)
+        ):
             if self.creation_mode != 0:
                 self.creation_mode = 0
                 update_required = True
         else:
             if self.creation_mode != 1:
                 self.creation_mode = 1
                 update_required = True
         if event_type == "leftdown":
-            self.scene.tool_active = True
+            self.scene.pane.tool_active = True
             if nearest_snap is None:
                 self.p1 = complex(space_pos[0], space_pos[1])
             else:
                 self.p1 = complex(nearest_snap[0], nearest_snap[1])
             response = RESPONSE_CONSUME
         elif event_type == "move":
             if self.p1 is not None:
@@ -122,19 +127,19 @@
                     self.p2 = complex(nearest_snap[0], nearest_snap[1])
                 self.scene.request_refresh()
                 response = RESPONSE_CONSUME
         elif event_type == "leftclick":
             # Dear user: that's too quick for my taste - take your time...
             self.p1 = None
             self.p2 = None
-            self.scene.tool_active = False
+            self.scene.pane.tool_active = False
             self.scene.request_refresh()
             response = RESPONSE_ABORT
         elif event_type == "leftup":
-            self.scene.tool_active = False
+            self.scene.pane.tool_active = False
             try:
                 if self.p1 is None:
                     return
                 if nearest_snap is None:
                     self.p2 = complex(space_pos[0], space_pos[1])
                 else:
                     self.p2 = complex(nearest_snap[0], nearest_snap[1])
@@ -179,16 +184,16 @@
                 self.p2 = None
             except IndexError:
                 pass
             self.scene.request_refresh()
             self.scene.context.signal("statusmsg", "")
             response = RESPONSE_ABORT
         elif event_type == "lost" or (event_type == "key_up" and modifiers == "escape"):
-            if self.scene.tool_active:
-                self.scene.tool_active = False
+            if self.scene.pane.tool_active:
+                self.scene.pane.tool_active = False
                 self.scene.request_refresh()
                 response = RESPONSE_CONSUME
             else:
                 response = RESPONSE_CHAIN
             self.p1 = None
             self.p2 = None
             self.scene.context.signal("statusmsg", "")
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/toolwidgets/toolrelocate.py` & `meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolrelocate.py`

 * *Files 4% similar despite different names*

```diff
@@ -30,18 +30,18 @@
         nearest_snap=None,
         modifiers=None,
         **kwargs,
     ):
         # Add snap behaviour
         response = RESPONSE_CHAIN
         if event_type == "leftdown":
-            self.scene.tool_active = True
+            self.scene.pane.tool_active = True
             response = RESPONSE_CONSUME
         elif event_type == "move":
-            if self.scene.tool_active:
+            if self.scene.pane.tool_active:
                 response = RESPONSE_CONSUME
         elif event_type in ("leftup", "leftclick"):
             bed_width = self.scene.context.device.unit_width
             bed_height = self.scene.context.device.unit_height
             if nearest_snap is None:
                 x = space_pos[0]
                 y = space_pos[1]
@@ -57,16 +57,16 @@
                 x = 0
             if y < 0:
                 y = 0
             x /= UNITS_PER_MM
             y /= UNITS_PER_MM
             self.scene.context(f"move_absolute {x}mm {y}mm\n")
             response = RESPONSE_CONSUME
-            self.scene.tool_active = False
+            self.scene.pane.tool_active = False
         elif event_type == "lost" or (event_type == "key_up" and modifiers == "escape"):
-            if self.scene.tool_active:
-                self.scene.tool_active = False
+            if self.scene.pane.tool_active:
+                self.scene.pane.tool_active = False
                 self.scene.request_refresh()
                 response = RESPONSE_CONSUME
             else:
                 response = RESPONSE_CHAIN
         return response
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/toolwidgets/toolribbon.py` & `meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolribbon.py`

 * *Files 2% similar despite different names*

```diff
@@ -80,16 +80,16 @@
             response = RESPONSE_CONSUME
         elif event_type == "move" or event_type == "hover":
             self.last_position = space_pos[:2]
             response = RESPONSE_CONSUME
         elif event_type == "lost" or (event_type == "key_up" and modifiers == "escape"):
             self.stop = True
             self.series.clear()
-            if self.scene.tool_active:
-                self.scene.tool_active = False
+            if self.scene.pane.tool_active:
+                self.scene.pane.tool_active = False
                 self.scene.request_refresh()
                 return RESPONSE_CONSUME
             else:
                 return RESPONSE_CHAIN
         elif event_type == "leftup":
             self.stop = True
             if self.series:
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/toolwidgets/tooltext.py` & `meerk40t-0.8.3000/meerk40t/gui/toolwidgets/tooltext.py`

 * *Files 2% similar despite different names*

```diff
@@ -73,16 +73,16 @@
             self.scene.context.signal("textselect", node)
             # The ugliest hack ever, somewhere the node gets defocussed,
             # so we are trying to bring it back after all the ruckus happened...
             self.last_node_created = node
             wx.CallLater(750, self.refocus_text)
             response = RESPONSE_CONSUME
         elif event_type == "lost" or (event_type == "key_up" and modifiers == "escape"):
-            if self.scene.tool_active:
-                self.scene.tool_active = False
+            if self.scene.pane.tool_active:
+                self.scene.pane.tool_active = False
                 self.scene.request_refresh()
                 response = RESPONSE_CONSUME
             else:
                 response = RESPONSE_CHAIN
         return response
 
     # @staticmethod
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/toolwidgets/toolvector.py` & `meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/togglewidget.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,156 +1,142 @@
 import wx
 
-from meerk40t.gui.scene.sceneconst import RESPONSE_CHAIN, RESPONSE_CONSUME
-from meerk40t.gui.toolwidgets.toolwidget import ToolWidget
-from meerk40t.svgelements import Path
-
-from ..laserrender import LaserRender, swizzlecolor
-
-
-class VectorTool(ToolWidget):
-    """
-    Path Drawing Tool.
-
-    Adds Path with click and drag.
-    """
-
-    def __init__(self, scene):
-        ToolWidget.__init__(self, scene)
-        self.start_position = None
-        self.path = None
-        self.mouse_position = None
-        self.render = LaserRender(scene.context)
-        self.c0 = None
+from meerk40t.gui.scene.sceneconst import (
+    HITCHAIN_DELEGATE_AND_HIT,
+    ORIENTATION_HORIZONTAL,
+    ORIENTATION_VERTICAL,
+    RESPONSE_ABORT,
+)
+from meerk40t.gui.scene.widget import Widget
+from meerk40t.gui.utilitywidgets.buttonwidget import ButtonWidget
+
+_ = wx.GetTranslation
+
+
+class ToggleWidget(Widget):
+    def __init__(self, scene, left, top, right, bottom, bitmap, buttons):
+        Widget.__init__(self, scene, left, top, right, bottom)
+        self.buttons = buttons
+        self.bitmap = bitmap
+        self._opened = False
+        # If we use the tool-menu, how shall
+        self.scene.context.setting(bool, "menu_autohide", True)
+        self.scene.context.setting(bool, "menu_vertical", True)
+        if self.scene.context.menu_vertical:
+            self._orientation = ORIENTATION_VERTICAL
+        else:
+            self._orientation = ORIENTATION_HORIZONTAL
+        self.scene.request_refresh()
+
+    def hit(self):
+        return HITCHAIN_DELEGATE_AND_HIT
 
     def process_draw(self, gc: wx.GraphicsContext):
-        if self.path:
-            gc.SetPen(self.pen)
-            gc.SetBrush(wx.TRANSPARENT_BRUSH)
-            path = Path(self.path)
-            if self.mouse_position is not None:
-                if self.c0:
-                    path.smooth_cubic(self.c0, self.mouse_position)
-                else:
-                    path.line(self.mouse_position)
-            gpath = self.render.make_path(gc, path)
-            gc.DrawPath(gpath)
-            del gpath
-            # x0 = points[-2][0]
-            # y0 = points[-2][1]
-            # x1 = points[-1][0]
-            # y1 = points[-1][1]
-            # s = "Pts: {pts}, to last point: O=({cx}, {cy}), d={a}".format(
-            #     pts = len(points),
-            #     cx = Length(amount=x0, digits=2).length_mm,
-            #     cy = Length(amount=y0, digits=2).length_mm,
-            #     a = Length(amount=sqrt((x1-x0)*(x1-x0) + (y1-y0)*(y1-y0)), digits=2).length_mm,
-            # )
-            # self.scene.context.signal("statusmsg", s)
-
-    def event(
-        self,
-        window_pos=None,
-        space_pos=None,
-        event_type=None,
-        nearest_snap=None,
-        modifiers=None,
-        **kwargs,
-    ):
-        response = RESPONSE_CHAIN
-
-        if event_type == "leftclick":
-            self.scene.tool_active = True
-            elements = self.scene.context.elements
-            if self.path is None:
-                self.pen = wx.Pen()
-                self.pen.SetColour(wx.Colour(swizzlecolor(elements.default_stroke)))
-                try:
-                    self.pen.SetWidth(elements.default_strokewidth)
-                except TypeError:
-                    self.pen.SetWidth(int(elements.default_strokewidth))
-                self.path = Path()
-                if nearest_snap is None:
-                    self.path.move((space_pos[0], space_pos[1]))
-                else:
-                    self.path.move((nearest_snap[0], nearest_snap[1]))
+        gc.PushState()
+        gc.DrawBitmap(self.bitmap, self.left, self.top, self.width, self.height)
+        gc.PopState()
+
+    def event(self, window_pos=None, space_pos=None, event_type=None, **kwargs):
+        if event_type == "leftdown":
+            if self._opened:
+                self.minimize(window_pos=None, space_pos=None)
+                self._opened = False
             else:
-                if nearest_snap is None:
-                    self.path.line((space_pos[0], space_pos[1]))
-                else:
-                    self.path.line((nearest_snap[0], nearest_snap[1]))
-            self.c0 = None
-            response = RESPONSE_CONSUME
+                self.maximize(window_pos=None, space_pos=None)
+                self._opened = True
         elif event_type == "rightdown":
-            if self.path is None or len(self.path) == 0:
-                was_already_empty = True
-            else:
-                was_already_empty = False
-            self.scene.tool_active = False
-            self.path = None
-            self.mouse_position = None
-            self.scene.request_refresh()
-            self.scene.context.signal("statusmsg", "")
-            if was_already_empty:
-                self.scene.context("tool none\n")
-            response = RESPONSE_CONSUME
-        elif event_type == "leftdown":
-            self.scene.tool_active = True
-            if nearest_snap is None:
-                self.c0 = (space_pos[0], space_pos[1])
-            else:
-                self.c0 = (nearest_snap[0], nearest_snap[1])
-            response = RESPONSE_CONSUME
-        elif event_type == "move":
-            if nearest_snap is None:
-                self.c0 = (space_pos[0], space_pos[1])
-            else:
-                self.c0 = (nearest_snap[0], nearest_snap[1])
-            if self.path:
-                self.scene.request_refresh()
-                response = RESPONSE_CONSUME
-        elif event_type == "leftup":
-            self.scene.tool_active = False
-            if self.c0 is not None and self.path:
-                self.scene.tool_active = True
-                self.path.smooth_cubic(self.c0, self.mouse_position)
-                self.scene.request_refresh()
-            self.c0 = None
-            self.mouse_position = None
-            self.scene.request_refresh()
-            response = RESPONSE_CONSUME
-        elif event_type == "hover":
-            if nearest_snap is None:
-                self.mouse_position = space_pos[0], space_pos[1]
-            else:
-                self.mouse_position = nearest_snap[0], nearest_snap[1]
-            if self.path:
-                self.scene.request_refresh()
-        elif event_type == "doubleclick":
-            self.scene.tool_active = False
-            t = self.path
-            if len(t) != 0:
-                elements = self.scene.context.elements
-                node = elements.elem_branch.add(
-                    path=t,
-                    type="elem path",
-                    stroke_width=elements.default_strokewidth,
-                    stroke=elements.default_stroke,
-                    fill=elements.default_fill,
-                )
-                if elements.classify_new:
-                    elements.classify([node])
-                self.notify_created(node)
-            self.path = None
-            self.scene.context.signal("statusmsg", "")
-            self.mouse_position = None
-            response = RESPONSE_CONSUME
-        elif event_type == "lost" or (event_type == "key_up" and modifiers == "escape"):
-            if self.scene.tool_active:
-                self.scene.tool_active = False
-                self.scene.request_refresh()
-                response = RESPONSE_CONSUME
-            else:
-                response = RESPONSE_CHAIN
-            self.scene.context.signal("statusmsg", "")
-            self.path = None
-        return response
+            self.show_options()
+        return RESPONSE_ABORT
+
+    def on_popup_close(self, event):
+        self.hide()
+        self.scene.request_refresh()
+
+    def on_popup_horizontal(self, event):
+        self.scene.context.menu_vertical = False
+        self._orientation = ORIENTATION_HORIZONTAL
+        if self._opened:
+            self.minimize(window_pos=None, space_pos=None)
+            self._opened = False
+            self.maximize(window_pos=None, space_pos=None)
+            self._opened = True
+
+    def on_popup_vertical(self, event):
+        self.scene.context.menu_vertical = True
+        self._orientation = ORIENTATION_VERTICAL
+        if self._opened:
+            self.minimize(window_pos=None, space_pos=None)
+            self._opened = False
+            self.maximize(window_pos=None, space_pos=None)
+            self._opened = True
+
+    def on_popup_autohide(self, event):
+        self.scene.context.menu_autohide = not self.scene.context.menu_autohide
+
+    def show_options(self):
+        menu = wx.Menu()
+        gui = self.scene.context.gui
+        item1 = menu.Append(wx.ID_ANY, _("Close"), "", wx.ITEM_NORMAL)
+        menu.AppendSeparator()
+        item2 = menu.Append(wx.ID_ANY, _("Horizontal"), "", wx.ITEM_CHECK)
+        item3 = menu.Append(wx.ID_ANY, _("Vertical"), "", wx.ITEM_CHECK)
+        menu.AppendSeparator()
+        item4 = menu.Append(wx.ID_ANY, _("Autohide"), "", wx.ITEM_CHECK)
+        item2.Check(not self.scene.context.menu_vertical)
+        item3.Check(self.scene.context.menu_vertical)
+        item4.Check(self.scene.context.menu_autohide)
+        gui.Bind(wx.EVT_MENU, self.on_popup_close, item1)
+        gui.Bind(wx.EVT_MENU, self.on_popup_horizontal, item2)
+        gui.Bind(wx.EVT_MENU, self.on_popup_vertical, item3)
+        gui.Bind(wx.EVT_MENU, self.on_popup_autohide, item4)
+        gui.PopupMenu(menu)
+        menu.Destroy()
+
+    def signal(self, signal, *args, **kwargs):
+        if signal == "tool_changed":
+            if self.scene.context.menu_autohide:
+                if self._opened:
+                    self.minimize(window_pos=None, space_pos=None)
+                    self._opened = False
+        elif signal == "guide":
+            # print ("guide")
+            pass
+
+    def minimize(self, window_pos=None, space_pos=None):
+        self.remove_all_widgets()
+        self.scene.request_refresh()
+
+    def maximize(self, window_pos=None, space_pos=None):
+        new_values = self.scene.context.find(self.buttons)
+        buttons = []
+        for button, name, sname in new_values:
+            buttons.append(button)
+
+        def sort_priority(elem):
+            return elem.get("priority", 0)
+
+        buttons.sort(key=sort_priority)  # Sort buttons by priority
+
+        def clicked(action):
+            def act(*args, **kwargs):
+                action(None)
+
+            return act
+
+        for button in buttons:
+            button_size = self.width
+            resize_param = button.get("size")
+            icon = button["icon"].GetBitmap(resize=button_size, use_theme=False)
+            self.add_widget(
+                -1,
+                ButtonWidget(
+                    self.scene,
+                    0,
+                    0,
+                    button_size,
+                    button_size,
+                    icon,
+                    clicked(button.get("action")),
+                ),
+                self._orientation,
+            )
+        self.scene.request_refresh()
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/toolwidgets/toolwidget.py` & `meerk40t-0.8.3000/meerk40t/gui/toolwidgets/toolwidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/usbconnect.py` & `meerk40t-0.8.3000/meerk40t/gui/usbconnect.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/utilitywidgets/checkboxwidget.py` & `meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/checkboxwidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/utilitywidgets/cyclocycloidwidget.py` & `meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/cyclocycloidwidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/utilitywidgets/seekbarwidget.py` & `meerk40t-0.8.3000/meerk40t/gui/utilitywidgets/seekbarwidget.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/gui/utilitywidgets/togglewidget.py` & `meerk40t-0.8.3000/meerk40t/network/tcp_server.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,142 +1,136 @@
-import wx
+import socket
 
-from meerk40t.gui.scene.sceneconst import (
-    HITCHAIN_DELEGATE_AND_HIT,
-    ORIENTATION_HORIZONTAL,
-    ORIENTATION_VERTICAL,
-    RESPONSE_ABORT,
-)
-from meerk40t.gui.scene.widget import Widget
-from meerk40t.gui.utilitywidgets.buttonwidget import ButtonWidget
-
-_ = wx.GetTranslation
-
-
-class ToggleWidget(Widget):
-    def __init__(self, scene, left, top, right, bottom, bitmap, buttons):
-        Widget.__init__(self, scene, left, top, right, bottom)
-        self.buttons = buttons
-        self.bitmap = bitmap
-        self._opened = False
-        # If we use the tool-menu, how shall
-        self.scene.context.setting(bool, "menu_autohide", True)
-        self.scene.context.setting(bool, "menu_vertical", True)
-        if self.scene.context.menu_vertical:
-            self._orientation = ORIENTATION_VERTICAL
-        else:
-            self._orientation = ORIENTATION_HORIZONTAL
-        self.scene.request_refresh()
-
-    def hit(self):
-        return HITCHAIN_DELEGATE_AND_HIT
-
-    def process_draw(self, gc: wx.GraphicsContext):
-        gc.PushState()
-        gc.DrawBitmap(self.bitmap, self.left, self.top, self.width, self.height)
-        gc.PopState()
-
-    def event(self, window_pos=None, space_pos=None, event_type=None, **kwargs):
-        if event_type == "leftdown":
-            if self._opened:
-                self.minimize(window_pos=None, space_pos=None)
-                self._opened = False
-            else:
-                self.maximize(window_pos=None, space_pos=None)
-                self._opened = True
-        elif event_type == "rightdown":
-            self.show_options()
-        return RESPONSE_ABORT
-
-    def on_popup_close(self, event):
-        self.hide()
-        self.scene.request_refresh()
-
-    def on_popup_horizontal(self, event):
-        self.scene.context.menu_vertical = False
-        self._orientation = ORIENTATION_HORIZONTAL
-        if self._opened:
-            self.minimize(window_pos=None, space_pos=None)
-            self._opened = False
-            self.maximize(window_pos=None, space_pos=None)
-            self._opened = True
-
-    def on_popup_vertical(self, event):
-        self.scene.context.menu_vertical = True
-        self._orientation = ORIENTATION_VERTICAL
-        if self._opened:
-            self.minimize(window_pos=None, space_pos=None)
-            self._opened = False
-            self.maximize(window_pos=None, space_pos=None)
-            self._opened = True
-
-    def on_popup_autohide(self, event):
-        self.scene.context.menu_autohide = not self.scene.context.menu_autohide
-
-    def show_options(self):
-        menu = wx.Menu()
-        gui = self.scene.context.gui
-        item1 = menu.Append(wx.ID_ANY, _("Close"), "", wx.ITEM_NORMAL)
-        menu.AppendSeparator()
-        item2 = menu.Append(wx.ID_ANY, _("Horizontal"), "", wx.ITEM_CHECK)
-        item3 = menu.Append(wx.ID_ANY, _("Vertical"), "", wx.ITEM_CHECK)
-        menu.AppendSeparator()
-        item4 = menu.Append(wx.ID_ANY, _("Autohide"), "", wx.ITEM_CHECK)
-        item2.Check(not self.scene.context.menu_vertical)
-        item3.Check(self.scene.context.menu_vertical)
-        item4.Check(self.scene.context.menu_autohide)
-        gui.Bind(wx.EVT_MENU, self.on_popup_close, item1)
-        gui.Bind(wx.EVT_MENU, self.on_popup_horizontal, item2)
-        gui.Bind(wx.EVT_MENU, self.on_popup_vertical, item3)
-        gui.Bind(wx.EVT_MENU, self.on_popup_autohide, item4)
-        gui.PopupMenu(menu)
-        menu.Destroy()
-
-    def signal(self, signal, *args, **kwargs):
-        if signal == "tool_changed":
-            if self.scene.context.menu_autohide:
-                if self._opened:
-                    self.minimize(window_pos=None, space_pos=None)
-                    self._opened = False
-        elif signal == "guide":
-            # print ("guide")
-            pass
-
-    def minimize(self, window_pos=None, space_pos=None):
-        self.remove_all_widgets()
-        self.scene.request_refresh()
-
-    def maximize(self, window_pos=None, space_pos=None):
-        new_values = self.scene.context.find(self.buttons)
-        buttons = []
-        for button, name, sname in new_values:
-            buttons.append(button)
-
-        def sort_priority(elem):
-            return elem.get("priority", 0)
-
-        buttons.sort(key=sort_priority)  # Sort buttons by priority
-
-        def clicked(action):
-            def act(*args, **kwargs):
-                action(None)
-
-            return act
-
-        for button in buttons:
-            button_size = self.width
-            resize_param = button.get("size")
-            icon = button["icon"].GetBitmap(resize=button_size, use_theme=False)
-            self.add_widget(
-                -1,
-                ButtonWidget(
-                    self.scene,
-                    0,
-                    0,
-                    button_size,
-                    button_size,
-                    icon,
-                    clicked(button.get("action")),
-                ),
-                self._orientation,
+from meerk40t.kernel import STATE_TERMINATE, Module
+
+
+def plugin(kernel, lifecycle=None):
+    if lifecycle == "register":
+        _ = kernel.translation
+        kernel.register("module/TCPServer", TCPServer)
+
+
+class TCPServer(Module):
+    """
+    TCPServer opens up a localhost server and waits. Any connection is given its own handler.
+    """
+
+    def __init__(self, context, name, port=23):
+        """
+        Laser Server init.
+
+        @param context: Context at which this module is attached.
+        @param name: Name of this module
+        @param port: Port being used for the server.
+        """
+        Module.__init__(self, context, name)
+        self.port = port
+
+        self.socket = None
+        self.events_channel = self.context.channel(f"server-tcp-{port}")
+        self.data_channel = self.context.channel(f"data-tcp-{port}")
+        self.context.threaded(
+            self.run_tcp_delegater, thread_name=f"tcp-{port}", daemon=True
+        )
+
+    def stop(self):
+        self.state = STATE_TERMINATE
+
+    def module_close(self, *args, **kwargs):
+        _ = self.context._
+        self.events_channel(_("Shutting down server."))
+        self.state = STATE_TERMINATE
+        if self.socket is not None:
+            self.socket.close()
+            self.socket = None
+
+    def run_tcp_delegater(self):
+        """
+        TCP Run is a connection thread delegate. Any connections are given a different threaded
+        handle to interact with that connection. This thread here waits for sockets and delegates.
+        """
+        _ = self.context._
+        self.socket = socket.socket()
+        # self.socket.settimeout(0)
+        try:
+            self.socket.bind(("", self.port))
+            self.socket.listen(1)
+        except OSError:
+            self.events_channel(_("Could not start listening."))
+            return
+        handle = 1
+        while self.state != STATE_TERMINATE:
+            self.events_channel(
+                _("Listening {name} on port {port}...").format(
+                    name=self.name, port=self.port
+                )
             )
-        self.scene.request_refresh()
+            connection = None
+            address = None
+            try:
+                connection, address = self.socket.accept()
+                self.events_channel(
+                    _("Socket Connected: {address}").format(address=address)
+                )
+                self.context.threaded(
+                    self.connection_handler(connection, address),
+                    thread_name=f"handler-{self.port}-{handle}",
+                    daemon=True,
+                )
+                handle += 1
+            except socket.timeout:
+                pass
+            except OSError:
+                self.events_channel(
+                    _("Socket was killed: {address}").format(address=address)
+                )
+                if connection is not None:
+                    connection.close()
+                break
+            except AttributeError:
+                self.events_channel(_("Socket did not exist to accept connection."))
+                break
+        if self.socket is not None:
+            self.socket.close()
+
+    def connection_handler(self, connection, address):
+        """
+        The TCP Connection Handle, handles all connections delegated by the tcp_run() method.
+        The threaded context is entirely local and independent.
+        """
+        _ = self.context._
+
+        def handle():
+            def send(e):
+                if connection is not None:
+                    try:
+                        connection.send(bytes(e, "utf-8"))
+                        self.data_channel(f"<-- {str(e)}")
+                    except (ConnectionAbortedError, ConnectionResetError):
+                        connection.close()
+
+            recv = self.context.channel(f"{self.name}/recv", pure=True)
+            send_channel_name = f"{self.name}/send"
+            self.context.channel(send_channel_name, pure=True).watch(send)
+            while self.state != STATE_TERMINATE:
+                try:
+                    data_from_socket = connection.recv(1024)
+                    if len(data_from_socket):
+                        self.data_channel(f"--> {str(data_from_socket)}")
+                    else:
+                        break
+                    recv(data_from_socket)
+                except socket.timeout:
+                    self.events_channel(
+                        _("Connection to {address} timed out.").format(address=address)
+                    )
+                    break
+                except OSError:
+                    if connection is not None:
+                        connection.close()
+                    break
+            self.context.channel(send_channel_name).unwatch(send)
+            self.events_channel(
+                _("Connection to {address} was closed.").format(address=address)
+            )
+
+        return handle
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/wxmeerk40t.py` & `meerk40t-0.8.3000/meerk40t/gui/wxmeerk40t.py`

 * *Files 0% similar despite different names*

```diff
@@ -16,29 +16,27 @@
     # According to https://docs.wxpython.org/wx.richtext.1moduleindex.html
     # richtext needs to be imported before wx.App i.e. wxMeerK40t is instantiated
     # so, we are doing it here even though we do not refer to it in this file
     # richtext is used for the Console panel.
     from wx import richtext
 except ImportError:
     pass
-
 from meerk40t.gui.consolepanel import Console
 from meerk40t.gui.navigationpanels import Navigation
 from meerk40t.gui.spoolerpanel import JobSpooler
 from meerk40t.gui.wxmscene import SceneWindow
 from meerk40t.kernel import CommandSyntaxError, ConsoleFunction, Module, get_safe_path
 
 from ..main import APPLICATION_NAME, APPLICATION_VERSION
 from ..tools.livinghinges import LivingHingeTool
 from .about import About
 from .alignment import Alignment
 from .bufferview import BufferView
 from .devicepanel import DeviceManager
 from .executejob import ExecuteJob
-from .toolwidgets.toolnodeedit import NodeEditToolbar
 from .hersheymanager import (
     HersheyFontManager,
     HersheyFontSelector,
     register_hershey_stuff,
 )
 from .icons import (
     icons8_emergency_stop_button_50,
@@ -72,14 +70,15 @@
     GammaPanel,
     HalftonePanel,
     SharpenPanel,
     ToneCurvePanel,
 )
 from .propertypanels.textproperty import TextPropertyPanel
 from .simulation import Simulation
+from .toolwidgets.toolnodeedit import NodeEditToolbar
 from .wordlisteditor import WordlistEditor
 from .wxmmain import MeerK40t
 
 """
 Laser software for the Stock-LIHUIYU laserboard.
 
 MeerK40t (pronounced MeerKat) is a built-from-the-ground-up MIT licensed
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/wxmmain.py` & `meerk40t-0.8.3000/meerk40t/gui/wxmmain.py`

 * *Files 0% similar despite different names*

```diff
@@ -351,36 +351,36 @@
         #         "page": "Gui",
         #         "section": "Appearance",
         #     },
         # ]
         # context.kernel.register_choices("preferences", choices)
         choices = [
             {
-                "attr": "mini_icon",
+                "attr": "icon_size",
                 "object": self.context.root,
-                "default": False,
-                "type": bool,
-                "label": _("Mini icon in tree"),
+                "default": "default",
+                "type": str,
+                "style": "combosmall",
+                "choices": ["large", "big", "default", "small", "tiny"],
+                "label": _("Icon size:"),
                 "tip": _(
-                    "Active: Display a miniature representation of the element in the tree\n"
-                    + "Inactive: Use a standard icon for the element type instead"
+                    "Appearance of all icons in the GUI (requires a restart to take effect)"
                 ),
                 "page": "Gui",
                 "section": "Appearance",
             },
             {
-                "attr": "icon_size",
+                "attr": "mini_icon",
                 "object": self.context.root,
-                "default": "default",
-                "type": str,
-                "style": "combosmall",
-                "choices": ["large", "big", "default", "small", "tiny"],
-                "label": _("Icon size:"),
+                "default": False,
+                "type": bool,
+                "label": _("Mini icon in tree"),
                 "tip": _(
-                    "Appearance of all icons in the GUI (requires a restart to take effect))"
+                    "Active: Display a miniature representation of the element in the tree\n"
+                    + "Inactive: Use a standard icon for the element type instead"
                 ),
                 "page": "Gui",
                 "section": "Appearance",
             },
         ]
         context.kernel.register_choices("preferences", choices)
 
@@ -1109,16 +1109,17 @@
 
             if lets_do_it:
                 for node in data:
                     if group_node is None:
                         group_node = node.parent.add(type="group", label="Group")
                     group_node.append_child(node)
                     node.emphasized = True
-                group_node.emphasized = True
-                kernel.signal("element_property_reload", "Scene", group_node)
+                if group_node is not None:
+                    group_node.emphasized = True
+                    kernel.signal("element_property_reload", "Scene", group_node)
 
         # Default Size for normal buttons
         buttonsize = STD_ICON_SIZE
         kernel.register(
             "button/group/Group",
             {
                 "label": _("Group"),
@@ -1238,18 +1239,16 @@
             "button/align/AlignRight",
             {
                 "label": _("Right"),
                 "icon": icons8_align_right_50,
                 "tip": _(
                     "Align selected elements at the rightmost position (right click: of the bed)"
                 ),
-                "action": lambda v: kernel.elements(
-                    "align push first individual right pop\n"
-                ),
-                "right": lambda v: kernel.elements("align push bed group right pop\n"),
+                "action": lambda v: kernel.elements("align first right\n"),
+                "right": lambda v: kernel.elements("align bed group right\n"),
                 "size": bsize_small,
                 "rule_enabled": lambda cond: len(
                     list(kernel.elements.elems(emphasized=True))
                 )
                 > 0,
             },
         )
@@ -1257,18 +1256,16 @@
             "button/align/AlignTop",
             {
                 "label": _("Top"),
                 "icon": icons8_align_top_50,
                 "tip": _(
                     "Align selected elements at the topmost position (right click: of the bed)"
                 ),
-                "action": lambda v: kernel.elements(
-                    "align push first individual top pop\n"
-                ),
-                "right": lambda v: kernel.elements("align push bed group top pop\n"),
+                "action": lambda v: kernel.elements("align first top\n"),
+                "right": lambda v: kernel.elements("align bed group top\n"),
                 "size": bsize_small,
                 "rule_enabled": lambda cond: len(
                     list(kernel.elements.elems(emphasized=True))
                 )
                 > 0,
             },
         )
@@ -1276,18 +1273,16 @@
             "button/align/AlignBottom",
             {
                 "label": _("Bottom"),
                 "icon": icons8_align_bottom_50,
                 "tip": _(
                     "Align selected elements at the lowest position (right click: of the bed)"
                 ),
-                "action": lambda v: kernel.elements(
-                    "align push first individual bottom pop\n"
-                ),
-                "right": lambda v: kernel.elements("align push bed group bottom pop\n"),
+                "action": lambda v: kernel.elements("align first bottom\n"),
+                "right": lambda v: kernel.elements("align bed group bottom\n"),
                 "size": bsize_small,
                 "rule_enabled": lambda cond: len(
                     list(kernel.elements.elems(emphasized=True))
                 )
                 > 0,
             },
         )
@@ -1295,20 +1290,16 @@
             "button/align/AlignCenterH",
             {
                 "label": _("Center X"),
                 "icon": icons8_centerh_50,
                 "tip": _(
                     "Align selected elements at their center horizontally (right click: of the bed)"
                 ),
-                "action": lambda v: kernel.elements(
-                    "align push first individual centerh pop\n"
-                ),
-                "right": lambda v: kernel.elements(
-                    "align push bed group centerh pop\n"
-                ),
+                "action": lambda v: kernel.elements("align first centerh\n"),
+                "right": lambda v: kernel.elements("align bed group centerh\n"),
                 "size": bsize_small,
                 "rule_enabled": lambda cond: len(
                     list(kernel.elements.elems(emphasized=True))
                 )
                 > 0,
             },
         )
@@ -1316,48 +1307,54 @@
             "button/align/AlignCenterV",
             {
                 "label": _("Center Y"),
                 "icon": icons8_centerv_50,
                 "tip": _(
                     "Align selected elements at their center vertically (right click: of the bed)"
                 ),
-                "action": lambda v: kernel.elements(
-                    "align push first individual centerv pop\n"
-                ),
-                "right": lambda v: kernel.elements(
-                    "align push bed group centerv pop\n"
-                ),
+                "action": lambda v: kernel.elements("align first centerv\n"),
+                "right": lambda v: kernel.elements("align bed group centerv\n"),
                 "size": bsize_small,
                 "rule_enabled": lambda cond: len(
                     list(kernel.elements.elems(emphasized=True))
                 )
                 > 0,
             },
         )
         kernel.register(
             "button/align/AlignHorizontally",
             {
                 "label": _("Distr. Hor."),
                 "icon": icons_evenspace_horiz,
-                "tip": _("Distribute Space Horizontally"),
+                "tip": _("Distribute Space Horizontally")
+                + "\n"
+                + _("Left click: Equal distances")
+                + "\n"
+                + _("Right click: Equal centers"),
                 "action": lambda v: kernel.elements("align spaceh\n"),
+                "right": lambda v: kernel.elements("align spaceh2\n"),
                 "size": bsize_small,
                 "rule_enabled": lambda cond: len(
                     list(kernel.elements.elems(emphasized=True))
                 )
                 > 2,
             },
         )
         kernel.register(
             "button/align/AlignVertically",
             {
                 "label": _("Distr. Vert."),
                 "icon": icons_evenspace_vert,
-                "tip": _("Distribute Space Vertically"),
+                "tip": _("Distribute Space Vertically")
+                + "\n"
+                + _("Left click: Equal distances")
+                + "\n"
+                + _("Right click: Equal centers"),
                 "action": lambda v: kernel.elements("align spacev\n"),
+                "right": lambda v: kernel.elements("align spacev2\n"),
                 "size": bsize_small,
                 "rule_enabled": lambda cond: len(
                     list(kernel.elements.elems(emphasized=True))
                 )
                 > 2,
             },
         )
@@ -2451,15 +2448,15 @@
         def on_click_pref_keys():
             self.context("window open Keymap\n")
 
         def on_click_preferences():
             self.context("window open Preferences\n")
 
         def on_click_delete():
-            self.context("element delete\n")
+            self.context("tree selected delete\n")
 
         def clipboard_filled():
             res = False
             try:
                 destination = self.context.elements._clipboard_default
                 if len(self.context.elements._clipboard[destination]) > 0:
                     res = True
@@ -2553,15 +2550,15 @@
             },
             {
                 "label": "",
                 "level": 1,
                 "segment": "",
             },
             {
-                "label": _("Delete\tDel"),
+                "label": _("Delete"),
                 "help": _("Delete the selected elements"),
                 "action": on_click_delete,
                 "enabled": self.context.elements.has_emphasis,
                 "level": 1,
                 "segment": "",
             },
             {
@@ -3121,14 +3118,24 @@
         self.Bind(
             wx.EVT_MENU,
             lambda e: self.context("webhelp featurerequest\n"),
             id=menuitem.GetId(),
         )
         self.help_menu.AppendSeparator()
         menuitem = self.help_menu.Append(
+            wx.ID_ANY,
+            _("Check for Updates"),
+            _("Check whether a newer version of Meerk40t is available"),
+        )
+        self.Bind(
+            wx.EVT_MENU,
+            lambda v: self.context("check_for_updates -popup\n"),
+            id=menuitem.GetId(),
+        )
+        menuitem = self.help_menu.Append(
             wx.ID_ABOUT,
             _("&About MeerK40t"),
             _(
                 "Toggle the About window acknowledging those who contributed to creating Meerk40t"
             ),
         )
         self.Bind(
@@ -3495,64 +3502,48 @@
                 setattr(self.context, "file" + str(i), recent[i])
             except IndexError:
                 break
         self.populate_recent_menu()
 
     def clear_project(self):
         context = self.context
-        try:
-            with wx.BusyInfo(wx.BusyInfoFlags().Title(_("Cleaning up...")).Label("")):
-                self.working_file = None
-                context.elements.clear_all()
-                self.context(".laserpath_clear\n")
-                self.validate_save()
-        except AttributeError:
-            # wxPython 4.0
-            with wx.BusyInfo(_("Cleaning up...")):
-                self.working_file = None
-                context.elements.clear_all()
-                self.context(".laserpath_clear\n")
-                self.validate_save()
+        kernel = context.kernel
+        kernel.busyinfo.start(msg=_("Cleaning up..."))
+        self.working_file = None
+        context.elements.clear_all()
+        self.context(".laserpath_clear\n")
+        self.validate_save()
+        kernel.busyinfo.end()
 
     def clear_and_open(self, pathname):
         self.clear_project()
         if self.load(pathname):
             try:
                 if self.context.uniform_svg and pathname.lower().endswith("svg"):
                     # or (len(elements) > 0 and "meerK40t" in elements[0].values):
                     # TODO: Disabled uniform_svg, no longer detecting namespace.
                     self.working_file = pathname
                     self.validate_save()
             except AttributeError:
                 pass
 
     def load(self, pathname):
+        kernel = self.context.kernel
         try:
-            try:
-                # Reset to standard tool
-                self.context("tool none\n")
-                # wxPython 4.1.+
-                with wx.BusyInfo(
-                    wx.BusyInfoFlags().Title(_("Loading File...")).Label(pathname)
-                ):
-                    n = self.context.elements.note
-                    results = self.context.elements.load(
-                        pathname,
-                        channel=self.context.channel("load"),
-                        svg_ppi=self.context.elements.svg_ppi,
-                    )
-            except AttributeError:
-                # wxPython 4.0
-                with wx.BusyInfo(_("Loading File...")):
-                    n = self.context.elements.note
-                    results = self.context.elements.load(
-                        pathname,
-                        channel=self.context.channel("load"),
-                        svg_ppi=self.context.elements.svg_ppi,
-                    )
+            # Reset to standard tool
+            self.context("tool none\n")
+            info = _("Loading File...") + "\n" + pathname
+            kernel.busyinfo.start(msg=info)
+            n = self.context.elements.note
+            results = self.context.elements.load(
+                pathname,
+                channel=self.context.channel("load"),
+                svg_ppi=self.context.elements.svg_ppi,
+            )
+            kernel.busyinfo.end()
         except BadFileError as e:
             dlg = wx.MessageDialog(
                 None,
                 str(e),
                 _("File is Malformed"),
                 wx.OK | wx.ICON_WARNING,
             )
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/wxmribbon.py` & `meerk40t-0.8.3000/meerk40t/gui/wxmribbon.py`

 * *Files 9% similar despite different names*

```diff
@@ -1,7 +1,48 @@
+"""
+The WxmRibbon Bar is a core aspect of MeerK40t's interaction. All of the buttons are dynmically generated but the
+panels themselves are created in a static fashion. But the contents of those individual ribbon panels are defined
+in the kernel lookup.
+
+        service.register(
+            "button/control/Redlight",
+            {
+                "label": _("Red Dot On"),
+                "icon": icons8_quick_mode_on_50,
+                "tip": _("Turn Redlight On"),
+                "action": lambda v: service("red on\n"),
+                "toggle": {
+                    "label": _("Red Dot Off"),
+                    "action": lambda v: service("red off\n"),
+                    "icon": icons8_flash_off_50,
+                    "signal": "grbl_red_dot",
+                },
+                "rule_enabled": lambda v: has_red_dot_enabled(),
+            },
+        )
+
+For example would register a button in the control panel with a discrete name "Redlight" the definitions for label,
+icon, tip, action are all pretty standard to setup a button. This can often be registered as part of a service such
+that if you switch the service it will change the lookup and that change will be detected here and rebuilt the buttons.
+
+The toggle defines an alternative set of values for the toggle state of the button.
+The multi defines a series of alternative states, and creates a hybrid button with a drop down to select the state
+    desired.
+Other properties like `rule_enabled` provides a check for whether this button should be enabled or not.
+
+The `toggle_attr` will permit a toggle to set an attribute on the given `object` which would default to the root
+context but could need to set a more local object attribute.
+
+If a `signal` is assigned as an aspect of multi it triggers that specfic option in the multi button.
+If a `signal` is assigned within the toggle it sets the state of the given toggle. These should be compatible with
+the signals issued by choice panels.
+
+The action is a function which is run when the button is pressed.
+"""
+
 import copy
 import platform
 import threading
 
 import wx
 import wx.lib.agw.ribbon as RB
 from wx import aui
@@ -298,15 +339,15 @@
         self.stored_labels = {}
         self.stored_height = 0
         self.art_provider_count = 0
 
         self.button_lookup = {}
         self.group_lookup = {}
 
-        self.toggle_signals = list()
+        self._registered_signals = list()
 
         # Define Ribbon.
         self._ribbon = RB.RibbonBar(
             self,
             agwStyle=RB.RIBBON_BAR_FLOW_HORIZONTAL
             | RB.RIBBON_BAR_SHOW_PAGE_LABELS
             | RB.RIBBON_BAR_SHOW_PANEL_EXT_BUTTONS
@@ -352,14 +393,21 @@
 
     def button_click(self, event):
         # Let's figure out what kind of action we need to perform
         evt_id = event.GetId()
         self._button_click_id(evt_id, event=event)
 
     def _button_click_id(self, evt_id, event=None):
+        """
+        Process button click of button at provided button_id
+
+        @param evt_id:
+        @param event:
+        @return:
+        """
         button = self.button_lookup.get(evt_id)
         if button is None:
             return
 
         if button.group:
             # Toggle radio buttons
             button.toggle = not button.toggle
@@ -390,18 +438,25 @@
         if button.action is not None:
             # We have an action to call.
             button.action(event)
 
         if button.state_pressed is None:
             # If there's a pressed state we should change the button state
             return
+
         button.toggle = not button.toggle
         if button.toggle:
+            if button.toggle_attr is not None:
+                setattr(button.object, button.toggle_attr, True)
+                self.context.signal(button.toggle_attr, True, button.object)
             self._restore_button_aspect(button, button.state_pressed)
         else:
+            if button.toggle_attr is not None:
+                setattr(button.object, button.toggle_attr, False)
+                self.context.signal(button.toggle_attr, False, button.object)
             self._restore_button_aspect(button, button.state_unpressed)
         self.ensure_realize()
 
     def drop_click(self, event):
         """
         Drop down of a hybrid button was clicked.
 
@@ -436,29 +491,38 @@
             """
             Process menu item click.
 
             @param event:
             @return:
             """
             key_id = v.get("identifier")
-            setattr(self.context, button.save_id, key_id)
+            setattr(button.object, button.save_id, key_id)
             button.state_unpressed = key_id
             self._restore_button_aspect(button, key_id)
             self.ensure_realize()
 
         return menu_item_click
 
     def _restore_button_aspect(self, base_button, key):
+        """
+        Restores a saved button aspect for the given key. Given a base_button and the key to the alternative aspect
+        we restore the given aspect.
+
+        @param base_button:
+        @param key:
+        @return:
+        """
         if not hasattr(base_button, "alternatives"):
             return
         try:
             alt = base_button.alternatives[key]
         except KeyError:
             return
         base_button.action = alt.get("action", base_button.action)
+        base_button.action_right = alt.get("action_right", base_button.action_right)
         base_button.label = alt.get("label", base_button.label)
         base_button.help_string = alt.get("help_string", base_button.help_string)
         base_button.bitmap_large = alt.get("bitmap_large", base_button.bitmap_large)
         base_button.bitmap_large_disabled = alt.get(
             "bitmap_large_disabled", base_button.bitmap_large_disabled
         )
         base_button.bitmap_small = alt.get("bitmap_small", base_button.bitmap_small)
@@ -468,18 +532,29 @@
         base_button.client_data = alt.get("client_data", base_button.client_data)
         # base_button.id = alt.get("id", base_button.id)
         # base_button.kind = alt.get("kind", base_button.kind)
         # base_button.state = alt.get("state", base_button.state)
         base_button.key = key
 
     def _store_button_aspect(self, base_button, key, **kwargs):
+        """
+        Stores visual aspects of the buttons within the "alternatives" dictionary.
+
+        This stores the various icons, labels, help, and other properties found on the base_button.
+
+        @param base_button: button with these askpects
+        @param key: aspects to store.
+        @param kwargs:
+        @return:
+        """
         if not hasattr(base_button, "alternatives"):
             base_button.alternatives = {}
         base_button.alternatives[key] = {
             "action": base_button.action,
+            "action_right": base_button.action_right,
             "label": base_button.label,
             "help_string": base_button.help_string,
             "bitmap_large": base_button.bitmap_large,
             "bitmap_large_disabled": base_button.bitmap_large_disabled,
             "bitmap_small": base_button.bitmap_small,
             "bitmap_small_disabled": base_button.bitmap_small_disabled,
             "client_data": base_button.client_data,
@@ -489,218 +564,302 @@
         }
         key_dict = base_button.alternatives[key]
         for k in kwargs:
             if kwargs[k] is not None:
                 key_dict[k] = kwargs[k]
 
     def _update_button_aspect(self, base_button, key, **kwargs):
+        """
+        Directly update the button aspects via the kwargs, aspect dictionary *must* exist.
+
+        @param base_button:
+        @param key:
+        @param kwargs:
+        @return:
+        """
         if not hasattr(base_button, "alternatives"):
             base_button.alternatives = {}
         key_dict = base_button.alternatives[key]
         for k in kwargs:
             if kwargs[k] is not None:
                 key_dict[k] = kwargs[k]
 
+    def _create_button(self, button_bar, button):
+        """
+        Creates a button and places it on the button_bar depending on the required definition.
+
+        @param button_bar:
+        @param button:
+        @return:
+        """
+        resize_param = button.get("size")
+        show_tip = not self.context.disable_tool_tips
+        # NewIdRef is only available after 4.1
+        try:
+            new_id = wx.NewIdRef()
+        except AttributeError:
+            new_id = wx.NewId()
+
+        # Create kind of button. Multi buttons are hybrid. Else, regular button or toggle-type
+        if "multi" in button:
+            # Button is a multi-type button
+            b = button_bar.AddHybridButton(
+                button_id=new_id,
+                label=button["label"],
+                bitmap=button["icon"].GetBitmap(resize=resize_param),
+                help_string=button["tip"] if show_tip else "",
+            )
+            button_bar.Bind(
+                RB.EVT_RIBBONBUTTONBAR_DROPDOWN_CLICKED,
+                self.drop_click,
+                id=new_id,
+            )
+        else:
+            if "group" in button or "toggle" in button:
+                bkind = RB.RIBBON_BUTTON_TOGGLE
+            else:
+                bkind = RB.RIBBON_BUTTON_NORMAL
+            b = button_bar.AddButton(
+                button_id=new_id,
+                label=button["label"],
+                bitmap=button["icon"].GetBitmap(resize=resize_param),
+                bitmap_disabled=button["icon"].GetBitmap(
+                    resize=resize_param, color=Color("grey")
+                ),
+                help_string=button["tip"] if show_tip else "",
+                kind=bkind,
+            )
+
+        button_bar.Bind(RB.EVT_RIBBONBUTTONBAR_CLICKED, self.button_click, id=new_id)
+        button_bar.Bind(wx.EVT_RIGHT_UP, self.button_click_right)
+        return b
+
+    def _setup_multi_button(self, button, b):
+        """
+        Store alternative aspects for multi-buttons, load stored previous state.
+
+        @param button:
+        @param b:
+        @return:
+        """
+        resize_param = button.get("size")
+        multi_aspects = button["multi"]
+        # This is the key used for the multi button.
+        multi_ident = button.get("identifier")
+        b.save_id = multi_ident
+        try:
+            b.object.setting(str, b.save_id, "default")
+        except AttributeError:
+            # This is not a context, we tried.
+            pass
+        initial_value = getattr(b.object, b.save_id, "default")
+
+        for i, v in enumerate(multi_aspects):
+            # These are values for the outer identifier
+            key = v.get("identifier", i)
+            self._store_button_aspect(b, key)
+            self._update_button_aspect(b, key, **v)
+            if "icon" in v:
+                v_icon = v.get("icon")
+                self._update_button_aspect(
+                    b,
+                    key,
+                    bitmap_large=v_icon.GetBitmap(resize=resize_param),
+                    bitmap_large_disabled=v_icon.GetBitmap(
+                        resize=resize_param, color=Color("grey")
+                    ),
+                )
+                if resize_param is None:
+                    siz = v_icon.GetBitmap().GetSize()
+                    small_resize = 0.5 * siz[0]
+                else:
+                    small_resize = 0.5 * resize_param
+                self._update_button_aspect(
+                    b,
+                    key,
+                    bitmap_small=v_icon.GetBitmap(resize=small_resize),
+                    bitmap_small_disabled=v_icon.GetBitmap(
+                        resize=small_resize, color=Color("grey")
+                    ),
+                )
+            if "signal" in v:
+                self._create_signal_for_multi(b, key, v["signal"])
+
+            if key == initial_value:
+                self._restore_button_aspect(b, key)
+
+    def _create_signal_for_multi(self, button, key, signal):
+        """
+        Creates a signal to restore the state of a multi button.
+
+        @param button:
+        @param key:
+        @param signal:
+        @return:
+        """
+
+        def make_multi_click(_tb, _key):
+            def multi_click(origin, set_value):
+                self._restore_button_aspect(_tb, _key)
+
+            return multi_click
+
+        signal_multi_listener = make_multi_click(button, key)
+        self.context.listen(signal, signal_multi_listener)
+        self._registered_signals.append((signal, signal_multi_listener))
+
+    def _setup_toggle_button(self, button, b):
+        """
+        Store toggle and original aspects for toggle-buttons
+
+        @param button:
+        @param b:
+        @return:
+        """
+        resize_param = button.get("size")
+
+        b.state_pressed = "toggle"
+        b.state_unpressed = "original"
+
+        self._store_button_aspect(b, "original")
+
+        toggle_action = button["toggle"]
+        key = toggle_action.get("identifier", "toggle")
+        if "signal" in toggle_action:
+            self._create_signal_for_toggle(b, toggle_action["signal"])
+
+        self._store_button_aspect(b, key, **toggle_action)
+        if "icon" in toggle_action:
+            toggle_icon = toggle_action.get("icon")
+            self._update_button_aspect(
+                b,
+                key,
+                bitmap_large=toggle_icon.GetBitmap(resize=resize_param),
+                bitmap_large_disabled=toggle_icon.GetBitmap(
+                    resize=resize_param, color=Color("grey")
+                ),
+            )
+            if resize_param is None:
+                siz = toggle_icon.GetBitmap().GetSize()
+                small_resize = 0.5 * siz[0]
+            else:
+                small_resize = 0.5 * resize_param
+            self._update_button_aspect(
+                b,
+                key,
+                bitmap_small=toggle_icon.GetBitmap(resize=small_resize),
+                bitmap_small_disabled=toggle_icon.GetBitmap(
+                    resize=small_resize, color=Color("grey")
+                ),
+            )
+        # Set initial value by identifer and object
+        if b.toggle_attr is not None and getattr(b.object, b.toggle_attr, False):
+            b.toggle = True
+            self._restore_button_aspect(b, b.state_pressed)
+            b.parent.ToggleButton(b.id, b.toggle)
+            b.parent.Refresh()
+
+    def _create_signal_for_toggle(self, button, signal):
+        """
+        Creates a signal toggle which will listen for the given signal and set the toggle-state to the given set_value
+
+        E.G. If a toggle has a signal called "tracing" and the context.signal("tracing", True) is called this will
+        automatically set the toggle state.
+
+        Note: It will not call any of the associated actions, it will simply set the toggle state.
+
+        @param button:
+        @param signal:
+        @return:
+        """
+
+        def make_toggle_click(_tb):
+            def toggle_click(origin, set_value, *args):
+                if set_value:
+                    _tb.toggle = True
+                    self._restore_button_aspect(_tb, _tb.state_pressed)
+                else:
+                    _tb.toggle = False
+                    self._restore_button_aspect(_tb, _tb.state_unpressed)
+                _tb.parent.ToggleButton(_tb.id, _tb.toggle)
+                _tb.parent.Refresh()
+
+            return toggle_click
+
+        signal_toggle_listener = make_toggle_click(button)
+        self.context.listen(signal, signal_toggle_listener)
+        self._registered_signals.append((signal, signal_toggle_listener))
+
     def set_buttons(self, new_values, button_bar):
         """
         Set buttons is the primary button configuration routine. It is responsible for clearing and recreating buttons.
 
+        * The button definition is a dynamically created and stored dictionary.
+        * Buttons are sorted by priority.
+        * Multi buttons get a hybrid type.
+        * Toggle buttons get a toggle type (Unless they are also multi).
+        * Created button objects have attributes assigned to them.
+            * toggle, parent, group, identifier, toggle_identifier, action, right, rule_enabled
+        * Multi-buttons have an identifier attr which is applied to the root context, or given "object".
+        * The identifier is used to set the state of the object, the attr-identifier is set to the value-identifier
+        * Toggle buttons have a toggle_identifier, this is used to set the and retrieve the state of the toggle.
+
+
         @param new_values: dictionary of button values to use.
         @param button_bar: specific button bar these buttons are applied to.
         @return:
         """
-        show_tip = not self.context.disable_tool_tips
         button_bar._current_layout = 0
         button_bar._hovered_button = None
         button_bar._active_button = None
         button_bar.ClearButtons()
         buttons = []
         for button, name, sname in new_values:
             buttons.append(button)
 
+        # Sort buttons by priority
         def sort_priority(elem):
             return elem.get("priority", 0)
 
-        buttons.sort(key=sort_priority)  # Sort buttons by priority
+        buttons.sort(key=sort_priority)
 
         for button in buttons:
             # Every registered button in the updated lookup gets created.
             group = button.get("group")
             resize_param = button.get("size")
-            # NewIdRef is only available after 4.1
-            try:
-                new_id = wx.NewIdRef()
-            except AttributeError:
-                new_id = wx.NewId()
-
-            if "multi" in button:
-                # Button is a multi-type button
-                b = button_bar.AddHybridButton(
-                    button_id=new_id,
-                    label=button["label"],
-                    bitmap=button["icon"].GetBitmap(resize=resize_param),
-                    help_string=button["tip"] if show_tip else "",
-                )
-                button_bar.Bind(
-                    RB.EVT_RIBBONBUTTONBAR_DROPDOWN_CLICKED,
-                    self.drop_click,
-                    id=new_id,
-                )
-            else:
-                if "group" in button:
-                    bkind = RB.RIBBON_BUTTON_TOGGLE
-                else:
-                    bkind = RB.RIBBON_BUTTON_NORMAL
-                if "toggle" in button:
-                    bkind = RB.RIBBON_BUTTON_TOGGLE
-                b = button_bar.AddButton(
-                    button_id=new_id,
-                    label=button["label"],
-                    bitmap=button["icon"].GetBitmap(resize=resize_param),
-                    bitmap_disabled=button["icon"].GetBitmap(
-                        resize=resize_param, color=Color("grey")
-                    ),
-                    help_string=button["tip"] if show_tip else "",
-                    kind=bkind,
-                )
+            b = self._create_button(button_bar, button)
 
             # Store all relevant aspects for newly registered button.
             b.button_dict = button
             b.state_pressed = None
             b.state_unpressed = None
             b.toggle = False
             b.parent = button_bar
             b.group = group
+            b.toggle_attr = button.get("toggle_attr")
             b.identifier = button.get("identifier")
             b.action = button.get("action")
             b.action_right = button.get("right")
-            if "rule_enabled" in button:
-                b.enable_rule = button.get("rule_enabled")
-            else:
-                b.enable_rule = lambda cond: True
-
+            b.enable_rule = button.get("rule_enabled", lambda cond: True)
+            b.object = button.get("object", self.context)
             if "multi" in button:
-                # Store alternative aspects for multi-buttons, load stored previous state.
-
-                multi_action = button["multi"]
-                multi_ident = button.get("identifier")
-                b.save_id = multi_ident
-                initial_id = self.context.setting(str, b.save_id, "default")
-
-                for i, v in enumerate(multi_action):
-                    key = v.get("identifier", i)
-                    self._store_button_aspect(b, key)
-                    self._update_button_aspect(b, key, **v)
-                    if "icon" in v:
-                        v_icon = v.get("icon")
-                        self._update_button_aspect(
-                            b,
-                            key,
-                            bitmap_large=v_icon.GetBitmap(resize=resize_param),
-                            bitmap_large_disabled=v_icon.GetBitmap(
-                                resize=resize_param, color=Color("grey")
-                            ),
-                        )
-                        if resize_param is None:
-                            siz = v_icon.GetBitmap().GetSize()
-                            small_resize = 0.5 * siz[0]
-                        else:
-                            small_resize = 0.5 * resize_param
-                        self._update_button_aspect(
-                            b,
-                            key,
-                            bitmap_small=v_icon.GetBitmap(resize=small_resize),
-                            bitmap_small_disabled=v_icon.GetBitmap(
-                                resize=small_resize, color=Color("grey")
-                            ),
-                        )
-                    if "signal" in v:
-
-                        def make_multi_click(_tb, _key):
-                            def multi_click(origin, set_value):
-                                self._restore_button_aspect(_tb, _key)
-
-                            return multi_click
-
-                        signal_multi_listener = make_multi_click(b, key)
-                        self.context.listen(v["signal"], signal_multi_listener)
-                        self.toggle_signals.append((v["signal"], signal_multi_listener))
-
-                    if key == initial_id:
-                        self._restore_button_aspect(b, key)
-
+                self._setup_multi_button(button, b)
             if "toggle" in button:
-                # Store toggle and original aspects for toggle-buttons
-
-                b.state_pressed = "toggle"
-                b.state_unpressed = "original"
-
-                self._store_button_aspect(b, "original")
-
-                toggle_action = button["toggle"]
-                key = toggle_action.get("identifier", "toggle")
-                if "signal" in toggle_action:
-
-                    def make_toggle_click(_tb):
-                        def toggle_click(origin, set_value):
-                            if set_value:
-                                _tb.toggle = False
-                                self._restore_button_aspect(_tb, _tb.state_unpressed)
-                            else:
-                                _tb.toggle = True
-                                self._restore_button_aspect(_tb, _tb.state_pressed)
-                            _tb.parent.ToggleButton(_tb.id, _tb.toggle)
-                            _tb.parent.Refresh()
-
-                        return toggle_click
-
-                    signal_toggle_listener = make_toggle_click(b)
-                    self.context.listen(toggle_action["signal"], signal_toggle_listener)
-                    self.toggle_signals.append(
-                        (toggle_action["signal"], signal_toggle_listener)
-                    )
+                self._setup_toggle_button(button, b)
 
-                self._store_button_aspect(b, key, **toggle_action)
-                if "icon" in toggle_action:
-                    toggle_icon = toggle_action.get("icon")
-                    self._update_button_aspect(
-                        b,
-                        key,
-                        bitmap_large=toggle_icon.GetBitmap(resize=resize_param),
-                        bitmap_large_disabled=toggle_icon.GetBitmap(
-                            resize=resize_param, color=Color("grey")
-                        ),
-                    )
-                    if resize_param is None:
-                        siz = toggle_icon.GetBitmap().GetSize()
-                        small_resize = 0.5 * siz[0]
-                    else:
-                        small_resize = 0.5 * resize_param
-                    self._update_button_aspect(
-                        b,
-                        key,
-                        bitmap_small=toggle_icon.GetBitmap(resize=small_resize),
-                        bitmap_small_disabled=toggle_icon.GetBitmap(
-                            resize=small_resize, color=Color("grey")
-                        ),
-                    )
             # Store newly created button in the various lookups
+            new_id = b.id
             self.button_lookup[new_id] = b
             if group is not None:
                 c_group = self.group_lookup.get(group)
                 if c_group is None:
                     c_group = []
                     self.group_lookup[group] = c_group
                 c_group.append(b)
 
-            button_bar.Bind(
-                RB.EVT_RIBBONBUTTONBAR_CLICKED, self.button_click, id=new_id
-            )
-            button_bar.Bind(wx.EVT_RIGHT_UP, self.button_click_right)
-
         self.ensure_realize()
 
     def apply_enable_rules(self):
         for k in self.button_lookup:
             v = self.button_lookup[k]
             try:
                 enable_it = v.enable_rule(0)
@@ -1058,15 +1217,15 @@
 
         self.ensure_realize()
 
     def pane_show(self):
         pass
 
     def pane_hide(self):
-        for key, listener in self.toggle_signals:
+        for key, listener in self._registered_signals:
             self.context.unlisten(key, listener)
 
     # def on_page_changing(self, event):
     #     page = event.GetPage()
     #     p_id = page.GetId()
     #     # print ("Page Changing to ", p_id)
     #     if p_id  == ID_PAGE_TOGGLE:
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/wxmscene.py` & `meerk40t-0.8.3000/meerk40t/gui/wxmscene.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,14 +1,15 @@
 import platform
 import random
+import time
 
 import wx
 from wx import aui
 
-from meerk40t.core.element_types import elem_nodes
+from meerk40t.core.elements.element_types import elem_nodes
 from meerk40t.core.units import UNITS_PER_PIXEL, Length
 from meerk40t.gui.icons import (
     STD_ICON_SIZE,
     icon_meerk40t,
     icons8_menu_50,
     icons8_r_white,
     icons8_text_50,
@@ -39,14 +40,15 @@
 from meerk40t.gui.toolwidgets.toolrect import RectTool
 from meerk40t.gui.toolwidgets.toolrelocate import RelocateTool
 from meerk40t.gui.toolwidgets.toolribbon import RibbonTool
 from meerk40t.gui.toolwidgets.tooltext import TextTool
 from meerk40t.gui.toolwidgets.toolvector import VectorTool
 from meerk40t.gui.utilitywidgets.checkboxwidget import CheckboxWidget
 from meerk40t.gui.utilitywidgets.cyclocycloidwidget import CyclocycloidWidget
+from meerk40t.gui.utilitywidgets.harmonograph import HarmonographWidget
 from meerk40t.gui.utilitywidgets.seekbarwidget import SeekbarWidget
 from meerk40t.gui.utilitywidgets.togglewidget import ToggleWidget
 from meerk40t.gui.wxutils import get_key_name, is_navigation_key
 from meerk40t.kernel import CommandSyntaxError, signal_listener
 from meerk40t.svgelements import Angle, Color
 
 _ = wx.GetTranslation
@@ -86,30 +88,48 @@
         self.scene = ScenePanel(
             self.context,
             self,
             scene_name="Scene" if index is None else f"Scene{index}",
             style=wx.EXPAND | wx.WANTS_CHARS,
         )
         self.widget_scene = self.scene.scene
+
+        self.tool_active = False
+        self.modif_active = False
+        self._reference = None  # Reference Object
+
+        # Stuff for magnet-lines
+        self.magnet_x = []
+        self.magnet_y = []
+        self.magnet_attraction = 2
+        # 0 off, `1..x` increasing strength (quadratic behaviour)
+        self.magnet_attract_x = True  # Shall the X-Axis be affected
+        self.magnet_attract_y = True  # Shall the Y-Axis be affected
+        self.magnet_attract_c = True  # Shall the center be affected
+
+        self.active_tool = "none"
+
+        self._last_snap_position = None
+        self._last_snap_ts = 0
+
         context = self.context
         self.widget_scene.add_scenewidget(AttractionWidget(self.widget_scene))
         self.widget_scene.add_scenewidget(SelectionWidget(self.widget_scene))
         self.tool_container = ToolContainer(self.widget_scene)
         self.widget_scene.add_scenewidget(self.tool_container)
         self.widget_scene.add_scenewidget(RectSelectWidget(self.widget_scene))
         self.laserpath_widget = LaserPathWidget(self.widget_scene)
         self.widget_scene.add_scenewidget(self.laserpath_widget)
         self.widget_scene.add_scenewidget(
             ElementsWidget(self.widget_scene, LaserRender(context))
         )
-        # Let the grid resize itself
-        self.widget_scene.auto_tick = True
 
         self.widget_scene.add_scenewidget(MachineOriginWidget(self.widget_scene))
-        self.widget_scene.add_scenewidget(GridWidget(self.widget_scene))
+        self.grid = GridWidget(self.widget_scene)
+        self.widget_scene.add_scenewidget(self.grid)
         self.widget_scene.add_scenewidget(BedWidget(self.widget_scene))
         self.widget_scene.add_interfacewidget(GuideWidget(self.widget_scene))
         self.widget_scene.add_interfacewidget(ReticleWidget(self.widget_scene))
 
         sizer_2 = wx.BoxSizer(wx.VERTICAL)
         sizer_2.Add(self.scene, 20, wx.EXPAND, 0)
         self.SetSizer(sizer_2)
@@ -286,14 +306,22 @@
         @context.console_command("cyclocycloid", hidden=True)
         def cyclocycloid(channel, _, **kwgs):
             self.widget_scene.widget_root.scene_widget.add_widget(
                 0, CyclocycloidWidget(self.widget_scene)
             )
             channel(_("Added cyclocycloid widget to scene."))
 
+        @context.console_command("harmonograph", hidden=True)
+        def harmonograph(channel, _, **kwgs):
+            self.widget_scene.widget_root.scene_widget.add_widget(
+                0, HarmonographWidget(self.widget_scene)
+            )
+            self.widget_scene.request_refresh()
+            channel(_("Added harmonograph widget to scene."))
+
         @context.console_command("toast", hidden=True)
         def toast_scene(remainder, **kwgs):
             self.widget_scene.toast(remainder)
 
         @context.console_argument("tool", help=_("tool to use."))
         @context.console_command("tool", help=_("sets a particular tool for the scene"))
         def tool_base(command, channel, _, tool=None, **kwgs):
@@ -499,15 +527,15 @@
             channel(str(matrix))
             return "scene", data
 
         @context.console_command("reference")
         def make_reference(**kwgs):
             # Take first emphasized element
             for e in self.context.elements.flat(types=elem_nodes, emphasized=True):
-                self.widget_scene.reference_object = e
+                self.reference_object = e
                 break
             self.context.signal("reference")
 
         # Establishes commands
         @context.console_argument(
             "target", type=str, help=_("Target (one of primary, secondary, circular")
         )
@@ -533,81 +561,73 @@
             oy=None,
             scalex=None,
             scaley=None,
             **kwgs,
         ):
             if target is None:
                 channel(_("Grid-Parameters:"))
-                p_state = _("On") if self.widget_scene.draw_grid_primary else _("Off")
+                p_state = _("On") if self.grid.draw_grid_primary else _("Off")
                 channel(f"Primary: {p_state}")
-                if self.widget_scene.draw_grid_secondary:
+                if self.grid.draw_grid_secondary:
                     channel(f"Secondary: {_('On')}")
-                    if self.widget_scene.grid_secondary_cx is not None:
+                    if self.grid.grid_secondary_cx is not None:
                         channel(
-                            f"   cx: {Length(amount=self.widget_scene.grid_secondary_cx).length_mm}"
+                            f"   cx: {Length(amount=self.grid.grid_secondary_cx).length_mm}"
                         )
-                    if self.widget_scene.grid_secondary_cy is not None:
+                    if self.grid.grid_secondary_cy is not None:
                         channel(
-                            f"   cy: {Length(amount=self.widget_scene.grid_secondary_cy).length_mm}"
-                        )
-                    if self.widget_scene.grid_secondary_scale_x is not None:
-                        channel(
-                            f"   scale-x: {self.widget_scene.grid_secondary_scale_x:.2f}"
-                        )
-                    if self.widget_scene.grid_secondary_scale_y is not None:
-                        channel(
-                            f"   scale-y: {self.widget_scene.grid_secondary_scale_y:.2f}"
+                            f"   cy: {Length(amount=self.grid.grid_secondary_cy).length_mm}"
                         )
+                    if self.grid.grid_secondary_scale_x is not None:
+                        channel(f"   scale-x: {self.grid.grid_secondary_scale_x:.2f}")
+                    if self.grid.grid_secondary_scale_y is not None:
+                        channel(f"   scale-y: {self.grid.grid_secondary_scale_y:.2f}")
                 else:
                     channel(f"Secondary: {_('Off')}")
-                if self.widget_scene.draw_grid_circular:
+                if self.grid.draw_grid_circular:
                     channel(f"Circular: {_('On')}")
-                    if self.widget_scene.grid_circular_cx is not None:
+                    if self.grid.grid_circular_cx is not None:
                         channel(
-                            f"   cx: {Length(amount=self.widget_scene.grid_circular_cx).length_mm}"
+                            f"   cx: {Length(amount=self.grid.grid_circular_cx).length_mm}"
                         )
-                    if self.widget_scene.grid_circular_cy is not None:
+                    if self.grid.grid_circular_cy is not None:
                         channel(
-                            f"   cy: {Length(amount=self.widget_scene.grid_circular_cy).length_mm}"
+                            f"   cy: {Length(amount=self.grid.grid_circular_cy).length_mm}"
                         )
                 else:
                     channel(f"Circular: {_('Off')}")
                 return
             else:
                 target = target.lower()
                 if target[0] == "p":
-                    self.widget_scene.draw_grid_primary = (
-                        not self.widget_scene.draw_grid_primary
-                    )
+                    self.grid.draw_grid_primary = not self.grid.draw_grid_primary
                     channel(
                         _("Turned primary grid on")
-                        if self.widget_scene.draw_grid_primary
+                        if self.grid.draw_grid_primary
                         else _("Turned primary grid off")
                     )
                     self.scene.signal("guide")
                     self.scene.signal("grid")
                     self.request_refresh()
                 elif target[0] == "s":
-                    self.widget_scene.draw_grid_secondary = (
-                        not self.widget_scene.draw_grid_secondary
-                    )
-                    if self.widget_scene.draw_grid_secondary:
+                    self.grid.draw_grid_secondary = not self.grid.draw_grid_secondary
+                    if self.grid.draw_grid_secondary:
 
                         if ox is None:
-                            self.widget_scene.grid_secondary_cx = None
-                            self.widget_scene.grid_secondary_cy = None
+                            self.grid.grid_secondary_cx = None
+                            self.grid.grid_secondary_cy = None
                             scalex = None
                             scaley = None
                         else:
                             if oy is None:
                                 oy = ox
-                            self.widget_scene.grid_secondary_cx = float(
+                            self.grid.grid_secondary_cx = float(
                                 Length(ox, relative_length=self.context.device.width)
                             )
-                            self.widget_scene.grid_secondary_cy = float(
+                            self.grid.grid_secondary_cy = float(
                                 Length(oy, relative_length=self.context.device.height)
                             )
                         if scalex is None:
                             rot = self.scene.context.rotary
                             if rot.rotary_enabled:
                                 scalex = rot.scale_x
                                 scaley = rot.scale_y
@@ -616,66 +636,232 @@
                                 scaley = 1.0
                         else:
                             scalex = float(scalex)
                         if scaley is None:
                             scaley = scalex
                         else:
                             scaley = float(scaley)
-                        self.widget_scene.grid_secondary_scale_x = scalex
-                        self.widget_scene.grid_secondary_scale_y = scaley
+                        self.grid.grid_secondary_scale_x = scalex
+                        self.grid.grid_secondary_scale_y = scaley
                     channel(
                         _(
                             "Turned secondary grid on"
-                            if self.widget_scene.draw_grid_secondary
+                            if self.grid.draw_grid_secondary
                             else "Turned secondary grid off"
                         )
                     )
                     self.scene.signal("guide")
                     self.scene.signal("grid")
                     self.request_refresh()
                 elif target[0] == "c":
-                    self.widget_scene.draw_grid_circular = (
-                        not self.widget_scene.draw_grid_circular
-                    )
-                    if self.widget_scene.draw_grid_circular:
+                    self.grid.draw_grid_circular = not self.grid.draw_grid_circular
+                    if self.grid.draw_grid_circular:
                         if ox is None:
-                            self.widget_scene.grid_circular_cx = None
-                            self.widget_scene.grid_circular_cy = None
+                            self.grid.grid_circular_cx = None
+                            self.grid.grid_circular_cy = None
                         else:
                             if oy is None:
                                 oy = ox
-                            self.widget_scene.grid_circular_cx = float(
+                            self.grid.grid_circular_cx = float(
                                 Length(ox, relative_length=self.context.device.width)
                             )
-                            self.widget_scene.grid_circular_cy = float(
+                            self.grid.grid_circular_cy = float(
                                 Length(oy, relative_length=self.context.device.height)
                             )
                     channel(
                         _(
                             "Turned circular grid on"
-                            if self.widget_scene.draw_grid_circular
+                            if self.grid.draw_grid_circular
                             else "Turned circular grid off"
                         )
                     )
                     self.scene.signal("guide")
                     self.scene.signal("grid")
                     self.request_refresh()
                 else:
                     channel(_("Target needs to be one of primary, secondary, circular"))
 
     def toggle_ref_obj(self):
         for e in self.scene.context.elements.flat(types=elem_nodes, emphasized=True):
-            if self.widget_scene.reference_object == e:
-                self.widget_scene.reference_object = None
+            if self.reference_object == e:
+                self.reference_object = None
             else:
-                self.widget_scene.reference_object = e
+                self.reference_object = e
             break
         self.context.signal("reference")
         self.request_refresh()
 
+    def validate_reference(self):
+        """
+        Check whether the reference is still valid
+        """
+        found = False
+        if self._reference:
+            for e in self.context.elements.flat(types=elem_nodes):
+                # Here we ignore the lock-status of an element
+                if e is self._reference:
+                    found = True
+                    break
+        if not found:
+            self._reference = None
+
+    @property
+    def reference_object(self):
+        return self._reference
+
+    @reference_object.setter
+    def reference_object(self, ref_object):
+        prev = self._reference
+        self._reference = ref_object
+        dlist = []
+        if prev is not None:
+            dlist.append(prev)
+        if self._reference is not None:
+            dlist.append(self._reference)
+        if len(dlist) > 0:
+            self.context.signal("element_property_update", dlist)
+
+    ##########
+    # MAGNETS
+    ##########
+
+    def clear_magnets(self):
+        self.magnet_x = []
+        self.magnet_y = []
+        self.context.signal("magnets", False)
+
+    def toggle_x_magnet(self, x_value):
+        prev = self.has_magnets()
+        if x_value in self.magnet_x:
+            self.magnet_x.remove(x_value)
+            # print("Remove x magnet for %.1f" % x_value)
+            now = self.has_magnets()
+        else:
+            self.magnet_x += [x_value]
+            # print("Add x magnet for %.1f" % x_value)
+            now = True
+        if prev != now:
+            self.context.signal("magnets", now)
+
+    def toggle_y_magnet(self, y_value):
+        prev = self.has_magnets()
+        if y_value in self.magnet_y:
+            self.magnet_y.remove(y_value)
+            # print("Remove y magnet for %.1f" % y_value)
+            now = self.has_magnets()
+        else:
+            self.magnet_y += [y_value]
+            now = True
+            # print("Add y magnet for %.1f" % y_value)
+        if prev != now:
+            self.context.signal("magnets", now)
+
+    def magnet_attracted_x(self, x_value, useit):
+        delta = float("inf")
+        x_val = None
+        if useit:
+            for mag_x in self.magnet_x:
+                if abs(x_value - mag_x) < delta:
+                    delta = abs(x_value - mag_x)
+                    x_val = mag_x
+        return delta, x_val
+
+    def magnet_attracted_y(self, y_value, useit):
+        delta = float("inf")
+        y_val = None
+        if useit:
+            for mag_y in self.magnet_y:
+                if abs(y_value - mag_y) < delta:
+                    delta = abs(y_value - mag_y)
+                    y_val = mag_y
+        return delta, y_val
+
+    def revised_magnet_bound(self, bounds=None):
+
+        dx = 0
+        dy = 0
+        if self.has_magnets() and self.magnet_attraction > 0:
+            if self.tick_distance > 0:
+                s = f"{self.tick_distance}{self.context.units_name}"
+                len_tick = float(Length(s))
+                # Attraction length is 1/3, 4/3, 9/3 of a grid-unit
+                # fmt: off
+                attraction_len = 1 / 3 * self.magnet_attraction * self.magnet_attraction * len_tick
+
+                # print("Attraction len=%s, attract=%d, alen=%.1f, tlen=%.1f, factor=%.1f" % (s, self.magnet_attraction, attraction_len, len_tick, attraction_len / len_tick ))
+                # fmt: on
+            else:
+                attraction_len = float(Length("1mm"))
+
+            delta_x1, x1 = self.magnet_attracted_x(bounds[0], self.magnet_attract_x)
+            delta_x2, x2 = self.magnet_attracted_x(bounds[2], self.magnet_attract_x)
+            delta_x3, x3 = self.magnet_attracted_x(
+                (bounds[0] + bounds[2]) / 2, self.magnet_attract_c
+            )
+            delta_y1, y1 = self.magnet_attracted_y(bounds[1], self.magnet_attract_y)
+            delta_y2, y2 = self.magnet_attracted_y(bounds[3], self.magnet_attract_y)
+            delta_y3, y3 = self.magnet_attracted_y(
+                (bounds[1] + bounds[3]) / 2, self.magnet_attract_c
+            )
+            if delta_x3 < delta_x1 and delta_x3 < delta_x2:
+                if delta_x3 < attraction_len:
+                    if x3 is not None:
+                        dx = x3 - (bounds[0] + bounds[2]) / 2
+                        # print("X Take center , x=%.1f, dx=%.1f" % ((bounds[0] + bounds[2]) / 2, dx)
+            elif delta_x1 < delta_x2 and delta_x1 < delta_x3:
+                if delta_x1 < attraction_len:
+                    if x1 is not None:
+                        dx = x1 - bounds[0]
+                        # print("X Take left side, x=%.1f, dx=%.1f" % (bounds[0], dx))
+            elif delta_x2 < delta_x1 and delta_x2 < delta_x3:
+                if delta_x2 < attraction_len:
+                    if x2 is not None:
+                        dx = x2 - bounds[2]
+                        # print("X Take right side, x=%.1f, dx=%.1f" % (bounds[2], dx))
+            if delta_y3 < delta_y1 and delta_y3 < delta_y2:
+                if delta_y3 < attraction_len:
+                    if y3 is not None:
+                        dy = y3 - (bounds[1] + bounds[3]) / 2
+                        # print("Y Take center , x=%.1f, dx=%.1f" % ((bounds[1] + bounds[3]) / 2, dy))
+            elif delta_y1 < delta_y2 and delta_y1 < delta_y3:
+                if delta_y1 < attraction_len:
+                    if y1 is not None:
+                        dy = y1 - bounds[1]
+                        # print("Y Take top side, y=%.1f, dy=%.1f" % (bounds[1], dy))
+            elif delta_y2 < delta_y1 and delta_y2 < delta_y3:
+                if delta_y2 < attraction_len:
+                    if y2 is not None:
+                        dy = y2 - bounds[3]
+                        # print("Y Take bottom side, y=%.1f, dy=%.1f" % (bounds[3], dy))
+
+        return dx, dy
+
+    def has_magnets(self):
+        return len(self.magnet_x) + len(self.magnet_y) > 0
+
+    ##############
+    # SNAPS
+    ##############
+
+    @property
+    def last_snap(self):
+        result = self._last_snap_position
+        # Too old? Discard
+        if (time.time() - self._last_snap_ts) > 0.5:
+            result = None
+        return result
+
+    @last_snap.setter
+    def last_snap(self, value):
+        self._last_snap_position = value
+        if value is None:
+            self._last_snap_ts = 0
+        else:
+            self._last_snap_ts = time.time()
+
     @signal_listener("draw_mode")
     def on_draw_mode(self, origin, *args):
         if self._tool_widget is not None:
             orgx = 5
             orgy = 5
             # Are guides drawn?
             if self.context.draw_mode & DRAW_MODE_GUIDES == 0:
@@ -717,26 +903,20 @@
             Toggle the draw mode for the background
             """
             self.widget_scene.context.draw_mode ^= DRAW_MODE_BACKGROUND
             self.widget_scene.request_refresh()
 
         def toggle_grid(gridtype):
             if gridtype == "primary":
-                self.widget_scene.draw_grid_primary = (
-                    not self.widget_scene.draw_grid_primary
-                )
+                self.grid.draw_grid_primary = not self.grid.draw_grid_primary
             elif gridtype == "secondary":
-                self.widget_scene.draw_grid_secondary = (
-                    not self.widget_scene.draw_grid_secondary
-                )
+                self.grid.draw_grid_secondary = not self.grid.draw_grid_secondary
             elif gridtype == "circular":
-                self.widget_scene.draw_grid_circular = (
-                    not self.widget_scene.draw_grid_circular
-                )
-            self.widget_scene.request_refresh()
+                self.grid.draw_grid_circular = not self.grid.draw_grid_circular
+            self.request_refresh()
 
         def toggle_grid_p(event=None):
             toggle_grid("primary")
 
         def toggle_grid_s(event=None):
             toggle_grid("secondary")
 
@@ -768,31 +948,31 @@
         id2 = menu.Append(
             wx.ID_ANY,
             _("Show Primary Grid"),
             _("Display the primary grid in the scene"),
             wx.ITEM_CHECK,
         )
         self.Bind(wx.EVT_MENU, toggle_grid_p, id=id2.GetId())
-        menu.Check(id2.GetId(), self.widget_scene.draw_grid_primary)
+        menu.Check(id2.GetId(), self.grid.draw_grid_primary)
         id3 = menu.Append(
             wx.ID_ANY,
             _("Show Secondary Grid"),
             _("Display the secondary grid in the scene"),
             wx.ITEM_CHECK,
         )
         self.Bind(wx.EVT_MENU, toggle_grid_s, id=id3.GetId())
-        menu.Check(id3.GetId(), self.widget_scene.draw_grid_secondary)
+        menu.Check(id3.GetId(), self.grid.draw_grid_secondary)
         id4 = menu.Append(
             wx.ID_ANY,
             _("Show Circular Grid"),
             _("Display the circular grid in the scene"),
             wx.ITEM_CHECK,
         )
         self.Bind(wx.EVT_MENU, toggle_grid_c, id=id4.GetId())
-        menu.Check(id4.GetId(), self.widget_scene.draw_grid_circular)
+        menu.Check(id4.GetId(), self.grid.draw_grid_circular)
         if self.widget_scene.has_background:
             menu.AppendSeparator()
             id5 = menu.Append(wx.ID_ANY, _("Remove Background"), "")
             self.Bind(wx.EVT_MENU, remove_background, id=id5.GetId())
         # Do we have a timer called .updatebg?
         we_have_a_job = False
         try:
@@ -863,15 +1043,15 @@
         self.request_refresh(origin)
 
     @signal_listener("magnet-attraction")
     def on_magnet(self, origin, strength, *args):
         strength = int(strength)
         if strength < 0:
             strength = 0
-        self.scene.scene.magnet_attraction = strength
+        self.magnet_attraction = strength
 
     def pane_show(self, *args):
         zl = self.context.zoom_margin
         self.context(f"scene focus -{zl}% -{zl}% {100 + zl}% {100 + zl}%\n")
 
     def pane_hide(self, *args):
         pass
@@ -978,15 +1158,15 @@
             color = None
         else:
             color = Color(rgb[0], rgb[1], rgb[2])
         self.widget_scene.context.elements.default_fill = color
 
     def on_key_down(self, event):
         keyvalue = get_key_name(event)
-        ignore = self.widget_scene.tool_active
+        ignore = self.tool_active
         if self._keybind_channel:
             self._keybind_channel(f"Scene key_down: {keyvalue}.")
         if not ignore and self.context.bind.trigger(keyvalue):
             if self._keybind_channel:
                 self._keybind_channel(f"Scene key_down: {keyvalue} executed.")
         else:
             if self._keybind_channel:
@@ -996,15 +1176,15 @@
                     )
                 else:
                     self._keybind_channel(f"Scene key_down: {keyvalue} unfound.")
         event.Skip()
 
     def on_key_up(self, event, log=True):
         keyvalue = get_key_name(event)
-        ignore = self.widget_scene.tool_active
+        ignore = self.tool_active
         if self._keybind_channel:
             self._keybind_channel(f"Scene key_up: {keyvalue}.")
         if not ignore and self.context.bind.untrigger(keyvalue):
             if self._keybind_channel:
                 self._keybind_channel(f"Scene key_up: {keyvalue} executed.")
         else:
             if self._keybind_channel:
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/wxmtree.py` & `meerk40t-0.8.3000/meerk40t/gui/wxmtree.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,11 +1,12 @@
 import wx
 from wx import aui
 
-from ..core.element_types import op_nodes
+from meerk40t.core.elements.element_types import op_nodes
+
 from ..core.units import Length
 from ..kernel import signal_listener
 from ..svgelements import Color
 from .icons import (
     get_default_scale_factor,
     icon_meerk40t,
     icons8_bell_20,
@@ -33,15 +34,14 @@
     icons8_scatter_plot_20,
     icons8_small_beam_20,
     icons8_smartphone_ram_50,
     icons8_stop_gesture_20,
     icons8_system_task_20,
     icons8_timer_20,
     icons8_type_50,
-    icons8_vector_20,
     icons8_visit_20,
     icons8_warning_shield_20,
 )
 from .laserrender import DRAW_MODE_ICONS, LaserRender, swizzlecolor
 from .mwindow import MWindow
 from .wxutils import create_menu, get_key_name, is_navigation_key
 
@@ -1492,15 +1492,15 @@
                 lockit = node.lock
             else:
                 lockit = False
             if lockit:
                 state_num = self.iconstates["lock"]
             scene = getattr(self.context.root, "mainscene", None)
             if scene is not None:
-                if node == scene.reference_object:
+                if node == scene.pane.reference_object:
                     state_num = self.iconstates["refobject"]
         if state_num < 0:
             state_num = wx.TREE_ITEMSTATE_NONE
             if (
                 node.type in op_nodes
                 and hasattr(node, "is_visible")
                 and not node.is_visible
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/wxutils.py` & `meerk40t-0.8.3000/meerk40t/gui/wxutils.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,14 +1,15 @@
 """
 Mixin functions for wxMeerk40t
 """
 import platform
 from typing import List
 
 import wx
+import wx.lib.mixins.listctrl as listmix
 from wx.lib.scrolledpanel import ScrolledPanel as SP
 
 from meerk40t.core.units import ACCEPTED_UNITS, Angle, Length
 
 _ = wx.GetTranslation
 
 
@@ -772,14 +773,26 @@
             self.SetVirtualSize(self.GetBestVirtualSize())
             if scrollToTop:
                 self.Scroll(0, 0)
         except RuntimeError:
             pass
 
 
+class EditableListCtrl(wx.ListCtrl, listmix.TextEditMixin):
+    """TextEditMixin allows any column to be edited."""
+
+    # ----------------------------------------------------------------------
+    def __init__(
+        self, parent, ID=wx.ID_ANY, pos=wx.DefaultPosition, size=wx.DefaultSize, style=0
+    ):
+        """Constructor"""
+        wx.ListCtrl.__init__(self, parent, ID, pos, size, style)
+        listmix.TextEditMixin.__init__(self)
+
+
 WX_METAKEYS = [
     wx.WXK_START,
     wx.WXK_WINDOWS_LEFT,
     wx.WXK_WINDOWS_RIGHT,
 ]
 
 WX_MODIFIERS = {
```

### Comparing `meerk40t-0.8.2000/meerk40t/gui/zmatrix.py` & `meerk40t-0.8.3000/meerk40t/gui/zmatrix.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/image/imagetools.py` & `meerk40t-0.8.3000/meerk40t/image/imagetools.py`

 * *Files 0% similar despite different names*

```diff
@@ -1778,25 +1778,28 @@
 
     @staticmethod
     def load(context, elements_service, pathname, **kwargs):
         if pathname is None:
             return False
         try:
             from PIL import Image as PILImage
+            from PIL.Image import DecompressionBombError
         except ImportError:
             return False
         try:
             image = PILImage.open(pathname)
+            image.copy()  # Throws error for .eps without ghostscript
         except OSError:
             return False
+        except DecompressionBombError as e:
+            raise BadFileError("Image is larger than 178 megapixels.") from e
         except subprocess.CalledProcessError as e:
             raise BadFileError(
                 "Cannot load an .eps file without GhostScript installed"
             ) from e
-        image.copy()  # Throws error for .eps without ghostscript
         _dpi = DEFAULT_PPI
         matrix = Matrix(f"scale({UNITS_PER_PIXEL})")
         try:
             context.setting(bool, "image_dpi", True)
             if context.image_dpi:
                 try:
                     dpi = image.info["dpi"]
```

### Comparing `meerk40t-0.8.2000/meerk40t/kernel/channel.py` & `meerk40t-0.8.3000/meerk40t/kernel/channel.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/kernel/context.py` & `meerk40t-0.8.3000/meerk40t/kernel/context.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/kernel/exceptions.py` & `meerk40t-0.8.3000/meerk40t/kernel/exceptions.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/kernel/functions.py` & `meerk40t-0.8.3000/meerk40t/kernel/functions.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/kernel/jobs.py` & `meerk40t-0.8.3000/meerk40t/kernel/jobs.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/kernel/kernel.py` & `meerk40t-0.8.3000/meerk40t/kernel/kernel.py`

 * *Files 1% similar despite different names*

```diff
@@ -28,41 +28,71 @@
 
 KERNEL_VERSION = "0.0.10"
 
 RE_ACTIVE = re.compile("service/(.*)/active")
 RE_AVAILABLE = re.compile("service/(.*)/available")
 
 
+class BusyInfo:
+    def __init__(self, **kwds):
+        self.busy_object = None
+        self.shown = False
+
+    def start(self, **kwds):
+        self.shown = True
+        return
+
+    def end(self):
+        self.shown = False
+        return
+
+    def change(self, **kwds):
+        return
+
+    def hide(self):
+        self.shown = False
+        return
+
+    def show(self):
+        self.shown = True
+        return
+
+
 class Kernel(Settings):
     """
     The Kernel serves as the central hub of communication between different objects within the system, stores the
     main lookup of registered objects, as well as providing a scheduler, signals, channels, and a command console to be
     used within the system.
 
     The Kernel stores a persistence object, thread interactions, contexts, a translation routine, a run_later operation,
     jobs for the scheduler, listeners for signals, channel information, a list of devices, registered commands.
     """
 
-    def __init__(self, name: str, version: str, profile: str, ansi: bool = True):
+    def __init__(
+        self,
+        name: str,
+        version: str,
+        profile: str,
+        ansi: bool = True,
+        ignore_settings: bool = False,
+    ):
         """
         Initialize the Kernel. This sets core attributes of the ecosystem that are accessible to all modules.
 
         Name: The application name.
         Version: The version number of the application.
         Profile: The name to save our data under (this is often the same as app name).
         """
         self.name = name
         self.profile = profile
         self.version = version
 
         # Persistent Settings
         Settings.__init__(
-            self,
-            self.name,
-            f"{profile}.cfg",
+            self, self.name, f"{profile}.cfg", ignore_settings=ignore_settings
         )
         self.settings = self
 
         # Boot State
         self._booted = False
         self._shutdown = False
         self._quit = False
@@ -1088,15 +1118,15 @@
         if hasattr(self.args, "set") and self.args.set is not None:
             # Set the variables requested here.
             for v in self.args.set:
                 try:
                     attr = v[0]
                     value = v[1]
                     self.console(f"set {attr} {value}\n")
-                except IndexError:
+                except (IndexError, TypeError):
                     break
 
     def poststart(self):
         if hasattr(self.args, "execute") and self.args.execute:
             # Any execute code segments gets executed here.
             self.channel("console").watch(self.__print_delegate)
             for v in self.args.execute:
@@ -3386,14 +3416,41 @@
             return data_type(value)
         except ValueError:
             return None
 
     # Prompt should be replaced with higher level versions of this depending on the user interface.
     prompt = _text_prompt
 
+    def _yes_no_prompt(self, prompt, option_yes=None, option_no=None, caption=None):
+        """
+        Kernel yesno should be replaced with higher level versions of this depending on the user interface.
+
+        Default this is purely text based input() yes_no_prompt.
+
+        @param prompt: question asked of the user.
+        @param option_yes: input to be interpreted as yes (first letter is okay too).
+        @param option_no: input to be interpreted as no (first letter is okay too).
+        @param caption: Ignored in the cli
+        @return:
+        """
+        if option_yes is None:
+            option_yes = "Yes"
+        if option_no is None:
+            option_yes = "No"
+        value = input(
+            prompt + "\n?" + f"({option_yes} / {option_no}, default={option_yes})\n"
+        )
+        if value is None or value == "":
+            value = option_yes
+        value = value.lower()
+        return bool(value == option_yes or value[0] == option_yes.lower()[0])
+
+    yesno = _yes_no_prompt
+    busyinfo = BusyInfo()
+
     # ==========
     # CONSOLE DECORATORS
     # ==========
 
     def console_argument(self, *args, **kwargs) -> Callable:
         """
         Delegate to Kernel
```

### Comparing `meerk40t-0.8.2000/meerk40t/kernel/lifecycles.py` & `meerk40t-0.8.3000/meerk40t/kernel/lifecycles.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/kernel/module.py` & `meerk40t-0.8.3000/meerk40t/kernel/module.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/kernel/service.py` & `meerk40t-0.8.3000/meerk40t/kernel/service.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/kernel/settings.py` & `meerk40t-0.8.3000/meerk40t/kernel/settings.py`

 * *Files 1% similar despite different names*

```diff
@@ -15,20 +15,21 @@
     divided up with various layers of `/` to make derivable sub-directories of settings.
 
     Reading/writing and deleting are performed on the config_dict which stores a set of values
     these are loaded during the `read_configuration` step and are committed to disk when
     `write_configuration` is called.
     """
 
-    def __init__(self, directory, filename):
+    def __init__(self, directory, filename, ignore_settings=False):
         self._config_file = Path(get_safe_path(directory, create=True)).joinpath(
             filename
         )
         self._config_dict = {}
-        self.read_configuration()
+        if not ignore_settings:
+            self.read_configuration()
 
     def __contains__(self, item):
         return item in self._config_dict
 
     def read_configuration(self, targetfile=None):
         """
         Read configuration reads the self._config_file to get the parsed config file data.
```

### Comparing `meerk40t-0.8.2000/meerk40t/lihuiyu/controller.py` & `meerk40t-0.8.3000/meerk40t/lihuiyu/controller.py`

 * *Files 2% similar despite different names*

```diff
@@ -246,15 +246,16 @@
                 self.connection = interface
                 for i in devices:
                     try:
                         self._open_at_index(i)
                         return  # Opened successfully.
                     except ConnectionRefusedError as e:
                         self.usb_log(str(e))
-                        self.connection.close()
+                        if self.connection is not None:
+                            self.connection.close()
                     except IndexError:
                         self.usb_log(_("Connection failed."))
                         self.connection = None
                         break
         except PermissionError:
             return  # OS denied permissions, no point checking anything else.
 
@@ -284,15 +285,15 @@
             version = self.connection.get_chip_version()
             if version != self.context.usb_version:
                 raise ConnectionRefusedError(
                     _(
                         "K40 devices were found but they were rejected due to chip version."
                     )
                 )
-        if self.context.serial_enable:
+        if self.context.serial_enable and self.context.serial is not None:
             if self.serial_confirmed:
                 return  # already passed.
             self.usb_log(_("Requires serial number confirmation."))
             self.challenge(self.context.serial)
             t = time.time()
             while time.time() - t < 0.5:
                 if self.serial_confirmed:
@@ -468,22 +469,29 @@
     def usb_reset(self):
         if self.connection:
             self.connection.reset()
         else:
             raise ConnectionError
 
     def challenge(self, serial):
+        if serial is None:
+            return
+
         from hashlib import md5
 
         challenge = bytearray.fromhex(md5(bytes(serial.upper(), "utf8")).hexdigest())
         packet = b"A%s" % challenge
         packet += b"F" * (30 - len(packet))
         packet = b"\x00" + packet + bytes([onewire_crc_lookup(packet)])
         self.connection.write(packet)
-        self._confirm_serial()
+        try:
+            self._confirm_serial()
+        except ConnectionError:
+            # If we could not access the status, then we did not confirm the serial number.
+            pass
 
     def update_state(self, state):
         if state == self.state:
             return
         self.state = state
         if self.context is not None:
             self.context.signal("pipe;thread", self.state)
```

### Comparing `meerk40t-0.8.2000/meerk40t/lihuiyu/device.py` & `meerk40t-0.8.3000/meerk40t/gui/laserpanel.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,692 +1,573 @@
-"""
-Lihuiyu Device
+import wx
+from wx import aui
 
-Registers the Device service for M2 Nano (and family), registering the relevant commands and provides the viewport for
-the given device type.
-"""
+from meerk40t.gui.choicepropertypanel import ChoicePropertyPanel
+from meerk40t.gui.icons import (
+    icons8_delete_50,
+    icons8_emergency_stop_button_50,
+    icons8_gas_industry_50,
+    icons8_goal_50,
+    icons8_laser_beam_hazard2_50,
+    icons8_pause_50,
+    icons8_pentagon_50,
+    icons8_save_50,
+)
+from meerk40t.gui.navigationpanels import Drag, Jog, MovePanel
+from meerk40t.gui.wxutils import StaticBoxSizer, disable_window
+from meerk40t.kernel import lookup_listener, signal_listener
+
+_ = wx.GetTranslation
+
+
+def register_panel_laser(window, context):
+    laser_panel = LaserPanel(window, wx.ID_ANY, context=context)
+    plan_panel = JobPanel(window, wx.ID_ANY, context=context)
+    from copy import copy
+
+    prechoices = context.lookup("choices/optimize")
+    choices = list(map(copy, prechoices))
+    # Clear the page-entry
+    for entry in choices:
+        entry["page"] = ""
+    optimize_panel = ChoicePropertyPanel(
+        window, wx.ID_ANY, context=context, choices=choices
+    )
+    jog_drag = wx.Panel(window, wx.ID_ANY)
+    jog_panel = Jog(jog_drag, wx.ID_ANY, context=context, icon_size=25)
+    drag_panel = Drag(jog_drag, wx.ID_ANY, context=context, icon_size=25)
+    main_sizer = wx.BoxSizer(wx.HORIZONTAL)
+    main_sizer.AddStretchSpacer()
+    main_sizer.Add(jog_panel, 0, wx.ALIGN_CENTER_VERTICAL, 0)
+    main_sizer.AddSpacer(25)
+    main_sizer.Add(drag_panel, 0, wx.ALIGN_CENTER_VERTICAL, 0)
+    main_sizer.AddStretchSpacer()
+    jog_drag.SetSizer(main_sizer)
+    jog_drag.Layout()
+    move_panel = MovePanel(window, wx.ID_ANY, context=context)
+    notebook = wx.aui.AuiNotebook(
+        window,
+        -1,
+        style=wx.aui.AUI_NB_TAB_EXTERNAL_MOVE
+        | wx.aui.AUI_NB_SCROLL_BUTTONS
+        | wx.aui.AUI_NB_TAB_SPLIT
+        | wx.aui.AUI_NB_TAB_MOVE
+        | wx.aui.AUI_NB_BOTTOM,
+    )
+    pane = (
+        aui.AuiPaneInfo()
+        .Left()
+        .MinSize(200, 180)
+        .FloatingSize(230, 300)
+        .MaxSize(500, 300)
+        .Caption(_("Laser-Control"))
+        .CaptionVisible(not context.pane_lock)
+        .Name("laser")
+    )
+    pane.submenu = "_10_" + _("Laser")
+    pane.control = notebook
+    pane.dock_proportion = 150
+    notebook.AddPage(laser_panel, _("Laser"))
+    notebook.AddPage(plan_panel, _("Plan"))
+    notebook.AddPage(optimize_panel, _("Optimize"))
+    notebook.AddPage(jog_drag, _("Jog"))
+    notebook.AddPage(move_panel, _("Move"))
+
+    window.on_pane_create(pane)
+    window.context.register("pane/laser", pane)
+    choices = [
+        {
+            "attr": "laserpane_arm",
+            "object": context.root,
+            "default": False,
+            "type": bool,
+            "label": _("Enable Laser Arm"),
+            "tip": _("Enable Laser Panel Arm/Disarm feature."),
+            "page": "Laser",
+            "section": "General",
+        },
+    ]
+    context.kernel.register_choices("preferences", choices)
 
-from hashlib import md5
 
-from meerk40t.core.laserjob import LaserJob
-from meerk40t.core.spoolers import Spooler
-from meerk40t.kernel import STATE_ACTIVE, STATE_PAUSE, CommandSyntaxError, Service
-
-from ..core.units import UNITS_PER_MIL, Length, ViewPort
-from .controller import LihuiyuController
-from .driver import LihuiyuDriver
-from .tcp_connection import TCPOutput
-
-
-class LihuiyuDevice(Service, ViewPort):
+class LaserPanel(wx.Panel):
     """
-    LihuiyuDevice is driver for the M2 Nano and other classes of Lihuiyu boards.
+    Contains all elements to control the execution of the job
     """
 
-    def __init__(self, kernel, path, *args, **kwargs):
-        Service.__init__(self, kernel, path)
-        self.name = "LihuiyuDevice"
-        _ = kernel.translation
-        self.extension = "egv"
-
-        choices = [
-            {
-                "attr": "bedwidth",
-                "object": self,
-                "default": "310mm",
-                "type": str,
-                "label": _("Width"),
-                "tip": _("Width of the laser bed."),
-            },
-            {
-                "attr": "bedheight",
-                "object": self,
-                "default": "210mm",
-                "type": str,
-                "label": _("Height"),
-                "tip": _("Height of the laser bed."),
-            },
-            {
-                "attr": "scale_x",
-                "object": self,
-                "default": 1.000,
-                "type": float,
-                "label": _("X Scale Factor"),
-                "tip": _(
-                    "Scale factor for the X-axis. Board units to actual physical units."
-                ),
-            },
-            {
-                "attr": "scale_y",
-                "object": self,
-                "default": 1.000,
-                "type": float,
-                "label": _("Y Scale Factor"),
-                "tip": _(
-                    "Scale factor for the Y-axis. Board units to actual physical units."
-                ),
-            },
-        ]
-
-        self.register_choices("bed_dim", choices)
-        self.setting(bool, "swap_xy", False)
-        self.setting(bool, "flip_x", False)
-        self.setting(bool, "flip_y", False)
-        self.setting(bool, "home_right", False)
-        self.setting(bool, "home_bottom", False)
-        # Tuple contains 4 value pairs: Speed Low, Speed High, Power Low, Power High, each with enabled, value
-        self.setting(
-            list, "dangerlevel_op_cut", (False, 0, False, 0, False, 0, False, 0)
-        )
-        self.setting(
-            list, "dangerlevel_op_engrave", (False, 0, False, 0, False, 0, False, 0)
-        )
-        self.setting(
-            list, "dangerlevel_op_hatch", (False, 0, False, 0, False, 0, False, 0)
-        )
-        self.setting(
-            list, "dangerlevel_op_raster", (False, 0, False, 0, False, 0, False, 0)
-        )
-        self.setting(
-            list, "dangerlevel_op_image", (False, 0, False, 0, False, 0, False, 0)
-        )
-        self.setting(
-            list, "dangerlevel_op_dots", (False, 0, False, 0, False, 0, False, 0)
-        )
-        ViewPort.__init__(
-            self,
-            self.bedwidth,
-            self.bedheight,
-            user_scale_x=self.scale_x,
-            user_scale_y=self.scale_y,
-            native_scale_x=UNITS_PER_MIL,
-            native_scale_y=UNITS_PER_MIL,
-            origin_x=1.0 if self.home_right else 0.0,
-            origin_y=1.0 if self.home_bottom else 0.0,
-            flip_x=self.flip_x,
-            flip_y=self.flip_y,
-            swap_xy=self.swap_xy,
-            show_flip_x=self.home_right,
-            show_flip_y=self.home_bottom,
-        )
-        self.setting(bool, "opt_rapid_between", True)
-        self.setting(int, "opt_jog_mode", 0)
-        self.setting(int, "opt_jog_minimum", 256)
-        self.setting(bool, "rapid_override", False)
-        self.setting(float, "rapid_override_speed_x", 50.0)
-        self.setting(float, "rapid_override_speed_y", 50.0)
-        self.setting(bool, "plot_shift", False)
-
-        self.setting(bool, "strict", False)
-        self.setting(int, "buffer_max", 900)
-        self.setting(bool, "buffer_limit", True)
-
-        self.setting(bool, "autolock", True)
-
-        self.setting(str, "board", "M2")
-        self.setting(bool, "fix_speeds", False)
-
-        self.setting(int, "usb_index", -1)
-        self.setting(int, "usb_bus", -1)
-        self.setting(int, "usb_address", -1)
-        self.setting(int, "usb_version", -1)
-        self.setting(bool, "mock", False)
-        self.setting(bool, "show_usb_log", False)
-
-        self.setting(bool, "networked", False)
-        self.setting(int, "packet_count", 0)
-        self.setting(int, "rejected_count", 0)
-        self.setting(str, "serial", None)
-        self.setting(bool, "serial_enable", False)
-
-        self.setting(int, "port", 1022)
-        self.setting(str, "address", "localhost")
-        self.setting(str, "label", "m2nano")
-
-        self.setting(bool, "twitches", False)
-
-        self.setting(bool, "scale_speed_enabled", False)
-        self.setting(float, "scale_speed", 1.000)
-        self.setting(bool, "max_speed_vector_enabled", False)
-        self.setting(float, "max_speed_vector", 100.0)
-        self.setting(bool, "max_speed_raster_enabled", False)
-        self.setting(float, "max_speed_raster", 750.0)
-
-        self.driver = LihuiyuDriver(self)
-        self.spooler = Spooler(self, driver=self.driver)
-        self.add_service_delegate(self.spooler)
-
-        self.tcp = TCPOutput(self)
-        self.add_service_delegate(self.tcp)
-
-        self.controller = LihuiyuController(self)
-        self.add_service_delegate(self.controller)
-
-        self.driver.out_pipe = self.controller if not self.networked else self.tcp
-
-        _ = self.kernel.translation
-
-        @self.console_option(
-            "idonotlovemyhouse",
-            type=bool,
-            action="store_true",
-            help=_("override one second laser fire pulse duration"),
-        )
-        @self.console_argument("time", type=float, help=_("laser fire pulse duration"))
-        @self.console_command(
-            "pulse",
-            help=_("pulse <time>: Pulse the laser in place."),
-        )
-        def pulse(command, channel, _, time=None, idonotlovemyhouse=False, **kwargs):
-            if time is None:
-                channel(_("Must specify a pulse time in milliseconds."))
-                return
-            if time > 1000.0:
-                channel(
-                    _(
-                        '"{time}ms" exceeds 1 second limit to fire a standing laser.'
-                    ).format(time=time)
-                )
-                try:
-                    if not idonotlovemyhouse:
-                        return
-                except IndexError:
-                    return
-
-            def timed_fire():
-                yield "wait_finish"
-                yield "laser_on"
-                yield "wait", time
-                yield "laser_off"
-
-            if self.spooler.is_idle:
-                label = _("Pulse laser for {time}ms").format(time=time)
-                self.spooler.laserjob(list(timed_fire()), label=label, helper=True)
-                channel(label)
+    def __init__(self, *args, context=None, **kwds):
+        # begin wxGlade: MovePanel.__init__
+        kwds["style"] = kwds.get("style", 0) | wx.TAB_TRAVERSAL
+        wx.Panel.__init__(self, *args, **kwds)
+        self.context = context
+
+        sizer_main = wx.BoxSizer(wx.VERTICAL)
+
+        sizer_devices = StaticBoxSizer(self, wx.ID_ANY, _("Device"), wx.HORIZONTAL)
+        sizer_main.Add(sizer_devices, 0, wx.EXPAND, 0)
+
+        # Devices Initialize.
+        self.available_devices = self.context.kernel.services("device")
+
+        self.selected_device = self.context.device
+        index = -1
+        for i, s in enumerate(self.available_devices):
+            if s is self.selected_device:
+                index = i
+                break
+        spools = [s.label for s in self.available_devices]
+
+        self.combo_devices = wx.ComboBox(
+            self, wx.ID_ANY, choices=spools, style=wx.CB_DROPDOWN | wx.CB_READONLY
+        )
+        self.combo_devices.SetToolTip(
+            _("Select device from list of configured devices")
+        )
+        self.combo_devices.SetSelection(index)
+
+        sizer_devices.Add(self.combo_devices, 1, wx.ALIGN_CENTER_VERTICAL, 0)
+
+        sizer_control = wx.BoxSizer(wx.HORIZONTAL)
+        sizer_main.Add(sizer_control, 0, wx.EXPAND, 0)
+
+        self.button_start = wx.Button(self, wx.ID_ANY, _("Start"))
+        self.button_start.SetToolTip(_("Execute the Job"))
+        self.button_start.SetBitmap(icons8_gas_industry_50.GetBitmap(resize=25))
+        self.button_start.SetBackgroundColour(wx.Colour(0, 127, 0))
+        sizer_control.Add(self.button_start, 1, 0, 0)
+
+        self.button_pause = wx.Button(self, wx.ID_ANY, _("Pause"))
+        self.button_pause.SetForegroundColour(wx.BLACK)  # Dark Mode correction.
+        self.button_pause.SetToolTip(_("Pause/Resume the laser"))
+        self.button_pause.SetBitmap(
+            icons8_pause_50.GetBitmap(resize=25, use_theme=False)
+        )
+        self.button_pause.SetBackgroundColour(wx.Colour(255, 255, 0))
+        sizer_control.Add(self.button_pause, 1, 0, 0)
+
+        self.button_stop = wx.Button(self, wx.ID_ANY, _("Stop"))
+        self.button_stop.SetToolTip(_("Stop the laser"))
+        self.button_stop.SetBitmap(icons8_emergency_stop_button_50.GetBitmap(resize=25))
+        self.button_stop.SetBackgroundColour(wx.Colour(127, 0, 0))
+        sizer_control.Add(self.button_stop, 1, 0, 0)
+
+        sizer_control_misc = wx.BoxSizer(wx.HORIZONTAL)
+        sizer_main.Add(sizer_control_misc, 0, wx.EXPAND, 0)
+
+        self.arm_toggle = wx.ToggleButton(self, wx.ID_ANY, _("Arm"))
+        self.arm_toggle.SetToolTip(_("Arm the job for execution"))
+        sizer_control_misc.Add(self.arm_toggle, 1, wx.ALIGN_CENTER, 0)
+
+        self.check_laser_arm()
+
+        self.button_outline = wx.Button(self, wx.ID_ANY, _("Outline"))
+        self.button_outline.SetToolTip(_("Trace the outline the job"))
+        self.button_outline.SetBitmap(icons8_pentagon_50.GetBitmap(resize=25))
+        sizer_control_misc.Add(self.button_outline, 1, 0, 0)
+
+        self.button_simulate = wx.Button(self, wx.ID_ANY, _("Simulate"))
+        self.button_simulate.SetToolTip(_("Simulate the Design"))
+        self.button_simulate.SetBitmap(
+            icons8_laser_beam_hazard2_50.GetBitmap(resize=25)
+        )
+        sizer_control_misc.Add(self.button_simulate, 1, 0, 0)
+
+        sizer_control_update = wx.BoxSizer(wx.HORIZONTAL)
+        sizer_main.Add(sizer_control_update, 0, wx.EXPAND, 0)
+
+        sizer_source = wx.BoxSizer(wx.HORIZONTAL)
+        sizer_main.Add(sizer_source, 0, wx.EXPAND, 0)
+        self.checkbox_optimize = wx.CheckBox(self, wx.ID_ANY, _("Optimize"))
+        self.checkbox_optimize.SetToolTip(_("Enable/Disable Optimize"))
+        self.checkbox_optimize.SetValue(1)
+        self.checkbox_adjust = wx.CheckBox(self, wx.ID_ANY, _("Override"))
+        self.checkbox_adjust.SetToolTip(
+            _("Allow ad-hoc adjustment of speed and power.")
+            + "\n"
+            + _("This affects running jobs, so use with care!")
+        )
+
+        sizer_source.Add(self.checkbox_optimize, 1, wx.ALIGN_CENTER_VERTICAL, 0)
+        sizer_source.Add(self.checkbox_adjust, 1, wx.ALIGN_CENTER_VERTICAL, 0)
+        sizer_manipulate = wx.BoxSizer(wx.VERTICAL)
+        sizer_main.Add(sizer_manipulate, 0, wx.EXPAND, 0)
+
+        self.sizer_power = wx.BoxSizer(wx.HORIZONTAL)
+        sizer_manipulate.Add(self.sizer_power, 0, wx.EXPAND, 0)
+        lb_power = wx.StaticText(self, wx.ID_ANY, _("Power"))
+        self.label_power = wx.StaticText(self, wx.ID_ANY, "0%")
+        self.slider_power = wx.Slider(
+            self, wx.ID_ANY, value=10, minValue=1, maxValue=20
+        )
+        self.sizer_power.Add(lb_power, 1, wx.ALIGN_CENTER_VERTICAL, 0)
+        self.sizer_power.Add(self.slider_power, 3, wx.ALIGN_CENTER_VERTICAL, 0)
+        self.sizer_power.Add(self.label_power, 1, wx.ALIGN_CENTER_VERTICAL, 0)
+        self.slider_power.SetToolTip(
+            _("Increases/decreases the regular laser power by this amount.")
+            + "\n"
+            + _("This affects running jobs, so use with care!")
+        )
+
+        self.sizer_speed = wx.BoxSizer(wx.HORIZONTAL)
+        sizer_manipulate.Add(self.sizer_speed, 0, wx.EXPAND, 0)
+        lb_speed = wx.StaticText(self, wx.ID_ANY, _("Speed"))
+        self.label_speed = wx.StaticText(self, wx.ID_ANY, "0%")
+        self.slider_size = 20
+        self.slider_speed = wx.Slider(
+            self, wx.ID_ANY, value=10, minValue=1, maxValue=20
+        )
+        self.sizer_speed.Add(lb_speed, 1, wx.ALIGN_CENTER_VERTICAL, 0)
+        self.sizer_speed.Add(self.slider_speed, 3, wx.ALIGN_CENTER_VERTICAL, 0)
+        self.sizer_speed.Add(self.label_speed, 1, wx.ALIGN_CENTER_VERTICAL, 0)
+        self.slider_speed.SetToolTip(
+            _("Increases/decreases the regular speed by this amount.")
+            + "\n"
+            + _("This affects running jobs, so use with care!")
+        )
+
+        self.SetSizer(sizer_main)
+        self.Layout()
+
+        self.Bind(wx.EVT_BUTTON, self.on_button_start, self.button_start)
+        self.Bind(wx.EVT_BUTTON, self.on_button_pause, self.button_pause)
+        self.Bind(wx.EVT_BUTTON, self.on_button_stop, self.button_stop)
+        self.Bind(wx.EVT_TOGGLEBUTTON, self.on_check_arm, self.arm_toggle)
+        self.Bind(wx.EVT_RIGHT_DOWN, self.on_menu_arm, self)
+        self.Bind(wx.EVT_BUTTON, self.on_button_outline, self.button_outline)
+        self.button_outline.Bind(wx.EVT_RIGHT_DOWN, self.on_button_outline_right)
+        self.Bind(wx.EVT_BUTTON, self.on_button_simulate, self.button_simulate)
+        self.Bind(wx.EVT_COMBOBOX, self.on_combo_devices, self.combo_devices)
+        self.Bind(wx.EVT_CHECKBOX, self.on_check_adjust, self.checkbox_adjust)
+        self.Bind(wx.EVT_SLIDER, self.on_slider_speed, self.slider_speed)
+        self.Bind(wx.EVT_SLIDER, self.on_slider_power, self.slider_power)
+        # end wxGlade
+        if index == -1:
+            disable_window(self)
+        self.checkbox_adjust.SetValue(False)
+        self.on_check_adjust(None)
+        self.update_override_controls()
+
+    def update_override_controls(self):
+        flag_power = False
+        override = False
+        if hasattr(self.context.device.driver, "has_adjustable_power"):
+            if self.context.device.driver.has_adjustable_power:
+                flag_power = True
+                # Let's establish the value and update the slider...
+                value = self.context.device.driver.power_scale
+                if value != 1:
+                    override = True
+                half = self.slider_size / 2
+                sliderval = int(value * half)
+                sliderval = max(1, min(self.slider_size, sliderval))
+                self.slider_power.SetValue(sliderval)
+                self.on_slider_speed(None)
+        flag_speed = False
+        if hasattr(self.context.device.driver, "has_adjustable_speed"):
+            if self.context.device.driver.has_adjustable_speed:
+                flag_speed = True
+                # Let's establish the value and update the slider...
+                value = self.context.device.driver.speed_scale
+                if value != 1:
+                    override = True
+                half = self.slider_size / 2
+                sliderval = int(value * half)
+                sliderval = max(1, min(self.slider_size, sliderval))
+                self.slider_speed.SetValue(sliderval)
+                self.on_slider_speed(None)
+
+        self.sizer_power.Show(flag_power)
+        self.sizer_power.ShowItems(flag_power)
+        self.sizer_power.Layout()
+        self.sizer_speed.Show(flag_speed)
+        self.sizer_speed.ShowItems(flag_speed)
+        self.sizer_speed.Layout()
+        self.checkbox_adjust.Show(bool(flag_power or flag_speed))
+        self.checkbox_adjust.SetValue(override)
+        self.slider_power.Enable(override)
+        self.slider_speed.Enable(override)
+        self.Layout()
+
+    def on_check_adjust(self, event):
+        if self.checkbox_adjust.GetValue():
+            self.slider_power.Enable(True)
+            self.slider_speed.Enable(True)
+        else:
+            self.slider_power.Enable(False)
+            self.slider_speed.Enable(False)
+            if hasattr(self.context.device.driver, "has_adjustable_power"):
+                if self.context.device.driver.has_adjustable_power:
+                    self.context.device.driver.power_scale = 1.0
+                    self.slider_power.SetValue(10)
+                    self.on_slider_power(None)
+            if hasattr(self.context.device.driver, "has_adjustable_speed"):
+                if self.context.device.driver.has_adjustable_speed:
+                    self.context.device.driver.speed_scale = 1.0
+                    self.slider_speed.SetValue(10)
+                    self.on_slider_speed(None)
+
+    def on_slider_speed(self, event):
+        sliderval = self.slider_speed.GetValue()
+        half = self.slider_size / 2
+        newvalue = sliderval - half  # -> -9 to +10
+        factor = 1 + newvalue / half
+        if event is not None:
+            self.context.device.driver.set_speed_scale(factor)
+        msg = f"{'+' if factor > 1 else ''}{100 * (factor - 1.0):.0f}%"
+        self.label_speed.SetLabel(msg)
+
+    def on_slider_power(self, event):
+        sliderval = self.slider_power.GetValue()
+        half = self.slider_size / 2
+        newvalue = sliderval - half  # -> -9 to +10
+        factor = 1 + newvalue / half
+        if event is not None:
+            self.context.device.driver.set_power_scale(factor)
+        msg = f"{'+' if factor > 1 else ''}{100 * (factor - 1.0):.0f}%"
+        self.label_power.SetLabel(msg)
+
+    @signal_listener("device;modified")
+    @signal_listener("device;renamed")
+    @lookup_listener("service/device/active")
+    @lookup_listener("service/device/available")
+    def spooler_lookup(self, *args):
+        # Devices Initialize.
+        self.available_devices = self.context.kernel.services("device")
+        self.selected_device = self.context.device
+        index = -1
+        self.combo_devices.Clear()
+        for i, spool in enumerate(self.available_devices):
+            if index < 0 and spool is self.selected_device:
+                index = i
+            self.combo_devices.Append(spool.label)
+        self.combo_devices.SetSelection(index)
+        self.set_pause_color()
+        self.update_override_controls()
+
+    def set_pause_color(self):
+        new_color = None
+        new_caption = _("Pause")
+        try:
+            if self.context.device.driver.paused:
+                new_color = wx.YELLOW
+                new_caption = _("Resume")
+        except AttributeError:
+            pass
+        self.button_pause.SetBackgroundColour(new_color)
+        self.button_pause.SetLabelText(new_caption)
+
+    @signal_listener("pause")
+    def on_device_pause_toggle(self, origin, *args):
+        self.set_pause_color()
+
+    @signal_listener("laserpane_arm")
+    def check_laser_arm(self, *args):
+        self.context.setting(bool, "laserpane_arm", True)
+        if self.context.laserpane_arm:
+            if not self.arm_toggle.Shown:
+                self.arm_toggle.Show(True)
+                self.Layout()
+            if self.arm_toggle.GetValue():
+                self.arm_toggle.SetBackgroundColour(wx.RED)
+                self.button_start.Enable(True)
             else:
-                channel(_("Pulse laser failed: Busy"))
-            return
+                self.arm_toggle.SetBackgroundColour(wx.GREEN)
+                self.button_start.Enable(False)
+        else:
+            if self.arm_toggle.Shown:
+                self.arm_toggle.Show(False)
+                self.Layout()
+            self.button_start.Enable(True)
+
+    def on_check_arm(self, event):
+        self.check_laser_arm()
+
+    def on_menu_arm_enable(self, event):
+        self.context.laserpane_arm = True
+        self.check_laser_arm()
+
+    def on_menu_arm_disable(self, event):
+        self.context.laserpane_arm = False
+        self.check_laser_arm()
+
+    def on_menu_arm(self, event):
+        menu = wx.Menu()
+        if not self.context.laserpane_arm:
+            self.Bind(
+                wx.EVT_MENU,
+                self.on_menu_arm_enable,
+                menu.Append(wx.ID_ANY, _("Enable Arm Requirement"), _("Enable Arm")),
+            )
+        else:
+            self.Bind(
+                wx.EVT_MENU,
+                self.on_menu_arm_disable,
+                menu.Append(wx.ID_ANY, _("Disable Arm Requirement"), _("Disable Arm")),
+            )
+        self.PopupMenu(menu)
+        menu.Destroy()
 
-        @self.console_argument("speed", type=float, help=_("Set the movement speed"))
-        @self.console_argument("dx", type=Length, help=_("change in x"))
-        @self.console_argument("dy", type=Length, help=_("change in y"))
-        @self.console_command(
-            "move_at_speed",
-            help=_("move_at_speed <speed> <dx> <dy>"),
-            all_arguments_required=True,
-        )
-        def move_speed(channel, _, speed, dx, dy, **kwgs):
-            def move_at_speed():
-                yield "set", "speed", speed
-                yield "program_mode"
-                yield "move_rel", dx.length_mil, dy.length_mil
-                yield "rapid_mode"
-
-            if self.spooler.is_idle:
-                self.spooler.laserjob(
-                    list(move_at_speed()),
-                    label=f"move {dx} {dy} at {speed}",
-                    helper=True,
+    def on_button_start(self, event):  # wxGlade: LaserPanel.<event_handler>
+        plan = self.context.planner.get_or_make_plan("z")
+        if plan.plan and self.context.laserpane_hold:
+            self.context("planz spool\n")
+        else:
+            if self.checkbox_optimize.GetValue():
+                self.context(
+                    "planz clear copy preprocess validate blob preopt optimize spool\n"
                 )
             else:
-                channel(_("Busy"))
-            return
-
-        @self.console_option(
-            "difference",
-            "d",
-            type=bool,
-            action="store_true",
-            help=_("Change speed by this amount."),
-        )
-        @self.console_argument("speed", type=str, help=_("Set the driver speed."))
-        @self.console_command(
-            "speed", input_type="lihuiyu", help=_("Set current speed of driver.")
-        )
-        def speed(
-            command, channel, _, data=None, speed=None, difference=False, **kwargs
-        ):
-            spooler, driver, output = data
-            if speed is None:
-                current_speed = driver.speed
-                if current_speed is None:
-                    channel(_("Speed is unset."))
-                else:
-                    channel(
-                        _("Speed set at: {speed} mm/s").format(
-                            speed=driver.settings.speed
-                        )
+                self.context("planz clear copy preprocess validate blob spool\n")
+        self.arm_toggle.SetValue(False)
+        self.check_laser_arm()
+        if self.context.auto_spooler:
+            self.context("window open JobSpooler\n")
+
+    def on_button_pause(self, event):  # wxGlade: LaserPanel.<event_handler>
+        self.context("pause\n")
+
+    def on_button_stop(self, event):  # wxGlade: LaserPanel.<event_handler>
+        self.context("estop\n")
+
+    def on_button_outline(self, event):  # wxGlade: LaserPanel.<event_handler>
+        self.context("element* trace hull\n")
+
+    def on_button_outline_right(self, event):  # wxGlade: LaserPanel.<event_handler>
+        self.context("element* trace complex\n")
+
+    def on_button_simulate(self, event):  # wxGlade: LaserPanel.<event_handler>
+        with wx.BusyInfo(_("Preparing simulation...")):
+            plan = self.context.planner.get_or_make_plan("z")
+            if not plan.plan or not self.context.laserpane_hold:
+                if self.checkbox_optimize.GetValue():
+                    self.context(
+                        "planz clear copy preprocess validate blob preopt optimize\n"
                     )
-                return
-            if speed.endswith("%"):
-                speed = speed[:-1]
-                percent = True
-            else:
-                percent = False
-            try:
-                s = float(speed)
-            except ValueError:
-                channel(_("Not a valid speed or percent."))
-                return
-            if percent and difference:
-                s = driver.speed + driver.speed * (s / 100.0)
-            elif difference:
-                s += driver.speed
-            elif percent:
-                s = driver.speed * (s / 100.0)
-            driver.set("speed", s)
-            channel(_("Speed set at: {speed} mm/s").format(speed=driver.speed))
-
-        @self.console_argument("ppi", type=int, help=_("pulses per inch [0-1000]"))
-        @self.console_command("power", help=_("Set Driver Power"))
-        def power(command, channel, _, ppi=None, **kwargs):
-            original_power = self.driver.power
-            if ppi is None:
-                if original_power is None:
-                    channel(_("Power is not set."))
+                    param = "1"
                 else:
-                    channel(
-                        _("Power set at: {power} pulses per inch").format(
-                            power=original_power
-                        )
-                    )
-            else:
-                self.driver.set("power", ppi)
+                    self.context("planz clear copy preprocess validate blob\n")
+                    param = "0"
+            self.context(f"window open Simulation z 0 {param}\n")
+
+    def on_combo_devices(self, event):  # wxGlade: LaserPanel.<event_handler>
+        index = self.combo_devices.GetSelection()
+        self.selected_device = self.available_devices[index]
+        self.selected_device.kernel.activate_service_path(
+            "device", self.selected_device.path
+        )
+        # Device change, so let's focus properly...
+        zl = self.context.zoom_margin
+        self.context(f"scene focus -{zl}% -{zl}% {100 + zl}% {100 + zl}%\n")
+        self.set_pause_color()
 
-        @self.console_argument("accel", type=int, help=_("Acceleration amount [1-4]"))
-        @self.console_command(
-            "acceleration",
-            help=_("Set Driver Acceleration [1-4]"),
-        )
-        def acceleration(channel, _, accel=None, **kwargs):
-            """
-            Lhymicro-gl speedcodes have a single character of either 1,2,3,4 which indicates
-            the acceleration value of the laser. This is typically 1 below 25.4, 2 below 60,
-            3 below 127, and 4 at any value greater than that. Manually setting this on the
-            fly can be used to check the various properties of that mode.
-            """
-            if accel is None:
-                if self.driver.acceleration is None:
-                    channel(_("Acceleration is set to default."))
-                else:
-                    channel(
-                        _("Acceleration: {acceleration}").format(
-                            acceleration=self.driver.acceleration
-                        )
-                    )
 
-            else:
-                try:
-                    v = accel
-                    if v not in (1, 2, 3, 4):
-                        self.driver.set("acceleration", None)
-                        channel(_("Acceleration is set to default."))
-                        return
-                    self.driver.set("acceleration", v)
-                    channel(
-                        _("Acceleration: {acceleration}").format(
-                            acceleration=self.driver.acceleration
-                        )
-                    )
-                except ValueError:
-                    channel(_("Invalid Acceleration [1-4]."))
-                    return
-
-        @self.console_command(
-            "viewport_update",
-            hidden=True,
-            help=_("Update m2nano codes for movement"),
-        )
-        def codes_update(**kwargs):
-            self.realize()
-
-        @self.console_command(
-            "network_update",
-            hidden=True,
-            help=_("Updates network state for m2nano networked."),
-        )
-        def network_update(**kwargs):
-            self.driver.out_pipe = self.controller if not self.networked else self.tcp
-
-        @self.console_command(
-            "status",
-            help=_("abort waiting process on the controller."),
-        )
-        def realtime_status(channel, _, **kwargs):
-            try:
-                self.controller.update_status()
-                channel(str(self.controller._status))
-            except ConnectionError:
-                channel(_("Could not check status, usb not connected."))
-
-        @self.console_command(
-            "continue",
-            help=_("abort waiting process on the controller."),
-        )
-        def realtime_continue(**kwargs):
-            self.controller.abort_waiting = True
-
-        @self.console_command(
-            "pause",
-            help=_("realtime pause/resume of the machine"),
-        )
-        def realtime_pause(**kwargs):
-            if self.driver.paused:
-                self.driver.resume()
-            else:
-                self.driver.pause()
-            self.signal("pause")
+class JobPanel(wx.Panel):
+    """
+    Contains all elements to plan and save the job
+    """
 
-        @self.console_command(("estop", "abort"), help=_("Abort Job"))
-        def pipe_abort(channel, _, **kwargs):
-            self.driver.reset()
-            channel(_("Lihuiyu Channel Aborted."))
-            self.signal("pipe;running", False)
-
-        @self.console_argument(
-            "rapid_x", type=float, help=_("limit x speed for rapid.")
-        )
-        @self.console_argument(
-            "rapid_y", type=float, help=_("limit y speed for rapid.")
-        )
-        @self.console_command(
-            "rapid_override",
-            help=_("limit speed of typical rapid moves."),
-        )
-        def rapid_override(channel, _, rapid_x=None, rapid_y=None, **kwargs):
-            if rapid_x is not None:
-                if rapid_y is None:
-                    rapid_y = rapid_x
-                self.rapid_override = True
-                self.rapid_override_speed_x = rapid_x
-                self.rapid_override_speed_y = rapid_y
-                channel(
-                    _("Rapid Limit: {max_x}, {max_y}").format(
-                        max_x=self.rapid_override_speed_x,
-                        max_y=self.rapid_override_speed_y,
-                    )
-                )
+    def __init__(self, *args, context=None, **kwds):
+        # begin wxGlade: MovePanel.__init__
+        kwds["style"] = kwds.get("style", 0) | wx.TAB_TRAVERSAL
+        wx.Panel.__init__(self, *args, **kwds)
+        self.context = context
+
+        sizer_main = wx.BoxSizer(wx.VERTICAL)
+
+        sizer_control_update = wx.BoxSizer(wx.HORIZONTAL)
+        sizer_main.Add(sizer_control_update, 0, wx.EXPAND, 0)
+
+        self.button_clear = wx.Button(self, wx.ID_ANY, _("Clear"))
+        self.button_clear.SetToolTip(_("Clear locally defined plan"))
+        self.button_clear.SetBitmap(icons8_delete_50.GetBitmap(resize=25))
+        sizer_control_update.Add(self.button_clear, 1, 0, 0)
+
+        self.button_update = wx.Button(self, wx.ID_ANY, _("Update"))
+        self.button_update.SetToolTip(_("Update the Plan"))
+        self.button_update.SetBitmap(icons8_goal_50.GetBitmap(resize=25))
+        sizer_control_update.Add(self.button_update, 1, 0, 0)
+
+        self.button_save_file = wx.Button(self, wx.ID_ANY, _("Save"))
+        self.button_save_file.SetToolTip(_("Save the job"))
+        self.button_save_file.SetBitmap(icons8_save_50.GetBitmap(resize=25))
+        sizer_control_update.Add(self.button_save_file, 1, 0, 0)
+
+        sizer_source = wx.BoxSizer(wx.HORIZONTAL)
+        sizer_main.Add(sizer_source, 0, wx.EXPAND, 0)
+
+        self.text_plan = wx.TextCtrl(
+            self, wx.ID_ANY, _(_("--- Empty ---")), style=wx.TE_READONLY
+        )
+        sizer_source.Add(self.text_plan, 2, 0, 0)
+
+        self.context.setting(bool, "laserpane_hold", False)
+        self.checkbox_hold = wx.CheckBox(self, wx.ID_ANY, _("Hold"))
+        self.checkbox_hold.SetToolTip(
+            _("Preserve the job between running, rerunning, and execution")
+        )
+        self.checkbox_hold.SetValue(self.context.laserpane_hold)
+        sizer_source.Add(self.checkbox_hold, 1, wx.ALIGN_CENTER_VERTICAL, 0)
+
+        self.SetSizer(sizer_main)
+        self.Layout()
+
+        self.Bind(wx.EVT_CHECKBOX, self.on_check_hold, self.checkbox_hold)
+        self.Bind(wx.EVT_BUTTON, self.on_button_save, self.button_save_file)
+        # self.Bind(wx.EVT_BUTTON, self.on_button_load, self.button_load)
+        self.Bind(wx.EVT_BUTTON, self.on_button_clear, self.button_clear)
+        self.Bind(wx.EVT_BUTTON, self.on_button_update, self.button_update)
+
+    @signal_listener("plan")
+    def plan_update(self, origin, *message):
+        plan_name, stage = message[0], message[1]
+        if plan_name == "z":
+            plan = self.context.planner.get_or_make_plan("z")
+            if not len(plan.plan):
+                self.text_plan.SetValue(_("--- Empty ---"))
             else:
-                self.rapid_override = False
-                channel(_("Rapid Limit Off"))
+                self.text_plan.SetValue(f"{str(stage)}: {str(plan)}")
 
-        @self.console_argument("filename", type=str)
-        @self.console_command("save_job", help=_("save job export"), input_type="plan")
-        def egv_save(channel, _, filename, data=None, **kwargs):
-            if filename is None:
-                raise CommandSyntaxError
-            try:
-                with open(filename, "wb") as f:
-                    f.write(b"Document type : LHYMICRO-GL file\n")
-                    f.write(b"File version: 1.0.01\n")
-                    f.write(b"Copyright: Unknown\n")
-                    f.write(
-                        bytes(
-                            f"Creator-Software: {self.kernel.name} v{self.kernel.version}\n",
-                            "utf-8",
-                        )
-                    )
-                    f.write(b"\n")
-                    f.write(b"%0%0%0%0%\n")
-                    driver = LihuiyuDriver(self)
-                    job = LaserJob(filename, list(data.plan), driver=driver)
-                    driver.out_pipe = f
-                    job.execute()
-
-            except (PermissionError, OSError):
-                channel(_("Could not save: {filename}").format(filename=filename))
-
-        @self.console_argument("filename", type=str)
-        @self.console_command(
-            "egv_import",
-            help=_("Lihuiyu Engrave Buffer Import. egv_import <egv_file>"),
-        )
-        def egv_import(channel, _, filename, **kwargs):
-            if filename is None:
-                raise CommandSyntaxError
-
-            def skip(read, byte, count):
-                """Skips forward in the file until we find <count> instances of <byte>"""
-                pos = read.tell()
-                while count > 0:
-                    char = read.read(1)
-                    if char == byte:
-                        count -= 1
-                    if char is None or len(char) == 0:
-                        read.seek(pos, 0)
-                        # If we didn't skip the right stuff, reset the position.
-                        break
-
-            def skip_header(file):
-                skip(file, "\n", 3)
-                skip(file, "%", 5)
-
-            try:
-                with open(filename) as f:
-                    skip_header(f)
-                    while True:
-                        data = f.read(1024)
-                        if not data:
-                            break
-                        buffer = bytes(data, "utf8")
-                        self.output.write(buffer)
-                    self.output.write(b"\n")
-            except (PermissionError, OSError, FileNotFoundError):
-                channel(_("Could not load: {filename}").format(filename=filename))
-
-        @self.console_argument("filename", type=str)
-        @self.console_command(
-            "egv_export",
-            help=_("Lihuiyu Engrave Buffer Export. egv_export <egv_file>"),
-        )
-        def egv_export(channel, _, filename, **kwargs):
-            if filename is None:
-                raise CommandSyntaxError
-            try:
-                with open(filename, "w") as f:
-                    f.write("Document type : LHYMICRO-GL file\n")
-                    f.write("File version: 1.0.01\n")
-                    f.write("Copyright: Unknown\n")
-                    f.write(
-                        f"Creator-Software: {self.kernel.name} v{self.kernel.version}\n"
-                    )
-                    f.write("\n")
-                    f.write("%0%0%0%0%\n")
-                    buffer = bytes(self.controller._buffer)
-                    buffer += bytes(self.controller._queue)
-                    f.write(buffer.decode("utf-8"))
-            except (PermissionError, OSError):
-                channel(_("Could not save: {filename}").format(filename=filename))
-
-        @self.console_command(
-            "egv",
-            help=_("Lihuiyu Engrave Code Sender. egv <lhymicro-gl>"),
-        )
-        def egv(command, channel, _, remainder=None, **kwargs):
-            if not remainder:
-                channel("Lihuiyu Engrave Code Sender. egv <lhymicro-gl>")
-            else:
-                self.output.write(
-                    bytes(remainder.replace("$", "\n").replace(" ", "\n"), "utf8")
-                )
+    def on_button_save(self, event):  # wxGlade: LaserPanel.<event_handler>
+        gui = self.context.gui
+        extension = "txt"
+        if hasattr(self.context.device, "extension"):
+            extension = self.context.device.extension
+        filetype = f"*.{extension}"
+        with wx.FileDialog(
+            gui,
+            _("Save Project"),
+            wildcard=filetype,
+            style=wx.FD_SAVE | wx.FD_OVERWRITE_PROMPT,
+        ) as fileDialog:
+            if fileDialog.ShowModal() == wx.ID_CANCEL:
+                return
+            pathname = fileDialog.GetPath()
 
-        @self.console_command(
-            "challenge",
-            help=_("Challenge code, challenge <serial number>"),
-        )
-        def challenge_egv(command, channel, _, remainder=None, **kwargs):
-            if not remainder:
-                raise CommandSyntaxError
-            else:
-                challenge = bytearray.fromhex(
-                    md5(bytes(remainder.upper(), "utf8")).hexdigest()
-                )
-                code = b"A%s\n" % challenge
-                self.output.write(code)
+            if not pathname.lower().endswith(f".{extension}"):
+                pathname += f".{extension}"
+            self.context(
+                f'planz clear copy preprocess validate blob preopt optimize save_job "{pathname}"\n'
+            )
 
-        @self.console_command("start", help=_("Start Pipe to Controller"))
-        def pipe_start(command, channel, _, **kwargs):
-            self.controller.update_state(STATE_ACTIVE)
-            self.controller.start()
-            channel(_("Lihuiyu Channel Started."))
-
-        @self.console_command("hold", help=_("Hold Controller"))
-        def pipe_pause(command, channel, _, **kwargs):
-            self.controller.update_state(STATE_PAUSE)
-            self.controller.pause()
-            channel("Lihuiyu Channel Paused.")
-
-        @self.console_command("resume", help=_("Resume Controller"))
-        def pipe_resume(command, channel, _, **kwargs):
-            self.controller.update_state(STATE_ACTIVE)
-            self.controller.start()
-            channel(_("Lihuiyu Channel Resumed."))
-
-        @self.console_command("usb_connect", help=_("Connects USB"))
-        def usb_connect(command, channel, _, **kwargs):
-            try:
-                self.controller.open()
-                channel(_("Usb Connection Opened."))
-            except ConnectionRefusedError:
-                channel(_("Usb Connection Refused"))
-
-        @self.console_command("usb_disconnect", help=_("Disconnects USB"))
-        def usb_disconnect(command, channel, _, **kwargs):
-            try:
-                self.controller.close()
-                channel(_("CH341 Closed."))
-            except ConnectionError:
-                channel(_("Usb Connection Error"))
-
-        @self.console_command("usb_reset", help=_("Reset USB device"))
-        def usb_reset(command, channel, _, **kwargs):
-            try:
-                self.controller.usb_reset()
-                channel(_("Usb Connection Reset"))
-            except ConnectionError:
-                channel(_("Usb Connection Error"))
-
-        @self.console_command("usb_release", help=_("Release USB device"))
-        def usb_release(command, channel, _, **kwargs):
-            try:
-                self.controller.usb_release()
-                channel(_("Usb Connection Released"))
-            except ConnectionError:
-                channel(_("Usb Connection Error"))
-
-        @self.console_command("usb_abort", help=_("Stops USB retries"))
-        def usb_abort(command, channel, _, **kwargs):
-            self.controller.abort_retry()
-
-        @self.console_command("usb_continue", help=_("Continues USB retries"))
-        def usb_continue(command, channel, _, **kwargs):
-            self.controller.continue_retry()
-
-        @self.console_option(
-            "port", "p", type=int, default=23, help=_("port to listen on.")
-        )
-        @kernel.console_option(
-            "verbose",
-            "v",
-            type=bool,
-            action="store_true",
-            help=_("watch server channels"),
-        )
-        @self.console_option(
-            "watch", "w", type=bool, action="store_true", help=_("watch send/recv data")
-        )
-        @self.console_option(
-            "quit",
-            "q",
-            type=bool,
-            action="store_true",
-            help=_("shutdown current lhyserver"),
-        )
-        @self.console_command("lhyserver", help=_("activate the lhyserver."))
-        def lhyserver(
-            channel, _, port=23, verbose=False, watch=False, quit=False, **kwargs
-        ):
-            """
-            The lhyserver provides for an open TCP on a specific port. Any data sent to this port will be sent directly
-            to the lihuiyu laser. This is how the tcp-connection sends data to the laser if that option is used. This
-            requires an additional computer such a raspberry pi doing the interfacing.
-            """
-            try:
-                server_name = f"lhyserver{self.path}"
-                output = self.controller
-                server = self.open_as("module/TCPServer", server_name, port=port)
-                if quit:
-                    self.close(server_name)
-                    return
-                channel(_("TCP Server for lihuiyu on port: {port}").format(port=port))
-                if verbose:
-                    console = kernel.channel("console")
-                    server.events_channel.watch(console)
-                    if watch:
-                        server.data_channel.watch(console)
-                channel(_("Watching Channel: {channel}").format(channel="server"))
-                self.channel(f"{server_name}/recv").watch(output.write)
-                channel(_("Attached: {output}").format(output=repr(output)))
-
-            except OSError:
-                channel(_("Server failed on port: {port}").format(port=port))
-            except KeyError:
-                channel(_("Server cannot be attached to any device."))
-            return
+    def on_button_load(self, event):  # wxGlade: LaserPanel.<event_handler>
+        pass
 
-        if self.has_feature("interpreter/lihuiyu"):
+    def on_button_clear(self, event):  # wxGlade: LaserPanel.<event_handler>
+        self.context("planz clear\n")
 
-            @self.console_command(
-                "lhyinterpreter", help=_("activate the lhyinterpreter.")
-            )
-            def lhyinterpreter(channel, _, **kwargs):
-                try:
-                    self.open_as("interpreter/lihuiyu", "lhyinterpreter")
-                    channel(
-                        _("Lihuiyu interpreter attached to {device}").format(
-                            device=str(self)
-                        )
-                    )
-                except KeyError:
-                    channel(_("Intepreter cannot be attached to any device."))
-                return
+    def on_button_update(self, event):  # wxGlade: LaserPanel.<event_handler>
+        with wx.BusyInfo(_("Updating Plan...")):
+            if self.checkbox_optimize.GetValue():
+                self.context(
+                    "planz clear copy preprocess validate blob preopt optimize\n"
+                )
+            else:
+                self.context("planz clear copy preprocess validate blob\n")
 
-    @property
-    def viewbuffer(self):
-        return self.driver.out_pipe.viewbuffer
-
-    @property
-    def current(self):
-        """
-        @return: the location in scene units for the current known position.
-        """
-        return self.device_to_scene_position(self.driver.native_x, self.driver.native_y)
-
-    @property
-    def speed(self):
-        return self.driver.speed
-
-    @property
-    def power(self):
-        return self.driver.power
-
-    @property
-    def state(self):
-        return self.driver.state
-
-    @property
-    def native(self):
-        """
-        @return: the location in device native units for the current known position.
-        """
-        return self.driver.native_x, self.driver.native_y
-
-    @property
-    def output(self):
-        """
-        This is the controller in controller mode and the tcp in network mode.
-        @return:
-        """
-        if self.networked:
-            return self.tcp
-        else:
-            return self.controller
+    def on_check_hold(self, event):
+        self.context.laserpane_hold = self.checkbox_hold.GetValue()
+
+    def pane_show(self, *args):
+        self.button_save_file.Enable(hasattr(self.context.device, "extension"))
+
+    def pane_hide(self, *args):
+        pass
```

### Comparing `meerk40t-0.8.2000/meerk40t/lihuiyu/driver.py` & `meerk40t-0.8.3000/meerk40t/lihuiyu/driver.py`

 * *Files 0% similar despite different names*

```diff
@@ -510,14 +510,16 @@
         horizontal = self.raster_step_y != 0
         self._request_horizontal_major = horizontal
 
         self._raster_step_swing_index = 0
         self._raster_step_float = (
             self.raster_step_y if horizontal else self.raster_step_x
         )
+        if self._raster_step_float is None:
+            self._raster_step_float = 1
         self._raster_step_g_value = int(math.floor(self._raster_step_float))
 
         if self._request_leftward is not None:
             self._leftward = self._request_leftward
             self._request_leftward = None
         if self._request_topward is not None:
             self._topward = self._request_topward
@@ -622,14 +624,16 @@
     def home(self, *values):
         """
         Home the laser.
 
         @param values:
         @return:
         """
+        if self.service.rotary_active and self.service.rotary_supress_home:
+            return
         self.rapid_mode()
         self(b"IPP\n")
         old_current = self.service.current
         self.native_x = 0
         self.native_y = 0
         self._reset_modes()
         self.state = DRIVER_STATE_RAPID
```

### Comparing `meerk40t-0.8.2000/meerk40t/lihuiyu/gui/gui.py` & `meerk40t-0.8.3000/meerk40t/lihuiyu/gui/gui.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/lihuiyu/gui/lhyaccelgui.py` & `meerk40t-0.8.3000/meerk40t/lihuiyu/gui/lhyaccelgui.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/lihuiyu/gui/lhycontrollergui.py` & `meerk40t-0.8.3000/meerk40t/lihuiyu/gui/lhycontrollergui.py`

 * *Files 4% similar despite different names*

```diff
@@ -278,42 +278,50 @@
                 self._buffer = ""
             if self.text_usb_log.IsShown():
                 self.text_usb_log.AppendText(buffer)
         except RuntimeError:
             pass
 
     def set_widgets(self):
-        self.checkbox_show_usb_log.SetValue(self.context.show_usb_log)
+        try:
+            show_log = self.context.show_usb_log
+        except AttributeError:
+            show_log = True
+        self.checkbox_show_usb_log.SetValue(show_log)
         self.on_check_show_usb_log()
 
     def device_execute(self, control_name):
         def menu_element(event=None):
             self.context.execute(control_name)
 
         return menu_element
 
     @signal_listener("pipe;status")
     def update_status(self, origin, status_data, code_string):
         if origin != self.context.path:
             return
-        if status_data is not None:
-            if isinstance(status_data, int):
-                self.text_desc.SetValue(str(status_data))
-                self.text_desc.SetValue(code_string)
-            else:
-                if len(status_data) == 6:
-                    self.text_byte_0.SetValue(str(status_data[0]))
-                    self.text_byte_1.SetValue(str(status_data[1]))
-                    self.text_byte_2.SetValue(str(status_data[2]))
-                    self.text_byte_3.SetValue(str(status_data[3]))
-                    self.text_byte_4.SetValue(str(status_data[4]))
-                    self.text_byte_5.SetValue(str(status_data[5]))
+        try:
+            if status_data is not None:
+                if isinstance(status_data, int):
+                    self.text_desc.SetValue(str(status_data))
                     self.text_desc.SetValue(code_string)
-        self.packet_count_text.SetValue(str(self.context.packet_count))
-        self.rejected_packet_count_text.SetValue(str(self.context.rejected_count))
+                else:
+                    if len(status_data) == 6:
+                        self.text_byte_0.SetValue(str(status_data[0]))
+                        self.text_byte_1.SetValue(str(status_data[1]))
+                        self.text_byte_2.SetValue(str(status_data[2]))
+                        self.text_byte_3.SetValue(str(status_data[3]))
+                        self.text_byte_4.SetValue(str(status_data[4]))
+                        self.text_byte_5.SetValue(str(status_data[5]))
+                        self.text_desc.SetValue(code_string)
+            self.packet_count_text.SetValue(str(self.context.packet_count))
+            self.rejected_packet_count_text.SetValue(str(self.context.rejected_count))
+        except RuntimeError:
+            # This should be handled when the controller window is closed.
+            pass
 
     @signal_listener("pipe;packet_text")
     def update_packet_text(self, origin, string_data):
         if origin != self.context._path:
             return
         if string_data is not None and len(string_data) != 0:
             self.packet_text_text.SetValue(str(string_data))
```

### Comparing `meerk40t-0.8.2000/meerk40t/lihuiyu/gui/lhydrivergui.py` & `meerk40t-0.8.3000/meerk40t/tools/livinghinges.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,1135 +1,1036 @@
+from copy import copy
+
 import wx
 
-from meerk40t.core.units import Length
-from meerk40t.device.gui.defaultactions import DefaultActionPanel
-from meerk40t.device.gui.formatterpanel import FormatterPanel
-from meerk40t.device.gui.warningpanel import WarningPanel
-from meerk40t.gui.icons import icons8_administrative_tools_50
+from meerk40t.core.units import ACCEPTED_UNITS, Length
+from meerk40t.gui.icons import STD_ICON_SIZE, icons8_hinges_50
+from meerk40t.gui.laserrender import LaserRender
 from meerk40t.gui.mwindow import MWindow
-from meerk40t.gui.wxutils import ScrolledPanel, StaticBoxSizer, TextCtrl
+from meerk40t.gui.wxutils import StaticBoxSizer
 from meerk40t.kernel import signal_listener
+from meerk40t.svgelements import Color, Matrix, Path
 
 _ = wx.GetTranslation
 
-FIX_SPEEDS_RATIO = 0.9195
+"""
+TODO:
+a) get rid of row / col range limitation and iterate until boundary exceeds frame
+b) Come up with a better inner offset algorithm
+"""
+
+_FACTOR = 1000
 
 
-class ConfigurationUsb(wx.Panel):
-    def __init__(self, *args, context=None, **kwds):
+class HingePanel(wx.Panel):
+    """
+    UI for LivingHinges, allows setting of parameters including preview of the expected result
+    """
 
-        # begin wxGlade: ConfigurationUsb.__init__
-        kwds["style"] = kwds.get("style", 0)
+    def __init__(self, *args, context=None, **kwds):
+        # begin wxGlade: clsLasertools.__init__
+        kwds["style"] = kwds.get("style", 0) | wx.TAB_TRAVERSAL
         wx.Panel.__init__(self, *args, **kwds)
         self.context = context
-
-        sizer_usb_settings = StaticBoxSizer(
-            self, wx.ID_ANY, _("USB Settings"), wx.VERTICAL
-        )
-
-        sizer_usb_restrict = StaticBoxSizer(
-            self, wx.ID_ANY, _("Restrict Multiple Lasers"), wx.VERTICAL
-        )
-        sizer_usb_settings.Add(sizer_usb_restrict, 0, wx.EXPAND, 0)
-
-        sizer_criteria = wx.BoxSizer(wx.HORIZONTAL)
-        sizer_usb_restrict.Add(sizer_criteria, 1, wx.EXPAND, 0)
-
-        sizer_chip_version = StaticBoxSizer(
-            self, wx.ID_ANY, _("CH341 Version"), wx.HORIZONTAL
-        )
-        sizer_criteria.Add(sizer_chip_version, 0, wx.EXPAND, 0)
-
-        self.text_device_version = TextCtrl(self, wx.ID_ANY, "", style=wx.TE_READONLY)
-        sizer_chip_version.Add(self.text_device_version, 1, wx.EXPAND, 0)
-
-        self.spin_device_version = wx.SpinCtrl(self, wx.ID_ANY, "-1", min=-1, max=100)
-        self.spin_device_version.SetMinSize((40, -1))
-        self.spin_device_version.SetToolTip(
-            _(
-                "Optional: Distinguish between different lasers using the match criteria below.\n-1 match anything. 0+ match exactly that value."
-            )
-        )
-        sizer_chip_version.Add(self.spin_device_version, 0, wx.EXPAND, 0)
-
-        sizer_device_index = StaticBoxSizer(
-            self, wx.ID_ANY, _("Device Index:"), wx.HORIZONTAL
-        )
-        sizer_criteria.Add(sizer_device_index, 0, wx.EXPAND, 0)
-
-        self.text_device_index = TextCtrl(self, wx.ID_ANY, "", style=wx.TE_READONLY)
-        sizer_device_index.Add(self.text_device_index, 1, wx.EXPAND, 0)
-
-        self.spin_device_index = wx.SpinCtrl(self, wx.ID_ANY, "-1", min=-1, max=5)
-        self.spin_device_index.SetMinSize((40, -1))
-        self.spin_device_index.SetToolTip(
-            _(
-                "Optional: Distinguish between different lasers using the match criteria below.\n-1 match anything. 0+ match exactly that value."
-            )
+        self._use_geomstr = self.context.setting(bool, "geomstr_hinge", False)
+        if self._use_geomstr:
+            from meerk40t.fill.patterns import LivingHinges
+        else:
+            from meerk40t.fill.patternfill import LivingHinges
+        self.hinge_generator = LivingHinges(
+            0, 0, float(Length("5cm")), float(Length("5cm"))
+        )
+
+        self.hinge_origin_x = "0cm"
+        self.hinge_origin_y = "0cm"
+        self.hinge_width = "5cm"
+        self.hinge_height = "5cm"
+        self.hinge_cells_x = 200
+        self.hinge_cells_y = 200
+        self.hinge_padding_x = 100
+        self.hinge_padding_y = 100
+        self.hinge_param_a = 0.7
+        self.hinge_param_b = 0.7
+
+        self.renderer = LaserRender(context)
+        self.in_draw_event = False
+        self.in_change_event = False
+        self.require_refresh = True
+        self._Buffer = None
+
+        self.text_origin_x = wx.TextCtrl(self, wx.ID_ANY, "")
+        self.text_origin_y = wx.TextCtrl(self, wx.ID_ANY, "")
+        self.text_width = wx.TextCtrl(self, wx.ID_ANY, "")
+        self.text_height = wx.TextCtrl(self, wx.ID_ANY, "")
+        self.combo_style = wx.ComboBox(
+            self, wx.ID_ANY, choices=[], style=wx.CB_DROPDOWN
+        )
+        self.button_default = wx.Button(self, wx.ID_ANY, "D")
+        _default = 200
+        self.slider_width = wx.Slider(
+            self,
+            wx.ID_ANY,
+            _default,
+            1,
+            _FACTOR,
+            style=wx.SL_HORIZONTAL,
         )
-        sizer_device_index.Add(self.spin_device_index, 0, wx.EXPAND, 0)
-
-        sizer_serial = StaticBoxSizer(
-            self, wx.ID_ANY, _("Serial Number"), wx.HORIZONTAL
+        self.slider_width_label = wx.StaticText(
+            self, wx.ID_ANY, f"{_default/_FACTOR:.1%}"
         )
-        sizer_usb_restrict.Add(sizer_serial, 0, wx.EXPAND, 0)
-
-        self.check_serial_number = wx.CheckBox(self, wx.ID_ANY, _("Serial Number"))
-        self.check_serial_number.SetToolTip(
-            _("Require a serial number match for this board")
+        self.slider_width_label.SetFont(
+            wx.Font(8, wx.FONTFAMILY_SWISS, wx.FONTSTYLE_NORMAL, wx.FONTWEIGHT_NORMAL)
         )
-        sizer_serial.Add(self.check_serial_number, 0, wx.EXPAND, 0)
-
-        self.text_serial_number = TextCtrl(
+        self.text_cell_width = wx.TextCtrl(
             self, wx.ID_ANY, "", style=wx.TE_PROCESS_ENTER
         )
-        self.text_serial_number.SetMinSize((50, -1))
-        self.text_serial_number.SetToolTip(
-            _(
-                "Board Serial Number to be used to identify a specific laser. If the device fails to match the serial number it will be disconnected."
-            )
-        )
-        sizer_serial.Add(self.text_serial_number, 1, wx.EXPAND, 0)
-
-        sizer_buffer = StaticBoxSizer(self, wx.ID_ANY, _("Write Buffer"), wx.HORIZONTAL)
-        sizer_usb_settings.Add(sizer_buffer, 0, wx.EXPAND, 0)
-
-        self.checkbox_limit_buffer = wx.CheckBox(
-            self, wx.ID_ANY, _("Limit Write Buffer")
-        )
-        self.checkbox_limit_buffer.SetToolTip(
-            _(
-                "Limit the write buffer to a certain amount. Permits on-the-fly command production."
-            )
-        )
-        self.checkbox_limit_buffer.SetValue(1)
-        sizer_buffer.Add(self.checkbox_limit_buffer, 0, 0, 0)
-
-        self.text_buffer_length = TextCtrl(
-            self, wx.ID_ANY, "", style=wx.TE_READONLY, limited=True
-        )
-        self.text_buffer_length.SetToolTip(
-            _("Current number of bytes in the write buffer.")
+        self.slider_height = wx.Slider(
+            self,
+            wx.ID_ANY,
+            _default,
+            1,
+            _FACTOR,
+            style=wx.SL_HORIZONTAL,
         )
-        sizer_buffer.Add(self.text_buffer_length, 1, wx.EXPAND, 0)
-
-        label_14 = wx.StaticText(self, wx.ID_ANY, "/")
-        sizer_buffer.Add(label_14, 0, wx.ALIGN_CENTER_VERTICAL, 0)
-
-        self.spin_packet_buffer_max = wx.SpinCtrl(
-            self, wx.ID_ANY, "1500", min=1, max=1000000
+        self.slider_height_label = wx.StaticText(
+            self, wx.ID_ANY, f"{_default/_FACTOR:.1%}"
         )
-        self.spin_packet_buffer_max.SetToolTip(_("Current maximum write buffer limit."))
-        self.spin_packet_buffer_max.SetMaxSize((100, -1))
-        sizer_buffer.Add(self.spin_packet_buffer_max, 1, wx.EXPAND, 0)
-
-        self.SetSizer(sizer_usb_settings)
-
-        self.Layout()
-
-        self.Bind(
-            wx.EVT_SPINCTRL, self.spin_on_device_version, self.spin_device_version
+        self.slider_height_label.SetFont(
+            wx.Font(8, wx.FONTFAMILY_SWISS, wx.FONTSTYLE_NORMAL, wx.FONTWEIGHT_NORMAL)
         )
-        self.Bind(
-            wx.EVT_TEXT_ENTER, self.spin_on_device_version, self.spin_device_version
+        self.text_cell_height = wx.TextCtrl(
+            self, wx.ID_ANY, "", style=wx.TE_PROCESS_ENTER
         )
-        self.Bind(wx.EVT_SPINCTRL, self.spin_on_device_index, self.spin_device_index)
-        self.Bind(wx.EVT_TEXT_ENTER, self.spin_on_device_index, self.spin_device_index)
-        self.Bind(
-            wx.EVT_CHECKBOX, self.on_check_serial_number, self.check_serial_number
-        )
-        self.text_serial_number.SetActionRoutine(self.on_text_serial_number)
-        self.Bind(
-            wx.EVT_CHECKBOX,
-            self.on_check_limit_packet_buffer,
-            self.checkbox_limit_buffer,
-        )
-        self.Bind(
-            wx.EVT_SPINCTRL, self.on_spin_packet_buffer_max, self.spin_packet_buffer_max
-        )
-        self.Bind(
-            wx.EVT_TEXT, self.on_spin_packet_buffer_max, self.spin_packet_buffer_max
-        )
-        self.Bind(
-            wx.EVT_TEXT_ENTER,
-            self.on_spin_packet_buffer_max,
-            self.spin_packet_buffer_max,
-        )
-        # end wxGlade
-        self.spin_device_index.SetValue(self.context.usb_index)
-        self.spin_device_version.SetValue(self.context.usb_version)
-        if self.context.serial is not None:
-            self.text_serial_number.SetValue(self.context.serial)
-        self.check_serial_number.SetValue(self.context.serial_enable)
-        self.checkbox_limit_buffer.SetValue(self.context.buffer_limit)
-        self.spin_packet_buffer_max.SetValue(self.context.buffer_max)
-
-    def pane_show(self):
-        # self.context.listen("pipe;buffer", self.on_buffer_update)
-        pass
-
-    def pane_hide(self):
-        # self.context.unlisten("pipe;buffer", self.on_buffer_update)
-        pass
-
-    @signal_listener("pipe;buffer")
-    def on_buffer_update(self, origin, value, *args):
-        self.text_buffer_length.SetValue(str(value))
-
-    @signal_listener("pipe;index")
-    def on_update_pipe_index(self, origin, value):
-        if origin != self.context.path:
-            return
-        self.text_device_index.SetValue(str(value))
-
-    @signal_listener("pipe;chipv")
-    def on_update_pipe_chipv(self, origin, value):
-        if origin != self.context.path:
-            return
-        self.text_device_version.SetValue(str(value))
-
-    def on_check_limit_packet_buffer(
-        self, event=None
-    ):  # wxGlade: JobInfo.<event_handler>
-        self.context.buffer_limit = self.checkbox_limit_buffer.GetValue()
-
-    def on_spin_packet_buffer_max(self, event=None):  # wxGlade: JobInfo.<event_handler>
-        self.context.buffer_max = self.spin_packet_buffer_max.GetValue()
-
-    def spin_on_device_index(self, event=None):
-        self.context.usb_index = int(self.spin_device_index.GetValue())
-
-    def spin_on_device_version(self, event=None):
-        self.context.usb_version = int(self.spin_device_version.GetValue())
-
-    def on_check_serial_number(
-        self, event
-    ):  # wxGlade: ConfigurationUsb.<event_handler>
-        self.context.serial_enable = self.check_serial_number.GetValue()
-
-    def on_text_serial_number(self):
-        self.context.serial = self.text_serial_number.GetValue()
-
-
-class ConfigurationTcp(wx.Panel):
-    def __init__(self, *args, context=None, **kwds):
-        # begin wxGlade: ConfigurationTcp.__init__
-        kwds["style"] = kwds.get("style", 0)
-        wx.Panel.__init__(self, *args, **kwds)
-        self.context = context
-
-        sizer_13 = StaticBoxSizer(self, wx.ID_ANY, _("TCP Settings"), wx.HORIZONTAL)
-
-        h_sizer_y1 = StaticBoxSizer(self, wx.ID_ANY, _("Address"), wx.VERTICAL)
-        sizer_13.Add(h_sizer_y1, 3, wx.EXPAND, 0)
-
-        self.text_address = TextCtrl(self, wx.ID_ANY, "", style=wx.TE_PROCESS_ENTER)
-        self.text_address.SetMinSize((75, -1))
-        self.text_address.SetToolTip(_("IP/Host if the server computer"))
-        h_sizer_y1.Add(self.text_address, 1, wx.EXPAND, 0)
-
-        sizer_port = StaticBoxSizer(self, wx.ID_ANY, _("Port"), wx.VERTICAL)
-        sizer_13.Add(sizer_port, 1, wx.EXPAND, 0)
-
-        self.text_port = TextCtrl(
+        self.slider_offset_x = wx.Slider(
             self,
             wx.ID_ANY,
-            "",
-            limited=True,
-            check="int",
-            style=wx.TE_PROCESS_ENTER,
+            0,
+            int(1 - _FACTOR / 2),
+            int(_FACTOR / 2),
+            style=wx.SL_HORIZONTAL,
+        )
+        self.slider_offx_label = wx.StaticText(self, wx.ID_ANY)
+        self.slider_offx_label.SetFont(
+            wx.Font(8, wx.FONTFAMILY_SWISS, wx.FONTSTYLE_NORMAL, wx.FONTWEIGHT_NORMAL)
         )
-        self.text_port.SetToolTip(_("Port for tcp connection on the server computer"))
-        sizer_port.Add(self.text_port, 1, wx.EXPAND, 0)
-
-        self.SetSizer(sizer_13)
-
-        self.Layout()
-
-        self.text_address.SetActionRoutine(self.on_text_address)
-        self.text_port.SetActionRoutine(self.on_text_port)
-        # end wxGlade
-        self.text_port.SetValue(str(self.context.port))
-        self.text_address.SetValue(self.context.address)
-
-    def pane_show(self):
-        pass
-
-    def pane_hide(self):
-        pass
-
-    def on_text_address(self):
-        self.context.address = self.text_address.GetValue()
-
-    def on_text_port(self):  # wxGlade: ConfigurationTcp.<event_handler>
-        try:
-            self.context.port = int(self.text_port.GetValue())
-        except ValueError:
-            pass
-
-
-class ConfigurationLaserPanel(wx.Panel):
-    def __init__(self, *args, context=None, **kwds):
-        # begin wxGlade: ConfigurationLaserPanel.__init__
-        kwds["style"] = kwds.get("style", 0)
-        wx.Panel.__init__(self, *args, **kwds)
-        self.context = context
-
-        v_sizer_main = StaticBoxSizer(
-            self, wx.ID_ANY, _("Laser Parameters"), wx.VERTICAL
+        self.text_cell_offset_x = wx.TextCtrl(
+            self, wx.ID_ANY, "", style=wx.TE_PROCESS_ENTER
         )
-
-        sizer_bed = StaticBoxSizer(self, wx.ID_ANY, _("Bed Dimensions"), wx.HORIZONTAL)
-        v_sizer_main.Add(sizer_bed, 0, wx.EXPAND, 0)
-
-        h_sizer_wd = StaticBoxSizer(self, wx.ID_ANY, _("Width"), wx.HORIZONTAL)
-        sizer_bed.Add(h_sizer_wd, 1, wx.EXPAND, 0)
-
-        self.text_bedwidth = TextCtrl(
+        self.slider_offset_y = wx.Slider(
             self,
             wx.ID_ANY,
-            "310mm",
-            limited=True,
-            check="length",
-            style=wx.TE_PROCESS_ENTER,
-            nonzero=True,
-        )
-        self.text_bedwidth.SetToolTip(_("Width of the laser bed."))
-        h_sizer_wd.Add(self.text_bedwidth, 1, wx.EXPAND, 0)
-
-        h_sizer_ht = StaticBoxSizer(self, wx.ID_ANY, _("Height"), wx.HORIZONTAL)
-        sizer_bed.Add(h_sizer_ht, 1, wx.EXPAND, 0)
-
-        label_3 = wx.StaticText(self, wx.ID_ANY, "")
-        h_sizer_ht.Add(label_3, 0, wx.EXPAND, 0)
-
-        self.text_bedheight = TextCtrl(
-            self,
-            wx.ID_ANY,
-            "210mm",
-            limited=True,
-            check="length",
-            style=wx.TE_PROCESS_ENTER,
-            nonzero=True,
+            0,
+            int(1 - _FACTOR / 2),
+            int(_FACTOR / 2),
+            style=wx.SL_HORIZONTAL,
+        )
+        self.slider_offy_label = wx.StaticText(self, wx.ID_ANY)
+        self.slider_offy_label.SetFont(
+            wx.Font(8, wx.FONTFAMILY_SWISS, wx.FONTSTYLE_NORMAL, wx.FONTWEIGHT_NORMAL)
         )
-        self.text_bedheight.SetToolTip(_("Height of the laser bed."))
-        h_sizer_ht.Add(self.text_bedheight, 1, wx.EXPAND, 0)
-
-        sizer_scale_factors = StaticBoxSizer(
-            self, wx.ID_ANY, _("User Scale Factor"), wx.HORIZONTAL
+        self.text_cell_offset_y = wx.TextCtrl(
+            self, wx.ID_ANY, "", style=wx.TE_PROCESS_ENTER
         )
-        v_sizer_main.Add(sizer_scale_factors, 0, wx.EXPAND, 0)
-
-        h_sizer_x_2 = StaticBoxSizer(self, wx.ID_ANY, _("X:"), wx.HORIZONTAL)
-        sizer_scale_factors.Add(h_sizer_x_2, 1, wx.EXPAND, 0)
-
-        self.text_scale_x = TextCtrl(
+        # Slider times ten
+        self.slider_param_a = wx.Slider(
             self,
             wx.ID_ANY,
-            "1.000",
-            limited=True,
-            check="float",
-            nonzero=True,
-            style=wx.TE_PROCESS_ENTER,
+            7,
+            -50,
+            50,
+            style=wx.SL_HORIZONTAL | wx.SL_VALUE_LABEL,
         )
-        self.text_scale_x.SetToolTip(
-            _("Scale factor for the X-axis. Board units to actual physical units.")
-        )
-        h_sizer_x_2.Add(self.text_scale_x, 1, wx.EXPAND, 0)
-
-        h_sizer_y_2 = StaticBoxSizer(self, wx.ID_ANY, _("Y:"), wx.HORIZONTAL)
-        sizer_scale_factors.Add(h_sizer_y_2, 1, wx.EXPAND, 0)
-
-        self.text_scale_y = TextCtrl(
+        self.slider_param_b = wx.Slider(
             self,
             wx.ID_ANY,
-            "1.000",
-            limited=True,
-            check="float",
-            nonzero=True,
-            style=wx.TE_PROCESS_ENTER,
-        )
-        self.text_scale_y.SetToolTip(
-            _("Scale factor for the Y-axis. Board units to actual physical units.")
-        )
-        h_sizer_y_2.Add(self.text_scale_y, 1, wx.EXPAND, 0)
-
-        self.SetSizer(v_sizer_main)
-
-        self.text_bedwidth.SetValue(self.context.bedwidth)
-        self.text_bedheight.SetValue(self.context.bedheight)
-        self.text_scale_x.SetValue(f"{self.context.scale_x:.4f}")
-        self.text_scale_y.SetValue(f"{self.context.scale_y:.4f}")
-
-        self.Layout()
-
-        self.text_bedwidth.SetActionRoutine(self.on_text_bedwidth)
-        self.text_bedheight.SetActionRoutine(self.on_text_bedheight)
-        self.text_scale_x.SetActionRoutine(self.on_text_x_scale)
-        self.text_scale_y.SetActionRoutine(self.on_text_y_scale)
-
-    def pane_show(self):
-        pass
-
-    def pane_hide(self):
-        pass
-
-    def on_text_bedwidth(self):
-        ctrl = self.text_bedwidth
-        try:
-            bedwidth = Length(ctrl.GetValue())
-        except ValueError:
-            return
+            7,
+            -50,
+            +50,
+            style=wx.SL_HORIZONTAL | wx.SL_VALUE_LABEL,
+        )
+        self.button_generate = wx.Button(self, wx.ID_ANY, _("Generate"))
+        self.button_close = wx.Button(self, wx.ID_ANY, _("Close"))
+        self.context.setting(bool, "hinge_preview_pattern", True)
+        self.context.setting(bool, "hinge_preview_shape", True)
+        self.check_preview_show_pattern = wx.CheckBox(
+            self, wx.ID_ANY, _("Preview Pattern")
+        )
+        self.check_preview_show_pattern.SetValue(
+            bool(self.context.hinge_preview_pattern)
+        )
+        self.check_preview_show_shape = wx.CheckBox(self, wx.ID_ANY, _("Preview Shape"))
+        self.check_preview_show_shape.SetValue(bool(self.context.hinge_preview_shape))
+
+        #  self.check_debug_outline = wx.CheckBox(self, wx.ID_ANY, "Show outline")
+
+        self.patterns = list()
+        self.defaults = list()
+        self.pattern_entry = list()
+
+        for entry in context.match("pattern/", suffix=True):
+            pattern = context.lookup(f"pattern/{entry}")
+            default = pattern[4]
+            self.pattern_entry.append(pattern)
+            self.patterns.append(entry)
+            self.defaults.append(default)
+        self.combo_style.Set(self.patterns)
+        self.combo_style.SetSelection(0)
+        # self.check_debug_outline.SetValue(True)
+        self._set_layout()
+        self._set_logic()
 
-        self.context.device.width = bedwidth.preferred_length
-        self.context.device.bedwidth = bedwidth.preferred_length
-        self.context.signal(
-            "bed_size", (self.context.device.bedwidth, self.context.device.bedheight)
-        )
-        self.context.device.realize()
-        self.context("viewport_update\n")
-        self.context.signal("bedsize", False)
+        self._setup_settings()
+        self._restore_settings()
 
-    def on_text_bedheight(self):
-        ctrl = self.text_bedheight
-        try:
-            bedheight = Length(ctrl.GetValue())
-        except ValueError:
-            return
-        self.context.device.height = bedheight.preferred_length
-        self.context.device.bedheight = bedheight.preferred_length
-        self.context.signal(
-            "bed_size", (self.context.device.bedwidth, self.context.device.bedheight)
-        )
-        self.context.device.realize()
-        self.context("viewport_update\n")
-        self.context.signal("bedsize", False)
+        self.Layout()
 
-    def on_text_x_scale(self):
-        try:
-            self.context.device.user_scale_x = float(self.text_scale_x.GetValue())
-            self.context.device.user_scale_y = float(self.text_scale_y.GetValue())
-            self.context.signal(
-                "scale_step", (self.context.device.scale_x, self.context.device.scale_y)
-            )
-            self.context.device.realize()
-            self.context("viewport_update\n")
-            self.context.signal("bedsize", False)
-        except ValueError:
-            pass
+    def _set_logic(self):
+        self.panel_preview.Bind(wx.EVT_PAINT, self.on_paint)
+        self.button_close.Bind(wx.EVT_BUTTON, self.on_button_close)
+        self.button_generate.Bind(wx.EVT_BUTTON, self.on_button_generate)
+        self.text_height.Bind(wx.EVT_TEXT, self.on_option_update)
+        self.text_width.Bind(wx.EVT_TEXT, self.on_option_update)
+        self.text_origin_x.Bind(wx.EVT_TEXT, self.on_option_update)
+        self.text_origin_y.Bind(wx.EVT_TEXT, self.on_option_update)
+        self.slider_width.Bind(wx.EVT_SLIDER, self.on_option_update)
+        self.slider_height.Bind(wx.EVT_SLIDER, self.on_option_update)
+        self.slider_offset_x.Bind(wx.EVT_SLIDER, self.on_option_update)
+        self.slider_offset_y.Bind(wx.EVT_SLIDER, self.on_option_update)
+        self.slider_param_a.Bind(wx.EVT_SLIDER, self.on_option_update)
+        self.slider_param_b.Bind(wx.EVT_SLIDER, self.on_option_update)
+        self.combo_style.Bind(wx.EVT_COMBOBOX, self.on_pattern_update)
+        self.button_default.Bind(wx.EVT_BUTTON, self.on_default_button)
+        self.check_preview_show_pattern.Bind(wx.EVT_CHECKBOX, self.on_preview_options)
+        self.check_preview_show_shape.Bind(wx.EVT_CHECKBOX, self.on_preview_options)
+        self.panel_preview.Bind(wx.EVT_PAINT, self.on_display_paint)
+        self.Bind(wx.EVT_SIZE, self.on_size)
+        self.text_cell_height.Bind(wx.EVT_TEXT_ENTER, self.on_option_update)
+        self.text_cell_width.Bind(wx.EVT_TEXT_ENTER, self.on_option_update)
+        self.text_cell_offset_x.Bind(wx.EVT_TEXT_ENTER, self.on_option_update)
+        self.text_cell_offset_y.Bind(wx.EVT_TEXT_ENTER, self.on_option_update)
+        self.text_cell_height.Bind(wx.EVT_KILL_FOCUS, self.on_option_update)
+        self.text_cell_width.Bind(wx.EVT_KILL_FOCUS, self.on_option_update)
+        self.text_cell_offset_x.Bind(wx.EVT_KILL_FOCUS, self.on_option_update)
+        self.text_cell_offset_y.Bind(wx.EVT_KILL_FOCUS, self.on_option_update)
+        self.text_cell_height.Bind(wx.EVT_TEXT, self.on_option_update)
+        self.text_cell_width.Bind(wx.EVT_TEXT, self.on_option_update)
+        self.text_cell_offset_x.Bind(wx.EVT_TEXT, self.on_option_update)
+        self.text_cell_offset_y.Bind(wx.EVT_TEXT, self.on_option_update)
+
+    def _set_layout(self):
+        def size_it(ctrl, value):
+            ctrl.SetMaxSize(wx.Size(int(value), -1))
+            ctrl.SetMinSize(wx.Size(int(value * 0.75), -1))
+            ctrl.SetSize(wx.Size(value, -1))
+
+        main_sizer = wx.BoxSizer(wx.HORIZONTAL)
+        size_it(self.slider_height, 120)
+        size_it(self.slider_width, 120)
+        size_it(self.slider_offset_x, 120)
+        size_it(self.slider_offset_y, 120)
+        size_it(self.slider_param_a, 120)
+        size_it(self.slider_param_b, 120)
+        size_it(self.text_cell_height, 90)
+        size_it(self.text_cell_width, 90)
+        size_it(self.text_cell_offset_x, 90)
+        size_it(self.text_cell_offset_y, 90)
+        size_it(self.text_width, 90)
+        size_it(self.text_height, 90)
+        size_it(self.text_origin_x, 90)
+        size_it(self.text_origin_y, 90)
+        size_it(self.combo_style, 120)
+        # size_it(self.button_generate, 120)
+        # size_it(self.button_close, 90)
+
+        main_left = wx.BoxSizer(wx.VERTICAL)
+        main_sizer.Add(main_left, 0, wx.EXPAND | wx.FIXED_MINSIZE, 0)
+
+        vsizer_dimension = StaticBoxSizer(self, wx.ID_ANY, _("Dimension"), wx.VERTICAL)
+        main_left.Add(vsizer_dimension, 0, wx.EXPAND, 0)
+
+        hsizer_origin = wx.BoxSizer(wx.HORIZONTAL)
+        vsizer_dimension.Add(hsizer_origin, 0, wx.EXPAND, 0)
+
+        hsizer_originx = StaticBoxSizer(self, wx.ID_ANY, _("X:"), wx.VERTICAL)
+        self.text_origin_x.SetToolTip(_("X-Coordinate of the hinge area"))
+        hsizer_originx.Add(self.text_origin_x, 1, wx.EXPAND, 0)
+
+        hsizer_originy = StaticBoxSizer(self, wx.ID_ANY, _("Y:"), wx.VERTICAL)
+
+        self.text_origin_y.SetToolTip(_("Y-Coordinate of the hinge area"))
+        hsizer_originy.Add(self.text_origin_y, 1, wx.EXPAND, 0)
+
+        hsizer_origin.Add(hsizer_originx, 1, wx.EXPAND, 0)
+        hsizer_origin.Add(hsizer_originy, 1, wx.EXPAND, 0)
+
+        hsizer_wh = wx.BoxSizer(wx.HORIZONTAL)
+        vsizer_dimension.Add(hsizer_wh, 0, wx.EXPAND, 0)
+
+        hsizer_width = StaticBoxSizer(self, wx.ID_ANY, _("Width:"), wx.VERTICAL)
+
+        self.text_width.SetToolTip(_("Width of the hinge area"))
+        hsizer_width.Add(self.text_width, 1, wx.EXPAND, 0)
+
+        hsizer_height = StaticBoxSizer(self, wx.ID_ANY, _("Height:"), wx.VERTICAL)
+
+        self.text_height.SetToolTip(_("Height of the hinge area"))
+        hsizer_height.Add(self.text_height, 1, wx.EXPAND, 0)
+
+        hsizer_wh.Add(hsizer_width, 1, wx.EXPAND, 0)
+        hsizer_wh.Add(hsizer_height, 1, wx.EXPAND, 0)
+
+        vsizer_options = StaticBoxSizer(self, wx.ID_ANY, _("Options"), wx.VERTICAL)
+        main_left.Add(vsizer_options, 0, wx.EXPAND, 0)
+
+        hsizer_pattern = wx.BoxSizer(wx.HORIZONTAL)
+        vsizer_options.Add(hsizer_pattern, 0, wx.EXPAND, 0)
+
+        label_pattern = wx.StaticText(self, wx.ID_ANY, _("Pattern:"))
+        label_pattern.SetMinSize((90, -1))
+        hsizer_pattern.Add(label_pattern, 0, wx.ALIGN_CENTER_VERTICAL, 0)
+
+        self.combo_style.SetToolTip(_("Choose the hinge pattern"))
+        hsizer_pattern.Add(self.combo_style, 1, wx.EXPAND, 0)
+
+        self.button_default.SetToolTip(_("Default Values"))
+        self.button_default.SetMinSize((30, -1))
+        hsizer_pattern.Add(self.button_default, 0, wx.EXPAND, 0)
+
+        hsizer_cellwidth = wx.BoxSizer(wx.HORIZONTAL)
+        vsizer_options.Add(hsizer_cellwidth, 1, wx.EXPAND, 0)
+
+        label_cell_width = wx.StaticText(self, wx.ID_ANY, _("Cell-Width:"))
+        label_cell_width.SetMinSize((90, -1))
+        hsizer_cellwidth.Add(label_cell_width, 0, wx.ALIGN_CENTER_VERTICAL, 0)
+
+        self.slider_width.SetToolTip(
+            _("Select the ratio of the cell width compared to the overall width")
+        )
+        self.text_cell_width.SetToolTip(
+            _("Select the ratio of the cell width compared to the overall width")
+        )
+        vs_width = wx.BoxSizer(wx.VERTICAL)
+        vs_width.Add(self.slider_width, 0, wx.EXPAND, 0)
+        vs_width.Add(self.slider_width_label, 0, wx.ALIGN_CENTER_HORIZONTAL, 0)
+        hsizer_cellwidth.Add(vs_width, 2, wx.EXPAND, 0)
+        hsizer_cellwidth.Add(self.text_cell_width, 1, wx.ALIGN_CENTER_VERTICAL, 0)
+
+        hsizer_cellheight = wx.BoxSizer(wx.HORIZONTAL)
+        vsizer_options.Add(hsizer_cellheight, 1, wx.EXPAND, 0)
+
+        label_cell_height = wx.StaticText(self, wx.ID_ANY, _("Cell-Height:"))
+        label_cell_height.SetMinSize((90, -1))
+        hsizer_cellheight.Add(label_cell_height, 0, wx.ALIGN_CENTER_VERTICAL, 0)
+
+        self.slider_height.SetToolTip(
+            _("Select the ratio of the cell height compared to the overall height")
+        )
+        self.text_cell_height.SetToolTip(
+            _("Select the ratio of the cell height compared to the overall height")
+        )
+        vs_height = wx.BoxSizer(wx.VERTICAL)
+        vs_height.Add(self.slider_height, 0, wx.EXPAND, 0)
+        vs_height.Add(self.slider_height_label, 0, wx.ALIGN_CENTER_HORIZONTAL, 0)
+        hsizer_cellheight.Add(vs_height, 2, wx.EXPAND, 0)
+        hsizer_cellheight.Add(self.text_cell_height, 1, wx.ALIGN_CENTER_VERTICAL, 0)
+
+        hsizer_offsetx = wx.BoxSizer(wx.HORIZONTAL)
+        vsizer_options.Add(hsizer_offsetx, 1, wx.EXPAND, 0)
+
+        label_offset_x = wx.StaticText(self, wx.ID_ANY, _("Offset X:"))
+        label_offset_x.SetMinSize((90, -1))
+        hsizer_offsetx.Add(label_offset_x, 0, wx.ALIGN_CENTER_VERTICAL, 0)
+
+        self.slider_offset_x.SetToolTip(_("Select the pattern-offset in X-direction"))
+        self.text_cell_offset_x.SetToolTip(
+            _("Select the pattern-offset in X-direction")
+        )
+        vs_offx = wx.BoxSizer(wx.VERTICAL)
+        vs_offx.Add(self.slider_offset_x, 0, wx.EXPAND, 0)
+        vs_offx.Add(self.slider_offx_label, 0, wx.ALIGN_CENTER_HORIZONTAL, 0)
+        hsizer_offsetx.Add(vs_offx, 2, wx.EXPAND, 0)
+        hsizer_offsetx.Add(self.text_cell_offset_x, 1, wx.ALIGN_CENTER_VERTICAL, 0)
+
+        hsizer_offsety = wx.BoxSizer(wx.HORIZONTAL)
+        vsizer_options.Add(hsizer_offsety, 0, wx.EXPAND, 0)
+
+        label_offset_y = wx.StaticText(self, wx.ID_ANY, _("Offset Y:"))
+        label_offset_y.SetMinSize((90, -1))
+        hsizer_offsety.Add(label_offset_y, 0, wx.ALIGN_CENTER_VERTICAL, 0)
+
+        self.slider_offset_y.SetToolTip(_("Select the pattern-offset in Y-direction"))
+        self.text_cell_offset_y.SetToolTip(
+            _("Select the pattern-offset in Y-direction")
+        )
+        vs_offy = wx.BoxSizer(wx.VERTICAL)
+        vs_offy.Add(self.slider_offset_y, 0, wx.EXPAND, 0)
+        vs_offy.Add(self.slider_offy_label, 0, wx.ALIGN_CENTER_HORIZONTAL, 0)
+        hsizer_offsety.Add(vs_offy, 2, wx.EXPAND, 0)
+        hsizer_offsety.Add(self.text_cell_offset_y, 1, wx.ALIGN_CENTER_VERTICAL, 0)
+
+        self.slider_param_a.SetToolTip(_("Change the shape appearance"))
+        self.slider_param_b.SetToolTip(_("Change the shape appearance"))
+        hsizer_param_a = wx.BoxSizer(wx.HORIZONTAL)
+        hsizer_param_a.Add(self.slider_param_a, 1, wx.EXPAND, 0)
+        hsizer_param_a.Add(self.slider_param_b, 1, wx.EXPAND, 0)
+        vsizer_options.Add(hsizer_param_a, 0, wx.EXPAND, 0)
+        # main_left.Add(self.check_debug_outline, 0, wx.EXPAND, 0)
+
+        hsizer_buttons = wx.BoxSizer(wx.HORIZONTAL)
+        main_left.Add(hsizer_buttons, 0, wx.EXPAND, 0)
+
+        self.button_generate.SetToolTip(_("Generates the hinge"))
+        hsizer_buttons.Add(self.button_generate, 2, 0, 0)
+
+        hsizer_buttons.Add(self.button_close, 1, 0, 0)
+
+        main_right = StaticBoxSizer(self, wx.ID_ANY, _("Preview"), wx.VERTICAL)
+        main_sizer.Add(main_right, 1, wx.EXPAND, 0)
+
+        hsizer_preview = wx.BoxSizer(wx.HORIZONTAL)
+        main_right.Add(hsizer_preview, 0, wx.EXPAND, 0)
+        self.check_preview_show_pattern.SetMinSize(wx.Size(-1, 23))
+        self.check_preview_show_shape.SetMinSize(wx.Size(-1, 23))
+        hsizer_preview.Add(self.check_preview_show_pattern, 1, wx.EXPAND, 0)
+        hsizer_preview.Add(self.check_preview_show_shape, 1, wx.EXPAND, 0)
+
+        self.panel_preview = wx.Panel(self, wx.ID_ANY)
+        main_right.Add(self.panel_preview, 1, wx.EXPAND, 0)
+        main_left.Layout()
+        main_right.Layout()
+        main_sizer.Layout()
+        self.SetSizer(main_sizer)
+
+    def on_preview_options(self, event):
+        self.context.hinge_preview_pattern = self.check_preview_show_pattern.GetValue()
+        self.context.hinge_preview_shape = self.check_preview_show_shape.GetValue()
+        self.refresh_display()
 
-    def on_text_y_scale(self):
+    def on_display_paint(self, event=None):
         try:
-            self.context.device.user_scale_x = float(self.text_scale_x.GetValue())
-            self.context.device.user_scale_y = float(self.text_scale_y.GetValue())
-            self.context.device.scale_x = self.context.device.user_scale_x
-            self.context.device.scale_y = self.context.device.user_scale_y
-            self.context.signal(
-                "scale_step", (self.context.device.scale_x, self.context.device.scale_y)
-            )
-            self.context.device.realize()
-            self.context("viewport_update\n")
-            self.context.signal("bedsize", False)
-        except ValueError:
+            wx.BufferedPaintDC(self.panel_preview, self._Buffer)
+        except RuntimeError:
             pass
 
-
-class ConfigurationInterfacePanel(ScrolledPanel):
-    def __init__(self, *args, context=None, **kwds):
-        # begin wxGlade: ConfigurationInterfacePanel.__init__
-        kwds["style"] = kwds.get("style", 0)
-        ScrolledPanel.__init__(self, *args, **kwds)
-        self.context = context
-
-        sizer_page_1 = wx.BoxSizer(wx.VERTICAL)
-
-        sizer_name = StaticBoxSizer(self, wx.ID_ANY, _("Device Name"), wx.HORIZONTAL)
-        self.text_device_label = TextCtrl(
-            self, wx.ID_ANY, "", style=wx.TE_PROCESS_ENTER
-        )
-        self.text_device_label.SetToolTip(
-            _("The internal label to be used for this device")
-        )
-        sizer_name.Add(self.text_device_label, 1, wx.EXPAND, 0)
-        sizer_page_1.Add(sizer_name, 0, wx.EXPAND, 0)
-
-        sizer_config = StaticBoxSizer(
-            self, wx.ID_ANY, _("Configuration"), wx.HORIZONTAL
-        )
-        sizer_page_1.Add(sizer_config, 0, wx.EXPAND, 0)
-
-        sizer_board = StaticBoxSizer(self, wx.ID_ANY, _("Board Setup"), wx.HORIZONTAL)
-        sizer_config.Add(sizer_board, 0, wx.EXPAND, 0)
-
-        self.combobox_board = wx.ComboBox(
-            self,
-            wx.ID_ANY,
-            choices=["M2", "B2", "M", "M1", "A", "B", "B1"],
-            style=wx.CB_DROPDOWN,
-        )
-        self.combobox_board.SetToolTip(
-            _("Select the board to use. This has an effects the speedcodes used.")
-        )
-        self.combobox_board.SetSelection(0)
-        sizer_board.Add(self.combobox_board, 1, wx.ALIGN_CENTER_VERTICAL, 0)
-
-        sizer_17 = wx.BoxSizer(wx.VERTICAL)
-        sizer_config.Add(sizer_17, 1, wx.EXPAND, 0)
-
-        self.checkbox_flip_x = wx.CheckBox(self, wx.ID_ANY, _("Flip X"))
-        self.checkbox_flip_x.SetToolTip(
-            _("Flip the Right and Left commands sent to the controller")
-        )
-        sizer_17.Add(self.checkbox_flip_x, 0, wx.EXPAND, 0)
-
-        self.checkbox_home_right = wx.CheckBox(self, wx.ID_ANY, _("Home Right"))
-        self.checkbox_home_right.SetToolTip(
-            _("Indicates the device Home is on the right")
-        )
-        sizer_17.Add(self.checkbox_home_right, 0, wx.EXPAND, 0)
-
-        label_1 = wx.StaticText(self, wx.ID_ANY, "")
-        sizer_17.Add(label_1, 0, wx.EXPAND, 0)
-
-        sizer_16 = wx.BoxSizer(wx.VERTICAL)
-        sizer_config.Add(sizer_16, 1, wx.EXPAND, 0)
-
-        self.checkbox_flip_y = wx.CheckBox(self, wx.ID_ANY, _("Flip Y"))
-        self.checkbox_flip_y.SetToolTip(
-            _("Flip the Top and Bottom commands sent to the controller")
-        )
-        sizer_16.Add(self.checkbox_flip_y, 0, wx.EXPAND, 0)
-
-        self.checkbox_home_bottom = wx.CheckBox(self, wx.ID_ANY, _("Home Bottom"))
-        self.checkbox_home_bottom.SetToolTip(
-            _("Indicates the device Home is on the bottom")
-        )
-        sizer_16.Add(self.checkbox_home_bottom, 0, wx.EXPAND, 0)
-
-        self.checkbox_swap_xy = wx.CheckBox(self, wx.ID_ANY, _("Swap X and Y"))
-        self.checkbox_swap_xy.SetToolTip(
-            _("Swaps the X and Y axis. This happens before the FlipX and FlipY.")
-        )
-        sizer_16.Add(self.checkbox_swap_xy, 0, wx.EXPAND, 0)
-
-        sizer_interface = StaticBoxSizer(self, wx.ID_ANY, _("Interface"), wx.VERTICAL)
-        sizer_page_1.Add(sizer_interface, 0, wx.EXPAND, 0)
-
-        sizer_interface_radio = wx.BoxSizer(wx.HORIZONTAL)
-        sizer_interface.Add(sizer_interface_radio, 0, wx.EXPAND, 0)
-
-        self.radio_usb = wx.RadioButton(self, wx.ID_ANY, _("USB"), style=wx.RB_GROUP)
-        self.radio_usb.SetValue(1)
-        self.radio_usb.SetToolTip(
-            _(
-                "Select this if you have an m2-nano controller physically connected to this computer using a USB cable."
-            )
-        )
-        sizer_interface_radio.Add(self.radio_usb, 1, wx.EXPAND, 0)
-
-        self.radio_tcp = wx.RadioButton(self, wx.ID_ANY, _("Networked"))
-        self.radio_tcp.SetToolTip(
-            _(
-                "Select this to connect this instance of Meerk40t to another instance of Meerk40t running as a remote server."
-            )
-        )
-        sizer_interface_radio.Add(self.radio_tcp, 1, wx.EXPAND, 0)
-
-        self.radio_mock = wx.RadioButton(self, wx.ID_ANY, _("Mock"))
-        self.radio_mock.SetToolTip(
-            _(
-                "Select this only for debugging without a physical laser available. Execute a burn as if there was an m2-nano controller physically connected by USB."
-            )
-        )
-        sizer_interface_radio.Add(self.radio_mock, 1, wx.EXPAND, 0)
-
-        self.panel_usb_settings = ConfigurationUsb(
-            self, wx.ID_ANY, context=self.context
-        )
-        sizer_interface.Add(self.panel_usb_settings, 0, wx.EXPAND, 0)
-
-        self.panel_tcp_config = ConfigurationTcp(self, wx.ID_ANY, context=self.context)
-        sizer_interface.Add(self.panel_tcp_config, 0, wx.EXPAND, 0)
-
-        self.ConfigurationLaserPanel = ConfigurationLaserPanel(
-            self, wx.ID_ANY, context=self.context
-        )
-        sizer_page_1.Add(self.ConfigurationLaserPanel, 1, wx.EXPAND, 0)
-
-        self.SetSizer(sizer_page_1)
-
-        self.Layout()
-
-        self.text_device_label.SetActionRoutine(self.on_device_label)
-        self.Bind(wx.EVT_COMBOBOX, self.on_combobox_boardtype, self.combobox_board)
-        self.Bind(wx.EVT_CHECKBOX, self.on_check_flip_x, self.checkbox_flip_x)
-        self.Bind(wx.EVT_CHECKBOX, self.on_check_home_right, self.checkbox_home_right)
-        self.Bind(wx.EVT_CHECKBOX, self.on_check_flip_y, self.checkbox_flip_y)
-        self.Bind(wx.EVT_CHECKBOX, self.on_check_home_bottom, self.checkbox_home_bottom)
-        self.Bind(wx.EVT_CHECKBOX, self.on_check_swapxy, self.checkbox_swap_xy)
-        self.Bind(wx.EVT_RADIOBUTTON, self.on_radio_interface, self.radio_usb)
-        self.Bind(wx.EVT_RADIOBUTTON, self.on_radio_interface, self.radio_tcp)
-        self.Bind(wx.EVT_RADIOBUTTON, self.on_radio_interface, self.radio_mock)
-        # end wxGlade
-        self.text_device_label.SetValue(self.context.label)
-        self.checkbox_swap_xy.SetValue(self.context.swap_xy)
-        self.checkbox_flip_x.SetValue(self.context.flip_x)
-        self.checkbox_flip_y.SetValue(self.context.flip_y)
-        self.checkbox_home_right.SetValue(self.context.home_right)
-        self.checkbox_home_bottom.SetValue(self.context.home_bottom)
-        self.combobox_board.SetValue(self.context.board)
-        if self.context.mock:
-            self.panel_tcp_config.Hide()
-            self.panel_usb_settings.Hide()
-            self.radio_mock.SetValue(True)
-        elif self.context.networked:
-            self.panel_usb_settings.Hide()
-            self.radio_tcp.SetValue(True)
+    def set_buffer(self):
+        width, height = self.panel_preview.Size
+        if width <= 0:
+            width = 1
+        if height <= 0:
+            height = 1
+        self._Buffer = wx.Bitmap(width, height)
+
+    def refresh_display(self):
+        if not wx.IsMainThread():
+            wx.CallAfter(self.refresh_in_ui)
         else:
-            self.radio_usb.SetValue(True)
-            self.panel_tcp_config.Hide()
-        self.SetupScrolling()
+            self.refresh_in_ui()
 
-    def pane_show(self):
-        self.ConfigurationLaserPanel.pane_show()
-        self.panel_usb_settings.pane_show()
-        self.panel_tcp_config.pane_show()
-
-    def pane_hide(self):
-        self.ConfigurationLaserPanel.pane_hide()
-        self.panel_usb_settings.pane_hide()
-        self.panel_tcp_config.pane_hide()
-
-    def on_combobox_boardtype(self, event=None):
-        self.context.board = self.combobox_board.GetValue()
-
-    def on_check_swapxy(self, event=None):
-        self.context.swap_xy = self.checkbox_swap_xy.GetValue()
-        self.context("viewport_update\n")
-        self.context.signal("bedsize", False)
-
-    def on_check_flip_x(self, event=None):
-        self.context.flip_x = self.checkbox_flip_x.GetValue()
-        self.context("viewport_update\n")
-        self.context.signal("bedsize", False)
-
-    def on_check_home_right(self, event=None):
-        direction = self.checkbox_home_right.GetValue()
-        self.context.home_right = direction
-        if direction:
-            self.context.show_flip_x = True
-            self.context.origin_x = 1.0
-        else:
-            self.context.show_flip_x = False
-            self.context.origin_x = 0.0
-        self.context.show_origin_x = self.context.origin_x
-        self.context("viewport_update\n")
-        self.context.signal("bedsize", False)
-
-    def on_check_flip_y(self, event=None):
-        self.context.flip_y = self.checkbox_flip_y.GetValue()
-        self.context("viewport_update\n")
-        self.context.signal("bedsize", False)
-
-    def on_check_home_bottom(self, event=None):
-        direction = self.checkbox_home_bottom.GetValue()
-        self.context.home_bottom = direction
-        if direction:
-            self.context.show_flip_y = True
-            self.context.origin_y = 1.0
-        else:
-            self.context.show_flip_y = False
-            self.context.origin_y = 0.0
-        self.context.show_origin_y = self.context.origin_y
-        self.context("viewport_update\n")
-        self.context.signal("bedsize", False)
-
-    def on_device_label(self):
-        self.context.label = self.text_device_label.GetValue()
-        self.context.signal("device;renamed")
-
-    def on_radio_interface(
-        self, event
-    ):  # wxGlade: ConfigurationInterfacePanel.<event_handler>
-        if self.radio_usb.GetValue():
-            self.panel_tcp_config.Hide()
-            self.panel_usb_settings.Show()
-            self.context.networked = False
-            self.context.mock = False
-            self.context(".network_update\n")
-        if self.radio_tcp.GetValue():
-            self.panel_tcp_config.Show()
-            self.panel_usb_settings.Hide()
-            self.context.networked = True
-            self.context.mock = False
-            self.context(".network_update\n")
-        if self.radio_mock.GetValue():
-            self.panel_tcp_config.Hide()
-            self.panel_usb_settings.Hide()
-            self.context.networked = False
-            self.context.mock = True
-            self.context(".network_update\n")
+    def on_paint(self, event):
         self.Layout()
+        self.set_buffer()
+        wx.CallAfter(self.refresh_in_ui)
 
+    def on_size(self, event=None):
+        self.Layout()
+        self.set_buffer()
+        wx.CallAfter(self.refresh_in_ui)
 
-class ConfigurationSetupPanel(ScrolledPanel):
-    def __init__(self, *args, context=None, **kwds):
-        # begin wxGlade: ConfigurationSetupPanel.__init__
-        kwds["style"] = kwds.get("style", 0)
-        wx.Panel.__init__(self, *args, **kwds)
-        self.context = context
-
-        sizer_page_2 = wx.BoxSizer(wx.VERTICAL)
-
-        sizer_general = StaticBoxSizer(
-            self, wx.ID_ANY, _("General Options"), wx.VERTICAL
-        )
-        sizer_page_2.Add(sizer_general, 0, wx.EXPAND, 0)
-
-        self.check_autolock = wx.CheckBox(self, wx.ID_ANY, _("Automatically lock rail"))
-        self.check_autolock.SetToolTip(_("Lock rail after operations are finished."))
-        self.check_autolock.SetValue(1)
-        sizer_general.Add(self.check_autolock, 0, wx.EXPAND, 0)
-
-        self.check_plot_shift = wx.CheckBox(self, wx.ID_ANY, _("Pulse Grouping"))
-        self.check_plot_shift.SetToolTip(
-            "\n".join(
-                [
-                    _(
-                        "Pulse Grouping is an alternative means of reducing the incidence of stuttering, allowing you potentially to burn at higher speeds."
-                    ),
-                    "",
-                    _(
-                        "It works by swapping adjacent on or off bits to group on and off together and reduce the number of switches."
-                    ),
-                    "",
-                    _(
-                        'As an example, instead of X_X_ it will burn XX__ - because the laser beam is overlapping, and because a bit is only moved at most 1/1000", the difference should not be visible even under magnification.'
+    def refresh_in_ui(self):
+        if self.in_draw_event:
+            return
+        # Create paint DC
+        self.in_draw_event = True
+        if self._Buffer is None:
+            self.set_buffer()
+        dc = wx.MemoryDC()
+        dc.SelectObject(self._Buffer)
+        dc.SetBackground(wx.WHITE_BRUSH)
+        dc.Clear()
+        # Create graphics context from it
+        gc = wx.GraphicsContext.Create(dc)
+
+        if gc:
+            wd, ht = self.panel_preview.GetSize()
+            try:
+                ratio = min(
+                    wd / self.hinge_generator.width, ht / self.hinge_generator.height
+                )
+            except ZeroDivisionError:
+                return
+            ratio *= 0.9
+            if self._use_geomstr:
+                matrix = gc.CreateMatrix(
+                    a=ratio,
+                    b=0,
+                    c=0,
+                    d=ratio,
+                    tx=ratio
+                    * (
+                        0.05 * self.hinge_generator.width - self.hinge_generator.start_x
                     ),
-                    _(
-                        "Whilst the Pulse Grouping option in Operations are set for that operation before the job is spooled, and cannot be changed on the fly, this global Pulse Grouping option is checked as instructions are sent to the laser and can turned on and off during the burn process. Because the changes are believed to be small enough to be undetectable, you may wish to leave this permanently checked."
+                    ty=ratio
+                    * (
+                        0.05 * self.hinge_generator.height
+                        - self.hinge_generator.start_y
                     ),
-                ]
-            ),
-        )
-        sizer_general.Add(self.check_plot_shift, 0, wx.EXPAND, 0)
-
-        self.check_strict = wx.CheckBox(self, wx.ID_ANY, _("Strict"))
-        self.check_strict.SetToolTip(
-            _(
-                "Forces the device to enter and exit programmed speed mode from the same direction.\nThis may prevent devices like the M2-V4 and earlier from having issues. Not typically needed."
-            )
-        )
-        sizer_general.Add(self.check_strict, 0, wx.EXPAND, 0)
-
-        self.check_twitches = wx.CheckBox(self, wx.ID_ANY, _("Twitch Vectors"))
-        self.check_twitches.SetToolTip(
-            _(
-                "Twitching is an unnecessary move in an unneeded direction at the start and end of travel moves between vector burns. "
-                "It is most noticeable when you are doing a number of small burns (e.g. stitch holes in leather). "
-                "A twitchless mode is now default in 0.7.6+ or later which results in a noticeable faster travel time. "
-                "This option allows you to turn on the previous mode if you experience problems."
-            )
-        )
-        sizer_general.Add(self.check_twitches, 0, wx.EXPAND, 0)
-
-        sizer_jog = StaticBoxSizer(self, wx.ID_ANY, _("Rapid Jog"), wx.VERTICAL)
-        sizer_page_2.Add(sizer_jog, 0, wx.EXPAND, 0)
-
-        h_sizer_y3 = wx.BoxSizer(wx.VERTICAL)
-        sizer_jog.Add(h_sizer_y3, 0, wx.EXPAND, 0)
-
-        self.check_rapid_moves_between = wx.CheckBox(
-            self, wx.ID_ANY, _("Rapid Moves Between Objects")
-        )
-        self.check_rapid_moves_between.SetToolTip(
-            _("Perform rapid moves between the objects")
-        )
-        self.check_rapid_moves_between.SetValue(1)
-        h_sizer_y3.Add(self.check_rapid_moves_between, 0, wx.EXPAND, 0)
-
-        h_sizer_y5 = StaticBoxSizer(
-            self, wx.ID_ANY, _("Minimum Jog Distance"), wx.HORIZONTAL
-        )
-        h_sizer_y3.Add(h_sizer_y5, 0, wx.EXPAND, 0)
-
-        self.text_minimum_jog_distance = TextCtrl(
-            self,
-            wx.ID_ANY,
-            "",
-            limited=True,
-            style=wx.TE_PROCESS_ENTER,
-        )
-        h_sizer_y5.Add(self.text_minimum_jog_distance, 1, wx.EXPAND, 0)
-
-        self.radio_box_jog_method = wx.RadioBox(
-            self,
-            wx.ID_ANY,
-            _("Jog Method"),
-            choices=[_("Default"), _("Reset"), _("Finish")],
-            majorDimension=3,
-            style=wx.RA_SPECIFY_COLS,  # wx.RA_SPECIFY_ROWS,
-        )
-        self.radio_box_jog_method.SetToolTip(
-            _(
-                "Changes the method of jogging. Default are NSE jogs. Reset are @NSE jogs. Finished are @FNSE jogs followed by a wait."
+                )
+            else:
+                matrix = gc.CreateMatrix(
+                    a=ratio,
+                    b=0,
+                    c=0,
+                    d=ratio,
+                    tx=0.05 * ratio * self.hinge_generator.width,
+                    ty=0.05 * ratio * self.hinge_generator.height,
+                )
+            gc.SetTransform(matrix)
+            if ratio == 0:
+                ratio = 1
+            linewidth = max(int(1 / ratio), 1)
+            if self.check_preview_show_shape.GetValue():
+                mypen_border = wx.Pen(wx.BLUE, linewidth, wx.PENSTYLE_SOLID)
+                gc.SetPen(mypen_border)
+                if self.hinge_generator.outershape is None:
+                    # Draw the hinge area:
+                    gc.DrawRectangle(
+                        0, 0, self.hinge_generator.width, self.hinge_generator.height
+                    )
+                else:
+                    if self._use_geomstr:
+                        path = self.hinge_generator.outershape.as_path()
+                        if path:
+                            gcpath = self.renderer.make_path(gc, path)
+                            gc.StrokePath(gcpath)
+                    else:
+                        node = copy(self.hinge_generator.outershape)
+                        bb = node.bbox()
+                        node.matrix *= Matrix.translate(-bb[0], -bb[1])
+                        path = node.as_path()
+                        gcpath = self.renderer.make_path(gc, path)
+                        gc.StrokePath(gcpath)
+            if self.check_preview_show_pattern.GetValue():
+                mypen_path = wx.Pen(wx.RED, linewidth, wx.PENSTYLE_SOLID)
+                # flag = self.check_debug_outline.GetValue()
+                self.hinge_generator.generate(
+                    show_outline=False,
+                    force=False,
+                    final=False,
+                )
+                gc.SetPen(mypen_path)
+                gspath = self.hinge_generator.preview_path
+                if gspath is not None:
+                    if isinstance(gspath, Path):
+                        gcpath = self.renderer.make_path(gc, gspath)
+                    else:
+                        gcpath = self.renderer.make_geomstr(gc, gspath)
+                    gc.StrokePath(gcpath)
+        self.panel_preview.Refresh()
+        self.panel_preview.Update()
+        self.in_draw_event = False
+
+    def on_button_close(self, event):
+        self.context("window close Hingetool\n")
+
+    def on_default_button(self, event):
+        idx = self.combo_style.GetSelection()
+        if idx < 0:
+            return
+        pattern = self.patterns[idx]
+        entry = self.context.lookup(f"pattern/{pattern}")
+        default = entry[4]
+
+        self.slider_width.SetValue(200)
+        self.slider_width_label.SetLabel(f"{self.slider_width.GetValue()/_FACTOR:.1%}")
+        self.slider_height.SetValue(200)
+        self.slider_height_label.SetLabel(
+            f"{self.slider_height.GetValue()/_FACTOR:.1%}"
+        )
+        self.slider_offset_x.SetValue(default[0])
+        self.slider_offx_label.SetLabel(f"{default[0]/_FACTOR:.1%}")
+        self.slider_offset_y.SetValue(default[1])
+        self.slider_offy_label.SetLabel(f"{default[1]/_FACTOR:.1%}")
+        self.slider_param_a.SetValue(int(10 * default[2]))
+        self.slider_param_b.SetValue(int(10 * default[3]))
+        self.on_option_update(None)
+
+    def on_button_generate(self, event):
+        from time import time
+
+        oldlabel = self.button_generate.Label
+        self.button_generate.Enable(False)
+        self.button_generate.SetLabel(_("Processing..."))
+        start_time = time()
+        if self.hinge_generator.outershape is not None:
+            # As we have a reference shape, we make sure
+            # we update the information...
+            units = self.context.units_name
+            bounds = self.hinge_generator.outershape.bbox()
+            start_x = bounds[0]
+            start_y = bounds[1]
+            wd = bounds[2] - bounds[0]
+            ht = bounds[3] - bounds[1]
+            self.hinge_origin_x = Length(
+                amount=start_x, digits=3, preferred_units=units
+            ).preferred_length
+            self.hinge_origin_y = Length(
+                amount=start_y, digits=3, preferred_units=units
+            ).preferred_length
+            self.hinge_width = Length(
+                amount=wd, digits=2, preferred_units=units
+            ).preferred_length
+            self.hinge_height = Length(
+                amount=ht, digits=2, preferred_units=units
+            ).preferred_length
+            self.text_origin_x.ChangeValue(self.hinge_origin_x)
+            self.text_origin_y.ChangeValue(self.hinge_origin_y)
+            self.text_width.ChangeValue(self.hinge_width)
+            self.text_height.ChangeValue(self.hinge_height)
+            self.hinge_generator.set_hinge_area(start_x, start_y, wd, ht)
+
+        # Polycut algorithm does not work for me (yet), final=False still
+        self.hinge_generator.generate(show_outline=False, force=True, final=True)
+        path = self.hinge_generator.path
+        if hasattr(path, "as_path"):
+            path = path.as_path()
+        node = self.context.elements.elem_branch.add(
+            path=path,
+            stroke_width=500,
+            stroke=Color("red"),
+            type="elem path",
+        )
+        # Lets simplify things...
+        self.context.elements.simplify_node(node)
+
+        if self.hinge_generator.outershape is not None:
+            group_node = self.hinge_generator.outershape.parent.add(
+                type="group", label="Hinge"
             )
-        )
-        self.radio_box_jog_method.SetSelection(0)
-        sizer_jog.Add(self.radio_box_jog_method, 0, wx.EXPAND, 0)
-
-        sizer_rapid_override = StaticBoxSizer(
-            self, wx.ID_ANY, _("Rapid Override"), wx.VERTICAL
-        )
-        sizer_page_2.Add(sizer_rapid_override, 0, wx.EXPAND, 0)
-
-        self.check_override_rapid = wx.CheckBox(
-            self, wx.ID_ANY, _("Override Rapid Movements")
-        )
-        sizer_rapid_override.Add(self.check_override_rapid, 0, wx.EXPAND, 0)
-        self.check_override_rapid.SetMaxSize(wx.Size(300, -1))
-
-        sizer_speed_xy = wx.BoxSizer(wx.HORIZONTAL)
-
-        sizer_36 = StaticBoxSizer(self, wx.ID_ANY, _("X Travel Speed:"), wx.HORIZONTAL)
-
-        self.text_rapid_x = TextCtrl(
-            self,
-            wx.ID_ANY,
-            "",
-            limited=True,
-            check="float",
-            style=wx.TE_PROCESS_ENTER,
-        )
-        sizer_36.Add(self.text_rapid_x, 1, wx.EXPAND, 0)
-
-        label_2 = wx.StaticText(self, wx.ID_ANY, _("mm/s"))
-        sizer_36.Add(label_2, 0, wx.ALIGN_CENTER_VERTICAL, 0)
-
-        sizer_35 = StaticBoxSizer(self, wx.ID_ANY, _("Y Travel Speed:"), wx.HORIZONTAL)
-
-        sizer_speed_xy.Add(sizer_36, 1, wx.EXPAND, 0)
-        sizer_speed_xy.Add(sizer_35, 1, wx.EXPAND, 0)
-
-        sizer_rapid_override.Add(sizer_speed_xy, 0, wx.EXPAND, 0)
+            group_node.append_child(self.hinge_generator.outershape)
+            group_node.append_child(node)
+        end_time = time()
+        self.Parent.SetTitle(_("Living-Hinges") + f" ({end_time-start_time:.2f}s.)")
+
+        self.context.signal("classify_new", node)
+        self.context.signal("refresh_scene", "Scene")
+        self.button_generate.Enable(True)
+        self.button_generate.SetLabel(oldlabel)
+
+    def on_pattern_update(self, event):
+        # Save the old values...
+        # self._save_settings()
+        idx = self.combo_style.GetSelection()
+        if idx < 0:
+            idx = 0
+        style = self.patterns[idx]
+        self.context.hinge_type = style
+        # Load new set of values...
+        self._restore_settings(reload=True)
+        self.sync_controls(True)
+        self.apply()
 
-        self.text_rapid_y = TextCtrl(
-            self, wx.ID_ANY, "", limited=True, check="float", style=wx.TE_PROCESS_ENTER
-        )
-        sizer_35.Add(self.text_rapid_y, 1, wx.EXPAND, 0)
-
-        label_4 = wx.StaticText(self, wx.ID_ANY, _("mm/s"))
-        sizer_35.Add(label_4, 0, wx.ALIGN_CENTER_VERTICAL, 0)
-
-        sizer_speed = StaticBoxSizer(self, wx.ID_ANY, _("Speed:"), wx.VERTICAL)
-        sizer_page_2.Add(sizer_speed, 0, wx.EXPAND, 0)
-
-        sizer_32 = wx.BoxSizer(wx.HORIZONTAL)
-        sizer_speed.Add(sizer_32, 0, wx.EXPAND, 0)
-
-        self.check_fix_speeds = wx.CheckBox(
-            self, wx.ID_ANY, _("Fix rated to actual speed")
-        )
-        self.check_fix_speeds.SetToolTip(
-            _(
-                "Correct for speed invalidity. Lihuiyu Studios speeds are 92% of the correctly rated speed"
+    def sync_controls(self, to_text=True):
+        # print(f"Sync-Control called: {to_text}")
+        try:
+            wd = float(Length(self.text_width.GetValue()))
+        except ValueError:
+            wd = 0
+        try:
+            ht = float(Length(self.text_height.GetValue()))
+        except ValueError:
+            ht = 0
+        if to_text:
+            cell_x = self.slider_width.GetValue()
+            cell_y = self.slider_height.GetValue()
+            offset_x = self.slider_offset_x.GetValue()
+            offset_y = self.slider_offset_y.GetValue()
+            units = self.context.units_name
+            cx = cell_x / _FACTOR * wd
+            cy = cell_y / _FACTOR * ht
+            self.text_cell_width.SetValue(
+                Length(amount=cx, preferred_units=units).preferred_length
             )
-        )
-        self.check_fix_speeds.SetMaxSize(wx.Size(300, -1))
-
-        sizer_32.Add(self.check_fix_speeds, 1, wx.EXPAND, 0)
-
-        self.text_fix_rated_speed = TextCtrl(
-            self, wx.ID_ANY, str(FIX_SPEEDS_RATIO), style=wx.TE_READONLY, limited=True
-        )
-        sizer_32.Add(self.text_fix_rated_speed, 1, wx.EXPAND, 0)
-
-        h_sizer_y9 = wx.BoxSizer(wx.HORIZONTAL)
-        sizer_speed.Add(h_sizer_y9, 0, wx.EXPAND, 0)
-
-        self.check_scale_speed = wx.CheckBox(self, wx.ID_ANY, _("Scale Speed"))
-        self.check_scale_speed.SetToolTip(
-            _(
-                "Scale any given speeds to this device by this amount. If set to 1.1, all speeds are 10% faster than rated."
+            self.text_cell_height.SetValue(
+                Length(amount=cy, preferred_units=units).preferred_length
             )
-        )
-        self.check_scale_speed.SetMaxSize(wx.Size(300, -1))
-        h_sizer_y9.Add(self.check_scale_speed, 1, wx.EXPAND, 0)
 
-        self.text_speed_scale_amount = TextCtrl(
-            self,
-            wx.ID_ANY,
-            "1.000",
-            limited=True,
-            check="float",
-            nonzero=True,
-            style=wx.TE_PROCESS_ENTER,
-        )
-        self.text_speed_scale_amount.SetToolTip(
-            _(
-                "Scales the machine's speed ratio so that rated speeds speeds multiplied by this ratio."
+            self.text_cell_offset_x.SetValue(
+                Length(
+                    amount=cx * offset_x / _FACTOR, preferred_units=units
+                ).preferred_length
             )
-        )
-        h_sizer_y9.Add(self.text_speed_scale_amount, 1, wx.EXPAND, 0)
-
-        sizer_30 = wx.BoxSizer(wx.HORIZONTAL)
-        sizer_speed.Add(sizer_30, 0, wx.EXPAND, 0)
-
-        self.check_max_speed_vector = wx.CheckBox(
-            self, wx.ID_ANY, _("Max Speed (Vector)")
-        )
-        self.check_max_speed_vector.SetToolTip(
-            _("Limit the maximum vector speed to this value")
-        )
-        self.check_max_speed_vector.SetMaxSize(wx.Size(300, -1))
-        sizer_30.Add(self.check_max_speed_vector, 1, wx.EXPAND, 0)
-
-        self.text_max_speed_vector = TextCtrl(
-            self,
-            wx.ID_ANY,
-            "100",
-            limited=True,
-            check="float",
-            style=wx.TE_PROCESS_ENTER,
-        )
-        self.text_max_speed_vector.SetToolTip(
-            _("maximum speed at which all greater speeds are limited")
-        )
-        sizer_30.Add(self.text_max_speed_vector, 1, wx.EXPAND, 0)
-
-        sizer_31 = wx.BoxSizer(wx.HORIZONTAL)
-        sizer_speed.Add(sizer_31, 0, wx.EXPAND, 0)
-
-        self.check_max_speed_raster = wx.CheckBox(
-            self, wx.ID_ANY, _("Max Speed (Raster)")
-        )
-        self.check_max_speed_raster.SetToolTip(
-            _("Limit the maximum raster speed to this value")
-        )
-        self.check_max_speed_raster.SetMaxSize(wx.Size(300, -1))
-        sizer_31.Add(self.check_max_speed_raster, 1, wx.EXPAND, 0)
-
-        self.text_max_speed_raster = TextCtrl(
-            self,
-            wx.ID_ANY,
-            "750",
-            limited=True,
-            check="float",
-            style=wx.TE_PROCESS_ENTER,
-        )
-        self.text_max_speed_raster.SetToolTip(
-            _("maximum speed at which all greater speeds are limited")
-        )
-        sizer_31.Add(self.text_max_speed_raster, 1, wx.EXPAND, 0)
-
-        self.SetSizer(sizer_page_2)
-
-        self.Layout()
-
-        self.Bind(wx.EVT_CHECKBOX, self.on_check_autolock, self.check_autolock)
-        self.Bind(wx.EVT_CHECKBOX, self.on_check_pulse_shift, self.check_plot_shift)
-        self.Bind(wx.EVT_CHECKBOX, self.on_check_strict, self.check_strict)
-        self.Bind(wx.EVT_CHECKBOX, self.on_check_twitches, self.check_twitches)
-        self.Bind(
-            wx.EVT_CHECKBOX, self.on_check_rapid_between, self.check_rapid_moves_between
-        )
-        self.text_minimum_jog_distance.SetActionRoutine(self.on_text_min_jog_distance)
-        self.Bind(wx.EVT_RADIOBOX, self.on_jog_method_radio, self.radio_box_jog_method)
-        self.Bind(
-            wx.EVT_CHECKBOX, self.on_check_override_rapid, self.check_override_rapid
-        )
-        self.text_rapid_x.SetActionRoutine(self.on_text_rapid_x)
-        self.text_rapid_y.SetActionRoutine(self.on_text_rapid_y)
-        self.Bind(wx.EVT_CHECKBOX, self.on_check_fix_speeds, self.check_fix_speeds)
-        self.Bind(wx.EVT_CHECKBOX, self.on_check_scale_speed, self.check_scale_speed)
-        self.text_speed_scale_amount.SetActionRoutine(self.on_text_speed_scale)
-        self.Bind(
-            wx.EVT_CHECKBOX, self.on_check_max_speed_vector, self.check_max_speed_vector
-        )
-        self.text_max_speed_vector.SetActionRoutine(self.on_text_speed_max_vector)
-        self.Bind(
-            wx.EVT_CHECKBOX, self.on_check_max_speed_raster, self.check_max_speed_raster
-        )
-        self.text_max_speed_raster.SetActionRoutine(self.on_text_speed_max_raster)
-        # end wxGlade
-
-        self.check_autolock.SetValue(self.context.autolock)
-        self.check_plot_shift.SetValue(self.context.plot_shift)
-        self.check_strict.SetValue(self.context.strict)
-        self.check_twitches.SetValue(self.context.twitches)
-        self.check_rapid_moves_between.SetValue(self.context.opt_rapid_between)
-        self.text_minimum_jog_distance.SetValue(str(self.context.opt_jog_minimum))
-        self.radio_box_jog_method.SetSelection(self.context.opt_jog_mode)
-        self.check_override_rapid.SetValue(self.context.rapid_override)
-        self.text_rapid_x.SetValue(str(self.context.rapid_override_speed_x))
-        self.text_rapid_y.SetValue(str(self.context.rapid_override_speed_y))
-        self.check_fix_speeds.SetValue(self.context.fix_speeds)
-        self.check_scale_speed.SetValue(self.context.scale_speed_enabled)
-        self.text_speed_scale_amount.SetValue(str(self.context.scale_speed))
-        self.check_max_speed_vector.SetValue(self.context.max_speed_vector_enabled)
-        self.text_max_speed_vector.SetValue(str(self.context.max_speed_vector))
-        self.check_max_speed_raster.SetValue(self.context.max_speed_raster_enabled)
-        self.text_max_speed_raster.SetValue(str(self.context.max_speed_raster))
-
-        # Disables of features not yet supported.
-        self.text_max_speed_raster.Enable(False)
-        self.text_max_speed_vector.Enable(False)
-        self.text_speed_scale_amount.Enable(False)
-        self.check_max_speed_raster.Enable(False)
-        self.check_max_speed_vector.Enable(False)
-        self.check_scale_speed.Enable(False)
-        self.SetupScrolling()
-
-    def pane_show(self):
-        pass
-
-    def pane_hide(self):
-        pass
-
-    def on_check_fix_speeds(self, event=None):
-        self.context.fix_speeds = self.check_fix_speeds.GetValue()
-        self.text_fix_rated_speed.SetValue(
-            "1.000" if self.context.fix_speeds else str(FIX_SPEEDS_RATIO)
-        )
-
-    def on_check_strict(self, event=None):
-        self.context.strict = self.check_strict.GetValue()
-
-    def on_check_autolock(self, event=None):
-        self.context.autolock = self.check_autolock.GetValue()
-
-    def on_check_pulse_shift(self, event=None):
-        self.context.plot_shift = self.check_plot_shift.GetValue()
-        try:
-            self.context.plot_planner.force_shift = self.context.plot_shift
-        except (AttributeError, TypeError):
-            pass
-
-    def on_check_twitches(self, event):
-        self.context.twitches = self.check_twitches.GetValue()
-
-    def on_check_rapid_between(self, event):
-        self.context.opt_rapid_between = self.check_rapid_moves_between.GetValue()
-
-    def on_text_min_jog_distance(self):
-        try:
-            self.context.opt_jog_minimum = int(
-                self.text_minimum_jog_distance.GetValue()
+            self.text_cell_offset_y.SetValue(
+                Length(
+                    amount=cy * offset_y / _FACTOR, preferred_units=units
+                ).preferred_length
             )
-        except ValueError:
-            pass
-
-    def on_jog_method_radio(self, event):
-        self.context.opt_jog_mode = self.radio_box_jog_method.GetSelection()
-
-    def on_check_override_rapid(self, event):
-        self.context.rapid_override = self.check_override_rapid.GetValue()
-
-    def on_text_rapid_x(self):
+        else:
+            try:
+                cx = float(Length(self.text_cell_width.GetValue()))
+            except ValueError:
+                cx = 0
+            try:
+                cy = float(Length(self.text_cell_height.GetValue()))
+            except ValueError:
+                cy = 0
+            try:
+                offset_x = float(Length(self.text_cell_offset_x.GetValue()))
+            except ValueError:
+                offset_x = 0
+            try:
+                offset_y = float(Length(self.text_cell_offset_y.GetValue()))
+            except ValueError:
+                offset_y = 0
+            if wd != 0:
+                px = int(_FACTOR * cx / wd)
+            else:
+                px = _FACTOR
+            if ht != 0:
+                py = int(_FACTOR * cy / ht)
+            else:
+                py = _FACTOR
+            if self.slider_width.GetValue() != px:
+                self.hinge_cells_x = px
+                self.slider_width.SetValue(px)
+                self.slider_width_label.SetLabel(f"{self.hinge_cells_x/_FACTOR:.1%}")
+            if self.slider_height.GetValue() != py:
+                self.hinge_cells_y = py
+                self.slider_height.SetValue(py)
+                self.slider_height_label.SetLabel(f"{self.hinge_cells_y/_FACTOR:.1%}")
+            if cx != 0:
+                px = int(_FACTOR * offset_x / cx)
+            else:
+                px = 0
+            if cy != 0:
+                py = int(_FACTOR * offset_y / cy)
+            else:
+                py = 0
+            if self.slider_offset_x.GetValue() != px:
+                self.hinge_padding_x = px
+                self.slider_offset_x.SetValue(px)
+                self.slider_offx_label.SetLabel(f"{px/_FACTOR:.1%}")
+            if self.slider_offset_y.GetValue() != py:
+                self.hinge_padding_y = py
+                self.slider_offset_y.SetValue(py)
+                self.slider_offy_label.SetLabel(f"{py/_FACTOR:.1%}")
+
+    def on_option_update(self, event):
+        # Generic update within a pattern
+        if event is not None:
+            event.Skip()
+        if self.in_change_event:
+            return
+        self.in_change_event = True
+        if event is None:
+            origin = None
+        else:
+            origin = event.GetEventObject()
+            if event.GetEventType() == wx.wxEVT_TEXT and not getattr(
+                self.context.root, "process_while_typing", False
+            ):
+                self.in_change_event = False
+                return
+            if isinstance(origin, wx.TextCtrl):
+                newvalue = origin.GetValue().strip().lower()
+                # Some basic checks:
+                # a) Empty?
+                # b) Is it a valid length?
+                # c) Does it have a unit at the end?
+                if len(newvalue) == 0:
+                    self.in_change_event = False
+                    return
+                try:
+                    testlen = float(Length(newvalue))
+                except ValueError:
+                    self.in_change_event = False
+                    return
+                valid = False
+                for unit in ACCEPTED_UNITS:
+                    if unit == "" or unit == "%":
+                        # no relative units or no units at all
+                        continue
+                    if newvalue.endswith(unit):
+                        valid = True
+                        break
+                if not valid:
+                    self.in_change_event = False
+                    return
+        # etype = event.GetEventType()
+        sync_direction = True
+        if (
+            origin is self.text_cell_height
+            or origin is self.text_cell_width
+            or origin is self.text_cell_offset_x
+            or origin is self.text_cell_offset_y
+        ):
+            sync_direction = False
+        flag = True
         try:
-            self.context.rapid_override_speed_x = float(self.text_rapid_x.GetValue())
+            wd = float(Length(self.text_width.GetValue()))
+            if wd > 0:
+                self.hinge_width = self.text_width.GetValue()
         except ValueError:
-            pass
-
-    def on_text_rapid_y(self):
+            wd = 0
+            flag = False
         try:
-            self.context.rapid_override_speed_y = float(self.text_rapid_y.GetValue())
+            ht = float(Length(self.text_height.GetValue()))
+            if ht > 0:
+                self.hinge_height = self.text_height.GetValue()
         except ValueError:
-            pass
-
-    def on_check_scale_speed(
-        self, event
-    ):  # wxGlade: ConfigurationSetupPanel.<event_handler>
-        self.context.scale_speed_enabled = self.check_scale_speed.GetValue()
-
-    def on_text_speed_scale(self):
+            ht = 0
+            flag = False
         try:
-            self.context.scale_speed = float(self.text_speed_scale_amount.GetValue())
+            x = float(Length(self.text_origin_x.GetValue()))
+            self.hinge_origin_x = self.text_origin_x.GetValue()
         except ValueError:
-            pass
-
-    def on_check_max_speed_vector(
-        self, event
-    ):  # wxGlade: ConfigurationSetupPanel.<event_handler>
-        self.context.max_speed_vector_enabled = self.check_max_speed_vector.GetValue()
-
-    def on_text_speed_max_vector(self):
+            x = 0
+            flag = False
         try:
-            self.context.max_speed_vector = float(self.text_max_speed_vector.GetValue())
+            y = float(Length(self.text_origin_y.GetValue()))
+            self.hinge_origin_y = self.text_origin_y.GetValue()
         except ValueError:
-            pass
-
-    def on_check_max_speed_raster(
-        self, event
-    ):  # wxGlade: ConfigurationSetupPanel.<event_handler>
-        self.context.max_speed_raster_enabled = self.check_max_speed_raster.GetValue()
+            y = 0
+            flag = False
+        cell_x = self.slider_width.GetValue()
+        cell_y = self.slider_height.GetValue()
+        self.hinge_cells_x = cell_x
+        self.hinge_cells_y = cell_y
+        self.slider_width_label.SetLabel(f"{self.hinge_cells_x/_FACTOR:.1%}")
+        self.slider_height_label.SetLabel(f"{self.hinge_cells_y/_FACTOR:.1%}")
+
+        offset_x = self.slider_offset_x.GetValue()
+        offset_y = self.slider_offset_y.GetValue()
+        self.hinge_padding_x = offset_x
+        self.hinge_padding_y = offset_y
+        self.slider_offx_label.SetLabel(f"{self.hinge_padding_x/_FACTOR:.1%}")
+        self.slider_offy_label.SetLabel(f"{self.hinge_padding_y/_FACTOR:.1%}")
+
+        self.sync_controls(to_text=sync_direction)
+
+        p_a = self.slider_param_a.GetValue() / 10.0
+        p_b = self.slider_param_b.GetValue() / 10.0
+        self.hinge_param_a = p_a
+        self.hinge_param_b = p_b
+        self._save_settings()
+        self.apply()
+        self.in_change_event = False
+
+    def _setup_settings(self):
+        firstpattern = self.patterns[0]
+        for (pattern, recommended) in zip(self.patterns, self.defaults):
+            default = (
+                pattern,
+                200,
+                200,
+                recommended[0],
+                recommended[1],
+                recommended[2],
+                recommended[3],
+            )
+            self.context.setting(list, f"hinge_{pattern}", default)
+        self.context.setting(str, "hinge_type", firstpattern)
 
-    def on_text_speed_max_raster(self):
-        try:
-            self.context.max_speed_raster = float(self.text_max_speed_raster.GetValue())
-        except ValueError:
-            pass
+    def apply(self):
+        # Restore settings will call the LivingHinge class
+        self._restore_settings(reload=False)
+        self.refresh_display()
+
+    def _save_settings(self):
+        pattern = self.context.hinge_type
+        default = (
+            pattern,
+            self.hinge_cells_x,
+            self.hinge_cells_y,
+            self.hinge_padding_x,
+            self.hinge_padding_y,
+            self.hinge_param_a,
+            self.hinge_param_b,
+        )
+        setattr(self.context, f"hinge_{pattern}", default)
+        # print (f"Stored defaults for {pattern}: {default}")
+
+    def _restore_settings(self, reload=False):
+        pattern = self.context.hinge_type
+        if pattern not in self.patterns:
+            pattern = self.patterns[0]
+            self.context.hinge_type = pattern
+
+        if reload:
+            default = getattr(self.context, f"hinge_{pattern}", None)
+            # print (f"Got defaults for {pattern}: {default}")
+            if default is None or len(default) < 7:
+                # strange
+                # print(f"Could not get a setting for {pattern}: {default}")
+                return
+            self.hinge_cells_x = default[1]
+            self.hinge_cells_y = default[2]
+            self.hinge_padding_x = default[3]
+            self.hinge_padding_y = default[4]
+            self.hinge_param_a = default[5]
+            self.hinge_param_b = default[6]
+
+        entry = self.context.lookup(f"pattern/{pattern}")
+        flag, info1, info2 = self.hinge_generator.set_predefined_pattern(entry)
+        x = float(Length(self.hinge_origin_x))
+        y = float(Length(self.hinge_origin_y))
+        wd = float(Length(self.hinge_width))
+        ht = float(Length(self.hinge_height))
+        self.hinge_generator.set_hinge_area(x, y, wd, ht)
+        self.hinge_generator.set_cell_values(self.hinge_cells_x, self.hinge_cells_y)
+        self.hinge_generator.set_padding_values(
+            self.hinge_padding_x, self.hinge_padding_y
+        )
+        self.hinge_generator.set_additional_parameters(
+            self.hinge_param_a, self.hinge_param_b
+        )
+        self.slider_param_a.Enable(flag)
+        self.slider_param_b.Enable(flag)
+        self.slider_param_a.Show(flag)
+        self.slider_param_b.Show(flag)
+        if not info1:
+            info1 = "Change the shape appearance"
+        if not info2:
+            info2 = "Change the shape appearance"
+        self.slider_param_a.SetToolTip(_(info1))
+        self.slider_param_b.SetToolTip(_(info2))
+        if self.combo_style.GetSelection() != self.patterns.index(
+            self.context.hinge_type
+        ):
+            self.combo_style.SetSelection(self.patterns.index(self.context.hinge_type))
+        # if self.text_origin_x.GetValue() != self.hinge_origin_x:
+        #     self.text_origin_x.ChangeValue(self.hinge_origin_x)
+        # if self.text_origin_y.GetValue() != self.hinge_origin_y:
+        #     self.text_origin_y.ChangeValue(self.hinge_origin_y)
+        # if self.text_width.GetValue() != self.hinge_width:
+        #     self.text_width.ChangeValue(self.hinge_width)
+        # if self.text_height.GetValue() != self.hinge_height:
+        #     self.text_height.ChangeValue(self.hinge_height)
+        require_sync = False
+        if self.slider_width.GetValue() != self.hinge_cells_x:
+            self.slider_width.SetValue(self.hinge_cells_x)
+            self.slider_width_label.SetLabel(f"{self.hinge_cells_x/_FACTOR:.1%}")
+            require_sync = True
+        if self.slider_height.GetValue() != self.hinge_cells_y:
+            self.slider_height.SetValue(self.hinge_cells_y)
+            self.slider_height_label.SetLabel(f"{self.hinge_cells_y/_FACTOR:.1%}")
+            require_sync = True
+        if self.slider_offset_x.GetValue() != self.hinge_padding_x:
+            self.slider_offset_x.SetValue(self.hinge_padding_x)
+            self.slider_offx_label.SetLabel(f"{self.hinge_padding_x/_FACTOR:.1%}")
+            require_sync = True
+        if self.slider_offset_y.GetValue() != self.hinge_padding_y:
+            self.slider_offset_y.SetValue(self.hinge_padding_y)
+            self.slider_offy_label.SetLabel(f"{self.hinge_padding_y/_FACTOR:.1%}")
+            require_sync = True
+        if self.slider_param_a.GetValue() != int(10 * self.hinge_param_a):
+            self.slider_param_a.SetValue(int(10 * self.hinge_param_a))
+        if self.slider_param_b.GetValue() != int(10 * self.hinge_param_b):
+            self.slider_param_b.SetValue(int(10 * self.hinge_param_b))
+        if require_sync:
+            self.sync_controls(True)
+        flag = wd > 0 and ht > 0
+        self.button_generate.Enable(flag)
+        self.Layout()
 
+    def pane_show(self):
+        first_selected = None
+        units = self.context.units_name
+        flag = True
+        for node in self.context.elements.elems(emphasized=True):
+            if hasattr(node, "as_path"):
+                first_selected = node
+                bounds = node.bbox()
+                self.hinge_generator.set_hinge_shape(first_selected)
+                flag = False
+                break
+        if flag:
+            self.hinge_generator.set_hinge_shape(None)
+            if units in ("in", "inch"):
+                s = "2in"
+            else:
+                s = "5cm"
+            bounds = (0, 0, float(Length(s)), float(Length(s)))
+        self.combo_style.SetSelection(self.patterns.index(self.context.hinge_type))
+        start_x = bounds[0]
+        start_y = bounds[1]
+        wd = bounds[2] - bounds[0]
+        ht = bounds[3] - bounds[1]
+        self.hinge_origin_x = Length(
+            amount=start_x, digits=3, preferred_units=units
+        ).preferred_length
+        self.hinge_origin_y = Length(
+            amount=start_y, digits=3, preferred_units=units
+        ).preferred_length
+        self.hinge_width = Length(
+            amount=wd, digits=2, preferred_units=units
+        ).preferred_length
+        self.hinge_height = Length(
+            amount=ht, digits=2, preferred_units=units
+        ).preferred_length
+        self.text_origin_x.ChangeValue(self.hinge_origin_x)
+        self.text_origin_y.ChangeValue(self.hinge_origin_y)
+        self.text_width.ChangeValue(self.hinge_width)
+        self.text_height.ChangeValue(self.hinge_height)
+        self.text_origin_x.Enable(flag)
+        self.text_origin_y.Enable(flag)
+        self.text_width.Enable(flag)
+        self.text_height.Enable(flag)
+        self.hinge_generator.set_hinge_area(start_x, start_y, wd, ht)
+        self.on_pattern_update(None)
+
+
+class LivingHingeTool(MWindow):
+    """
+    LivingHingeTool is the wrapper class to setup the
+    required calls to open the HingePanel window
+    In addition it listens to element selection and passes this
+    information to HingePanel
+    """
 
-class LihuiyuDriverGui(MWindow):
     def __init__(self, *args, **kwds):
-        super().__init__(330, 630, *args, **kwds)
-        self.context = self.context.device
-        _icon = wx.NullIcon
-        _icon.CopyFromBitmap(icons8_administrative_tools_50.GetBitmap())
-        self.SetIcon(_icon)
-        self.SetTitle(_("Lihuiyu-Configuration"))
-
-        # self.notebook_main = wx.Notebook(self, wx.ID_ANY)
-        self.notebook_main = wx.aui.AuiNotebook(
+        super().__init__(570, 420, submenu="Laser-Tools", *args, **kwds)
+        self.panel_template = HingePanel(
             self,
-            -1,
-            style=wx.aui.AUI_NB_TAB_EXTERNAL_MOVE
-            | wx.aui.AUI_NB_SCROLL_BUTTONS
-            | wx.aui.AUI_NB_TAB_SPLIT
-            | wx.aui.AUI_NB_TAB_MOVE,
-        )
-        self.panels = []
-
-        panel_config = ConfigurationInterfacePanel(
-            self.notebook_main, wx.ID_ANY, context=self.context
-        )
-
-        panel_setup = ConfigurationSetupPanel(
-            self.notebook_main, wx.ID_ANY, context=self.context
+            wx.ID_ANY,
+            context=self.context,
         )
-
-        panel_warn = WarningPanel(self, id=wx.ID_ANY, context=self.context)
-        panel_actions = DefaultActionPanel(self, id=wx.ID_ANY, context=self.context)
-        newpanel = FormatterPanel(self, id=wx.ID_ANY, context=self.context)
-
-        self.panels.append(panel_config)
-        self.panels.append(panel_setup)
-        self.panels.append(panel_warn)
-        self.panels.append(panel_actions)
-        self.panels.append(newpanel)
-
-        self.notebook_main.AddPage(panel_config, _("Configuration"))
-        self.notebook_main.AddPage(panel_setup, _("Setup"))
-        self.notebook_main.AddPage(panel_warn, _("Warning"))
-        self.notebook_main.AddPage(panel_actions, _("Default Actions"))
-        self.notebook_main.AddPage(newpanel, _("Display Options"))
-
+        self.add_module_delegate(self.panel_template)
+        _icon = wx.NullIcon
+        _icon.CopyFromBitmap(icons8_hinges_50.GetBitmap())
+        self.SetIcon(_icon)
+        self.SetTitle(_("Living-Hinges"))
         self.Layout()
-
-        for panel in self.panels:
-            self.add_module_delegate(panel)
+        self.Bind(wx.EVT_ACTIVATE, self.window_active, self)
 
     def window_open(self):
-        for panel in self.panels:
-            panel.pane_show()
+        self.panel_template.pane_show()
 
     def window_close(self):
-        for panel in self.panels:
-            panel.pane_hide()
+        pass
+
+    def window_active(self, event):
+        self.panel_template.pane_show()
 
-    def window_preserve(self):
-        return False
+    @signal_listener("emphasized")
+    def on_emphasized_elements_changed(self, origin, *args):
+        self.panel_template.pane_show()
 
     @staticmethod
     def submenu():
-        return ("Device-Settings", "Configuration")
+        return ("Laser-Tools", "Living-Hinges")
+
+    @staticmethod
+    def sub_register(kernel):
+        kernel.register(
+            "button/extended_tools/LivingHinge",
+            {
+                "label": _("Hinge"),
+                "icon": icons8_hinges_50,
+                "tip": _("Fill area with a living hinge pattern"),
+                "action": lambda v: kernel.console("window open Hingetool\n"),
+                "size": STD_ICON_SIZE,
+                "rule_enabled": lambda cond: len(
+                    list(kernel.elements.elems(emphasized=True))
+                )
+                > 0,
+            },
+        )
```

### Comparing `meerk40t-0.8.2000/meerk40t/lihuiyu/gui/lhyoperationproperties.py` & `meerk40t-0.8.3000/meerk40t/lihuiyu/gui/lhyoperationproperties.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/lihuiyu/gui/tcpcontroller.py` & `meerk40t-0.8.3000/meerk40t/lihuiyu/gui/tcpcontroller.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/lihuiyu/interpreter.py` & `meerk40t-0.8.3000/meerk40t/lihuiyu/interpreter.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/lihuiyu/laserspeed.py` & `meerk40t-0.8.3000/meerk40t/lihuiyu/laserspeed.py`

 * *Files 1% similar despite different names*

```diff
@@ -402,15 +402,15 @@
 
     Since the B2 board is intended to duplicate this it will error as well.
     """
 
     if board == "B2":
         if mm_per_second < 7:
             return True
-    if board == "M2" and mm_per_second < 7:
+    if board in ("M2", "M3") and mm_per_second < 7:
         return True
     return False
 
 
 def get_equation(board, accel=1, suffix_c=False, fix_speeds=False):
     """
     The speed for the M2 was physically checked and found to be inaccurate.
```

### Comparing `meerk40t-0.8.2000/meerk40t/lihuiyu/loader.py` & `meerk40t-0.8.3000/meerk40t/lihuiyu/loader.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/lihuiyu/parser.py` & `meerk40t-0.8.3000/meerk40t/lihuiyu/parser.py`

 * *Files 4% similar despite different names*

```diff
@@ -259,45 +259,45 @@
             self.small_jump = False
         elif c == "z":
             self.append_distance(26 if self.small_jump else 255)
             self.small_jump = False
         elif c == "B":  # Move to Right.
             if self.left and self.horizontal_major:
                 # Was T switched to B with horizontal rastering.
-                if self.raster_step:
+                if self.raster_step and self.compact_state:
                     self.distance_y += self.raster_step
             self.left = False
             self.x_on = True
             self.y_on = False
             if self.channel:
                 self.channel("Right")
         elif c == "T":  # Move to Left
             if not self.left and self.horizontal_major:
                 # Was T switched to B with horizontal rastering.
-                if self.raster_step:
+                if self.raster_step and self.compact_state:
                     self.distance_y += self.raster_step
             self.left = True
             self.x_on = True
             self.y_on = False
             if self.channel:
                 self.channel("Left")
         elif c == "R":  # Move to Bottom
             if self.top and not self.horizontal_major:
                 # Was L switched to R with vertical rastering.
-                if self.raster_step:
+                if self.raster_step and self.compact_state:
                     self.distance_x += self.raster_step
             self.top = False
             self.x_on = False
             self.y_on = True
             if self.channel:
                 self.channel("Bottom")
         elif c == "L":  # Move to Top
             if not self.top and not self.horizontal_major:
                 # Was R switched to L with vertical rastering.
-                if self.raster_step:
+                if self.raster_step and self.compact_state:
                     self.distance_x += self.raster_step
             self.top = True
             self.x_on = False
             self.y_on = True
             if self.channel:
                 self.channel("Top")
         elif c == "U":
@@ -347,23 +347,19 @@
                     self.compact_state = True
                 if self.returning_finished:
                     self.finish_state = True
                 if self.horizontal_major:
                     self.left = not self.left
                     self.x_on = True
                     self.y_on = False
-                    if self.raster_step:
-                        self.distance_y += self.raster_step
                 else:
                     # vertical major
                     self.top = not self.top
                     self.x_on = False
                     self.y_on = True
-                    if self.raster_step:
-                        self.distance_x += self.raster_step
             elif self.mode == 0:
                 # Homes then moves position.
                 pass
             elif self.mode == 1:
                 self.compact_state = True
                 self.horizontal_major = self.x_on
                 if self.channel:
```

### Comparing `meerk40t-0.8.2000/meerk40t/lihuiyu/tcp_connection.py` & `meerk40t-0.8.3000/meerk40t/lihuiyu/tcp_connection.py`

 * *Files 2% similar despite different names*

```diff
@@ -28,14 +28,17 @@
             self.service.signal("tcp;status", "connected")
         except TimeoutError:
             self.disconnect()
             self.service.signal("tcp;status", "timeout connect")
         except ConnectionError:
             self.disconnect()
             self.service.signal("tcp;status", "connection error")
+        except OSError as e:
+            self.disconnect()
+            self.service.signal("tcp;status", f"Host down {str(e)}")
         except socket.gaierror as e:
             self.disconnect()
             self.service.signal("tcp;status", "address resolve error")
         except socket.herror as e:
             self.disconnect()
             self.service.signal("tcp;status", f"herror: {str(e)}")
```

### Comparing `meerk40t-0.8.2000/meerk40t/main.py` & `meerk40t-0.8.3000/meerk40t/main.py`

 * *Files 2% similar despite different names*

```diff
@@ -8,15 +8,15 @@
 import argparse
 import os.path
 import sys
 
 from meerk40t.kernel import Kernel
 
 APPLICATION_NAME = "MeerK40t"
-APPLICATION_VERSION = "0.8.2000"
+APPLICATION_VERSION = "0.8.3000"
 
 if not getattr(sys, "frozen", False):
     # If .git directory does not exist we are running from a package like pypi
     # Otherwise we are running from source
     if os.path.isdir(sys.path[0] + "/.git"):
         APPLICATION_VERSION += " git"
     elif os.path.isdir(sys.path[0] + "/.github"):
@@ -83,14 +83,21 @@
 parser.add_argument(
     "-A",
     "--disable-ansi",
     action="store_true",
     default=False,
     help="Disable ANSI colors",
 )
+parser.add_argument(
+    "-X",
+    "--nuke-settings",
+    action="store_true",
+    default=False,
+    help="Don't load config file at startup",
+)
 
 
 def static_plugins(kernel, lifecycle):
     if lifecycle == "plugins":
         plugins = list()
 
         from .network import kernelserver
@@ -181,14 +188,18 @@
 
         plugins.append(cag.plugin)
 
         from .balormk.plugin import plugin as balorplugin
 
         kernel.add_plugin(balorplugin)
 
+        from .newly.plugin import plugin as newlyplugin
+
+        kernel.add_plugin(newlyplugin)
+
         from .gui.plugin import plugin as wxplugin
 
         plugins.append(wxplugin)
 
         from .extra.imageactions import plugin as splitterplugin
 
         plugins.append(splitterplugin)
@@ -252,12 +263,13 @@
         )
         return
     kernel = Kernel(
         APPLICATION_NAME,
         APPLICATION_VERSION,
         APPLICATION_NAME,
         ansi=not args.disable_ansi,
+        ignore_settings=args.nuke_settings,
     )
     kernel.args = args
     kernel.add_plugin(static_plugins)
     kernel.add_plugin(dynamic_plugins)
     kernel()
```

### Comparing `meerk40t-0.8.2000/meerk40t/moshi/builder.py` & `meerk40t-0.8.3000/meerk40t/moshi/builder.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/moshi/controller.py` & `meerk40t-0.8.3000/meerk40t/moshi/controller.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/moshi/driver.py` & `meerk40t-0.8.3000/meerk40t/moshi/driver.py`

 * *Files 0% similar despite different names*

```diff
@@ -323,14 +323,16 @@
         self.rapid_mode()
 
     def home(self):
         """
         Send a home command to the device. In the case of Moshiboards this is merely a move to
         0,0 in absolute position.
         """
+        if self.service.rotary_active and self.service.rotary_supress_home:
+            return
         self.rapid_mode()
         self.speed = 40
         self.program_mode(0, 0, 0, 0)
         self.rapid_mode()
         self.native_x = 0
         self.native_y = 0
```

### Comparing `meerk40t-0.8.2000/meerk40t/moshi/gui/gui.py` & `meerk40t-0.8.3000/meerk40t/moshi/gui/gui.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/moshi/gui/moshicontrollergui.py` & `meerk40t-0.8.3000/meerk40t/moshi/gui/moshicontrollergui.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/moshi/gui/moshidrivergui.py` & `meerk40t-0.8.3000/meerk40t/moshi/gui/moshidrivergui.py`

 * *Files 2% similar despite different names*

```diff
@@ -65,25 +65,29 @@
             | wx.aui.AUI_NB_SCROLL_BUTTONS
             | wx.aui.AUI_NB_TAB_SPLIT
             | wx.aui.AUI_NB_TAB_MOVE,
         )
         self.panels = []
 
         panel_config = MoshiConfigurationPanel(self, wx.ID_ANY, context=self.context)
-
+        panel_rotary = ChoicePropertyPanel(
+            self, wx.ID_ANY, context=self.context, choices="rotary"
+        )
         panel_warn = WarningPanel(self, id=wx.ID_ANY, context=self.context)
         panel_actions = DefaultActionPanel(self, id=wx.ID_ANY, context=self.context)
         newpanel = FormatterPanel(self, id=wx.ID_ANY, context=self.context)
 
         self.panels.append(panel_config)
+        self.panels.append(panel_rotary)
         self.panels.append(panel_warn)
         self.panels.append(panel_actions)
         self.panels.append(newpanel)
 
         self.notebook_main.AddPage(panel_config, _("Configuration"))
+        self.notebook_main.AddPage(panel_rotary, _("Rotary"))
         self.notebook_main.AddPage(panel_warn, _("Warning"))
         self.notebook_main.AddPage(panel_actions, _("Default Actions"))
         self.notebook_main.AddPage(newpanel, _("Display Options"))
 
         self.Layout()
 
         for panel in self.panels:
```

### Comparing `meerk40t-0.8.2000/meerk40t/network/console_server.py` & `meerk40t-0.8.3000/meerk40t/network/console_server.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/network/udp_server.py` & `meerk40t-0.8.3000/meerk40t/network/udp_server.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/rotary/gui/gui.py` & `meerk40t-0.8.3000/meerk40t/rotary/gui/gui.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/rotary/gui/rotarysettings.py` & `meerk40t-0.8.3000/meerk40t/rotary/gui/rotarysettings.py`

 * *Files 2% similar despite different names*

```diff
@@ -150,45 +150,45 @@
         self.Layout()
         # end wxGlade
 
     def on_check_rotary(self, event=None):
         self.rotary.rotary_enabled = self.checkbox_rotary.GetValue()
         self.text_rotary_scalex.Enable(self.checkbox_rotary.GetValue())
         self.text_rotary_scaley.Enable(self.checkbox_rotary.GetValue())
-        self.scene.grid_secondary_scale_x = 1
-        self.scene.grid_secondary_scale_y = 1
+        self.scene.pane.grid_secondary_scale_x = 1
+        self.scene.pane.grid_secondary_scale_y = 1
         if self.rotary.rotary_enabled:
             try:
-                self.scene.grid_secondary_scale_x = self.rotary.scale_x
-                self.scene.grid_secondary_scale_y = self.rotary.scale_y
+                self.scene.pane.grid_secondary_scale_x = self.rotary.scale_x
+                self.scene.pane.grid_secondary_scale_y = self.rotary.scale_y
             except ValueError:
                 pass
         # Forces guide and grid refresh
         self.rotary.signal("units")
         self.rotary.signal("refresh_scene", "Scene")
 
     def on_text_rotary_scale_y(self):
         if self.rotary is None:
             return
         try:
             self.rotary.scale_y = float(self.text_rotary_scaley.GetValue())
         except ValueError:
             pass
-        self.scene.grid_secondary_scale_y = self.rotary.scale_y
+        self.scene.pane.grid_secondary_scale_y = self.rotary.scale_y
         self.rotary.signal("units")
         self.rotary.signal("refresh_scene", "Scene")
 
     def on_text_rotary_scale_x(self):
         if self.rotary is None:
             return
         try:
             self.rotary.scale_x = float(self.text_rotary_scalex.GetValue())
         except ValueError:
             return
-        self.scene.grid_secondary_scale_x = self.rotary.scale_x
+        self.scene.pane.grid_secondary_scale_x = self.rotary.scale_x
         self.rotary.signal("units")
         self.rotary.signal("refresh_scene")
 
     # def on_check_rotary_loop(self, event):
     #     print("Event handler 'on_check_rotary_loop' not implemented!")
     #     event.Skip()
     #
```

### Comparing `meerk40t-0.8.2000/meerk40t/rotary/rotary.py` & `meerk40t-0.8.3000/meerk40t/rotary/rotary.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/ruida/control.py` & `meerk40t-0.8.3000/meerk40t/ruida/control.py`

 * *Files 9% similar despite different names*

```diff
@@ -42,17 +42,15 @@
             "[red]WARNING: [blue]This is currently being rewritten and is back in beta. Some parts do not work. Use MeerK40t 0.7.x if you want consistency.[normal]",
             ansi=True,
         )
         _ = channel._
         try:
             r2m = root.open_as("module/UDPServer", "rd2mk", port=50200)
             r2mj = root.open_as("module/UDPServer", "rd2mk-jog", port=50207)
-            emulator = RuidaEmulator(
-                root.device.driver, root.device.scene_to_device_matrix()
-            )
+            emulator = RuidaEmulator(root.device, root.device.scene_to_device_matrix())
             self.emulator = emulator
             if r2m:
                 channel(
                     _("Ruida Data Server opened on port {port}.").format(port=50200)
                 )
             if r2mj:
                 channel(_("Ruida Jog Server opened on port {port}.").format(port=50207))
```

### Comparing `meerk40t-0.8.2000/meerk40t/ruida/loader.py` & `meerk40t-0.8.3000/meerk40t/ruida/loader.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/svgelements.py` & `meerk40t-0.8.3000/meerk40t/svgelements.py`

 * *Files 0% similar despite different names*

```diff
@@ -39,15 +39,15 @@
 be used to provide much of the decisions within path objects. Such that if there is a question on
 implementation if the SVG documentation has a methodology it should be used.
 
 Though not required the Image class acquires new functionality if provided with PIL/Pillow as an import
 and the Arc can do exact arc calculations if scipy is installed.
 """
 
-SVGELEMENTS_VERSION = "1.9.0"
+SVGELEMENTS_VERSION = "1.9.1"
 
 MIN_DEPTH = 5
 ERROR = 1e-12
 
 max_depth = 0
 
 # SVG STATIC VALUES
@@ -2997,14 +2997,79 @@
         nx = v[0] * self.a + v[1] * self.c
         ny = v[0] * self.b + v[1] * self.d
         v[0] = nx
         v[1] = ny
         return v
 
     @classmethod
+    def perspective(cls, p1, p2, p3, p4):
+        """
+        Create a matrix which transforms these four ordered points to the clockwise points of the unit-square.
+
+        If G and H are very close to 0, this is an affine transformation. If they are not, then the perspective
+        transform requires g and h, but we do not support non-affine transformations.
+
+        @param p1:
+        @param p2:
+        @param p3:
+        @param p4:
+        @return:
+        """
+        x1, y1 = p1
+        x2, y2 = p2
+        x3, y3 = p3
+        x4, y4 = p4
+
+        j = x1 - x2 - x3 + x4
+        k = -x1 - x2 + x3 + x4
+        l = -x1 + x2 - x3 + x4
+        m = y1 - y2 - y3 + y4
+        n = -y1 - y2 + y3 + y4
+        o = -y1 + y2 - y3 + y4
+        i = 1.0
+
+        try:
+            h = (j * o - m * l) * i / (m * k - j * n)
+        except ZeroDivisionError:
+            h = 0
+
+        try:
+            g = k * h + l * i
+        except ZeroDivisionError:
+            g = 0
+
+        f = (y1 * (g + h + i) + y3 * (-g - h + i)) / 2.0
+        e = (y1 * (g + h + i) - y2 * (g - h + i)) / 2.0
+        d = y1 * (g + h + i) - f - e
+        c = (x1 * (g + h + i) + x3 * (-g - h + i)) / 2.0
+        b = (x1 * (g + h + i) - x2 * (g - h + i)) / 2.0
+        a = x1 * (g + h + i) - c - b
+
+        matrix = Matrix(-2, 0, 0, -2, 1, 1)
+        return matrix * cls(a, d, b, e, c, f)
+
+    @classmethod
+    def map(cls, p1, p2, p3, p4, p5, p6, p7, p8):
+        """
+        Create a matrix which transforms these four ordered points to the clockwise points of the unit-square.
+
+        If G and H are very close to 0, this is an affine transformation. If they are not, then the perspective
+        transform requires g and h, but we do not support non-affine transformations.
+
+        @param p1:
+        @param p2:
+        @param p3:
+        @param p4:
+        @return:
+        """
+        m1 = Matrix.perspective(p1, p2, p3, p4)
+        m2 = Matrix.perspective(p5, p6, p7, p8)
+        return cls(~m1 * m2)
+
+    @classmethod
     def scale(cls, sx=1.0, sy=None):
         if sy is None:
             sy = sx
         return cls(sx, 0, 0, sy, 0, 0)
 
     @classmethod
     def scale_x(cls, sx=1.0):
@@ -4720,15 +4785,20 @@
                 r1 = (tau + sqdelta) / denom
                 r2 = (tau - sqdelta) / denom
                 if 0 < r1 < 1:
                     local_extremizers.append(r1)
                 if 0 < r2 < 1:
                     local_extremizers.append(r2)
         else:
-            local_extremizers.append(0.5)
+            c = a[1] - a[0]
+            b = 2 * (a[0] - 2 * a[1] + a[2])
+            if b != 0:
+                r0 = -c / b
+                if 0 < r0 < 1:
+                    local_extremizers.append(r0)
         local_extrema = [self.point(t)[v] for t in local_extremizers]
         return min(local_extrema), max(local_extrema)
 
     def _length_scipy(self, error=ERROR):
         from scipy.integrate import quad
 
         p0 = complex(*self.start)
@@ -9360,19 +9430,19 @@
             xml_tree.set(SVG_ATTR_WIDTH, str(node.width))
         if node.height:
             xml_tree.set(SVG_ATTR_HEIGHT, str(node.height))
     elif isinstance(node, Text):
         xml_tree = subxml(xml_tree, SVG_TAG_TEXT)
         xml_tree.text = node.text
         if node.font_family:
-            xml_tree.set(SVG_ATTR_FONT_FAMILY, node.font_family)
+            xml_tree.set(SVG_ATTR_FONT_FAMILY, str(node.font_family))
         if node.font_style:
-            xml_tree.set(SVG_ATTR_FONT_STYLE, node.font_style)
+            xml_tree.set(SVG_ATTR_FONT_STYLE, str(node.font_style))
         if node.font_variant:
-            xml_tree.set(SVG_ATTR_FONT_VARIANT, node.font_variant)
+            xml_tree.set(SVG_ATTR_FONT_VARIANT, str(node.font_variant))
         if node.font_stretch:
             xml_tree.set(SVG_ATTR_FONT_STRETCH, node.font_stretch)
         if node.font_size:
             xml_tree.set(SVG_ATTR_FONT_SIZE, str(node.font_size))
         if node.line_height:
             xml_tree.set("line_height", str(node.line_height))
         if node.anchor:
@@ -9430,35 +9500,35 @@
         if stroke is not None:
             stroke_opacity = stroke.opacity
             stroke = (
                 str(abs(stroke))
                 if stroke is not None and stroke.value is not None
                 else SVG_VALUE_NONE
             )
-            xml_tree.set(SVG_ATTR_STROKE, stroke)
+            xml_tree.set(SVG_ATTR_STROKE, str(stroke))
             if stroke_opacity != 1.0 and stroke_opacity is not None:
                 xml_tree.set(SVG_ATTR_STROKE_OPACITY, str(stroke_opacity))
 
             try:
                 stroke_width = str(node.stroke_width)
-                xml_tree.set(SVG_ATTR_STROKE_WIDTH, stroke_width)
+                xml_tree.set(SVG_ATTR_STROKE_WIDTH, str(stroke_width))
             except AttributeError:
                 pass
 
     # Write Fill
     if hasattr(node, "fill"):
         fill = node.fill
         if fill is not None:
             fill_opacity = fill.opacity
             fill = (
                 str(abs(fill))
                 if fill is not None and fill.value is not None
                 else SVG_VALUE_NONE
             )
-            xml_tree.set(SVG_ATTR_FILL, fill)
+            xml_tree.set(SVG_ATTR_FILL, str(fill))
             if fill_opacity != 1.0 and fill_opacity is not None:
                 xml_tree.set(SVG_ATTR_FILL_OPACITY, str(fill_opacity))
 
     # Write id
     if hasattr(node, "id"):
         if node.id is not None:
             xml_tree.set(SVG_ATTR_ID, str(node.id))
```

### Comparing `meerk40t-0.8.2000/meerk40t/tools/driver_to_path.py` & `meerk40t-0.8.3000/meerk40t/tools/driver_to_path.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,12 +1,11 @@
 """
 Driver to Path is code adapted from jpirnay's modifications of GRBL parser to read parsed data. When the GRBLParser
 was converted to a driverlike emulator, this functionality was spun off.
 """
-
 from math import isnan
 
 from meerk40t.core.cutcode.cubiccut import CubicCut
 from meerk40t.core.cutcode.dwellcut import DwellCut
 from meerk40t.core.cutcode.gotocut import GotoCut
 from meerk40t.core.cutcode.homecut import HomeCut
 from meerk40t.core.cutcode.inputcut import InputCut
@@ -22,14 +21,15 @@
 from meerk40t.svgelements import Arc, Color, Matrix, Move, Path
 
 
 class PlotterDriver:
     """
     This is a driverlike plotter that produces path and operations.
     """
+
     def __init__(self):
         self.last_x = 0
         self.last_y = 0
         self.power = 0
         self.speed = 0
         self.depth = 0
         self.paths = list()
@@ -124,15 +124,15 @@
         elif isinstance(q, QuadCut):
             self.path.quad((q.start, q.c, q.end))
         elif isinstance(q, CubicCut):
             self.path.cubic(q.start, q.c1(), q.c2(), q.end)
         elif isinstance(q, WaitCut):
             pass
         elif isinstance(q, HomeCut):
-            self.path.move((0,0))
+            self.path.move((0, 0))
         elif isinstance(q, GotoCut):
             pass
         elif isinstance(q, SetOriginCut):
             pass
         elif isinstance(q, DwellCut):
             pass
         elif isinstance(q, (InputCut, OutputCut)):
@@ -437,32 +437,35 @@
                 "tip": "Maximum power used will be mapped to upper level",
                 "conditional": (self, "scale_power"),
                 "section": "_30_Operation",
                 "subsection": "_20_Power",
             },
         ]
 
-    def parse(self, emulator, data, elements, options=None):
+    def parse(self, blob_type, data, elements, options=None):
         """Parse the data with the given emulator and create and add the relevant paths.
 
         Args:
-            emulator: the emulator to use to parse the data, suffix entry value.
+            blob_type: the emulator to use to parse the data, suffix entry value.
             data (bytes): the grbl code to parse
             elements (class): context for elements
             options (disctionary, optional): A dictionary with settings. Defaults to None.
         """
         with elements.static("driver_to_path"):
             plotter = PlotterDriver()
             for opt in self.options:
                 if hasattr(plotter, opt["attr"]):
                     setattr(plotter, opt["attr"], getattr(self, opt["attr"]))
 
-            emulator_class = elements.lookup(f"emulator/{emulator}")
-            emulator_object = emulator_class(plotter, elements.device.scene_to_show_matrix())
-            emulator_object.write(data)
+            spooler_job = elements.lookup(f"spoolerjob/{blob_type}")
+            job_object = spooler_job(plotter, elements.device.scene_to_show_matrix())
+            job_object.write_blob(data)
+            while not job_object.execute():
+                # Still more to execute.
+                pass
 
             op_nodes = {}
             color_index = 0
             color_array = (
                 "blue",
                 "lime",
                 "red",
```

### Comparing `meerk40t-0.8.2000/meerk40t/tools/geomstr.py` & `meerk40t-0.8.3000/meerk40t/tools/geomstr.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/tools/jhfparser.py` & `meerk40t-0.8.3000/meerk40t/tools/jhfparser.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/tools/pathtools.py` & `meerk40t-0.8.3000/meerk40t/tools/pathtools.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/tools/pointfinder.py` & `meerk40t-0.8.3000/meerk40t/tools/pointfinder.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/tools/polybool.py` & `meerk40t-0.8.3000/meerk40t/tools/polybool.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,18 +1,22 @@
+"""
+https://github.com/KaivnD/pypolybool
+MIT License
+"""
+
 import typing
 
 tolerance = 1e-10
 
 T = typing.TypeVar("T")
 TPoint = typing.TypeVar("TPoint", bound="Point")
 
-"""
-https://github.com/KaivnD/pypolybool
-MIT License
-"""
+
+class PolyBoolException(Exception):
+    pass
 
 
 class Point:
     def __init__(self: TPoint, x: float, y: float) -> None:
         self.x = x
         self.y = y
 
@@ -539,15 +543,15 @@
                             else:
                                 inside = below.seg.myfill.above
                         ev.seg.otherfill = Fill(inside, inside)
                 ev.other.status = surrounding.insert(LinkedList.node(Node(ev=ev)))
             else:
                 st = ev.status
                 if st is None:
-                    raise Exception(
+                    raise PolyBoolException(
                         "PolyBool: Zero-length segment detected; your epsilon is probably too small or too large"
                     )
                 if statusRoot.exists(st.previous) and statusRoot.exists(st.next):
                     self.__checkIntersection(st.previous.ev, st.next.ev)
                 st.remove()
 
                 if not ev.primary:
```

### Comparing `meerk40t-0.8.2000/meerk40t/tools/rasterplotter.py` & `meerk40t-0.8.3000/meerk40t/tools/rasterplotter.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/tools/shxparser.py` & `meerk40t-0.8.3000/meerk40t/tools/shxparser.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/tools/ttfparser.py` & `meerk40t-0.8.3000/meerk40t/tools/ttfparser.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t/tools/zinglplotter.py` & `meerk40t-0.8.3000/meerk40t/tools/zinglplotter.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/meerk40t.egg-info/PKG-INFO` & `meerk40t-0.8.3000/meerk40t.egg-info/PKG-INFO`

 * *Files 3% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: meerk40t
-Version: 0.8.2000
+Version: 0.8.3000
 Summary: MeerK40t LaserCutter Software
 Home-page: https://github.com/meerk40t/meerk40t
 Author: Tatarize
 Author-email: tatarize@gmail.com
 License: MIT
 Description: # MeerK40t
         MeerK40t (pronounced MeerKat) is a built-from-the-ground-up MIT licensed open-source laser cutting software.
@@ -60,20 +60,21 @@
         If you have a bug, feature request, or other issue raise it here. These are likely to be resolved. Squeaky wheels get the grease.
         https://github.com/meerk40t/meerk40t/issues
         
         If you need additional support, please research/ask on:
         
         *   [Facebook](https://www.facebook.com/groups/716000085655097/)
         *   [Maker Forums](https://forum.makerforums.info/t/about-the-meerk40t-category/79660)
-        *   [Youtube - David Olsen's channel](https://www.youtube.com/channel/UCsAUV23O2FyKxC0HN7nkAQQ)
+        *   [YouTube - David Olsen's channel](https://www.youtube.com/channel/UCsAUV23O2FyKxC0HN7nkAQQ)
+        *   [YouTube - Some instruction videos](https://www.youtube.com/channel/UCMN9gGvpacxZINPZCSOecaQ)
         *   [Discord](https://discord.gg/vkDD3HdQq6)
         
         ## Assisting the Project
         
-        Open source projects live and die with their support. There are a lots of ways to help the project. There are also a lot of ways the project should help you. 
+        Open source projects live and die with their support. There are a lots of ways to help the project. There are also a lot of ways the project should help you.
         *   Code
         *   Provide Translations in other languages.
         *   Design ( Good design instincts, smooth out the rough edges)
         *   Compile/Testers
         *   Beta testers
         *   Make helpful support content
         *   Make guides ("How to setup cameras?", etc)
```

### Comparing `meerk40t-0.8.2000/meerk40t.egg-info/SOURCES.txt` & `meerk40t-0.8.3000/meerk40t.egg-info/SOURCES.txt`

 * *Files 12% similar despite different names*

```diff
@@ -33,18 +33,14 @@
 ./meerk40t/ch341/mock.py
 ./meerk40t/ch341/windll.py
 ./meerk40t/core/__init__.py
 ./meerk40t/core/bindalias.py
 ./meerk40t/core/core.py
 ./meerk40t/core/cutplan.py
 ./meerk40t/core/drivers.py
-./meerk40t/core/element_commands.py
-./meerk40t/core/element_treeops.py
-./meerk40t/core/element_types.py
-./meerk40t/core/elements.py
 ./meerk40t/core/exceptions.py
 ./meerk40t/core/laserjob.py
 ./meerk40t/core/logging.py
 ./meerk40t/core/parameters.py
 ./meerk40t/core/planner.py
 ./meerk40t/core/plotplanner.py
 ./meerk40t/core/spoolers.py
@@ -66,14 +62,31 @@
 ./meerk40t/core/cutcode/linecut.py
 ./meerk40t/core/cutcode/outputcut.py
 ./meerk40t/core/cutcode/plotcut.py
 ./meerk40t/core/cutcode/quadcut.py
 ./meerk40t/core/cutcode/rastercut.py
 ./meerk40t/core/cutcode/setorigincut.py
 ./meerk40t/core/cutcode/waitcut.py
+./meerk40t/core/elements/__init__.py
+./meerk40t/core/elements/align.py
+./meerk40t/core/elements/branches.py
+./meerk40t/core/elements/clipboard.py
+./meerk40t/core/elements/element_treeops.py
+./meerk40t/core/elements/element_types.py
+./meerk40t/core/elements/elements.py
+./meerk40t/core/elements/grid.py
+./meerk40t/core/elements/materials.py
+./meerk40t/core/elements/notes.py
+./meerk40t/core/elements/penbox.py
+./meerk40t/core/elements/render.py
+./meerk40t/core/elements/shapes.py
+./meerk40t/core/elements/trace.py
+./meerk40t/core/elements/tree_commands.py
+./meerk40t/core/elements/undo_redo.py
+./meerk40t/core/elements/wordlist.py
 ./meerk40t/core/node/__init__.py
 ./meerk40t/core/node/blobnode.py
 ./meerk40t/core/node/bootstrap.py
 ./meerk40t/core/node/branch_elems.py
 ./meerk40t/core/node/branch_ops.py
 ./meerk40t/core/node/branch_regmark.py
 ./meerk40t/core/node/cutnode.py
@@ -141,14 +154,15 @@
 ./meerk40t/fill/patterns.py
 ./meerk40t/grbl/__init__.py
 ./meerk40t/grbl/control.py
 ./meerk40t/grbl/controller.py
 ./meerk40t/grbl/device.py
 ./meerk40t/grbl/driver.py
 ./meerk40t/grbl/emulator.py
+./meerk40t/grbl/gcodejob.py
 ./meerk40t/grbl/interpreter.py
 ./meerk40t/grbl/loader.py
 ./meerk40t/grbl/mock_connection.py
 ./meerk40t/grbl/plugin.py
 ./meerk40t/grbl/serial_connection.py
 ./meerk40t/grbl/tcp_connection.py
 ./meerk40t/grbl/gui/__init__.py
@@ -156,14 +170,15 @@
 ./meerk40t/grbl/gui/grblserialcontroller.py
 ./meerk40t/grbl/gui/gui.py
 ./meerk40t/grbl/gui/tcpcontroller.py
 ./meerk40t/gui/__init__.py
 ./meerk40t/gui/about.py
 ./meerk40t/gui/alignment.py
 ./meerk40t/gui/bufferview.py
+./meerk40t/gui/busy.py
 ./meerk40t/gui/choicepropertypanel.py
 ./meerk40t/gui/consolepanel.py
 ./meerk40t/gui/devicepanel.py
 ./meerk40t/gui/dialogoptions.py
 ./meerk40t/gui/executejob.py
 ./meerk40t/gui/fonts.py
 ./meerk40t/gui/hersheymanager.py
@@ -258,16 +273,22 @@
 ./meerk40t/gui/toolwidgets/tooltext.py
 ./meerk40t/gui/toolwidgets/toolvector.py
 ./meerk40t/gui/toolwidgets/toolwidget.py
 ./meerk40t/gui/utilitywidgets/__init__.py
 ./meerk40t/gui/utilitywidgets/buttonwidget.py
 ./meerk40t/gui/utilitywidgets/checkboxwidget.py
 ./meerk40t/gui/utilitywidgets/cyclocycloidwidget.py
+./meerk40t/gui/utilitywidgets/handlewidget.py
+./meerk40t/gui/utilitywidgets/harmonograph.py
+./meerk40t/gui/utilitywidgets/openclosewidget.py
+./meerk40t/gui/utilitywidgets/rotationwidget.py
+./meerk40t/gui/utilitywidgets/scalewidget.py
 ./meerk40t/gui/utilitywidgets/seekbarwidget.py
 ./meerk40t/gui/utilitywidgets/togglewidget.py
+./meerk40t/gui/utilitywidgets/toolbarwidget.py
 ./meerk40t/image/__init__.py
 ./meerk40t/image/imagetools.py
 ./meerk40t/kernel/__init__.py
 ./meerk40t/kernel/channel.py
 ./meerk40t/kernel/context.py
 ./meerk40t/kernel/exceptions.py
 ./meerk40t/kernel/functions.py
@@ -306,27 +327,48 @@
 ./meerk40t/moshi/gui/moshicontrollergui.py
 ./meerk40t/moshi/gui/moshidrivergui.py
 ./meerk40t/network/__init__.py
 ./meerk40t/network/console_server.py
 ./meerk40t/network/kernelserver.py
 ./meerk40t/network/tcp_server.py
 ./meerk40t/network/udp_server.py
+./meerk40t/newly/__init__.py
+./meerk40t/newly/controller.py
+./meerk40t/newly/device.py
+./meerk40t/newly/driver.py
+./meerk40t/newly/mock_connection.py
+./meerk40t/newly/newly_params.py
+./meerk40t/newly/plugin.py
+./meerk40t/newly/usb_connection.py
+./meerk40t/newly/gui/__init__.py
+./meerk40t/newly/gui/gui.py
+./meerk40t/newly/gui/newlyconfig.py
+./meerk40t/newly/gui/newlycontroller.py
+./meerk40t/newly/gui/operationproperties.py
 ./meerk40t/rotary/__init__.py
 ./meerk40t/rotary/rotary.py
 ./meerk40t/rotary/gui/__init__.py
 ./meerk40t/rotary/gui/gui.py
 ./meerk40t/rotary/gui/rotarysettings.py
 ./meerk40t/ruida/__init__.py
 ./meerk40t/ruida/control.py
+./meerk40t/ruida/controller.py
 ./meerk40t/ruida/device.py
+./meerk40t/ruida/driver.py
 ./meerk40t/ruida/emulator.py
+./meerk40t/ruida/exceptions.py
 ./meerk40t/ruida/loader.py
+./meerk40t/ruida/mock_connection.py
 ./meerk40t/ruida/plugin.py
+./meerk40t/ruida/rdjob.py
 ./meerk40t/ruida/gui/__init__.py
 ./meerk40t/ruida/gui/gui.py
+./meerk40t/ruida/gui/ruidaconfig.py
+./meerk40t/ruida/gui/ruidacontroller.py
+./meerk40t/ruida/gui/ruidaoperationproperties.py
 ./meerk40t/tools/__init__.py
 ./meerk40t/tools/driver_to_path.py
 ./meerk40t/tools/geomstr.py
 ./meerk40t/tools/jhfparser.py
 ./meerk40t/tools/livinghinges.py
 ./meerk40t/tools/pathtools.py
 ./meerk40t/tools/pointfinder.py
@@ -351,14 +393,15 @@
 ./test/test_geomstr.py
 ./test/test_imagetools_actualize.py
 ./test/test_imagetools_wizard.py
 ./test/test_kernel.py
 ./test/test_laser_speeds.py
 ./test/test_length.py
 ./test/test_lifecycle.py
+./test/test_operations_hatch.py
 ./test/test_spooler.py
 ./test/test_wobble.py
 ./test/test_zingl.py
 meerk40t/__init__.py
 meerk40t/main.py
 meerk40t/svgelements.py
 meerk40t.egg-info/PKG-INFO
@@ -366,64 +409,95 @@
 meerk40t.egg-info/dependency_links.txt
 meerk40t.egg-info/entry_points.txt
 meerk40t.egg-info/requires.txt
 meerk40t.egg-info/top_level.txt
 meerk40t.egg-info/zip-safe
 meerk40t/balormk/__init__.py
 meerk40t/balormk/balor_params.py
+meerk40t/balormk/controller.py
 meerk40t/balormk/device.py
 meerk40t/balormk/driver.py
+meerk40t/balormk/elementlightjob.py
+meerk40t/balormk/livefulllightjob.py
+meerk40t/balormk/liveselectionlightjob.py
 meerk40t/balormk/mock_connection.py
 meerk40t/balormk/plugin.py
 meerk40t/balormk/usb_connection.py
 meerk40t/balormk/gui/__init__.py
 meerk40t/balormk/gui/balorconfig.py
 meerk40t/balormk/gui/balorcontroller.py
 meerk40t/balormk/gui/baloroperationproperties.py
 meerk40t/balormk/gui/gui.py
 meerk40t/camera/__init__.py
 meerk40t/camera/camera.py
 meerk40t/camera/plugin.py
 meerk40t/camera/gui/__init__.py
 meerk40t/camera/gui/camerapanel.py
 meerk40t/camera/gui/gui.py
+meerk40t/ch341/__init__.py
+meerk40t/ch341/libusb.py
+meerk40t/ch341/mock.py
+meerk40t/ch341/windll.py
 meerk40t/core/__init__.py
 meerk40t/core/bindalias.py
+meerk40t/core/core.py
 meerk40t/core/cutplan.py
 meerk40t/core/drivers.py
-meerk40t/core/element_types.py
-meerk40t/core/elements.py
 meerk40t/core/exceptions.py
+meerk40t/core/laserjob.py
+meerk40t/core/logging.py
 meerk40t/core/parameters.py
 meerk40t/core/planner.py
 meerk40t/core/plotplanner.py
 meerk40t/core/spoolers.py
 meerk40t/core/svg_io.py
+meerk40t/core/treeop.py
+meerk40t/core/undos.py
 meerk40t/core/units.py
 meerk40t/core/webhelp.py
 meerk40t/core/wordlist.py
+meerk40t/core/cutcode/__init__.py
+meerk40t/core/cutcode/cubiccut.py
+meerk40t/core/cutcode/cutcode.py
+meerk40t/core/cutcode/cutgroup.py
+meerk40t/core/cutcode/cutobject.py
+meerk40t/core/cutcode/dwellcut.py
+meerk40t/core/cutcode/gotocut.py
+meerk40t/core/cutcode/homecut.py
+meerk40t/core/cutcode/inputcut.py
+meerk40t/core/cutcode/linecut.py
+meerk40t/core/cutcode/outputcut.py
+meerk40t/core/cutcode/plotcut.py
+meerk40t/core/cutcode/quadcut.py
+meerk40t/core/cutcode/rastercut.py
+meerk40t/core/cutcode/setorigincut.py
+meerk40t/core/cutcode/waitcut.py
 meerk40t/core/node/__init__.py
 meerk40t/core/node/blobnode.py
+meerk40t/core/node/bootstrap.py
 meerk40t/core/node/branch_elems.py
 meerk40t/core/node/branch_ops.py
 meerk40t/core/node/branch_regmark.py
 meerk40t/core/node/cutnode.py
 meerk40t/core/node/elem_ellipse.py
+meerk40t/core/node/elem_geomstr.py
 meerk40t/core/node/elem_image.py
 meerk40t/core/node/elem_line.py
 meerk40t/core/node/elem_path.py
 meerk40t/core/node/elem_point.py
 meerk40t/core/node/elem_polyline.py
 meerk40t/core/node/elem_rect.py
 meerk40t/core/node/elem_text.py
 meerk40t/core/node/filenode.py
 meerk40t/core/node/groupnode.py
 meerk40t/core/node/lasercodenode.py
 meerk40t/core/node/layernode.py
+meerk40t/core/node/mixins.py
 meerk40t/core/node/node.py
+meerk40t/core/node/nutils.py
 meerk40t/core/node/op_cut.py
 meerk40t/core/node/op_dots.py
 meerk40t/core/node/op_engrave.py
 meerk40t/core/node/op_hatch.py
 meerk40t/core/node/op_image.py
 meerk40t/core/node/op_raster.py
 meerk40t/core/node/refnode.py
@@ -442,14 +516,15 @@
 meerk40t/device/ch341/ch341.py
 meerk40t/device/ch341/ch341libusbdriver.py
 meerk40t/device/ch341/libusb.py
 meerk40t/device/ch341/mock.py
 meerk40t/device/ch341/windll.py
 meerk40t/device/gui/__init__.py
 meerk40t/device/gui/defaultactions.py
+meerk40t/device/gui/formatterpanel.py
 meerk40t/device/gui/warningpanel.py
 meerk40t/dxf/__init__.py
 meerk40t/dxf/dxf_io.py
 meerk40t/dxf/plugin.py
 meerk40t/extra/__init__.py
 meerk40t/extra/cag.py
 meerk40t/extra/embroider.py
@@ -459,31 +534,44 @@
 meerk40t/extra/pathoptimize.py
 meerk40t/extra/potrace.py
 meerk40t/extra/updater.py
 meerk40t/extra/vectrace.py
 meerk40t/extra/winsleep.py
 meerk40t/fill/__init__.py
 meerk40t/fill/fills.py
+meerk40t/fill/patternfill.py
+meerk40t/fill/patterns.py
 meerk40t/grbl/__init__.py
+meerk40t/grbl/control.py
+meerk40t/grbl/controller.py
 meerk40t/grbl/device.py
+meerk40t/grbl/driver.py
+meerk40t/grbl/emulator.py
+meerk40t/grbl/interpreter.py
+meerk40t/grbl/loader.py
+meerk40t/grbl/mock_connection.py
 meerk40t/grbl/plugin.py
+meerk40t/grbl/serial_connection.py
+meerk40t/grbl/tcp_connection.py
 meerk40t/grbl/gui/__init__.py
 meerk40t/grbl/gui/grblconfiguration.py
 meerk40t/grbl/gui/grblserialcontroller.py
 meerk40t/grbl/gui/gui.py
 meerk40t/grbl/gui/tcpcontroller.py
 meerk40t/gui/__init__.py
 meerk40t/gui/about.py
 meerk40t/gui/alignment.py
 meerk40t/gui/bufferview.py
 meerk40t/gui/choicepropertypanel.py
 meerk40t/gui/consolepanel.py
 meerk40t/gui/devicepanel.py
+meerk40t/gui/dialogoptions.py
 meerk40t/gui/executejob.py
 meerk40t/gui/fonts.py
+meerk40t/gui/hersheymanager.py
 meerk40t/gui/icons.py
 meerk40t/gui/imagesplitter.py
 meerk40t/gui/keymap.py
 meerk40t/gui/laserpanel.py
 meerk40t/gui/laserrender.py
 meerk40t/gui/lasertoolpanel.py
 meerk40t/gui/materialtest.py
@@ -508,14 +596,15 @@
 meerk40t/gui/wxmtree.py
 meerk40t/gui/wxutils.py
 meerk40t/gui/zmatrix.py
 meerk40t/gui/help_assets/__init__.py
 meerk40t/gui/help_assets/help_assets.py
 meerk40t/gui/propertypanels/__init__.py
 meerk40t/gui/propertypanels/attributes.py
+meerk40t/gui/propertypanels/blobproperty.py
 meerk40t/gui/propertypanels/consoleproperty.py
 meerk40t/gui/propertypanels/groupproperties.py
 meerk40t/gui/propertypanels/imageproperty.py
 meerk40t/gui/propertypanels/inputproperty.py
 meerk40t/gui/propertypanels/opbranchproperties.py
 meerk40t/gui/propertypanels/operationpropertymain.py
 meerk40t/gui/propertypanels/outputproperty.py
@@ -535,14 +624,15 @@
 meerk40t/gui/scenewidgets/__init__.py
 meerk40t/gui/scenewidgets/attractionwidget.py
 meerk40t/gui/scenewidgets/bedwidget.py
 meerk40t/gui/scenewidgets/elementswidget.py
 meerk40t/gui/scenewidgets/gridwidget.py
 meerk40t/gui/scenewidgets/guidewidget.py
 meerk40t/gui/scenewidgets/laserpathwidget.py
+meerk40t/gui/scenewidgets/machineoriginwidget.py
 meerk40t/gui/scenewidgets/rectselectwidget.py
 meerk40t/gui/scenewidgets/relocatewidget.py
 meerk40t/gui/scenewidgets/reticlewidget.py
 meerk40t/gui/scenewidgets/selectionwidget.py
 meerk40t/gui/statusbarwidgets/__init__.py
 meerk40t/gui/statusbarwidgets/infowidget.py
 meerk40t/gui/statusbarwidgets/opassignwidget.py
@@ -553,15 +643,17 @@
 meerk40t/gui/statusbarwidgets/strokewidget.py
 meerk40t/gui/toolwidgets/__init__.py
 meerk40t/gui/toolwidgets/circlebrush.py
 meerk40t/gui/toolwidgets/toolcircle.py
 meerk40t/gui/toolwidgets/toolcontainer.py
 meerk40t/gui/toolwidgets/tooldraw.py
 meerk40t/gui/toolwidgets/toolellipse.py
+meerk40t/gui/toolwidgets/toollinetext.py
 meerk40t/gui/toolwidgets/toolmeasure.py
+meerk40t/gui/toolwidgets/toolnodeedit.py
 meerk40t/gui/toolwidgets/toolpoint.py
 meerk40t/gui/toolwidgets/toolpolygon.py
 meerk40t/gui/toolwidgets/toolpolyline.py
 meerk40t/gui/toolwidgets/toolrect.py
 meerk40t/gui/toolwidgets/toolrelocate.py
 meerk40t/gui/toolwidgets/toolribbon.py
 meerk40t/gui/toolwidgets/tooltext.py
@@ -584,43 +676,69 @@
 meerk40t/kernel/kernel.py
 meerk40t/kernel/lifecycles.py
 meerk40t/kernel/module.py
 meerk40t/kernel/service.py
 meerk40t/kernel/settings.py
 meerk40t/kernel/states.py
 meerk40t/lihuiyu/__init__.py
+meerk40t/lihuiyu/controller.py
 meerk40t/lihuiyu/device.py
+meerk40t/lihuiyu/driver.py
+meerk40t/lihuiyu/interpreter.py
 meerk40t/lihuiyu/laserspeed.py
+meerk40t/lihuiyu/loader.py
+meerk40t/lihuiyu/parser.py
+meerk40t/lihuiyu/plugin.py
+meerk40t/lihuiyu/tcp_connection.py
 meerk40t/lihuiyu/gui/__init__.py
 meerk40t/lihuiyu/gui/gui.py
 meerk40t/lihuiyu/gui/lhyaccelgui.py
 meerk40t/lihuiyu/gui/lhycontrollergui.py
 meerk40t/lihuiyu/gui/lhydrivergui.py
 meerk40t/lihuiyu/gui/lhyoperationproperties.py
 meerk40t/lihuiyu/gui/tcpcontroller.py
 meerk40t/moshi/__init__.py
+meerk40t/moshi/builder.py
+meerk40t/moshi/controller.py
 meerk40t/moshi/device.py
+meerk40t/moshi/driver.py
+meerk40t/moshi/plugin.py
 meerk40t/moshi/gui/__init__.py
 meerk40t/moshi/gui/gui.py
 meerk40t/moshi/gui/moshicontrollergui.py
 meerk40t/moshi/gui/moshidrivergui.py
+meerk40t/network/__init__.py
+meerk40t/network/console_server.py
+meerk40t/network/kernelserver.py
+meerk40t/network/tcp_server.py
+meerk40t/network/udp_server.py
 meerk40t/rotary/__init__.py
 meerk40t/rotary/rotary.py
 meerk40t/rotary/gui/__init__.py
 meerk40t/rotary/gui/gui.py
 meerk40t/rotary/gui/rotarysettings.py
 meerk40t/ruida/__init__.py
+meerk40t/ruida/control.py
 meerk40t/ruida/device.py
+meerk40t/ruida/emulator.py
+meerk40t/ruida/loader.py
+meerk40t/ruida/plugin.py
 meerk40t/ruida/gui/__init__.py
 meerk40t/ruida/gui/gui.py
 meerk40t/tools/__init__.py
+meerk40t/tools/driver_to_path.py
+meerk40t/tools/geomstr.py
+meerk40t/tools/jhfparser.py
+meerk40t/tools/livinghinges.py
 meerk40t/tools/pathtools.py
 meerk40t/tools/pointfinder.py
+meerk40t/tools/polybool.py
 meerk40t/tools/rasterplotter.py
 meerk40t/tools/shxparser.py
+meerk40t/tools/ttfparser.py
 meerk40t/tools/zinglplotter.py
 test/__init__.py
 test/bootstrap.py
 test/test_cli.py
 test/test_core_cutcode.py
 test/test_core_elements.py
 test/test_core_plotplanner.py
@@ -634,10 +752,11 @@
 test/test_geomstr.py
 test/test_imagetools_actualize.py
 test/test_imagetools_wizard.py
 test/test_kernel.py
 test/test_laser_speeds.py
 test/test_length.py
 test/test_lifecycle.py
+test/test_operations_hatch.py
 test/test_spooler.py
 test/test_wobble.py
 test/test_zingl.py
```

### Comparing `meerk40t-0.8.2000/pyproject.toml` & `meerk40t-0.8.3000/pyproject.toml`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/setup.cfg` & `meerk40t-0.8.3000/setup.cfg`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 00000000: 5b6d 6574 6164 6174 615d 0d0a 6e61 6d65  [metadata]..name
 00000010: 203d 206d 6565 726b 3430 740d 0a76 6572   = meerk40t..ver
-00000020: 7369 6f6e 203d 2030 2e38 2e32 3030 300d  sion = 0.8.2000.
+00000020: 7369 6f6e 203d 2030 2e38 2e33 3030 300d  sion = 0.8.3000.
 00000030: 0a64 6573 6372 6970 7469 6f6e 203d 204d  .description = M
 00000040: 6565 724b 3430 7420 4c61 7365 7243 7574  eerK40t LaserCut
 00000050: 7465 7220 536f 6674 7761 7265 0d0a 6c6f  ter Software..lo
 00000060: 6e67 5f64 6573 6372 6970 7469 6f6e 5f63  ng_description_c
 00000070: 6f6e 7465 6e74 5f74 7970 6520 3d20 7465  ontent_type = te
 00000080: 7874 2f6d 6172 6b64 6f77 6e0d 0a6c 6f6e  xt/markdown..lon
 00000090: 675f 6465 7363 7269 7074 696f 6e20 3d20  g_description =
```

### Comparing `meerk40t-0.8.2000/setup.py` & `meerk40t-0.8.3000/setup.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/test/bootstrap.py` & `meerk40t-0.8.3000/test/bootstrap.py`

 * *Files 6% similar despite different names*

```diff
@@ -52,7 +52,12 @@
 
     kernel.add_plugin(dxf_io_plugin)
 
     kernel()
     kernel.console("channel print console\n")
     kernel.console("service device start dummy 0\n")
     return kernel
+
+
+def destroy(kernel):
+    for i in range(50):
+        kernel.console(f"service device destroy {i}\n")
```

### Comparing `meerk40t-0.8.2000/test/test_core_cutcode.py` & `meerk40t-0.8.3000/test/test_core_cutcode.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/test/test_core_elements.py` & `meerk40t-0.8.3000/test/test_core_elements.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/test/test_core_plotplanner.py` & `meerk40t-0.8.3000/test/test_core_plotplanner.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/test/test_core_viewports.py` & `meerk40t-0.8.3000/test/test_core_viewports.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/test/test_drivers_grbl.py` & `meerk40t-0.8.3000/test/test_drivers_grbl.py`

 * *Files 9% similar despite different names*

```diff
@@ -33,15 +33,15 @@
             kernel.console(
                 f"rect 2cm 2cm 1cm 1cm engrave -s 15 plan copy-selected preprocess validate blob preopt optimize save_job {file1}\n"
             )
         finally:
             kernel.shutdown()
         with open(file1) as f:
             data = f.read()
-        self.assertEqual(data, gcode_rect)
+        self.assertEqual(gcode_rect, data)
 
     def test_driver_basic_rect_cut(self):
         """
         @return:
         """
         file1 = "tc.gcode"
         self.addCleanup(os.remove, file1)
@@ -53,15 +53,15 @@
             kernel.console(
                 f"rect 2cm 2cm 1cm 1cm cut -s 15 plan copy-selected preprocess validate blob preopt optimize save_job {file1}\n"
             )
         finally:
             kernel.shutdown()
         with open(file1) as f:
             data = f.read()
-        self.assertEqual(data, gcode_rect)
+        self.assertEqual(gcode_rect, data)
 
     def test_driver_basic_rect_raster(self):
         """
         Attempts a raster operation however wxPython isn't available so nothing is produced.
 
         @return:
         """
```

### Comparing `meerk40t-0.8.2000/test/test_drivers_lihuiyu.py` & `meerk40t-0.8.3000/test/test_drivers_lihuiyu.py`

 * *Files 1% similar despite different names*

```diff
@@ -232,16 +232,14 @@
         file1 = "test_rapid_fast_long.egv"
         self.addCleanup(os.remove, file1)
         rect_1in_at_15 = "ICV2490731016000027CNLBS1EDzzz235Rzzz235Tzzz235Lzzz235FNSE-\n"
 
         kernel = bootstrap.bootstrap()
         try:
             kernel.console("service device start -i lhystudios 0\n")
-            for i in range(3):
-                kernel.console(f"service device destroy {i}\n")
 
             # X fast, X long.
             kernel.console("operation* delete\n")
             kernel.console("element* delete\n")
             kernel.console("rapid_override 10 1\n")
             kernel.console("rect 2in 2in 1in 1in\n")
             kernel.console("rect 4in 2.1in 1in 1in\n")
@@ -410,8 +408,9 @@
                 data = f.readlines()
             self.assertEqual("ICV1551941002013022CNBRS1EMzzzzzzz215FNSE-\n", data[-4])
             self.assertEqual(rect_1in_at_15, data[-3])
             # BL switch, BL 0 , L 2000
             self.assertEqual("ICV2452421011000060CNBLS1Ezzzzzzz215FNSE-\n", data[-2])
             self.assertEqual(data[-3], data[-1])
         finally:
+            bootstrap.destroy(kernel)
             kernel.shutdown()
```

### Comparing `meerk40t-0.8.2000/test/test_element_degenerate_points.py` & `meerk40t-0.8.3000/test/test_element_degenerate_points.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 import os
 import unittest
 from test import bootstrap
 
-from meerk40t.core.element_types import elem_nodes
+from meerk40t.core.elements.element_types import elem_nodes
 from meerk40t.core.node.elem_point import PointNode
 
 
 class TestShapePoints(unittest.TestCase):
     def test_shapes_are_points(self):
         """
         Test the ability shapes to convert to points if they meet criteria set in 0.7.x
```

### Comparing `meerk40t-0.8.2000/test/test_elements_classify.py` & `meerk40t-0.8.3000/test/test_elements_classify.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 import unittest
 from random import Random
 from test import bootstrap
 
-from meerk40t.core.element_types import elem_nodes, op_nodes
+from meerk40t.core.elements.element_types import elem_nodes, op_nodes
 
 
 class TestElementClassification(unittest.TestCase):
     def test_element_classification(self):
         """
         Random Test of classifications
```

### Comparing `meerk40t-0.8.2000/test/test_elements_penbox.py` & `meerk40t-0.8.3000/test/test_elements_penbox.py`

 * *Files 3% similar despite different names*

```diff
@@ -9,14 +9,14 @@
 
         :return:
         """
         kernel = bootstrap.bootstrap()
         try:
             kernel_root = kernel.get_context("/")
             kernel_root("penbox testpasses add 5 set 0-4 hatch_angle 0-90\n")
-            self.assertEqual(len(kernel_root.elements.penbox["testpasses"]), 5)
+            self.assertEqual(len(kernel_root.penbox.pens["testpasses"]), 5)
             self.assertEqual(
-                kernel_root.elements.penbox["testpasses"][-1]["hatch_angle"], 90
+                kernel_root.elements.penbox.pens["testpasses"][-1]["hatch_angle"], 90
             )
 
         finally:
             kernel.shutdown()
```

### Comparing `meerk40t-0.8.2000/test/test_fill.py` & `meerk40t-0.8.3000/test/test_fill.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/test/test_geomstr.py` & `meerk40t-0.8.3000/test/test_geomstr.py`

 * *Files 20% similar despite different names*

```diff
@@ -23,18 +23,62 @@
     from PIL import Image, ImageDraw
 
     im = Image.new("RGBA", (w, h), "white")
     draw = ImageDraw.Draw(im)
     for segment in segments:
         f = segment[0]
         t = segment[-1]
-        draw.line(((f.real, f.imag), (t.real, t.imag)), fill="black")
+        draw.line(((f.real, f.imag), (t.real, t.imag)), fill="#000000")
+    for segment in segments:
+        f = segment[0]
+        t = segment[-1]
+        draw.ellipse((f.real - 3, f.imag - 3, f.real + 3, f.imag + 3), fill="#FF0000")
+        draw.ellipse((t.real - 2, t.imag - 2, t.real + 2, t.imag + 2), fill="#0000FF")
     im.save(filename)
 
 
+def random_point(i=100):
+    return complex(random.random() * i, random.random() * i)
+
+
+def random_pointi(i=50):
+    return complex(random.randint(0, i), random.randint(0, i))
+
+
+def random_segment(path, i=100, point=True, line=True, quad=True, cubic=True, arc=True):
+    t = random.randint(0, 5)
+    if t == 0 and point:
+        start = random_point(i=i)
+        path.point(start)
+    elif t == 1 and line:
+        start = random_point(i=i)
+        end = random_point(i=i)
+        path.line(start, end)
+    elif t == 2 and quad:
+        start = random_point(i=i)
+        control = random_point(i=i)
+        end = random_point(i=i)
+        path.quad(start, control, end)
+    elif t == 3 and cubic:
+        start = random_point(i=i)
+        c1 = random_point(i=i)
+        c2 = random_point(i=i)
+        end = random_point(i=i)
+        path.cubic(start, c1, c2, end)
+    elif t == 4 and arc:
+        start = random_point(i=i)
+        control = random_point(i=i)
+        end = random_point(i=i)
+        path.arc(start, control, end)
+    else:
+        random_segment(
+            path, i=i, point=point, line=line, quad=quad, cubic=cubic, arc=arc
+        )
+
+
 class TestGeomstr(unittest.TestCase):
     """These tests ensure the basic functions of the Geomstr elements."""
 
     def test_geomstr_translate_scale(self):
         w = 10000
         h = 10000
         numpath = Geomstr()
@@ -215,84 +259,84 @@
         # p.two_opt_distance()
         # print(p.travel_distance())
         # print(p.segments)
         # draw(p.segments, w, h)
 
     def test_geomstr_arc_center(self):
         for i in range(1000):
-            start = complex(random.random() * 100, random.random() * 100)
-            control = complex(random.random() * 100, random.random() * 100)
-            end = complex(random.random() * 100, random.random() * 100)
+            start = random_point()
+            control = random_point()
+            end = random_point()
             c = Arc(start=start, control=control, end=end)
 
             path = Geomstr()
             path.arc(start, control, end)
 
             self.assertAlmostEqual(complex(c.center), path.arc_center(0))
 
     def test_geomstr_arc_radius(self):
         for i in range(1000):
-            start = complex(random.random() * 100, random.random() * 100)
-            control = complex(random.random() * 100, random.random() * 100)
-            end = complex(random.random() * 100, random.random() * 100)
+            start = random_point()
+            control = random_point()
+            end = random_point()
             c = Arc(start=start, control=control, end=end)
 
             path = Geomstr()
             path.arc(start, control, end)
 
             self.assertAlmostEqual(c.rx, path.arc_radius(0))
             self.assertAlmostEqual(c.ry, path.arc_radius(0))
 
     def test_geomstr_line_point(self):
         for i in range(1000):
-            start = complex(random.random() * 100, random.random() * 100)
-            end = complex(random.random() * 100, random.random() * 100)
+            start = random_point()
+            end = random_point()
             c = Line(start, end)
 
             path = Geomstr()
             path.line(start, end)
             t = random.random()
             self.assertEqual(c.point(t), path.position(0, t))
 
     def test_geomstr_quad_point(self):
         for i in range(1000):
-            start = complex(random.random() * 100, random.random() * 100)
-            control = complex(random.random() * 100, random.random() * 100)
-            end = complex(random.random() * 100, random.random() * 100)
+            start = random_point()
+            control = random_point()
+            end = random_point()
             c = QuadraticBezier(start, control, end)
 
             path = Geomstr()
             path.quad(start, control, end)
 
             t = random.random()
             self.assertEqual(c.point(t), path.position(0, t))
 
     def test_geomstr_cubic_point(self):
         for i in range(1000):
-            start = complex(random.random() * 100, random.random() * 100)
-            c1 = complex(random.random() * 100, random.random() * 100)
-            c2 = complex(random.random() * 100, random.random() * 100)
-            end = complex(random.random() * 100, random.random() * 100)
+            start = random_point()
+            c1 = random_point()
+            c2 = random_point()
+            end = random_point()
             c = CubicBezier(start, c1, c2, end)
 
             path = Geomstr()
             path.cubic(start, c1, c2, end)
 
             t = random.random()
             self.assertEqual(c.point(t), path.position(0, t))
 
     def test_geomstr_cubic_length(self):
         difference = 0
         t0 = 0
         t1 = 0
         for i in range(50):
-            start = complex(random.random() * 100, random.random() * 100)
-            c1 = complex(random.random() * 100, random.random() * 100)
-            c2 = complex(random.random() * 100, random.random() * 100)
-            end = complex(random.random() * 100, random.random() * 100)
+            start = random_point()
+            c1 = random_point()
+            c2 = random_point()
+            end = random_point()
             c = CubicBezier(start, c1, c2, end)
 
             path = Geomstr()
             path.cubic(start, c1, c2, end)
             t = time.time()
             clen = c.length()
             t0 += time.time() - t
@@ -305,41 +349,41 @@
             difference -= plen
         print(
             f"geomstr cubic length time {t0}. svgelements cubic length time {t1}. total difference {difference}"
         )
 
     def test_geomstr_line_bounds(self):
         for i in range(1000):
-            start = complex(random.random() * 100, random.random() * 100)
-            end = complex(random.random() * 100, random.random() * 100)
+            start = random_point()
+            end = random_point()
             c = Line(start, end)
 
             path = Geomstr()
             path.line(start, end)
 
             self.assertEqual(c.bbox(), path.bbox(0))
 
     def test_geomstr_quad_bounds(self):
         for i in range(1000):
-            start = complex(random.random() * 100, random.random() * 100)
-            control = complex(random.random() * 100, random.random() * 100)
-            end = complex(random.random() * 100, random.random() * 100)
+            start = random_point()
+            control = random_point()
+            end = random_point()
             c = QuadraticBezier(start, control, end)
 
             path = Geomstr()
             path.quad(start, control, end)
 
             self.assertEqual(c.bbox(), path.bbox(0))
 
     def test_geomstr_cubic_bounds(self):
         for i in range(1000):
-            start = complex(random.random() * 100, random.random() * 100)
-            c1 = complex(random.random() * 100, random.random() * 100)
-            c2 = complex(random.random() * 100, random.random() * 100)
-            end = complex(random.random() * 100, random.random() * 100)
+            start = random_point()
+            c1 = random_point()
+            c2 = random_point()
+            end = random_point()
             c = CubicBezier(start, c1, c2, end)
 
             path = Geomstr()
             path.cubic(start, c1, c2, end)
 
             self.assertEqual(c.bbox(), path.bbox(0))
 
@@ -455,16 +499,16 @@
 
         No remove segment ~x should occur before the append segment x value.
         :return:
         """
         path = Geomstr()
         for i in range(5000):
             path.line(
-                complex(random.randint(0, 50), random.randint(0, 50)),
-                complex(random.randint(0, 50), random.randint(0, 50)),
+                random_pointi(50),
+                random_pointi(50),
             )
 
         beam = Scanbeam(path)
         m = list()
         for v, idx in beam._sorted_edge_list:
             if idx >= 0:
                 m.append(idx)
@@ -527,38 +571,15 @@
         results = mg.find_intersections(clip)
         self.assertEqual(len(results), 1)
         self.assertEqual(results[0], (50, 50, 0, 0, 0))
 
     def test_geomstr_intersect_segments(self):
         path = Geomstr()
         for i in range(50):
-            t = random.randint(0, 5)
-            if t == 0:
-                start = complex(random.random() * 100, random.random() * 100)
-                path.point(start)
-            if t == 1:
-                start = complex(random.random() * 100, random.random() * 100)
-                end = complex(random.random() * 100, random.random() * 100)
-                path.line(start, end)
-            if t == 2:
-                start = complex(random.random() * 100, random.random() * 100)
-                control = complex(random.random() * 100, random.random() * 100)
-                end = complex(random.random() * 100, random.random() * 100)
-                path.quad(start, control, end)
-            if t == 3:
-                start = complex(random.random() * 100, random.random() * 100)
-                c1 = complex(random.random() * 100, random.random() * 100)
-                c2 = complex(random.random() * 100, random.random() * 100)
-                end = complex(random.random() * 100, random.random() * 100)
-                path.cubic(start, c1, c2, end)
-            if t == 4:
-                start = complex(random.random() * 100, random.random() * 100)
-                control = complex(random.random() * 100, random.random() * 100)
-                end = complex(random.random() * 100, random.random() * 100)
-                path.arc(start, control, end)
+            random_segment(path)
 
         for j in range(path.index):
             for k in range(path.index):
                 q = f"{path.segment_type(j)} x {path.segment_type(k)}: {list(path.intersections(j, k))}"
                 # print(q)
 
     def test_geomstr_merge_merge(self):
@@ -572,22 +593,22 @@
         print(results.segments)
 
     def test_geomstr_merge_capacity_count(self):
         for j in range(25):
             clip = Geomstr()
             for i in range(50):
                 clip.line(
-                    complex(random.randint(0, 50), random.randint(0, 50)),
-                    complex(random.randint(0, 50), random.randint(0, 50)),
+                    random_pointi(50),
+                    random_pointi(50),
                 )
             subject = Geomstr()
             for i in range(50):
                 subject.line(
-                    complex(random.randint(0, 50), random.randint(0, 50)),
-                    complex(random.randint(0, 50), random.randint(0, 50)),
+                    random_pointi(50),
+                    random_pointi(50),
                 )
             mg = MergeGraph(subject)
             results = mg.merge(clip)
             self.assertEqual(results.index, results.capacity)
 
     def test_geomstr_merge_order(self):
         subject = Geomstr()
@@ -843,23 +864,23 @@
         t2 = 0
         f = set_diamond1
         p = Pattern()
         p.create_from_pattern(f)
 
         yy = []
         for i in range(100):
-            yy.append(complex(random.random() * 5, random.random() * 5))
+            yy.append(random_point(5))
         yy.append(yy[0])
         poly = Polygon(*yy)  # 0,10 20,0 20,20.1 0,10
         poly.geomstr.uscale(5)
         m = Scanbeam(poly.geomstr)
 
         pts = []
         for i in range(2000):
-            pts.append(complex(random.random() * 25, random.random() * 25))
+            pts.append(random_point(25))
 
         t = time.time()
         r = m.points_in_polygon(pts)
         t1 += time.time() - t
 
         t = time.time()
         rr = [int(m.is_point_inside(j.real, j.imag)) for j in pts]
```

### Comparing `meerk40t-0.8.2000/test/test_imagetools_actualize.py` & `meerk40t-0.8.3000/test/test_imagetools_actualize.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/test/test_imagetools_wizard.py` & `meerk40t-0.8.3000/test/test_imagetools_wizard.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/test/test_kernel.py` & `meerk40t-0.8.3000/test/test_kernel.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/test/test_laser_speeds.py` & `meerk40t-0.8.3000/test/test_laser_speeds.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/test/test_length.py` & `meerk40t-0.8.3000/test/test_length.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/test/test_lifecycle.py` & `meerk40t-0.8.3000/test/test_lifecycle.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/test/test_spooler.py` & `meerk40t-0.8.3000/meerk40t/newly/newly_params.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,58 +1,56 @@
-import unittest
-from test import bootstrap
-
-
-class TestJob:
-    def __init__(
-        self,
-        service,
-    ):
-        self.stopped = False
-        self.service = service
-        self.runtime = 0
-        self.priority = 0
+"""
+Newly Parameters is a helper class which serves to treat a dict settings object as an attribute object. This differs
+from the core parameters in the parameters it uses.
+"""
+
+from typing import Dict
+
+FLOAT_PARAMETERS = ("acceleration",)
+INT_PARAMETERS = tuple()
+
+BOOL_PARAMETERS = tuple()
+
+
+STRING_PARAMETERS = tuple()
+
+
+class Parameters:
+    def __init__(self, settings: Dict = None, **kwargs):
+        self.settings = settings
+        if self.settings is None:
+            self.settings = dict()
+        self.settings.update(kwargs)
+
+    def derive(self):
+        derived_dict = dict(self.settings)
+        for attr in dir(self):
+            if attr.startswith("_"):
+                continue
+            value = getattr(self, attr)
+            if value is None:
+                continue
+            derived_dict[attr] = value
+        return derived_dict
+
+    def validate(self):
+        settings = self.settings
+        for v in FLOAT_PARAMETERS:
+            if v in settings:
+                settings[v] = float(settings[v])
+        for v in INT_PARAMETERS:
+            if v in settings:
+                settings[v] = int(settings[v])
+        for v in BOOL_PARAMETERS:
+            if v in settings:
+                settings[v] = str(settings[v]).lower() == "true"
+        for v in STRING_PARAMETERS:
+            if v in settings:
+                settings[v] = str(settings[v])
 
     @property
-    def status(self):
-        if self.is_running:
-            return "Running"
-        else:
-            return "Queued"
-
-    def is_running(self):
-        return not self.stopped
-
-    def execute(self, driver):
-        driver.home()
-        return True
-
-    def stop(self):
-        self.stopped = True
-
-    def elapsed_time(self):
-        """
-        How long is this job already running...
-        """
-        result = 0
-        return result
-
-    def estimate_time(self):
-        return 0
-
-
-class TestSpooler(unittest.TestCase):
-    def test_spoolerjob(self):
-        """
-        Test spooler job
-
-        :return:
-        """
-        kernel = bootstrap.bootstrap()
-        try:
-            kernel.device.spooler.send(TestJob(kernel.device))
-            kernel.device.spooler.clear_queue()
-            j = TestJob(kernel.device)
-            kernel.device.spooler.send(j)
-            kernel.device.spooler.remove(j)
-        finally:
-            kernel.shutdown()
+    def acceleration(self):
+        return self.settings.get("acceleration", 24)
+
+    @acceleration.setter
+    def acceleration(self, value):
+        self.settings["acceleration"] = value
```

### Comparing `meerk40t-0.8.2000/test/test_wobble.py` & `meerk40t-0.8.3000/test/test_wobble.py`

 * *Files identical despite different names*

### Comparing `meerk40t-0.8.2000/test/test_zingl.py` & `meerk40t-0.8.3000/test/test_zingl.py`

 * *Files identical despite different names*

